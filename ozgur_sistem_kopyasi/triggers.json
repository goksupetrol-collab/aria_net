[
  {
    "schema": "dbo",
    "trigger_name": "bankahrk_log_trd",
    "table_name": "bankahrk",
    "is_disabled": false,
    "definition": "/* */\r\n/* Definition for triggers :  */\r\n/* */\r\n\r\nCREATE TRIGGER [dbo].[bankahrk_log_trd] ON [dbo].[bankahrk]\r\nWITH EXECUTE AS CALLER\r\nFOR DELETE\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int,@for_log varchar(8000)\r\n  Select @for_log=' id='+cast(id as varchar(50))+' bankod='+bankod+' bankhrkid='+cast(bankhrkid as varchar(50))+' firmano='+cast(firmano as varchar(50))+' gctip='+gctip+' varno='+cast(varno as varchar(50))+' masterid='+cast(masterid as varchar(50))+' islmtip='+islmtip+' islmtipad='+islmtipad+' islmhrk='+islmhrk+' islmhrkad='+islmhrkad+' yertip='+yertip+' yerad='+yerad+' perkod='+perkod+' adaid='+cast(adaid as varchar(50))+' borc='+cast(borc as varchar(50))+' alacak='+cast(alacak as varchar(50))+' carkod='+carkod+' cartur='+cartur+' cartip='+cartip+' tarih='+cast(tarih as varchar(50))+' saat='+saat+' belno='+belno+' ack='+ack+' kur='+cast(kur as varchar(50))+' varok='+cast(varok as varchar(50))+' sil='+cast(sil as varchar(50))+' olususer='+olususer+' olustarsaat='+cast(olustarsaat as varchar(50))+' deguser='+deguser+' degtarsaat='+cast(degtarsaat as varchar(50))+' dataok='+cast(dataok as varchar(50))+' parabrm='+parabrm+' kaskod='+kaskod+' pro='+cast(pro as varchar(50))+' fisfattip='+fisfattip+' fisfatid='+cast(fisfatid as varchar(50))+' karsihestip='+karsihestip+' karsiheskod='+karsiheskod+' fisid='+cast(fisid as varchar(50))+' gidkod='+gidkod+' gidtutar='+cast(gidtutar as varchar(50)) from deleted\r\n  exec sp_loglama @firmano,@id,'bankahrk',-2,@for_log\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "bankahrk_log_tri",
    "table_name": "bankahrk",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[bankahrk_log_tri] ON [dbo].[bankahrk]\r\nWITH EXECUTE AS CALLER\r\nFOR INSERT\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int\r\n  Select @firmano=firmano,@id=id from inserted\r\n  exec sp_loglama @firmano,@id,'bankahrk',1,''\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "bankahrk_log_tru",
    "table_name": "bankahrk",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[bankahrk_log_tru] ON [dbo].[bankahrk]\r\nWITH EXECUTE AS CALLER\r\nFOR UPDATE\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int,@sil bit\r\n  Select @firmano=firmano,@id=id,@sil=isnull(sil,0) from inserted\r\n  if update(sil) and (@sil=1)\r\n    exec sp_loglama @firmano,@id,'bankahrk',-1,''\r\n  else\r\n    exec sp_loglama @firmano,@id,'bankahrk',0,''\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "bankhrk_trd",
    "table_name": "bankahrk",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[bankhrk_trd] ON [dbo].[bankahrk]\r\nWITH EXECUTE AS CALLER\r\nFOR DELETE\r\nAS\r\nBEGIN\r\ndeclare @id    int \r\ndeclare @varno float\r\ndeclare @naktop float\r\ndeclare @bankod varchar(20)\r\ndeclare @islmhrk   varchar(30)\r\ndeclare @bankhrkid   int\r\ndeclare @yertip   varchar(30)\r\n\r\n\r\ndeclare @gidtipkod varchar(20)\r\ndeclare @gidtiphrkkod varchar(20)\r\n\r\n\r\n/*-masraf kodları */\r\n set @gidtipkod='GLG'\r\n set @gidtiphrkkod='BMF'\r\n\r\n\r\nSET NOCOUNT ON\r\n\r\nDECLARE bankhrksilcur CURSOR LOCAL FAST_FORWARD  FOR SELECT id,bankod,islmhrk,\r\n bankhrkid,varno,yertip from deleted\r\n OPEN bankhrksilcur\r\n  FETCH NEXT FROM bankhrksilcur INTO  @id,@bankod,@islmhrk,@bankhrkid,@varno,@yertip\r\n  WHILE @@FETCH_STATUS <> -1\r\n  BEGIN\r\n\r\n    if (@islmhrk='YTN') or (@islmhrk='CKN')\r\n    delete from kasahrk where masterid=@bankhrkid and karsihestip='bankakart'\r\n    and islmhrk=@islmhrk \r\n    if (@islmhrk='B-C') or (@islmhrk='C-B')\r\n    delete from carihrk where masterid=@bankhrkid and karsihestip='bankakart'\r\n    and islmhrk=@islmhrk \r\n    if (@islmhrk='BKK') or (@islmhrk='EKK')\r\n    delete from carihrk where masterid=@bankhrkid and karsihestip='bankakart'\r\n    and islmhrk=@islmhrk \r\n    \r\n    if (@islmhrk='BNK') or (@islmhrk='IKO')\r\n    delete from istkhrk where masterid=@bankhrkid and karsihestip='bankakart'\r\n    and islmhrk=@islmhrk \r\n    \r\n\r\n    delete from bankahrk where masterid=@bankhrkid and karsihestip='bankakart'\r\n    and islmhrk=@islmhrk \r\n    \r\n    \r\n    /*banka gelir gider kasa yansıması silimi */\r\n    delete from bankahrk where masterid=@bankhrkid \r\n    and karsihestip='bankakart' and islmtip=@gidtipkod \r\n    and islmhrk=@gidtiphrkkod \r\n    \r\n    \r\n    /* masraf yansıması */\r\n     delete from carihrk where masterid=@bankhrkid\r\n     and islmtip=@gidtipkod and islmhrk=@gidtiphrkkod \r\n     and karsihestip='bankakart'\r\n     \r\n     \r\n     \r\n  \r\n\r\n  if (@yertip='pomvardimas') and (@islmhrk='C-B')\r\n  begin\r\n  \r\n    update pomvardimas set bankatop=\r\n    (select isnull(sum(borc*kur),0) from bankahrk with (nolock) where varno=@varno and sil=0\r\n    and islmhrk='C-B' and sil=0 and carkod='VRDHES'\r\n    and yertip=@yertip )  where varno=@varno\r\n\r\n  end   \r\n     \r\n     \r\n FETCH NEXT FROM bankhrksilcur INTO  @id,@bankod,@islmhrk,@bankhrkid,@varno,@yertip\r\nEND\r\nCLOSE bankhrksilcur\r\nDEALLOCATE bankhrksilcur    \r\n     \r\n\r\nSET NOCOUNT OFF\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "bankhrk_tri",
    "table_name": "bankahrk",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[bankhrk_tri] ON [dbo].[bankahrk]\r\nWITH EXECUTE AS CALLER\r\nFOR INSERT, UPDATE\r\nAS\r\nBEGIN\r\n\r\n\r\nSET NOCOUNT ON\r\n\r\ndeclare @varno float\r\ndeclare @islmtip varchar(20)\r\ndeclare @islmhrk varchar(20)\r\ndeclare @yertip varchar(30)\r\ndeclare @belno varchar(20)\r\ndeclare @bankhrkid float\r\ndeclare @id       int\r\ndeclare @newid float\r\ndeclare @gctip varchar(1)\r\ndeclare @borc float,@alacak float\r\ndeclare @bankod varchar(20)\r\ndeclare @bankhrkIdcount int\r\ndeclare @firmano  int\r\n\r\n\r\n  select @id=id,@bankod=bankod,@bankhrkid=bankhrkid,@yertip=yertip,\r\n  @islmtip=islmtip,@islmhrk=islmhrk,@varno=varno,@firmano=firmano,\r\n  @belno=belno from inserted\r\n    \r\n  select @bankhrkIdcount=count(*) from bankahrk with (nolock)\r\n  where isnull(bankhrkid,0)=0 and firmano=@firmano \r\n\r\n  \r\n  if (@islmhrk='B-C') or (@islmhrk='C-B')\r\n   begin \r\n     if isnull(@bankhrkid,0)=0\r\n      begin\r\n        update bankahrk set bankhrkid=id where isnull(bankhrkid,0)=0\r\n        set @bankhrkid=@id \r\n      end  \r\n   end\r\n\r\n\r\n  if @bankhrkIdcount>1\r\n  begin\r\n    RAISERROR ('BankahrkId Hatası', 16,1) \r\n    ROLLBACK TRANSACTION\r\n    RETURN\r\n  end\r\n\r\n if isnull(@bankhrkid,0)=0\r\n  return\r\n   \r\n   exec bankhrkgiris @id\r\n\r\n   exec numara_no_yaz 'makbuz',@belno\r\n \r\n  \r\n   \r\n if (@yertip='pomvardimas') and (@islmtip='BNK') \r\n  and (@islmhrk='C-B')\r\n  begin\r\n  \r\n   update pomvardimas set bankatop=\r\n   (select isnull(sum(borc*kur),0) from bankahrk with (nolock) where varno=@varno and sil=0\r\n   and islmtip='BNK' and islmhrk in ('C-B') and sil=0 and carkod='VRDHES'\r\n   and yertip=@yertip )  where varno=@varno\r\n \r\n end\r\n \r\n \r\n \r\n if (@yertip='marvardimas') and (@islmtip='BNK') \r\n  and (@islmhrk='C-B')\r\n  begin\r\n  \r\n   update marvardimas set bankatop=\r\n   (select isnull(sum(borc*kur),0) from bankahrk with (nolock) where varno=@varno and sil=0\r\n   and islmtip='BNK' and islmhrk in ('C-B') and sil=0 and carkod='VRDHES'\r\n   and yertip=@yertip )  where varno=@varno\r\n \r\n end\r\n  \r\n\r\n\r\n  SET NOCOUNT OFF\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "bankakart_log_trd",
    "table_name": "bankakart",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[bankakart_log_trd] ON [dbo].[bankakart]\r\nWITH EXECUTE AS CALLER\r\nFOR DELETE\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int,@for_log varchar(8000)\r\n  Select @for_log=' id='+cast(id as varchar(50))+' kod='+kod+' firmano='+cast(firmano as varchar(50))+' ad='+ad+' muhkod='+muhkod+' hesno='+hesno+' parabrm='+parabrm+' ilgili='+ilgili+' tel='+tel+' drm='+drm+' fax='+fax+' grp1='+grp1+' grp2='+grp2+' grp3='+grp3+' borc='+cast(borc as varchar(50))+' alacak='+cast(alacak as varchar(50))+' olususer='+olususer+' olustarsaat='+cast(olustarsaat as varchar(50))+' degtarsaat='+cast(degtarsaat as varchar(50))+' deguser='+deguser+' sil='+cast(sil as varchar(50))+' dataok='+cast(dataok as varchar(50))+' actutar='+cast(actutar as varchar(50)) from deleted\r\n  exec sp_loglama @firmano,@id,'bankakart',-2,@for_log\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "bankakart_log_tri",
    "table_name": "bankakart",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[bankakart_log_tri] ON [dbo].[bankakart]\r\nWITH EXECUTE AS CALLER\r\nFOR INSERT\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int\r\n  Select @firmano=firmano,@id=id from inserted\r\n  exec sp_loglama @firmano,@id,'bankakart',1,''\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "bankakart_log_tru",
    "table_name": "bankakart",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[bankakart_log_tru] ON [dbo].[bankakart]\r\nWITH EXECUTE AS CALLER\r\nFOR UPDATE\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int,@sil bit\r\n  Select @firmano=firmano,@id=id,@sil=isnull(sil,0) from inserted\r\n  if update(sil) and (@sil=1)\r\n    exec sp_loglama @firmano,@id,'bankakart',-1,''\r\n  else\r\n    exec sp_loglama @firmano,@id,'bankakart',0,''\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "bankakart_tri",
    "table_name": "bankakart",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[bankakart_tri] ON [dbo].[bankakart]\r\nWITH EXECUTE AS CALLER\r\nFOR INSERT\r\nAS\r\nBEGIN\r\n\r\ndeclare @kod varchar(20);\r\nDECLARE @id float;\r\n\r\nselect @id=id,@kod=kod from inserted;\r\n\r\nEXEC carikartacilis 'bankakart',@kod;\r\n\r\nEXEC numara_no_yaz 'bankakart',@kod\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "bankakart_tru",
    "table_name": "bankakart",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[bankakart_tru] ON [dbo].[bankakart]\r\nWITH EXECUTE AS CALLER\r\nFOR UPDATE\r\nAS\r\nBEGIN\r\ndeclare @kod varchar(20);\r\nDECLARE @id float;\r\n\r\nselect @id=id,@kod=kod from inserted;\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "barkod_log_trd",
    "table_name": "barkod",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[barkod_log_trd] ON [dbo].[barkod]\r\nWITH EXECUTE AS CALLER\r\nFOR DELETE\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int,@for_log varchar(8000)\r\n  Select @for_log=' id='+cast(id as varchar(50))+' firmano='+cast(firmano as varchar(50))+' tip='+tip+' kod='+kod+' barkod='+barkod+' olususer='+olususer+' olustarsaat='+cast(olustarsaat as varchar(50))+' sil='+cast(sil as varchar(50)) from deleted\r\n  exec sp_loglama @firmano,@id,'barkod',-2,@for_log\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "barkod_log_tri",
    "table_name": "barkod",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[barkod_log_tri] ON [dbo].[barkod]\r\nWITH EXECUTE AS CALLER\r\nFOR INSERT\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int\r\n  Select @firmano=firmano,@id=id from inserted\r\n  exec sp_loglama @firmano,@id,'barkod',1,''\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "barkod_log_tru",
    "table_name": "barkod",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[barkod_log_tru] ON [dbo].[barkod]\r\nWITH EXECUTE AS CALLER\r\nFOR UPDATE\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int,@sil bit\r\n  Select @firmano=firmano,@id=id,@sil=isnull(sil,0) from inserted\r\n  if update(sil) and (@sil=1)\r\n    exec sp_loglama @firmano,@id,'barkod',-1,''\r\n  else\r\n    exec sp_loglama @firmano,@id,'barkod',0,''\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "carihrk_log_trd",
    "table_name": "carihrk",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[carihrk_log_trd] ON [dbo].[carihrk]\r\nWITH EXECUTE AS CALLER\r\nFOR DELETE\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int,@for_log varchar(8000)\r\n  Select @for_log=' id='+cast(id as varchar(50))+' carhrkid='+cast(carhrkid as varchar(50))+' firmano='+cast(firmano as varchar(50))+' gctip='+gctip+' masterid='+cast(masterid as varchar(50))+' islmtip='+islmtip+' islmtipad='+islmtipad+' islmhrk='+islmhrk+' islmhrkad='+islmhrkad+' yerad='+yerad+' yertip='+yertip+' cartip='+cartip+' carkod='+carkod+' borc='+cast(borc as varchar(50))+' alacak='+cast(alacak as varchar(50))+' bakiye='+cast(bakiye as varchar(50))+' tarih='+cast(tarih as varchar(50))+' saat='+saat+' olususer='+olususer+' olustarsaat='+cast(olustarsaat as varchar(50))+' vadetar='+cast(vadetar as varchar(50))+' belno='+belno+' ack='+ack+' varno='+cast(varno as varchar(50))+' kur='+cast(kur as varchar(50))+' dataok='+cast(dataok as varchar(50))+' pro='+cast(pro as varchar(50))+' varok='+cast(varok as varchar(50))+' perkod='+perkod+' adaid='+cast(adaid as varchar(50))+' deguser='+deguser+' degtarsaat='+cast(degtarsaat as varchar(50))+' sil='+cast(sil as varchar(50))+' parabrm='+parabrm+' karsihestip='+karsihestip+' karsiheskod='+karsiheskod+' kdvyuz='+cast(kdvyuz as varchar(50))+' fisaktip='+fisaktip+' fisfattip='+fisfattip+' fisfatid='+cast(fisfatid as varchar(50))+' marsatid='+cast(marsatid as varchar(50))+' fisid='+cast(fisid as varchar(50))+' permasmasid='+cast(permasmasid as varchar(50))+' fatstkhrkid='+cast(fatstkhrkid as varchar(50)) from deleted\r\n  exec sp_loglama @firmano,@id,'carihrk',-2,@for_log\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "carihrk_log_tri",
    "table_name": "carihrk",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[carihrk_log_tri] ON [dbo].[carihrk]\r\nWITH EXECUTE AS CALLER\r\nFOR INSERT\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int\r\n  Select @firmano=firmano,@id=id from inserted\r\n  exec sp_loglama @firmano,@id,'carihrk',1,''\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "carihrk_log_tru",
    "table_name": "carihrk",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[carihrk_log_tru] ON [dbo].[carihrk]\r\nWITH EXECUTE AS CALLER\r\nFOR UPDATE\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int,@sil bit\r\n  Select @firmano=firmano,@id=id,@sil=isnull(sil,0) from inserted\r\n  if update(sil) and (@sil=1)\r\n    exec sp_loglama @firmano,@id,'carihrk',-1,''\r\n  else\r\n    exec sp_loglama @firmano,@id,'carihrk',0,''\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "carihrk_trd",
    "table_name": "carihrk",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[carihrk_trd] ON [dbo].[carihrk]\r\nWITH EXECUTE AS CALLER\r\nFOR DELETE\r\nAS\r\nBEGIN\r\ndeclare @cartur \tvarchar(30)\r\ndeclare @carkod \tvarchar(30)\r\ndeclare @islmtip \tvarchar(30)\r\ndeclare @yertip \tvarchar(30)\r\ndeclare @cartip \tvarchar(30)\r\ndeclare @islmhrk \tvarchar(20)\r\ndeclare @pro \t\tint\r\ndeclare @id \t\tfloat\r\ndeclare @masterid \tfloat\r\ndeclare @carbak \tfloat\r\ndeclare @permasmasid float\r\ndeclare @fisfatid \tfloat\r\ndeclare @varno \t\tfloat\r\ndeclare @marsatid \tfloat\r\ndeclare @carhrkid \tfloat\r\n\r\n\r\ndeclare @borc \tfloat\r\ndeclare @alacak float\r\ndeclare @fisbak float\r\ndeclare @kur \tfloat\r\n\r\n\r\n DECLARE carihrksilcur CURSOR LOCAL FAST_FORWARD  FOR SELECT id,islmtip,islmhrk,\r\n masterid,carhrkid,yertip,borc,alacak,kur,cartip,\r\n carkod,permasmasid,fisfatid,varno,marsatid from deleted\r\n OPEN carihrksilcur\r\n  FETCH NEXT FROM carihrksilcur INTO  @id,@islmtip,@islmhrk,@masterid,@carhrkid,\r\n  @yertip,@borc,@alacak,\r\n  @kur,@cartip,@carkod,@permasmasid,@fisfatid,@varno,@marsatid\r\n  WHILE @@FETCH_STATUS = 0\r\n  BEGIN\r\n\r\n\r\n if @yertip='faturamas' and @islmtip='FAT' and @islmhrk='GID'\r\n  exec faturahrkgiris @fisfatid,1,1\r\n\r\n\r\nif (@yertip='marvardimas') \r\nbegin\r\n\r\n  update marsatmas set indtop=dt.indtop\r\n    from marsatmas t join\r\n   (select marsatid,isnull((borc*kur),0) as indtop from carihrk where varno=@varno and sil=0\r\n   and islmtip='GLG' and islmhrk='IND' and marsatid=@marsatid )\r\n   dt on dt.marsatid=t.marsatid and t.sil=0\r\n\r\n\r\n /*gider */\r\n update marsatmas set cartip=dt.cartip,carkod=dt.carkod,\r\n    islmhrk=dt.islmhrk,islmhrkad=dt.islmhrkad,gidertop=dt.gidertop\r\n    from marsatmas t join\r\n   (select  marsatid,cartip,carkod,islmhrk,islmhrkad,\r\n   isnull((borc*kur),0) as gidertop from carihrk where varno=@varno and sil=0\r\n   and islmtip='GLG' and islmhrk='MAR' and marsatid=@marsatid )\r\n   dt on dt.marsatid=t.marsatid and t.sil=0\r\n   \r\n update marvardimas set gidertop=\r\n   (select isnull(sum(borc*kur),0) from carihrk where varno=@varno and sil=0\r\n   and ( (islmtip='ODE') OR (islmhrk='IND') and (islmtip='GLG') OR (islmhrk='MAR') )\r\n    and cartip='gelgidkart' and yertip=@yertip )\r\n where varno=@varno\r\nend\r\n\r\n if @yertip='permaas'\r\n   exec personelmaas @permasmasid,1\r\n   \r\n if  @islmtip='VAD' and @islmhrk='CVF'\r\n    exec Cari_Vade_Gelir_Hrk @carhrkid,1\r\n\r\n\r\n FETCH NEXT FROM carihrksilcur INTO  @id,@islmtip,@islmhrk,@masterid,@carhrkid,\r\n @yertip,@borc,@alacak,@kur,@cartip,@carkod,@permasmasid,@fisfatid,@varno,\r\n @marsatid\r\nEND\r\nCLOSE carihrksilcur\r\nDEALLOCATE carihrksilcur\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "carihrk_tri",
    "table_name": "carihrk",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[carihrk_tri] ON [dbo].[carihrk]\r\nWITH EXECUTE AS CALLER\r\nFOR INSERT, UPDATE\r\nAS\r\nBEGIN\r\n\r\nSET NOCOUNT ON\r\nSET XACT_ABORT ON\r\n\r\ndeclare @cartur           \tvarchar(30)\r\ndeclare @carkod \t\t\tvarchar(30)\r\ndeclare @islmtip \t\t\tvarchar(10)\r\ndeclare @islmhrk \t\t\tvarchar(10)\r\ndeclare @yertip \t\t\tvarchar(20)\r\ndeclare @cartip \t\t\tvarchar(30)\r\ndeclare @belno \t\t\t\tvarchar(20)\r\ndeclare @pro \t\t\t\tint\r\ndeclare @sil \t\t\t\tint\r\ndeclare @varno \t\t\t\tfloat\r\ndeclare @idx \t\t\t\tfloat\r\ndeclare @carhrkid\t\t\tfloat\r\ndeclare @masterid           float\r\ndeclare @carbak \t\t\tfloat\r\ndeclare @permasmasid \t\tfloat\r\ndeclare @fisfatid \t\t\tfloat\r\ndeclare @marsatid \t\t\tfloat\r\ndeclare @borc \t\t\t\tfloat\r\ndeclare @alacak \t\t\tfloat\r\ndeclare @fisbak \t\t\tfloat\r\ndeclare @kur \t\t\t\tfloat\r\n\r\n\r\n\r\ndeclare @del_cartip  varchar(30)\r\ndeclare @del_carkod  varchar(30)\r\n\r\n\r\nselect @del_cartip=cartip,@del_carkod=carkod from deleted\r\n\r\n\r\nselect @varno=varno,@permasmasid=permasmasid,@marsatid=marsatid,\r\n@islmtip=islmtip,@islmhrk=islmhrk,\r\n@idx=id,@masterid=masterid,@carhrkid=carhrkid,\r\n@fisfatid=fisfatid,@yertip=yertip,@borc=borc,@alacak=alacak,\r\n@kur=kur,@cartip=cartip,@carkod=carkod,@pro=pro,@sil=sil,@belno=belno from inserted\r\n\r\n if isnull(@carhrkid,0)=0\r\n  return\r\n\r\n\r\n  exec numara_no_yaz 'makbuz',@belno\r\n\r\n\r\n\r\n\r\n\r\n  if @yertip='faturamas' and @islmtip='FAT' and @islmhrk='GID'\r\n    exec faturahrkgiris @fisfatid,1,0\r\n\r\n\r\nif (@yertip='marvardimas') \r\nbegin\r\n\r\n  update marsatmas set indtop=dt.indtop\r\n    from marsatmas t join\r\n   (select marsatid,isnull((borc*kur),0) as indtop from carihrk with (nolock) where varno=@varno and sil=0\r\n   and islmtip='GLG' and islmhrk='IND' and marsatid=@marsatid )\r\n   dt on dt.marsatid=t.marsatid and t.sil=0\r\n\r\n\r\n /*gider */\r\n update marsatmas set cartip=dt.cartip,carkod=dt.carkod,\r\n    islmhrk=dt.islmhrk,islmhrkad=dt.islmhrkad,gidertop=dt.gidertop\r\n    from marsatmas t join\r\n   (select  marsatid,cartip,carkod,islmhrk,islmhrkad,\r\n   isnull((borc*kur),0) as gidertop from carihrk with (nolock) where varno=@varno and sil=0\r\n   and islmtip='GLG' and islmhrk='MAR' and marsatid=@marsatid )\r\n   dt on dt.marsatid=t.marsatid and t.sil=0\r\n   \r\n update marvardimas set gidertop=\r\n   (select isnull(sum(borc*kur),0) from carihrk with (nolock) where varno=@varno and sil=0\r\n   and ( (islmtip='ODE') OR (islmhrk='IND') and (islmtip='GLG') OR (islmhrk='MAR') )\r\n    and cartip='gelgidkart' and yertip=@yertip )\r\n where varno=@varno\r\nend;\r\n\r\n if @yertip='permaas'\r\n   exec personelmaas @permasmasid,@sil\r\n   \r\n if  @islmtip='VAD' and @islmhrk='CVF'\r\n    exec Cari_Vade_Gelir_Hrk @carhrkid,@sil\r\n\r\n\r\n SET NOCOUNT OFF\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "carikart_log_trd",
    "table_name": "carikart",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[carikart_log_trd] ON [dbo].[carikart]\r\nWITH EXECUTE AS CALLER\r\nFOR DELETE\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int,@for_log varchar(8000)\r\n  Select @for_log=' id='+cast(id as varchar(50))+' firmano='+cast(firmano as varchar(50))+' sil='+cast(sil as varchar(50))+' kod='+kod+' ad='+ad+' soyad='+soyad+' unvan='+unvan+' fisbak='+cast(fisbak as varchar(50))+' carbak='+cast(carbak as varchar(50))+' fisadet='+cast(fisadet as varchar(50))+' fisakadet='+cast(fisakadet as varchar(50))+' cekbak='+cast(cekbak as varchar(50))+' fisaktut='+cast(fisaktut as varchar(50))+' actutar='+cast(actutar as varchar(50))+' grp1='+cast(grp1 as varchar(50))+' grp2='+cast(grp2 as varchar(50))+' grp3='+cast(grp3 as varchar(50))+' ilgili='+ilgili+' tel='+tel+' fax='+fax+' cep='+cep+' muhkod='+muhkod+' drm='+drm+' adres='+adres+' evil='+evil+' evilce='+evilce+' vergidaire='+vergidaire+' vergino='+vergino+' mail='+mail+' tcno='+tcno+' kulkod='+kulkod+' sonhrktar='+cast(sonhrktar as varchar(50))+' kulsif='+kulsif+' fatvadtip='+fatvadtip+' fisvadtip='+fisvadtip+' fatvadsur='+cast(fatvadsur as varchar(50))+' fisvadsur='+cast(fisvadsur as varchar(50))+' fatisk='+cast(fatisk as varchar(50))+' fisvadfark='+cast(fisvadfark as varchar(50))+' fatvadfark='+cast(fatvadfark as varchar(50))+' fisisk='+cast(fisisk as varchar(50))+' olususer='+olususer+' olustarsaat='+cast(olustarsaat as varchar(50))+' deguser='+deguser+' degtarsaat='+cast(degtarsaat as varchar(50))+' dataok='+cast(dataok as varchar(50))+' parabrm='+parabrm+' otofisak='+cast(otofisak as varchar(50))+' fatunvan='+fatunvan+' toplamteminat='+cast(toplamteminat as varchar(50))+' toplamlimit='+cast(toplamlimit as varchar(50))+' sonfistutar='+cast(sonfistutar as varchar(50))+' sonfistarih='+cast(sonfistarih as varchar(50))+' adres2='+adres2+' notack='+notack from deleted\r\n  exec sp_loglama @firmano,@id,'carikart',-2,@for_log\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "carikart_log_tri",
    "table_name": "carikart",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[carikart_log_tri] ON [dbo].[carikart]\r\nWITH EXECUTE AS CALLER\r\nFOR INSERT\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int\r\n  Select @firmano=firmano,@id=id from inserted\r\n  exec sp_loglama @firmano,@id,'carikart',1,''\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "carikart_log_tru",
    "table_name": "carikart",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[carikart_log_tru] ON [dbo].[carikart]\r\nWITH EXECUTE AS CALLER\r\nFOR UPDATE\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int,@sil bit\r\n  Select @firmano=firmano,@id=id,@sil=isnull(sil,0) from inserted\r\n  if update(sil) and (@sil=1)\r\n    exec sp_loglama @firmano,@id,'carikart',-1,''\r\n  else\r\n    exec sp_loglama @firmano,@id,'carikart',0,''\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "carikart_tri",
    "table_name": "carikart",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[carikart_tri] ON [dbo].[carikart]\r\nWITH EXECUTE AS CALLER\r\nFOR INSERT\r\nAS\r\nBEGIN\r\ndeclare @kod varchar(20);\r\nDECLARE @id float;\r\ndeclare @userid int;\r\n\r\nselect @id=id,@kod=kod\r\nfrom inserted;\r\n\r\nEXEC carikartacilis 'carikart',@kod;\r\n\r\nEXEC numara_no_yaz 'carikart',@kod\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "carikart_tru",
    "table_name": "carikart",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[carikart_tru] ON [dbo].[carikart]\r\nWITH EXECUTE AS CALLER\r\nFOR UPDATE\r\nAS\r\nBEGIN\r\ndeclare @kod varchar(20);\r\nDECLARE @id float;\r\n\r\nselect @id=id,@kod=kod from inserted;\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "cariteminat_log_trd",
    "table_name": "cariteminat",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[cariteminat_log_trd] ON [dbo].[cariteminat]\r\nWITH EXECUTE AS CALLER\r\nFOR DELETE\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int,@for_log varchar(8000)\r\n  Select @for_log=' id='+cast(id as varchar(50))+' kod='+kod+' firmano='+cast(firmano as varchar(50))+' tip='+tip+' tur='+tur+' tutar='+cast(tutar as varchar(50))+' ack='+ack+' olususer='+olususer+' olustarsaat='+cast(olustarsaat as varchar(50)) from deleted\r\n  exec sp_loglama @firmano,@id,'cariteminat',-2,@for_log\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "cariteminat_log_tri",
    "table_name": "cariteminat",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[cariteminat_log_tri] ON [dbo].[cariteminat]\r\nWITH EXECUTE AS CALLER\r\nFOR INSERT\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int\r\n  Select @firmano=firmano,@id=id from inserted\r\n  exec sp_loglama @firmano,@id,'cariteminat',1,''\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "cariteminat_log_tru",
    "table_name": "cariteminat",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[cariteminat_log_tru] ON [dbo].[cariteminat]\r\nWITH EXECUTE AS CALLER\r\nFOR UPDATE\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int,@sil bit\r\n  Select @firmano=firmano,@id=id,@sil=isnull(sil,0) from inserted\r\n  if update(sil) and (@sil=1)\r\n    exec sp_loglama @firmano,@id,'cariteminat',-1,''\r\n  else\r\n    exec sp_loglama @firmano,@id,'cariteminat',0,''\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "cariteminat_trd",
    "table_name": "cariteminat",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[cariteminat_trd] ON [dbo].[cariteminat]\r\nWITH EXECUTE AS CALLER\r\nFOR DELETE\r\nAS\r\nBEGIN\r\ndeclare @kod varchar(20);\r\n\r\nselect @kod=kod from deleted;\r\n\r\nupdate carikart set toplamteminat=\r\n  (select isnull(sum(tutar),0) from cariteminat\r\n   where kod=@kod) where kod=@kod\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "cariteminat_triu",
    "table_name": "cariteminat",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[cariteminat_triu] ON [dbo].[cariteminat]\r\nWITH EXECUTE AS CALLER\r\nFOR INSERT, UPDATE\r\nAS\r\nBEGIN\r\n\r\ndeclare @kod varchar(20);\r\n\r\nselect @kod=kod from inserted;\r\n\r\nupdate carikart set toplamteminat=\r\n  (select isnull(sum(tutar),0) from cariteminat\r\n   where kod=@kod) where kod=@kod\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "cekhrk_log_trd",
    "table_name": "cekhrk",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[cekhrk_log_trd] ON [dbo].[cekhrk]\r\nWITH EXECUTE AS CALLER\r\nFOR DELETE\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int,@for_log varchar(8000)\r\n  Select @for_log=' id='+cast(id as varchar(50))+' firmano='+cast(firmano as varchar(50))+' sil='+cast(sil as varchar(50))+' cekid='+cast(cekid as varchar(50))+' drm='+drm+' drmad='+drmad+' gctip='+gctip+' yertip='+yertip+' yerad='+yerad+' tarih='+cast(tarih as varchar(50))+' saat='+saat+' tutar='+cast(tutar as varchar(50))+' ack='+ack+' olususer='+olususer+' olustarsaat='+cast(olustarsaat as varchar(50))+' dataok='+cast(dataok as varchar(50))+' cartip='+cartip+' carkod='+carkod+' belno='+belno+' gidkod='+gidkod+' gidtutar='+cast(gidtutar as varchar(50))+' parabrm='+parabrm+' tahcartip='+tahcartip+' tahcarkod='+tahcarkod from deleted\r\n  exec sp_loglama @firmano,@id,'cekhrk',-2,@for_log\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "cekhrk_log_tri",
    "table_name": "cekhrk",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[cekhrk_log_tri] ON [dbo].[cekhrk]\r\nWITH EXECUTE AS CALLER\r\nFOR INSERT\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int\r\n  Select @firmano=firmano,@id=id from inserted\r\n  exec sp_loglama @firmano,@id,'cekhrk',1,''\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "cekhrk_log_tru",
    "table_name": "cekhrk",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[cekhrk_log_tru] ON [dbo].[cekhrk]\r\nWITH EXECUTE AS CALLER\r\nFOR UPDATE\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int,@sil bit\r\n  Select @firmano=firmano,@id=id,@sil=isnull(sil,0) from inserted\r\n  if update(sil) and (@sil=1)\r\n    exec sp_loglama @firmano,@id,'cekhrk',-1,''\r\n  else\r\n    exec sp_loglama @firmano,@id,'cekhrk',0,''\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "cekhrk_tri",
    "table_name": "cekhrk",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[cekhrk_tri] ON [dbo].[cekhrk]\r\nWITH EXECUTE AS CALLER\r\nFOR INSERT\r\nAS\r\nBEGIN\r\ndeclare @cekid float\r\ndeclare @drm varchar(10),\r\n@drmad varchar(20)\r\ndeclare @cartip varchar(20),@carkod varchar(20)\r\ndeclare @vcartip varchar(20),@vcarkod varchar(20)\r\ndeclare @tar datetime,@saat varchar(8)\r\nDECLARE @tutar float\r\nDECLARE @giren float\r\nDECLARE @cikan float\r\nDECLARE @gidkod varchar (20)\r\nDECLARE @gidtutar float\r\nDECLARE @tahcartip varchar (20)\r\nDECLARE @tahcarkod varchar (20)\r\ndeclare @belno  varchar (20)\r\n\r\n/*--------------------------------- */\r\ndeclare @odemetarih datetime\r\ndeclare @cirotarih datetime\r\ndeclare @takastarih datetime\r\ndeclare @takastahsiltarih datetime\r\ndeclare @eldentahsiltarih datetime\r\ndeclare @gerialtarih datetime\r\ndeclare @iadetarih datetime\r\ndeclare @sil int\r\ndeclare @sonuc int\r\ndeclare @id float\r\ndeclare @ceksondrm varchar(10)\r\ndeclare @parabrm varchar(20)\r\n/*-------------------------------------- */\r\n\r\n\r\nselect @id=id,@cekid=cekid,@drm=drm,@drmad=drmad,@cartip=cartip,@carkod=carkod,\r\n@tar=tarih,@saat=saat,@tutar=tutar,@gidkod=gidkod,@gidtutar=gidtutar,\r\n@tahcartip=tahcartip,@tahcarkod=tahcarkod,@belno=belno,\r\n@parabrm=parabrm from inserted;\r\n\r\n\r\n\r\nexec numara_no_yaz 'makbuz',@belno\r\n\r\n\r\n/*KARSILIKSIZLAR */\r\n/*if (@drm='PID') */\r\n /* delete from carihrk where cartip not in ('gelgidkart') and  masterid=@cekid and karsihestip='cekkart' */\r\n\r\n/*\r\nif (@drm='PKR') \r\n delete from carihrk where cartip not in ('gelgidkart') and  masterid=@cekid and karsihestip='cekkart'   \r\n\r\n if @drm='CKR'\r\n  delete from carihrk where cartip not in ('gelgidkart') and masterid=@cekid and karsihestip='cekkart'\r\n\r\n if @drm='TKR'\r\n   delete from bankahrk where masterid=@cekid and karsihestip='cekkart'\r\n*/\r\n\r\n/*GERİ ALMA İŞLEMİ */\r\n /* if @drm='CGR' -- CİRODAN GERİ ALINDI PORTFOYE */\r\n  /*  delete from carihrk where masterid=@cekid */\r\n  /*   and islmtip='CEK' AND islmhrk='CIR' and karsihestip='cekkart' */\r\n\r\n/*\r\nif @drm='TGR' -- TAKASATAN GERİ ALINDI\r\n*/\r\n\r\n    /*cek odeme iptalinde */\r\n    if @drm='OTI'\r\n    begin\r\n      delete from bankahrk where  masterid=@cekid and karsihestip='cekkart'\r\n      delete from kasahrk  where  masterid=@cekid and karsihestip='cekkart'\r\n    /*delete from carihrk where cartip in ('gelgidkart') and  masterid=@cekid and karsihestip='cekkart' */\r\n    end\r\n    /*cek odeme iptalinde */\r\n\r\n   select @ceksondrm=drm,\r\n       @cirotarih=cirotar,\r\n       @takastarih=takvertar,\r\n       @takastahsiltarih=taktahtar,\r\n       @eldentahsiltarih=eltahtar,\r\n       @gerialtarih=geraltar,\r\n       @iadetarih=iadetar,\r\n       @sonuc=sonuc\r\n       from cekkart where cekid=@cekid;\r\n       \r\n\r\n/*karsılıksız iptal */\r\n      \r\n       \r\n       \r\n   set @sil=0\r\n\r\n    if (@drm='POR')\r\n    begin\r\n      set @giren=@tutar\r\n      set @cikan=0\r\n      set @sonuc=0\r\n    end;\r\n\r\n    if (@drm='CIR')\r\n    begin\r\n      set @cirotarih=@tar\r\n      set @giren=@tutar\r\n      set @cikan=@tutar\r\n      /*set @sonuc=0 */\r\n    end\r\n\r\n    if (@drm='TAK')\r\n    begin\r\n      set @giren=@tutar\r\n      set @cikan=0\r\n      set @takastarih=@tar\r\n      set @sonuc=0\r\n    end\r\n\r\n    if (@drm='TKT')\r\n    begin\r\n      set @giren=@tutar\r\n      set @cikan=0\r\n      set @takastahsiltarih=@tar\r\n      set @sonuc=1\r\n    end\r\n\r\n    if (@drm='ELT')\r\n    begin\r\n      set @giren=@tutar\r\n      set @cikan=0\r\n      set @eldentahsiltarih=@tar\r\n      set @sonuc=1\r\n    end\r\n\r\n    if (@drm='ODE')\r\n    begin\r\n      set @giren=0\r\n      set @cikan=@tutar\r\n      set @odemetarih=@tar\r\n      set @sonuc=1\r\n    end\r\n\r\n\r\n/*-ödenen çekin geri alma işlemi */\r\n    if (@drm='OTI')\r\n    begin\r\n      if (@ceksondrm='TKT') \r\n      begin/*takastan tahsil */\r\n      /*bankadan tahilat silinecek */\r\n      set @drm='TAK'\r\n      set @giren=@tutar\r\n      set @cikan=0\r\n      set @odemetarih=null\r\n      set @sonuc=0\r\n    end\r\n\r\n    if (@ceksondrm='ELT')/*ELDEN tahsil */\r\n    begin\r\n      /*kasa tahilat silinecek */\r\n      set @drm='POR'\r\n      SET @cartip=''\r\n      SET @carkod=''\r\n      set @giren=@tutar\r\n      set @cikan=0\r\n      set @eldentahsiltarih=null\r\n      set @sonuc=0\r\n    end\r\n\r\n    if (@ceksondrm='ODE')/*KESİLEN CEK ÖDEMESİ BANKADAN */\r\n    begin\r\n      /*bankadan ODEME silinecek */\r\n      set @drm='KSN'\r\n      set @giren=@tutar\r\n      set @cikan=0\r\n      set @odemetarih=null\r\n      set @sonuc=0\r\n    end\r\n\r\n   select @drmad=ad from cektip where kod=@drm\r\n end\r\n\r\n\r\n  if (@drm='PID')\r\n  begin\r\n    set @sil=0\r\n    set @giren=@tutar\r\n    set @cikan=@tutar\r\n    set @iadetarih=@tar\r\n    set @sonuc=0\r\n  end\r\n  \r\n  \r\n  if (@drm='IGR')\r\n  begin\r\n    set @giren=@tutar\r\n    set @cikan=0\r\n    SET @drm='POR'\r\n    select @drmad=ad from cektip where kod=@drm\r\n    \r\n     delete from carihrk where masterid=@cekid\r\n     and (islmtip='CEK' OR islmtip='SEN') AND islmhrk='PID' and karsihestip='cekkart'  \r\n    \r\n    set @sonuc=0\r\n    set @gerialtarih=@tar\r\n  end\r\n  \r\n  \r\n\r\n\r\n  if (@drm='TGR')\r\n  begin\r\n    set @giren=@tutar\r\n    set @cikan=0\r\n    SET @cartip=''\r\n    SET @carkod=''\r\n    SET @drm='POR'\r\n    select @drmad=ad from cektip where kod=@drm\r\n    set @sonuc=0\r\n    set @gerialtarih=@tar\r\n  end\r\n\r\n  if (@drm='CGR')\r\n  begin\r\n    set @giren=@tutar\r\n    set @cikan=0\r\n    SET @cartip=''\r\n    SET @carkod=''\r\n    SET @drm='POR'\r\n    select @drmad=ad from cektip where kod=@drm\r\n    set @gerialtarih=@tar\r\n    set @sonuc=0\r\n  end\r\n\r\n  if (@drm='KGR') /*KARISIKSIZDAN GERI ALIMI */\r\n  begin\r\n    if @ceksondrm='PKR'\r\n    begin\r\n      set @drm='POR'\r\n      SET @cartip='';\r\n      SET @carkod='';\r\n      set @giren=@tutar\r\n      set @cikan=0\r\n      /*karsilıksız yansıma iptal */\r\n     delete from carihrk where masterid=@cekid\r\n     and (islmtip='CEK' OR islmtip='SEN') AND islmhrk='PKR' and karsihestip='cekkart'      \r\n      \r\n    end\r\n    if @ceksondrm='TKR'\r\n    begin\r\n      set @drm='TAK'\r\n      set @giren=@tutar\r\n      set @cikan=0\r\n       /*karsilıksız yansıma iptal */\r\n      delete from carihrk where masterid=@cekid\r\n     and (islmtip='CEK' OR islmtip='SEN') AND islmhrk='TKR' and karsihestip='cekkart'\r\n      \r\n    end\r\n\r\n    if @ceksondrm='CKR'\r\n    begin\r\n      set @drm='CIR'\r\n      set @giren=@tutar\r\n      set @cikan=@tutar\r\n     delete from carihrk where masterid=@cekid\r\n     and (islmtip='CEK' OR islmtip='SEN') AND islmhrk='CKR' and karsihestip='cekkart'  \r\n      \r\n      \r\n    end\r\n  set @odemetarih=null\r\n  set @sonuc=0\r\n\r\n  select @drmad=ad from cektip where kod=@drm;\r\n end\r\n\r\n\r\n    if (@drm='CIR') OR (@drm='TAK')\r\n    update cekkart set giren=@giren,cikan=@cikan,drm=@drm,drmad=@drmad,\r\n    vercartip=@cartip,vercarkod=@carkod,sonuc=@sonuc,\r\n    cirotar=@cirotarih,takvertar=@takastarih,\r\n    taktahtar=@takastahsiltarih,eltahtar=@eldentahsiltarih,\r\n    geraltar=@gerialtarih,iadetar=@iadetarih,\r\n    hrkid=@id,tahcartip=@tahcartip,tahcarkod=@tahcarkod,\r\n    gidkod=@gidkod,gidtutar=@gidtutar\r\n    where cekid=@cekid\r\n\r\n    if (@drm='POR') /*cartip=@cartip,carkod=@carkod, */\r\n    update cekkart set \r\n    giren=@giren,cikan=@cikan,drm=@drm,drmad=@drmad,\r\n    vercarkod='',vercartip='',\r\n    sonuc=@sonuc,\r\n    cirotar=@cirotarih,takvertar=@takastarih,\r\n    taktahtar=@takastahsiltarih,eltahtar=@eldentahsiltarih,\r\n    geraltar=@gerialtarih,iadetar=@iadetarih,\r\n    hrkid=@id,tahcartip=@tahcartip,tahcarkod=@tahcarkod,\r\n    gidkod=@gidkod,gidtutar=@gidtutar\r\n    where cekid=@cekid\r\n\r\n    if (@drm='PID')\r\n    update cekkart set drm=@drm,drmad=@drmad,\r\n    cikan=@cikan,iadetar=@iadetarih,hrkid=@id\r\n    where cekid=@cekid\r\n\r\n\r\n    if not ((@drm='CIR') OR (@drm='TAK') or (@drm='POR') or (@drm='PID') )\r\n    update cekkart set drm=@drm,drmad=@drmad,sil=@sil,\r\n    cirotar=@cirotarih,takvertar=@takastarih,sonuc=@sonuc,\r\n    taktahtar=@takastahsiltarih,eltahtar=@eldentahsiltarih,\r\n    geraltar=@gerialtarih,iadetar=@iadetarih,\r\n    odetar=@odemetarih,hrkid=@id,\r\n    tahcartip=@tahcartip,tahcarkod=@tahcarkod,\r\n    gidkod=@gidkod,gidtutar=@gidtutar where cekid=@cekid\r\n\r\n\r\n\r\n    EXEC cekhrkgiris @cekid\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "cekkart_log_trd",
    "table_name": "cekkart",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[cekkart_log_trd] ON [dbo].[cekkart]\r\nWITH EXECUTE AS CALLER\r\nFOR DELETE\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int,@for_log varchar(8000)\r\n  Select @for_log=' id='+cast(id as varchar(50))+' islmtip='+islmtip+' firmano='+cast(firmano as varchar(50))+' cekid='+cast(cekid as varchar(50))+' sil='+cast(sil as varchar(50))+' varno='+cast(varno as varchar(50))+' varok='+cast(varok as varchar(50))+' firmano='+cast(firmano as varchar(50))+' cartip='+cartip+' carkod='+carkod+' vercartip='+vercartip+' vercarkod='+vercarkod+' gctip='+gctip+' yertip='+yertip+' yerad='+yerad+' drm='+drm+' drmad='+drmad+' islmtipad='+islmtipad+' islmhrk='+islmhrk+' cikan='+cast(cikan as varchar(50))+' giren='+cast(giren as varchar(50))+' islmhrkad='+islmhrkad+' ceksenno='+ceksenno+' tarih='+cast(tarih as varchar(50))+' saat='+saat+' banka='+banka+' banksub='+banksub+' hesepno='+hesepno+' refno='+refno+' kesideci='+kesideci+' parabrm='+parabrm+' ack='+ack+' vadetar='+cast(vadetar as varchar(50))+' odetar='+cast(odetar as varchar(50))+' olususer='+olususer+' olustarsaat='+cast(olustarsaat as varchar(50))+' deguser='+deguser+' degtarsaat='+cast(degtarsaat as varchar(50))+' dataok='+cast(dataok as varchar(50))+' masterid='+cast(masterid as varchar(50))+' perkod='+perkod+' adaid='+cast(adaid as varchar(50))+' kur='+cast(kur as varchar(50))+' takvertar='+cast(takvertar as varchar(50))+' cirotar='+cast(cirotar as varchar(50))+' taktahtar='+cast(taktahtar as varchar(50))+' eltahtar='+cast(eltahtar as varchar(50))+' sonuc='+cast(sonuc as varchar(50))+' geraltar='+cast(geraltar as varchar(50))+' iadetar='+cast(iadetar as varchar(50))+' pro='+cast(pro as varchar(50))+' fisfattip='+fisfattip+' fisfatid='+cast(fisfatid as varchar(50))+' hrkid='+cast(hrkid as varchar(50))+' belno='+belno+' gidkod='+gidkod+' gidtutar='+cast(gidtutar as varchar(50))+' tahcartip='+tahcartip+' tahcarkod='+tahcarkod+' fisid='+cast(fisid as varchar(50)) from deleted\r\n  exec sp_loglama @firmano,@id,'cekkart',-2,@for_log\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "cekkart_log_tri",
    "table_name": "cekkart",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[cekkart_log_tri] ON [dbo].[cekkart]\r\nWITH EXECUTE AS CALLER\r\nFOR INSERT\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int\r\n  Select @firmano=firmano,@id=id from inserted\r\n  exec sp_loglama @firmano,@id,'cekkart',1,''\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "cekkart_log_tru",
    "table_name": "cekkart",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[cekkart_log_tru] ON [dbo].[cekkart]\r\nWITH EXECUTE AS CALLER\r\nFOR UPDATE\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int,@sil bit\r\n  Select @firmano=firmano,@id=id,@sil=isnull(sil,0) from inserted\r\n  if update(sil) and (@sil=1)\r\n    exec sp_loglama @firmano,@id,'cekkart',-1,''\r\n  else\r\n    exec sp_loglama @firmano,@id,'cekkart',0,''\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "cekkart_trd",
    "table_name": "cekkart",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[cekkart_trd] ON [dbo].[cekkart]\r\nWITH EXECUTE AS CALLER\r\nFOR DELETE\r\nAS\r\nBEGIN\r\ndeclare @cekid \t\tfloat\r\ndeclare @id \t\tfloat\r\ndeclare @tahodeid \tfloat\r\n\r\nSET NOCOUNT ON\r\n\r\n DECLARE cekdel CURSOR LOCAL FOR SELECT id,cekid,tahodeid from deleted\r\n OPEN cekdel\r\n  FETCH NEXT FROM cekdel INTO  @id,@cekid,@tahodeid\r\n  WHILE @@FETCH_STATUS =0\r\n  BEGIN\r\n  delete from cekhrk where cekid=@cekid\r\n  \r\n  delete from bankahrk where masterid=@cekid and karsihestip='cekkart'\r\n  delete from carihrk where  masterid=@cekid  and karsihestip='cekkart'\r\n\r\n  delete from kasahrk where  masterid=@cekid  and karsihestip='cekkart'\r\n\r\n  delete from TahsilatOdeme where id=@tahodeid\r\n\r\n\r\n  FETCH NEXT FROM cekdel INTO  @id,@cekid,@tahodeid\r\n  END\r\n CLOSE cekdel\r\n DEALLOCATE cekdel\r\n  \r\n SET NOCOUNT OFF\r\n  \r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "cekkart_tri",
    "table_name": "cekkart",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[cekkart_tri] ON [dbo].[cekkart]\r\nWITH EXECUTE AS CALLER\r\nFOR INSERT\r\nAS\r\nBEGIN\r\ndeclare @cekid float\r\ndeclare @hrk varchar(10),@drm varchar(10),@drmad varchar(20)\r\ndeclare @cartur varchar(30),@cartip varchar(20),@carkod varchar(20)\r\ndeclare @tar datetime,@saat varchar(8)\r\ndeclare @varno float,@pro int\r\ndeclare @yertip varchar(50)\r\n\r\nselect @cekid=cekid,@varno=varno,@pro=pro,@yertip=yertip from inserted\r\n\r\n if @yertip='pomvardimas' \r\n   update pomvardimas set cektop=isnull(dt.tutar,0) from pomvardimas as t \r\n    join (select \r\n    sum(case when sil=0 then abs(giren-cikan)*kur else 0 end)  as tutar from cekkart \r\n    where varno=@varno and yertip=@yertip and cartip='vardicek') dt \r\n    on t.varno=@varno\r\n\r\n\r\n\r\n/*exec cekhrkgiris @cekid */\r\n\r\ninsert into cekhrk (firmano,cekid,gctip,yertip,yerad,tarih,saat,ack,\r\nolususer,olustarsaat,drm,drmad,tutar,cartip_id,cartip,car_id,carkod)\r\n(select firmano,cekid,gctip,yertip,yerad,tarih,saat,ack,\r\nolususer,olustarsaat,drm,drmad,abs(giren-cikan),\r\ncase when gctip='C' then vercartip_id else cartip_id end,\r\ncase when gctip='C' then vercartip else cartip end,\r\ncase when gctip='C' then vercar_id else car_id end,\r\ncase when gctip='C' then vercarkod else carkod end\r\n from cekkart as m\r\nwhere cekid=@cekid)\r\n\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "cekkart_tru",
    "table_name": "cekkart",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[cekkart_tru] ON [dbo].[cekkart]\r\nWITH EXECUTE AS CALLER\r\nFOR UPDATE\r\nAS\r\nBEGIN\r\ndeclare @cekid \t\tfloat\r\ndeclare @hrk \t\tvarchar(10)\r\ndeclare @drm \t\tvarchar(10)\r\ndeclare @drmad \t\tvarchar(20)\r\ndeclare @cartur \tvarchar(30)\r\ndeclare @cartip \tvarchar(20)\r\ndeclare @carkod \tvarchar(20)\r\ndeclare @tar \t\tdatetime\r\ndeclare @saat \t\tvarchar(8)\r\ndeclare @varno \t\tfloat\r\ndeclare @sil \t\tint\r\ndeclare @yertip \tvarchar(50)\r\ndeclare @tahodeid \tfloat\r\n\r\n\r\nselect @cekid=cekid,@varno=varno,@sil=sil,@yertip=yertip,\r\n@tahodeid=tahodeid from inserted\r\n\r\n\r\n if update(varok)\r\n  return\r\n \r\n \r\n \r\n  /*Vardiyada alınan cek olucak sadece  */\r\n  if @yertip='pomvardimas' \r\n   update pomvardimas set cektop=isnull(dt.tutar,0) from pomvardimas as t \r\n    join (select \r\n    sum(case when sil=0 then abs(giren)*kur else 0 end)  as tutar from cekkart \r\n    where varno=@varno and yertip=@yertip and cartip='vardicek') dt \r\n    on t.varno=@varno\r\n \r\n \r\n\r\n\r\nif update(sil) and (@sil=1)\r\nbegin\r\n  delete from cekhrk where cekid=@cekid\r\n  delete from bankahrk where masterid=@cekid and karsihestip='cekkart'\r\n  delete from carihrk where  masterid=@cekid  and karsihestip='cekkart'\r\n  delete from kasahrk where  masterid=@cekid  and karsihestip='cekkart'\r\n  \r\n  delete from TahsilatOdeme where id=@tahodeid\r\nend\r\n\r\nif not update(drm) and (@sil=0)\r\n begin\r\n     insert into cekhrk (firmano,cekid,gctip,yertip,yerad,tarih,saat,ack,\r\n     olususer,olustarsaat,drm,drmad,aktif,\r\n     tutar,cartip_id,cartip,car_id,carkod)\r\n     (select m.firmano,cekid,gctip,yertip,yerad,tarih,saat,ack,\r\n     deguser,degtarsaat,drm,drmad,\r\n     case when (drm='POR') OR (drm='KSN') then 1 else 0 end,\r\n     case when (giren)>0 then abs(giren) else abs(cikan) end,\r\n     case when gctip='C' then vercartip_id else cartip_id end,\r\n     case when gctip='C' then vercartip else cartip end,\r\n     case when gctip='C' then vercar_id else car_id end,\r\n     case when gctip='C' then vercarkod else carkod end\r\n     from cekkart as m where cekid=@cekid)\r\n end\r\n\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "depokart_log_trd",
    "table_name": "depokart",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[depokart_log_trd] ON [dbo].[depokart]\r\nWITH EXECUTE AS CALLER\r\nFOR DELETE\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int,@for_log varchar(8000)\r\n  Select @for_log=' id='+cast(id as varchar(50))+' kod='+kod+' firmano='+cast(firmano as varchar(50))+' dataok='+cast(dataok as varchar(50))+' deptip='+deptip+' ad='+ad+' perkod='+perkod+' drm='+drm+' olususer='+olususer+' olustarsaat='+cast(olustarsaat as varchar(50))+' deguser='+deguser+' degtarsaat='+cast(degtarsaat as varchar(50))+' sil='+cast(sil as varchar(50)) from deleted\r\n  exec sp_loglama @firmano,@id,'depokart',-2,@for_log\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "depokart_log_tri",
    "table_name": "depokart",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[depokart_log_tri] ON [dbo].[depokart]\r\nWITH EXECUTE AS CALLER\r\nFOR INSERT\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int\r\n  Select @firmano=firmano,@id=id from inserted\r\n  exec sp_loglama @firmano,@id,'depokart',1,''\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "depokart_log_tru",
    "table_name": "depokart",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[depokart_log_tru] ON [dbo].[depokart]\r\nWITH EXECUTE AS CALLER\r\nFOR UPDATE\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int,@sil bit\r\n  Select @firmano=firmano,@id=id,@sil=isnull(sil,0) from inserted\r\n  if update(sil) and (@sil=1)\r\n    exec sp_loglama @firmano,@id,'depokart',-1,''\r\n  else\r\n    exec sp_loglama @firmano,@id,'depokart',0,''\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "depokart_tri",
    "table_name": "depokart",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[depokart_tri] ON [dbo].[depokart]\r\nWITH EXECUTE AS CALLER\r\nFOR INSERT\r\nAS\r\nBEGIN\r\ndeclare @kod      varchar(20)\r\ndeclare @id       FLOAT\r\n\r\nselect @id=id,@kod=kod from inserted;\r\n\r\nEXEC numara_no_yaz 'mardepkart',@kod\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "depokart_tru",
    "table_name": "depokart",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[depokart_tru] ON [dbo].[depokart]\r\nWITH EXECUTE AS CALLER\r\nFOR UPDATE\r\nAS\r\nBEGIN\r\ndeclare @kod varchar(20);\r\nDECLARE @id float;\r\n\r\nselect @id=id,@kod=kod from inserted;\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "emtiasat_log_trd",
    "table_name": "emtiasat",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[emtiasat_log_trd] ON [dbo].[emtiasat]\r\nWITH EXECUTE AS CALLER\r\nFOR DELETE\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int,@for_log varchar(8000)\r\n  Select @for_log=' id='+cast(id as varchar(50))+' emtid='+cast(emtid as varchar(50))+' firmano='+cast(firmano as varchar(50))+' tarih='+cast(tarih as varchar(50))+' varno='+cast(varno as varchar(50))+' saat='+saat+' perkod='+perkod+' adaid='+cast(adaid as varchar(50))+' stktip='+stktip+' islmtip='+islmtip+' islmtipad='+islmtipad+' yertip='+yertip+' yerad='+yerad+' depkod='+depkod+' stktipad='+stktipad+' stkod='+stkod+' mik='+cast(mik as varchar(50))+' brmfiy='+cast(brmfiy as varchar(50))+' tutar='+cast(tutar as varchar(50))+' olususer='+olususer+' olustarsaat='+cast(olustarsaat as varchar(50))+' deguser='+deguser+' kdvyuz='+cast(kdvyuz as varchar(50))+' varok='+cast(varok as varchar(50))+' sil='+cast(sil as varchar(50))+' degtarsaat='+cast(degtarsaat as varchar(50))+' dataok='+cast(dataok as varchar(50)) from deleted\r\n  exec sp_loglama @firmano,@id,'emtiasat',-2,@for_log\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "emtiasat_log_tri",
    "table_name": "emtiasat",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[emtiasat_log_tri] ON [dbo].[emtiasat]\r\nWITH EXECUTE AS CALLER\r\nFOR INSERT\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int\r\n  Select @firmano=firmano,@id=id from inserted\r\n  exec sp_loglama @firmano,@id,'emtiasat',1,''\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "emtiasat_log_tru",
    "table_name": "emtiasat",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[emtiasat_log_tru] ON [dbo].[emtiasat]\r\nWITH EXECUTE AS CALLER\r\nFOR UPDATE\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int,@sil bit\r\n  Select @firmano=firmano,@id=id,@sil=isnull(sil,0) from inserted\r\n  if update(sil) and (@sil=1)\r\n    exec sp_loglama @firmano,@id,'emtiasat',-1,''\r\n  else\r\n    exec sp_loglama @firmano,@id,'emtiasat',0,''\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "emtiasat_trd",
    "table_name": "emtiasat",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[emtiasat_trd] ON [dbo].[emtiasat]\r\nWITH EXECUTE AS CALLER\r\nFOR DELETE\r\nAS\r\nBEGIN\r\ndeclare @varno float\r\ndeclare @malsat float\r\ndeclare @id float\r\n\r\nSET NOCOUNT ON\r\nselect @id=id,@varno=varno from deleted;\r\n\r\nselect @malsat=sum(tutar) from emtiasat where varno=@varno and sil=0;\r\n\r\nif @malsat is NULL\r\nset @malsat=0;\r\n\r\nexec stokhrkisle @id,'emtiasat','',1,1,@id\r\n\r\nupdate pomvardimas set malsattop=@malsat where varno=@varno\r\nSET NOCOUNT OFF\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "emtiasat_tri",
    "table_name": "emtiasat",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[emtiasat_tri] ON [dbo].[emtiasat]\r\nWITH EXECUTE AS CALLER\r\nFOR INSERT\r\nAS\r\nBEGIN\r\ndeclare @varno float\r\ndeclare @varok float\r\ndeclare @malsat float\r\ndeclare @id float\r\ndeclare @emtid float\r\ndeclare @sil int\r\n\r\n  select @sil=sil,@id=id,@emtid=emtid,@varno=varno,@varok=varok from inserted\r\n\r\n  if isnull(@emtid,0)=0\r\n   return\r\n  \r\n   exec stokhrkisle @id,'emtiasat','',1,@sil,@id\r\n\r\n  update pomvardimas set malsattop=(select isnull(sum(tutar),0) from emtiasat\r\n   where varno=@varno and sil=0) where varno=@varno\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "emtiasat_tru",
    "table_name": "emtiasat",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[emtiasat_tru] ON [dbo].[emtiasat]\r\nWITH EXECUTE AS CALLER\r\nFOR UPDATE\r\nAS\r\nBEGIN\r\ndeclare @varno float\r\ndeclare @varok float\r\ndeclare @malsat float\r\ndeclare @id float\r\ndeclare @sil int\r\n\r\n\r\n if UPDATE(varok)\r\n   RETURN\r\n\r\n DECLARE Var_Emtia_Sat_Cur\r\n  CURSOR FOR SELECT id,sil,varno,varok\r\n FROM inserted\r\n OPEN Var_Emtia_Sat_Cur\r\n FETCH NEXT FROM Var_Emtia_Sat_Cur \r\n   INTO  @id,@sil,@varno,@varok\r\n WHILE @@FETCH_STATUS = 0\r\n BEGIN\r\n\r\n   exec stokhrkisle @id,'emtiasat','',1,@sil,@id\r\n\r\n  update pomvardimas set malsattop=(select isnull(sum(tutar),0) from emtiasat\r\n    where varno=@varno and sil=0) where varno=@varno \r\n    \r\n    \r\n  FETCH NEXT FROM Var_Emtia_Sat_Cur INTO  @id,@sil,@varno,@varok\r\n\r\nEND\r\nCLOSE Var_Emtia_Sat_Cur\r\nDEALLOCATE Var_Emtia_Sat_Cur\r\n\r\n \r\n    \r\n    \r\n    \r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "faturahrk_log_trd",
    "table_name": "faturahrk",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[faturahrk_log_trd] ON [dbo].[faturahrk]\r\nWITH EXECUTE AS CALLER\r\nFOR DELETE\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int,@for_log varchar(8000)\r\n  Select @for_log=' id='+cast(id as varchar(50))+' fatid='+cast(fatid as varchar(50))+' sil='+cast(sil as varchar(50))+' firmano='+cast(firmano as varchar(50))+' stktip='+stktip+' stkod='+stkod+' mik='+cast(mik as varchar(50))+' brmfiy='+cast(brmfiy as varchar(50))+' depkod='+depkod+' kdvyuz='+cast(kdvyuz as varchar(50))+' kdvtut='+cast(kdvtut as varchar(50))+' kdvtip='+kdvtip+' brim='+brim+' olususer='+olususer+' olustarsaat='+cast(olustarsaat as varchar(50))+' deguser='+deguser+' degtarsaat='+cast(degtarsaat as varchar(50))+' satiskyuz='+cast(satiskyuz as varchar(50))+' satisktut='+cast(satisktut as varchar(50))+' otvyuz='+cast(otvyuz as varchar(50))+' otvtut='+cast(otvtut as varchar(50))+' genisktut='+cast(genisktut as varchar(50))+' geniskyuz='+cast(geniskyuz as varchar(50))+' ustbrim='+ustbrim+' carpan='+cast(carpan as varchar(50))+' parabrim='+parabrim+' kur='+cast(kur as varchar(50))+' dataok='+cast(dataok as varchar(50))+' otvbrim='+cast(otvbrim as varchar(50))+' grupid='+cast(grupid as varchar(50))+' kayok='+cast(kayok as varchar(50))+' kaphrkid='+cast(kaphrkid as varchar(50))+' kaptip='+kaptip+' giderbrmtut='+cast(giderbrmtut as varchar(50)) from deleted\r\n  exec sp_loglama @firmano,@id,'faturahrk',-2,@for_log\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "faturahrk_log_tri",
    "table_name": "faturahrk",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[faturahrk_log_tri] ON [dbo].[faturahrk]\r\nWITH EXECUTE AS CALLER\r\nFOR INSERT\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int\r\n  Select @firmano=firmano,@id=id from inserted\r\n  exec sp_loglama @firmano,@id,'faturahrk',1,''\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "faturahrk_log_tru",
    "table_name": "faturahrk",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[faturahrk_log_tru] ON [dbo].[faturahrk]\r\nWITH EXECUTE AS CALLER\r\nFOR UPDATE\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int,@sil bit\r\n  Select @firmano=firmano,@id=id,@sil=isnull(sil,0) from inserted\r\n  if update(sil) and (@sil=1)\r\n    exec sp_loglama @firmano,@id,'faturahrk',-1,''\r\n  else\r\n    exec sp_loglama @firmano,@id,'faturahrk',0,''\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "faturahrk_trd",
    "table_name": "faturahrk",
    "is_disabled": true,
    "definition": "CREATE TRIGGER [dbo].[faturahrk_trd] ON [dbo].[faturahrk]\r\nWITH EXECUTE AS CALLER\r\nFOR DELETE\r\nAS\r\nBEGIN\r\ndeclare @id float,@fatid float;\r\ndeclare @kdvtop float,@otvtop float,@iskyuz float,\r\n@isktop float,@fattop float;\r\ndeclare @kayok int,@sil int;\r\ndeclare @stktip varchar(10)\r\ndeclare @MESAJ varchar(50)\r\n\r\n select @id=id,@kayok=kayok,@fatid=fatid from deleted;\r\n\r\n\r\n DECLARE faturahrkdel CURSOR LOCAL FOR SELECT id,kayok,sil,stktip FROM deleted\r\n OPEN faturahrkdel\r\n FETCH NEXT FROM faturahrkdel INTO  @id,@kayok,@sil,@stktip\r\n WHILE @@FETCH_STATUS = 0\r\n BEGIN\r\n\r\n if @stktip='gelgid'\r\n delete from carihrk where fatstkhrkid=@id\r\n else\r\n delete from stkhrk where tabload='faturahrk' and stkhrkid=@id\r\n \r\n FETCH NEXT FROM faturahrkdel INTO @id,@kayok,@sil,@stktip\r\n END\r\n CLOSE faturahrkdel\r\n DEALLOCATE faturahrkdel\r\n\r\n\r\n  exec faturahrkgiris @fatid,@kayok,1\r\n\r\n/* if isnull((select count(*) from faturahrk where fatid=@fatid and sil=0),0)=0 */\r\n/* delete from faturamas where fatid=@fatid */\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "faturahrk_tri",
    "table_name": "faturahrk",
    "is_disabled": true,
    "definition": "CREATE TRIGGER [dbo].[faturahrk_tri] ON [dbo].[faturahrk]\r\nWITH EXECUTE AS CALLER\r\nFOR INSERT, UPDATE\r\nAS\r\nBEGIN\r\ndeclare @fatid float,@id float;\r\ndeclare @kdvtop float,@otvtop float,@iskyuz float,\r\n@isktop float,@fattop float,@kayok int,@sil int\r\ndeclare @hrk_stk_pro bit\r\n\r\n select @id=id,@fatid=fatid,@kayok=kayok,@sil=sil from inserted;\r\n\r\n\r\n  if update(mik)\r\n   exec faturahrkgiris @fatid,@kayok,@sil\r\n\r\n if (update(kayok) or (@sil=1)) and @kayok=1\r\n begin\r\n \r\n DECLARE faturahrkgun CURSOR LOCAL FOR SELECT id,kayok,sil,hrk_stk_pro FROM inserted\r\n OPEN faturahrkgun\r\n FETCH NEXT FROM faturahrkgun INTO  @id,@kayok,@sil,@hrk_stk_pro\r\n WHILE @@FETCH_STATUS = 0\r\n BEGIN\r\n\r\n   if @hrk_stk_pro=0\r\n   exec stokhrkisle @id,'faturahrk','',@kayok,1\r\n   if @hrk_stk_pro=1\r\n   exec stokhrkisle @id,'faturahrk','',@kayok,@sil\r\n\r\n FETCH NEXT FROM faturahrkgun INTO @id,@kayok,@sil,@hrk_stk_pro\r\n END\r\n CLOSE faturahrkgun\r\n DEALLOCATE faturahrkgun\r\n end\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "faturamas_log_trd",
    "table_name": "faturamas",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[faturamas_log_trd] ON [dbo].[faturamas]\r\nWITH EXECUTE AS CALLER\r\nFOR DELETE\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int,@for_log varchar(8000)\r\n  Select @for_log=' id='+cast(id as varchar(50))+' fatid='+cast(fatid as varchar(50))+' firmano='+cast(firmano as varchar(50))+' tarih='+cast(tarih as varchar(50))+' saat='+saat+' fatad='+fatad+' fattip='+fattip+' fattur='+fattur+' fatturad='+fatturad+' fatseri='+fatseri+' fatno='+fatno+' cartip='+cartip+' carkod='+carkod+' olususer='+olususer+' olustarsaat='+cast(olustarsaat as varchar(50))+' deguser='+deguser+' degtarsaat='+cast(degtarsaat as varchar(50))+' ack='+ack+' geniskyuz='+cast(geniskyuz as varchar(50))+' genisktop='+cast(genisktop as varchar(50))+' satisktop='+cast(satisktop as varchar(50))+' kdvtop='+cast(kdvtop as varchar(50))+' yuvtop='+cast(yuvtop as varchar(50))+' gidertop='+cast(gidertop as varchar(50))+' giderkdvtop='+cast(giderkdvtop as varchar(50))+' fattop='+cast(fattop as varchar(50))+' otvtop='+cast(otvtop as varchar(50))+' kdvtip='+kdvtip+' vadtar='+cast(vadtar as varchar(50))+' depo='+depo+' sil='+cast(sil as varchar(50))+' dataok='+cast(dataok as varchar(50))+' irsaliyeirid='+cast(irsaliyeirid as varchar(50))+' siparissipid='+cast(siparissipid as varchar(50))+' kayok='+cast(kayok as varchar(50))+' kur='+cast(kur as varchar(50))+' parabrm='+parabrm+' kaptip='+kaptip+' kapidler='+kapidler+' odemetop='+cast(odemetop as varchar(50))+' marsatid='+cast(marsatid as varchar(50))+' yazildi='+cast(yazildi as varchar(50)) from deleted\r\n  exec sp_loglama @firmano,@id,'faturamas',-2,@for_log\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "faturamas_log_tri",
    "table_name": "faturamas",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[faturamas_log_tri] ON [dbo].[faturamas]\r\nWITH EXECUTE AS CALLER\r\nFOR INSERT\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int\r\n  Select @firmano=firmano,@id=id from inserted\r\n  exec sp_loglama @firmano,@id,'faturamas',1,''\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "faturamas_log_tru",
    "table_name": "faturamas",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[faturamas_log_tru] ON [dbo].[faturamas]\r\nWITH EXECUTE AS CALLER\r\nFOR UPDATE\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int,@sil bit\r\n  Select @firmano=firmano,@id=id,@sil=isnull(sil,0) from inserted\r\n  if update(sil) and (@sil=1)\r\n    exec sp_loglama @firmano,@id,'faturamas',-1,''\r\n  else\r\n    exec sp_loglama @firmano,@id,'faturamas',0,''\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "faturamas_trd",
    "table_name": "faturamas",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[faturamas_trd] ON [dbo].[faturamas]\r\nWITH EXECUTE AS CALLER\r\nFOR DELETE\r\nAS\r\nBEGIN\r\ndeclare @id float,@fatid float\r\n\r\nSET NOCOUNT ON\r\n\r\n\r\n DECLARE faturadel CURSOR LOCAL FOR SELECT id,fatid from deleted\r\n OPEN faturadel\r\n  FETCH NEXT FROM faturadel INTO  @id,@fatid\r\n  WHILE @@FETCH_STATUS = 0\r\n  BEGIN\r\n\r\n   if @fatid=0 \r\n    RETURN\r\n    \r\n    \r\n     exec Fat_Dep_Transfer @fatid,1\r\n\r\n   \r\n\r\n\r\n   /* fatura geri al için bekletiyoruz kayıtları */\r\n  if isnull((select count(*) from faturahrk where fatid=@fatid and sil=0),0)=0\r\n  begin\r\n   \r\n\r\n  delete from kasahrk where fisfattip='FAT' and fisfatid=@fatid;\r\n  delete from poshrk where fisfattip='FAT' and fisfatid=@fatid;\r\n  delete from cekkart where fisfattip='FAT' and fisfatid=@fatid;\r\n  delete from bankahrk where fisfattip='FAT' and fisfatid=@fatid;\r\n  delete from carihrk where masterid=@fatid\r\n  AND SUBSTRING(islmhrk,1,3)='FAT'\r\n  \r\n  \r\n   exec stokhrkisle @fatid,'faturahrk','',1,1,@fatid\r\n  \r\n   /* fatura iskonto yansimasi */\r\n  delete carihrk where fatid=@fatid and islmtip='GLG' and islmhrk='FTI'\r\n      \r\n  delete from carihrk where fisfattip='FAT' and fatid=@fatid\r\n\r\n\r\n  exec verfisisle_sil @fatid\r\n  exec irsaliyeisle_sil @fatid\r\n  \r\n  exec SpFaturaFisIkontoKontrol @fatid,1\r\n  \r\n  delete from faturahrk where fatid=@fatid\r\n  \r\n  if @fatid>0\r\n    update TahsilatOdeme set Sil=1 where Fatid=@fatid\r\n  \r\n   \r\n\r\n  end\r\n\r\n   FETCH NEXT FROM faturadel INTO  @id,@fatid\r\n  END\r\n  \r\n CLOSE faturadel\r\n DEALLOCATE faturadel\r\n\r\n\r\n SET NOCOUNT OFF\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "faturamas_tru",
    "table_name": "faturamas",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[faturamas_tru] ON [dbo].[faturamas]\r\nWITH EXECUTE AS CALLER\r\nFOR UPDATE\r\nAS\r\nBEGIN\r\ndeclare @fatid float\r\ndeclare @isklutop float\r\ndeclare @geniskorn float\r\ndeclare @kayok int,@sil int\r\n\r\nSET NOCOUNT ON\r\n\r\n select @kayok=kayok,@sil=sil,@fatid=fatid from inserted\r\n\r\n if @fatid=0 \r\n  RETURN\r\n  \r\n\r\n /*if update(entegre_tip) and  */\r\n /* (not UPDATE(genisktop))   */\r\n   /* RETURN */\r\n\r\n /*if update(genisktop) or UPDATE(ak_isk_top)  */\r\n/* or UPDATE(mr_isk_top) or UPDATE(gg_isk_top)  */\r\n  /*exec faturahrkgiris @fatid,@kayok,@sil */\r\n\r\nif update(kayok) or  update(sil)\r\n begin\r\n \r\n update faturahrk set sil=@sil where fatid=@fatid and sil=0\r\n\r\n if @sil=1\r\n begin\r\n      exec stokhrkisle @fatid,'faturahrk','',@kayok,@sil,@fatid \r\n      update kasahrk set sil=1 where fisfattip='FAT' and fisfatid=@fatid\r\n      update poshrk set sil=1  where fisfattip='FAT' and fisfatid=@fatid\r\n      update cekkart set sil=1 where fisfattip='FAT' and fisfatid=@fatid\r\n      update bankahrk set sil=1 where fisfattip='FAT' and fisfatid=@fatid\r\n\r\n      update carihrk set sil=1 where masterid=@fatid\r\n      and SUBSTRING(islmhrk,1,3)='FAT'\r\n\r\n    /* fatura iskonto yansimasi */\r\n      update carihrk set sil=1 where fatid=@fatid\r\n      and islmtip='GLG' and islmhrk='FTI'\r\n\r\n\r\n      update carihrk set sil=1 where fisfattip='FAT' \r\n      and fatid=@fatid\r\n\r\n       exec SpFaturaFisIkontoKontrol @fatid,@sil\r\n\r\n\r\n      exec  verfisisle_sil @fatid\r\n      exec  irsaliyeisle_sil @fatid\r\n      \r\n      exec Fat_Dep_Transfer @fatid,@sil\r\n      \r\n     \r\n      \r\n      if @fatid>0\r\n       update TahsilatOdeme set Sil=@Sil where Fatid=@fatid\r\n      \r\n  end\r\n\r\n  if @kayok=1\r\n   begin\r\n         /*update faturahrk set kayok=@kayok where fatid=@fatid  */\r\n \r\n \r\n         exec faturahrkgiris @fatid,@kayok,@sil\r\n         exec stokhrkisle    @fatid,'faturahrk','',@kayok,@sil,@fatid\r\n         \r\n         exec Fat_Dep_Transfer @fatid,@sil\r\n         \r\n         exec faturagiris @fatid\r\n         exec siparisisle @fatid\r\n         exec verfisisle @fatid\r\n         exec irsaliyeisle @fatid\r\n         \r\n         exec SpFaturaFisIkontoKontrol @fatid,@sil\r\n         \r\n    end\r\n\r\nend\r\n  SET NOCOUNT OFF\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "fismas_log_trd",
    "table_name": "fismas",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[fismas_log_trd] ON [dbo].[fismas]\r\nWITH EXECUTE AS CALLER\r\nFOR DELETE\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int,@for_log varchar(8000)\r\n  Select @for_log=' id='+cast(id as varchar(50))+' fisid='+cast(fisid as varchar(50))+' fisno='+fisno+' tarih='+cast(tarih as varchar(50))+' saat='+saat+' cartip='+cartip+' carkod='+carkod+' olususer='+olususer+' olustarsaat='+cast(olustarsaat as varchar(50))+' deguser='+deguser+' degtarsaat='+cast(degtarsaat as varchar(50))+' toptut='+cast(toptut as varchar(50))+' yertip='+yertip+' ack='+ack from deleted\r\n  exec sp_loglama @firmano,@id,'fismas',-2,@for_log\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "fismas_log_tri",
    "table_name": "fismas",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[fismas_log_tri] ON [dbo].[fismas]\r\nWITH EXECUTE AS CALLER\r\nFOR INSERT\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int\r\n  Select @firmano=firmano,@id=id from inserted\r\n  exec sp_loglama @firmano,@id,'fismas',1,''\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "fismas_log_tru",
    "table_name": "fismas",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[fismas_log_tru] ON [dbo].[fismas]\r\nWITH EXECUTE AS CALLER\r\nFOR UPDATE\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int,@sil bit\r\n  Select @firmano=firmano,@id=id,@sil=isnull(sil,0) from inserted\r\n  if update(sil) and (@sil=1)\r\n    exec sp_loglama @firmano,@id,'fismas',-1,''\r\n  else\r\n    exec sp_loglama @firmano,@id,'fismas',0,''\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "gelgidkart_log_trd",
    "table_name": "gelgidkart",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[gelgidkart_log_trd] ON [dbo].[gelgidkart]\r\nWITH EXECUTE AS CALLER\r\nFOR DELETE\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int,@for_log varchar(8000)\r\n  Select @for_log=' id='+cast(id as varchar(50))+' firmano='+cast(firmano as varchar(50))+' sil='+cast(sil as varchar(50))+' kod='+kod+' ad='+ad+' drm='+drm+' grp1='+cast(grp1 as varchar(50))+' grp2='+cast(grp2 as varchar(50))+' grp3='+cast(grp3 as varchar(50))+' fisbak='+cast(fisbak as varchar(50))+' carbak='+cast(carbak as varchar(50))+' muhkod='+muhkod+' olususer='+olususer+' olustarsaat='+cast(olustarsaat as varchar(50))+' deguser='+deguser+' degtarsaat='+cast(degtarsaat as varchar(50))+' dataok='+cast(dataok as varchar(50))+' fiyat='+cast(fiyat as varchar(50))+' toplim='+cast(toplim as varchar(50))+' kdvtip='+kdvtip+' kdv='+cast(kdv as varchar(50))+' brim='+brim+' parabrm='+parabrm+' fisaktut='+cast(fisaktut as varchar(50))+' fisadet='+cast(fisadet as varchar(50))+' fisakadet='+cast(fisakadet as varchar(50))+' actutar='+cast(actutar as varchar(50))+' gizli='+cast(gizli as varchar(50)) from deleted\r\n  exec sp_loglama @firmano,@id,'gelgidkart',-2,@for_log\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "gelgidkart_log_tri",
    "table_name": "gelgidkart",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[gelgidkart_log_tri] ON [dbo].[gelgidkart]\r\nWITH EXECUTE AS CALLER\r\nFOR INSERT\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int\r\n  Select @firmano=firmano,@id=id from inserted\r\n  exec sp_loglama @firmano,@id,'gelgidkart',1,''\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "gelgidkart_log_tru",
    "table_name": "gelgidkart",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[gelgidkart_log_tru] ON [dbo].[gelgidkart]\r\nWITH EXECUTE AS CALLER\r\nFOR UPDATE\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int,@sil bit\r\n  Select @firmano=firmano,@id=id,@sil=isnull(sil,0) from inserted\r\n  if update(sil) and (@sil=1)\r\n    exec sp_loglama @firmano,@id,'gelgidkart',-1,''\r\n  else\r\n    exec sp_loglama @firmano,@id,'gelgidkart',0,''\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "gelgidkart_tri",
    "table_name": "gelgidkart",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[gelgidkart_tri] ON [dbo].[gelgidkart]\r\nWITH EXECUTE AS CALLER\r\nFOR INSERT\r\nAS\r\nBEGIN\r\ndeclare @sis_gelirid int,@sis_@giderid int;\r\ndeclare @grpid int\r\ndeclare @kod varchar(20);\r\nDECLARE @id float;\r\n\r\nselect @sis_gelirid=grp_gelirid,@sis_@giderid=grp_giderid from sistemtanim\r\n\r\nselect @id=id,@kod=kod,@grpid=grp1 from inserted;\r\n\r\nEXEC carikartacilis 'gelgidkart',@kod;\r\n\r\nif @grpid=@sis_gelirid\r\nEXEC numara_no_yaz 'gelirkart',@kod\r\n\r\nif @grpid=@sis_@giderid\r\nEXEC numara_no_yaz 'giderkart',@kod\r\n\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "gelgidkart_tru",
    "table_name": "gelgidkart",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[gelgidkart_tru] ON [dbo].[gelgidkart]\r\nWITH EXECUTE AS CALLER\r\nFOR UPDATE\r\nAS\r\nBEGIN\r\ndeclare @kod varchar(20);\r\nDECLARE @id float;\r\n\r\nselect @id=id,@kod=kod from inserted;\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "grup_log_trd",
    "table_name": "grup",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[grup_log_trd] ON [dbo].[grup]\r\nWITH EXECUTE AS CALLER\r\nFOR DELETE\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int,@for_log varchar(8000)\r\n  Select @for_log=' id='+cast(id as varchar(50))+' sr='+cast(sr as varchar(50))+' sil='+cast(sil as varchar(50))+' firmano='+cast(firmano as varchar(50))+' tabload='+tabload+' grp1='+cast(grp1 as varchar(50))+' grp2='+cast(grp2 as varchar(50))+' ad='+ad+' olususer='+olususer+' olustarsaat='+cast(olustarsaat as varchar(50))+' deguser='+deguser+' degtarsaat='+cast(degtarsaat as varchar(50))+' dataok='+cast(dataok as varchar(50))+' kar1='+cast(kar1 as varchar(50))+' kar2='+cast(kar2 as varchar(50))+' kdv='+cast(kdv as varchar(50))+' ykkisno='+ykkisno+' kar3='+cast(kar3 as varchar(50))+' kar4='+cast(kar4 as varchar(50)) from deleted\r\n  exec sp_loglama @firmano,@id,'grup',-2,@for_log\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "grup_log_tri",
    "table_name": "grup",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[grup_log_tri] ON [dbo].[grup]\r\nWITH EXECUTE AS CALLER\r\nFOR INSERT\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int\r\n  Select @firmano=firmano,@id=id from inserted\r\n  exec sp_loglama @firmano,@id,'grup',1,''\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "grup_log_tru",
    "table_name": "grup",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[grup_log_tru] ON [dbo].[grup]\r\nWITH EXECUTE AS CALLER\r\nFOR UPDATE\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int,@sil bit\r\n  Select @firmano=firmano,@id=id,@sil=isnull(sil,0) from inserted\r\n  if update(sil) and (@sil=1)\r\n    exec sp_loglama @firmano,@id,'grup',-1,''\r\n  else\r\n    exec sp_loglama @firmano,@id,'grup',0,''\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "irsaliyehrk_log_trd",
    "table_name": "irsaliyehrk",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[irsaliyehrk_log_trd] ON [dbo].[irsaliyehrk]\r\nWITH EXECUTE AS CALLER\r\nFOR DELETE\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int,@for_log varchar(8000)\r\n  Select @for_log=' id='+cast(id as varchar(50))+' irid='+cast(irid as varchar(50))+' firmano='+cast(firmano as varchar(50))+' tarih='+cast(tarih as varchar(50))+' vadtar='+cast(vadtar as varchar(50))+' kdvtip='+kdvtip+' stktip='+stktip+' stkod='+stkod+' mik='+cast(mik as varchar(50))+' carpan='+cast(carpan as varchar(50))+' brim='+brim+' ustbrim='+ustbrim+' kdvyuz='+cast(kdvyuz as varchar(50))+' kdvtut='+cast(kdvtut as varchar(50))+' depkod='+depkod+' dataok='+cast(dataok as varchar(50))+' grupid='+cast(grupid as varchar(50))+' olususer='+olususer+' olustarsaat='+cast(olustarsaat as varchar(50))+' deguser='+deguser+' degtarsaat='+cast(degtarsaat as varchar(50))+' brmfiy='+cast(brmfiy as varchar(50))+' sil='+cast(sil as varchar(50))+' sipid='+cast(sipid as varchar(50)) from deleted\r\n  exec sp_loglama @firmano,@id,'irsaliyehrk',-2,@for_log\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "irsaliyehrk_log_tri",
    "table_name": "irsaliyehrk",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[irsaliyehrk_log_tri] ON [dbo].[irsaliyehrk]\r\nWITH EXECUTE AS CALLER\r\nFOR INSERT\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int\r\n  Select @firmano=firmano,@id=id from inserted\r\n  exec sp_loglama @firmano,@id,'irsaliyehrk',1,''\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "irsaliyehrk_log_tru",
    "table_name": "irsaliyehrk",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[irsaliyehrk_log_tru] ON [dbo].[irsaliyehrk]\r\nWITH EXECUTE AS CALLER\r\nFOR UPDATE\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int,@sil bit\r\n  Select @firmano=firmano,@id=id,@sil=isnull(sil,0) from inserted\r\n  if update(sil) and (@sil=1)\r\n    exec sp_loglama @firmano,@id,'irsaliyehrk',-1,''\r\n  else\r\n    exec sp_loglama @firmano,@id,'irsaliyehrk',0,''\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "irsaliyehrk_trd",
    "table_name": "irsaliyehrk",
    "is_disabled": true,
    "definition": "CREATE TRIGGER [dbo].[irsaliyehrk_trd] ON [dbo].[irsaliyehrk]\r\nWITH EXECUTE AS CALLER\r\nFOR DELETE\r\nAS\r\nBEGIN\r\ndeclare @irid float;\r\ndeclare @kdvtop float,@irtop float;\r\n\r\nselect @irid=irid from deleted;\r\n\r\n\r\nselect @irtop=isnull(sum((brmfiy*mik)),0),\r\n@kdvtop=isnull(sum(kdvtut),0) from irsaliyehrk where irid=@irid;\r\n\r\nupdate irsaliyemas set irtop=@irtop,kdvtop=@kdvtop where irid=@irid;\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "irsaliyehrk_triu",
    "table_name": "irsaliyehrk",
    "is_disabled": true,
    "definition": "CREATE TRIGGER [dbo].[irsaliyehrk_triu] ON [dbo].[irsaliyehrk]\r\nWITH EXECUTE AS CALLER\r\nFOR INSERT, UPDATE\r\nAS\r\nBEGIN\r\ndeclare @irid float;\r\ndeclare @id float;\r\ndeclare @kdvtop float,@irtop float;\r\ndeclare @kayok int,@sil int\r\n\r\nselect @id=id,@irid=irid,@kayok=kayok,@sil=sil from inserted;\r\n\r\nselect @irtop=sum((brmfiy*mik)),@kdvtop=sum(kdvtut*mik) from irsaliyehrk\r\nwhere irid=@irid\r\n\r\nupdate irsaliyemas set irtop=@irtop,kdvtop=@kdvtop where irid=@irid\r\n\r\n if (update(kayok) or (@sil=1)) and @kayok=1\r\n begin\r\n\r\n DECLARE irsaliyehrkgun CURSOR LOCAL FOR SELECT id,kayok,sil FROM inserted\r\n OPEN irsaliyehrkgun\r\n FETCH NEXT FROM irsaliyehrkgun INTO  @id,@kayok,@sil\r\n WHILE @@FETCH_STATUS = 0\r\n BEGIN\r\n\r\n  exec stokhrkisle @id,'irsaliyehrk','',@kayok,@sil,@irid\r\n\r\n FETCH NEXT FROM irsaliyehrkgun INTO @id,@kayok,@sil\r\n END\r\n CLOSE irsaliyehrkgun\r\n DEALLOCATE irsaliyehrkgun\r\n end\r\n\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "irsaliyemas_log_trd",
    "table_name": "irsaliyemas",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[irsaliyemas_log_trd] ON [dbo].[irsaliyemas]\r\nWITH EXECUTE AS CALLER\r\nFOR DELETE\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int,@for_log varchar(8000)\r\n  Select @for_log=' id='+cast(id as varchar(50))+' irid='+cast(irid as varchar(50))+' firmano='+cast(firmano as varchar(50))+' kayok='+cast(kayok as varchar(50))+' sil='+cast(sil as varchar(50))+' irtip='+irtip+' irad='+irad+' irturad='+irturad+' irtur='+irtur+' irseri='+irseri+' irno='+irno+' tarih='+cast(tarih as varchar(50))+' vadtar='+cast(vadtar as varchar(50))+' kdvtip='+kdvtip+' ack='+ack+' kdvtut='+cast(kdvtut as varchar(50))+' depo='+depo+' dataok='+cast(dataok as varchar(50))+' olususer='+olususer+' olustarsaat='+cast(olustarsaat as varchar(50))+' deguser='+deguser+' degtarsaat='+cast(degtarsaat as varchar(50))+' irtop='+cast(irtop as varchar(50))+' kdvtop='+cast(kdvtop as varchar(50))+' cartip='+cartip+' carkod='+carkod+' saat='+saat+' aktip='+aktip+' akid='+cast(akid as varchar(50))+' aktar='+cast(aktar as varchar(50)) from deleted\r\n  exec sp_loglama @firmano,@id,'irsaliyemas',-2,@for_log\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "irsaliyemas_log_tri",
    "table_name": "irsaliyemas",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[irsaliyemas_log_tri] ON [dbo].[irsaliyemas]\r\nWITH EXECUTE AS CALLER\r\nFOR INSERT\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int\r\n  Select @firmano=firmano,@id=id from inserted\r\n  exec sp_loglama @firmano,@id,'irsaliyemas',1,''\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "irsaliyemas_log_tru",
    "table_name": "irsaliyemas",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[irsaliyemas_log_tru] ON [dbo].[irsaliyemas]\r\nWITH EXECUTE AS CALLER\r\nFOR UPDATE\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int,@sil bit\r\n  Select @firmano=firmano,@id=id,@sil=isnull(sil,0) from inserted\r\n  if update(sil) and (@sil=1)\r\n    exec sp_loglama @firmano,@id,'irsaliyemas',-1,''\r\n  else\r\n    exec sp_loglama @firmano,@id,'irsaliyemas',0,''\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "irsaliyemas_trd",
    "table_name": "irsaliyemas",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[irsaliyemas_trd] ON [dbo].[irsaliyemas]\r\nWITH EXECUTE AS CALLER\r\nFOR DELETE\r\nAS\r\nBEGIN\r\n declare @irid float\r\n select @irid=irid from deleted\r\n \r\n  exec stokhrkisle @irid,'irsaliyehrk','',1,1,@irid \r\n \r\n  delete from irsaliyehrk where irid=@irid\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "irsaliyemas_tru",
    "table_name": "irsaliyemas",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[irsaliyemas_tru] ON [dbo].[irsaliyemas]\r\nWITH EXECUTE AS CALLER\r\nFOR UPDATE\r\nAS\r\nBEGIN\r\n\r\n\r\ndeclare @irid float;\r\ndeclare @kayok int,@sil int;\r\n\r\nselect @kayok=kayok,@sil=sil,@irid=irid from inserted;\r\n\r\n\r\nif update(kayok) or  update(sil)\r\n begin\r\n\r\n update irsaliyehrk set sil=@sil where irid=@irid and sil=0\r\n\r\n\r\n   exec stokhrkisle @irid,'irsaliyehrk','',@kayok,@sil,@irid \r\n\r\n if @kayok=1\r\n  update irsaliyehrk set kayok=@kayok where irid=@irid /*and kayok=0; */\r\n  \r\n  \r\n\r\n \r\n \r\n \r\nend\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "istkart_log_trd",
    "table_name": "istkart",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[istkart_log_trd] ON [dbo].[istkart]\r\nWITH EXECUTE AS CALLER\r\nFOR DELETE\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int,@for_log varchar(8000)\r\n  Select @for_log=' id='+cast(id as varchar(50))+' firmano='+cast(firmano as varchar(50))+' sil='+cast(sil as varchar(50))+' kod='+kod+' ad='+ad+' bankod='+bankod+' sahibi='+sahibi+' muhkod='+muhkod+' lim='+cast(lim as varchar(50))+' sonkultar='+cast(sonkultar as varchar(50))+' heskesgun='+cast(heskesgun as varchar(50))+' hessongun='+cast(hessongun as varchar(50))+' drm='+drm+' karttur='+karttur+' olususer='+olususer+' olustarsaat='+cast(olustarsaat as varchar(50))+' deguser='+deguser+' degtarsaat='+cast(degtarsaat as varchar(50))+' dataok='+cast(dataok as varchar(50))+' borc='+cast(borc as varchar(50))+' alacak='+cast(alacak as varchar(50))+' parabrm='+parabrm+' actutar='+cast(actutar as varchar(50)) from deleted\r\n  exec sp_loglama @firmano,@id,'istkart',-2,@for_log\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "istkart_log_tri",
    "table_name": "istkart",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[istkart_log_tri] ON [dbo].[istkart]\r\nWITH EXECUTE AS CALLER\r\nFOR INSERT\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int\r\n  Select @firmano=firmano,@id=id from inserted\r\n  exec sp_loglama @firmano,@id,'istkart',1,''\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "istkart_log_tru",
    "table_name": "istkart",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[istkart_log_tru] ON [dbo].[istkart]\r\nWITH EXECUTE AS CALLER\r\nFOR UPDATE\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int,@sil bit\r\n  Select @firmano=firmano,@id=id,@sil=isnull(sil,0) from inserted\r\n  if update(sil) and (@sil=1)\r\n    exec sp_loglama @firmano,@id,'istkart',-1,''\r\n  else\r\n    exec sp_loglama @firmano,@id,'istkart',0,''\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "istkart_tri",
    "table_name": "istkart",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[istkart_tri] ON [dbo].[istkart]\r\nWITH EXECUTE AS CALLER\r\nFOR INSERT\r\nAS\r\nBEGIN\r\ndeclare @kod varchar(20);\r\nDECLARE @id float;\r\n\r\nselect @id=id,@kod=kod from inserted;\r\n\r\nEXEC numara_no_yaz 'istkredikart',@kod\r\n\r\nEXEC carikartacilis 'istkredikart',@kod;\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "istkart_tru",
    "table_name": "istkart",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[istkart_tru] ON [dbo].[istkart]\r\nWITH EXECUTE AS CALLER\r\nFOR UPDATE\r\nAS\r\nBEGIN\r\ndeclare @kod varchar(20);\r\nDECLARE @id float;\r\n\r\nselect @id=id,@kod=kod from inserted;\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "istkhrk_log_trd",
    "table_name": "istkhrk",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[istkhrk_log_trd] ON [dbo].[istkhrk]\r\nWITH EXECUTE AS CALLER\r\nFOR DELETE\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int,@for_log varchar(8000)\r\n  Select @for_log=' id='+cast(id as varchar(50))+' firmano='+cast(firmano as varchar(50))+' istkhrkid='+cast(istkhrkid as varchar(50))+' istkkod='+istkkod+' varno='+cast(varno as varchar(50))+' varok='+cast(varok as varchar(50))+' sil='+cast(sil as varchar(50))+' gctip='+gctip+' perkod='+perkod+' adaid='+cast(adaid as varchar(50))+' islmtip='+islmtip+' islmtipad='+islmtipad+' islmhrk='+islmhrk+' islmhrkad='+islmhrkad+' yertip='+yertip+' yerad='+yerad+' masterid='+cast(masterid as varchar(50))+' vadetar='+cast(vadetar as varchar(50))+' tarih='+cast(tarih as varchar(50))+' saat='+saat+' carslip='+cast(carslip as varchar(50))+' cartip='+cartip+' cartur='+cartur+' carkod='+carkod+' borc='+cast(borc as varchar(50))+' alacak='+cast(alacak as varchar(50))+' ack='+ack+' olususer='+olususer+' olustarsaat='+cast(olustarsaat as varchar(50))+' deguser='+deguser+' degtarsaat='+cast(degtarsaat as varchar(50))+' dataok='+cast(dataok as varchar(50))+' belno='+belno+' kur='+cast(kur as varchar(50))+' parabrm='+parabrm+' fisfattip='+fisfattip+' fisfatid='+cast(fisfatid as varchar(50))+' karsihestip='+karsihestip+' karsiheskod='+karsiheskod+' fisid='+cast(fisid as varchar(50)) from deleted\r\n  exec sp_loglama @firmano,@id,'istkhrk',-2,@for_log\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "istkhrk_log_tri",
    "table_name": "istkhrk",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[istkhrk_log_tri] ON [dbo].[istkhrk]\r\nWITH EXECUTE AS CALLER\r\nFOR INSERT\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int\r\n  Select @firmano=firmano,@id=id from inserted\r\n  exec sp_loglama @firmano,@id,'istkhrk',1,''\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "istkhrk_log_tru",
    "table_name": "istkhrk",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[istkhrk_log_tru] ON [dbo].[istkhrk]\r\nWITH EXECUTE AS CALLER\r\nFOR UPDATE\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int,@sil bit\r\n  Select @firmano=firmano,@id=id,@sil=isnull(sil,0) from inserted\r\n  if update(sil) and (@sil=1)\r\n    exec sp_loglama @firmano,@id,'istkhrk',-1,''\r\n  else\r\n    exec sp_loglama @firmano,@id,'istkhrk',0,''\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "istkhrk_trd",
    "table_name": "istkhrk",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[istkhrk_trd] ON [dbo].[istkhrk]\r\nWITH EXECUTE AS CALLER\r\nFOR DELETE\r\nAS\r\nBEGIN\r\n\r\ndeclare @postut float,@varno float,@tut float\r\ndeclare @varok int\r\ndeclare @istkkod varchar(30)\r\ndeclare @istkhrkid float\r\ndeclare @belno varchar(20)\r\ndeclare @sil     int\r\ndeclare @tahodeid\tint\r\ndeclare @cartip\t\tvarchar(30)\r\ndeclare @id \t\tint\r\ndeclare @masid \t\tint\r\n\r\n\r\nSET NOCOUNT ON\r\n\r\n\r\n DECLARE istkhrksil CURSOR FAST_FORWARD FOR SELECT \r\n id,istkhrkid,istkkod,masterid,sil,tahodeid,cartip\r\n FROM deleted\r\n OPEN istkhrksil\r\n FETCH NEXT FROM istkhrksil INTO  @id,@istkhrkid,\r\n @istkkod,@masid,@sil,@tahodeid,@cartip\r\n WHILE @@FETCH_STATUS = 0\r\n BEGIN\r\n\r\n\r\n  if (@cartip='carikart') or (@cartip='perkart') or (@cartip='gelgidkart')\r\n  delete from carihrk where masterid=@istkhrkid and karsihestip='istkart'\r\n\r\n  if @cartip='kasakart'\r\n   delete from kasahrk where kashrkid=@masid\r\n\r\n\r\n\r\n FETCH NEXT FROM istkhrksil INTO  \r\n @id,@istkhrkid,@istkkod,@masid,@sil,@tahodeid,@cartip\r\n END\r\n CLOSE istkhrksil\r\n DEALLOCATE istkhrksil\r\n\r\n\r\nSET NOCOUNT OFF \r\n  \r\n\r\n  \r\n  \r\n  \r\n  \r\n  \r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "istkhrk_triu",
    "table_name": "istkhrk",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[istkhrk_triu] ON [dbo].[istkhrk]\r\nWITH EXECUTE AS CALLER\r\nFOR INSERT, UPDATE\r\nAS\r\nBEGIN\r\ndeclare @postut float,@varno float,@tut float\r\ndeclare @varok int\r\ndeclare @istkkod varchar(30)\r\ndeclare @masterid float\r\ndeclare @istkhrkid float\r\ndeclare @belno varchar(20)\r\ndeclare @sil     int\r\n\r\n\r\nSET NOCOUNT ON\r\n\r\n\r\nselect @sil=sil,@istkhrkid=istkhrkid,@masterid=masterid,@istkkod=istkkod,\r\n@varno=varno,@varok=varok,@belno=belno from inserted\r\n\r\n\r\n if isnull(@istkhrkid,0)=0\r\n  return\r\n\r\n  exec istkarthrkgiris @istkhrkid,@sil\r\n\r\n  exec numara_no_yaz 'makbuz',@belno\r\n\r\n\r\nSET NOCOUNT OFF\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "kasa_kapa_log_trd",
    "table_name": "kasa_kapa",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[kasa_kapa_log_trd] ON [dbo].[kasa_kapa]\r\nWITH EXECUTE AS CALLER\r\nFOR DELETE\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int,@for_log varchar(8000)\r\n  Select @for_log=' id='+cast(id as varchar(50))+' firmano='+cast(firmano as varchar(50))+' kaskod='+kaskod+' tarih='+cast(tarih as varchar(50))+' olususer='+olususer+' olustarsaat='+cast(olustarsaat as varchar(50))+' kapat='+cast(kapat as varchar(50)) from deleted\r\n  exec sp_loglama @firmano,@id,'kasa_kapa',-2,@for_log\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "kasa_kapa_log_tri",
    "table_name": "kasa_kapa",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[kasa_kapa_log_tri] ON [dbo].[kasa_kapa]\r\nWITH EXECUTE AS CALLER\r\nFOR INSERT\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int\r\n  Select @firmano=firmano,@id=id from inserted\r\n  exec sp_loglama @firmano,@id,'kasa_kapa',1,''\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "kasa_kapa_log_tru",
    "table_name": "kasa_kapa",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[kasa_kapa_log_tru] ON [dbo].[kasa_kapa]\r\nWITH EXECUTE AS CALLER\r\nFOR UPDATE\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int,@sil bit\r\n  Select @firmano=firmano,@id=id,@sil=isnull(sil,0) from inserted\r\n  if update(sil) and (@sil=1)\r\n    exec sp_loglama @firmano,@id,'kasa_kapa',-1,''\r\n  else\r\n    exec sp_loglama @firmano,@id,'kasa_kapa',0,''\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "kasahrk_log_trd",
    "table_name": "kasahrk",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[kasahrk_log_trd] ON [dbo].[kasahrk]\r\nWITH EXECUTE AS CALLER\r\nFOR DELETE\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int,@for_log varchar(8000)\r\n  Select @for_log=' id='+cast(id as varchar(50))+' firmano='+cast(firmano as varchar(50))+' kaskod='+kaskod+' kashrkid='+cast(kashrkid as varchar(50))+' gctip='+gctip+' varok='+cast(varok as varchar(50))+' sil='+cast(sil as varchar(50))+' varno='+cast(varno as varchar(50))+' masterid='+cast(masterid as varchar(50))+' islmtip='+islmtip+' islmtipad='+islmtipad+' islmhrk='+islmhrk+' islmhrkad='+islmhrkad+' yertip='+yertip+' yerad='+yerad+' perkod='+perkod+' adaid='+cast(adaid as varchar(50))+' giren='+cast(giren as varchar(50))+' cikan='+cast(cikan as varchar(50))+' bakiye='+cast(bakiye as varchar(50))+' carkod='+carkod+' cartip='+cartip+' tarih='+cast(tarih as varchar(50))+' saat='+saat+' belno='+belno+' ack='+ack+' kur='+cast(kur as varchar(50))+' olususer='+olususer+' olustarsaat='+cast(olustarsaat as varchar(50))+' deguser='+deguser+' degtarsaat='+cast(degtarsaat as varchar(50))+' dataok='+cast(dataok as varchar(50))+' parabrm='+parabrm+' pro='+cast(pro as varchar(50))+' fisfattip='+fisfattip+' fisfatid='+cast(fisfatid as varchar(50))+' karsihestip='+karsihestip+' karsiheskod='+karsiheskod+' fisid='+cast(fisid as varchar(50)) from deleted\r\n  exec sp_loglama @firmano,@id,'kasahrk',-2,@for_log\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "kasahrk_log_tri",
    "table_name": "kasahrk",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[kasahrk_log_tri] ON [dbo].[kasahrk]\r\nWITH EXECUTE AS CALLER\r\nFOR INSERT\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int\r\n  Select @firmano=firmano,@id=id from inserted\r\n  exec sp_loglama @firmano,@id,'kasahrk',1,''\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "kasahrk_log_tru",
    "table_name": "kasahrk",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[kasahrk_log_tru] ON [dbo].[kasahrk]\r\nWITH EXECUTE AS CALLER\r\nFOR UPDATE\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int,@sil bit\r\n  Select @firmano=firmano,@id=id,@sil=isnull(sil,0) from inserted\r\n  if update(sil) and (@sil=1)\r\n    exec sp_loglama @firmano,@id,'kasahrk',-1,''\r\n  else\r\n    exec sp_loglama @firmano,@id,'kasahrk',0,''\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "kasahrk_trd",
    "table_name": "kasahrk",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[kasahrk_trd] ON [dbo].[kasahrk]\r\nWITH EXECUTE AS CALLER\r\nFOR DELETE\r\nAS\r\nBEGIN\r\ndeclare @varno \t\tfloat\r\ndeclare @idx \t\tfloat\r\ndeclare @kaskod \tvarchar(20)\r\ndeclare @yertip \tvarchar(20)\r\ndeclare @naktop \tfloat\r\ndeclare @pro \t\tint\r\ndeclare @kashrkid \tfloat\r\ndeclare @masterid \tfloat\r\ndeclare @giren \t\tfloat\r\ndeclare @cikan \t\tfloat\r\ndeclare @kur \t\tfloat\r\ndeclare @islmtip \tvarchar(10)\r\ndeclare @islmhrk \tvarchar(10)\r\ndeclare @fisfatid \tfloat\r\ndeclare @fisfattip \tvarchar(10)\r\ndeclare @sil \t\tint\r\ndeclare @varok \t\tint\r\ndeclare @tarih \t\tdatetime\r\n\r\n  DECLARE kasahrk_del CURSOR LOCAL FOR\r\n  SELECT tarih,yertip,kashrkid,id,kaskod,varno,varok,\r\n  islmtip,islmhrk,masterid,fisfatid,fisfattip,giren,cikan,kur,sil\r\n  from deleted\r\n  OPEN kasahrk_del\r\n  FETCH NEXT FROM kasahrk_del INTO @tarih,@yertip,@kashrkid,@idx,@kaskod,@varno,\r\n  @varok,@islmtip,@islmhrk,@masterid,@fisfatid,@fisfattip,@giren,@cikan,@kur,@sil\r\n  WHILE @@FETCH_STATUS = 0\r\n  BEGIN\r\n\r\n  exec kasahrkgiris @kashrkid,1\r\n\r\n  if (@yertip='pomvardimas')\r\n  begin\r\n\r\n  if (@islmtip='TAH') and (@islmhrk='TES')\r\n  update pomvardimas set naktestop=\r\n   (select isnull(sum(giren*kur),0) from kasahrk\r\n   where varno=@varno and sil=0 and islmtip='TAH'\r\n   and islmhrk='TES' and yertip=@yertip and masterid=0)  where varno=@varno\r\n\r\n  /*-tahsilat toplamı */\r\n  if (@islmtip='TAH') and (@islmhrk='NAK')\r\n  update pomvardimas set tahtop=\r\n   (select isnull(sum(giren*kur),0) from kasahrk\r\n   where varno=@varno and sil=0 and islmtip='TAH' and islmhrk='NAK' and cartip<>'gelgidkart' and yertip=@yertip)\r\n   where varno=@varno\r\n\r\n\r\n /*-odeme toplamı */\r\n if (@islmtip='ODE') and (@islmhrk='NAK')\r\n update pomvardimas set odetop=\r\n   (select isnull(sum(cikan*kur),0) from kasahrk\r\n   where varno=@varno and sil=0 and islmtip='ODE' and islmhrk='NAK' and cartip<>'gelgidkart' and yertip=@yertip)\r\n where varno=@varno\r\nend\r\n\r\nif (@yertip='marvardimas')\r\nbegin\r\nupdate marvardimas set naktestop=\r\n   (select isnull(sum(giren*kur),0) from kasahrk\r\n   where varno=@varno and sil=0 and islmtip='TAH'\r\n   and islmhrk='TES' and yertip=@yertip and masterid=0)\r\nwhere varno=@varno\r\n\r\n/*-tahsilat toplamı */\r\nif (@islmtip='TAH') and (@islmhrk='NAK')\r\nupdate marvardimas set tahtop=\r\n   (select isnull(sum(giren*kur),0) from kasahrk\r\n   where varno=@varno and sil=0 and islmtip='TAH' and islmhrk='NAK' and cartip<>'gelgidkart' and yertip=@yertip)\r\nwhere varno=@varno\r\n\r\n/*-ödeme toplamı */\r\nif (@islmtip='ODE') and (@islmhrk='NAK')\r\nupdate marvardimas set odetop=\r\n   (select isnull(sum(cikan*kur),0) from kasahrk\r\n   where varno=@varno and sil=0 and islmtip='ODE' and islmhrk='NAK' and cartip<>'gelgidkart' and yertip=@yertip)\r\nwhere varno=@varno\r\n\r\nend\r\n\r\n\r\nif (@yertip='resvardimas')\r\nbegin\r\nupdate resvardimas set naktestop=\r\n   (select isnull(sum(giren*kur),0) from kasahrk\r\n   where varno=@varno and sil=0 and islmtip='TAH'\r\n   and islmhrk='TES' and yertip=@yertip and masterid=0)\r\nwhere varno=@varno\r\n\r\n/*-tahsilat toplamı */\r\nif (@islmtip='TAH') and (@islmhrk='NAK')\r\nupdate resvardimas set tahtop=\r\n   (select isnull(sum(giren*kur),0) from kasahrk\r\n   where varno=@varno and sil=0 and islmtip='TAH' and islmhrk='NAK' and cartip<>'gelgidkart' and yertip=@yertip)\r\nwhere varno=@varno\r\n\r\n/*-ödeme toplamı */\r\nif (@islmtip='ODE') and (@islmhrk='NAK')\r\nupdate resvardimas set odetop=\r\n   (select isnull(sum(cikan*kur),0) from kasahrk\r\n   where varno=@varno and sil=0 and islmtip='ODE' and islmhrk='NAK' and cartip<>'gelgidkart' and yertip=@yertip)\r\nwhere varno=@varno\r\n\r\nend\r\n\r\n\r\nif (@fisfattip='FAT')\r\nbegin\r\nupdate faturamas set odemetop=\r\n   (select isnull(sum((giren+cikan)*kur),0) from kasahrk\r\n   where sil=0 and fisfattip=@fisfattip and fisfatid=@fisfatid)\r\nwhere fatid=@fisfatid\r\nend\r\n\r\n  FETCH NEXT FROM kasahrk_del INTO @tarih,@yertip,@kashrkid,@idx,@kaskod,@varno,\r\n  @varok,@islmtip,@islmhrk,@masterid,@fisfatid,@fisfattip,@giren,@cikan,@kur,@sil\r\n  END\r\n\r\n  CLOSE kasahrk_del\r\n  DEALLOCATE kasahrk_del\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "kasahrk_tri",
    "table_name": "kasahrk",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[kasahrk_tri] ON [dbo].[kasahrk]\r\nWITH EXECUTE AS CALLER\r\nFOR INSERT, UPDATE\r\nAS\r\nBEGIN\r\n\r\n\r\nSET NOCOUNT ON\r\nSET XACT_ABORT ON\r\n\r\ndeclare @varno float,@idx float\r\ndeclare @kaskod varchar(20)\r\ndeclare @yertip varchar(20)\r\ndeclare @naktop float,@pro int\r\ndeclare @kashrkid float,@masterid float\r\ndeclare @giren float,@cikan float,@kur float\r\ndeclare @islmtip varchar(10),@islmhrk varchar(10)\r\ndeclare @fisfatid float\r\ndeclare @fisfattip varchar(10)\r\ndeclare @sil int\r\ndeclare @varok int\r\ndeclare @belno varchar(20)\r\ndeclare @kashrkIdcount int\r\ndeclare @firmano  int\r\n\r\n\r\n\r\n\r\nselect @yertip=yertip,@kashrkid=kashrkid,@idx=id,@firmano=firmano,\r\n@kaskod=kaskod,@varno=varno,\r\n@varok=varok,@pro=pro,\r\n@islmtip=islmtip,@islmhrk=islmhrk,@masterid=masterid,@fisfatid=fisfatid,\r\n@fisfattip=fisfattip,@giren=giren,@cikan=cikan,@kur=kur,@sil=sil,\r\n@belno=belno from inserted\r\n\r\n\r\n  if @islmtip not in ('VIR','DVA','DVS') \r\n   update kasahrk set kashrkid=id where id=@idx\r\n\r\n\r\n  select @kashrkIdcount=count(*) from kasahrk with (nolock)\r\n  where isnull(kashrkid,0)=0 and firmano=@firmano \r\n\r\n\r\n if @kashrkIdcount>1\r\n begin\r\n   RAISERROR ('KasahrkId Hatası', 16,1) \r\n   ROLLBACK TRANSACTION\r\n   RETURN\r\n end\r\n\r\n\r\n  if isnull(@kashrkid,0)=0\r\n    return\r\n\r\n exec kasahrkgiris @kashrkid,@sil\r\n\r\n exec numara_no_yaz 'makbuz',@belno\r\n\r\n\r\nif (@yertip='pomvardimas')\r\nbegin\r\n update pomvardimas set naktestop=\r\n   (select isnull(sum(kur*giren),0) from kasahrk with (nolock) \r\n   where varno=@varno and sil=0 and islmtip='TAH'\r\n   and islmhrk='TES' and yertip=@yertip and masterid=0),\r\n   tahtop=\r\n   (select isnull(sum(giren*kur),0) from kasahrk with (nolock) \r\n   where varno=@varno and sil=0 and islmtip='TAH'\r\n   and islmhrk='NAK' and cartip<>'gelgidkart' and yertip=@yertip)\r\n   +ISNULL((select isnull(sum(giren*kur),0) from kasahrk\r\n   where varno=@varno and sil=0 and islmtip='BNK'\r\n   and islmhrk='CKN' and cartip<>'gelgidkart' and yertip=@yertip),0),\r\n   gelirtop=\r\n   ISNULL((select isnull(sum(giren*kur),0) from kasahrk with (nolock) \r\n   where varno=@varno and sil=0 and islmtip='TAH'\r\n   and islmhrk='NAK' and cartip='gelgidkart' and yertip=@yertip),0)+\r\n   (select isnull(sum(giren*kur),0) from poshrk with (nolock) \r\n   where varno=@varno and sil=0 and islmtip='TAH'\r\n   and islmhrk='POS' and cartip='gelgidkart' and yertip=@yertip),\r\n   odetop=\r\n   (select isnull(sum(cikan*kur),0) from kasahrk with (nolock) \r\n   where varno=@varno and sil=0 and islmtip='ODE'\r\n   and islmhrk='NAK' and cartip<>'gelgidkart' and yertip=@yertip)\r\n   +ISNULL((select isnull(sum(cikan*kur),0) from kasahrk with (nolock) \r\n   where varno=@varno and sil=0 and islmtip='BNK'\r\n   and islmhrk='YTN' and cartip<>'gelgidkart' and yertip=@yertip),0),\r\n   gidertop=\r\n   isnull((select isnull(sum(cikan*kur),0) from kasahrk with (nolock) \r\n   where varno=@varno and sil=0 and islmtip='ODE'\r\n   and islmhrk='NAK' and cartip='gelgidkart' and yertip=@yertip),0)\r\n   \r\n   \r\n  where varno=@varno\r\n  \r\n\r\nend\r\n\r\nif (@yertip='marvardimas')\r\nbegin\r\n\r\nupdate marvardimas set naktestop=\r\n   (select isnull(sum(giren*kur),0) from kasahrk with (nolock) \r\n   where varno=@varno and sil=0 and islmtip='TAH'\r\n   and islmhrk='TES' and yertip=@yertip and masterid=0),\r\n   tahtop=\r\n   (select isnull(sum(giren*kur),0) from kasahrk with (nolock) \r\n   where varno=@varno and sil=0 and islmtip='TAH'\r\n   and islmhrk='NAK' and cartip<>'gelgidkart' and yertip=@yertip)\r\n   +ISNULL((select isnull(sum(giren*kur),0) from kasahrk with (nolock) \r\n   where varno=@varno and sil=0 and islmtip='BNK'\r\n   and islmhrk='CKN' and cartip<>'gelgidkart' and yertip=@yertip),0),\r\n   gelirtop=\r\n   (select isnull(sum(giren*kur),0) from kasahrk with (nolock) \r\n   where varno=@varno and sil=0 and islmtip='TAH'\r\n   and islmhrk='NAK' and cartip='gelgidkart' and yertip=@yertip),\r\n   odetop=\r\n   (select isnull(sum(cikan*kur),0) from kasahrk with (nolock) \r\n   where varno=@varno and sil=0 and islmtip='ODE'\r\n   and islmhrk='NAK' and cartip<>'gelgidkart' and yertip=@yertip)\r\n   +ISNULL((select isnull(sum(cikan*kur),0) from kasahrk with (nolock) \r\n   where varno=@varno and sil=0 and islmtip='BNK'\r\n   and islmhrk='YTN' and cartip<>'gelgidkart' and yertip=@yertip),0)\r\n   \r\n   \r\n   \r\n   /*\r\n   gidertop=\r\n   (select isnull(sum(cikan*kur),0) from kasahrk\r\n   where varno=@varno and sil=0 and\r\n   islmtip='ODE' and islmhrk='NAK'\r\n   and cartip='gelgidkart' and yertip=@yertip)\r\n   */\r\n  where varno=@varno\r\n\r\nend\r\n\r\n\r\nif (@yertip='resvardimas')\r\nbegin\r\n\r\nupdate resvardimas set naktestop=\r\n   (select isnull(sum(giren*kur),0) from kasahrk with (nolock) \r\n   where varno=@varno and sil=0 and islmtip='TAH'\r\n   and islmhrk='TES' and yertip=@yertip and masterid=0),\r\n   tahtop=\r\n   (select isnull(sum(giren*kur),0) from kasahrk with (nolock) \r\n   where varno=@varno and sil=0 and islmtip='TAH'\r\n   and islmhrk='NAK' and cartip<>'gelgidkart' and yertip=@yertip)\r\n   +ISNULL((select isnull(sum(giren*kur),0) from kasahrk with (nolock) \r\n   where varno=@varno and sil=0 and islmtip='BNK'\r\n   and islmhrk='CKN' and cartip<>'gelgidkart' and yertip=@yertip),0),\r\n   gelirtop=\r\n   (select isnull(sum(giren*kur),0) from kasahrk with (nolock) \r\n   where varno=@varno and sil=0 and islmtip='TAH'\r\n   and islmhrk='NAK' and cartip='gelgidkart' and yertip=@yertip),\r\n   odetop=\r\n   (select isnull(sum(cikan*kur),0) from kasahrk with (nolock) \r\n   where varno=@varno and sil=0 and islmtip='ODE'\r\n   and islmhrk='NAK' and cartip<>'gelgidkart' and yertip=@yertip)\r\n   +ISNULL((select isnull(sum(cikan*kur),0) from kasahrk with (nolock) \r\n   where varno=@varno and sil=0 and islmtip='BNK'\r\n   and islmhrk='YTN' and cartip<>'gelgidkart' and yertip=@yertip),0)\r\n   \r\n   \r\n  where varno=@varno\r\n\r\nend\r\n\r\n\r\nif (@fisfattip='FAT')\r\nbegin\r\nupdate faturamas set odemetop=\r\n   (select isnull(sum(giren+cikan),0) from kasahrk with (nolock) \r\n   where sil=0 and fisfattip=@fisfattip and fisfatid=@fisfatid)\r\n   where fatid=@fisfatid\r\n\r\n\r\nSET NOCOUNT OFF\r\n\r\n\r\nend\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "kasakart_log_trd",
    "table_name": "kasakart",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[kasakart_log_trd] ON [dbo].[kasakart]\r\nWITH EXECUTE AS CALLER\r\nFOR DELETE\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int,@for_log varchar(8000)\r\n  Select @for_log=' id='+cast(id as varchar(50))+' firmano='+cast(firmano as varchar(50))+' tip='+cast(tip as varchar(50))+' kod='+kod+' ad='+ad+' parabrm='+parabrm+' giren='+cast(giren as varchar(50))+' cikan='+cast(cikan as varchar(50))+' olususer='+olususer+' olustarsaat='+cast(olustarsaat as varchar(50))+' deguser='+deguser+' degtarsaat='+cast(degtarsaat as varchar(50))+' sil='+cast(sil as varchar(50))+' dataok='+cast(dataok as varchar(50))+' sr='+cast(sr as varchar(50)) from deleted\r\n  exec sp_loglama @firmano,@id,'kasakart',-2,@for_log\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "kasakart_log_tri",
    "table_name": "kasakart",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[kasakart_log_tri] ON [dbo].[kasakart]\r\nWITH EXECUTE AS CALLER\r\nFOR INSERT\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int\r\n  Select @firmano=firmano,@id=id from inserted\r\n  exec sp_loglama @firmano,@id,'kasakart',1,''\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "kasakart_log_tru",
    "table_name": "kasakart",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[kasakart_log_tru] ON [dbo].[kasakart]\r\nWITH EXECUTE AS CALLER\r\nFOR UPDATE\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int,@sil bit\r\n  Select @firmano=firmano,@id=id,@sil=isnull(sil,0) from inserted\r\n  if update(sil) and (@sil=1)\r\n    exec sp_loglama @firmano,@id,'kasakart',-1,''\r\n  else\r\n    exec sp_loglama @firmano,@id,'kasakart',0,''\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "kasakart_trd",
    "table_name": "kasakart",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[kasakart_trd] ON [dbo].[kasakart]\r\nWITH EXECUTE AS CALLER\r\nFOR DELETE\r\nAS\r\nBEGIN\r\n\r\n\r\ndeclare @kaskod varchar(30)\r\ndeclare @mesaj  varchar(250)\r\n\r\nselect @kaskod=kod from deleted\r\n\r\n  IF (SELECT COUNT(*) FROM kasahrk WHERE kaskod=@kaskod and sil=0) > 0\r\n    BEGIN\r\n      SELECT @mesaj = '\"'+@kaskod+ '\" Kodunun Hareketi Var! Silemezsiniz..!'\r\n      RAISERROR (@mesaj, 16,1)\r\n      ROLLBACK TRANSACTION\r\n      return\r\n    END\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "kasakart_tru",
    "table_name": "kasakart",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[kasakart_tru] ON [dbo].[kasakart]\r\nWITH EXECUTE AS CALLER\r\nFOR UPDATE\r\nAS\r\nBEGIN\r\n\r\ndeclare @kaskod varchar(30)\r\ndeclare @mesaj  varchar(250)\r\ndeclare @sil    int\r\n\r\nselect @kaskod=kod,@sil=sil from inserted\r\n\r\n if @sil=1\r\n begin\r\n IF (SELECT COUNT(*) FROM kasahrk WHERE kaskod=@kaskod and sil=0) > 0\r\n   BEGIN\r\n      SELECT @mesaj = '\"'+@kaskod+ '\" Kodunun Hareketi Var! Silemezsiniz..!'\r\n      RAISERROR (@mesaj, 16,1)\r\n      ROLLBACK TRANSACTION\r\n      return\r\n  END\r\n  end\r\n\r\n\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "markasahrk_log_trd",
    "table_name": "markasahrk",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[markasahrk_log_trd] ON [dbo].[markasahrk]\r\nWITH EXECUTE AS CALLER\r\nFOR DELETE\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int,@for_log varchar(8000)\r\n  Select @for_log=' id='+cast(id as varchar(50))+' kashrkid='+cast(kashrkid as varchar(50))+' varno='+cast(varno as varchar(50))+' marsatid='+cast(marsatid as varchar(50))+' firmano='+cast(firmano as varchar(50))+' cartip='+cartip+' carkod='+carkod+' gctip='+gctip+' sil='+cast(sil as varchar(50))+' varok='+cast(varok as varchar(50))+' islmtip='+islmtip+' islmtipad='+islmtipad+' islmhrk='+islmhrk+' islmhrkad='+islmhrkad+' yertip='+yertip+' yerad='+yerad+' perkod='+perkod+' giren='+cast(giren as varchar(50))+' cikan='+cast(cikan as varchar(50))+' tarih='+cast(tarih as varchar(50))+' saat='+saat+' kur='+cast(kur as varchar(50))+' olususer='+olususer+' olustarsaat='+cast(olustarsaat as varchar(50))+' dataok='+cast(dataok as varchar(50))+' parabrm='+parabrm+' deguser='+deguser+' degtarsaat='+cast(degtarsaat as varchar(50)) from deleted\r\n  exec sp_loglama @firmano,@id,'markasahrk',-2,@for_log\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "markasahrk_log_tri",
    "table_name": "markasahrk",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[markasahrk_log_tri] ON [dbo].[markasahrk]\r\nWITH EXECUTE AS CALLER\r\nFOR INSERT\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int\r\n  Select @firmano=firmano,@id=id from inserted\r\n  exec sp_loglama @firmano,@id,'markasahrk',1,''\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "markasahrk_log_tru",
    "table_name": "markasahrk",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[markasahrk_log_tru] ON [dbo].[markasahrk]\r\nWITH EXECUTE AS CALLER\r\nFOR UPDATE\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int,@sil bit\r\n  Select @firmano=firmano,@id=id,@sil=isnull(sil,0) from inserted\r\n  if update(sil) and (@sil=1)\r\n    exec sp_loglama @firmano,@id,'markasahrk',-1,''\r\n  else\r\n    exec sp_loglama @firmano,@id,'markasahrk',0,''\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "markasahrk_tri",
    "table_name": "markasahrk",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[markasahrk_tri] ON [dbo].[markasahrk]\r\nWITH EXECUTE AS CALLER\r\nFOR UPDATE\r\nAS\r\nBEGIN\r\ndeclare @varno \t\tfloat\r\ndeclare @idx \t\tfloat\r\ndeclare @kaskod \tvarchar(20)\r\ndeclare @yertip \tvarchar(20)\r\ndeclare @naktop \tfloat\r\ndeclare @kashrkid \tfloat\r\ndeclare @marsatid \tfloat\r\n\r\ndeclare @mesaj      nvarchar(50)\r\n\r\nselect @yertip=yertip,@kashrkid=kashrkid,\r\n@idx=id,@marsatid=marsatid,@varno=varno from inserted\r\n\r\nif @kashrkid=0 \r\n RETURN\r\n\r\n update marsatmas set naktop=\r\n   (select isnull(sum((giren-cikan)*kur),0) from\r\n   markasahrk where varno=@varno and marsatid=@marsatid and sil=0 )\r\n where marsatid=@marsatid and sil=0\r\n\r\n\r\n  update marsatmas set cartip='vardikasa',carkod=kaskod,\r\n   islmhrk=dt.islmhrk,islmhrkad=dt.islmhrkad\r\n   from marsatmas as t join\r\n   (select top 1 marsatid,kaskod,islmhrk,islmhrkad from\r\n     markasahrk where varno=@varno and marsatid=@marsatid and sil=0\r\n     order by id )\r\n     dt on dt.marsatid=t.marsatid and t.sil=0\r\n\r\n update marvardimas set naksattop=\r\n    (select isnull(sum(naktop),0) from marsatmas where\r\n    varno=@varno and sil=0 ) where varno=@varno and sil=0\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "marsathrk_log_trd",
    "table_name": "marsathrk",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[marsathrk_log_trd] ON [dbo].[marsathrk]\r\nWITH EXECUTE AS CALLER\r\nFOR DELETE\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int,@for_log varchar(8000)\r\n  Select @for_log=' id='+cast(id as varchar(50))+' firmano='+cast(firmano as varchar(50))+' marsatid='+cast(marsatid as varchar(50))+' varno='+cast(varno as varchar(50))+' sil='+cast(sil as varchar(50))+' tarih='+cast(tarih as varchar(50))+' saat='+saat+' perkod='+perkod+' stktip='+stktip+' stktipad='+stktipad+' stkod='+stkod+' mik='+cast(mik as varchar(50))+' brmfiy='+cast(brmfiy as varchar(50))+' olususer='+olususer+' olustarsaat='+cast(olustarsaat as varchar(50))+' deguser='+deguser+' kdvyuz='+cast(kdvyuz as varchar(50))+' degtarsaat='+cast(degtarsaat as varchar(50))+' dataok='+cast(dataok as varchar(50))+' kdvtip='+kdvtip+' kayok='+cast(kayok as varchar(50))+' parabrm='+parabrm+' kur='+cast(kur as varchar(50))+' brim='+brim+' barkod='+barkod+' satfiyno='+cast(satfiyno as varchar(50))+' depkod='+depkod+' islmtip='+islmtip+' islmtipad='+islmtipad+' yertip='+yertip+' yerad='+yerad+' varok='+cast(varok as varchar(50))+' indyuz='+cast(indyuz as varchar(50)) from deleted\r\n  exec sp_loglama @firmano,@id,'marsathrk',-2,@for_log\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "marsathrk_log_tri",
    "table_name": "marsathrk",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[marsathrk_log_tri] ON [dbo].[marsathrk]\r\nWITH EXECUTE AS CALLER\r\nFOR INSERT\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int\r\n  Select @firmano=firmano,@id=id from inserted\r\n  exec sp_loglama @firmano,@id,'marsathrk',1,''\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "marsathrk_log_tru",
    "table_name": "marsathrk",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[marsathrk_log_tru] ON [dbo].[marsathrk]\r\nWITH EXECUTE AS CALLER\r\nFOR UPDATE\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int,@sil bit\r\n  Select @firmano=firmano,@id=id,@sil=isnull(sil,0) from inserted\r\n  if update(sil) and (@sil=1)\r\n    exec sp_loglama @firmano,@id,'marsathrk',-1,''\r\n  else\r\n    exec sp_loglama @firmano,@id,'marsathrk',0,''\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "marsathrk_trd",
    "table_name": "marsathrk",
    "is_disabled": true,
    "definition": "CREATE TRIGGER [dbo].[marsathrk_trd] ON [dbo].[marsathrk]\r\nWITH EXECUTE AS CALLER\r\nFOR DELETE\r\nAS\r\nBEGIN\r\ndeclare @id float,@varno float,\r\n@sattop float,@marsatid float\r\ndeclare @kayok int,@say int\r\ndeclare @yertip varchar(30)\r\nSET NOCOUNT ON\r\n\r\nDECLARE marsathrksil CURSOR FAST_FORWARD FOR SELECT id,yertip,kayok,\r\nvarno,marsatid FROM deleted\r\n\r\n OPEN marsathrksil\r\n  FETCH NEXT FROM marsathrksil INTO  @id,@yertip,@kayok,@varno,@marsatid\r\n  WHILE @@FETCH_STATUS = 0\r\n  BEGIN\r\n\r\n  exec stokhrkisle @id,'marsathrk','',@kayok,1,@marsatid\r\n\r\n\r\nselect @say=count(*),@sattop=sum(mik*(brmfiy*kur)) from marsathrk where varno=@varno\r\nand marsatid=@marsatid and sil=0;\r\n\r\nif @sattop is NULL\r\n  set @sattop=0 \r\n  if @say>0\r\n  update marsatmas set satistop=@sattop where varno=@varno and marsatid=@marsatid;\r\n  else\r\n  begin\r\n  update marsatmas set satistop=0,iadetop=0,indtop=0 where varno=@varno and marsatid=@marsatid;\r\n  exec marketsatodesil @marsatid\r\n  end\r\n\r\n FETCH NEXT FROM marsathrksil INTO  @id,@yertip,@kayok,@varno,@marsatid\r\n  END\r\n  CLOSE marsathrksil\r\n  DEALLOCATE marsathrksil\r\n\r\n\r\n\r\nSET NOCOUNT OFF\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "marsathrk_tri",
    "table_name": "marsathrk",
    "is_disabled": true,
    "definition": "CREATE TRIGGER [dbo].[marsathrk_tri] ON [dbo].[marsathrk]\r\nWITH EXECUTE AS CALLER\r\nFOR UPDATE\r\nAS\r\nBEGIN\r\ndeclare @id \t\tfloat\r\ndeclare @varno \t\tfloat\r\ndeclare @sattop \tfloat\r\ndeclare @iadetop \tfloat\r\ndeclare @marsatid \tfloat\r\ndeclare @kayok \t\tint\r\ndeclare @sil \t\tint\r\ndeclare @yertip \tvarchar(20)\r\n\r\nSET NOCOUNT ON\r\n\r\n\r\nDECLARE marsathrkduz CURSOR FAST_FORWARD FOR \r\n SELECT inserted.id,yertip,inserted.sil,inserted.kayok,\r\ninserted.varno,inserted.marsatid FROM inserted\r\n\r\n OPEN marsathrkduz\r\n  FETCH NEXT FROM marsathrkduz INTO  @id,@yertip,@sil,@kayok,@varno,@marsatid\r\n  WHILE @@FETCH_STATUS = 0\r\n  BEGIN\r\n\r\n  exec stokhrkisle @id,'marsathrk','',@kayok,@sil\r\n\r\n  if @sil=1\r\n   exec marketsatodesil @marsatid\r\n\r\n   select @sattop=sum(case when islmtip='satis' then (mik*(brmfiy*kur)) else 0 end) ,\r\n   @iadetop=sum(case when islmtip='iade' then (mik*(brmfiy*kur)) else 0 end)\r\n   from marsathrk WITH(NOLOCK) where varno=@varno and marsatid=@marsatid and sil=0\r\n\r\n   if @sattop is NULL\r\n    set @sattop=0\r\n\r\n   if @iadetop is NULL\r\n   set @iadetop=0\r\n\r\n\r\n  update marsatmas set \r\n  satistop=@sattop,iadetop=@iadetop where \r\n  varno=@varno and marsatid=@marsatid\r\n\r\n\r\n  FETCH NEXT FROM marsathrkduz INTO  @id,@yertip,@sil,@kayok,@varno,@marsatid\r\n  END\r\n  CLOSE marsathrkduz\r\n  DEALLOCATE marsathrkduz\r\n\r\n\r\nSET NOCOUNT OFF\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "marsatmas_log_trd",
    "table_name": "marsatmas",
    "is_disabled": true,
    "definition": "CREATE TRIGGER [dbo].[marsatmas_log_trd] ON [dbo].[marsatmas]\r\nWITH EXECUTE AS CALLER\r\nFOR DELETE\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int,@for_log varchar(8000)\r\n  Select @for_log=' id='+cast(id as varchar(50))+' marsatid='+cast(marsatid as varchar(50))+' firmano='+cast(firmano as varchar(50))+' varno='+cast(varno as varchar(50))+' varok='+cast(varok as varchar(50))+' kayok='+cast(kayok as varchar(50))+' tarih='+cast(tarih as varchar(50))+' saat='+saat+' islmtip='+islmtip+' islmtipad='+islmtipad+' yertip='+yertip+' yerad='+yerad+' olususer='+olususer+' olustarsaat='+cast(olustarsaat as varchar(50))+' deguser='+deguser+' sil='+cast(sil as varchar(50))+' degtarsaat='+cast(degtarsaat as varchar(50))+' dataok='+cast(dataok as varchar(50))+' naktop='+cast(naktop as varchar(50))+' postop='+cast(postop as varchar(50))+' veresitop='+cast(veresitop as varchar(50))+' iadetop='+cast(iadetop as varchar(50))+' indtop='+cast(indtop as varchar(50))+' yuvtop='+cast(yuvtop as varchar(50))+' parabrm='+parabrm+' kur='+cast(kur as varchar(50))+' satistop='+cast(satistop as varchar(50)) from deleted\r\n  exec sp_loglama @firmano,@id,'marsatmas',-2,@for_log\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "marsatmas_log_tri",
    "table_name": "marsatmas",
    "is_disabled": true,
    "definition": "CREATE TRIGGER [dbo].[marsatmas_log_tri] ON [dbo].[marsatmas]\r\nWITH EXECUTE AS CALLER\r\nFOR INSERT\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int\r\n  Select @firmano=firmano,@id=id from inserted\r\n  exec sp_loglama @firmano,@id,'marsatmas',1,''\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "marsatmas_log_tru",
    "table_name": "marsatmas",
    "is_disabled": true,
    "definition": "CREATE TRIGGER [dbo].[marsatmas_log_tru] ON [dbo].[marsatmas]\r\nWITH EXECUTE AS CALLER\r\nFOR UPDATE\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int,@sil bit\r\n  Select @firmano=firmano,@id=id,@sil=isnull(sil,0) from inserted\r\n  if update(sil) and (@sil=1)\r\n    exec sp_loglama @firmano,@id,'marsatmas',-1,''\r\n  else\r\n    exec sp_loglama @firmano,@id,'marsatmas',0,''\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "marsatmas_trd",
    "table_name": "marsatmas",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[marsatmas_trd] ON [dbo].[marsatmas]\r\nWITH EXECUTE AS CALLER\r\nFOR DELETE\r\nAS\r\nbegin\r\ndeclare @varno float,\r\n@sattop float,@marsatid float\r\nSET NOCOUNT ON\r\n  \r\n\r\n  select @varno=varno,@marsatid=marsatid from deleted\r\n\r\n\r\n   if @marsatid=0\r\n    return\r\n\r\n\r\n  exec stokhrkisle 0,'marsathrk','',1,1,@marsatid\r\n  \r\n  delete from marsathrk where varno=@varno and marsatid=@marsatid\r\n  \r\n  exec SpRehberMarketSatisKomisyon @marsatid\r\n  \r\n  update marvardimas set \r\n   satistop=dt.satistop,\r\n   iadetop=dt.iadetop,\r\n   naksattop=dt.naktop,\r\n   postop=dt.postop,\r\n   veresitop=dt.veresitop,\r\n   indtop=dt.indtop\r\n   from marvardimas t WITH (NOLOCK) join\r\n   (select \r\n   isnull(sum(satistop),0) as satistop,\r\n   isnull(sum(iadetop),0) as iadetop,\r\n   isnull(sum(naktop),0) as naktop,\r\n   isnull(sum(postop),0) as postop,\r\n   isnull(sum(veresitop),0) as veresitop,\r\n   isnull(sum(indtop),0) as indtop\r\n   from  marsatmas WITH (NOLOCK) where \r\n   varno=@varno and sil=0 )\r\n   dt on t.varno=@varno and t.sil=0\r\n  \r\n \r\n  /*update from marvardimas set */\r\n\r\nSET NOCOUNT OFF\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "marsatmas_triu",
    "table_name": "marsatmas",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[marsatmas_triu] ON [dbo].[marsatmas]\r\nWITH EXECUTE AS CALLER\r\nFOR UPDATE\r\nAS\r\nBEGIN\r\ndeclare @varno \t\tfloat\r\ndeclare @sattop \tfloat\r\ndeclare @iadetop \tfloat\r\ndeclare @marsatid \tfloat\r\ndeclare @kayok \t\tint\r\ndeclare @sil \t\tint\r\ndeclare @varok \t\tint\r\ndeclare @id \t\tfloat\r\ndeclare @d_sil\t\tint\r\ndeclare @d_kayok\tint\r\n\r\nSET NOCOUNT ON\r\n\r\n\r\nBEGIN TRY\r\n    BEGIN TRAN\r\n\r\nDECLARE Cur_Marsat_Up CURSOR LOCAL FOR \r\n SELECT i.id,i.marsatid,i.sil,i.kayok,i.varno,i.varok,\r\n d.sil,d.kayok\r\n FROM inserted as i inner join deleted as d\r\n on d.id=i.id\r\n \r\n OPEN Cur_Marsat_Up\r\n  FETCH NEXT FROM Cur_Marsat_Up INTO  \r\n  @id,@marsatid,@sil,@kayok,@varno,@varok,\r\n  @d_sil,@d_kayok\r\n  WHILE @@FETCH_STATUS = 0\r\n  BEGIN\r\n\r\n\r\n   if @marsatid>0\r\n    begin\r\n\r\n   \r\n\r\n     if update(sil) and (@sil<>@d_sil)\r\n      begin\r\n      if @sil=1\r\n      begin\r\n       if @marsatid> 0\r\n        begin\r\n         update marsathrk set sil=1 where varno=@varno and marsatid=@marsatid\r\n         update markasahrk set sil=1 where varno=@varno and marsatid=@marsatid\r\n         update poshrk set sil=1 where varno=@varno and marsatid=@marsatid  \r\n         update carihrk set sil=1 where varno=@varno and marsatid=@marsatid\r\n         update veresimas set sil=1 where varno=@varno and marsatid=@marsatid\r\n       end  \r\n      end\r\n     end\r\n     \r\n     \r\n     if (@kayok=1) and ( (@sil<>@d_sil) or (@kayok<>@d_kayok) )\r\n     begin \r\n       exec MarSatRecHrkOlustur @marsatid\r\n       exec stokhrkisle @id,'marsathrk','',@kayok,@sil,@marsatid\r\n       exec SpRehberMarketSatisKomisyon @marsatid \r\n       exec SpMarketSatisBedelsizBarkod @marsatid\r\n      end    \r\n     \r\n\r\n   if (@sil<>@d_sil) or (@kayok=1 and @varok=0)\r\n      update marvardimas set \r\n       satistop=dt.satistop,\r\n       iadetop=dt.iadetop,\r\n       naksattop=dt.naktop,\r\n       /*postop=dt.postop, */\r\n       veresitop=dt.veresitop,\r\n       indtop=dt.indtop\r\n       from marvardimas t WITH (NOLOCK) join\r\n       (select \r\n       isnull(sum(satistop),0) as satistop,\r\n       isnull(sum(iadetop),0) as iadetop,\r\n       isnull(sum(naktop),0) as naktop,\r\n       isnull(sum(postop),0) as postop,\r\n       isnull(sum(veresitop),0) as veresitop,\r\n       isnull(sum(indtop),0) as indtop\r\n       from  marsatmas WITH (NOLOCK) where \r\n       varno=@varno and sil=0 )\r\n       dt on t.varno=@varno and t.sil=0\r\n   end    \r\n     \r\n\r\n   FETCH NEXT FROM Cur_Marsat_Up INTO  \r\n   @id,@marsatid,@sil,@kayok,@varno,@varok,\r\n  @d_sil,@d_kayok\r\n  END\r\n  CLOSE Cur_Marsat_Up\r\n  DEALLOCATE Cur_Marsat_Up\r\n\r\n\r\n\r\n  COMMIT TRAN\r\n    END TRY\r\n    BEGIN CATCH\r\n        RAISERROR('Errormessage', 18, 1)\r\n        ROLLBACK TRAN\r\n    END CATCH\r\n\r\n\r\n\r\nSET NOCOUNT OFF\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "marvardikap_log_trd",
    "table_name": "marvardikap",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[marvardikap_log_trd] ON [dbo].[marvardikap]\r\nWITH EXECUTE AS CALLER\r\nFOR DELETE\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int,@for_log varchar(8000)\r\n  Select @for_log=' id='+cast(id as varchar(50))+' firmano='+cast(firmano as varchar(50))+' varno='+cast(varno as varchar(50))+' varok='+cast(varok as varchar(50))+' sil='+cast(sil as varchar(50))+' kaptip='+kaptip+' kod='+kod+' tutar='+cast(tutar as varchar(50))+' cartip='+cartip+' ackfaz='+ackfaz+' olususer='+olususer+' olustarsaat='+cast(olustarsaat as varchar(50))+' dataok='+cast(dataok as varchar(50)) from deleted\r\n  exec sp_loglama @firmano,@id,'marvardikap',-2,@for_log\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "marvardikap_log_tri",
    "table_name": "marvardikap",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[marvardikap_log_tri] ON [dbo].[marvardikap]\r\nWITH EXECUTE AS CALLER\r\nFOR INSERT\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int\r\n  Select @firmano=firmano,@id=id from inserted\r\n  exec sp_loglama @firmano,@id,'marvardikap',1,''\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "marvardikap_log_tru",
    "table_name": "marvardikap",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[marvardikap_log_tru] ON [dbo].[marvardikap]\r\nWITH EXECUTE AS CALLER\r\nFOR UPDATE\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int,@sil bit\r\n  Select @firmano=firmano,@id=id,@sil=isnull(sil,0) from inserted\r\n  if update(sil) and (@sil=1)\r\n    exec sp_loglama @firmano,@id,'marvardikap',-1,''\r\n  else\r\n    exec sp_loglama @firmano,@id,'marvardikap',0,''\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "marvardimas_log_trd",
    "table_name": "marvardimas",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[marvardimas_log_trd] ON [dbo].[marvardimas]\r\nWITH EXECUTE AS CALLER\r\nFOR DELETE\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int,@for_log varchar(8000)\r\n  Select @for_log=' id='+cast(id as varchar(50))+' varno='+cast(varno as varchar(50))+' varok='+cast(varok as varchar(50))+' sil='+cast(sil as varchar(50))+' firmano='+cast(firmano as varchar(50))+' tarih='+cast(tarih as varchar(50))+' saat='+saat+' varad='+varad+' perkod='+perkod+' depkod='+depkod+' iadetop='+cast(iadetop as varchar(50))+' naktestop='+cast(naktestop as varchar(50))+' postop='+cast(postop as varchar(50))+' veresitop='+cast(veresitop as varchar(50))+' gidertop='+cast(gidertop as varchar(50))+' tahtop='+cast(tahtop as varchar(50))+' odetop='+cast(odetop as varchar(50))+' kaptar='+cast(kaptar as varchar(50))+' kapsaat='+kapsaat+' olususer='+olususer+' olustarsaat='+cast(olustarsaat as varchar(50))+' deguser='+deguser+' degtarsaat='+cast(degtarsaat as varchar(50))+' dataok='+cast(dataok as varchar(50))+' satistop='+cast(satistop as varchar(50))+' bozukpara='+cast(bozukpara as varchar(50))+' naksattop='+cast(naksattop as varchar(50))+' varackfaztip='+varackfaztip+' gelirtop='+cast(gelirtop as varchar(50)) from deleted\r\n  exec sp_loglama @firmano,@id,'marvardimas',-2,@for_log\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "marvardimas_log_tri",
    "table_name": "marvardimas",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[marvardimas_log_tri] ON [dbo].[marvardimas]\r\nWITH EXECUTE AS CALLER\r\nFOR INSERT\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int\r\n  Select @firmano=firmano,@id=id from inserted\r\n  exec sp_loglama @firmano,@id,'marvardimas',1,''\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "marvardimas_log_tru",
    "table_name": "marvardimas",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[marvardimas_log_tru] ON [dbo].[marvardimas]\r\nWITH EXECUTE AS CALLER\r\nFOR UPDATE\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int,@sil bit\r\n  Select @firmano=firmano,@id=id,@sil=isnull(sil,0) from inserted\r\n  if update(sil) and (@sil=1)\r\n    exec sp_loglama @firmano,@id,'marvardimas',-1,''\r\n  else\r\n    exec sp_loglama @firmano,@id,'marvardimas',0,''\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "marvardimas_trd",
    "table_name": "marvardimas",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[marvardimas_trd] ON [dbo].[marvardimas]\r\nWITH EXECUTE AS CALLER\r\nFOR DELETE\r\nAS\r\nBEGIN\r\n\r\ndeclare @varno int\r\ndeclare @firmano int\r\ndeclare @yertipyaz varchar(20)\r\ndeclare @yertip varchar(20)\r\nset @yertip='marvardimas'\r\nset @yertipyaz='yazarkasa'\r\n\r\n\r\nselect @firmano=firmano,@varno=varno from DELETED\r\n\r\n\r\nupdate marsatmas set sil=1 where varno=@varno\r\nand (yertip=@yertip or yertip=@yertipyaz) and sil=0;\r\nupdate veresimas set sil=1 where varno=@varno\r\nand (yertip=@yertip or yertip=@yertipyaz) and sil=0;\r\n\r\nupdate carihrk set sil=1 where varno=@varno\r\nand (yertip=@yertip or yertip=@yertipyaz) and sil=0;\r\n\r\nupdate kasahrk set sil=1 where varno=@varno\r\nand (yertip=@yertip or yertip=@yertipyaz) and sil=0;\r\nupdate bankahrk set sil=1 where varno=@varno\r\nand (yertip=@yertip or yertip=@yertipyaz) and sil=0;\r\nupdate poshrk set sil=1 where varno=@varno\r\nand (yertip=@yertip or yertip=@yertipyaz) and sil=0;\r\nupdate cekkart set sil=1 where varno=@varno\r\nand (yertip=@yertip or yertip=@yertipyaz) and sil=0;\r\n\r\n EXECUTE marvarkabul @varno,0,1\r\n \r\n EXECUTE  Market_BozukPara @firmano,@varno,1\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "marvardimas_tri",
    "table_name": "marvardimas",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[marvardimas_tri] ON [dbo].[marvardimas]\r\nWITH EXECUTE AS CALLER\r\nFOR UPDATE\r\nAS\r\nBEGIN\r\ndeclare @varno float,@varok int,@sil int\r\ndeclare @yertipyaz varchar(20)\r\ndeclare @yertip varchar(20)\r\ndeclare @firmano\tint\r\n\r\ndeclare @del_tarih  datetime\r\ndeclare @ins_tarih  datetime\r\n\r\nset @yertip='marvardimas'\r\nset @yertipyaz='yazarkasa'\r\n\r\n\r\n select @firmano=firmano,@varno=varno,@varok=varok,\r\n @sil=sil,@ins_tarih=tarih from inserted\r\n\r\n select @del_tarih=tarih from deleted\r\n\r\n\r\n\r\n\r\n\r\nif (UPDATE(varok) or UPDATE (sil))\r\nbegin\r\n\r\nupdate marsatmas set varok=@varok,sil=@sil where varno=@varno\r\n/* and (yertip=@yertip or yertip=@yertipyaz)  */\r\n and sil=0\r\n\r\n update veresimas set varok=@varok,sil=@sil where varno=@varno\r\n and (yertip=@yertip) and sil=0\r\n\r\n update carihrk set varok=@varok,sil=@sil where varno=@varno\r\n and (yertip=@yertip) and sil=0\r\n\r\n\r\n update kasahrk set varok=@varok,sil=@sil where varno=@varno\r\n  and (yertip=@yertip) and sil=0\r\n\r\n  \r\n update bankahrk set varok=@varok,sil=@sil where varno=@varno\r\n and (yertip=@yertip) and sil=0\r\n\r\n \r\n  update poshrk set varok=@varok,sil=@sil where varno=@varno\r\n and (yertip=@yertip) and sil=0\r\n   \r\n  update cekkart set varok=@varok,sil=@sil where varno=@varno\r\n   and (yertip=@yertip) and sil=0\r\n\r\n\r\n  EXECUTE marvarkabul @varno,@varok,@sil\r\n  \r\n\r\n  if @varok=1\r\n  exec Vardiya_Hrk_Tar_Ata @firmano,@varno,@yertip\r\n\r\n  \r\n   \r\nend\r\n\r\n\r\n  if (UPDATE(varno) or UPDATE (sil) or UPDATE(bozukpara) or update(kas_kod))\r\n     EXECUTE  Market_BozukPara @firmano,@varno,@sil \r\n\r\n  \r\n\r\n\r\n\r\n  if (UPDATE(tarih)) and (@del_tarih<>@ins_tarih) and (@varok=0)\r\n   begin\r\n       update marsathrk set tarih=@ins_tarih where varno=@varno\r\n       update marsatmas set tarih=@ins_tarih where varno=@varno\r\n   end   \r\n   \r\n \r\nSET NOCOUNT OFF\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "otomasgenkod_log_trd",
    "table_name": "otomasgenkod",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[otomasgenkod_log_trd] ON [dbo].[otomasgenkod]\r\nWITH EXECUTE AS CALLER\r\nFOR DELETE\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int,@for_log varchar(8000)\r\n  Select @for_log=' id='+cast(id as varchar(50))+' firmano='+cast(firmano as varchar(50))+' otomaskod='+otomaskod+' cartip='+cartip+' kod='+kod+' carkod='+carkod+' hrktip='+hrktip+' plaka='+plaka+' otomastip='+otomastip+' perkod='+perkod+' olususer='+olususer+' olustarsaat='+cast(olustarsaat as varchar(50))+' dataok='+cast(dataok as varchar(50))+' limit='+cast(limit as varchar(50))+' limitturu='+limitturu+' stkod='+stkod from deleted\r\n  exec sp_loglama @firmano,@id,'otomasgenkod',-2,@for_log\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "otomasgenkod_log_tri",
    "table_name": "otomasgenkod",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[otomasgenkod_log_tri] ON [dbo].[otomasgenkod]\r\nWITH EXECUTE AS CALLER\r\nFOR INSERT\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int\r\n  Select @firmano=firmano,@id=id from inserted\r\n  exec sp_loglama @firmano,@id,'otomasgenkod',1,''\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "otomasgenkod_log_tru",
    "table_name": "otomasgenkod",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[otomasgenkod_log_tru] ON [dbo].[otomasgenkod]\r\nWITH EXECUTE AS CALLER\r\nFOR UPDATE\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int,@sil bit\r\n  Select @firmano=firmano,@id=id,@sil=isnull(sil,0) from inserted\r\n  if update(sil) and (@sil=1)\r\n    exec sp_loglama @firmano,@id,'otomasgenkod',-1,''\r\n  else\r\n    exec sp_loglama @firmano,@id,'otomasgenkod',0,''\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "otomaskart_log_trd",
    "table_name": "otomaskart",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[otomaskart_log_trd] ON [dbo].[otomaskart]\r\nWITH EXECUTE AS CALLER\r\nFOR DELETE\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int,@for_log varchar(8000)\r\n  Select @for_log=' id='+cast(id as varchar(50))+' firmano='+cast(firmano as varchar(50))+' otmaskod='+otmaskod+' klasor='+klasor+' bassatir='+cast(bassatir as varchar(50))+' dosuznti='+dosuznti+' tarformat='+tarformat+' dostan='+dostan+' sonid='+cast(sonid as varchar(50))+' otomascari='+otomascari+' otomasper='+otomasper+' otofiload='+otofiload+' basid='+cast(basid as varchar(50))+' olususer='+olususer+' olustar='+cast(olustar as varchar(50))+' deguser='+deguser+' degtarsaat='+cast(degtarsaat as varchar(50))+' host='+host+' beg='+beg+' users='+users+' pass='+pass from deleted\r\n  exec sp_loglama @firmano,@id,'otomaskart',-2,@for_log\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "otomaskart_log_tri",
    "table_name": "otomaskart",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[otomaskart_log_tri] ON [dbo].[otomaskart]\r\nWITH EXECUTE AS CALLER\r\nFOR INSERT\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int\r\n  Select @firmano=firmano,@id=id from inserted\r\n  exec sp_loglama @firmano,@id,'otomaskart',1,''\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "otomaskart_log_tru",
    "table_name": "otomaskart",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[otomaskart_log_tru] ON [dbo].[otomaskart]\r\nWITH EXECUTE AS CALLER\r\nFOR UPDATE\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int,@sil bit\r\n  Select @firmano=firmano,@id=id,@sil=isnull(sil,0) from inserted\r\n  if update(sil) and (@sil=1)\r\n    exec sp_loglama @firmano,@id,'otomaskart',-1,''\r\n  else\r\n    exec sp_loglama @firmano,@id,'otomaskart',0,''\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "otomaskart_trd",
    "table_name": "otomaskart",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[otomaskart_trd] ON [dbo].[otomaskart]\r\nWITH EXECUTE AS CALLER\r\nFOR DELETE\r\nAS\r\nBEGIN\r\ndeclare @otamskod varchar(30);\r\n\r\nselect @otamskod=otmaskod from deleted;\r\n\r\n\r\ndelete from otomaskarthrk where otmaskod=@otamskod;\r\n\r\n\r\n\r\n\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "otomaskarthrk_log_trd",
    "table_name": "otomaskarthrk",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[otomaskarthrk_log_trd] ON [dbo].[otomaskarthrk]\r\nWITH EXECUTE AS CALLER\r\nFOR DELETE\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int,@for_log varchar(8000)\r\n  Select @for_log=' id='+cast(id as varchar(50))+' otmaskod='+otmaskod+' firmano='+cast(firmano as varchar(50))+' kod='+kod+' ad='+ad+' pos='+cast(pos as varchar(50))+' uzn='+cast(uzn as varchar(50))+' iptkar='+iptkar+' onpos='+cast(onpos as varchar(50))+' onuzn='+cast(onuzn as varchar(50))+' oku='+cast(oku as varchar(50))+' sr='+cast(sr as varchar(50)) from deleted\r\n  exec sp_loglama @firmano,@id,'otomaskarthrk',-2,@for_log\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "otomaskarthrk_log_tri",
    "table_name": "otomaskarthrk",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[otomaskarthrk_log_tri] ON [dbo].[otomaskarthrk]\r\nWITH EXECUTE AS CALLER\r\nFOR INSERT\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int\r\n  Select @firmano=firmano,@id=id from inserted\r\n  exec sp_loglama @firmano,@id,'otomaskarthrk',1,''\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "otomaskarthrk_log_tru",
    "table_name": "otomaskarthrk",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[otomaskarthrk_log_tru] ON [dbo].[otomaskarthrk]\r\nWITH EXECUTE AS CALLER\r\nFOR UPDATE\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int,@sil bit\r\n  Select @firmano=firmano,@id=id,@sil=isnull(sil,0) from inserted\r\n  if update(sil) and (@sil=1)\r\n    exec sp_loglama @firmano,@id,'otomaskarthrk',-1,''\r\n  else\r\n    exec sp_loglama @firmano,@id,'otomaskarthrk',0,''\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "otomasonlineoku_trd",
    "table_name": "otomasonlineoku",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[otomasonlineoku_trd] ON [dbo].[otomasonlineoku]\r\nWITH EXECUTE AS CALLER\r\nFOR DELETE\r\nAS\r\nBEGIN\r\n declare @firmano int\r\n declare @otomasad varchar(50)\r\n declare @sonsatir float\r\n declare @sontarih datetime\r\n declare @sondosya  varchar(30)\r\n\r\n  select @firmano=firmano,@otomasad=otomasad from deleted\r\n \r\n \r\n  select top 1 @sonsatir=isnull(otomasid,0),\r\n  @sondosya=dosya,\r\n  @sontarih=tarih from otomasonlineoku\r\n  where otomasad=@otomasad\r\n  order by id desc\r\n\r\n  update oto_onl_param\r\n  set sonsatirno=@sonsatir,sontarih=@sontarih,\r\n  sondosya=@sondosya where\r\n  firmano=@firmano and otomasad=@otomasad\r\n\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "parabrm_tri",
    "table_name": "parabrm",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[parabrm_tri] ON [dbo].[parabrm]\r\nWITH EXECUTE AS CALLER\r\nFOR INSERT\r\nAS\r\nBEGIN\r\ndeclare @ad varchar(20);\r\ndeclare @pbrm varchar(10);\r\n\r\nselect @pbrm=kod,@ad=ad FROM INSERTED\r\n\r\n insert into vardikasa (kod,AD,parabrm)\r\n VALUES (@pbrm,'VARDIYA KASASI',@pbrm)\r\n\r\n\r\n/*EXECUTE parabrimkasa @prbrm */\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "Pda_FaturaSayim_Hrk_triu",
    "table_name": "Pda_FaturaSayim_Hrk",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[Pda_FaturaSayim_Hrk_triu] ON [dbo].[Pda_FaturaSayim_Hrk]\r\nWITH EXECUTE AS CALLER\r\nFOR INSERT, UPDATE\r\nAS\r\nBEGIN\r\n\r\ndeclare @fatsayid int\r\n\r\n select @fatsayid=fatsayid from inserted\r\n\r\n  update Pda_faturasayim_mas set\r\n  stk_top_mik=isnull((select sum(miktar) from pda_faturasayim_hrk\r\n  where fatsayid=@fatsayid and sil=0),0) where id=@fatsayid\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "Pda_OffSayim_Hrk_triu",
    "table_name": "Pda_OffSayim_Hrk",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[Pda_OffSayim_Hrk_triu] ON [dbo].[Pda_OffSayim_Hrk]\r\nWITH EXECUTE AS CALLER\r\nFOR INSERT, UPDATE\r\nAS\r\nBEGIN\r\n\r\ndeclare @offsayid int\r\n\r\n select @offsayid=offsayid from inserted\r\n\r\n  update Pda_OffSayim_Mas set\r\n  stk_top_mik=isnull((select sum(miktar) from Pda_OffSayim_Hrk\r\n  where offsayid=@offsayid and sil=0),0) where id=@offsayid\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "Pda_OffSayim_Mas_trd",
    "table_name": "Pda_OffSayim_Mas",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[Pda_OffSayim_Mas_trd] ON [dbo].[Pda_OffSayim_Mas]\r\nWITH EXECUTE AS CALLER\r\nFOR DELETE\r\nAS\r\nBEGIN\r\n\r\ndeclare @id int\r\n\r\n select @id=id from deleted\r\n\r\n delete from Pda_OffSayim_Hrk where offsayid=@id\r\n \r\n\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "Per_Cari_trd",
    "table_name": "Per_Cari",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[Per_Cari_trd] ON [dbo].[Per_Cari]\r\nWITH EXECUTE AS CALLER\r\nFOR DELETE\r\nAS\r\nBEGIN\r\n  \r\n  update carikart set Per_id=0\r\n  from carikart as t join \r\n  (select car_id,per_id from inserted) dt on\r\n  dt.car_id=t.id\r\n\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "Per_Cari_triu",
    "table_name": "Per_Cari",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[Per_Cari_triu] ON [dbo].[Per_Cari]\r\nWITH EXECUTE AS CALLER\r\nFOR INSERT, UPDATE\r\nAS\r\nBEGIN\r\n\r\n  update carikart set Per_id=dt.per_id \r\n  from carikart as t join \r\n  (select car_id,per_id from inserted) dt on\r\n  dt.car_id=t.id\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "perakendekart_log_trd",
    "table_name": "perakendekart",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[perakendekart_log_trd] ON [dbo].[perakendekart]\r\nWITH EXECUTE AS CALLER\r\nFOR DELETE\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int,@for_log varchar(8000)\r\n  Select @for_log=' id='+cast(id as varchar(50))+' firmano='+cast(firmano as varchar(50))+' sil='+cast(sil as varchar(50))+' drm='+drm+' kod='+kod+' ad='+ad+' soyad='+soyad+' unvan='+unvan+' grp1='+cast(grp1 as varchar(50))+' grp2='+cast(grp2 as varchar(50))+' grp3='+cast(grp3 as varchar(50))+' ilgili='+ilgili+' tel='+tel+' fax='+fax+' cep='+cep+' muhkod='+muhkod+' adres='+adres+' evil='+evil+' evilce='+evilce+' vergidaire='+vergidaire+' vergino='+vergino+' mail='+mail+' tcno='+tcno+' kulkod='+kulkod+' kulsif='+kulsif+' fisbak='+cast(fisbak as varchar(50))+' carbak='+cast(carbak as varchar(50))+' olususer='+olususer+' olustarsaat='+cast(olustarsaat as varchar(50))+' deguser='+deguser+' degtarsaat='+cast(degtarsaat as varchar(50))+' dataok='+cast(dataok as varchar(50))+' parabrm='+parabrm+' adres2='+adres2+' fisadet='+cast(fisadet as varchar(50)) from deleted\r\n  exec sp_loglama @firmano,@id,'perakendekart',-2,@for_log\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "perakendekart_log_tri",
    "table_name": "perakendekart",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[perakendekart_log_tri] ON [dbo].[perakendekart]\r\nWITH EXECUTE AS CALLER\r\nFOR INSERT\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int\r\n  Select @firmano=firmano,@id=id from inserted\r\n  exec sp_loglama @firmano,@id,'perakendekart',1,''\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "perakendekart_log_tru",
    "table_name": "perakendekart",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[perakendekart_log_tru] ON [dbo].[perakendekart]\r\nWITH EXECUTE AS CALLER\r\nFOR UPDATE\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int,@sil bit\r\n  Select @firmano=firmano,@id=id,@sil=isnull(sil,0) from inserted\r\n  if update(sil) and (@sil=1)\r\n    exec sp_loglama @firmano,@id,'perakendekart',-1,''\r\n  else\r\n    exec sp_loglama @firmano,@id,'perakendekart',0,''\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "perakendekart_tri",
    "table_name": "perakendekart",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[perakendekart_tri] ON [dbo].[perakendekart]\r\nWITH EXECUTE AS CALLER\r\nFOR INSERT\r\nAS\r\nBEGIN\r\ndeclare @kod varchar(20);\r\nDECLARE @id float;\r\n\r\nselect @id=id,@kod=kod from inserted;\r\n\r\nEXEC numara_no_yaz 'perakendekart',@kod\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "perakendekart_tru",
    "table_name": "perakendekart",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[perakendekart_tru] ON [dbo].[perakendekart]\r\nWITH EXECUTE AS CALLER\r\nFOR UPDATE\r\nAS\r\nBEGIN\r\ndeclare @kod varchar(20);\r\nDECLARE @id float;\r\n\r\nselect @id=id,@kod=kod from inserted;\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "perkart_log_trd",
    "table_name": "perkart",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[perkart_log_trd] ON [dbo].[perkart]\r\nWITH EXECUTE AS CALLER\r\nFOR DELETE\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int,@for_log varchar(8000)\r\n  Select @for_log=' id='+cast(id as varchar(50))+' drm='+drm+' sil='+cast(sil as varchar(50))+' firmano='+cast(firmano as varchar(50))+' kod='+kod+' ad='+ad+' soyad='+soyad+' grp1='+cast(grp1 as varchar(50))+' grp2='+cast(grp2 as varchar(50))+' grp3='+cast(grp3 as varchar(50))+' tel='+tel+' fax='+fax+' cep='+cep+' muhkod='+muhkod+' adres='+adres+' evil='+evil+' evilce='+evilce+' vergidaire='+vergidaire+' vergino='+vergino+' mail='+mail+' tcno='+tcno+' toplim='+cast(toplim as varchar(50))+' maasgun='+cast(maasgun as varchar(50))+' maas='+cast(maas as varchar(50))+' prim='+cast(prim as varchar(50))+' isk='+cast(isk as varchar(50))+' isbastar='+cast(isbastar as varchar(50))+' isbittar='+cast(isbittar as varchar(50))+' fisbak='+cast(fisbak as varchar(50))+' carbak='+cast(carbak as varchar(50))+' gos='+cast(gos as varchar(50))+' olususer='+olususer+' olustarsaat='+cast(olustarsaat as varchar(50))+' deguser='+deguser+' degtarsaat='+cast(degtarsaat as varchar(50))+' dataok='+cast(dataok as varchar(50))+' fisadet='+cast(fisadet as varchar(50))+' fisaktut='+cast(fisaktut as varchar(50))+' fisakadet='+cast(fisakadet as varchar(50))+' parabrm='+parabrm+' actutar='+cast(actutar as varchar(50))+' adres2='+adres2 from deleted\r\n  exec sp_loglama @firmano,@id,'perkart',-2,@for_log\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "perkart_log_tri",
    "table_name": "perkart",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[perkart_log_tri] ON [dbo].[perkart]\r\nWITH EXECUTE AS CALLER\r\nFOR INSERT\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int\r\n  Select @firmano=firmano,@id=id from inserted\r\n  exec sp_loglama @firmano,@id,'perkart',1,''\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "perkart_log_tru",
    "table_name": "perkart",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[perkart_log_tru] ON [dbo].[perkart]\r\nWITH EXECUTE AS CALLER\r\nFOR UPDATE\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int,@sil bit\r\n  Select @firmano=firmano,@id=id,@sil=isnull(sil,0) from inserted\r\n  if update(sil) and (@sil=1)\r\n    exec sp_loglama @firmano,@id,'perkart',-1,''\r\n  else\r\n    exec sp_loglama @firmano,@id,'perkart',0,''\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "perkart_tri",
    "table_name": "perkart",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[perkart_tri] ON [dbo].[perkart]\r\nWITH EXECUTE AS CALLER\r\nFOR INSERT\r\nAS\r\nBEGIN\r\ndeclare @kod varchar(20);\r\nDECLARE @id float;\r\n\r\nselect @id=id,@kod=kod from inserted;\r\n\r\nEXEC carikartacilis 'perkart',@kod;\r\n\r\nEXEC numara_no_yaz 'perkart',@kod\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "perkart_tru",
    "table_name": "perkart",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[perkart_tru] ON [dbo].[perkart]\r\nWITH EXECUTE AS CALLER\r\nFOR UPDATE\r\nAS\r\nBEGIN\r\n\r\ndeclare @kod varchar(20);\r\nDECLARE @id float;\r\n\r\nselect @id=id,@kod=kod from inserted;\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "permaashrk_log_trd",
    "table_name": "permaashrk",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[permaashrk_log_trd] ON [dbo].[permaashrk]\r\nWITH EXECUTE AS CALLER\r\nFOR DELETE\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int,@for_log varchar(8000)\r\n  Select @for_log=' id='+cast(id as varchar(50))+' permaashrkid='+cast(permaashrkid as varchar(50))+' firmano='+cast(firmano as varchar(50))+' tarih='+cast(tarih as varchar(50))+' saat='+saat+' carkod='+carkod+' cartip='+cartip+' gidkod='+gidkod+' olustarsaat='+cast(olustarsaat as varchar(50))+' olususer='+olususer+' deguser='+deguser+' degtarsaat='+cast(degtarsaat as varchar(50))+' kur='+cast(kur as varchar(50))+' parabrm='+parabrm+' tutar='+cast(tutar as varchar(50))+' yertip='+yertip+' yerad='+yerad+' belno='+belno+' ack='+ack from deleted\r\n  exec sp_loglama @firmano,@id,'permaashrk',-2,@for_log\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "permaashrk_log_tri",
    "table_name": "permaashrk",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[permaashrk_log_tri] ON [dbo].[permaashrk]\r\nWITH EXECUTE AS CALLER\r\nFOR INSERT\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int\r\n  Select @firmano=firmano,@id=id from inserted\r\n  exec sp_loglama @firmano,@id,'permaashrk',1,''\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "permaashrk_log_tru",
    "table_name": "permaashrk",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[permaashrk_log_tru] ON [dbo].[permaashrk]\r\nWITH EXECUTE AS CALLER\r\nFOR UPDATE\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int,@sil bit\r\n  Select @firmano=firmano,@id=id,@sil=isnull(sil,0) from inserted\r\n  if update(sil) and (@sil=1)\r\n    exec sp_loglama @firmano,@id,'permaashrk',-1,''\r\n  else\r\n    exec sp_loglama @firmano,@id,'permaashrk',0,''\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "permaashrk_triu",
    "table_name": "permaashrk",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[permaashrk_triu] ON [dbo].[permaashrk]\r\nWITH EXECUTE AS CALLER\r\nFOR INSERT, UPDATE\r\nAS\r\nBEGIN\r\n\r\ndeclare @id int\r\ndeclare @sil int\r\ndeclare @permasmasid int\r\n\r\n  SELECT @id=id,@permasmasid=permaashrkid,@sil=sil from inserted;\r\n\r\n\r\n exec personelmaas @id,@sil\r\n\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "pomvardikap_log_trd",
    "table_name": "pomvardikap",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[pomvardikap_log_trd] ON [dbo].[pomvardikap]\r\nWITH EXECUTE AS CALLER\r\nFOR DELETE\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int,@for_log varchar(8000)\r\n  Select @for_log=' id='+cast(id as varchar(50))+' varno='+cast(varno as varchar(50))+' varok='+cast(varok as varchar(50))+' sil='+cast(sil as varchar(50))+' firmano='+cast(firmano as varchar(50))+' kaptip='+kaptip+' kod='+kod+' tutar='+cast(tutar as varchar(50))+' cartip='+cartip+' ackfaz='+ackfaz+' olususer='+olususer+' olustarsaat='+cast(olustarsaat as varchar(50))+' dataok='+cast(dataok as varchar(50)) from deleted\r\n  exec sp_loglama @firmano,@id,'pomvardikap',-2,@for_log\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "pomvardikap_log_tri",
    "table_name": "pomvardikap",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[pomvardikap_log_tri] ON [dbo].[pomvardikap]\r\nWITH EXECUTE AS CALLER\r\nFOR INSERT\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int\r\n  Select @firmano=firmano,@id=id from inserted\r\n  exec sp_loglama @firmano,@id,'pomvardikap',1,''\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "pomvardikap_log_tru",
    "table_name": "pomvardikap",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[pomvardikap_log_tru] ON [dbo].[pomvardikap]\r\nWITH EXECUTE AS CALLER\r\nFOR UPDATE\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int,@sil bit\r\n  Select @firmano=firmano,@id=id,@sil=isnull(sil,0) from inserted\r\n  if update(sil) and (@sil=1)\r\n    exec sp_loglama @firmano,@id,'pomvardikap',-1,''\r\n  else\r\n    exec sp_loglama @firmano,@id,'pomvardikap',0,''\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "pomvardimas_log_trd",
    "table_name": "pomvardimas",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[pomvardimas_log_trd] ON [dbo].[pomvardimas]\r\nWITH EXECUTE AS CALLER\r\nFOR DELETE\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int,@for_log varchar(8000)\r\n  Select @for_log=' id='+cast(id as varchar(50))+' varno='+cast(varno as varchar(50))+' varok='+cast(varok as varchar(50))+' firmano='+cast(firmano as varchar(50))+' tarih='+cast(tarih as varchar(50))+' saat='+saat+' varad='+varad+' dataok='+cast(dataok as varchar(50))+' sil='+cast(sil as varchar(50))+' adabag='+cast(adabag as varchar(50))+' aksatmik='+cast(aksatmik as varchar(50))+' aksattop='+cast(aksattop as varchar(50))+' naktestop='+cast(naktestop as varchar(50))+' postop='+cast(postop as varchar(50))+' veresitop='+cast(veresitop as varchar(50))+' malsattop='+cast(malsattop as varchar(50))+' gelirtop='+cast(gelirtop as varchar(50))+' gidertop='+cast(gidertop as varchar(50))+' tahtop='+cast(tahtop as varchar(50))+' odetop='+cast(odetop as varchar(50))+' kaptar='+cast(kaptar as varchar(50))+' kapsaat='+kapsaat+' otocheck='+cast(otocheck as varchar(50))+' otomastop='+cast(otomastop as varchar(50))+' olususer='+olususer+' olustarsaat='+cast(olustarsaat as varchar(50))+' deguser='+deguser+' degtarsaat='+cast(degtarsaat as varchar(50))+' varackfaztip='+varackfaztip from deleted\r\n  exec sp_loglama @firmano,@id,'pomvardimas',-2,@for_log\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "pomvardimas_log_tri",
    "table_name": "pomvardimas",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[pomvardimas_log_tri] ON [dbo].[pomvardimas]\r\nWITH EXECUTE AS CALLER\r\nFOR INSERT\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int\r\n  Select @firmano=firmano,@id=id from inserted\r\n  exec sp_loglama @firmano,@id,'pomvardimas',1,''\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "pomvardimas_log_tru",
    "table_name": "pomvardimas",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[pomvardimas_log_tru] ON [dbo].[pomvardimas]\r\nWITH EXECUTE AS CALLER\r\nFOR UPDATE\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int,@sil bit\r\n  Select @firmano=firmano,@id=id,@sil=isnull(sil,0) from inserted\r\n  if update(sil) and (@sil=1)\r\n    exec sp_loglama @firmano,@id,'pomvardimas',-1,''\r\n  else\r\n    exec sp_loglama @firmano,@id,'pomvardimas',0,''\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "pomvardimas_trd",
    "table_name": "pomvardimas",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[pomvardimas_trd] ON [dbo].[pomvardimas]\r\nWITH EXECUTE AS CALLER\r\nFOR DELETE\r\nAS\r\nBEGIN\r\ndeclare @varno     varchar(50);\r\ndeclare @mesaj     varchar(500)\r\ndeclare @yertip    varchar(30)\r\nSET NOCOUNT ON\r\n\r\n\r\nset @yertip='pomvardimas'\r\n\r\nselect @varno=varno from deleted;\r\n\r\n\r\n    /*sonra Vardiya Varmi */\r\n    if (SELECT COUNT(*) FROM pomvardimas WHERE sil=0 and varno>@varno)>0\r\n    begin\r\n    select @mesaj='Seçmiş Olduğunuz Vardiyadan Sonra Vardiya Var..!'+char(13)+char(10)+\r\n    ' (Sayaç Endekleri Etkilemektedir.)';\r\n    if @mesaj<>''\r\n     begin\r\n      RAISERROR (@mesaj, 16,1)\r\n      ROLLBACK TRANSACTION\r\n      RETURN\r\n    end\r\n    end\r\n\r\n\r\n/* havuza girlmiş fis varsa havuza al */\r\n\r\n declare @idler varchar(8000)\r\n select @idler=COALESCE(@idler+',','','')+cast(verid as varchar)\r\n from veresimas where varno=@varno and havuzfis=1 and sil=0\r\n\r\n exec havuzfisaktar 0,0,@idler,@varno\r\n /* havuza girilmiş fis varsa havuza al */\r\n\r\n\r\ndelete FROM pomvardisayac where varno=@varno \r\ndelete FROM pomvardiperada where varno=@varno \r\ndelete FROM pomvardiper where varno=@varno \r\ndelete FROM pomvardistok where varno=@varno\r\ndelete FROM pomvarditank where varno=@varno \r\ndelete FROM poshrk where varno=@varno and yertip=@yertip\r\ndelete FROM emtiasat where varno=@varno and yertip=@yertip\r\ndelete FROM kasahrk where varno=@varno and yertip=@yertip\r\ndelete FROM veresimas where varno=@varno and yertip=@yertip\r\ndelete FROM carihrk where varno=@varno and yertip=@yertip\r\n\r\n\r\ndelete FROM stkhrk where varno=@varno and yertip=@yertip\r\ndelete FROM sayachrk where varno=@varno and yertip=@yertip\r\n\r\nSET NOCOUNT OFF\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "pomvardimas_tri",
    "table_name": "pomvardimas",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[pomvardimas_tri] ON [dbo].[pomvardimas]\r\nWITH EXECUTE AS CALLER\r\nFOR INSERT\r\nAS\r\nBEGIN\r\n\r\ndeclare @varno float,@varok int,@sil int;\r\ndeclare @d_varok int;\r\ndeclare @yertip varchar(20);\r\nset @yertip='pomvardimas';\r\n\r\nselect @varno=ins.varno,@varok=ins.varok,@sil=ins.sil\r\nfrom inserted as ins \r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "pomvardimas_tru",
    "table_name": "pomvardimas",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[pomvardimas_tru] ON [dbo].[pomvardimas]\r\nWITH EXECUTE AS CALLER\r\nFOR UPDATE\r\nAS\r\nBEGIN\r\n\r\n\r\nSET NOCOUNT ON\r\nSET XACT_ABORT ON /*rollback */\r\n\r\ndeclare @varno float,@varok int,@sil int\r\ndeclare @firmano int\r\ndeclare @d_varok int\r\ndeclare @ver_ak_sayi  int\r\ndeclare @pos_ak_sayi  int\r\ndeclare @mesaj     varchar(500)\r\ndeclare @admin\t   bit\r\n\r\n\r\ndeclare @yertip varchar(20)\r\nset @yertip='pomvardimas'\r\n\r\nselect @firmano=ins.firmano,@varno=ins.varno,@varok=ins.varok,@sil=ins.sil,\r\n@d_varok=isnull(del.varok,0),@admin=isnull(ins.admin,0)\r\nfrom inserted as ins left join deleted as del on del.id=ins.id\r\n\r\n\r\n/*-sadece varokleme yada geri alma */\r\nif UPDATE(varok)\r\nbegin\r\n if @varok=0\r\n  begin\r\n  /*geri alma durumda kontroller */\r\n   /*\r\n    --verisiye fis aktarÄ±m kontrol\r\n    SELECT @ver_ak_sayi=COUNT(*) FROM veresimas WHERE aktip<>'BK' and sil=0 and varno=@varno\r\n    --pos aktarÄ±m kontrol\r\n    SELECT @pos_ak_sayi=COUNT(*) FROM poshrk WHERE aktip<>'BK' and sil=0 and varno=@varno\r\n    \r\n    set @mesaj=''\r\n    if (@ver_ak_sayi>0)\r\n    select @mesaj=cast(@ver_ak_sayi as varchar)+' Tane AktarÄ±lmÄ±ÅŸ FiÅŸiniz Var..!'+char(13)+char(10)\r\n    \r\n    if (@pos_ak_sayi>0)\r\n    set @mesaj=@mesaj+cast(@pos_ak_sayi as varchar)+' Tane AktarÄ±lmÄ±ÅŸ Pos Slibiniz Var..!'+char(13)+char(10)\r\n\r\n    if @mesaj<>''\r\n     begin\r\n      RAISERROR (@mesaj, 16,1)\r\n      ROLLBACK TRANSACTION\r\n      RETURN\r\n    end\r\n   */\r\n \r\n \r\n   exec pomvardistokduzelt @varno\r\n \r\n end\r\n \r\n \r\n if @varok=1\r\n  exec Vardiya_Hrk_Tar_Ata @firmano,@varno,@yertip\r\n \r\n\r\n  update pomvardisayac set varok=@varok  where varno=@varno and sil=0\r\n  update pomvardiperada set varok=@varok     where varno=@varno and sil=0\r\n  update pomvardiper set varok=@varok   where varno=@varno and sil=0\r\n  update pomvardistok set varok=@varok    where varno=@varno and sil=0\r\n  update pomvarditank set varok=@varok    where varno=@varno and sil=0\r\n  update pomvardikap set varok=@varok    where varno=@varno and sil=0\r\n\r\n\r\n  update veresimas set varok=@varok   where varno=@varno and yertip=@yertip and sil=0\r\n  update carihrk set varok=@varok    where varno=@varno and yertip=@yertip and sil=0\r\n  update emtiasat set varok=@varok   where varno=@varno and yertip=@yertip and sil=0\r\n  update kasahrk set varok=@varok   where varno=@varno and yertip=@yertip and sil=0\r\n  update bankahrk set varok=@varok    where varno=@varno and yertip=@yertip and sil=0\r\n  update poshrk set varok=@varok    where varno=@varno and yertip=@yertip and sil=0\r\n  update cekkart set varok=@varok    where varno=@varno and yertip=@yertip and sil=0\r\n  \r\n  \r\n  exec SpPomvardiVeresiTTSKont @firmano,@varno\r\n  \r\n  end\r\n\r\n \r\n\r\n\r\n/*--sadece silme */\r\n \r\n    if UPDATE(sil) and (@sil=1)\r\n     begin\r\n       \r\n      if @admin=0\r\n         begin\r\n         /*sonra Vardiya Varmi */\r\n          if EXISTS (SELECT id FROM pomvardimas with (nolock) WHERE sil=0 and firmano=@firmano and varno>@varno )\r\n          begin\r\n          select @mesaj='Seçmiş Olduğunuz Vardiyadan Sonra Vardiya Var..!'+char(13)+char(10)+\r\n          ' (Sayaç Endeksleri Etkilemektedir.)';\r\n          if @mesaj<>''\r\n           begin\r\n            RAISERROR (@mesaj, 16,1)\r\n            ROLLBACK TRANSACTION\r\n            RETURN\r\n          end\r\n         end\r\n        end\r\n\r\n      /* havuza girilmis fis varsa havuza al */\r\n      if @Sil=1\r\n       begin\r\n       declare @idler varchar(max)\r\n       select @idler=COALESCE(@idler+',','','')+cast(cast(verid as bigint) as varchar)\r\n       from veresimas with (nolock) where varno=@varno and havuzfis=1 and sil=0\r\n\r\n        exec havuzfisaktar_max 0,0,@idler,@varno\r\n          /* havuzdan girilmis fis varsa havuza al */\r\n      \r\n   \r\n     update pomvardisayac set sil=@sil where varno=@varno and sil=0\r\n       update pomvardiperada set sil=@sil  where varno=@varno and sil=0\r\n      update pomvardiper set sil=@sil  where varno=@varno and sil=0\r\n      update pomvardistok set sil=@sil  where varno=@varno and sil=0\r\n      update pomvarditank set sil=@sil  where varno=@varno and sil=0\r\n      update pomvardikap set sil=@sil  where varno=@varno and sil=0\r\n   \r\n\r\n      update veresimas set sil=@sil where varno=@varno and yertip=@yertip and sil=0\r\n      update carihrk set sil=@sil  where varno=@varno and yertip=@yertip and sil=0\r\n      update emtiasat set sil=@sil  where varno=@varno and yertip=@yertip and sil=0\r\n      update kasahrk set sil=@sil  where varno=@varno and yertip=@yertip and sil=0\r\n      update bankahrk set sil=@sil  where varno=@varno and yertip=@yertip and sil=0\r\n      update poshrk set sil=@sil where varno=@varno and yertip=@yertip and sil=0\r\n      update cekkart set sil=@sil  where varno=@varno and yertip=@yertip and sil=0\r\n     \r\n        update zrapormas set Sil=1 where Sil=0 and \r\n         zrapid in (select Zrapid from ZraporVardiya\r\n        where  varno=@varno and varTip=1 and Sil=0 )\r\n     \r\n     \r\n    end\r\n  end\r\n\r\n \r\n\r\n  if UPDATE (sil) or UPDATE(varok)\r\n    EXECUTE pomvarkabul @firmano,@varno,@varok,@sil\r\n\r\n END"
  },
  {
    "schema": "dbo",
    "trigger_name": "pomvardiper_log_trd",
    "table_name": "pomvardiper",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[pomvardiper_log_trd] ON [dbo].[pomvardiper]\r\nWITH EXECUTE AS CALLER\r\nFOR DELETE\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int,@for_log varchar(8000)\r\n  Select @for_log=' id='+cast(id as varchar(50))+' varno='+cast(varno as varchar(50))+' varok='+cast(varok as varchar(50))+' sil='+cast(sil as varchar(50))+' firmano='+cast(firmano as varchar(50))+' per='+per+' perad='+perad+' sr='+cast(sr as varchar(50))+' perackfaz='+cast(perackfaz as varchar(50)) from deleted\r\n  exec sp_loglama @firmano,@id,'pomvardiper',-2,@for_log\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "pomvardiper_log_tri",
    "table_name": "pomvardiper",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[pomvardiper_log_tri] ON [dbo].[pomvardiper]\r\nWITH EXECUTE AS CALLER\r\nFOR INSERT\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int\r\n  Select @firmano=firmano,@id=id from inserted\r\n  exec sp_loglama @firmano,@id,'pomvardiper',1,''\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "pomvardiper_log_tru",
    "table_name": "pomvardiper",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[pomvardiper_log_tru] ON [dbo].[pomvardiper]\r\nWITH EXECUTE AS CALLER\r\nFOR UPDATE\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int,@sil bit\r\n  Select @firmano=firmano,@id=id,@sil=isnull(sil,0) from inserted\r\n  if update(sil) and (@sil=1)\r\n    exec sp_loglama @firmano,@id,'pomvardiper',-1,''\r\n  else\r\n    exec sp_loglama @firmano,@id,'pomvardiper',0,''\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "pomvardiperada_log_trd",
    "table_name": "pomvardiperada",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[pomvardiperada_log_trd] ON [dbo].[pomvardiperada]\r\nWITH EXECUTE AS CALLER\r\nFOR DELETE\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int,@for_log varchar(8000)\r\n  Select @for_log=' id='+cast(id as varchar(50))+' varno='+cast(varno as varchar(50))+' varok='+cast(varok as varchar(50))+' firmano='+cast(firmano as varchar(50))+' sil='+cast(sil as varchar(50))+' per='+per+' sr='+cast(sr as varchar(50))+' adaid='+cast(adaid as varchar(50))+' adad='+adad from deleted\r\n  exec sp_loglama @firmano,@id,'pomvardiperada',-2,@for_log\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "pomvardiperada_log_tri",
    "table_name": "pomvardiperada",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[pomvardiperada_log_tri] ON [dbo].[pomvardiperada]\r\nWITH EXECUTE AS CALLER\r\nFOR INSERT\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int\r\n  Select @firmano=firmano,@id=id from inserted\r\n  exec sp_loglama @firmano,@id,'pomvardiperada',1,''\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "pomvardiperada_log_tru",
    "table_name": "pomvardiperada",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[pomvardiperada_log_tru] ON [dbo].[pomvardiperada]\r\nWITH EXECUTE AS CALLER\r\nFOR UPDATE\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int,@sil bit\r\n  Select @firmano=firmano,@id=id,@sil=isnull(sil,0) from inserted\r\n  if update(sil) and (@sil=1)\r\n    exec sp_loglama @firmano,@id,'pomvardiperada',-1,''\r\n  else\r\n    exec sp_loglama @firmano,@id,'pomvardiperada',0,''\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "pomvardisayac_log_trd",
    "table_name": "pomvardisayac",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[pomvardisayac_log_trd] ON [dbo].[pomvardisayac]\r\nWITH EXECUTE AS CALLER\r\nFOR DELETE\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int,@for_log varchar(8000)\r\n  Select @for_log=' id='+cast(id as varchar(50))+' firmano='+cast(firmano as varchar(50))+' varno='+cast(varno as varchar(50))+' varok='+cast(varok as varchar(50))+' sil='+cast(sil as varchar(50))+' perkod='+perkod+' perad='+perad+' adad='+adad+' sayackod='+sayackod+' ilkendk='+cast(ilkendk as varchar(50))+' sonendk='+cast(sonendk as varchar(50))+' digermik='+cast(digermik as varchar(50))+' satmik='+cast(satmik as varchar(50))+' testmik='+cast(testmik as varchar(50))+' transfermik='+cast(transfermik as varchar(50))+' brimfiy='+cast(brimfiy as varchar(50))+' tutar='+cast(tutar as varchar(50))+' sayacad='+sayacad+' tankod='+tankod+' transfertank='+transfertank+' stkod='+stkod+' adaid='+cast(adaid as varchar(50))+' stktip='+stktip+' kdvyuz='+cast(kdvyuz as varchar(50))+' enktur='+enktur from deleted\r\n  exec sp_loglama @firmano,@id,'pomvardisayac',-2,@for_log\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "pomvardisayac_log_tri",
    "table_name": "pomvardisayac",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[pomvardisayac_log_tri] ON [dbo].[pomvardisayac]\r\nWITH EXECUTE AS CALLER\r\nFOR INSERT\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int\r\n  Select @firmano=firmano,@id=id from inserted\r\n  exec sp_loglama @firmano,@id,'pomvardisayac',1,''\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "pomvardisayac_log_tru",
    "table_name": "pomvardisayac",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[pomvardisayac_log_tru] ON [dbo].[pomvardisayac]\r\nWITH EXECUTE AS CALLER\r\nFOR UPDATE\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int,@sil bit\r\n  Select @firmano=firmano,@id=id,@sil=isnull(sil,0) from inserted\r\n  if update(sil) and (@sil=1)\r\n    exec sp_loglama @firmano,@id,'pomvardisayac',-1,''\r\n  else\r\n    exec sp_loglama @firmano,@id,'pomvardisayac',0,''\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "pomvardisayac_tru",
    "table_name": "pomvardisayac",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[pomvardisayac_tru] ON [dbo].[pomvardisayac]\r\nWITH EXECUTE AS CALLER\r\nFOR UPDATE\r\nAS\r\nBEGIN\r\n\r\n SET NOCOUNT ON\r\n SET XACT_ABORT ON\r\n\r\ndeclare @perkod varchar(30)\r\ndeclare @sayckod varchar(50)\r\ndeclare @akstok varchar(50)\r\ndeclare @stktip varchar(10)\r\ndeclare @enktur varchar(10)\r\ndeclare @tankkod varchar(50)\r\ndeclare @satmik float\r\ndeclare @varno float\r\ndeclare @testmik float\r\ndeclare @transfermik float\r\ndeclare @perdigmik float\r\ndeclare @sonendk float\r\ndeclare @ilkendk float\r\ndeclare @aksatmik float\r\ndeclare @aksattut float\r\ndeclare @brimfiy float\r\ndeclare @varok int\r\ndeclare @sil int\r\ndeclare @sperkod varchar(30)\r\n\r\n\r\nif UPDATE(varok)\r\n  return\r\n  \r\n\r\nif UPDATE(TransferStopId)\r\n   return  \r\n\r\n \r\n  \r\n select @sil=sil from inserted  \r\n   if UPDATE(sil) and (@sil=1)\r\n     return  \r\n\r\n\r\n IF UPDATE(satmik) or UPDATE(transfermik) or UPDATE(transfertank)\r\n  or UPDATE(testmik) or UPDATE(brimfiy) or UPDATE(sil)\r\n BEGIN\r\n\r\n DECLARE vardisayacinst CURSOR FORWARD_ONLY READ_ONLY LOCAL FOR \r\n SELECT perkod,varno,sayackod,satmik,testmik,transfermik,digermik,\r\n ilkendk,tankod,stkod,stktip,brimfiy,varok,enktur\r\n FROM inserted\r\n OPEN vardisayacinst\r\n FETCH NEXT FROM vardisayacinst INTO  \r\n @perkod,@varno,@sayckod,@satmik,@testmik,@transfermik,@perdigmik,\r\n @ilkendk,@tankkod,@akstok,@stktip,@brimfiy,@varok,@enktur\r\n WHILE @@FETCH_STATUS = 0\r\n BEGIN\r\n\r\n update pomvardimas set\r\n aksatmik=dt.aksatmikf,aksattop=dt.aksattopf from pomvardimas t join\r\n (select varno,isnull(sum(satmik),0) as aksatmikf,\r\n isnull(round(sum(satmik*brimfiy),2),0) as aksattopf from \r\n pomvardisayac with (nolock)  where varno=@varno and sil=0 \r\n group by varno) dt on dt.varno=t.varno \r\n\r\n\r\n\r\nupdate pomvardistok set\r\n satmik=dt.satmikf,testmik=dt.testmikf,\r\n brimfiy=dt.brimfiyf,\r\n transfer_cks_mik=dt.transfermikf,\r\n transfer_grs_mik=dt.transfermikf,\r\n kalan=t.acmik-dt.kalanf\r\nfrom pomvardistok t join\r\n(select varno,stkod,stktip,isnull(sum(satmik),0) as satmikf,\r\nisnull(sum(testmik),0) as testmikf,\r\ncase when sum(satmik)>0 then sum(satmik*brimfiy)/sum(satmik)\r\nelse avg(brimfiy) end brimfiyf,\r\nisnull(sum(transfermik),0) as transfermikf,\r\nisnull(sum((satmik+testmik+transfermik)),0) as kalanf\r\nfrom pomvardisayac with (nolock)  where varno=@varno and sil=0 \r\n group by varno,stkod,stktip)\r\ndt on dt.varno=t.varno \r\nand dt.stkod=t.kod and dt.stktip=t.stktip and t.Sil=0\r\n\r\n\r\nupdate pomvarditank set\r\nsatmik=dt.satmikf,\r\ntestmik=dt.testmikf,\r\nbrimfiy=dt.brimfiyf,\r\ntransfer_cks_mik=dt.transfermikf,\r\nkalan=t.acmik-dt.kalanf\r\nfrom pomvarditank t join\r\n(select varno,tankod,isnull(sum(satmik),0) as satmikf,\r\nisnull(sum(testmik),0) as testmikf,\r\ncase when sum(satmik)>0 then sum(satmik*brimfiy)/sum(satmik)\r\nelse avg(brimfiy) end brimfiyf,\r\nisnull(sum(transfermik),0) as transfermikf,\r\nisnull(sum((satmik+testmik+transfermik)),0) as kalanf\r\nfrom pomvardisayac with (nolock)  where varno=@varno and sil=0  \r\ngroup by varno,tankod)\r\ndt on dt.varno=t.varno and dt.tankod=t.kod and t.Sil=0\r\n\r\n/*- transfer grs miktari */\r\nupdate pomvarditank set\r\ntransfer_grs_mik=dt.transfermikf,\r\nkalan=(t.acmik+dt.transfermikf)-\r\n(t.transfer_cks_mik+t.satmik)\r\nfrom pomvarditank t join\r\n(select varno,transfertank,\r\nisnull(sum(transfermik),0) as transfermikf\r\nfrom pomvardisayac with (nolock) where varno=@varno and sil=0  \r\nand transfertank<>'' and transfermik>0\r\ngroup by varno,transfertank)\r\ndt on dt.varno=t.varno and dt.transfertank=t.kod and t.Sil=0\r\n\r\n\r\n\r\n DECLARE digertoplamcur CURSOR FOR \r\n SELECT per FROM pomvardiper where varno=@varno \r\n and sil=0\r\n OPEN digertoplamcur\r\n FETCH NEXT FROM digertoplamcur INTO  @sperkod\r\n WHILE @@FETCH_STATUS = 0\r\n BEGIN\r\n\r\n update pomvardisayac set digermik=\r\n isnull((select sum(satmik+testmik+transfermik) from pomvardisayac with (nolock)\r\n where  varno=@varno and sil=0 and sayackod=@sayckod and perkod<>@sperkod),0)\r\n where varno=@varno and sayackod=@sayckod and perkod=@sperkod\r\n and sil=0 \r\n\r\n FETCH NEXT FROM digertoplamcur INTO  @sperkod\r\n END\r\n CLOSE digertoplamcur\r\n DEALLOCATE digertoplamcur\r\n\r\n\r\nif @enktur='Artan'\r\nupdate pomvardisayac set sonendk=ilkendk+(satmik+testmik+transfermik+digermik) where sayackod=@sayckod\r\nand varno=@varno and sil=0 \r\nif @enktur='Azalan'\r\nupdate pomvardisayac set sonendk=ilkendk-(satmik+testmik+transfermik+digermik) where sayackod=@sayckod\r\nand varno=@varno and sil=0 \r\n\r\n\r\n FETCH NEXT FROM vardisayacinst INTO  @perkod,@varno,@sayckod,@satmik,@testmik,@transfermik,@perdigmik,\r\n @ilkendk,@tankkod,@akstok,@stktip,@brimfiy,@varok,@enktur\r\nEND\r\nCLOSE vardisayacinst\r\nDEALLOCATE vardisayacinst\r\n\r\nend\r\n\r\nSET NOCOUNT OFF\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "poshrk_log_trd",
    "table_name": "poshrk",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[poshrk_log_trd] ON [dbo].[poshrk]\r\nWITH EXECUTE AS CALLER\r\nFOR DELETE\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int,@for_log varchar(8000)\r\n  Select @for_log=' id='+cast(id as varchar(50))+' poshrkid='+cast(poshrkid as varchar(50))+' poskod='+poskod+' firmano='+cast(firmano as varchar(50))+' bankod='+bankod+' sil='+cast(sil as varchar(50))+' varno='+cast(varno as varchar(50))+' varok='+cast(varok as varchar(50))+' perkod='+perkod+' adaid='+cast(adaid as varchar(50))+' islmtip='+islmtip+' islmtipad='+islmtipad+' islmhrk='+islmhrk+' islmhrkad='+islmhrkad+' yertip='+yertip+' yerad='+yerad+' masterid='+cast(masterid as varchar(50))+' gctip='+gctip+' tarih='+cast(tarih as varchar(50))+' saat='+saat+' carslip='+cast(carslip as varchar(50))+' cartip='+cartip+' carkod='+carkod+' giren='+cast(giren as varchar(50))+' cikan='+cast(cikan as varchar(50))+' extrakomyuz='+cast(extrakomyuz as varchar(50))+' bankomyuz='+cast(bankomyuz as varchar(50))+' ack='+ack+' vadetar='+cast(vadetar as varchar(50))+' olususer='+olususer+' olustarsaat='+cast(olustarsaat as varchar(50))+' deguser='+deguser+' degtarsaat='+cast(degtarsaat as varchar(50))+' dataok='+cast(dataok as varchar(50))+' belno='+belno+' kur='+cast(kur as varchar(50))+' aktar='+cast(aktar as varchar(50))+' aktip='+aktip+' gerialtar='+cast(gerialtar as varchar(50))+' bagid='+cast(bagid as varchar(50))+' parabrm='+parabrm+' ekkomyuz='+cast(ekkomyuz as varchar(50))+' akid='+cast(akid as varchar(50))+' pro='+cast(pro as varchar(50))+' fisfattip='+fisfattip+' fisfatid='+cast(fisfatid as varchar(50))+' marsatid='+cast(marsatid as varchar(50))+' cartur='+cartur+' fisid='+cast(fisid as varchar(50)) from deleted\r\n  exec sp_loglama @firmano,@id,'poshrk',-2,@for_log\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "poshrk_log_tri",
    "table_name": "poshrk",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[poshrk_log_tri] ON [dbo].[poshrk]\r\nWITH EXECUTE AS CALLER\r\nFOR INSERT\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int\r\n  Select @firmano=firmano,@id=id from inserted\r\n  exec sp_loglama @firmano,@id,'poshrk',1,''\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "poshrk_log_tru",
    "table_name": "poshrk",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[poshrk_log_tru] ON [dbo].[poshrk]\r\nWITH EXECUTE AS CALLER\r\nFOR UPDATE\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int,@sil bit\r\n  Select @firmano=firmano,@id=id,@sil=isnull(sil,0) from inserted\r\n  if update(sil) and (@sil=1)\r\n    exec sp_loglama @firmano,@id,'poshrk',-1,''\r\n  else\r\n    exec sp_loglama @firmano,@id,'poshrk',0,''\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "poshrk_trd",
    "table_name": "poshrk",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[poshrk_trd] ON [dbo].[poshrk]\r\nWITH EXECUTE AS CALLER\r\nFOR DELETE\r\nAS\r\nBEGIN\r\ndeclare @id \t\tfloat\r\ndeclare @masterid \tfloat\r\ndeclare @pro \t\tint\r\ndeclare @poshrkid \tfloat\r\ndeclare @poskod \tvarchar(30)\r\ndeclare @sil \t\tint\r\ndeclare @yertip \tvarchar(30)\r\ndeclare @varok \t\tint\r\ndeclare @tahodeid\tint\r\nSET NOCOUNT ON\r\n\r\n\r\n DECLARE poshrksil CURSOR FAST_FORWARD FOR SELECT \r\n id,poshrkid,poskod,masterid,sil,tahodeid\r\n FROM deleted\r\n OPEN poshrksil\r\n FETCH NEXT FROM poshrksil INTO  @id,@poshrkid,@poskod,@masterid,@sil,@tahodeid\r\n WHILE @@FETCH_STATUS = 0\r\n BEGIN\r\n\r\n delete from carihrk where masterid=@poshrkid and karsihestip='poskart'\r\n \r\n delete from TahsilatOdeme where id=@tahodeid\r\n\r\n\r\n FETCH NEXT FROM poshrksil INTO  @id,@poshrkid,@poskod,@masterid,@sil,@tahodeid\r\n END\r\n CLOSE poshrksil\r\n DEALLOCATE poshrksil\r\n\r\n\r\nSET NOCOUNT OFF\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "poshrk_tri",
    "table_name": "poshrk",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[poshrk_tri] ON [dbo].[poshrk]\r\nWITH EXECUTE AS CALLER\r\nFOR INSERT, UPDATE\r\nAS\r\nBEGIN\r\ndeclare @varno \t\tfloat\r\ndeclare @idx \t\tfloat\r\ndeclare @masterid \tfloat\r\ndeclare @poshrkid \tfloat\r\ndeclare @sil \t\tint\r\ndeclare @yertip \tvarchar(30)\r\ndeclare @belno\t\tvarchar(50)\r\ndeclare @islmtip    varchar(30)\r\ndeclare @islmhrk    varchar(30)\r\ndeclare @marsatid \tfloat\r\ndeclare @tahodeid \tfloat\r\ndeclare @aktip\t\tvarchar(20)\r\ndeclare @mesaj     varchar(500)\r\ndeclare @firmano    int\r\ndeclare @poshrkIdcount  int\r\ndeclare @id  int\r\n\r\nSET NOCOUNT ON\r\n\r\n\r\n/*if update(varok) */\r\n/*return */\r\n\r\n\r\n\r\nset @poshrkIdcount=0\r\n\r\nselect @marsatid=marsatid,@poshrkid=poshrkid,@id=id,\r\n@idx=id,@masterid=masterid,@firmano=firmano,\r\n@yertip=yertip,@belno=belno,@islmtip=islmtip,@islmhrk=islmhrk,\r\n@varno=varno,@sil=sil,@tahodeid=tahodeid,\r\n@aktip=aktip  from inserted\r\n\r\nselect @poshrkIdcount=count(*) from poshrk with (nolock)\r\nwhere isnull(poshrkid,0)=0 and firmano=@firmano \r\n\r\n\r\nif @poshrkIdcount>1\r\n begin\r\n   RAISERROR ('PoshrkId Hatası', 16,1) \r\n   ROLLBACK TRANSACTION\r\n   RETURN\r\n end\r\n\r\n \r\n \r\n\r\n   if isnull(@poshrkid,0)=0\r\n   begin\r\n    update poshrk set poshrkid=id where id=@id\r\n    /*return */\r\n   end\r\n  \r\n   exec numara_no_yaz 'makbuz',@belno\r\n  \r\n  \r\n  if (@sil=1) \r\n    begin\r\n    \r\n     if (@aktip<>'BK')      \r\n      begin\r\n       set @mesaj=' Silmek İstediğiniz Pos Slibi Aktarılmış Durumda..!';\r\n       RAISERROR (@mesaj, 16,1)\r\n       ROLLBACK TRANSACTION\r\n       RETURN\r\n     end\r\n      \r\n          \r\n     delete from TahsilatOdeme where id=@tahodeid\r\n    end\r\n  \r\n  \r\n  if (@yertip='pomvardimas') and (@islmtip='TAH') and (@islmhrk='POS')\r\n  begin\r\n  \r\n  update pomvardimas set gelirtop=\r\n   (select isnull(sum(giren*kur),0) from Poshrk with (nolock) where varno=@varno and sil=0\r\n   and ( islmtip='TAH' and cartip='gelgidkart'  )\r\n    and cartip='gelgidkart' and yertip=@yertip )\r\n   where varno=@varno\r\n   \r\n   \r\n   update pomvardimas set gelirtop=gelirtop+\r\n   (select isnull(sum(alacak*kur),0) from carihrk with (nolock) where varno=@varno and sil=0\r\n   and ( islmtip='TAH' and islmhrk='NAK' and cartip='gelgidkart'  )\r\n    and cartip='gelgidkart' and yertip=@yertip )\r\n   where varno=@varno\r\n\r\n  \r\n  end\r\n\r\n\r\n\r\n if ((@yertip='marvardimas') or (@yertip='yazarkasa')  or (@yertip='promakscsv')  )\r\n  and (@islmtip='TAH') and (@islmhrk='POS')\r\n  begin\r\n\r\n    update marsatmas set cartip='poskart',carkod=dt.poskod,\r\n     islmhrk=dt.islmhrk,islmhrkad=dt.islmhrkad,postop=dt.postop\r\n     from marsatmas t join\r\n     (select  marsatid,poskod,islmhrk,islmhrkad,\r\n         isnull((giren*kur),0) as postop from poshrk with (nolock)\r\n     where varno=@varno and sil=0 and marsatid=@marsatid )\r\n     dt on dt.marsatid=t.marsatid and t.sil=0\r\n\r\n\r\n    update marvardimas set postop=dt.postop,poscartop=dt.poscartp from\r\n     marvardimas as t join\r\n    (select isnull(sum(giren*kur),0) as postop,\r\n    isnull(sum(case when carslip=1 then giren*kur else 0 end),0) as poscartp\r\n    from poshrk with (nolock) where varno=@varno and sil=0 and\r\n     yertip=@yertip) dt on t.varno=@varno\r\n\r\n\r\n\r\n  end\r\n  \r\n  \r\n  \r\n  if (@yertip='resvardimas') and (@islmtip='TAH') and (@islmhrk='POS')\r\n  begin\r\n  \r\n\r\n    update resvardimas set postop=dt.postop,poscartop=dt.poscartp from\r\n     resvardimas as t join\r\n    (select isnull(sum(giren*kur),0) as postop,\r\n    isnull(sum(case when carslip=1 then giren*kur else 0 end),0) as poscartp\r\n    from poshrk with (nolock) where varno=@varno and sil=0 and\r\n     yertip=@yertip) dt on t.varno=@varno\r\n\r\n\r\n\r\n  end\r\n\r\n\r\n  if (@yertip='pomvardimas') and (@islmtip='TAH') and (@islmhrk='POS')\r\n  update pomvardimas set postop=dt.postop,poscartop=dt.poscartp from\r\n     pomvardimas as t join\r\n    (select isnull(sum(giren*kur),0) as postop,\r\n    isnull(sum(case when carslip=1 then giren*kur else 0 end),0) as poscartp from\r\n    poshrk with (nolock) where varno=@varno and sil=0 and\r\n     yertip=@yertip) dt on t.varno=@varno\r\n  \r\n  \r\n  if @masterid=0\r\n     exec poshrkgiris @poshrkid\r\n\r\n\r\n\r\nSET NOCOUNT OFF\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "poskart_log_trd",
    "table_name": "poskart",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[poskart_log_trd] ON [dbo].[poskart]\r\nWITH EXECUTE AS CALLER\r\nFOR DELETE\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int,@for_log varchar(8000)\r\n  Select @for_log=' id='+cast(id as varchar(50))+' kod='+kod+' firmano='+cast(firmano as varchar(50))+' ad='+ad+' sil='+cast(sil as varchar(50))+' drm='+drm+' bankod='+bankod+' muhkod='+muhkod+' kom='+cast(kom as varchar(50))+' exkom='+cast(exkom as varchar(50))+' vade='+cast(vade as varchar(50))+' vadetip='+vadetip+' parabrm='+parabrm+' gidhes='+gidhes+' bekbak='+cast(bekbak as varchar(50))+' kombak='+cast(kombak as varchar(50))+' olususer='+olususer+' olustarsaat='+cast(olustarsaat as varchar(50))+' deguser='+deguser+' degtarsaat='+cast(degtarsaat as varchar(50))+' dataok='+cast(dataok as varchar(50)) from deleted\r\n  exec sp_loglama @firmano,@id,'poskart',-2,@for_log\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "poskart_log_tri",
    "table_name": "poskart",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[poskart_log_tri] ON [dbo].[poskart]\r\nWITH EXECUTE AS CALLER\r\nFOR INSERT\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int\r\n  Select @firmano=firmano,@id=id from inserted\r\n  exec sp_loglama @firmano,@id,'poskart',1,''\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "poskart_log_tru",
    "table_name": "poskart",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[poskart_log_tru] ON [dbo].[poskart]\r\nWITH EXECUTE AS CALLER\r\nFOR UPDATE\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int,@sil bit\r\n  Select @firmano=firmano,@id=id,@sil=isnull(sil,0) from inserted\r\n  if update(sil) and (@sil=1)\r\n    exec sp_loglama @firmano,@id,'poskart',-1,''\r\n  else\r\n    exec sp_loglama @firmano,@id,'poskart',0,''\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "poskart_tri",
    "table_name": "poskart",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[poskart_tri] ON [dbo].[poskart]\r\nWITH EXECUTE AS CALLER\r\nFOR INSERT\r\nAS\r\nBEGIN\r\n\r\ndeclare @kod varchar(20);\r\nDECLARE @id float;\r\n\r\nselect @id=id,@kod=kod from inserted;\r\n\r\n\r\nEXEC numara_no_yaz 'poskart',@kod\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "poskart_tru",
    "table_name": "poskart",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[poskart_tru] ON [dbo].[poskart]\r\nWITH EXECUTE AS CALLER\r\nFOR UPDATE\r\nAS\r\nBEGIN\r\ndeclare @kod varchar(20);\r\nDECLARE @id float;\r\n\r\nselect @id=id,@kod=kod from inserted;\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "Prom_Puan_Hrk_trd",
    "table_name": "Prom_Puan_Hrk",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[Prom_Puan_Hrk_trd] ON [dbo].[Prom_Puan_Hrk]\r\nWITH EXECUTE AS CALLER\r\nFOR DELETE\r\nAS\r\nBEGIN\r\n Declare @Puanid \t\tint\r\n Declare @sil \t\t\tbit\r\n Declare @Kayok \t\tint\r\n \r\n select @Puanid=Puanid,\r\n @sil=sil,@Kayok=Kayok\r\n from deleted\r\n\r\n   if @Puanid=0 \r\n   RETURN\r\n\r\n \r\n  exec stokhrkisle @Puanid,'Prom_Puan_Hrk','',1,1,@Puanid\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "Prom_Puan_Hrk_tru",
    "table_name": "Prom_Puan_Hrk",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[Prom_Puan_Hrk_tru] ON [dbo].[Prom_Puan_Hrk]\r\nWITH EXECUTE AS CALLER\r\nFOR UPDATE\r\nAS\r\nBEGIN\r\n Declare @Puanid \t\tint\r\n Declare @sil \t\t\tbit\r\n Declare @Kayok \t\tint\r\n \r\n select @Puanid=Puanid,\r\n @sil=sil,@Kayok=Kayok from inserted\r\n \r\n if @Puanid=0 \r\n   RETURN\r\n   \r\n   \r\n if (@Kayok=1)\r\n  begin\r\n   exec stokhrkisle @Puanid,'Prom_Puan_Hrk','',@kayok,@sil,@Puanid\r\n end\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "Prom_Sat_Baslik_trd",
    "table_name": "Prom_Sat_Baslik",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[Prom_Sat_Baslik_trd] ON [dbo].[Prom_Sat_Baslik]\r\nWITH EXECUTE AS CALLER\r\nFOR DELETE\r\nAS\r\nBEGIN\r\n Declare @Promid \t\tbigint\r\n Declare @sil \t\t\tbit\r\n Declare @Evraktip \t\tvarchar(50)\r\n Declare @Kayok \t\tint\r\n Declare @Otomas_id\t\tbigint\r\n \r\n select @Evraktip=fistip,@Promid=promid,\r\n @sil=sil,@Kayok=Kayok,@Otomas_id=Otomas_id from deleted\r\n \r\n if @Promid=0 \r\n   RETURN\r\n   \r\n   \r\n  update Prom_Sat_Hrk set sil=1 where promid=@Promid and sil=0  \r\n\r\n\r\n  update otomasonlineoku set promid=0 where otomasid=@Otomas_id\r\n\r\n\r\n\r\n  exec Prom_Puan_Hrk_isle  @Evraktip,@Promid,1 \r\n  exec stokhrkisle @Promid,'Prom_Sat_Hrk','',1,1,@Promid\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "Prom_Sat_Baslik_tru",
    "table_name": "Prom_Sat_Baslik",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[Prom_Sat_Baslik_tru] ON [dbo].[Prom_Sat_Baslik]\r\nWITH EXECUTE AS CALLER\r\nFOR UPDATE\r\nAS\r\nBEGIN\r\n  \r\n Declare @Promid \t\tbigint\r\n Declare @sil \t\t\tbit\r\n Declare @Evraktip \t\tvarchar(50)\r\n Declare @Kayok \t\tint\r\n Declare @Otomas_id \tbigint\r\n \r\n select @Evraktip=fistip,@Promid=promid,\r\n @sil=sil,@Kayok=Kayok,@Otomas_id=Otomas_id from inserted\r\n \r\n if @Promid=0 \r\n   RETURN\r\n   \r\n   \r\n update Prom_Sat_Hrk set sil=@sil where promid=@Promid and sil=0  \r\n\r\n if (@Kayok=1)\r\n  begin\r\n  exec Prom_Puan_Hrk_isle  @Evraktip,@Promid,@sil \r\n  exec stokhrkisle @Promid,'Prom_Sat_Hrk','',@kayok,@sil,@Promid\r\n  \r\n  if @sil=0\r\n   update otomasonlineoku set promid=@Promid\r\n    where otomasid=@Otomas_id\r\n\r\n\r\n   if @sil=1\r\n   begin\r\n    if @Otomas_id>0\r\n     begin\r\n      update otomasonlineoku set promid=0 where otomasid=@Otomas_id\r\n      update Prom_Sat_Baslik set sil=1 where otomas_id=@Otomas_id    \r\n     end \r\n   end\r\n \r\n\r\n\r\n\r\n  \r\n  end\r\n  \r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "raporlar_trd",
    "table_name": "raporlar",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[raporlar_trd] ON [dbo].[raporlar]\r\nWITH EXECUTE AS CALLER\r\nFOR DELETE\r\nAS\r\nBEGIN\r\n\r\n declare @rapgrp    varchar(50) \r\n\r\n select @rapgrp=rapgrp from deleted\r\n\r\n exec yetki_evrak_olustur @rapgrp\r\n \r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "raporlar_triu",
    "table_name": "raporlar",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[raporlar_triu] ON [dbo].[raporlar]\r\nWITH EXECUTE AS CALLER\r\nFOR INSERT, UPDATE\r\nAS\r\nBEGIN\r\n  \r\n declare @rapgrp    varchar(50) \r\n\r\n select @rapgrp=rapgrp from inserted\r\n\r\n exec yetki_evrak_olustur @rapgrp\r\n \r\n\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "ResSatMas_trd",
    "table_name": "ResSatMas",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[ResSatMas_trd] ON [dbo].[ResSatMas]\r\nWITH EXECUTE AS CALLER\r\nFOR DELETE\r\nAS\r\nBEGIN\r\ndeclare @varno \t\tfloat\r\ndeclare @sattop \tfloat\r\ndeclare @iadetop \tfloat\r\ndeclare @kayok \t\tint\r\ndeclare @sil \t\tint\r\ndeclare @id \t\tfloat\r\n\r\n\r\nSET NOCOUNT ON\r\n\r\n\r\nDECLARE Cur_Marsat_Up CURSOR LOCAL FOR \r\n SELECT d.Id,d.sil,d.kayok,d.VarNo\r\n FROM deleted as d  \r\n OPEN Cur_Marsat_Up\r\n  FETCH NEXT FROM Cur_Marsat_Up INTO  \r\n  @id,@sil,@kayok,@varno\r\n  WHILE @@FETCH_STATUS = 0\r\n  BEGIN\r\n\r\n    exec stokhrkisle @id,'ResSatHrk','',1,1,@id\r\n\r\n \r\n       update Ressathrk set sil=1  where ResSatId=@id\r\n       update ResSatkasahrk set sil=1 where ResSatId=@id\r\n       update poshrk set sil=1 where varno=@varno and ResSatId=@id\r\n      /*  update carihrk set sil=1 where varno=@varno and ResSatId=@id */\r\n      /*update veresimas set sil=1 where varno=@varno and ResSatId=@id */\r\n     \r\n\r\n   \r\n      update Resvardimas set \r\n       SatisTop=dt.satistop,\r\n       IadeTop=dt.iadetop,\r\n       naksattop=dt.naktop,\r\n       postop=dt.postop,\r\n      /* veresitop=dt.veresitop, */\r\n       IndTop=dt.indtop\r\n       from Resvardimas t join\r\n       (select \r\n       isnull(sum(SatisTop),0) as satistop,\r\n       isnull(sum(IadeTop),0) as iadetop,\r\n       isnull(sum(NakitTop),0) as naktop,\r\n       isnull(sum(PosTop),0) as postop,\r\n      /* isnull(sum(veresitop),0) as veresitop, */\r\n       isnull(sum(IndTop),0) as indtop\r\n       from  Ressatmas where \r\n       varno=@varno and sil=0 )\r\n       dt on t.varno=@varno and t.sil=0\r\n\r\n\r\n   FETCH NEXT FROM Cur_Marsat_Up INTO  \r\n   @id,@sil,@kayok,@varno\r\n  END\r\n  CLOSE Cur_Marsat_Up\r\n  DEALLOCATE Cur_Marsat_Up\r\n\r\n\r\nSET NOCOUNT OFF\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "ResSatMas_tru",
    "table_name": "ResSatMas",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[ResSatMas_tru] ON [dbo].[ResSatMas]\r\nWITH EXECUTE AS CALLER\r\nFOR UPDATE\r\nAS\r\nBEGIN\r\ndeclare @varno \t\tfloat\r\ndeclare @sattop \tfloat\r\ndeclare @iadetop \tfloat\r\ndeclare @kayok \t\tint\r\ndeclare @sil \t\tint\r\ndeclare @id \t\tfloat\r\ndeclare @d_sil\t\tint\r\ndeclare @d_kayok\tint\r\n\r\n\r\nSET NOCOUNT ON\r\n\r\n\r\nDECLARE Cur_Marsat_Up CURSOR LOCAL FOR \r\n SELECT i.Id,i.sil,i.kayok,i.VarNo,\r\n d.sil,d.kayok\r\n FROM inserted as i inner join deleted as d\r\n on d.Id=i.Id\r\n \r\n OPEN Cur_Marsat_Up\r\n  FETCH NEXT FROM Cur_Marsat_Up INTO  \r\n  @id,@sil,@kayok,@varno,\r\n  @d_sil,@d_kayok\r\n  WHILE @@FETCH_STATUS = 0\r\n  BEGIN\r\n\r\n    /* if (@kayok=1)  */\r\n  \r\n     if (@kayok=1) and ( (@sil<>@d_sil) or (@kayok<>@d_kayok) )\r\n     begin \r\n       exec ResSatRecHrkOlustur @id\r\n       exec stokhrkisle @id,'ResSatHrk','',@kayok,@sil,@id\r\n      end   \r\n  \r\n\r\n\r\n     if update(sil) \r\n      begin\r\n      if @sil=1\r\n      begin\r\n       update Ressathrk set sil=1  where ResSatId=@id\r\n       update ResSatkasahrk set sil=1 where ResSatId=@id\r\n       update poshrk set sil=1 where varno=@varno and ResSatId=@id\r\n      /*  update carihrk set sil=1 where varno=@varno and ResSatId=@id */\r\n      /*update veresimas set sil=1 where varno=@varno and ResSatId=@id */\r\n      end\r\n     end\r\n\r\n   if (@kayok=1)\r\n      update Resvardimas set \r\n       SatisTop=dt.satistop,\r\n       IadeTop=dt.iadetop,\r\n       naksattop=dt.naktop,\r\n       postop=dt.postop,\r\n      /* veresitop=dt.veresitop, */\r\n       IndTop=dt.indtop\r\n       from Resvardimas t join\r\n       (select \r\n       isnull(sum(SatisTop),0) as satistop,\r\n       isnull(sum(IadeTop),0) as iadetop,\r\n       isnull(sum(NakitTop),0) as naktop,\r\n       isnull(sum(PosTop),0) as postop,\r\n      /* isnull(sum(veresitop),0) as veresitop, */\r\n       isnull(sum(IndTop),0) as indtop\r\n       from  Ressatmas where \r\n       varno=@varno and sil=0 )\r\n       dt on t.varno=@varno and t.sil=0\r\n\r\n\r\n   FETCH NEXT FROM Cur_Marsat_Up INTO  \r\n   @id,@sil,@kayok,@varno,\r\n   @d_sil,@d_kayok\r\n  END\r\n  CLOSE Cur_Marsat_Up\r\n  DEALLOCATE Cur_Marsat_Up\r\n\r\n\r\nSET NOCOUNT OFF\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "ResVardiMas_trd",
    "table_name": "ResVardiMas",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[ResVardiMas_trd] ON [dbo].[ResVardiMas]\r\nWITH EXECUTE AS CALLER\r\nFOR DELETE\r\nAS\r\nBEGIN\r\ndeclare @varno int\r\ndeclare @firmano int\r\ndeclare @yertipyaz varchar(20)\r\ndeclare @yertip varchar(20)\r\nset @yertip='resvardimas'\r\nset @yertipyaz='yazarkasa'\r\n\r\n\r\n  select @firmano=firmano,@varno=varno from DELETED\r\n\r\n\r\n  update marsatmas set sil=1 where varno=@varno\r\n  and (yertip=@yertip ) and sil=0\r\n\r\n /* update veresimas set sil=1 where varno=@varno */\r\n /* and (yertip=@yertip ) and sil=0 */\r\n\r\n  update carihrk set sil=1 where varno=@varno\r\n  and (yertip=@yertip ) and sil=0\r\n\r\n  update kasahrk set sil=1 where varno=@varno\r\n  and (yertip=@yertip ) and sil=0\r\n \r\n/* update bankahrk set sil=1 where varno=@varno */\r\n /* and (yertip=@yertip ) and sil=0 */\r\n  \r\n  update poshrk set sil=1 where varno=@varno\r\n  and (yertip=@yertip ) and sil=0\r\n  \r\n  /*update cekkart set sil=1 where varno=@varno */\r\n /* and (yertip=@yertip ) and sil=0 */\r\n\r\n EXECUTE resvarkabul @varno,0,1\r\n \r\n EXECUTE  Restaurat_BozukPara @firmano,@varno,1\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "ResVardiMas_tru",
    "table_name": "ResVardiMas",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[ResVardiMas_tru] ON [dbo].[ResVardiMas]\r\nWITH EXECUTE AS CALLER\r\nFOR UPDATE\r\nAS\r\nBEGIN\r\ndeclare @varno float,@varok int,@sil int\r\ndeclare @yertipyaz varchar(20)\r\ndeclare @yertip varchar(20)\r\ndeclare @firmano\tint\r\n\r\ndeclare @del_tarih  datetime\r\ndeclare @ins_tarih  datetime\r\n\r\nset @yertip='resvardimas'  /*ResVardiMas */\r\n\r\n\r\n select @firmano=firmano,@varno=varno,@varok=varok,\r\n @sil=sil,@ins_tarih=tarih from inserted\r\n\r\n select @del_tarih=tarih from deleted\r\n\r\n\r\nif (UPDATE(varok) or UPDATE(sil))\r\nbegin\r\n\r\n  if @sil=1\r\n    update ressatmas set sil=@sil where varno=@varno and sil=0\r\n  \r\n\r\n /*update veresimas set varok=@varok,sil=@sil where varno=@varno */\r\n /*and (yertip=@yertip ) and sil=0 */\r\n\r\n update carihrk set varok=@varok,sil=@sil where varno=@varno\r\n and yertip=@yertip and sil=0\r\n\r\n update kasahrk set varok=@varok,sil=@sil where varno=@varno\r\n  and (yertip=@yertip ) and sil=0\r\n  \r\n /*update bankahrk set varok=@varok,sil=@sil where varno=@varno */\r\n /*and (yertip=@yertip ) and sil=0 */\r\n \r\n  update poshrk set varok=@varok,sil=@sil where varno=@varno\r\n   and (yertip=@yertip ) and sil=0\r\n   \r\n  /*update cekkart set varok=@varok,sil=@sil where varno=@varno */\r\n  /*and (yertip=@yertip or yertip=@yertipyaz) and sil=0 */\r\n\r\n  EXECUTE resvarkabul @varno,@varok,@sil\r\n  \r\nend\r\n\r\n\r\n  if (UPDATE(varok) or UPDATE(sil) or UPDATE(varno) )\r\n   EXECUTE  Restaurat_BozukPara @firmano,@varno,@sil\r\n \r\n\r\n\r\n\r\n\r\nSET NOCOUNT OFF\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "sayachrk_log_trd",
    "table_name": "sayachrk",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[sayachrk_log_trd] ON [dbo].[sayachrk]\r\nWITH EXECUTE AS CALLER\r\nFOR DELETE\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int,@for_log varchar(8000)\r\n  Select @for_log=' id='+cast(id as varchar(50))+' sayachrkid='+cast(sayachrkid as varchar(50))+' sayackod='+sayackod+' firmano='+cast(firmano as varchar(50))+' varno='+cast(varno as varchar(50))+' varok='+cast(varok as varchar(50))+' sil='+cast(sil as varchar(50))+' islmtip='+islmtip+' islmtipad='+islmtipad+' ilkendks='+cast(ilkendks as varchar(50))+' sonendks='+cast(sonendks as varchar(50))+' olustarsaat='+cast(olustarsaat as varchar(50))+' olususer='+olususer+' degtarsaat='+cast(degtarsaat as varchar(50))+' deguser='+deguser+' tarih='+cast(tarih as varchar(50))+' saat='+saat+' dataok='+cast(dataok as varchar(50))+' ack='+ack+' yertip='+yertip+' yerad='+yerad+' islmid='+cast(islmid as varchar(50))+' belno='+belno from deleted\r\n  exec sp_loglama @firmano,@id,'sayachrk',-2,@for_log\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "sayachrk_log_tri",
    "table_name": "sayachrk",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[sayachrk_log_tri] ON [dbo].[sayachrk]\r\nWITH EXECUTE AS CALLER\r\nFOR INSERT\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int\r\n  Select @firmano=firmano,@id=id from inserted\r\n  exec sp_loglama @firmano,@id,'sayachrk',1,''\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "sayachrk_log_tru",
    "table_name": "sayachrk",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[sayachrk_log_tru] ON [dbo].[sayachrk]\r\nWITH EXECUTE AS CALLER\r\nFOR UPDATE\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int,@sil bit\r\n  Select @firmano=firmano,@id=id,@sil=isnull(sil,0) from inserted\r\n  if update(sil) and (@sil=1)\r\n    exec sp_loglama @firmano,@id,'sayachrk',-1,''\r\n  else\r\n    exec sp_loglama @firmano,@id,'sayachrk',0,''\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "sayachrk_trd",
    "table_name": "sayachrk",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[sayachrk_trd] ON [dbo].[sayachrk]\r\nWITH EXECUTE AS CALLER\r\nFOR DELETE\r\nAS\r\nBEGIN\r\n\r\ndeclare @sayackod varchar(20);\r\ndeclare @id int;\r\n\r\n\r\nDECLARE sayachrksilx CURSOR LOCAL FOR SELECT id,sayackod\r\nfrom deleted\r\n OPEN sayachrksilx\r\n  FETCH NEXT FROM sayachrksilx INTO  @id,@sayackod\r\n  WHILE @@FETCH_STATUS <> -1\r\n  BEGIN\r\n\r\nexec sayacsonendks @sayackod\r\n\r\n\r\nFETCH NEXT FROM sayachrksilx INTO  @id,@sayackod\r\nEND\r\nCLOSE sayachrksilx\r\nDEALLOCATE sayachrksilx\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "sayachrk_tri",
    "table_name": "sayachrk",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[sayachrk_tri] ON [dbo].[sayachrk]\r\nWITH EXECUTE AS CALLER\r\nFOR INSERT, UPDATE\r\nAS\r\nBEGIN\r\ndeclare @sayackod varchar(20)\r\n\r\n declare sayac_hrk CURSOR FAST_FORWARD  \r\n  FOR select sayackod from inserted \r\n   open sayac_hrk\r\n  fetch next from  sayac_hrk into @sayackod\r\n  while @@FETCH_STATUS=0\r\n   begin\r\n  \r\n    exec sayacsonendks @sayackod\r\n \r\n  FETCH next from  sayac_hrk into @sayackod\r\n end\r\n close sayac_hrk\r\n deallocate sayac_hrk\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "sayackart_log_trd",
    "table_name": "sayackart",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[sayackart_log_trd] ON [dbo].[sayackart]\r\nWITH EXECUTE AS CALLER\r\nFOR DELETE\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int,@for_log varchar(8000)\r\n  Select @for_log=' id='+cast(id as varchar(50))+' kod='+kod+' firmano='+cast(firmano as varchar(50))+' grp1='+cast(grp1 as varchar(50))+' ad='+ad+' sil='+cast(sil as varchar(50))+' drm='+drm+' muhkod='+muhkod+' tankod='+tankod+' satfiytip='+satfiytip+' acendks='+cast(acendks as varchar(50))+' enktur='+enktur+' olususer='+olususer+' olustarsaat='+cast(olustarsaat as varchar(50))+' deguser='+deguser+' degtarsaat='+cast(degtarsaat as varchar(50))+' dataok='+cast(dataok as varchar(50))+' sonendks='+cast(sonendks as varchar(50)) from deleted\r\n  exec sp_loglama @firmano,@id,'sayackart',-2,@for_log\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "sayackart_log_tri",
    "table_name": "sayackart",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[sayackart_log_tri] ON [dbo].[sayackart]\r\nWITH EXECUTE AS CALLER\r\nFOR INSERT\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int\r\n  Select @firmano=firmano,@id=id from inserted\r\n  exec sp_loglama @firmano,@id,'sayackart',1,''\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "sayackart_log_tru",
    "table_name": "sayackart",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[sayackart_log_tru] ON [dbo].[sayackart]\r\nWITH EXECUTE AS CALLER\r\nFOR UPDATE\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int,@sil bit\r\n  Select @firmano=firmano,@id=id,@sil=isnull(sil,0) from inserted\r\n  if update(sil) and (@sil=1)\r\n    exec sp_loglama @firmano,@id,'sayackart',-1,''\r\n  else\r\n    exec sp_loglama @firmano,@id,'sayackart',0,''\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "sayackart_trd",
    "table_name": "sayackart",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[sayackart_trd] ON [dbo].[sayackart]\r\nWITH EXECUTE AS CALLER\r\nFOR DELETE\r\nAS\r\nBEGIN\r\ndeclare @kod varchar(30)\r\n\r\nselect @kod=kod from deleted;\r\n\r\ndelete from sayachrk where sayackod=@kod;\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "sayackart_tri",
    "table_name": "sayackart",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[sayackart_tri] ON [dbo].[sayackart]\r\nWITH EXECUTE AS CALLER\r\nFOR INSERT\r\nAS\r\nBEGIN\r\ndeclare @kod varchar(20);\r\nDECLARE @id float;\r\n\r\nselect @id=id,@kod=kod from inserted;\r\n\r\nEXEC sayacacilis @kod;\r\n\r\nEXEC numara_no_yaz 'sayackart',@kod\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "sayackart_tru",
    "table_name": "sayackart",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[sayackart_tru] ON [dbo].[sayackart]\r\nWITH EXECUTE AS CALLER\r\nFOR UPDATE\r\nAS\r\nBEGIN\r\ndeclare @kod varchar(20);\r\nDECLARE @id float;\r\n\r\nselect @id=id,@kod=kod from inserted;\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "sayimhrk_log_trd",
    "table_name": "sayimhrk",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[sayimhrk_log_trd] ON [dbo].[sayimhrk]\r\nWITH EXECUTE AS CALLER\r\nFOR DELETE\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int,@for_log varchar(8000)\r\n  Select @for_log=' id='+cast(id as varchar(50))+' sayid='+cast(sayid as varchar(50))+' depkod='+depkod+' stkod='+stkod+' firmano='+cast(firmano as varchar(50))+' sil='+cast(sil as varchar(50))+' drm='+drm+' stktip='+stktip+' sayimmik='+cast(sayimmik as varchar(50))+' mevcutmik='+cast(mevcutmik as varchar(50))+' saydrm='+saydrm+' olustarsaat='+cast(olustarsaat as varchar(50))+' olususer='+olususer+' degtarsaat='+cast(degtarsaat as varchar(50))+' deguser='+deguser+' brmfiy='+cast(brmfiy as varchar(50))+' kdvtip='+kdvtip+' tarih='+cast(tarih as varchar(50))+' saat='+saat+' dataok='+cast(dataok as varchar(50))+' kdvyuz='+cast(kdvyuz as varchar(50)) from deleted\r\n  exec sp_loglama @firmano,@id,'sayimhrk',-2,@for_log\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "sayimhrk_log_tri",
    "table_name": "sayimhrk",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[sayimhrk_log_tri] ON [dbo].[sayimhrk]\r\nWITH EXECUTE AS CALLER\r\nFOR INSERT\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int\r\n  Select @firmano=firmano,@id=id from inserted\r\n  exec sp_loglama @firmano,@id,'sayimhrk',1,''\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "sayimhrk_log_tru",
    "table_name": "sayimhrk",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[sayimhrk_log_tru] ON [dbo].[sayimhrk]\r\nWITH EXECUTE AS CALLER\r\nFOR UPDATE\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int,@sil bit\r\n  Select @firmano=firmano,@id=id,@sil=isnull(sil,0) from inserted\r\n  if update(sil) and (@sil=1)\r\n    exec sp_loglama @firmano,@id,'sayimhrk',-1,''\r\n  else\r\n    exec sp_loglama @firmano,@id,'sayimhrk',0,''\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "sayimhrk_triu",
    "table_name": "sayimhrk",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[sayimhrk_triu] ON [dbo].[sayimhrk]\r\nWITH EXECUTE AS CALLER\r\nFOR INSERT, UPDATE\r\nAS\r\nBEGIN\r\nSET NOCOUNT ON\r\n\r\n\r\ndeclare @sayid float;\r\ndeclare @mevcutmik float,\r\n@sayimmik float,\r\n@sayimtutar float,\r\n@mevcuttutar float;\r\ndeclare @brmfiy float;\r\n\r\nif update (drm)\r\nbegin\r\nSET NOCOUNT OFF\r\nRETURN\r\nend\r\n\r\n  select @sayid=sayid from inserted;\r\n\r\n\r\n    update sayimmas set sayimmik=dt.sayimmik,sayimtut=dt.sayimtutar,\r\n    mevcutmik=dt.mevcutmik,mevcuttut=dt.mevcuttutar from\r\n   sayimmas as t join (\r\n   select isnull(sum(sayimmik),0) as sayimmik,\r\n         isnull(sum(sayimmik*brmfiy),0) as sayimtutar,\r\n         isnull(sum(mevcutmik),0) as mevcutmik,\r\n         isnull(sum(mevcutmik*brmfiy),0) as mevcuttutar\r\n   from sayimhrk with (nolock) where sayid=@sayid and sil=0)\r\n   dt on t.sayid=@sayid\r\n\r\n\r\nSET NOCOUNT OFF\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "sayimkap_log_trd",
    "table_name": "sayimkap",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[sayimkap_log_trd] ON [dbo].[sayimkap]\r\nWITH EXECUTE AS CALLER\r\nFOR DELETE\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int,@for_log varchar(8000)\r\n  Select @for_log=' id='+cast(id as varchar(50))+' sayid='+cast(sayid as varchar(50))+' kaptip='+kaptip+' firmano='+cast(firmano as varchar(50))+' kod='+kod+' tutar='+cast(tutar as varchar(50))+' ackfaz='+ackfaz+' olususer='+olususer+' olustarsaat='+cast(olustarsaat as varchar(50))+' deguser='+deguser+' degtarsaat='+cast(degtarsaat as varchar(50))+' dataok='+cast(dataok as varchar(50))+' saymiktip='+saymiktip from deleted\r\n  exec sp_loglama @firmano,@id,'sayimkap',-2,@for_log\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "sayimkap_log_tri",
    "table_name": "sayimkap",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[sayimkap_log_tri] ON [dbo].[sayimkap]\r\nWITH EXECUTE AS CALLER\r\nFOR INSERT\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int\r\n  Select @firmano=firmano,@id=id from inserted\r\n  exec sp_loglama @firmano,@id,'sayimkap',1,''\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "sayimkap_log_tru",
    "table_name": "sayimkap",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[sayimkap_log_tru] ON [dbo].[sayimkap]\r\nWITH EXECUTE AS CALLER\r\nFOR UPDATE\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int,@sil bit\r\n  Select @firmano=firmano,@id=id,@sil=isnull(sil,0) from inserted\r\n  if update(sil) and (@sil=1)\r\n    exec sp_loglama @firmano,@id,'sayimkap',-1,''\r\n  else\r\n    exec sp_loglama @firmano,@id,'sayimkap',0,''\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "sayimmas_log_trd",
    "table_name": "sayimmas",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[sayimmas_log_trd] ON [dbo].[sayimmas]\r\nWITH EXECUTE AS CALLER\r\nFOR DELETE\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int,@for_log varchar(8000)\r\n  Select @for_log=' id='+cast(id as varchar(50))+' sayid='+cast(sayid as varchar(50))+' sil='+cast(sil as varchar(50))+' firmano='+cast(firmano as varchar(50))+' tarih='+cast(tarih as varchar(50))+' saat='+saat+' sayack='+sayack+' drm='+drm+' depkod='+depkod+' perkod='+perkod+' onaytarih='+cast(onaytarih as varchar(50))+' onaysaat='+onaysaat+' sayimmik='+cast(sayimmik as varchar(50))+' mevcutmik='+cast(mevcutmik as varchar(50))+' mevcuttut='+cast(mevcuttut as varchar(50))+' sayimtut='+cast(sayimtut as varchar(50))+' onayack='+onayack+' olustarsaat='+cast(olustarsaat as varchar(50))+' olususer='+olususer+' degtarsaat='+cast(degtarsaat as varchar(50))+' deguser='+deguser+' kdvtip='+kdvtip+' brmfiytip='+brmfiytip+' dataok='+cast(dataok as varchar(50))+' onayper='+onayper from deleted\r\n  exec sp_loglama @firmano,@id,'sayimmas',-2,@for_log\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "sayimmas_log_tri",
    "table_name": "sayimmas",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[sayimmas_log_tri] ON [dbo].[sayimmas]\r\nWITH EXECUTE AS CALLER\r\nFOR INSERT\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int\r\n  Select @firmano=firmano,@id=id from inserted\r\n  exec sp_loglama @firmano,@id,'sayimmas',1,''\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "sayimmas_log_tru",
    "table_name": "sayimmas",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[sayimmas_log_tru] ON [dbo].[sayimmas]\r\nWITH EXECUTE AS CALLER\r\nFOR UPDATE\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int,@sil bit\r\n  Select @firmano=firmano,@id=id,@sil=isnull(sil,0) from inserted\r\n  if update(sil) and (@sil=1)\r\n    exec sp_loglama @firmano,@id,'sayimmas',-1,''\r\n  else\r\n    exec sp_loglama @firmano,@id,'sayimmas',0,''\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "sayimmas_trd",
    "table_name": "sayimmas",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[sayimmas_trd] ON [dbo].[sayimmas]\r\nWITH EXECUTE AS CALLER\r\nFOR DELETE\r\nAS\r\nBEGIN\r\ndeclare @sayid float;\r\n\r\n/*if not update(drm) begin */\r\n\r\n/*-deleted */\r\n DECLARE sayimasdel CURSOR FOR SELECT sayid\r\n from deleted\r\n OPEN sayimasdel\r\n FETCH NEXT FROM sayimasdel INTO  @sayid\r\n WHILE @@FETCH_STATUS = 0\r\n BEGIN\r\n\r\n exec sayimonayla @sayid,'B'\r\n  \r\n delete from sayimhrk where sayid=@sayid\r\n delete from sayimstkgrp where sayid=@sayid\r\n\r\n\r\n \r\n delete from carihrk where islmtip='SAY' AND fisfatid=@sayid;\r\n\r\n\r\n FETCH NEXT FROM sayimasdel INTO  @sayid\r\n END\r\n CLOSE sayimasdel\r\n DEALLOCATE sayimasdel\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "sayimmas_tru",
    "table_name": "sayimmas",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[sayimmas_tru] ON [dbo].[sayimmas]\r\nWITH EXECUTE AS CALLER\r\nFOR UPDATE\r\nAS\r\nBEGIN\r\ndeclare @drm varchar(5)\r\ndeclare @sil int\r\ndeclare @sayid float\r\ndeclare @mesaj varchar(500)\r\n\r\n select @sayid=sayid,@sil=sil,@drm=drm from inserted\r\n\r\n\r\n if isnull(@sayid,0)=0\r\n  return\r\n\r\n\r\nif update(sil)\r\n begin\r\n if (@sil=1) and (@drm='O') \r\n  begin\r\n       SELECT @mesaj = 'Sayımın Onayını Kaldırmadan Sayımı Silemezsiniz..!'\r\n       RAISERROR (@mesaj, 16,1)\r\n       ROLLBACK TRANSACTION\r\n   RETURN\r\n  end\r\n end\r\n \r\n update sayimhrk set drm=@drm,sil=@sil where sayid=@sayid\r\n\r\n\r\nif update(drm) or update(sil)\r\nbegin\r\nif @sil=1 or @drm='B'\r\n  delete from carihrk where islmtip='SAY' AND fisfatid=@sayid\r\nend\r\n\r\nif update(drm) \r\nexec sayimonayla @sayid,@drm\r\n\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "sayimstkgrp_log_trd",
    "table_name": "sayimstkgrp",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[sayimstkgrp_log_trd] ON [dbo].[sayimstkgrp]\r\nWITH EXECUTE AS CALLER\r\nFOR DELETE\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int,@for_log varchar(8000)\r\n  Select @for_log=' id='+cast(id as varchar(50))+' sayid='+cast(sayid as varchar(50))+' firmano='+cast(firmano as varchar(50))+' depkod='+depkod+' stktip='+stktip+' stkgrp1='+cast(stkgrp1 as varchar(50))+' stkgrp2='+cast(stkgrp2 as varchar(50))+' stkgrp3='+cast(stkgrp3 as varchar(50)) from deleted\r\n  exec sp_loglama @firmano,@id,'sayimstkgrp',-2,@for_log\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "sayimstkgrp_log_tri",
    "table_name": "sayimstkgrp",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[sayimstkgrp_log_tri] ON [dbo].[sayimstkgrp]\r\nWITH EXECUTE AS CALLER\r\nFOR INSERT\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int\r\n  Select @firmano=firmano,@id=id from inserted\r\n  exec sp_loglama @firmano,@id,'sayimstkgrp',1,''\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "sayimstkgrp_log_tru",
    "table_name": "sayimstkgrp",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[sayimstkgrp_log_tru] ON [dbo].[sayimstkgrp]\r\nWITH EXECUTE AS CALLER\r\nFOR UPDATE\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int,@sil bit\r\n  Select @firmano=firmano,@id=id,@sil=isnull(sil,0) from inserted\r\n  if update(sil) and (@sil=1)\r\n    exec sp_loglama @firmano,@id,'sayimstkgrp',-1,''\r\n  else\r\n    exec sp_loglama @firmano,@id,'sayimstkgrp',0,''\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "sayimstkgrp_trd",
    "table_name": "sayimstkgrp",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[sayimstkgrp_trd] ON [dbo].[sayimstkgrp]\r\nWITH EXECUTE AS CALLER\r\nFOR DELETE\r\nAS\r\nBEGIN\r\ndeclare @sayid float\r\ndeclare @id    float\r\ndeclare @drm   varchar(2)\r\ndeclare @oncesayid float\r\n\r\n DECLARE sayim_grp_sil\r\n CURSOR FAST_FORWARD  FOR SELECT id,sayid\r\n from deleted\r\n OPEN sayim_grp_sil\r\n  FETCH NEXT FROM sayim_grp_sil INTO  @id,@sayid\r\n  WHILE @@FETCH_STATUS =0\r\n  BEGIN\r\n  \r\n\r\n  delete from sayimhrk where sayid=@sayid\r\n  and stkod in (select kod from stokkart as k\r\n  inner join deleted as d on d.id=@id and\r\n  k.grp1=d.stkgrp1 and k.grp2=d.stkgrp2\r\n  and k.grp3=d.stkgrp3 )\r\n  \r\n  \r\n  FETCH NEXT FROM sayim_grp_sil INTO  @id,@sayid\r\n  END\r\n  CLOSE sayim_grp_sil\r\n  DEALLOCATE sayim_grp_sil\r\n\r\n\r\n  \r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "sayimstkgrp_tri",
    "table_name": "sayimstkgrp",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[sayimstkgrp_tri] ON [dbo].[sayimstkgrp]\r\nWITH EXECUTE AS CALLER\r\nFOR INSERT\r\nAS\r\nBEGIN\r\n\r\ndeclare @sayid float\r\ndeclare @id float\r\ndeclare @stgrp1id int\r\ndeclare @stgrp2id int\r\ndeclare @stgrp3id int\r\n\r\n select @sayid=sayid,@id=id,\r\n @stgrp1id=stkgrp1,\r\n @stgrp2id=stkgrp2,\r\n @stgrp3id=stkgrp3\r\n from inserted;\r\n\r\nexec sayimgiris @sayid,@stgrp1id,@stgrp2id,@stgrp3id\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "sayimstkgrp_tru",
    "table_name": "sayimstkgrp",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[sayimstkgrp_tru] ON [dbo].[sayimstkgrp]\r\nWITH EXECUTE AS CALLER\r\nFOR UPDATE\r\nAS\r\nBEGIN\r\n\r\ndeclare @sayid float\r\ndeclare @id float\r\ndeclare @stgrp1id int\r\ndeclare @stgrp2id int\r\ndeclare @stgrp3id int\r\n\r\n select @sayid=sayid,@id=id,\r\n @stgrp1id=stkgrp1,\r\n @stgrp2id=stkgrp2,\r\n @stgrp3id=stkgrp3\r\n from inserted;\r\n\r\nexec sayimgiris @sayid,@stgrp1id,@stgrp2id,@stgrp3id\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "siparishrk_log_trd",
    "table_name": "siparishrk",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[siparishrk_log_trd] ON [dbo].[siparishrk]\r\nWITH EXECUTE AS CALLER\r\nFOR DELETE\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int,@for_log varchar(8000)\r\n  Select @for_log=' id='+cast(id as varchar(50))+' sipid='+cast(sipid as varchar(50))+' firmano='+cast(firmano as varchar(50))+' sil='+cast(sil as varchar(50))+' irid='+cast(irid as varchar(50))+' kapa='+kapa+' dataok='+cast(dataok as varchar(50))+' kdvtip='+kdvtip+' cartur='+cartur+' carkod='+carkod+' stktip='+stktip+' stkod='+stkod+' mik='+cast(mik as varchar(50))+' carpan='+cast(carpan as varchar(50))+' brim='+brim+' ustbrim='+ustbrim+' kdvyuz='+cast(kdvyuz as varchar(50))+' kdvtut='+cast(kdvtut as varchar(50))+' depo='+depo+' grupid='+cast(grupid as varchar(50))+' olususer='+olususer+' olustarsaat='+cast(olustarsaat as varchar(50))+' deguser='+deguser+' degtarsaat='+cast(degtarsaat as varchar(50))+' brmfiy='+cast(brmfiy as varchar(50))+' tesmik='+cast(tesmik as varchar(50)) from deleted\r\n  exec sp_loglama @firmano,@id,'siparishrk',-2,@for_log\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "siparishrk_log_tri",
    "table_name": "siparishrk",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[siparishrk_log_tri] ON [dbo].[siparishrk]\r\nWITH EXECUTE AS CALLER\r\nFOR INSERT\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int\r\n  Select @firmano=firmano,@id=id from inserted\r\n  exec sp_loglama @firmano,@id,'siparishrk',1,''\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "siparishrk_log_tru",
    "table_name": "siparishrk",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[siparishrk_log_tru] ON [dbo].[siparishrk]\r\nWITH EXECUTE AS CALLER\r\nFOR UPDATE\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int,@sil bit\r\n  Select @firmano=firmano,@id=id,@sil=isnull(sil,0) from inserted\r\n  if update(sil) and (@sil=1)\r\n    exec sp_loglama @firmano,@id,'siparishrk',-1,''\r\n  else\r\n    exec sp_loglama @firmano,@id,'siparishrk',0,''\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "siparishrk_trd",
    "table_name": "siparishrk",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[siparishrk_trd] ON [dbo].[siparishrk]\r\nWITH EXECUTE AS CALLER\r\nFOR DELETE\r\nAS\r\nBEGIN\r\ndeclare @sipid float;\r\ndeclare @kdvtop float,@siptop float;\r\n\r\nselect @sipid=sipid from deleted;\r\n\r\n\r\nselect @siptop=isnull(sum((brmfiy*mik)),0),\r\n@kdvtop=isnull(sum(kdvtut),0) from siparishrk where sipid=@sipid;\r\n\r\nupdate siparismas set siptop=@siptop,kdvtop=@kdvtop where sipid=@sipid;\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "siparishrk_triu",
    "table_name": "siparishrk",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[siparishrk_triu] ON [dbo].[siparishrk]\r\nWITH EXECUTE AS CALLER\r\nFOR INSERT, UPDATE\r\nAS\r\nBEGIN\r\ndeclare @sipid float;\r\ndeclare @kdvtop float,@siptop float;\r\ndeclare @kalmik float\r\n\r\nselect @sipid=sipid from inserted;\r\n\r\nselect @kalmik=isnull(sum(mik-tesmik),0),@siptop=isnull(sum((brmfiy*mik)),0),\r\n@kdvtop=isnull(sum(kdvtut),0) from siparishrk\r\nwhere sipid=@sipid and sil=0;\r\n\r\nupdate siparismas set kaltop=@kalmik,siptop=@siptop,kdvtop=@kdvtop where sipid=@sipid;\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "siparismas_log_trd",
    "table_name": "siparismas",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[siparismas_log_trd] ON [dbo].[siparismas]\r\nWITH EXECUTE AS CALLER\r\nFOR DELETE\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int,@for_log varchar(8000)\r\n  Select @for_log=' id='+cast(id as varchar(50))+' sipid='+cast(sipid as varchar(50))+' firmano='+cast(firmano as varchar(50))+' sil='+cast(sil as varchar(50))+' kayok='+cast(kayok as varchar(50))+' sipad='+sipad+' siptip='+siptip+' siptur='+siptur+' sipturad='+sipturad+' sipseri='+sipseri+' sipno='+sipno+' tarih='+cast(tarih as varchar(50))+' vadtar='+cast(vadtar as varchar(50))+' kdvtip='+kdvtip+' ack='+ack+' kdvtut='+cast(kdvtut as varchar(50))+' depo='+depo+' dataok='+cast(dataok as varchar(50))+' olususer='+olususer+' olustarsaat='+cast(olustarsaat as varchar(50))+' deguser='+deguser+' degtarsaat='+cast(degtarsaat as varchar(50))+' siptop='+cast(siptop as varchar(50))+' kdvtop='+cast(kdvtop as varchar(50))+' cartip='+cartip+' carkod='+carkod+' saat='+saat+' aktip='+aktip+' kaltop='+cast(kaltop as varchar(50))+' irtip='+irtip from deleted\r\n  exec sp_loglama @firmano,@id,'siparismas',-2,@for_log\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "siparismas_log_tri",
    "table_name": "siparismas",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[siparismas_log_tri] ON [dbo].[siparismas]\r\nWITH EXECUTE AS CALLER\r\nFOR INSERT\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int\r\n  Select @firmano=firmano,@id=id from inserted\r\n  exec sp_loglama @firmano,@id,'siparismas',1,''\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "siparismas_log_tru",
    "table_name": "siparismas",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[siparismas_log_tru] ON [dbo].[siparismas]\r\nWITH EXECUTE AS CALLER\r\nFOR UPDATE\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int,@sil bit\r\n  Select @firmano=firmano,@id=id,@sil=isnull(sil,0) from inserted\r\n  if update(sil) and (@sil=1)\r\n    exec sp_loglama @firmano,@id,'siparismas',-1,''\r\n  else\r\n    exec sp_loglama @firmano,@id,'siparismas',0,''\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "siparismas_trd",
    "table_name": "siparismas",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[siparismas_trd] ON [dbo].[siparismas]\r\nWITH EXECUTE AS CALLER\r\nFOR DELETE\r\nAS\r\nBEGIN\r\ndeclare @sipid float;\r\nselect @sipid=sipid from deleted;\r\ndelete from siparishrk where sipid=@sipid;\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "stkbrm_log_trd",
    "table_name": "stkbrm",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[stkbrm_log_trd] ON [dbo].[stkbrm]\r\nWITH EXECUTE AS CALLER\r\nFOR DELETE\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int,@for_log varchar(8000)\r\n  Select @for_log=' id='+cast(id as varchar(50))+' kod='+kod+' firmano='+cast(firmano as varchar(50))+' ad='+ad+' olususer='+olususer+' olustarsaat='+cast(olustarsaat as varchar(50))+' dataok='+cast(dataok as varchar(50))+' Sil='+cast(Sil as varchar(50)) from deleted\r\n  exec sp_loglama @firmano,@id,'stkbrm',-2,@for_log\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "stkbrm_log_tri",
    "table_name": "stkbrm",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[stkbrm_log_tri] ON [dbo].[stkbrm]\r\nWITH EXECUTE AS CALLER\r\nFOR INSERT\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int\r\n  Select @firmano=firmano,@id=id from inserted\r\n  exec sp_loglama @firmano,@id,'stkbrm',1,''\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "stkbrm_log_tru",
    "table_name": "stkbrm",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[stkbrm_log_tru] ON [dbo].[stkbrm]\r\nWITH EXECUTE AS CALLER\r\nFOR UPDATE\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int,@sil bit\r\n  Select @firmano=firmano,@id=id,@sil=isnull(sil,0) from inserted\r\n  if update(sil) and (@sil=1)\r\n    exec sp_loglama @firmano,@id,'stkbrm',-1,''\r\n  else\r\n    exec sp_loglama @firmano,@id,'stkbrm',0,''\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "stkdeptrs_log_trd",
    "table_name": "stkdeptrs",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[stkdeptrs_log_trd] ON [dbo].[stkdeptrs]\r\nWITH EXECUTE AS CALLER\r\nFOR DELETE\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int,@for_log varchar(8000)\r\n  Select @for_log=' id='+cast(id as varchar(50))+' stktrsid='+cast(stktrsid as varchar(50))+' stktip='+stktip+' stkod='+stkod+' tarih='+cast(tarih as varchar(50))+' saat='+saat+' firmano='+cast(firmano as varchar(50))+' varno='+cast(varno as varchar(50))+' varok='+cast(varok as varchar(50))+' girdepkod='+girdepkod+' cikdepkod='+cikdepkod+' yertip='+yertip+' yerad='+yerad+' miktar='+cast(miktar as varchar(50))+' brmfiykdvli='+cast(brmfiykdvli as varchar(50))+' kdvyuz='+cast(kdvyuz as varchar(50))+' otv='+cast(otv as varchar(50))+' kesafet='+cast(kesafet as varchar(50))+' belno='+belno+' ack='+ack+' olususer='+olususer+' olustarsaat='+cast(olustarsaat as varchar(50))+' dataok='+cast(dataok as varchar(50))+' stktipad='+stktipad+' carpan='+cast(carpan as varchar(50))+' brim='+brim+' Sil='+cast(Sil as varchar(50)) from deleted\r\n  exec sp_loglama @firmano,@id,'stkdeptrs',-2,@for_log\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "stkdeptrs_log_tri",
    "table_name": "stkdeptrs",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[stkdeptrs_log_tri] ON [dbo].[stkdeptrs]\r\nWITH EXECUTE AS CALLER\r\nFOR INSERT\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int\r\n  Select @firmano=firmano,@id=id from inserted\r\n  exec sp_loglama @firmano,@id,'stkdeptrs',1,''\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "stkdeptrs_log_tru",
    "table_name": "stkdeptrs",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[stkdeptrs_log_tru] ON [dbo].[stkdeptrs]\r\nWITH EXECUTE AS CALLER\r\nFOR UPDATE\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int,@sil bit\r\n  Select @firmano=firmano,@id=id,@sil=isnull(sil,0) from inserted\r\n  if update(sil) and (@sil=1)\r\n    exec sp_loglama @firmano,@id,'stkdeptrs',-1,''\r\n  else\r\n    exec sp_loglama @firmano,@id,'stkdeptrs',0,''\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "stkdeptrs_trd",
    "table_name": "stkdeptrs",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[stkdeptrs_trd] ON [dbo].[stkdeptrs]\r\nWITH EXECUTE AS CALLER\r\nFOR DELETE\r\nAS\r\nBEGIN\r\ndeclare @idx      float\r\ndeclare @stktrsid float\r\n\r\ndeclare @stkod varchar(30),@islmtip varchar(10),\r\n@stktip varchar(20),@cikdepkod varchar(30),@girdepkod varchar(30),\r\n@miktar float,@tarx datetime\r\n\r\n\r\n  select @stktrsid=stktrsid,@idx=id,@stkod=stkod,@stktip=stktip,\r\n  @cikdepkod=cikdepkod,@girdepkod=girdepkod,@miktar=miktar,@tarx=olustarsaat from deleted;\r\n\r\n   delete from stkhrk where DepTrsHrkId=@stktrsid and tabload='stkdeptrs'\r\n\r\n\r\n   delete from sayachrk where islmid=@stktrsid and islmtip='YAGDOK'\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "stkdeptrs_tru",
    "table_name": "stkdeptrs",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[stkdeptrs_tru] ON [dbo].[stkdeptrs]\r\nWITH EXECUTE AS CALLER\r\nFOR UPDATE\r\nAS\r\nBEGIN\r\n\r\n\r\ndeclare @sil int\r\ndeclare @id float\r\ndeclare @stktrsid float\r\ndeclare @trsid   float\r\n\r\n\r\nselect @sil=sil,@id=id,@stktrsid=stktrsid,@trsid=trs_id from inserted;\r\n\r\n\r\nif UPDATE(sil) and (@sil=1)\r\n begin\r\n \r\n  delete from stkhrk where  tabload='stkdeptrs' \r\n  /*and DeptrsId=@trsid */\r\n   and stkhrkid in (Select stktrsid From stkdeptrs Where Trs_id=@trsid)\r\n  delete from sayachrk where islmid=@stktrsid and islmtip='YAGDOK'\r\n \r\n /*yeni */\r\n  update stkhrk set Sil=1 where isnull(deptrshrkId,0)>0  and  deptrshrkId in \r\n  (select id from inserted Where sil=1 and Trs_id=@trsid and yertip='deptrsislem')\r\n  \r\n \r\n \r\n end\r\n\r\n\r\nif (@sil=0)\r\n begin\r\n \r\n /*stkhrkid=@stktrsid and */\r\n delete from stkhrk where  tabload='stkdeptrs' and DepTrsId=@trsid\r\n  /*stkhrkid in (Select stktrsid From stkdeptrs Where Trs_id=@trsid) */\r\n\r\n  delete from sayachrk where islmid=@stktrsid and islmtip='YAGDOK'\r\n \r\n update stkdeptrs set  stktrsid=id where \r\n trs_id=@trsid and stktrsid=0\r\n \r\n  /*cikis deposu */\r\n  insert stkhrk (firmano,stkhrkid,DepTrsId,DepTrsHrkId,\r\n  tabload,stkod,belno,ack,tarih,saat,stktip,\r\n  olustarsaat,olususer,islmtip,islmtipad,\r\n  yertip,yerad,giren,cikan,depkod,brmfiykdvli,kdvyuz)\r\n  select m.cfirmano,h.stktrsid,h.trs_id,h.id,'stkdeptrs',h.stkod,h.belno,m.ack,\r\n  h.tarih,h.saat,h.stktip,\r\n  h.olustarsaat,h.olususer,h.islmtip,h.islmtipad,\r\n  h.yertip,h.yerad,0,(h.miktar*h.carpan),\r\n  h.cikdepkod,h.brmfiykdvli,h.kdvyuz\r\n  from stkdeptrs  as h with (nolock)\r\n  inner join stkdeptrsmas as m with (nolock) on m.id=h.trs_id\r\n  where h.trs_id=@trsid and h.Sil=0\r\n\r\n  /*giris deposu */\r\n  \r\n  insert stkhrk (firmano,stkhrkid,DepTrsId,DepTrsHrkId,tabload,stkod,belno,ack,\r\n  tarih,saat,stktip,olustarsaat,olususer,islmtip,islmtipad,\r\n  yertip,yerad,giren,cikan,depkod,brmfiykdvli,kdvyuz)\r\n  select m.gfirmano,h.stktrsid,h.trs_id,h.id,'stkdeptrs',\r\n  h.girstkod,h.belno,m.ack,m.tarih,m.saat,h.girstktip,h.olustarsaat,h.olususer,\r\n  h.islmtip,h.islmtipad,\r\n  h.yertip,h.yerad,case when h.gircarpan>0 then ((h.miktar*h.carpan)/h.gircarpan) else h.miktar end,\r\n  0,h.girdepkod,case when h.gircarpan>0 then\r\n  (h.brmfiykdvli*h.carpan)/(h.carpan/h.gircarpan) else h.brmfiykdvli end,\r\n  h.kdvyuz from stkdeptrs  as h with (nolock)\r\n  inner join stkdeptrsmas as m with (nolock) on m.id=h.trs_id\r\n  where h.trs_id=@trsid and h.Sil=0\r\n  \r\n  \r\n  update stkhrk set stkhrkid=id where DepTrsId=@trsid  \r\n  \r\n  \r\n  end\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "Stkdeptrsmas_trd",
    "table_name": "Stkdeptrsmas",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[Stkdeptrsmas_trd] ON [dbo].[Stkdeptrsmas]\r\nWITH EXECUTE AS CALLER\r\nFOR DELETE\r\nAS\r\nBEGIN\r\n\r\n\r\ndeclare @trs_id    float\r\n\r\n select @trs_id=trs_id from deleted\r\n\r\n delete from  stkdeptrs where trs_id=@trs_id  \r\n\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "Stkdeptrsmas_tru",
    "table_name": "Stkdeptrsmas",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[Stkdeptrsmas_tru] ON [dbo].[Stkdeptrsmas]\r\nWITH EXECUTE AS CALLER\r\nFOR UPDATE\r\nAS\r\nBEGIN\r\n \r\n declare @trs_id    float\r\n declare @sil \t\tint\r\n declare @tarih \tdatetime\r\n declare @saat \t    varchar(10)\r\n \r\n \r\n select @sil=sil,@trs_id=trs_id,@tarih=tarih,@saat=saat from inserted\r\n\r\n\r\n if update(sil) or update(kayok)\r\n  update stkdeptrs set sil=@sil,tarih=@tarih,saat=@saat where trs_id=@trs_id \r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "stkhrk_log_trd",
    "table_name": "stkhrk",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[stkhrk_log_trd] ON [dbo].[stkhrk]\r\nWITH EXECUTE AS CALLER\r\nFOR DELETE\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int,@for_log varchar(8000)\r\n  Select @for_log=' id='+cast(id as varchar(50))+' stkhrkid='+cast(stkhrkid as varchar(50))+' tabload='+tabload+' stktip='+stktip+' stkod='+stkod+' gctip='+gctip+' depkod='+depkod+' firmano='+cast(firmano as varchar(50))+' dataok='+cast(dataok as varchar(50))+' islmid='+cast(islmid as varchar(50))+' varno='+cast(varno as varchar(50))+' varok='+cast(varok as varchar(50))+' sil='+cast(sil as varchar(50))+' islmtip='+islmtip+' islmtipad='+islmtipad+' yertip='+yertip+' tarih='+cast(tarih as varchar(50))+' saat='+saat+' yerad='+yerad+' giren='+cast(giren as varchar(50))+' cikan='+cast(cikan as varchar(50))+' kalan='+cast(kalan as varchar(50))+' brmfiykdvli='+cast(brmfiykdvli as varchar(50))+' kdvyuz='+cast(kdvyuz as varchar(50))+' otv='+cast(otv as varchar(50))+' kesafet='+cast(kesafet as varchar(50))+' belno='+belno+' ack='+ack+' olususer='+olususer+' olustarsaat='+cast(olustarsaat as varchar(50))+' stktipad='+stktipad+' pro='+cast(pro as varchar(50))+' aiademik='+cast(aiademik as varchar(50))+' siademik='+cast(siademik as varchar(50))+' brmsatirisktut='+cast(brmsatirisktut as varchar(50))+' brmgidertut='+cast(brmgidertut as varchar(50))+' brmgenelisktut='+cast(brmgenelisktut as varchar(50)) from deleted\r\n  exec sp_loglama @firmano,@id,'stkhrk',-2,@for_log\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "stkhrk_log_tri",
    "table_name": "stkhrk",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[stkhrk_log_tri] ON [dbo].[stkhrk]\r\nWITH EXECUTE AS CALLER\r\nFOR INSERT\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int\r\n  Select @firmano=firmano,@id=id from inserted\r\n  exec sp_loglama @firmano,@id,'stkhrk',1,''\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "stkhrk_log_tru",
    "table_name": "stkhrk",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[stkhrk_log_tru] ON [dbo].[stkhrk]\r\nWITH EXECUTE AS CALLER\r\nFOR UPDATE\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int,@sil bit\r\n  Select @firmano=firmano,@id=id,@sil=isnull(sil,0) from inserted\r\n  if update(sil) and (@sil=1)\r\n    exec sp_loglama @firmano,@id,'stkhrk',-1,''\r\n  else\r\n    exec sp_loglama @firmano,@id,'stkhrk',0,''\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "stkhrk_trd",
    "table_name": "stkhrk",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[stkhrk_trd] ON [dbo].[stkhrk]\r\nWITH EXECUTE AS CALLER\r\nFOR DELETE\r\nAS\r\nBEGIN\r\ndeclare @say int\r\ndeclare @idx float\r\ndeclare @stkod varchar(30),@islmtip varchar(10),\r\n@stktip varchar(20),@depkod varchar(30),\r\n@giren float,@cikan float,@tarx datetime\r\n\r\nDECLARE stokhrksilx CURSOR LOCAL FOR SELECT id,stkod,islmtip,stktip,depkod,giren,cikan,olustarsaat\r\nfrom deleted\r\n OPEN stokhrksilx\r\n  FETCH NEXT FROM stokhrksilx INTO  @idx,@stkod,@islmtip,@stktip,@depkod,@giren,@cikan,@tarx\r\n  WHILE @@FETCH_STATUS <> -1\r\n  BEGIN\r\n\r\nif @idx is not null\r\n  begin\r\n\r\n    \r\n    if  (@islmtip='FATAKALS') or (@islmtip='FATMRALS') \r\n     OR (@islmtip='IRSAKALS') or (@islmtip='IRSMRALS') \r\n     or (@islmtip='FATYGALS') or (@islmtip='KARTAC')\r\n     UPDATE stokkart  SET\r\n     ortalsfiykdvli=DT.ortalsfiy,\r\n     alsfiy=isnull((select top 1 case when k.alskdvtip='Dahil' then \r\n      brmfiykdvli else (brmfiykdvli/(1+kdvyuz)) end\r\n     from stkhrk as h with (nolock) \r\n     inner join stokkart as k with(nolock) on \r\n     k.kod=h.stkod and k.tip=h.stktip\r\n     where h.stkod=@stkod and h.stktip=@stktip\r\n     and h.brmfiykdvli>0\r\n     and h.sil=0 and islmtip in \r\n     ('KARTAC','FATAKALS','FATMRALS',\r\n     'IRSAKALS','IRSMRALS','FATYGALS')\r\n     order by h.tarih desc),alsfiy)\r\n     from stokkart as t  JOIN\r\n     (select h.stkod,h.stktip,\r\n     isnull(case when sum((h.giren-(h.aiademik+h.siademik))) >0  then\r\n     sum((h.giren-(h.aiademik+h.siademik))*brmfiykdvli)\r\n     / sum((h.giren-(h.aiademik+h.siademik)))\r\n     else 0 end,0)   as ortalsfiy\r\n     from stkhrk as h with (nolock) where h.stkod=@stkod and h.stktip=@stktip\r\n     and h.sil=0 group by h.stkod,h.stktip ) DT on\r\n     DT.stkod=T.kod AND DT.stktip=T.tip\r\n     \r\n     \r\n     \r\n\r\n\r\n\r\nend\r\n\r\nFETCH NEXT FROM stokhrksilx INTO  @idx,@stkod,@islmtip,@stktip,@depkod,@giren,@cikan,@tarx\r\nEND\r\nCLOSE stokhrksilx\r\nDEALLOCATE stokhrksilx\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "stkhrk_tru",
    "table_name": "stkhrk",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[stkhrk_tru] ON [dbo].[stkhrk]\r\nWITH EXECUTE AS CALLER\r\nFOR INSERT, UPDATE\r\nAS\r\nBEGIN\r\n\r\ndeclare @idx float\r\n\r\n/*select @idx=id,@pro=pro from inserted */\r\n\r\nDECLARE stok_cur_upins \r\nCURSOR LOCAL FOR SELECT ins.id from inserted as ins\r\n OPEN stok_cur_upins\r\n FETCH NEXT FROM stok_cur_upins INTO  @idx\r\n WHILE @@FETCH_STATUS = 0\r\n BEGIN\r\n\r\n   EXEC stokisle @idx\r\n  \r\n \r\n FETCH NEXT FROM stok_cur_upins INTO  @idx\r\nEND\r\nCLOSE stok_cur_upins\r\nDEALLOCATE stok_cur_upins\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "StokKart_AU",
    "table_name": "stokkart",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[StokKart_AU] ON [dbo].[stokkart]\r\nWITH EXECUTE AS CALLER\r\nFOR UPDATE\r\nAS\r\nBEGIN\r\n\r\n\r\n    /* SET NOCOUNT ON Olunca SCOPE_IDENTITY() Deger Almiyor */\r\n\r\n   \r\n     if not EXISTS (SELECT [id] FROM [petromas_db]..[isletme] \r\n      where dataname=DB_NAME() and isnull(AktarimYapilacak,0)=1 )\r\n      RETURN\r\n     \r\n\r\n     IF NOT EXISTS (SELECT * FROM [petromas_db].dbo.sysobjects WHERE name = N'BayiInfo' AND xtype='U' ) \r\n      RETURN\r\n \r\n   \r\n\r\n\tDECLARE @BayiId INT\r\n\tSET @BayiId = (SELECT TOP 1 [BayiId] FROM [petromas_db]..[BayiInfo] ORDER BY BayiId DESC)\r\n  \r\n    if @BayiId is null\r\n\t RETURN\r\n\t\r\n\r\n\t\r\n\r\n\tINSERT INTO [dbo].[Log_UrunFiyatHistory]\r\n\t\t\t    (\r\n\t\t\t\t\t [Id]\r\n\t\t\t\t\t,[BayiId]\r\n                    ,[KartTipId]\r\n\t\t\t\t\t,[KartId]\r\n\t\t\t\t\t,[Fiyat]\r\n\t\t\t\t\t,[Kdv]\r\n\t\t\t\t\t,[KdvTipId]\r\n\t\t\t\t\t,[ParaBirimId]\r\n\t\t\t\t\t,EskiFiyat\r\n\t\t\t\t\t,DegistirmeKullanici\r\n                    ,DegistirmeTarihSaat\r\n\t\t\t\t\t,TransferStartId\r\n\t\t\t\t\t,TransferStopId\r\n\t\t\t    )\r\n\t\t SELECT ins.id                                                                          \r\n\t\t\t\t,@BayiId\r\n                ,case when ins.Tip='akykt' then 9 else 10 end  \r\n\t\t\t\t,ins.remote_id\r\n\t\t\t\t,ins.sat1fiy\r\n\t\t\t\t,ins.sat1kdv\r\n\t\t\t\t,(CASE WHEN ins.sat1kdvtip = 'Dahil' THEN 1 ELSE 2 END)\r\n\t\t\t\t,(CASE WHEN ins.sat1pbrm = 'TL' THEN 1 ELSE 2 END)\t\t\r\n                ,del.sat1fiy\r\n\t\t\t\t,ins.deguser\r\n                ,getdate()\r\n                ,1\r\n                ,0\r\n\t\t   FROM inserted AS ins \r\n\t\t   JOIN deleted del ON del.id = ins.id \r\n\t\t  WHERE del.sat1fiy != ins.sat1fiy and ins.sat1fiy<>0\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "stokkart_log_trd",
    "table_name": "stokkart",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[stokkart_log_trd] ON [dbo].[stokkart]\r\nWITH EXECUTE AS CALLER\r\nFOR DELETE\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int,@for_log varchar(8000)\r\n  Select @for_log=' id='+cast(id as varchar(50))+' tip='+tip+' kod='+kod+' firmano='+cast(firmano as varchar(50))+' barkod='+barkod+' ad='+ad+' sat1fiy='+cast(sat1fiy as varchar(50))+' sat1kdv='+cast(sat1kdv as varchar(50))+' sat1kdvtip='+sat1kdvtip+' sat2fiy='+cast(sat2fiy as varchar(50))+' sat2kdv='+cast(sat2kdv as varchar(50))+' sat2kdvtip='+sat2kdvtip+' alsfiy='+cast(alsfiy as varchar(50))+' alskdv='+cast(alskdv as varchar(50))+' alskdvtip='+alskdvtip+' kesft='+cast(kesft as varchar(50))+' brim='+brim+' otv='+cast(otv as varchar(50))+' eksat='+eksat+' minmik='+cast(minmik as varchar(50))+' drm='+drm+' muhgrskod='+muhgrskod+' muhckskod='+muhckskod+' brmcarp='+cast(brmcarp as varchar(50))+' brmust='+brmust+' ykno='+ykno+' grp1='+cast(grp1 as varchar(50))+' grp2='+cast(grp2 as varchar(50))+' grp3='+cast(grp3 as varchar(50))+' alsmik='+cast(alsmik as varchar(50))+' satmik='+cast(satmik as varchar(50))+' sil='+cast(sil as varchar(50))+' olususer='+olususer+' olustarsaat='+cast(olustarsaat as varchar(50))+' deguser='+deguser+' degtarsaat='+cast(degtarsaat as varchar(50))+' dataok='+cast(dataok as varchar(50))+' acmik='+cast(acmik as varchar(50))+' karoran1='+cast(karoran1 as varchar(50))+' karoran2='+cast(karoran2 as varchar(50))+' grpkdvoran='+cast(grpkdvoran as varchar(50))+' sat1pbrm='+sat1pbrm+' sat2pbrm='+sat2pbrm+' sat3pbrm='+sat3pbrm+' sat4pbrm='+sat4pbrm+' alspbrm='+alspbrm+' sat3fiy='+cast(sat3fiy as varchar(50))+' sat3kdv='+cast(sat3kdv as varchar(50))+' sat3kdvtip='+sat3kdvtip+' sat4fiy='+cast(sat4fiy as varchar(50))+' sat4kdv='+cast(sat4kdv as varchar(50))+' sat4kdvtip='+sat4kdvtip+' alskdvlitoptut='+cast(alskdvlitoptut as varchar(50))+' satkdvlitoptut='+cast(satkdvlitoptut as varchar(50))+' alsiademik='+cast(alsiademik as varchar(50))+' alsiadekdvlitoptut='+cast(alsiadekdvlitoptut as varchar(50))+' satiademik='+cast(satiademik as varchar(50))+' satiadekdvlitoptut='+cast(satiadekdvlitoptut as varchar(50)) from deleted\r\n  exec sp_loglama @firmano,@id,'stokkart',-2,@for_log\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "stokkart_log_tri",
    "table_name": "stokkart",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[stokkart_log_tri] ON [dbo].[stokkart]\r\nWITH EXECUTE AS CALLER\r\nFOR INSERT\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int\r\n  Select @firmano=firmano,@id=id from inserted\r\n  exec sp_loglama @firmano,@id,'stokkart',1,''\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "stokkart_log_tru",
    "table_name": "stokkart",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[stokkart_log_tru] ON [dbo].[stokkart]\r\nWITH EXECUTE AS CALLER\r\nFOR UPDATE\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int,@sil bit\r\n  Select @firmano=firmano,@id=id,@sil=isnull(sil,0) from inserted\r\n\r\n  if update(sil) and (@sil=1)\r\n    exec sp_loglama @firmano,@id,'stokkart',-1,''\r\n  else\r\n   begin\r\n    if update(sat1fiy) or update(alsfiy)\r\n    or update(sat2fiy) or update(sat3fiy)\r\n    exec sp_loglama @firmano,@id,'stokkart',0,''\r\n    \r\n    end\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "stokkart_trd",
    "table_name": "stokkart",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[stokkart_trd] ON [dbo].[stokkart]\r\nWITH EXECUTE AS CALLER\r\nFOR DELETE\r\nAS\r\nBEGIN\r\ndeclare @tip varchar(10)\r\ndeclare @kod varchar(20)\r\ndeclare @deguser varchar(100)\r\n\r\n  select @tip=tip,@kod=kod,@deguser=deguser from deleted;\r\n\r\n  update barkod Set Sil=1,deguser=@deguser,degtarsaat=GetDate() where tip=@tip and kod=@kod\r\n\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "stokkart_tri",
    "table_name": "stokkart",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[stokkart_tri] ON [dbo].[stokkart]\r\nWITH EXECUTE AS CALLER\r\nFOR INSERT\r\nAS\r\nBEGIN\r\ndeclare @tip      varchar(10)\r\ndeclare @kod      varchar(20)\r\nDECLARE @id       float;\r\n\r\n\r\n\r\nselect @id=id,@tip=tip,@kod=kod from inserted;\r\n\r\nexec stokkartacilis @tip,'',@kod\r\n\r\n if @tip='akykt'\r\n  EXEC numara_no_yaz 'akyktstkkart',@kod\r\n\r\n if @tip='markt'\r\n  EXEC numara_no_yaz 'marktstkkart',@kod\r\n\r\n\r\n  insert into stokfiyathistory (kaytip,firmano,kod,tip,\r\n  sat1fiy,sat1kdv,sat1kdvtip,sat1pbrm,\r\n  sat2fiy,sat2kdv,sat2kdvtip,sat2pbrm,\r\n  sat3fiy,sat3kdv,sat3kdvtip,sat3pbrm,\r\n  sat4fiy,sat4kdv,sat4kdvtip,sat4pbrm,\r\n  alsfiy,alskdv,alskdvtip,alspbrm,\r\n  olususer,olustarsaat)\r\n  select 'KAY',firmano,kod,tip,\r\n  sat1fiy,sat1kdv,sat1kdvtip,sat1pbrm,\r\n  sat2fiy,sat2kdv,sat2kdvtip,sat2pbrm,\r\n  sat3fiy,sat3kdv,sat3kdvtip,sat3pbrm,\r\n  sat4fiy,sat4kdv,sat4kdvtip,sat4pbrm,\r\n  alsfiy,alskdv,alskdvtip,alspbrm,\r\n  olususer,olustarsaat from inserted\r\n  \r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "stokkart_tru",
    "table_name": "stokkart",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[stokkart_tru] ON [dbo].[stokkart]\r\nWITH EXECUTE AS CALLER\r\nFOR UPDATE\r\nAS\r\nBEGIN\r\nDECLARE @id float\r\ndeclare @sil int\r\ndeclare @tip varchar(10)\r\ndeclare @kod varchar(30)\r\ndeclare @deguser varchar(100)\r\ndeclare @degtarsaat datetime\r\n\r\n\r\n select @id=id,@sil=sil,@tip=tip,@kod=kod,\r\n @deguser=deguser,@degtarsaat=degtarsaat\r\n  from inserted\r\n\r\n if @sil=1\r\n  update barkod set Sil=1,\r\n  deguser=@deguser,\r\n  degtarsaat=@degtarsaat  \r\n  where tip=@tip and kod=@kod;\r\n   /*delete from barkod where tip=@tip and kod=@kod; */\r\n\r\n\r\n\r\n if UPDATE(sat1fiy) or UPDATE(sat1kdv)\r\n OR UPDATE(sat1kdvtip) or UPDATE(alsfiy)\r\n  begin\r\n  \r\n  \r\n  insert into stokfiyathistory (kaytip,firmano,kod,tip,\r\n  sat1fiy,sat1kdv,sat1kdvtip,sat1pbrm,\r\n  sat2fiy,sat2kdv,sat2kdvtip,sat2pbrm,\r\n  sat3fiy,sat3kdv,sat3kdvtip,sat3pbrm,\r\n  sat4fiy,sat4kdv,sat4kdvtip,sat4pbrm,\r\n  alsfiy,alskdv,alskdvtip,alspbrm,\r\n  olususer,olustarsaat)\r\n  select 'DUZ',firmano,kod,tip,\r\n  sat1fiy,sat1kdv,sat1kdvtip,sat1pbrm,\r\n  sat2fiy,sat2kdv,sat2kdvtip,sat2pbrm,\r\n  sat3fiy,sat3kdv,sat3kdvtip,sat3pbrm,\r\n  sat4fiy,sat4kdv,sat4kdvtip,sat4pbrm,\r\n  alsfiy,alskdv,alskdvtip,alspbrm,\r\n  deguser,degtarsaat from inserted\r\n  end\r\n\r\n\r\n/*exec stokfiyhistory @id; */\r\n\r\n \r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "TahsilatOdeme_trd",
    "table_name": "TahsilatOdeme",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[TahsilatOdeme_trd] ON [dbo].[TahsilatOdeme]\r\nWITH EXECUTE AS CALLER\r\nFOR DELETE\r\nAS\r\nBEGIN\r\n\r\n \r\n declare  @id\t\t\tINT\r\n declare  @grp_tip \t\tvarchar(30)\r\n \r\n  select @id=id,@grp_tip=grp_tip  from deleted\r\n  \r\n  exec Fatura_TahOde @id,@grp_tip,0\r\n  \r\n  \r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "TahsilatOdeme_tru",
    "table_name": "TahsilatOdeme",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[TahsilatOdeme_tru] ON [dbo].[TahsilatOdeme]\r\nWITH EXECUTE AS CALLER\r\nFOR INSERT, UPDATE\r\nAS\r\nBEGIN\r\n\r\n DECLARE  @id\t\t\tINT\r\n declare  @grp_tip \t\tvarchar(30)\r\n declare  @kayit         bit\r\n declare  @Vadeli         bit\r\n declare @vadetar        datetime\r\n declare @fatid\t\t\t int\r\n \r\n \r\n  select @id=id,@grp_tip=grp_tip,\r\n  @fatid=case When fatid>0 then fatid else fisid end,\r\n  @Vadeli=Vadeli,@VadeTar=VadeTar from inserted\r\n   \r\n   set @kayit=0\r\n  \r\n  if @Vadeli=0\r\n   set @kayit=1 \r\n  \r\n   \r\n\r\n  if @VadeTar<=getdate() and @Vadeli=1\r\n   set @kayit=1\r\n  \r\n  if @fatid>0\r\n     exec Fatura_TahOde @id,@grp_tip,@kayit\r\n     \r\n     \r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "tankkart_log_trd",
    "table_name": "tankkart",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[tankkart_log_trd] ON [dbo].[tankkart]\r\nWITH EXECUTE AS CALLER\r\nFOR DELETE\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int,@for_log varchar(8000)\r\n  Select @for_log=' id='+cast(id as varchar(50))+' kod='+kod+' bagak='+bagak+' firmano='+cast(firmano as varchar(50))+' ad='+ad+' sil='+cast(sil as varchar(50))+' dataok='+cast(dataok as varchar(50))+' kapsit='+cast(kapsit as varchar(50))+' minmik='+cast(minmik as varchar(50))+' drm='+drm+' acmik='+cast(acmik as varchar(50))+' olususer='+olususer+' olustarsaat='+cast(olustarsaat as varchar(50))+' deguser='+deguser+' degtarsaat='+cast(degtarsaat as varchar(50))+' alsmik='+cast(alsmik as varchar(50))+' satmik='+cast(satmik as varchar(50))+' stktip='+stktip+' alskdvlitoptut='+cast(alskdvlitoptut as varchar(50))+' satkdvlitoptut='+cast(satkdvlitoptut as varchar(50)) from deleted\r\n  exec sp_loglama @firmano,@id,'tankkart',-2,@for_log\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "tankkart_log_tri",
    "table_name": "tankkart",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[tankkart_log_tri] ON [dbo].[tankkart]\r\nWITH EXECUTE AS CALLER\r\nFOR INSERT\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int\r\n  Select @firmano=firmano,@id=id from inserted\r\n  exec sp_loglama @firmano,@id,'tankkart',1,''\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "tankkart_log_tru",
    "table_name": "tankkart",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[tankkart_log_tru] ON [dbo].[tankkart]\r\nWITH EXECUTE AS CALLER\r\nFOR UPDATE\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int,@sil bit\r\n  Select @firmano=firmano,@id=id,@sil=isnull(sil,0) from inserted\r\n  if update(sil) and (@sil=1)\r\n    exec sp_loglama @firmano,@id,'tankkart',-1,''\r\n  else\r\n    exec sp_loglama @firmano,@id,'tankkart',0,''\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "tankkart_tri",
    "table_name": "tankkart",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[tankkart_tri] ON [dbo].[tankkart]\r\nWITH EXECUTE AS CALLER\r\nFOR INSERT\r\nAS\r\nBEGIN\r\ndeclare @tip      varchar(10)\r\ndeclare @akkod    varchar(20)\r\ndeclare @kod      varchar(20)\r\ndeclare @depkod   varchar(20)\r\ndeclare @id       FLOAT\r\n\r\nselect @id=id,@tip=stktip,@kod=kod,@akkod=bagak,@depkod=kod from inserted;\r\n\r\nexec stokkartacilis @tip,@depkod,@akkod\r\n\r\nEXEC numara_no_yaz 'tankkart',@kod\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "tankkart_tru",
    "table_name": "tankkart",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[tankkart_tru] ON [dbo].[tankkart]\r\nWITH EXECUTE AS CALLER\r\nFOR UPDATE\r\nAS\r\nBEGIN\r\ndeclare @kod         varchar(20)\r\ndeclare @bagakup     bit\r\nDECLARE @id          float\r\ndeclare @mesaj       varchar(255)\r\n\r\nDECLARE tank_kart_up CURSOR FAST_FORWARD\r\nFOR SELECT ins.id,ins.kod,case when del.bagak<>ins.bagak then 1 else 0 end\r\nfrom inserted as ins inner join deleted as del on del.id=ins.id\r\nOPEN tank_kart_up\r\nFETCH NEXT FROM tank_kart_up INTO @id,@kod,@bagakup\r\nWHILE @@FETCH_STATUS = 0\r\nBEGIN\r\n\r\n   if @bagakup=1\r\n    begin\r\n     IF (SELECT COUNT(*) FROM stkhrk WHERE stktip='akykt' and depkod=@kod and sil=0) > 0\r\n      BEGIN\r\n       SELECT @mesaj = '\"'+@kod+ '\" Kodunun Hareketi Var! Değiştiremezsiniz..!'\r\n       RAISERROR (@mesaj, 16,1)\r\n       ROLLBACK TRANSACTION\r\n      END\r\n     end\r\n\r\n\r\nFETCH NEXT FROM tank_kart_up INTO @id,@kod,@bagakup\r\nEND\r\nCLOSE tank_kart_up\r\nDEALLOCATE tank_kart_up\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "userformlar_trd",
    "table_name": "userformlar",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[userformlar_trd] ON [dbo].[userformlar]\r\nWITH EXECUTE AS CALLER\r\nFOR DELETE\r\nAS\r\nBEGIN\r\n\r\ndeclare @formkod varchar(30);\r\n\r\n\r\nselect @formkod=formkod from deleted;\r\n\r\ndelete from userformhak where formkod=@formkod;\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "userformlar_tri",
    "table_name": "userformlar",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[userformlar_tri] ON [dbo].[userformlar]\r\nWITH EXECUTE AS CALLER\r\nFOR INSERT\r\nAS\r\nBEGIN\r\n\r\ndeclare @formkod varchar(30);\r\ndeclare @say int;\r\n\r\nselect @formkod=formkod from inserted;\r\n\r\nselect @say=count(*) from userformhak where formkod=@formkod\r\nif @say=0\r\ninsert into userformhak (userkod,formkod)\r\nselect kod,@formkod from users\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "users_trd",
    "table_name": "users",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[users_trd] ON [dbo].[users]\r\nWITH EXECUTE AS CALLER\r\nFOR DELETE\r\nAS\r\nBEGIN\r\nSET NOCOUNT ON\r\n\r\nDECLARE @KOD VARCHAR(50);\r\n\r\nSELECT @KOD=KOD FROM DELETED\r\n\r\n\r\nSET NOCOUNT OFF\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "veresifarkhrk_trd",
    "table_name": "veresifarkhrk",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[veresifarkhrk_trd] ON [dbo].[veresifarkhrk]\r\nWITH EXECUTE AS CALLER\r\nFOR DELETE\r\nAS\r\nBEGIN\r\n\r\n\r\n\r\n  update veresihrk set\r\n  brmfiy=brmfiy-farktutar,\r\n  fiyfarktop=case when tip='YFK' then\r\n  fiyfarktop-farktutar else fiyfarktop end,\r\n  vadfarktop=case when tip='VDF' then\r\n  vadfarktop-farktutar else vadfarktop end\r\n  from veresihrk t join\r\n  (select verhrkid,tip,(yeni_fiyat-eski_fiyat) as farktutar\r\n  from deleted )\r\n  dt on dt.verhrkid=t.id\r\n  \r\n  \r\n  update veresimas set vadtar=dt.eski_vadetar from veresimas t\r\n  join (select verid,eski_vadetar from deleted ) dt\r\n  on dt.verid=t.verid\r\n  \r\n  \r\n    /*--- gelir gider yansıması */\r\n   declare @tip        varchar(5)\r\n   declare @masid      int\r\n   select @tip=tip,@masid=masterid from inserted\r\n   exec Fiyat_Fark_Yansıma @tip,@masid,1\r\n  \r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "veresifarkhrk_tri",
    "table_name": "veresifarkhrk",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[veresifarkhrk_tri] ON [dbo].[veresifarkhrk]\r\nWITH EXECUTE AS CALLER\r\nFOR INSERT\r\nAS\r\nBEGIN\r\n\r\n  update veresihrk set\r\n  brmfiy=brmfiy+farktutar,\r\n  fiyfarktop=case when tip='YFK' then\r\n  fiyfarktop+farktutar else fiyfarktop end,\r\n  vadfarktop=case when tip='VDF' then\r\n  vadfarktop+farktutar else vadfarktop end\r\n  from veresihrk t join\r\n  (select verhrkid,tip,(yeni_fiyat-eski_fiyat) as farktutar\r\n  from inserted )\r\n  dt on dt.verhrkid=t.id\r\n\r\n  update veresimas set vadtar=dt.yeni_vadetar from veresimas t\r\n  join (select verid,yeni_vadetar from inserted ) dt\r\n  on dt.verid=t.verid\r\n  \r\n  \r\n  /*--- gelir gider yansıması */\r\n   declare @tip        varchar(5)\r\n   declare @masid      int\r\n   select @tip=tip,@masid=masterid from inserted\r\n   exec Fiyat_Fark_Yansıma @tip,@masid,0\r\n\r\n  \r\n  \r\n\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "veresihrk_log_trd",
    "table_name": "veresihrk",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[veresihrk_log_trd] ON [dbo].[veresihrk]\r\nWITH EXECUTE AS CALLER\r\nFOR DELETE\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int,@for_log varchar(8000)\r\n  Select @for_log=' id='+cast(id as varchar(50))+' varno='+cast(varno as varchar(50))+' verid='+cast(verid as varchar(50))+' firmano='+cast(firmano as varchar(50))+' stktip='+stktip+' stkod='+stkod+' mik='+cast(mik as varchar(50))+' brmfiy='+cast(brmfiy as varchar(50))+' depkod='+depkod+' kdvyuz='+cast(kdvyuz as varchar(50))+' sil='+cast(sil as varchar(50))+' olususer='+olususer+' olustarsaat='+cast(olustarsaat as varchar(50))+' deguser='+deguser+' degtarsaat='+cast(degtarsaat as varchar(50))+' dataok='+cast(dataok as varchar(50))+' yenbrmfiyfark='+cast(yenbrmfiyfark as varchar(50))+' kayok='+cast(kayok as varchar(50))+' akfiytip='+akfiytip+' brim='+brim from deleted\r\n  exec sp_loglama @firmano,@id,'veresihrk',-2,@for_log\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "veresihrk_log_tri",
    "table_name": "veresihrk",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[veresihrk_log_tri] ON [dbo].[veresihrk]\r\nWITH EXECUTE AS CALLER\r\nFOR INSERT\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int\r\n  Select @firmano=firmano,@id=id from inserted\r\n  exec sp_loglama @firmano,@id,'veresihrk',1,''\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "veresihrk_log_tru",
    "table_name": "veresihrk",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[veresihrk_log_tru] ON [dbo].[veresihrk]\r\nWITH EXECUTE AS CALLER\r\nFOR UPDATE\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int,@sil bit\r\n  Select @firmano=firmano,@id=id,@sil=isnull(sil,0) from inserted\r\n  if update(sil) and (@sil=1)\r\n    exec sp_loglama @firmano,@id,'veresihrk',-1,''\r\n  else\r\n    exec sp_loglama @firmano,@id,'veresihrk',0,''\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "veresihrk_trd",
    "table_name": "veresihrk",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[veresihrk_trd] ON [dbo].[veresihrk]\r\nWITH EXECUTE AS CALLER\r\nFOR DELETE\r\nAS\r\nBEGIN\r\ndeclare @id float,@varno float,@verid float\r\ndeclare @vertop float\r\ndeclare @varok int,@sil int,@ototag int,@kayok int\r\nSET NOCOUNT ON\r\n\r\nDECLARE veresihrkup CURSOR LOCAL FOR SELECT deleted.id,deleted.verid,veresimas.varno,\r\nveresimas.varok,deleted.sil,veresimas.ototag,deleted.kayok from deleted\r\ninner join  veresimas on veresimas.verid=deleted.verid\r\n OPEN veresihrkup\r\n  FETCH NEXT FROM veresihrkup INTO  @id,@verid,@varno,@varok,@sil,@ototag,@kayok\r\n  WHILE @@FETCH_STATUS = 0\r\n  BEGIN\r\n\r\n\r\nupdate veresimas set toptut=round(dt.fistop,2),isktop=dt.isktop,\r\nfiyfarktop=dt.fiyfarktop,vadfarktop=dt.vadfarktop from veresimas as t\r\njoin (select isnull(sum(mik*brmfiy),0) as fistop,\r\n isnull(sum(mik*brmfiy*iskyuz),0) as isktop,\r\n isnull(sum(mik*fiyfarktop),0) as fiyfarktop,\r\n isnull(sum(mik*vadfarktop),0) as vadfarktop\r\n from veresihrk where verid=@verid and sil=0) dt\r\n on t.verid=@verid\r\n\r\n\r\n\r\nif (@ototag=1) and (@varok=0)\r\nupdate pomvardimas set otomastop=\r\n(select isnull(sum(mik*(brmfiy-(fiyfarktop+vadfarktop))),0) from veresihrk where varno=@varno and sil=0)\r\nwhere varno=@varno;\r\n\r\nif (@varok=0) and (@ototag=0)\r\nupdate pomvardimas set otomastop=\r\n(select isnull(sum(mik*(brmfiy-(fiyfarktop+vadfarktop))),0) from veresihrk where varno=@varno and sil=0 )\r\nwhere varno=@varno\r\n\r\n\r\nFETCH NEXT FROM veresihrkup INTO  @id,@verid,@varno,@varok,@sil,@ototag,@kayok\r\nEND\r\nCLOSE veresihrkup\r\nDEALLOCATE veresihrkup\r\n\r\n\r\n\r\n\r\nSET NOCOUNT OFF\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "veresihrk_tru",
    "table_name": "veresihrk",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[veresihrk_tru] ON [dbo].[veresihrk]\r\nWITH EXECUTE AS CALLER\r\nFOR UPDATE\r\nAS\r\nBEGIN\r\ndeclare @id \t\tfloat\r\ndeclare @varno \t\tfloat\r\ndeclare @verid \t\tfloat\r\ndeclare @vertop \tfloat\r\ndeclare @varok \t\tint\r\ndeclare @sil \t\tint\r\ndeclare @kayok \t\tint\r\nSET NOCOUNT ON\r\n\r\nDECLARE veresihrkup CURSOR FAST_FORWARD FOR SELECT inserted.id,inserted.verid,m.varno,\r\nm.varok,inserted.sil,inserted.kayok from inserted\r\ninner join  veresimas as m on m.verid=inserted.verid\r\n OPEN veresihrkup\r\n  FETCH NEXT FROM veresihrkup INTO  @id,@verid,@varno,@varok,@sil,@kayok\r\n  WHILE @@FETCH_STATUS =0\r\n  BEGIN\r\n\r\n\r\n   update veresimas set \r\n   toptut=ROUND(CAST (dt.fistop AS decimal (20,2)),2),\r\n   Top_Mik=dt.top_mik,\r\n   Genel_KdvToplam=Dt.topkdv,\r\n   Genel_KdvliToplam=Dt.topkdvli,\r\n   isktop=dt.isktop,\r\n   fiyfarktop=dt.fiyfarktop,\r\n   vadfarktop=dt.vadfarktop \r\n   from veresimas as t\r\n   join (select \r\n   isnull(sum(mik*brmfiy),0) as fistop,\r\n   isnull(sum(mik),0) as top_mik,\r\n   isnull(sum(mik*brmfiy*(iskyuz/100)),0) as isktop,\r\n   \r\n   (isnull(sum(mik*brmfiy),0)-isnull(sum(mik*brmfiy*(iskyuz/100)),0))\r\n   -isnull( sum( ( (mik*brmfiy)-(mik*brmfiy*(iskyuz/100)))  /(1+kdvyuz)),0) as topkdv,\r\n    \r\n   (isnull(sum(mik*brmfiy),0)-isnull(sum(mik*brmfiy*(iskyuz/100)),0)) as topkdvli,\r\n\r\n   isnull(sum(mik*fiyfarktop),0) as fiyfarktop,\r\n   isnull(sum(mik*vadfarktop),0) as vadfarktop\r\n   from veresihrk with (nolock) where verid=@verid and sil=0) dt\r\n   on t.verid=@verid\r\n\r\n   \r\n\r\n\r\n\r\n  FETCH NEXT FROM veresihrkup INTO  @id,@verid,@varno,@varok,@sil,@kayok\r\n  END\r\n CLOSE veresihrkup\r\n DEALLOCATE veresihrkup\r\n\r\n\r\n\r\n\r\nSET NOCOUNT OFF\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "veresimas_log_trd",
    "table_name": "veresimas",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[veresimas_log_trd] ON [dbo].[veresimas]\r\nWITH EXECUTE AS CALLER\r\nFOR DELETE\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int,@for_log varchar(8000)\r\n  Select @for_log=' id='+cast(id as varchar(50))+' verid='+cast(verid as varchar(50))+' varno='+cast(varno as varchar(50))+' firmano='+cast(firmano as varchar(50))+' varok='+cast(varok as varchar(50))+' kayok='+cast(kayok as varchar(50))+' sil='+cast(sil as varchar(50))+' fisad='+fisad+' fistip='+fistip+' yertip='+yertip+' tarih='+cast(tarih as varchar(50))+' yerad='+yerad+' seri='+seri+' no='+no+' ykno='+ykno+' cartip='+cartip+' carkod='+carkod+' plaka='+plaka+' perkod='+perkod+' adaid='+cast(adaid as varchar(50))+' surucu='+surucu+' km='+cast(km as varchar(50))+' toptut='+cast(toptut as varchar(50))+' ack='+ack+' kmsec='+cast(kmsec as varchar(50))+' saat='+saat+' ototag='+cast(ototag as varchar(50))+' olususer='+olususer+' degtarsaat='+cast(degtarsaat as varchar(50))+' deguser='+deguser+' olustarsaat='+cast(olustarsaat as varchar(50))+' dataok='+cast(dataok as varchar(50))+' aktip='+aktip+' fatbelno='+fatbelno+' aktar='+cast(aktar as varchar(50))+' vadtar='+cast(vadtar as varchar(50))+' bagid='+cast(bagid as varchar(50))+' marsatid='+cast(marsatid as varchar(50))+' parabrm='+parabrm+' kur='+cast(kur as varchar(50))+' akid='+cast(akid as varchar(50))+' otocarkod='+otocarkod+' otocarad='+otocarad from deleted\r\n  exec sp_loglama @firmano,@id,'veresimas',-2,@for_log\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "veresimas_log_tri",
    "table_name": "veresimas",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[veresimas_log_tri] ON [dbo].[veresimas]\r\nWITH EXECUTE AS CALLER\r\nFOR INSERT\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int\r\n  Select @firmano=firmano,@id=id from inserted\r\n  exec sp_loglama @firmano,@id,'veresimas',1,''\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "veresimas_log_tru",
    "table_name": "veresimas",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[veresimas_log_tru] ON [dbo].[veresimas]\r\nWITH EXECUTE AS CALLER\r\nFOR UPDATE\r\nAS\r\nbegin\r\n  Declare @firmano int,@id int,@islem int,@sil bit\r\n  Select @firmano=firmano,@id=id,@sil=isnull(sil,0) from inserted\r\n  if update(sil) and (@sil=1)\r\n    exec sp_loglama @firmano,@id,'veresimas',-1,''\r\n  else\r\n    exec sp_loglama @firmano,@id,'veresimas',0,''\r\nend"
  },
  {
    "schema": "dbo",
    "trigger_name": "veresimas_trd",
    "table_name": "veresimas",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[veresimas_trd] ON [dbo].[veresimas]\r\nWITH EXECUTE AS CALLER\r\nFOR DELETE\r\nAS\r\nBEGIN\r\n\r\ndeclare @varno float,@verid float\r\ndeclare @varok int,@sil int,@ototag int,@kayok int\r\ndeclare @cartip      varchar(30)\r\ndeclare @carkod      varchar(20)\r\ndeclare @fistip      varchar(3)\r\ndeclare @aktip       varchar(5)\r\ndeclare @toptutar    float\r\ndeclare @marsatid    float\r\ndeclare @yertip      varchar(30)\r\ndeclare @fisserino   varchar(30)\r\ndeclare @otomas_id   int\r\ndeclare @mesaj       varchar(200)\r\ndeclare @fis_alc_bagverid   int\r\nSET NOCOUNT ON\r\n\r\nDECLARE veresimassil CURSOR LOCAL FOR SELECT varno,verid,fistip,cartip,carkod,varok,\r\nsil,ototag,kayok,aktip,yertip,toptut,marsatid,otomas_id,seri+cast([no] as varchar),\r\n fis_alc_bagverid FROM deleted\r\n OPEN veresimassil\r\n FETCH NEXT FROM veresimassil INTO  @varno,@verid,@fistip,@cartip,@carkod,@varok,\r\n @sil,@ototag,@kayok,@aktip,@yertip,@toptutar,@marsatid,@otomas_id,@fisserino,\r\n @fis_alc_bagverid\r\n WHILE @@FETCH_STATUS = 0\r\n BEGIN\r\n \r\n if @aktip<>'BK'\r\n  begin\r\n  \r\n    set @mesaj=''\r\n     select @mesaj=@fisserino+' Nolu Fiş Aktarılmış Durumda...!'+char(13)+char(10)\r\n\r\n    if @mesaj<>''\r\n     begin\r\n      RAISERROR (@mesaj, 16,1)\r\n      ROLLBACK TRANSACTION\r\n      RETURN\r\n    end\r\n\r\n end\r\n  else\r\n   begin\r\n\r\n     delete from veresihrk where verid=@verid\r\n\r\n    if @kayok=1\r\n     begin\r\n      \r\n      /*\r\n      if @aktip<>'BK'\r\n        delete from carihrk where islmtip='FIS' and masterid=@verid\r\n      ELSE\r\n      */\r\n\r\n\r\n\r\n      if (@yertip='pomvardimas') and (@varok=0)\r\n      begin\r\n          update pomvardimas set otomastop=(select isnull(sum(case when fistip='FISALCSAT' then\r\n                                            -1*(toptut-(fiyfarktop+vadfarktop)) else\r\n                                            toptut-(fiyfarktop+vadfarktop) end ),0)\r\n                                            from veresimas where varno=@varno and ototag>=1 and sil=0)\r\n                                            where varno=@varno\r\n\r\n          update pomvardimas set veresitop=(select isnull(sum(case when fistip='FISALCSAT' then\r\n                                            -1*(toptut-(fiyfarktop+vadfarktop)) else\r\n                                            toptut-(fiyfarktop+vadfarktop) end),0)\r\n                                            from veresimas where varno=@varno and ototag=0 and sil=0)\r\n                                            where varno=@varno\r\n                                            \r\n                                            \r\n          update otomasoku set aktarid=0 where otomasid=@otomas_id                                   \r\n      end\r\n\r\n      if (@yertip='marvardimas') and (@varok=0)\r\n      begin\r\n          update marvardimas set veresitop=\r\n            (select isnull(sum((toptut-(fiyfarktop+vadfarktop))*kur),0) from veresimas where varno=@varno and sil=0 and\r\n             yertip=@yertip) where varno=@varno\r\n\r\n\r\n          update marsatmas set cartip=dt.cartip,carkod=dt.carkod,\r\n                 veresitop=case when fistip='FISVERSAT'\r\n                    THEN dt.veresitop else -dt.veresitop end,\r\n                    islmhrk=dt.fistip,islmhrkad=dt.fisad\r\n                 from marsatmas t join\r\n             (select marsatid,cartip,carkod,fistip,fisad,\r\n             isnull(((toptut-(fiyfarktop+vadfarktop)) *kur),0) as veresitop\r\n             from veresimas where varno=@varno and sil=0 and marsatid=@marsatid )\r\n             dt on dt.marsatid=t.marsatid and t.sil=0\r\n       end\r\n       \r\n       /*fis odeme sil */\r\n       exec Fis_Odeme_Sil @verid  \r\n       \r\n      /*borc kaydedilecek carhrk */\r\n      exec Fis_Cari_Borc @verid,1\r\n    \r\n    \r\n   \r\n      update veresimas set fis_alc_bagverid=0 \r\n       where verid=@fis_alc_bagverid\r\n       \r\n      /*TTS  */\r\n       update bankahrk set sil=1 where fisid=@verid\r\n     \r\n      \r\n       \r\n       \r\n      /*alacak kaydedilecek carhrk */\r\n      exec Fis_Cari_Alacak @verid,1  \r\n     \r\n       exec stokhrkisle 0,'veresihrk','',1,1,@verid\r\n      \r\n      \r\n   end\r\n\r\n\r\nend\r\n\r\nFETCH NEXT FROM veresimassil INTO  @varno,@verid,@fistip,@cartip,@carkod,@varok,\r\n@sil,@ototag,@kayok,@aktip,@yertip,@toptutar,@marsatid,@otomas_id,@fisserino,\r\n@fis_alc_bagverid\r\nEND\r\nCLOSE veresimassil\r\nDEALLOCATE veresimassil\r\n\r\n\r\n\r\n\r\n\r\n\r\nSET NOCOUNT OFF\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "veresimas_tri",
    "table_name": "veresimas",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[veresimas_tri] ON [dbo].[veresimas]\r\nWITH EXECUTE AS CALLER\r\nFOR INSERT\r\nAS\r\nBEGIN\r\n \r\n Declare @idx \t\tfloat\r\n Declare @firmano \t\tfloat\r\n Declare @verIdcount \t\tfloat\r\n \r\n DECLARE veresimasin \r\n CURSOR LOCAL FOR SELECT ins.id,ins.firmano\r\n FROM inserted as ins \r\n OPEN veresimasin\r\n FETCH NEXT FROM veresimasin INTO  @idx,@firmano\r\n WHILE @@FETCH_STATUS = 0\r\n BEGIN\r\n \r\n      update veresimas set verid=id where id=@idx and verid=0\r\n\r\n      select @verIdcount=count(*) from veresimas with (nolock)\r\n      where isnull(verid,0)=0 and firmano=@firmano \r\n\r\n\r\n     if @verIdcount>1\r\n     begin\r\n       RAISERROR ('verId Hatası', 16,1) \r\n       ROLLBACK TRANSACTION\r\n       RETURN\r\n     end\r\n\r\n       \r\n\r\n FETCH NEXT FROM veresimasin INTO  @idx,@firmano\r\nEND\r\nCLOSE veresimasin\r\nDEALLOCATE veresimasin\r\n\r\n\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "veresimas_triu",
    "table_name": "veresimas",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[veresimas_triu] ON [dbo].[veresimas]\r\nWITH EXECUTE AS CALLER\r\nFOR UPDATE\r\nAS\r\nBEGIN\r\ndeclare @varno \t\tfloat\r\n\r\ndeclare @del_varno \tfloat\r\ndeclare @del_varok \tint\r\ndeclare @del_yertip varchar(20)\r\n\r\nDeclare @idx \t\tfloat\r\ndeclare @verid \t\tfloat\r\ndeclare @varok \t\tint\r\ndeclare @sil \t\tint\r\ndeclare\t@ototag \tint\r\ndeclare @kayok \t\tint\r\ndeclare @cartip    \tvarchar(30)\r\ndeclare @carkod \tvarchar(20)\r\ndeclare @fistip \tvarchar(3)\r\ndeclare @delcarkod \tvarchar(20)\r\ndeclare @aktip     \tvarchar(5)\r\ndeclare @yertip    \tvarchar(20)\r\ndeclare @toptutar  \tfloat\r\ndeclare @vtsid     \tfloat\r\ndeclare @marsatid  \tfloat\r\ndeclare @otomas_id \tint\r\ndeclare @islmtar   \tdatetime\r\ndeclare @mesaj     \tvarchar(300)\r\ndeclare @fisserino  varchar(30)\r\ndeclare @fis_alc_bagverid     int\r\ndeclare @firmano      int\r\ndeclare @verIdcount   int\r\n\r\n\r\nif update(varok)\r\n return\r\n\r\nif update(fatid)\r\n return\r\n\r\n\r\nDECLARE veresimasinup CURSOR LOCAL FOR SELECT ins.id,ins.firmano,\r\n ins.varno,del.varno,ins.verid,\r\n ins.fistip,ins.cartip,ins.carkod,ins.varok,del.varok,ins.sil,ins.ototag,\r\n ins.kayok,ins.aktip,ins.yertip,del.yertip,ins.toptut,\r\n ins.marsatid,ins.tarih,ins.vtsid,ins.otomas_id,\r\n ins.seri+cast(ins.[no] as varchar),ins.fis_alc_bagverid \r\n FROM inserted as ins left join deleted as del on ins.id=del.id\r\n OPEN veresimasinup\r\n FETCH NEXT FROM veresimasinup INTO  @idx,@firmano,\r\n @varno,@del_varno,@verid,@fistip,@cartip,@carkod,\r\n @varok,@del_varok,@sil,@ototag,@kayok,@aktip,\r\n @yertip,@del_yertip,@toptutar,@marsatid,@islmtar,@vtsid,@otomas_id,@fisserino,\r\n @fis_alc_bagverid\r\n WHILE @@FETCH_STATUS = 0\r\n BEGIN\r\n \r\n  update veresimas set verid=id where id=@idx and verid=0\r\n\r\n\r\n  select @verIdcount=count(*) from veresimas with (nolock)\r\n  where isnull(verid,0)=0 and firmano=@firmano \r\n\r\n\r\n if @verIdcount>1\r\n begin\r\n   RAISERROR ('verId Hatası', 16,1) \r\n   ROLLBACK TRANSACTION\r\n   RETURN\r\n end\r\n\r\n/*-fiş kaydedilmisse */\r\nif (update(kayok) or update(sil)) and (@kayok=1 or @sil=1)\r\n begin\r\n     \r\n \r\n if @aktip<>'BK'\r\n  begin\r\n  \r\n    set @mesaj=''\r\n     select @mesaj=@fisserino+' Nolu Fiş Aktarılmış Durumda...!'+char(13)+char(10)\r\n\r\n    if @mesaj<>''\r\n     begin\r\n      RAISERROR (@mesaj, 16,1)\r\n      ROLLBACK TRANSACTION\r\n      RETURN\r\n    end\r\n\r\n  end\r\n   else\r\n     begin\r\n \r\n \r\n      update veresihrk set kayok=@kayok,sil=@sil where verid=@verid and sil=0\r\n\r\n      if (@yertip='vts_islem') and (@varok=0) and (@vtsid>0)\r\n         exec Vts_Fis_Giris @vtsid,@sil\r\n\r\n      if @sil=1\r\n       update otomasoku set aktarid=0 where otomasid=@otomas_id \r\n\r\n      /*insert */\r\n      if (@yertip='pomvardimas') and (@varok=0)\r\n      begin\r\n           update pomvardimas set otomastop=(select isnull(sum(case when fistip='FISALCSAT' then\r\n                                              -1*(toptut-(fiyfarktop+vadfarktop)) else\r\n                                              toptut-(fiyfarktop+vadfarktop) end ),0)\r\n                                              from veresimas with (nolock) \r\n                                              where yertip=@yertip and varno=@varno and ototag>=1 and sil=0 )\r\n                                              where varno=@varno\r\n                                              \r\n            update pomvardimas set otomasmik=(select isnull(sum(case when fistip='FISALCSAT' then\r\n                                              -1*(top_mik) else top_mik end ),0)\r\n                                              from veresimas with (nolock) where yertip=@yertip \r\n                                              and varno=@varno and ototag>=1 and sil=0 )\r\n                                              where varno=@varno                                              \r\n                                              \r\n                                              \r\n\r\n            update pomvardimas set veresitop=(select isnull(sum(case when fistip='FISALCSAT' then\r\n                                              -1*(toptut-(fiyfarktop+vadfarktop)   ) else\r\n                                              toptut-(fiyfarktop+vadfarktop) end),0)\r\n                                              from veresimas with (nolock) \r\n                                              where yertip=@yertip and varno=@varno and ototag=0 and sil=0)\r\n                                              where varno=@varno\r\n                                              \r\n             update pomvardimas set veresimik=(select isnull(sum(case when fistip='FISALCSAT' then\r\n                                              -1*(top_mik) else top_mik end),0)\r\n                                              from veresimas with (nolock) \r\n                                              where yertip=@yertip and varno=@varno and ototag=0 and sil=0)\r\n                                              where varno=@varno                                              \r\n                                              \r\n                                              \r\n      end\r\n\r\n\r\n      /*delete */\r\n      if (@del_yertip='pomvardimas') and (@del_varok=0)\r\n      begin\r\n          update pomvardimas set otomastop=(select isnull(sum(case when fistip='FISALCSAT' then\r\n                                            -1*(toptut-(fiyfarktop+vadfarktop)) else\r\n                                             toptut-(fiyfarktop+vadfarktop) end ),0)\r\n                                            from veresimas  with (nolock)  \r\n                                            where yertip=@del_yertip and varno=@del_varno and ototag>=1 and sil=0 )\r\n                                            where varno=@del_varno\r\n                                            \r\n                                            \r\n           update pomvardimas set otomasmik=(select isnull(sum(case when fistip='FISALCSAT' then\r\n                                              -1*(top_mik) else top_mik end ),0)\r\n                                              from veresimas  with (nolock)  \r\n                                              where yertip=@del_yertip \r\n                                              and varno=@del_varno and ototag>=1 and sil=0 )\r\n                                              where varno=@del_varno                                              \r\n           \r\n\r\n          update pomvardimas set veresitop=(select isnull(sum(case when fistip='FISALCSAT' then\r\n                                            -1*(toptut-(fiyfarktop+vadfarktop)) else\r\n                                             toptut-(fiyfarktop+vadfarktop) end),0)\r\n                                             from veresimas  with (nolock)  \r\n                                             where yertip=@del_yertip and varno=@del_varno and ototag=0 and sil=0) \r\n                                             where varno=@del_varno\r\n                                             \r\n         update pomvardimas set veresimik=(select isnull(sum(case when fistip='FISALCSAT' then\r\n                                              -1*(top_mik) else top_mik end),0)\r\n                                              from veresimas  with (nolock) \r\n                                              where yertip=@del_yertip and varno=@del_varno and ototag=0 and sil=0)\r\n                                              where varno=@del_varno                                        \r\n                                             \r\n                                             \r\n      end\r\n\r\n\r\n\r\n      if (@yertip='marvardimas') and (@varok=0)\r\n      begin\r\n      \r\n           update marvardimas set veresitop=\r\n            (select isnull(sum(\r\n            case when fistip='FISVERSAT' then\r\n            (toptut-(fiyfarktop+vadfarktop))*kur\r\n            else\r\n            (toptut-(fiyfarktop+vadfarktop))*-kur end),0)\r\n             from veresimas with (nolock) \r\n             where varno=@varno and sil=0 and yertip=@yertip) where varno=@varno\r\n\r\n            \r\n        end\r\n          \r\n      /*--cari kartlarıdaki otomatik aktarım */\r\n      if (update(varok)) and (@kayok=1) and (@varok=1) and (@aktip='BK')\r\n          exec carifisaktaroto @islmtar,@verid\r\n\r\n      /*alacak fişi ödeme sildirme */\r\n       if (@sil=1)\r\n          exec Fis_Odeme_Sil @verid           \r\n         \r\n       /*borc kaydedilecek carhrk */\r\n        exec Fis_Cari_Borc @verid,@sil\r\n       \r\n      \r\n       /*alacak kaydedilecek carhrk  */\r\n        exec Fis_Cari_Alacak @verid,@sil\r\n      \r\n      /*TTS bankahrk  */\r\n      if (@sil=1)\r\n        update bankahrk set sil=1 where fisid=@verid\r\n      \r\n       \r\n        if (update(kayok) or update(sil)) and (@kayok=1 or @sil=1)  \r\n          exec stokhrkisle 0,'veresihrk','',@kayok,@sil,@verid\r\n        \r\n \r\n      end\r\n        \r\n  end        \r\n\r\n FETCH NEXT FROM veresimasinup INTO  @idx,@firmano,@varno,@del_varno,@verid,@fistip,@cartip,@carkod,\r\n @varok,@del_varok,@sil,@ototag,@kayok,@aktip,\r\n @yertip,@del_yertip,@toptutar,@marsatid,@islmtar,@vtsid,@otomas_id,@fisserino,\r\n @fis_alc_bagverid\r\nEND\r\nCLOSE veresimasinup\r\nDEALLOCATE veresimasinup\r\n\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "veresiyenfiyhrk_trd",
    "table_name": "veresiyenfiyhrk",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[veresiyenfiyhrk_trd] ON [dbo].[veresiyenfiyhrk]\r\nWITH EXECUTE AS CALLER\r\nFOR DELETE\r\nAS\r\nBEGIN\r\n\r\n  update veresihrk set\r\n  brmfiy=brmfiy-farktutar,\r\n  fiyfarktop=fiyfarktop-farktutar\r\n  from veresihrk t join\r\n  (select verhrkid,(yeni_fiyat-eski_fiyat) as farktutar\r\n  from deleted ) dt on dt.verhrkid=t.id\r\n\r\n  update veresimas set vadtar=dt.eski_vadetar from veresimas t\r\n  join (select verid,eski_vadetar from deleted ) dt\r\n  on dt.verid=t.verid\r\n\r\n\r\n    /*--- gelir gider yansıması */\r\n   declare @masid      int\r\n   select @masid=masterid from deleted\r\n   exec Yeni_Fiyat_Fark @masid,1\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "veresiyenfiyhrk_tri",
    "table_name": "veresiyenfiyhrk",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[veresiyenfiyhrk_tri] ON [dbo].[veresiyenfiyhrk]\r\nWITH EXECUTE AS CALLER\r\nFOR INSERT\r\nAS\r\nBEGIN\r\n update veresihrk set\r\n  brmfiy=brmfiy+farktutar,\r\n  fiyfarktop=fiyfarktop+farktutar\r\n  from veresihrk t join\r\n  (select verhrkid,(yeni_fiyat-eski_fiyat) as farktutar\r\n  from inserted )\r\n  dt on dt.verhrkid=t.id\r\n\r\n  update veresimas set vadtar=dt.yeni_vadetar from veresimas t\r\n  join (select verid,yeni_vadetar from inserted ) dt\r\n  on dt.verid=t.verid\r\n\r\n\r\n  /*--- gelir gider yansıması */\r\n   declare @masid      int\r\n   select @masid=masterid from inserted\r\n   exec Yeni_Fiyat_Fark @masid,0\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "zraporhrk_trd",
    "table_name": "zraporhrk",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[zraporhrk_trd] ON [dbo].[zraporhrk]\r\nWITH EXECUTE AS CALLER\r\nFOR DELETE\r\nAS\r\nBEGIN\r\n\r\n\r\ndeclare @zrapid int\r\n\r\n select @zrapid=zrapid from deleted;\r\n\r\nupdate zrapormas set toptut=\r\n(select isnull(sum(miktar*brmfiy),0) from zraporhrk where zrapid=@zrapid and sil=0)\r\nwhere zrapid=@zrapid\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "zraporhrk_tru",
    "table_name": "zraporhrk",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[zraporhrk_tru] ON [dbo].[zraporhrk]\r\nWITH EXECUTE AS CALLER\r\nFOR INSERT, UPDATE\r\nAS\r\nBEGIN\r\n\r\ndeclare @zrapid int\r\n\r\n select @zrapid=zrapid from inserted;\r\n\r\nupdate zrapormas set toptut=\r\n(select isnull(sum(miktar*brmfiy),0) from zraporhrk where zrapid=@zrapid and sil=0)\r\nwhere zrapid=@zrapid\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "zrapormas_trd",
    "table_name": "zrapormas",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[zrapormas_trd] ON [dbo].[zrapormas]\r\nWITH EXECUTE AS CALLER\r\nFOR DELETE\r\nAS\r\nBEGIN\r\n\r\n   declare @zrapid int\r\n\r\n    select @zrapid=zrapid from deleted\r\n\r\n    update zraporhrk set sil=1 where zrapid=@zrapid\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "trigger_name": "zrapormas_tru",
    "table_name": "zrapormas",
    "is_disabled": false,
    "definition": "CREATE TRIGGER [dbo].[zrapormas_tru] ON [dbo].[zrapormas]\r\nWITH EXECUTE AS CALLER\r\nFOR UPDATE\r\nAS\r\nBEGIN\r\n\r\n\r\ndeclare @sil int\r\ndeclare @zrapid int\r\ndeclare @masId int\r\ndeclare @kayok int\r\n\r\n select @zrapid=zrapid,@kayok=kayok,@sil=sil,@masId=MasId from inserted\r\n\r\n if (update(kayok) or update(sil)) and (@kayok=1 or @sil=1)\r\n  update zraporhrk set kayok=@kayok,sil=@sil \r\n  where zrapid=@zrapid and sil=0\r\n  \r\n  \r\n  if @kayok=1\r\n   update zrapormas set \r\n   masId=case when isnull(masId,0)=0 then id else masId end,\r\n   genel_kdv_top=dt.kdv_top,\r\n   genel_top=dt.toplam,\r\n   Genel_Ara_Top=dt.Ara_top\r\n   from zrapormas as t join \r\n   (select round(sum(brmfiy*miktar),2) as toplam,\r\n   (sum( (brmfiy-(brmfiy/(1+kdvyuz)))*miktar) ) as kdv_top,\r\n   ( (sum(brmfiy*miktar)-\r\n   sum( (brmfiy-(brmfiy/(1+kdvyuz)))*miktar)) ) as Ara_Top\r\n   from zraporhrk where zrapid=@zrapid and sil=0)\r\n   dt on t.zrapid=@zrapid\r\n   \r\n\r\n\r\n\r\nEND"
  }
]