{% load static %}
<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>{% block title %}Yeni Telerik Projesi{% endblock %}</title>
  <link rel="icon" href="data:,">
  <style>
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;height:100%;font-size:11px;overflow-x:hidden !important;overflow-y:auto;width:100%;max-width:100vw}
    /* Operasyon sayfasÄ± aÃ§Ä±kken boÅŸ sayfada kaydÄ±rma Ã§ubuÄŸunu gizle */
    body.operasyon-sayfasi-acik {
      overflow-y: hidden !important;
    }
    body.operasyon-sayfasi-acik html {
      overflow-y: hidden !important;
    }
    
    /* main-content overflow kontrolÃ¼ - horizontal scroll olmasÄ±n */
    #main-content{overflow-x:hidden !important;overflow-y:auto;width:100% !important;max-width:100vw !important;position:relative;min-height:auto !important;height:auto !important}
    /* Operasyon sayfasÄ± aÃ§Ä±kken main-content kaydÄ±rmasÄ±nÄ± gizle */
    body.operasyon-sayfasi-acik #main-content {
      overflow-y: hidden !important;
    }
    #main-content > * {max-width:100% !important;overflow-x:hidden !important;width:100% !important}
    
    /* Telerik Grid overflow kontrolÃ¼ - tÃ¼m grid elementlerinde */
    .k-grid, .k-grid-content, .k-grid-header, .k-grid-header-wrap, .k-grid-content-wrap,
    .k-grid table, .k-grid-header table {overflow-x:hidden !important;max-width:100% !important}
    .k-grid-content-locked, .k-grid-header-locked {overflow-x:hidden !important}
    
    /* 3 Sabit Alan - Basit HTML ile */
    #fixed-area-1-container,
    #fixed-area-2-container,
    #fixed-area-3-container {
      font-family: 'Segoe UI', Arial, sans-serif;
    }
    
    /* Tab Container - Basit HTML Tab Sistemi */
    #tabs-container {
      width: 100%;
      margin: 0;
      padding: 0;
      display: flex !important;
      visibility: visible !important;
      overflow-x: auto;
    }
    #tabs-list {
      display: flex !important;
      align-items: center;
      gap: 2px;
      padding: 0;
      margin: 0;
      height: 100%;
      list-style: none;
    }
    /* Flash sorunu Ã§Ã¶zÃ¼mÃ¼: TÃ¼m sabit alanlarÄ± ve iÃ§eriÄŸi sayfa yÃ¼klenene kadar gizle */
    #fixed-area-1-container,
    #fixed-area-2-container,
    #tabs-container,
    #main-content {
      opacity: 0;
      transition: opacity 0.05s;
    }
    /* Sayfa yÃ¼klendikten sonra gÃ¶ster */
    body.loaded #fixed-area-1-container,
    body.loaded #fixed-area-2-container,
    body.loaded #tabs-container,
    body.loaded #main-content {
      opacity: 1 !important;
    }
    
    /* ALAN 1 - BoÅŸ, ileride eklenecek */
    #fixed-area-1-container {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0;
    }
    /* Telerik TabStrip iÃ§in font boyutu (ALAN 3) */
    #tabs .k-tabstrip-item {
      font-size: 12px !important;
    }
    #tabs .k-tabstrip-item .k-link {
      font-size: 12px !important;
      padding: 4px 12px !important;
    }
    /* Eski CSS'ler temizlendi - ArtÄ±k Telerik kullanÄ±lÄ±yor */
    /* Ribbon buton stili - Resimdeki gibi kompakt */
    .ribbon-button {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 4px 6px;
      min-width: 70px;
      max-width: 70px;
      cursor: pointer;
      border-radius: 2px;
      transition: all 0.15s;
      background: transparent;
      border: 1px solid transparent;
    }
    .ribbon-button:hover {
      background: rgba(255,255,255,0.5);
      border: 1px solid #C0C0C0;
    }
    .ribbon-button.active {
      background: rgba(255,255,255,0.8);
      border: 1px solid #808080;
      box-shadow: inset 0 0 2px rgba(0,0,0,0.1);
    }
  </style>
  
  <!-- Telerik Kendo UI CSS -->
  <link rel="stylesheet" href="{% static 'dashboard/kendo/styles/default-main.css' %}" />
  
  <!-- jQuery (Telerik iÃ§in gerekli) -->
  <script src="{% static 'dashboard/js/jquery-3.6.0.min.js' %}"></script>
  
  <!-- Telerik Kendo UI JavaScript (TÃ¼m bileÅŸenler) -->
  <script src="{% static 'dashboard/js/kendo.all.min.js' %}"></script>
  
  <!-- Telerik TÃ¼rkÃ§e KÃ¼ltÃ¼r -->
  <script src="{% static 'dashboard/js/cultures/kendo.culture.tr-TR.min.js' %}"></script>
  <script>
    kendo.culture("tr-TR");
  </script>
  
  <!-- Telerik Lisans -->
  <script src="{% static 'dashboard/kendo/telerik-license.js' %}"></script>
  
  {% block extra_head %}{% endblock %}
</head>

<body>
    <!-- 1. SABÄ°T ALAN: ALAN 1 (En Ãœst) - Koyu Gri -->
  <div id="fixed-area-1-container" style="position:fixed;top:0;left:0;right:0;z-index:10000;background:linear-gradient(to bottom, #616161, #424242);height:24px;border-bottom:1px solid #757575;font-family:'Segoe UI',Arial,sans-serif;font-size:12px;opacity:0;">
    <!-- ALAN 1 Etiketi (Proje anlatÄ±mÄ± iÃ§in) -->
    <span style="position:absolute;left:50%;transform:translateX(-50%);color:#FF0000;font-size:12pt;font-weight:bold;pointer-events:none;white-space:nowrap;">
      ALAN 1 
      <span style="color:#FF0000;font-size:10pt;margin-left:10px;">â†• 24px</span>
      <span style="color:#FF0000;font-size:10pt;margin-left:10px;">â†” 100%</span>
    </span>
  </div>
  
  <!-- 2. SABÄ°T ALAN: ALAN 2 (Ä°konlu Butonlar) - AÃ§Ä±k Gri -->
  <div id="fixed-area-2-container" style="position:fixed;top:24px;left:0;right:0;z-index:9999;background:linear-gradient(to bottom, #f5f5f5, #eeeeee);height:80px;display:flex;align-items:center;justify-content:flex-start;padding:8px 6px;gap:4px;font-family:'Segoe UI',Arial,sans-serif;border-bottom:1px solid #e0e0e0;opacity:0;">
    <!-- Ä°konlu Butonlar (ALAN 2'nin iÃ§inde) -->
    <div id="main-ribbon-container" style="display:flex;align-items:center;gap:4px;overflow-x:auto;flex:1;justify-content:flex-start;">
      <div id="ribbon-buttons" style="display:flex;gap:4px;align-items:center;flex-wrap:nowrap"></div>
    </div>
    <!-- ALAN 2 Etiketi (Proje anlatÄ±mÄ± iÃ§in) -->
    <span style="position:absolute;left:50%;transform:translateX(-50%);color:#FF0000;font-size:12pt;font-weight:bold;pointer-events:none;z-index:1;white-space:nowrap;">
      ALAN 2 
      <span style="color:#FF0000;font-size:10pt;margin-left:10px;">â†• 80px</span>
      <span style="color:#FF0000;font-size:10pt;margin-left:10px;">â†” 100%</span>
    </span>
  </div>
  
  <!-- 3. Tab Container - Telerik TabStrip - AÃ§Ä±k Gri (ALAN 2 ile aynÄ±) -->
  <div id="tabs-container" style="position:fixed;top:104px;left:0;right:0;z-index:9998;height:26px;background:#f5f5f5;border-bottom:1px solid #e0e0e0;padding:0;opacity:0;">
    <div id="tabs"></div>
    <!-- ALAN 3 Etiketi (Proje anlatÄ±mÄ± iÃ§in) -->
    <span style="position:absolute;left:50%;transform:translateX(-50%);color:#FF0000;font-size:12pt;font-weight:bold;pointer-events:none;z-index:1;white-space:nowrap;">
      ALAN 3 
      <span style="color:#FF0000;font-size:10pt;margin-left:10px;">â†• 26px</span>
      <span style="color:#FF0000;font-size:10pt;margin-left:10px;">â†” 100%</span>
    </span>
  </div>
  
  <!-- TANIMLAR ALT MENÃœ -->
  <div id="tanimlar-menu" style="position:fixed;top:28px;left:0;background:#FFFFFF;border:1px solid #E0E0E0;box-shadow:0 2px 4px rgba(0,0,0,0.1);z-index:10001;display:none;min-width:200px;">
    <div id="tanimlar-firmalar" style="padding:5px 15px;cursor:pointer;border-bottom:1px solid #F0F0F0;">Firmalar</div>
    <div id="tanimlar-urunler" style="padding:5px 15px;cursor:pointer;">ÃœrÃ¼nler</div>
  </div>
  
  <!-- FIRMA YÃ–NETÄ°MÄ° WINDOW -->
  <div id="firma-window" style="display:none;">
    <div id="firma-grid-container" style="padding:10px;height:100%;">
      <div id="firma-grid" style="height:300px;"></div>
    </div>
  </div>
  
  <!-- ÃœRÃœN YÃ–NETÄ°MÄ° WINDOW -->
  <div id="urun-window" style="display:none;">
    <div id="urun-grid-container" style="padding:10px;height:100%;">
      <div id="urun-grid" style="height:300px;"></div>
    </div>
  </div>
  
  <!-- Ä°Ã‡ERÄ°K ALANI -->
  <div id="main-content" style="margin-top:130px;padding-top:0;opacity:0;">
    {% block content %}{% endblock %}
  </div>
  
  <!-- TELERÄ°K NOTIFICATION BÄ°LEÅENÄ° -->
  <div id="notification"></div>
  
  <script>
    // MenÃ¼ Ã¶ÄŸelerini veritabanÄ±ndan yÃ¼kle
    var menuItems = {{ menu_items|safe }};
    
    // Tab yÃ¶netimi - Sadece Operasyon sayfasÄ± iÃ§in test
    var tabStrip = null;
    var ignoreSelectEvent = false; // Tab kapatÄ±lÄ±rken select event'ini ignore et
    var activeTabIdToKeep = null; // Pasif tab kapatÄ±ldÄ±ÄŸÄ±nda aktif tab ID'sini korumak iÃ§in
    
    // Ribbon butonlarÄ±nÄ± baÅŸlat
    // TELERÄ°K NOTIFICATION BÄ°LEÅENÄ° - TÃ¼m sayfalarda kullanÄ±labilir
    var notification = null;
    
    // Bildirim gÃ¶sterme fonksiyonlarÄ±
    function showSuccess(message) {
      if (notification) {
        notification.show(message, "success");
      } else {
        // Fallback: Notification henÃ¼z hazÄ±r deÄŸilse alert kullan
        setTimeout(function() {
          if (notification) {
            notification.show(message, "success");
          } else {
            alert(message);
          }
        }, 100);
      }
    }
    
    function showError(message) {
      if (notification) {
        // Hata mesajlarÄ± iÃ§in daha uzun sÃ¼re gÃ¶ster (5 saniye)
        var errorNotification = notification.show(message, "error");
        setTimeout(function() {
          if (errorNotification && notification) {
            notification.hide(errorNotification);
          }
        }, 5000);
      } else {
        // Fallback: Notification henÃ¼z hazÄ±r deÄŸilse alert kullan
        setTimeout(function() {
          if (notification) {
            var errorNotification = notification.show(message, "error");
            setTimeout(function() {
              if (errorNotification && notification) {
                notification.hide(errorNotification);
              }
            }, 5000);
          } else {
            alert(message);
          }
        }, 100);
      }
    }
    
    function showInfo(message) {
      if (notification) {
        notification.show(message, "info");
      } else {
        // Fallback: Notification henÃ¼z hazÄ±r deÄŸilse alert kullan
        setTimeout(function() {
          if (notification) {
            notification.show(message, "info");
          } else {
            alert(message);
          }
        }, 100);
      }
    }
    
    function showWarning(message) {
      if (notification) {
        // UyarÄ± mesajlarÄ± iÃ§in orta sÃ¼re gÃ¶ster (4 saniye)
        var warningNotification = notification.show(message, "warning");
        setTimeout(function() {
          if (warningNotification && notification) {
            notification.hide(warningNotification);
          }
        }, 4000);
      } else {
        // Fallback: Notification henÃ¼z hazÄ±r deÄŸilse alert kullan
        setTimeout(function() {
          if (notification) {
            var warningNotification = notification.show(message, "warning");
            setTimeout(function() {
              if (warningNotification && notification) {
                notification.hide(warningNotification);
              }
            }, 4000);
          } else {
            alert(message);
          }
        }, 100);
      }
    }
    
    $(document).ready(function() {
      // Flash sorunu Ã§Ã¶zÃ¼mÃ¼: Sayfa yÃ¼klendiÄŸinde body'ye 'loaded' class'Ä± ekle
      $('body').addClass('loaded');

      // TELERÄ°K NOTIFICATION BAÅLAT
      if (typeof kendo !== 'undefined' && typeof $.fn.kendoNotification !== 'undefined') {
        try {
          notification = $("#notification").kendoNotification({
            position: { top: 50, right: 50 },
            stacking: "down",
            hideAfter: 3000  // VarsayÄ±lan 3 saniye
          }).data("kendoNotification");
          
          // TEST Ä°Ã‡Ä°N: Konsoldan test edebilmek iÃ§in global fonksiyonlar
          // TarayÄ±cÄ± konsolunda (F12) ÅŸunlarÄ± yazabilirsiniz:
          // showSuccess("Test baÅŸarÄ± mesajÄ±")
          // showError("Test hata mesajÄ±")
          // showWarning("Test uyarÄ± mesajÄ±")
          // showInfo("Test bilgi mesajÄ±")
        } catch(error) {
          console.error("Notification baÅŸlatÄ±lÄ±rken hata:", error);
        }
      }

      // ALAN 1 - BoÅŸ, ileride eklenecek

      // Ribbon butonlarÄ±nÄ± oluÅŸtur (ALAN 2)
      loadRibbonButtons();

      // Telerik TabStrip baÅŸlat (ALAN 3) - Sadece operasyon iÃ§in
      if (typeof kendo !== 'undefined' && typeof $.fn.kendoTabStrip !== 'undefined') {
        tabStrip = $("#tabs").kendoTabStrip({
          animation: false,
          tabPosition: "top",
          select: function(e) {
            // Tab kapatÄ±lÄ±rken select event'ini ignore et
            if (ignoreSelectEvent) {
              console.log("Select event ignore edildi (tab kapatÄ±lÄ±yor)");
              
              // EÄŸer aktif tab korunmasÄ± gerekiyorsa koru
              if (activeTabIdToKeep) {
                console.log("Aktif tab korunuyor (select event iÃ§inde):", activeTabIdToKeep);
                showPageOnly(activeTabIdToKeep);
                activeTabIdToKeep = null; // Temizle
                ignoreSelectEvent = false; // Flag'i kapat
                return;
              }
              
              ignoreSelectEvent = false; // Flag'i kapat
              return;
            }
            
            // Tab'a tÄ±klayÄ±nca sayfayÄ± gÃ¶ster
            var tabItem = $(e.item);
            var tabId = tabItem.attr("data-tab-id");
            var tabText = tabItem.text() || tabItem.html() || "";
            
            console.log("Tab tÄ±klandÄ±, tabId:", tabId, "tabText:", tabText);
            
            // data-tab-id yoksa tabText'ten bul
            if (!tabId) {
              if (tabText.indexOf("Operasyon") >= 0) {
                tabId = "operasyon";
              } else if (tabText.indexOf("Kredi KartÄ±") >= 0 || tabText.indexOf("Kredi") >= 0) {
                tabId = "kredi-karti";
              } else if (tabText.indexOf("Banka") >= 0) {
                tabId = "banka";
              } else if (tabText.indexOf("Tanker") >= 0) {
                tabId = "tanker";
              } else if (tabText.indexOf("Fiyat") >= 0) {
                tabId = "fiyat-degisimi";
              }
            }
            
            if (tabId) {
              console.log("Sayfa gÃ¶steriliyor:", tabId);
              showPageOnly(tabId);
            } else {
              console.log("Tab ID bulunamadÄ±!");
            }
          }
        }).data("kendoTabStrip");
        
      }
      
      // X butonlarÄ±na event delegation (dinamik elementler iÃ§in)
      $(document).on("click", ".tab-close-operasyon", function(e) {
        e.stopPropagation();
        e.preventDefault();
        console.log("Operasyon X butonuna tÄ±klandÄ±!");
        closeOperasyonTab();
      });
      
      $(document).on("click", ".tab-close-kredi-karti", function(e) {
        e.stopPropagation();
        e.preventDefault();
        console.log("Kredi KartÄ± X butonuna tÄ±klandÄ±!");
        closeKrediKartiTab();
      });
      
      $(document).on("click", ".tab-close-banka", function(e) {
        e.stopPropagation();
        e.preventDefault();
        console.log("Banka X butonuna tÄ±klandÄ±!");
        closeBankaTab();
      });
      
      $(document).on("click", ".tab-close-tanker", function(e) {
        e.stopPropagation();
        e.preventDefault();
        console.log("Tanker X butonuna tÄ±klandÄ±!");
        closeTankerTab();
      });
      
      $(document).on("click", ".tab-close-fiyat-degisimi", function(e) {
        e.stopPropagation();
        e.preventDefault();
        console.log("Fiyat DeÄŸiÅŸimi X butonuna tÄ±klandÄ±!");
        closeFiyatDegisimiTab();
      });
    });
    
    // Ribbon butonlarÄ±nÄ± oluÅŸtur (tÃ¼m sayfalarda kullanÄ±labilir) - Telerik Button ile
    function loadRibbonButtons() {
      // Ã–nce mevcut butonlarÄ± temizle
      $("#ribbon-buttons").empty();
      
      menuItems.forEach(function(item) {
        if (item.aktif) {
          // YazÄ±larÄ± kÄ±sa tut, uzunsa kÄ±salt
          var baslik = item.baslik;
          if (baslik.length > 12) {
            baslik = baslik.substring(0, 10) + '...';
          }
          
          // Telerik Button iÃ§in HTML oluÅŸtur
          var buttonId = 'ribbon-btn-' + item.name;
          var buttonHtml = '<button id="' + buttonId + '" class="k-button k-button-md ribbon-button" data-page="' + item.name + '" style="display:flex;flex-direction:column;align-items:center;justify-content:center;padding:4px 6px;min-width:70px;max-width:70px;height:70px;">' +
            '<span style="font-size:32px;margin-bottom:2px;line-height:1;">' + item.icon + '</span>' +
            '<span style="text-align:center;font-size:12px;line-height:1.1;max-width:65px;word-wrap:break-word;">' + baslik + '</span>' +
            '</button>';
          
          $("#ribbon-buttons").append(buttonHtml);
          
          // Telerik Button'Ä± baÅŸlat (sadece gÃ¶rsel)
          if (typeof kendo !== 'undefined' && typeof $.fn.kendoButton !== 'undefined') {
            $("#" + buttonId).kendoButton();
          }
        }
      });
    }
    
    // Tab yÃ¶netimi fonksiyonlarÄ± temizlendi - BaÅŸtan yazÄ±lacak
    
    // Aktif ribbon butonunu ayarlama fonksiyonu - Telerik Button iÃ§in
    function setActiveRibbonButton(pageName) {
      $('button[data-page]').each(function() {
        var page = $(this).data('page');
        var button = $(this).data('kendoButton');
        if (pageName && page === pageName) {
          $(this).addClass('k-state-active');
          $(this).css({
            'background': 'rgba(255,255,255,0.8)',
            'border': '1px solid #808080',
            'box-shadow': 'inset 0 0 2px rgba(0,0,0,0.1)'
          });
        } else {
          $(this).removeClass('k-state-active');
          $(this).css({
            'background': '',
            'border': '',
            'box-shadow': ''
          });
        }
      });
    }
    
    // Aktif tab ID'sini bul
    function getActiveTabId() {
      var activeTab = tabStrip.select();
      if (!activeTab) return null;
      
      var activeTabElement = $(activeTab);
      var activeTabId = activeTabElement.attr("data-tab-id");
      var activeTabText = activeTabElement.text() || activeTabElement.html() || "";
      
      if (!activeTabId) {
        if (activeTabText.indexOf("Operasyon") >= 0) {
          activeTabId = "operasyon";
        } else if (activeTabText.indexOf("Kredi KartÄ±") >= 0 || activeTabText.indexOf("Kredi") >= 0) {
          activeTabId = "kredi-karti";
        } else if (activeTabText.indexOf("Banka") >= 0) {
          activeTabId = "banka";
        } else if (activeTabText.indexOf("Tanker") >= 0) {
          activeTabId = "tanker";
        } else if (activeTabText.indexOf("Fiyat") >= 0) {
          activeTabId = "fiyat-degisimi";
        }
      }
      
      return activeTabId;
    }
    
    // Tab ID'sine gÃ¶re tab index'ini bul (GitHub Ã§Ã¶zÃ¼mÃ¼)
    function getTabIndexById(tabId) {
      var items = tabStrip.items();
      var index = -1;
      for (var i = 0; i < items.length; i++) {
        var tab = $(items[i]);
        var currentTabId = tab.attr("data-tab-id");
        var tabText = tab.text() || tab.html() || "";
        
        // data-tab-id yoksa tabText'ten bul
        if (!currentTabId) {
          if (tabText.indexOf("Operasyon") >= 0) {
            currentTabId = "operasyon";
          } else if (tabText.indexOf("Kredi KartÄ±") >= 0 || tabText.indexOf("Kredi") >= 0) {
            currentTabId = "kredi-karti";
          } else if (tabText.indexOf("Banka") >= 0) {
            currentTabId = "banka";
          } else if (tabText.indexOf("Tanker") >= 0) {
            currentTabId = "tanker";
          } else if (tabText.indexOf("Fiyat") >= 0) {
            currentTabId = "fiyat-degisimi";
          }
        }
        
        if (currentTabId === tabId) {
          index = i;
          break;
        }
      }
      return index;
    }
    
    // Tab kapatÄ±ldÄ±ÄŸÄ±nda solundaki tab'Ä± bul ve gÃ¶ster
    function showNextTabAfterClose(closedTabIndex, wasActiveTab) {
      setTimeout(function() {
        var remainingTabs = tabStrip.items();
        var remainingTabsCount = remainingTabs.length;
        console.log("Kalan tab sayÄ±sÄ±:", remainingTabsCount, "KapatÄ±lan tab index:", closedTabIndex, "Aktif tab mÄ±ydÄ±:", wasActiveTab);
        
        if (remainingTabsCount === 0) {
          // HiÃ§ tab kalmadÄ± â†’ Lobiye dÃ¶n
          console.log("TÃ¼m tab'lar kapandÄ±, lobiye dÃ¶nÃ¼lÃ¼yor...");
          showPageOnly(null);
          setActiveRibbonButton(null);
        } else {
          // Aktif tab kapatÄ±ldÄ±ysa â†’ Solundaki tab'Ä± gÃ¶ster
          // Aktif olmayan tab kapatÄ±ldÄ±ysa â†’ Aktif tab'Ä± koru (sayfa deÄŸiÅŸmesin)
          if (wasActiveTab) {
            // Aktif tab kapatÄ±ldÄ± â†’ Solundaki tab'Ä± aktif yap
            var nextTabIndex;
            if (closedTabIndex > 0) {
              // Solunda tab var â†’ Solundaki tab'Ä± gÃ¶ster
              nextTabIndex = closedTabIndex - 1;
            } else {
              // En soldaki tab kapatÄ±ldÄ± â†’ En soldaki tab'Ä± gÃ¶ster (ÅŸimdi index 0)
              nextTabIndex = 0;
            }
            
            // Index sÄ±nÄ±rlarÄ±nÄ± kontrol et
            if (nextTabIndex >= remainingTabsCount) {
              nextTabIndex = remainingTabsCount - 1;
            }
            
            var nextTab = remainingTabs[nextTabIndex];
            
            if (nextTab) {
              var nextTabElement = $(nextTab);
              var nextTabId = nextTabElement.attr("data-tab-id");
              var nextTabText = nextTabElement.text() || nextTabElement.html() || "";
              
              // data-tab-id yoksa tabText'ten bul
              if (!nextTabId) {
                if (nextTabText.indexOf("Operasyon") >= 0) {
                  nextTabId = "operasyon";
                } else if (nextTabText.indexOf("Kredi KartÄ±") >= 0 || nextTabText.indexOf("Kredi") >= 0) {
                  nextTabId = "kredi-karti";
                } else if (nextTabText.indexOf("Banka") >= 0) {
                  nextTabId = "banka";
                } else if (nextTabText.indexOf("Tanker") >= 0) {
                  nextTabId = "tanker";
                } else if (nextTabText.indexOf("Fiyat") >= 0) {
                  nextTabId = "fiyat-degisimi";
                }
              }
              
              if (nextTabId) {
                console.log("Aktif tab kapatÄ±ldÄ±, solundaki tab gÃ¶steriliyor:", nextTabId, "Index:", nextTabIndex);
                // Aktif tab kapatÄ±ldÄ±ÄŸÄ±nda select event'ini ignore et (Ã§Ã¼nkÃ¼ manuel olarak select yapÄ±yoruz)
                ignoreSelectEvent = true;
                tabStrip.select(nextTabIndex);
                showPageOnly(nextTabId);
                ignoreSelectEvent = false;
              } else {
                console.log("Solundaki tab ID bulunamadÄ±, lobiye dÃ¶nÃ¼lÃ¼yor...");
                showPageOnly(null);
              }
            } else {
              console.log("Solundaki tab bulunamadÄ±, lobiye dÃ¶nÃ¼lÃ¼yor...");
              showPageOnly(null);
            }
          } else {
            // Aktif olmayan tab kapatÄ±ldÄ± â†’ Aktif tab'Ä± koru, sayfa deÄŸiÅŸmesin
            console.log("Aktif olmayan tab kapatÄ±ldÄ±, aktif tab korunuyor...");
            var currentActiveTab = tabStrip.select();
            var remainingTabsArray = tabStrip.items();
            var currentActiveTabIndex = -1;
            for (var j = 0; j < remainingTabsArray.length; j++) {
              if ($(remainingTabsArray[j])[0] === $(currentActiveTab)[0]) {
                currentActiveTabIndex = j;
                break;
              }
            }
            
            if (currentActiveTabIndex >= 0 && currentActiveTabIndex < remainingTabsCount) {
              var activeTabElement = $(currentActiveTab);
              var activeTabId = activeTabElement.attr("data-tab-id");
              var activeTabText = activeTabElement.text() || activeTabElement.html() || "";
              
              // data-tab-id yoksa tabText'ten bul
              if (!activeTabId) {
                if (activeTabText.indexOf("Operasyon") >= 0) {
                  activeTabId = "operasyon";
                } else if (activeTabText.indexOf("Kredi KartÄ±") >= 0 || activeTabText.indexOf("Kredi") >= 0) {
                  activeTabId = "kredi-karti";
                } else if (activeTabText.indexOf("Banka") >= 0) {
                  activeTabId = "banka";
                } else if (activeTabText.indexOf("Tanker") >= 0) {
                  activeTabId = "tanker";
                } else if (activeTabText.indexOf("Fiyat") >= 0) {
                  activeTabId = "fiyat-degisimi";
                }
              }
              
              if (activeTabId) {
                console.log("Aktif tab korunuyor:", activeTabId);
                showPageOnly(activeTabId);
              }
            }
          }
          
          setActiveRibbonButton(null);
        }
        
        // Flag'i her zaman sÄ±fÄ±rla (iÅŸlem bittikten sonra)
        ignoreSelectEvent = false;
      }, 50);
    }
    
    // TÃ¼m sayfalarÄ± gizle, sadece belirtilen sayfayÄ± gÃ¶ster
    function showPageOnly(pageId) {
      // Body class'larÄ±nÄ± temizle
      $('body').removeClass('operasyon-sayfasi-acik kredi-karti-sayfasi-acik banka-sayfasi-acik tanker-sayfasi-acik fiyat-degisimi-sayfasi-acik');
      
      // TÃ¼m sayfalarÄ± gizle
      $('#main-content-operasyon').hide();
      $('#main-content-kredi-karti').hide();
      $('#main-content-banka').hide();
      $('#main-content-tanker').hide();
      $('#main-content-fiyat-degisimi').hide();
      
      // Belirtilen sayfayÄ± gÃ¶ster
      if (pageId === 'operasyon') {
        $('body').addClass('operasyon-sayfasi-acik');
        $('#main-content-operasyon').show();
        $('#title-bar').hide();
      } else if (pageId === 'kredi-karti') {
        $('body').addClass('kredi-karti-sayfasi-acik');
        $('#main-content-kredi-karti').show();
        $('#title-bar').hide();
      } else if (pageId === 'banka') {
        $('body').addClass('banka-sayfasi-acik');
        $('#main-content-banka').show();
        $('#title-bar').hide();
      } else if (pageId === 'tanker') {
        $('body').addClass('tanker-sayfasi-acik');
        $('#main-content-tanker').show();
        $('#title-bar').hide();
      } else if (pageId === 'fiyat-degisimi') {
        $('body').addClass('fiyat-degisimi-sayfasi-acik');
        $('#main-content-fiyat-degisimi').show();
        $('#title-bar').hide();
      } else {
        // HiÃ§bir sayfa aÃ§Ä±k deÄŸilse lobi gÃ¶ster
        $('#title-bar').show();
      }
    }
    
    // Sadece Operasyon sayfasÄ± iÃ§in basit tab mantÄ±ÄŸÄ±
    function openOperasyonTab() {
      if (!tabStrip) {
        console.error("TabStrip baÅŸlatÄ±lmamÄ±ÅŸ!");
        return;
      }
      
      // Tab zaten var mÄ± kontrol et - TÃ¼m tab'larÄ± kontrol et
      var allTabs = tabStrip.items();
      var operasyonTabIndex = -1;
      
      for (var i = 0; i < allTabs.length; i++) {
        var tab = $(allTabs[i]);
        var tabId = tab.attr("data-tab-id");
        var tabText = tab.text() || tab.html() || "";
        
        // data-tab-id veya iÃ§erikte "Operasyon" kelimesi varsa
        if (tabId === "operasyon" || tabText.indexOf("Operasyon") >= 0) {
          operasyonTabIndex = i;
          break;
        }
      }
      
      // Tab zaten varsa sadece aktif yap
      if (operasyonTabIndex >= 0) {
        console.log("Operasyon tab'Ä± zaten var, aktif yapÄ±lÄ±yor...");
        tabStrip.select(operasyonTabIndex);
        showPageOnly('operasyon');
        return;
      }
      
      // Yeni tab ekle
      console.log("Yeni operasyon tab'Ä± ekleniyor...");
      
      // Ã–NCE sayfayÄ± gÃ¶ster (tab eklenmeden Ã¶nce)
      showPageOnly('operasyon');
      
      var tabContent = 'â›½ Operasyon SayfasÄ± <span class="tab-close-operasyon" style="margin-left:6px;cursor:pointer;padding:2px 4px;border-radius:4px;font-weight:bold;">Ã—</span>';
      
      tabStrip.append({
        text: tabContent,
        content: '<div></div>',
        encoded: false
      });
      
      // Tab elementine data-tab-id ekle
      setTimeout(function() {
        var allTabsArray = tabStrip.items();
        var addedTab = allTabsArray[allTabsArray.length - 1];
        $(addedTab).attr("data-tab-id", "operasyon");
        
        // Event delegation zaten document ready'de tanÄ±mlÄ±, burada ekstra bir ÅŸey yapmaya gerek yok
        
        // Tab'Ä± aktif yap
        var tabIndex = allTabsArray.length - 1;
        if (tabIndex >= 0) {
          tabStrip.select(tabIndex);
        }
      }, 100);
    }
    
    // Operasyon tab'Ä±nÄ± kapat
    function closeOperasyonTab() {
      console.log("closeOperasyonTab Ã§aÄŸrÄ±ldÄ±");
      if (!tabStrip) {
        console.error("TabStrip yok!");
        return;
      }
      
      // Tab'Ä± bul ve kapat
      var allTabs = tabStrip.items();
      var operasyonTabIndex = -1;
      
      for (var i = 0; i < allTabs.length; i++) {
        var tab = $(allTabs[i]);
        var tabId = tab.attr("data-tab-id");
        var tabText = tab.text() || tab.html() || "";
        
        if (tabId === "operasyon" || tabText.indexOf("Operasyon") >= 0) {
          operasyonTabIndex = i;
          break;
        }
      }
      
      // KapatÄ±lmadan Ã¶nce aktif tab mÄ± kontrol et ve aktif tab ID'sini kaydet
      var activeTab = tabStrip.select();
      var allTabsArray = tabStrip.items();
      var activeTabIndex = -1;
      for (var j = 0; j < allTabsArray.length; j++) {
        if ($(allTabsArray[j])[0] === $(activeTab)[0]) {
          activeTabIndex = j;
          break;
        }
      }
      var wasActiveTab = (operasyonTabIndex >= 0 && operasyonTabIndex === activeTabIndex);
      
      if (operasyonTabIndex < 0) {
        console.log("Operasyon tab'Ä± bulunamadÄ±!");
        return;
      }
      
      // Pasif tab kapatÄ±lÄ±yorsa aktif tab ID'sini kaydet
      if (!wasActiveTab) {
        activeTabIdToKeep = getActiveTabId();
        ignoreSelectEvent = true; // Select event'ini ignore et
        console.log("Pasif tab kapatÄ±lÄ±yor, aktif tab korunacak:", activeTabIdToKeep);
      }
      
      // GitHub Ã§Ã¶zÃ¼mÃ¼: setTimeout ile remove() Ã§aÄŸrÄ±sÄ±nÄ± ertele
      setTimeout(function() {
        try {
          console.log("Operasyon tab'Ä± kapatÄ±lÄ±yor... Index:", operasyonTabIndex, "Aktif tab mÄ±:", wasActiveTab);
          tabStrip.remove(operasyonTabIndex);
          console.log("Tab kapatÄ±ldÄ±, kalan tab sayÄ±sÄ±:", tabStrip.items().length);
          
          // Pasif tab kapatÄ±ldÄ±ysa aktif tab'Ä± manuel olarak tekrar seÃ§
          if (!wasActiveTab && activeTabIdToKeep) {
            var desiredTabIndex = getTabIndexById(activeTabIdToKeep);
            if (desiredTabIndex >= 0) {
              console.log("Aktif tab manuel olarak tekrar seÃ§iliyor:", activeTabIdToKeep, "Index:", desiredTabIndex);
              ignoreSelectEvent = true; // Manuel seÃ§im sÄ±rasÄ±nda select event'ini ignore et
              tabStrip.select(desiredTabIndex);
              showPageOnly(activeTabIdToKeep);
              ignoreSelectEvent = false;
              activeTabIdToKeep = null;
            }
          } else if (wasActiveTab) {
            // Aktif tab kapatÄ±ldÄ±ysa solundaki tab'Ä± gÃ¶ster
            showNextTabAfterClose(operasyonTabIndex, wasActiveTab);
          }
        } catch(error) {
          console.error("Tab kapatÄ±lÄ±rken hata:", error);
          ignoreSelectEvent = false;
          activeTabIdToKeep = null;
        }
      }, 0);
    }
    
    // Kredi kartÄ± tab'Ä±nÄ± aÃ§ - Operasyon kodlarÄ±nÄ±n birebir aynÄ±sÄ±
    function openKrediKartiTab() {
      if (!tabStrip) {
        console.error("TabStrip baÅŸlatÄ±lmamÄ±ÅŸ!");
        return;
      }
      
      // Tab zaten var mÄ± kontrol et - TÃ¼m tab'larÄ± kontrol et
      var allTabs = tabStrip.items();
      var krediKartiTabIndex = -1;
      
      for (var i = 0; i < allTabs.length; i++) {
        var tab = $(allTabs[i]);
        var tabId = tab.attr("data-tab-id");
        var tabText = tab.text() || tab.html() || "";
        
        // data-tab-id veya iÃ§erikte "Kredi KartÄ±" kelimesi varsa
        if (tabId === "kredi-karti" || tabText.indexOf("Kredi KartÄ±") >= 0) {
          krediKartiTabIndex = i;
          break;
        }
      }
      
      // Tab zaten varsa sadece aktif yap
      if (krediKartiTabIndex >= 0) {
        console.log("Kredi KartÄ± tab'Ä± zaten var, aktif yapÄ±lÄ±yor...");
        tabStrip.select(krediKartiTabIndex);
        showPageOnly('kredi-karti');
        return;
      }
      
      // Yeni tab ekle
      console.log("Yeni kredi kartÄ± tab'Ä± ekleniyor...");
      
      // Ã–NCE sayfayÄ± gÃ¶ster (tab eklenmeden Ã¶nce)
      showPageOnly('kredi-karti');
      
      var tabContent = 'ğŸ’³ Kredi KartÄ± <span class="tab-close-kredi-karti" style="margin-left:6px;cursor:pointer;padding:2px 4px;border-radius:4px;font-weight:bold;">Ã—</span>';
      
      tabStrip.append({
        text: tabContent,
        content: '<div></div>',
        encoded: false
      });
      
      // Tab elementine data-tab-id ekle
      setTimeout(function() {
        var allTabsArray = tabStrip.items();
        var addedTab = allTabsArray[allTabsArray.length - 1];
        $(addedTab).attr("data-tab-id", "kredi-karti");
        
        // Event delegation zaten document ready'de tanÄ±mlÄ±, burada ekstra bir ÅŸey yapmaya gerek yok
        
        // Tab'Ä± aktif yap
        var tabIndex = allTabsArray.length - 1;
        if (tabIndex >= 0) {
          tabStrip.select(tabIndex);
        }
      }, 100);
    }
    
    // Kredi kartÄ± tab'Ä±nÄ± kapat - Operasyon kodlarÄ±nÄ±n birebir aynÄ±sÄ±
    function closeKrediKartiTab() {
      console.log("closeKrediKartiTab Ã§aÄŸrÄ±ldÄ±");
      if (!tabStrip) {
        console.error("TabStrip yok!");
        return;
      }
      
      // Tab'Ä± bul ve kapat
      var allTabs = tabStrip.items();
      var krediKartiTabIndex = -1;
      
      for (var i = 0; i < allTabs.length; i++) {
        var tab = $(allTabs[i]);
        var tabId = tab.attr("data-tab-id");
        var tabText = tab.text() || tab.html() || "";
        
        if (tabId === "kredi-karti" || tabText.indexOf("Kredi KartÄ±") >= 0) {
          krediKartiTabIndex = i;
          break;
        }
      }
      
      // KapatÄ±lmadan Ã¶nce aktif tab mÄ± kontrol et ve aktif tab ID'sini kaydet
      var activeTab = tabStrip.select();
      var allTabsArray = tabStrip.items();
      var activeTabIndex = -1;
      for (var j = 0; j < allTabsArray.length; j++) {
        if ($(allTabsArray[j])[0] === $(activeTab)[0]) {
          activeTabIndex = j;
          break;
        }
      }
      var wasActiveTab = (krediKartiTabIndex >= 0 && krediKartiTabIndex === activeTabIndex);
      
      if (krediKartiTabIndex < 0) {
        console.log("Kredi KartÄ± tab'Ä± bulunamadÄ±!");
        return;
      }
      
      // Pasif tab kapatÄ±lÄ±yorsa aktif tab ID'sini kaydet
      if (!wasActiveTab) {
        activeTabIdToKeep = getActiveTabId();
        ignoreSelectEvent = true;
        console.log("Pasif tab kapatÄ±lÄ±yor, aktif tab korunacak:", activeTabIdToKeep);
      }
      
      // GitHub Ã§Ã¶zÃ¼mÃ¼: setTimeout ile remove() Ã§aÄŸrÄ±sÄ±nÄ± ertele
      setTimeout(function() {
        try {
          console.log("Kredi KartÄ± tab'Ä± kapatÄ±lÄ±yor... Index:", krediKartiTabIndex, "Aktif tab mÄ±:", wasActiveTab);
          tabStrip.remove(krediKartiTabIndex);
          
          // Pasif tab kapatÄ±ldÄ±ysa aktif tab'Ä± manuel olarak tekrar seÃ§
          if (!wasActiveTab && activeTabIdToKeep) {
            var desiredTabIndex = getTabIndexById(activeTabIdToKeep);
            if (desiredTabIndex >= 0) {
              console.log("Aktif tab manuel olarak tekrar seÃ§iliyor:", activeTabIdToKeep, "Index:", desiredTabIndex);
              ignoreSelectEvent = true;
              tabStrip.select(desiredTabIndex);
              showPageOnly(activeTabIdToKeep);
              ignoreSelectEvent = false;
              activeTabIdToKeep = null;
            }
          } else if (wasActiveTab) {
            showNextTabAfterClose(krediKartiTabIndex, wasActiveTab);
          }
        } catch(error) {
          console.error("Tab kapatÄ±lÄ±rken hata:", error);
          ignoreSelectEvent = false;
          activeTabIdToKeep = null;
        }
      }, 0);
    }
    
    // Banka tab'Ä±nÄ± aÃ§ - Operasyon kodlarÄ±nÄ±n birebir aynÄ±sÄ±
    function openBankaTab() {
      if (!tabStrip) {
        console.error("TabStrip baÅŸlatÄ±lmamÄ±ÅŸ!");
        return;
      }
      
      var allTabs = tabStrip.items();
      var bankaTabIndex = -1;
      
      for (var i = 0; i < allTabs.length; i++) {
        var tab = $(allTabs[i]);
        var tabId = tab.attr("data-tab-id");
        var tabText = tab.text() || tab.html() || "";
        
        if (tabId === "banka" || tabText.indexOf("Banka") >= 0) {
          bankaTabIndex = i;
          break;
        }
      }
      
      if (bankaTabIndex >= 0) {
        console.log("Banka tab'Ä± zaten var, aktif yapÄ±lÄ±yor...");
        tabStrip.select(bankaTabIndex);
        showPageOnly('banka');
        return;
      }
      
      console.log("Yeni banka tab'Ä± ekleniyor...");
      showPageOnly('banka');
      
      var tabContent = 'ğŸ¦ Banka <span class="tab-close-banka" style="margin-left:6px;cursor:pointer;padding:2px 4px;border-radius:4px;font-weight:bold;">Ã—</span>';
      
      tabStrip.append({
        text: tabContent,
        content: '<div></div>',
        encoded: false
      });
      
      setTimeout(function() {
        var allTabsArray = tabStrip.items();
        var addedTab = allTabsArray[allTabsArray.length - 1];
        $(addedTab).attr("data-tab-id", "banka");
        var tabIndex = allTabsArray.length - 1;
        if (tabIndex >= 0) {
          tabStrip.select(tabIndex);
        }
      }, 100);
    }
    
    // Banka tab'Ä±nÄ± kapat - Operasyon kodlarÄ±nÄ±n birebir aynÄ±sÄ±
    function closeBankaTab() {
      console.log("closeBankaTab Ã§aÄŸrÄ±ldÄ±");
      if (!tabStrip) {
        console.error("TabStrip yok!");
        return;
      }
      
      var allTabs = tabStrip.items();
      var bankaTabIndex = -1;
      
      for (var i = 0; i < allTabs.length; i++) {
        var tab = $(allTabs[i]);
        var tabId = tab.attr("data-tab-id");
        var tabText = tab.text() || tab.html() || "";
        
        if (tabId === "banka" || tabText.indexOf("Banka") >= 0) {
          bankaTabIndex = i;
          break;
        }
      }
      
      // KapatÄ±lmadan Ã¶nce aktif tab mÄ± kontrol et ve aktif tab ID'sini kaydet
      var activeTab = tabStrip.select();
      var allTabsArray = tabStrip.items();
      var activeTabIndex = -1;
      for (var j = 0; j < allTabsArray.length; j++) {
        if ($(allTabsArray[j])[0] === $(activeTab)[0]) {
          activeTabIndex = j;
          break;
        }
      }
      var wasActiveTab = (bankaTabIndex >= 0 && bankaTabIndex === activeTabIndex);
      
      if (bankaTabIndex < 0) {
        console.log("Banka tab'Ä± bulunamadÄ±!");
        return;
      }
      
      // Pasif tab kapatÄ±lÄ±yorsa aktif tab ID'sini kaydet
      if (!wasActiveTab) {
        activeTabIdToKeep = getActiveTabId();
        ignoreSelectEvent = true;
        console.log("Pasif tab kapatÄ±lÄ±yor, aktif tab korunacak:", activeTabIdToKeep);
      }
      
      // GitHub Ã§Ã¶zÃ¼mÃ¼: setTimeout ile remove() Ã§aÄŸrÄ±sÄ±nÄ± ertele
      setTimeout(function() {
        try {
          console.log("Banka tab'Ä± kapatÄ±lÄ±yor... Index:", bankaTabIndex, "Aktif tab mÄ±:", wasActiveTab);
          tabStrip.remove(bankaTabIndex);
          
          // Pasif tab kapatÄ±ldÄ±ysa aktif tab'Ä± manuel olarak tekrar seÃ§
          if (!wasActiveTab && activeTabIdToKeep) {
            var desiredTabIndex = getTabIndexById(activeTabIdToKeep);
            if (desiredTabIndex >= 0) {
              console.log("Aktif tab manuel olarak tekrar seÃ§iliyor:", activeTabIdToKeep, "Index:", desiredTabIndex);
              ignoreSelectEvent = true;
              tabStrip.select(desiredTabIndex);
              showPageOnly(activeTabIdToKeep);
              ignoreSelectEvent = false;
              activeTabIdToKeep = null;
            }
          } else if (wasActiveTab) {
            showNextTabAfterClose(bankaTabIndex, wasActiveTab);
          }
        } catch(error) {
          console.error("Tab kapatÄ±lÄ±rken hata:", error);
          ignoreSelectEvent = false;
          activeTabIdToKeep = null;
        }
      }, 0);
    }
    
    // Tanker tab'Ä±nÄ± aÃ§ - Operasyon kodlarÄ±nÄ±n birebir aynÄ±sÄ±
    function openTankerTab() {
      if (!tabStrip) {
        console.error("TabStrip baÅŸlatÄ±lmamÄ±ÅŸ!");
        return;
      }
      
      var allTabs = tabStrip.items();
      var tankerTabIndex = -1;
      
      for (var i = 0; i < allTabs.length; i++) {
        var tab = $(allTabs[i]);
        var tabId = tab.attr("data-tab-id");
        var tabText = tab.text() || tab.html() || "";
        
        if (tabId === "tanker" || tabText.indexOf("Tanker") >= 0) {
          tankerTabIndex = i;
          break;
        }
      }
      
      if (tankerTabIndex >= 0) {
        console.log("Tanker tab'Ä± zaten var, aktif yapÄ±lÄ±yor...");
        tabStrip.select(tankerTabIndex);
        showPageOnly('tanker');
        return;
      }
      
      console.log("Yeni tanker tab'Ä± ekleniyor...");
      showPageOnly('tanker');
      
      var tabContent = 'ğŸš› Tanker <span class="tab-close-tanker" style="margin-left:6px;cursor:pointer;padding:2px 4px;border-radius:4px;font-weight:bold;">Ã—</span>';
      
      tabStrip.append({
        text: tabContent,
        content: '<div></div>',
        encoded: false
      });
      
      setTimeout(function() {
        var allTabsArray = tabStrip.items();
        var addedTab = allTabsArray[allTabsArray.length - 1];
        $(addedTab).attr("data-tab-id", "tanker");
        var tabIndex = allTabsArray.length - 1;
        if (tabIndex >= 0) {
          tabStrip.select(tabIndex);
        }
      }, 100);
    }
    
    // Tanker tab'Ä±nÄ± kapat - Operasyon kodlarÄ±nÄ±n birebir aynÄ±sÄ±
    function closeTankerTab() {
      console.log("closeTankerTab Ã§aÄŸrÄ±ldÄ±");
      if (!tabStrip) {
        console.error("TabStrip yok!");
        return;
      }
      
      var allTabs = tabStrip.items();
      var tankerTabIndex = -1;
      
      for (var i = 0; i < allTabs.length; i++) {
        var tab = $(allTabs[i]);
        var tabId = tab.attr("data-tab-id");
        var tabText = tab.text() || tab.html() || "";
        
        if (tabId === "tanker" || tabText.indexOf("Tanker") >= 0) {
          tankerTabIndex = i;
          break;
        }
      }
      
      // KapatÄ±lmadan Ã¶nce aktif tab mÄ± kontrol et ve aktif tab ID'sini kaydet
      var activeTab = tabStrip.select();
      var allTabsArray = tabStrip.items();
      var activeTabIndex = -1;
      for (var j = 0; j < allTabsArray.length; j++) {
        if ($(allTabsArray[j])[0] === $(activeTab)[0]) {
          activeTabIndex = j;
          break;
        }
      }
      var wasActiveTab = (tankerTabIndex >= 0 && tankerTabIndex === activeTabIndex);
      
      if (tankerTabIndex < 0) {
        console.log("Tanker tab'Ä± bulunamadÄ±!");
        return;
      }
      
      // Pasif tab kapatÄ±lÄ±yorsa aktif tab ID'sini kaydet
      if (!wasActiveTab) {
        activeTabIdToKeep = getActiveTabId();
        ignoreSelectEvent = true;
        console.log("Pasif tab kapatÄ±lÄ±yor, aktif tab korunacak:", activeTabIdToKeep);
      }
      
      // GitHub Ã§Ã¶zÃ¼mÃ¼: setTimeout ile remove() Ã§aÄŸrÄ±sÄ±nÄ± ertele
      setTimeout(function() {
        try {
          console.log("Tanker tab'Ä± kapatÄ±lÄ±yor... Index:", tankerTabIndex, "Aktif tab mÄ±:", wasActiveTab);
          tabStrip.remove(tankerTabIndex);
          
          // Pasif tab kapatÄ±ldÄ±ysa aktif tab'Ä± manuel olarak tekrar seÃ§
          if (!wasActiveTab && activeTabIdToKeep) {
            var desiredTabIndex = getTabIndexById(activeTabIdToKeep);
            if (desiredTabIndex >= 0) {
              console.log("Aktif tab manuel olarak tekrar seÃ§iliyor:", activeTabIdToKeep, "Index:", desiredTabIndex);
              ignoreSelectEvent = true;
              tabStrip.select(desiredTabIndex);
              showPageOnly(activeTabIdToKeep);
              ignoreSelectEvent = false;
              activeTabIdToKeep = null;
            }
          } else if (wasActiveTab) {
            showNextTabAfterClose(tankerTabIndex, wasActiveTab);
          }
        } catch(error) {
          console.error("Tab kapatÄ±lÄ±rken hata:", error);
          ignoreSelectEvent = false;
          activeTabIdToKeep = null;
        }
      }, 0);
    }
    
    // Fiyat deÄŸiÅŸimi tab'Ä±nÄ± aÃ§ - Operasyon kodlarÄ±nÄ±n birebir aynÄ±sÄ±
    function openFiyatDegisimiTab() {
      if (!tabStrip) {
        console.error("TabStrip baÅŸlatÄ±lmamÄ±ÅŸ!");
        return;
      }
      
      var allTabs = tabStrip.items();
      var fiyatDegisimiTabIndex = -1;
      
      for (var i = 0; i < allTabs.length; i++) {
        var tab = $(allTabs[i]);
        var tabId = tab.attr("data-tab-id");
        var tabText = tab.text() || tab.html() || "";
        
        if (tabId === "fiyat-degisimi" || tabText.indexOf("Fiyat") >= 0) {
          fiyatDegisimiTabIndex = i;
          break;
        }
      }
      
      if (fiyatDegisimiTabIndex >= 0) {
        console.log("Fiyat DeÄŸiÅŸimi tab'Ä± zaten var, aktif yapÄ±lÄ±yor...");
        tabStrip.select(fiyatDegisimiTabIndex);
        showPageOnly('fiyat-degisimi');
        return;
      }
      
      console.log("Yeni fiyat deÄŸiÅŸimi tab'Ä± ekleniyor...");
      showPageOnly('fiyat-degisimi');
      
      var tabContent = 'ğŸ’° Fiyat DeÄŸiÅŸimi <span class="tab-close-fiyat-degisimi" style="margin-left:6px;cursor:pointer;padding:2px 4px;border-radius:4px;font-weight:bold;">Ã—</span>';
      
      tabStrip.append({
        text: tabContent,
        content: '<div></div>',
        encoded: false
      });
      
      setTimeout(function() {
        var allTabs = tabStrip.items();
        var addedTab = allTabs[allTabs.length - 1];
        $(addedTab).attr("data-tab-id", "fiyat-degisimi");
        var tabIndex = allTabs.length - 1;
        if (tabIndex >= 0) {
          tabStrip.select(tabIndex);
        }
      }, 100);
    }
    
    // Fiyat deÄŸiÅŸimi tab'Ä±nÄ± kapat - Operasyon kodlarÄ±nÄ±n birebir aynÄ±sÄ±
    function closeFiyatDegisimiTab() {
      console.log("closeFiyatDegisimiTab Ã§aÄŸrÄ±ldÄ±");
      if (!tabStrip) {
        console.error("TabStrip yok!");
        return;
      }
      
      var allTabs = tabStrip.items();
      var fiyatDegisimiTabIndex = -1;
      
      for (var i = 0; i < allTabs.length; i++) {
        var tab = $(allTabs[i]);
        var tabId = tab.attr("data-tab-id");
        var tabText = tab.text() || tab.html() || "";
        
        if (tabId === "fiyat-degisimi" || tabText.indexOf("Fiyat") >= 0) {
          fiyatDegisimiTabIndex = i;
          break;
        }
      }
      
      // KapatÄ±lmadan Ã¶nce aktif tab mÄ± kontrol et ve aktif tab ID'sini kaydet
      var activeTab = tabStrip.select();
      var allTabsArray = tabStrip.items();
      var activeTabIndex = -1;
      for (var j = 0; j < allTabsArray.length; j++) {
        if ($(allTabsArray[j])[0] === $(activeTab)[0]) {
          activeTabIndex = j;
          break;
        }
      }
      var wasActiveTab = (fiyatDegisimiTabIndex >= 0 && fiyatDegisimiTabIndex === activeTabIndex);
      
      if (fiyatDegisimiTabIndex < 0) {
        console.log("Fiyat DeÄŸiÅŸimi tab'Ä± bulunamadÄ±!");
        return;
      }
      
      // Pasif tab kapatÄ±lÄ±yorsa aktif tab ID'sini kaydet
      if (!wasActiveTab) {
        activeTabIdToKeep = getActiveTabId();
        ignoreSelectEvent = true;
        console.log("Pasif tab kapatÄ±lÄ±yor, aktif tab korunacak:", activeTabIdToKeep);
      }
      
      // GitHub Ã§Ã¶zÃ¼mÃ¼: setTimeout ile remove() Ã§aÄŸrÄ±sÄ±nÄ± ertele
      setTimeout(function() {
        try {
          console.log("Fiyat DeÄŸiÅŸimi tab'Ä± kapatÄ±lÄ±yor... Index:", fiyatDegisimiTabIndex, "Aktif tab mÄ±:", wasActiveTab);
          tabStrip.remove(fiyatDegisimiTabIndex);
          
          // Pasif tab kapatÄ±ldÄ±ysa aktif tab'Ä± manuel olarak tekrar seÃ§
          if (!wasActiveTab && activeTabIdToKeep) {
            var desiredTabIndex = getTabIndexById(activeTabIdToKeep);
            if (desiredTabIndex >= 0) {
              console.log("Aktif tab manuel olarak tekrar seÃ§iliyor:", activeTabIdToKeep, "Index:", desiredTabIndex);
              ignoreSelectEvent = true;
              tabStrip.select(desiredTabIndex);
              showPageOnly(activeTabIdToKeep);
              ignoreSelectEvent = false;
              activeTabIdToKeep = null;
            }
          } else if (wasActiveTab) {
            showNextTabAfterClose(fiyatDegisimiTabIndex, wasActiveTab);
          }
        } catch(error) {
          console.error("Tab kapatÄ±lÄ±rken hata:", error);
          ignoreSelectEvent = false;
          activeTabIdToKeep = null;
        }
      }, 0);
    }
    
    // Ribbon butonlarÄ±na tÄ±klama - TÃ¼m sayfalar iÃ§in
    $(document).on("click", ".ribbon-button", function(e) {
      e.preventDefault();
      e.stopPropagation();
      
      var pageName = $(this).data('page');
      console.log("Ribbon buton tÄ±klandÄ±, pageName:", pageName);
      
      // Operasyon sayfasÄ±
      if (pageName === 'operasyon_sayfasi' || pageName === 'operasyon') {
        console.log("Operasyon sayfasÄ± aÃ§Ä±lÄ±yor...");
        openOperasyonTab();
        setActiveRibbonButton(pageName);
      }
      // Kredi KartÄ± sayfasÄ±
      else if (pageName === 'kredi_karti' || pageName === 'kredi-karti' || pageName === 'kredi_kart') {
        console.log("Kredi KartÄ± sayfasÄ± aÃ§Ä±lÄ±yor...");
        openKrediKartiTab();
        setActiveRibbonButton(pageName);
      }
      // Banka sayfasÄ±
      else if (pageName === 'banka') {
        console.log("Banka sayfasÄ± aÃ§Ä±lÄ±yor...");
        openBankaTab();
        setActiveRibbonButton(pageName);
      }
      // Tanker sayfasÄ±
      else if (pageName === 'tanker') {
        console.log("Tanker sayfasÄ± aÃ§Ä±lÄ±yor...");
        openTankerTab();
        setActiveRibbonButton(pageName);
      }
      // Fiyat DeÄŸiÅŸimi sayfasÄ±
      else if (pageName === 'fiyat_degisimi' || pageName === 'fiyat-degisimi') {
        console.log("Fiyat DeÄŸiÅŸimi sayfasÄ± aÃ§Ä±lÄ±yor...");
        openFiyatDegisimiTab();
        setActiveRibbonButton(pageName);
      } else {
        // DiÄŸer sayfalar iÃ§in ÅŸimdilik bir ÅŸey yapma
        console.log("DiÄŸer sayfa:", pageName, "- Åimdilik Ã§alÄ±ÅŸmÄ±yor");
      }
    });
  </script>
  
  {% block extra_scripts %}{% endblock %}
</body>
</html>
