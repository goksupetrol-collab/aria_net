[
  {
    "schema": "dbo",
    "name": "BARKOD_STOK_GETIR",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.BARKOD_STOK_GETIR",
    "definition": "CREATE FUNCTION [dbo].BARKOD_STOK_GETIR\r\n(@TIP varchar(10),@BARKOD VARCHAR(20))\r\nRETURNS\r\n   @TB_BARKOD_STOK TABLE (\r\n    STOK_TIP             VARCHAR(10) COLLATE Turkish_CI_AS,\r\n    STOK_BARKOD          VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    STOK_KOD             VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    STOK_AD              VARCHAR(150) COLLATE Turkish_CI_AS,\r\n    STOK_ANABRIM         VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    STOK_BARKODBRIM      VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    BAR_BRMCARPAN        FLOAT,\r\n    MEVCUT_MIKTAR        FLOAT)\r\nAS\r\nBEGIN\r\n\r\n  if (select COUNT(*) from stokkart as k\r\n  inner join barkod as b on b.barkod=@BARKOD\r\n  and b.kod=k.kod and k.tip=@TIP and k.tip=b.tip and\r\n  b.sil=0 and k.sil=0)>0\r\n    begin\r\n     insert into @TB_BARKOD_STOK (STOK_TIP,STOK_BARKOD,STOK_KOD,STOK_AD,\r\n     STOK_ANABRIM,STOK_BARKODBRIM,BAR_BRMCARPAN,MEVCUT_MIKTAR)\r\n     select k.tip,b.barkod,k.kod,k.ad,k.brim,b.brim,b.carpan,\r\n     (k.alsmik-k.satmik) from stokkart as k\r\n     inner join barkod as b on b.barkod=@BARKOD\r\n     and b.kod=k.kod and k.tip=@TIP and k.tip=b.tip and\r\n     b.sil=0 and k.sil=0\r\n    end\r\n  else\r\n    begin\r\n     insert into @TB_BARKOD_STOK (STOK_TIP,STOK_BARKOD,STOK_KOD,STOK_AD,\r\n     STOK_ANABRIM,STOK_BARKODBRIM,BAR_BRMCARPAN,MEVCUT_MIKTAR)\r\n     select @TIP,@BARKOD,@BARKOD,'YOK','-','-',1,0\r\n    \r\n    end\r\n\r\n  \r\n  \r\n RETURN\r\n  \r\n  \r\nEND"
  },
  {
    "schema": "dbo",
    "name": "Belge_No_Getir",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.Belge_No_Getir",
    "definition": "CREATE FUNCTION [dbo].Belge_No_Getir\r\n(@firmano              int,\r\n@seriver               bit,\r\n@belgetip              varchar(10),\r\n@seri                  varchar(10))\r\nRETURNS\r\n   @TB_BELGE_SERI_NO TABLE (\r\n    BELGE_SERI           VARCHAR(10) COLLATE Turkish_CI_AS,\r\n    BELGE_SERINO         FLOAT)\r\nAS\r\nBEGIN\r\n\r\n\r\ndeclare @max_id      int\r\ndeclare @HRK_SERINO  float\r\n\r\ndeclare @HRK_SERI    varchar(10)\r\nset @HRK_SERI=@seri\r\n\r\n\r\n  /*-Promosyon Fis */\r\n    if (@belgetip='PRS') \r\n     begin\r\n     \r\n     \r\n     if @seriver=1\r\n       select top 1\r\n       @HRK_SERINO=isnull(v.no,0),\r\n       @HRK_SERI=isnull(v.seri,'') from \r\n       Prom_Sat_Baslik as v WITH (NOLOCK) where sil=0\r\n        and ISNUMERIC(v.no)=1 and firmano=@firmano\r\n        and v.seri <>'AUTO' order by id desc\r\n        \r\n     if @seriver=0\r\n       select top 1\r\n       @HRK_SERINO=isnull(v.no,0),\r\n       @HRK_SERI=@seri from \r\n       Prom_Sat_Baslik as v WITH (NOLOCK) where sil=0\r\n        and v.seri=@seri and firmano=@firmano\r\n        and ISNUMERIC(v.no)=1\r\n        and v.seri <>'AUTO' order by id desc\r\n        \r\n        \r\n        \r\n       if @HRK_SERINO is null\r\n       insert into @TB_BELGE_SERI_NO (BELGE_SERI,BELGE_SERINO)\r\n        select @HRK_SERI,'1'\r\n        else\r\n        insert into @TB_BELGE_SERI_NO (BELGE_SERI,BELGE_SERINO)\r\n        select @HRK_SERI,@HRK_SERINO+1\r\n     end\r\n\r\n\r\n  /*-Zrapor */\r\n    if (@belgetip='ZRAP') \r\n     begin\r\n     \r\n     \r\n     if @seriver=1\r\n       select top 1\r\n       @HRK_SERINO=isnull(v.zserino,0),\r\n       @HRK_SERI=isnull(v.zseri,'') from \r\n       zrapormas as v WITH (NOLOCK) where sil=0\r\n        and ISNUMERIC(v.zserino)=1 and firmano=@firmano\r\n        order by id desc\r\n        \r\n     if @seriver=0\r\n       select top 1\r\n       @HRK_SERINO=isnull(v.zserino,0),\r\n       @HRK_SERI=@seri from \r\n       zrapormas as v WITH (NOLOCK) where sil=0\r\n        and v.zserino=@seri and firmano=@firmano\r\n        and ISNUMERIC(v.zserino)=1\r\n        order by id desc\r\n        \r\n        \r\n        \r\n       if @HRK_SERINO is null\r\n       insert into @TB_BELGE_SERI_NO (BELGE_SERI,BELGE_SERINO)\r\n        select @HRK_SERI,'1'\r\n        else\r\n        insert into @TB_BELGE_SERI_NO (BELGE_SERI,BELGE_SERINO)\r\n        select @HRK_SERI,@HRK_SERINO+1\r\n     end\r\n\r\n   /*-fisler */\r\n    if (@belgetip='FIS') \r\n     begin\r\n     \r\n     \r\n     if @seriver=1\r\n       select top 1\r\n       @HRK_SERINO=isnull(v.no,0),\r\n       @HRK_SERI=isnull(v.seri,'') from veresimas as v \r\n       WITH (NOLOCK) where sil=0\r\n        and ISNUMERIC(v.no)=1 and firmano=@firmano\r\n        and v.seri <>'AUTO' and bagid=0 order by id desc\r\n        \r\n     if @seriver=0\r\n       select top 1\r\n       @HRK_SERINO=isnull(v.no,0),\r\n       @HRK_SERI=@seri from veresimas as v WITH (NOLOCK) where sil=0\r\n        and v.seri=@seri and firmano=@firmano\r\n        and ISNUMERIC(v.no)=1\r\n        and v.seri <>'AUTO' and bagid=0 order by id desc\r\n        \r\n        \r\n        \r\n       if @HRK_SERINO is null\r\n       insert into @TB_BELGE_SERI_NO (BELGE_SERI,BELGE_SERINO)\r\n        select @HRK_SERI,'1'\r\n        else\r\n        insert into @TB_BELGE_SERI_NO (BELGE_SERI,BELGE_SERINO)\r\n        select @HRK_SERI,@HRK_SERINO+1\r\n     end\r\n\r\n   /*-faturalar */\r\n    if (@belgetip='FAT')\r\n     begin\r\n\r\n     if @seriver=1\r\n       select top 1\r\n       @max_id=(id),\r\n       @HRK_SERINO=isnull(f.fatno,0),\r\n       @HRK_SERI=isnull(f.fatseri,'') from faturamas as f \r\n       WITH (NOLOCK) where sil=0\r\n        and firmano=@firmano\r\n        /*and f.fattip=@islemtip */\r\n         and f.gctip=2 \r\n         and ISNUMERIC(f.fatno)=1\r\n        order by id desc\r\n        \r\n        \r\n       if @seriver=0\r\n       select top 1\r\n       @max_id=(id),\r\n       @HRK_SERINO=isnull(f.fatno,0),\r\n       @HRK_SERI=@seri from faturamas as f WITH (NOLOCK)\r\n        where sil=0\r\n         and firmano=@firmano\r\n         and f.fatseri=@seri\r\n         and f.gctip=2 \r\n         and ISNUMERIC(f.fatno)=1\r\n        order by id desc   \r\n        \r\n        \r\n\r\n      \r\n        if @HRK_SERINO is null\r\n       insert into @TB_BELGE_SERI_NO (BELGE_SERI,BELGE_SERINO)\r\n        select @HRK_SERI,'1'\r\n        else\r\n        insert into @TB_BELGE_SERI_NO (BELGE_SERI,BELGE_SERINO)\r\n        select @HRK_SERI,@HRK_SERINO+1\r\n       \r\n     end\r\n     \r\n     \r\n     \r\n     /*-irsaliye */\r\n    if (@belgetip='IRS')\r\n     begin\r\n\r\n     if @seriver=1\r\n       select top 1\r\n       @max_id=(id),\r\n       @HRK_SERINO=isnull(f.irno,0),\r\n       @HRK_SERI=isnull(f.irseri,'') from irsaliyemas as f \r\n       WITH (NOLOCK) where sil=0\r\n        and firmano=@firmano\r\n        /*and f.fattip=@islemtip */\r\n         and f.gctip=2 \r\n         and ISNUMERIC(f.irno)=1\r\n        order by id desc\r\n        \r\n        \r\n       if @seriver=0\r\n       select top 1\r\n       @max_id=(id),\r\n       @HRK_SERINO=isnull(f.irno,0),\r\n       @HRK_SERI=@seri from irsaliyemas as f WITH (NOLOCK)\r\n        where sil=0\r\n         and firmano=@firmano\r\n         and f.irseri=@seri\r\n         and f.gctip=2 \r\n         and ISNUMERIC(f.irno)=1\r\n        order by id desc   \r\n        \r\n        \r\n\r\n      \r\n        if @HRK_SERINO is null\r\n         insert into @TB_BELGE_SERI_NO (BELGE_SERI,BELGE_SERINO)\r\n        select @HRK_SERI,'1'\r\n        else\r\n        insert into @TB_BELGE_SERI_NO (BELGE_SERI,BELGE_SERINO)\r\n        select @HRK_SERI,@HRK_SERINO+1\r\n       \r\n     end\r\n\r\n\r\nRETURN\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "brmfiytipver",
    "type": "SQL_SCALAR_FUNCTION",
    "full_name": "dbo.brmfiytipver",
    "definition": "CREATE FUNCTION dbo.brmfiytipver(@tip varchar(10))\r\nRETURNS varchar(50)\r\nAS\r\nBEGIN\r\ndeclare @sonuc varchar(50)\r\n\r\nif @tip='alsfiy'\r\nset @sonuc='Alış Fiyat';\r\n\r\nif @tip='sat1fiy'\r\nset @sonuc='Satis Fiyat - 1';\r\n\r\nif @tip='sat2fiy'\r\nset @sonuc='Satis Fiyat - 2';\r\n\r\nif @tip='ortalsf'\r\nset @sonuc='Ortalama Alış Fiyatı';\r\n\r\nif @tip='siffiy'\r\nset @sonuc='Sıfır Fiyatı';\r\n\r\nRETURN @sonuc;\r\n\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "CARI_PLAKA_KONTROL",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.CARI_PLAKA_KONTROL",
    "definition": "CREATE FUNCTION [dbo].CARI_PLAKA_KONTROL\r\n(@cartip varchar(30),\r\n@carkod varchar(30),\r\n@plaka varchar(30)\r\n)\r\nRETURNS\r\n    @TB_CARI_PLAKA_KONT TABLE (\r\n    CAR_TUR        VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    CAR_KOD        VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    CAR_UNVAN      VARCHAR(100) COLLATE Turkish_CI_AS,\r\n    PLAKA          VARCHAR(30) COLLATE Turkish_CI_AS)\r\nAS\r\nBEGIN\r\n\r\n  insert @TB_CARI_PLAKA_KONT (CAR_TUR,CAR_KOD,CAR_UNVAN,PLAKA)\r\n  select vc.tip,vc.kod,vc.ad,o.plaka from otomasgenkod as o\r\n  inner join  Genel_Kart as vc\r\n  on o.cartip=vc.cartp and o.kod=vc.kod\r\n  where o.plaka=@plaka and o.cartip=@cartip and o.kod<>@carkod\r\n\r\n\r\n\r\n RETURN\r\n\r\n  \r\nEND"
  },
  {
    "schema": "dbo",
    "name": "CARI_POM_VAR_MAIL_BASLIK",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.CARI_POM_VAR_MAIL_BASLIK",
    "definition": "CREATE FUNCTION [dbo].CARI_POM_VAR_MAIL_BASLIK(\r\n@VARNO FLOAT)\r\nRETURNS\r\n  @TB_CARI_VAR_MAIL_EKSTRE TABLE (\r\n    CARI_TIP    VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    CARI_KOD    VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    CARI_UNVAN  VARCHAR(150) COLLATE Turkish_CI_AS,\r\n    VARNO       FLOAT,\r\n    FISBAKIYE   DECIMAL(18,8),\r\n    CARIBAKIYE  DECIMAL(18,8),\r\n    BAKIYE      DECIMAL(18,8))\r\nAS\r\nBEGIN\r\n\r\n\r\n    INSERT @TB_CARI_VAR_MAIL_EKSTRE\r\n    (CARI_TIP,CARI_KOD,CARI_UNVAN,VARNO,FISBAKIYE,CARIBAKIYE,BAKIYE)\r\n    SELECT vs.cartip,vs.carkod,ck.unvan,@VARNO,ck.fisbak,ck.carbak,\r\n    (ck.fisbak+ck.carbak) from veresimas as vs\r\n    inner join carikart as ck on ck.kod=vs.carkod and\r\n    vs.cartip='carikart' and ck.sil=0 and ck.epostagonder=1\r\n    where vs.sil=0 and vs.varno=@VARNO\r\n    group by vs.cartip,vs.carkod,ck.unvan,ck.fisbak,ck.carbak\r\n    \r\n    \r\n RETURN\r\n\r\n\r\n \r\nEND"
  },
  {
    "schema": "dbo",
    "name": "CARIFIS_TARIH",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.CARIFIS_TARIH",
    "definition": "CREATE FUNCTION dbo.CARIFIS_TARIH (\r\n@CARI_TIP VARCHAR(20),\r\n@CARIKOD_IN  VARCHAR(8000),\r\n@VERIDIN  VARCHAR(8000),\r\n@TARINDEX  INT,\r\n@TARIH1 DATETIME,\r\n@TARIH2 DATETIME,\r\n@AKTIPIN VARCHAR(30),\r\n@PLAKA   VARCHAR(30))\r\nRETURNS\r\n    @TB_FIS_TARIH TABLE (\r\n    Verid       INT,\r\n    CARI_TIP\t\tVARCHAR(20) COLLATE Turkish_CI_AS,\r\n    CARI_KOD\t\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n    STK_KOD     VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    STK_AD      VARCHAR(150) COLLATE Turkish_CI_AS,\r\n    STK_BRM     VARCHAR(10) COLLATE Turkish_CI_AS,\r\n    TARIH       DATETIME,\r\n    SAAT        VARCHAR(10) COLLATE Turkish_CI_AS,\r\n    PLAKA       VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    SURUCU      VARCHAR(100) COLLATE Turkish_CI_AS,    \r\n    KM          FLOAT,\r\n    FISNO       VARCHAR(40) COLLATE Turkish_CI_AS,\r\n    YKNO        VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    YKFISNO     VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    ACK\t\t\tVARCHAR(200) COLLATE Turkish_CI_AS,\r\n    MIKTAR      FLOAT,\r\n    BRMFIY      FLOAT,\r\n    TUTAR       FLOAT,\r\n    VADTAR      DATETIME)\r\nAS\r\nBEGIN\r\n    DECLARE     @TB_FIS TABLE (\r\n    Verid       INT,\r\n    CARI_TIP\t\tVARCHAR(20) COLLATE Turkish_CI_AS,\r\n    CARI_KOD\t\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n    STK_KOD     VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    STK_AD      VARCHAR(150) COLLATE Turkish_CI_AS,\r\n    STK_BRM     VARCHAR(10) COLLATE Turkish_CI_AS,\r\n    TARIH       DATETIME,\r\n    SAAT        VARCHAR(10) COLLATE Turkish_CI_AS,\r\n    PLAKA       VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    SURUCU      VARCHAR(100) COLLATE Turkish_CI_AS,  \r\n    KM          FLOAT,\r\n    FISNO       VARCHAR(40) COLLATE Turkish_CI_AS,\r\n    YKNO        VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    YKFISNO     VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    ACK\t\t\tVARCHAR(200) COLLATE Turkish_CI_AS,\r\n    MIKTAR      FLOAT,\r\n    BRMFIY      FLOAT,\r\n    TUTAR       FLOAT,\r\n    VADTAR      DATETIME,\r\n    AKTIP       VARCHAR(10) COLLATE Turkish_CI_AS)\r\n    \r\n    \r\n    \r\n\r\n  if (@TARINDEX=0) AND (@VERIDIN<>'') and  (@CARIKOD_IN<>'') \r\n  begin\r\n  insert @TB_FIS (Verid,CARI_TIP,CARI_KOD,STK_KOD,STK_AD,STK_BRM,PLAKA,SURUCU,KM,TARIH,SAAT,\r\n  YKNO,YKFISNO,FISNO,MIKTAR,BRMFIY,TUTAR,VADTAR,AKTIP,ACK)\r\n  SELECT fis.verid,fis.cartip,fis.carkod,fishrk.stkod,gstk.ad,fishrk.brim,\r\n  fis.plaka,fis.surucu,fis.km,fis.tarih,fis.saat,\r\n  fis.ykno AS YKNO,fis.YkFisNo,\r\n  seri+cast([no] as varchar) AS FISNO,\r\n  case WHEN Fistip='FISVERSAT' then\r\n  fishrk.mik else\r\n  -1*(fishrk.mik) end,\r\n  fishrk.brmfiy,\r\n  case WHEN Fistip='FISVERSAT' then\r\n  fishrk.mik*fishrk.brmfiy else\r\n  -1*(fishrk.mik*fishrk.brmfiy) end,\r\n  fis.vadtar,\r\n  fis.aktip,fis.ack from veresimas as fis with (nolock) \r\n  inner join veresihrk as fishrk with (nolock) \r\n  on fishrk.verid=fis.verid\r\n  and fishrk.sil=0 and cartip=@CARI_TIP \r\n  and carkod IN (SELECT * FROM CsvNokVirToSTR(@CARIKOD_IN))\r\n  and fis.tarih>=@TARIH1 and fis.tarih<=@TARIH2\r\n  and fis.verid in (select * from dbo.CsvToInt(@VERIDIN))\r\n  inner join gelgidlistok as gstk\r\n  on gstk.kod=fishrk.stkod and gstk.tip=fishrk.stktip\r\n  order by tarih\r\n  end\r\n  \r\n  \r\n  if (@TARINDEX=0) AND (@VERIDIN='') and  (@CARIKOD_IN<>'')\r\n  begin\r\n  insert @TB_FIS (Verid,CARI_TIP,CARI_KOD,STK_KOD,STK_AD,STK_BRM,PLAKA,SURUCU,KM,TARIH,SAAT,\r\n  YKNO,YKFISNO,FISNO,MIKTAR,BRMFIY,TUTAR,VADTAR,AKTIP,ACK)\r\n  SELECT fis.verid,fis.cartip,fis.carkod,fishrk.stkod,gstk.ad,fishrk.brim,\r\n  fis.plaka,fis.surucu,fis.km,fis.tarih,fis.saat,\r\n  fis.ykno AS YKNO,fis.YkFisNo,\r\n  seri+cast([no] as varchar) AS FISNO,\r\n   case WHEN Fistip='FISVERSAT' then\r\n  fishrk.mik else\r\n  -1*(fishrk.mik) end,\r\n  fishrk.brmfiy,\r\n  case WHEN Fistip='FISVERSAT' then\r\n  fishrk.mik*fishrk.brmfiy else\r\n  -1*(fishrk.mik*fishrk.brmfiy) end,\r\n  fis.vadtar,\r\n  fis.aktip,fis.ack from veresimas as fis with (nolock) \r\n  inner join veresihrk as fishrk with (nolock) \r\n  on fishrk.verid=fis.verid\r\n  and fishrk.sil=0 and cartip=@CARI_TIP \r\n  and carkod IN (SELECT * FROM CsvNokVirToSTR(@CARIKOD_IN))\r\n  and fis.tarih>=@TARIH1 and fis.tarih<=@TARIH2\r\n  inner join gelgidlistok as gstk\r\n  on gstk.kod=fishrk.stkod and gstk.tip=fishrk.stktip\r\n  order by tarih\r\n  end\r\n  \r\n  \r\n\r\n  if (@TARINDEX=1) AND (@VERIDIN<>'') and  (@CARIKOD_IN<>'')\r\n  begin\r\n  insert @TB_FIS (Verid,CARI_TIP,CARI_KOD,STK_KOD,STK_AD,STK_BRM,PLAKA,SURUCU,KM,TARIH,SAAT,\r\n  YKNO,YKFISNO,FISNO,MIKTAR,BRMFIY,TUTAR,VADTAR,AKTIP,ACK)\r\n  SELECT fis.verid,fis.cartip,fis.carkod,fishrk.stkod,gstk.ad,fishrk.brim,\r\n  fis.plaka,fis.surucu,fis.km,fis.tarih,fis.saat,\r\n  fis.ykno AS YKNO,fis.YkFisNo,\r\n  seri+cast([no] as varchar) AS FISNO,\r\n  case WHEN Fistip='FISVERSAT' then\r\n  fishrk.mik else\r\n  -1*(fishrk.mik) end,fishrk.brmfiy,\r\n  case WHEN Fistip='FISVERSAT' then\r\n  fishrk.mik*fishrk.brmfiy else\r\n  -1*(fishrk.mik*fishrk.brmfiy) end,\r\n  fis.vadtar,\r\n  fis.aktip,fis.ack from veresimas as fis with (nolock)\r\n  inner join veresihrk as fishrk with (nolock)\r\n  on fishrk.verid=fis.verid\r\n  and fishrk.sil=0 and cartip=@CARI_TIP \r\n   and carkod IN (SELECT * FROM CsvNokVirToSTR(@CARIKOD_IN))\r\n  and fis.vadtar>=@TARIH1 and fis.vadtar<=@TARIH2\r\n  and fis.verid in (select * from dbo.CsvToInt(@VERIDIN))\r\n  inner join gelgidlistok as gstk\r\n  on gstk.kod=fishrk.stkod and gstk.tip=fishrk.stktip\r\n    order by tarih\r\n  end\r\n  \r\n  \r\n  \r\n  if (@TARINDEX=1) AND (@VERIDIN='') and  (@CARIKOD_IN<>'')\r\n  begin\r\n  insert @TB_FIS (Verid,CARI_TIP,CARI_KOD,STK_KOD,STK_AD,STK_BRM,PLAKA,SURUCU,KM,TARIH,SAAT,\r\n  YKNO,YKFISNO,FISNO,MIKTAR,BRMFIY,TUTAR,VADTAR,AKTIP,ACK)\r\n  SELECT fis.verid,fis.cartip,fis.carkod,fishrk.stkod,gstk.ad,fishrk.brim,\r\n  fis.plaka,fis.surucu,fis.km,fis.tarih,fis.saat,\r\n  fis.ykno AS YKNO,fis.YkFisNo,\r\n  seri+cast([no] as varchar) AS FISNO,\r\n  case WHEN Fistip='FISVERSAT' then\r\n  fishrk.mik else\r\n  -1*(fishrk.mik) end,fishrk.brmfiy,\r\n  case WHEN Fistip='FISVERSAT' then\r\n  fishrk.mik*fishrk.brmfiy else\r\n  -1*(fishrk.mik*fishrk.brmfiy) end,\r\n  fis.vadtar,\r\n  fis.aktip,fis.ack from veresimas as fis with (nolock)\r\n  inner join veresihrk as fishrk with (nolock)\r\n  on fishrk.verid=fis.verid\r\n  and fishrk.sil=0 and cartip=@CARI_TIP \r\n   and carkod IN (SELECT * FROM CsvNokVirToSTR(@CARIKOD_IN))\r\n  and fis.vadtar>=@TARIH1 and fis.vadtar<=@TARIH2\r\n  inner join gelgidlistok as gstk\r\n  on gstk.kod=fishrk.stkod and gstk.tip=fishrk.stktip\r\n    order by tarih\r\n  end\r\n  \r\n  \r\n  if (@TARINDEX=0) AND (@VERIDIN='') and  (@CARIKOD_IN='')\r\n  begin\r\n  insert @TB_FIS (Verid,CARI_TIP,CARI_KOD,STK_KOD,STK_AD,STK_BRM,PLAKA,SURUCU,KM,TARIH,SAAT,\r\n  YKNO,YKFISNO,FISNO,MIKTAR,BRMFIY,TUTAR,VADTAR,AKTIP,ACK)\r\n  SELECT fis.verid,fis.cartip,fis.carkod,fishrk.stkod,gstk.ad,fishrk.brim,\r\n  fis.plaka,fis.surucu,fis.km,fis.tarih,fis.saat,\r\n  fis.ykno AS YKNO,fis.YkFisNo,\r\n  seri+cast([no] as varchar) AS FISNO,\r\n   case WHEN Fistip='FISVERSAT' then\r\n  fishrk.mik else\r\n  -1*(fishrk.mik) end,\r\n  fishrk.brmfiy,\r\n  case WHEN Fistip='FISVERSAT' then\r\n  fishrk.mik*fishrk.brmfiy else\r\n  -1*(fishrk.mik*fishrk.brmfiy) end,\r\n  fis.vadtar,\r\n  fis.aktip,fis.ack from veresimas as fis with (nolock)\r\n  inner join veresihrk as fishrk with (nolock)\r\n  on fishrk.verid=fis.verid\r\n  and fishrk.sil=0 \r\n  and fis.tarih>=@TARIH1 and fis.tarih<=@TARIH2\r\n  inner join gelgidlistok as gstk\r\n  on gstk.kod=fishrk.stkod and gstk.tip=fishrk.stktip\r\n  order by tarih\r\n  end\r\n  \r\n  \r\n  \r\n  if (@TARINDEX=1) AND (@VERIDIN='') and  (@CARIKOD_IN='')\r\n  begin\r\n  insert @TB_FIS (Verid,CARI_TIP,CARI_KOD,STK_KOD,STK_AD,STK_BRM,PLAKA,SURUCU,KM,TARIH,SAAT,\r\n  YKNO,YKFISNO,FISNO,MIKTAR,BRMFIY,TUTAR,VADTAR,AKTIP,ACK)\r\n  SELECT fis.verid,fis.cartip,fis.carkod,fishrk.stkod,gstk.ad,fishrk.brim,\r\n  fis.plaka,fis.surucu,fis.km,fis.tarih,fis.saat,\r\n  fis.ykno AS YKNO,fis.YkFisNo,\r\n  seri+cast([no] as varchar) AS FISNO,\r\n  case WHEN Fistip='FISVERSAT' then\r\n  fishrk.mik else\r\n  -1*(fishrk.mik) end,fishrk.brmfiy,\r\n  case WHEN Fistip='FISVERSAT' then\r\n  fishrk.mik*fishrk.brmfiy else\r\n  -1*(fishrk.mik*fishrk.brmfiy) end,\r\n  fis.vadtar,\r\n  fis.aktip,fis.ack from veresimas as fis\r\n  inner join veresihrk as fishrk\r\n  on fishrk.verid=fis.verid\r\n  and fishrk.sil=0 \r\n  and fis.vadtar>=@TARIH1 and fis.vadtar<=@TARIH2\r\n  inner join gelgidlistok as gstk\r\n  on gstk.kod=fishrk.stkod and gstk.tip=fishrk.stktip\r\n    order by tarih\r\n  end\r\n  \r\n\r\n\r\n  if (@AKTIPIN<>'') AND (@PLAKA='')\r\n  insert @TB_FIS_TARIH (Verid,CARI_TIP,CARI_KOD,STK_KOD,STK_AD,STK_BRM,PLAKA,SURUCU,KM,TARIH,SAAT,\r\n  YKNO,YKFISNO,FISNO,MIKTAR,BRMFIY,TUTAR,VADTAR,ACK)\r\n  select Verid,CARI_TIP,CARI_KOD,STK_KOD,STK_AD,STK_BRM,PLAKA,SURUCU,KM,TARIH,SAAT,\r\n  YKNO,YKFISNO,FISNO,MIKTAR,BRMFIY,TUTAR,VADTAR,ACK FROM @TB_FIS\r\n  WHERE AKTIP in (SELECT * FROM dbo.CsvToSTR (@AKTIPIN))\r\n\r\n  if (@AKTIPIN<>'') AND (@PLAKA<>'')\r\n  insert @TB_FIS_TARIH (Verid,CARI_TIP,CARI_KOD,STK_KOD,STK_AD,STK_BRM,PLAKA,SURUCU,KM,TARIH,SAAT,\r\n  YKNO,YKFISNO,FISNO,MIKTAR,BRMFIY,TUTAR,VADTAR,ACK)\r\n  select Verid,CARI_TIP,CARI_KOD,STK_KOD,STK_AD,STK_BRM,PLAKA,SURUCU,KM,TARIH,SAAT,\r\n  YKNO,YKFISNO,FISNO,MIKTAR,BRMFIY,TUTAR,VADTAR,ACK FROM @TB_FIS\r\n  WHERE PLAKA=@PLAKA AND AKTIP in (SELECT * FROM dbo.CsvToSTR (@AKTIPIN))\r\n\r\n\r\n   if (@AKTIPIN='') AND (@PLAKA='')\r\n   insert @TB_FIS_TARIH (Verid,CARI_TIP,CARI_KOD,STK_KOD,STK_AD,STK_BRM,PLAKA,SURUCU,KM,TARIH,SAAT,\r\n   YKNO,YKFISNO,FISNO,MIKTAR,BRMFIY,TUTAR,VADTAR,ACK)\r\n   select Verid,CARI_TIP,CARI_KOD,STK_KOD,STK_AD,STK_BRM,PLAKA,SURUCU,KM,TARIH,SAAT,\r\n   YKNO,YKFISNO,FISNO,MIKTAR,BRMFIY,TUTAR,VADTAR,ACK FROM @TB_FIS\r\n\r\n   if (@AKTIPIN='') AND (@PLAKA<>'')\r\n   insert @TB_FIS_TARIH (Verid,CARI_TIP,CARI_KOD,STK_KOD,STK_AD,STK_BRM,PLAKA,SURUCU,KM,TARIH,SAAT,\r\n   YKNO,YKFISNO,FISNO,MIKTAR,BRMFIY,TUTAR,VADTAR,ACK)\r\n   select Verid,CARI_TIP,CARI_KOD,STK_KOD,STK_AD,STK_BRM,PLAKA,SURUCU,KM,TARIH,SAAT,\r\n   YKNO,YKFISNO,FISNO,MIKTAR,BRMFIY,TUTAR,VADTAR,ACK FROM @TB_FIS\r\n   WHERE PLAKA=@PLAKA\r\n\r\n\r\n\r\n\r\n RETURN\r\n\r\n\r\nend"
  },
  {
    "schema": "dbo",
    "name": "CEK_DEKONT",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.CEK_DEKONT",
    "definition": "CREATE FUNCTION [dbo].CEK_DEKONT (@drm varchar(10),\r\n@CEKIDIN varchar(8000))\r\nRETURNS\r\n  @TB_CEK_DEKONT TABLE (\r\n    CARI_TIP    \tVARCHAR(20) COLLATE Turkish_CI_AS,\r\n    CARI_KOD    \tVARCHAR(30) COLLATE Turkish_CI_AS,\r\n    CARI_UNVAN  \tVARCHAR(150) COLLATE Turkish_CI_AS,\r\n    BANKA_KOD    \tVARCHAR(30) COLLATE Turkish_CI_AS,\r\n    BANKA_UNVAN  \tVARCHAR(150) COLLATE Turkish_CI_AS,\r\n    CEK_BANKA    \tVARCHAR(100) COLLATE Turkish_CI_AS,\r\n    CEK_BANKA_SUBE  VARCHAR(100) COLLATE Turkish_CI_AS,\r\n    CEK_HESAPNO     VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    CEK_KESIDECI    VARCHAR(100) COLLATE Turkish_CI_AS,\r\n    TARIH       \tDATETIME,\r\n    SAAT        \tVARCHAR(10) COLLATE Turkish_CI_AS,\r\n    CEKNO       \tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n    PARABIRIM   \tVARCHAR(20) COLLATE Turkish_CI_AS,\r\n    PARASTR     \tVARCHAR(70) COLLATE Turkish_CI_AS,\r\n    ISLEM       \tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n    TUTAR       \tFLOAT,\r\n    VADTAR      \tDATETIME,\r\n    CARI_FISBAKIYE  FLOAT,\r\n    CARI_BAKIYE\t\tFLOAT,\r\n    CARI_TOPBAKIYE  FLOAT)\r\nAS\r\nBEGIN\r\n\r\n DECLARE @EKSTRE_IN TABLE (\r\n cekid     int)\r\n\r\n declare @separator char(1)\r\n set @separator = ','\r\n\r\n declare @separator_position int\r\n declare @array_value varchar(1000)\r\n\r\n IF (LEN(RTRIM(@CEKIDIN)) > 0)\r\n BEGIN\r\n  set @CEKIDIN = @CEKIDIN + ','\r\n END\r\n\r\n while patindex('%,%' , @CEKIDIN) <> 0\r\n begin\r\n\r\n   select @separator_position =  patindex('%,%' , @CEKIDIN)\r\n   select @array_value = left(@CEKIDIN, @separator_position - 1)\r\n\r\n  Insert @EKSTRE_IN\r\n  Values (@array_value)\r\n\r\n   select @CEKIDIN = stuff(@CEKIDIN, 1, @separator_position, '')\r\n end\r\n\r\n   DECLARE @EKSTRE_TEMP TABLE (\r\n    CARI_TIP         VARCHAR(20)  COLLATE Turkish_CI_AS,\r\n    CARI_KOD     \t VARCHAR(30)  COLLATE Turkish_CI_AS,\r\n    CARI_UNVAN   \t VARCHAR(150) COLLATE Turkish_CI_AS,\r\n    BANKA_KOD    \t VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    BANKA_UNVAN  \t VARCHAR(150) COLLATE Turkish_CI_AS,\r\n    CEK_BANKA    \t VARCHAR(150) COLLATE Turkish_CI_AS,\r\n    CEK_BANKA_SUBE   VARCHAR(150) COLLATE Turkish_CI_AS,\r\n    CEK_KESIDECI     VARCHAR(150) COLLATE Turkish_CI_AS,\r\n    CEK_HESAPNO      VARCHAR(100) COLLATE Turkish_CI_AS,        \r\n    TARIH        \t DATETIME,\r\n    SAAT         \t VARCHAR(10) COLLATE Turkish_CI_AS,\r\n    CEKNO            VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    PARABIRIM    \t VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    PARASTR      \t VARCHAR(70) COLLATE Turkish_CI_AS,\r\n    ISLEM            VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    TUTAR            FLOAT,\r\n    VADTAR           DATETIME,\r\n    CARI_FISBAKIYE  FLOAT,\r\n    CARI_BAKIYE\t\tFLOAT,\r\n    CARI_TOPBAKIYE  FLOAT )\r\n\r\n    DECLARE @HRK_CARI_TIP     VARCHAR(30)\r\n    DECLARE @HRK_CARI_KOD     VARCHAR(30)\r\n    DECLARE @HRK_CARI_UNVAN   VARCHAR(150)\r\n    DECLARE @HRK_BANKA_KOD    VARCHAR(30)\r\n    DECLARE @HRK_BANKA_UNVAN  VARCHAR(150)\r\n    DECLARE @HRK_CEKBANKA     VARCHAR(150)\r\n    DECLARE @HRK_BANKASUBE    VARCHAR(150)\r\n    DECLARE @HRK_HESAPNO      VARCHAR(50)\r\n    DECLARE @HRK_CEKKESIDECI  VARCHAR(150)\r\n        \r\n    DECLARE @HRK_TARIH        DATETIME\r\n    DECLARE @HRK_SAAT         VARCHAR(10)\r\n    DECLARE @HRK_CEKNO        VARCHAR(50)\r\n    DECLARE @HRK_PARABIRIM    VARCHAR(20)\r\n    DECLARE @HRK_PARASTR      VARCHAR(70)\r\n    DECLARE @HRK_ISLEM        VARCHAR(30)\r\n    DECLARE @HRK_TUTAR        FLOAT\r\n    DECLARE @HRK_VADTAR       DATETIME\r\n    \r\n    \r\n   /*cek dekont */\r\n     if @drm='TAK'\r\n     begin\r\n     DECLARE CRS_HRK CURSOR FAST_FORWARD FOR\r\n     select car.cartp,car.kod,\r\n     car.ad,ban.kod,ban.ad,hrk.banka,\r\n     hrk.banksub,hrk.hesepno,hrk.kesideci,\r\n     tarih,saat,\r\n     ceksenno,abs(giren-cikan),PARABRM,\r\n     dbo.ParaOku(ABS(giren-cikan)),\r\n     drmad,vadetar from\r\n     cekkart as hrk inner join Genel_Kart as car\r\n     on hrk.carkod=car.kod and hrk.cartip=car.cartp\r\n     left join Genel_Kart as ban\r\n     on hrk.vercartip=ban.cartp and hrk.vercarkod=ban.kod\r\n     where hrk.cekid in (select * from @EKSTRE_IN )\r\n     end\r\n     \r\n     \r\n     if @drm='POR'\r\n     begin\r\n     DECLARE CRS_HRK CURSOR FAST_FORWARD FOR\r\n     select car.cartp,car.kod,\r\n     car.ad,ban.kod,ban.ad,hrk.banka,\r\n     hrk.banksub,hrk.hesepno,hrk.kesideci,\r\n     tarih,saat,\r\n     ceksenno,abs(giren-cikan),PARABRM,\r\n     dbo.ParaOku(ABS(giren-cikan)),\r\n     drmad,vadetar from\r\n     cekkart as hrk inner join Genel_Kart as car\r\n     on hrk.carkod=car.kod and hrk.cartip=car.cartp\r\n     left join Genel_Kart as ban\r\n     on hrk.vercartip=ban.cartp and hrk.vercarkod=ban.kod\r\n     where hrk.cekid in (select * from @EKSTRE_IN )\r\n     end\r\n     \r\n     \r\n     \r\n     if @drm='KSN'\r\n     begin\r\n     DECLARE CRS_HRK CURSOR FAST_FORWARD FOR\r\n     select car.cartp,car.kod,\r\n     car.ad,ban.kod,ban.ad,hrk.banka,\r\n     hrk.banksub,hrk.hesepno,hrk.kesideci,\r\n     tarih,saat,\r\n     ceksenno,abs(giren-cikan),PARABRM,\r\n     dbo.ParaOku(ABS(giren-cikan)),\r\n     drmad,vadetar from\r\n     cekkart as hrk inner join Genel_Kart as car\r\n     on hrk.vercarkod=car.kod and hrk.vercartip=car.cartp\r\n     left join Genel_Kart as ban\r\n     on ban.cartp='bankkart' and hrk.bankod=ban.kod\r\n     where hrk.cekid in (select * from @EKSTRE_IN )\r\n     end\r\n     \r\n     \r\n     \r\n     if @drm='CIR'\r\n     begin\r\n     DECLARE CRS_HRK CURSOR FAST_FORWARD FOR\r\n     select car.cartp,car.kod,\r\n     car.ad,ban.kod,ban.ad,hrk.banka,\r\n     hrk.banksub,hrk.hesepno,hrk.kesideci,\r\n     tarih,saat,\r\n     ceksenno,abs(cikan),PARABRM,\r\n     dbo.ParaOku(ABS(cikan)),\r\n     drmad,vadetar from\r\n     cekkart as hrk inner join Genel_Kart as car\r\n     on hrk.vercarkod=car.kod and hrk.vercartip=car.cartp\r\n     left join Genel_Kart as ban\r\n     on ban.cartp='bankkart' and hrk.bankod=ban.kod\r\n     where hrk.cekid in (select * from @EKSTRE_IN )\r\n     end\r\n     \r\n     \r\n     \r\n     \r\n\r\n   OPEN CRS_HRK\r\n\r\n   FETCH NEXT FROM CRS_HRK INTO\r\n   @HRK_CARI_TIP,@HRK_CARI_KOD,@HRK_CARI_UNVAN,\r\n   @HRK_BANKA_KOD,@HRK_BANKA_UNVAN,@HRK_CEKBANKA,\r\n   @HRK_BANKASUBE,@HRK_HESAPNO,@HRK_CEKKESIDECI,\r\n   @HRK_TARIH,@HRK_SAAT,@HRK_CEKNO,\r\n   @HRK_TUTAR,@HRK_PARABIRIM,@HRK_PARASTR,@HRK_ISLEM,@HRK_VADTAR\r\n\r\n  WHILE @@FETCH_STATUS = 0\r\n  BEGIN\r\n\r\n    INSERT @EKSTRE_TEMP\r\n      SELECT\r\n       @HRK_CARI_TIP,@HRK_CARI_KOD,@HRK_CARI_UNVAN,\r\n       @HRK_BANKA_KOD,@HRK_BANKA_UNVAN,@HRK_CEKBANKA,\r\n       @HRK_BANKASUBE,@HRK_HESAPNO,@HRK_CEKKESIDECI,\r\n       @HRK_TARIH,@HRK_SAAT,@HRK_CEKNO,\r\n       @HRK_PARABIRIM,@HRK_PARASTR,@HRK_ISLEM,@HRK_TUTAR,@HRK_VADTAR,\r\n       0,0,0\r\n\r\n    FETCH NEXT FROM CRS_HRK INTO\r\n    @HRK_CARI_TIP,@HRK_CARI_KOD,@HRK_CARI_UNVAN,\r\n    @HRK_BANKA_KOD,@HRK_BANKA_UNVAN,@HRK_CEKBANKA,\r\n    @HRK_BANKASUBE,@HRK_HESAPNO,@HRK_CEKKESIDECI,\r\n    @HRK_TARIH,@HRK_SAAT,@HRK_CEKNO,\r\n   @HRK_TUTAR,@HRK_PARABIRIM,@HRK_PARASTR,@HRK_ISLEM,@HRK_VADTAR\r\n  END\r\n\r\n  CLOSE CRS_HRK\r\n  DEALLOCATE CRS_HRK\r\n  /*---------------------------------------------------------------------------- */\r\n\r\n  UPDATE @EKSTRE_TEMP SET \r\n   CARI_FISBAKIYE=DT.fisbak,\r\n    CARI_BAKIYE=dt.carbak,\r\n    CARI_TOPBAKIYE=dt.topbak\r\n    from @EKSTRE_TEMP as t \r\n    join \r\n    (select kod,cartp,fisbak,carbak,topbak \r\n    from View_Cariler_Kart_Bakiye as cb )\r\n    dt on t.CARI_TIP=dt.cartp and t.CARI_KOD=dt.kod\r\n\r\n\r\n\r\n  INSERT @TB_CEK_DEKONT\r\n    SELECT * FROM @EKSTRE_TEMP\r\n\r\n  RETURN\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "CEK_DEKONT_HRK_NO",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.CEK_DEKONT_HRK_NO",
    "definition": "CREATE FUNCTION [dbo].[CEK_DEKONT_HRK_NO] (@drm varchar(10),\r\n@HRK_NO INT)\r\nRETURNS\r\n  @TB_CEK_DEKONT TABLE (\r\n    CARI_TIP    \tVARCHAR(20) COLLATE Turkish_CI_AS,\r\n    CARI_KOD    \tVARCHAR(30) COLLATE Turkish_CI_AS,\r\n    CARI_UNVAN  \tVARCHAR(150) COLLATE Turkish_CI_AS,\r\n    BANKA_KOD    \tVARCHAR(30) COLLATE Turkish_CI_AS,\r\n    BANKA_UNVAN  \tVARCHAR(150) COLLATE Turkish_CI_AS,\r\n    CEK_BANKA    \tVARCHAR(100) COLLATE Turkish_CI_AS,\r\n    CEK_BANKA_SUBE  VARCHAR(100) COLLATE Turkish_CI_AS,\r\n    CEK_HESAPNO     VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    CEK_KESIDECI    VARCHAR(100) COLLATE Turkish_CI_AS,\r\n    TARIH       \tDATETIME,\r\n    SAAT        \tVARCHAR(10) COLLATE Turkish_CI_AS,\r\n    CEKNO       \tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n    PARABIRIM   \tVARCHAR(20) COLLATE Turkish_CI_AS,\r\n    PARASTR     \tVARCHAR(70) COLLATE Turkish_CI_AS,\r\n    ISLEM       \tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n    TUTAR       \tFLOAT,\r\n    VADTAR      \tDATETIME,\r\n    CARI_FISBAKIYE  FLOAT,\r\n    CARI_BAKIYE\t\tFLOAT,\r\n    CARI_TOPBAKIYE  FLOAT)\r\nAS\r\nBEGIN\r\n\r\n   DECLARE @EKSTRE_TEMP TABLE (\r\n    CARI_TIP         VARCHAR(20)  COLLATE Turkish_CI_AS,\r\n    CARI_KOD     \t VARCHAR(30)  COLLATE Turkish_CI_AS,\r\n    CARI_UNVAN   \t VARCHAR(150) COLLATE Turkish_CI_AS,\r\n    BANKA_KOD    \t VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    BANKA_UNVAN  \t VARCHAR(150) COLLATE Turkish_CI_AS,\r\n    CEK_BANKA    \t VARCHAR(150) COLLATE Turkish_CI_AS,\r\n    CEK_BANKA_SUBE   VARCHAR(150) COLLATE Turkish_CI_AS,\r\n    CEK_KESIDECI     VARCHAR(150) COLLATE Turkish_CI_AS,\r\n    CEK_HESAPNO      VARCHAR(100) COLLATE Turkish_CI_AS,        \r\n    TARIH        \t DATETIME,\r\n    SAAT         \t VARCHAR(10) COLLATE Turkish_CI_AS,\r\n    CEKNO            VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    PARABIRIM    \t VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    PARASTR      \t VARCHAR(70) COLLATE Turkish_CI_AS,\r\n    ISLEM            VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    TUTAR            FLOAT,\r\n    VADTAR           DATETIME,\r\n    CARI_FISBAKIYE  FLOAT,\r\n    CARI_BAKIYE\t\tFLOAT,\r\n    CARI_TOPBAKIYE  FLOAT )\r\n\r\n    DECLARE @HRK_CARI_TIP     VARCHAR(30)\r\n    DECLARE @HRK_CARI_KOD     VARCHAR(30)\r\n    DECLARE @HRK_CARI_UNVAN   VARCHAR(150)\r\n    DECLARE @HRK_BANKA_KOD    VARCHAR(30)\r\n    DECLARE @HRK_BANKA_UNVAN  VARCHAR(150)\r\n    DECLARE @HRK_CEKBANKA     VARCHAR(150)\r\n    DECLARE @HRK_BANKASUBE    VARCHAR(150)\r\n    DECLARE @HRK_HESAPNO      VARCHAR(50)\r\n    DECLARE @HRK_CEKKESIDECI  VARCHAR(150)\r\n        \r\n    DECLARE @HRK_TARIH        DATETIME\r\n    DECLARE @HRK_SAAT         VARCHAR(10)\r\n    DECLARE @HRK_CEKNO        VARCHAR(50)\r\n    DECLARE @HRK_PARABIRIM    VARCHAR(20)\r\n    DECLARE @HRK_PARASTR      VARCHAR(70)\r\n    DECLARE @HRK_ISLEM        VARCHAR(30)\r\n    DECLARE @HRK_TUTAR        FLOAT\r\n    DECLARE @HRK_VADTAR       DATETIME\r\n    \r\n    \r\n   /*cek dekont */\r\n     if @drm='TAK'\r\n     begin\r\n     DECLARE CRS_HRK CURSOR FAST_FORWARD FOR\r\n     select car.cartp,car.kod,\r\n     car.ad,ban.kod,ban.ad,hrk.banka,\r\n     hrk.banksub,hrk.hesepno,hrk.kesideci,\r\n      ch.tarih,ch.saat,\r\n     ceksenno,abs(ch.tutar),ch.PARABRM,\r\n     dbo.ParaOku(ABS(ch.tutar)),\r\n     ch.drmad,vadetar from\r\n     cekkart as hrk inner join cekhrk as ch\r\n     on ch.cekid=hrk.cekid \r\n     inner join Genel_Kart as car\r\n     on hrk.carkod=car.kod and hrk.cartip=car.cartp\r\n     left join Genel_Kart as ban\r\n     on hrk.vercartip=ban.cartp and hrk.vercarkod=ban.kod\r\n     where ch.hrk_no=@HRK_NO\r\n     end\r\n     \r\n     \r\n     if @drm='POR'\r\n     begin\r\n     DECLARE CRS_HRK CURSOR FAST_FORWARD FOR\r\n     select car.cartp,car.kod,\r\n     car.ad,ban.kod,ban.ad,hrk.banka,\r\n     hrk.banksub,hrk.hesepno,hrk.kesideci,\r\n      ch.tarih,ch.saat,\r\n     ceksenno,abs(ch.tutar),ch.PARABRM,\r\n     dbo.ParaOku(ABS(ch.tutar)),\r\n     ch.drmad,vadetar from\r\n     cekkart as hrk inner join cekhrk as ch\r\n     on ch.cekid=hrk.cekid \r\n     inner join Genel_Kart as car\r\n     on hrk.carkod=car.kod and hrk.cartip=car.cartp\r\n     left join Genel_Kart as ban\r\n     on hrk.vercartip=ban.cartp and hrk.vercarkod=ban.kod\r\n     where ch.hrk_no=@HRK_NO\r\n     end\r\n     \r\n     \r\n     \r\n     if @drm='KSN'\r\n     begin\r\n     DECLARE CRS_HRK CURSOR FAST_FORWARD FOR\r\n     select car.cartp,car.kod,\r\n     car.ad,ban.kod,ban.ad,hrk.banka,\r\n     hrk.banksub,hrk.hesepno,hrk.kesideci,\r\n     ch.tarih,ch.saat,\r\n     ceksenno,abs(ch.tutar),ch.PARABRM,\r\n     dbo.ParaOku(ABS(ch.tutar)),\r\n     ch.drmad,vadetar from\r\n     cekkart as hrk inner join cekhrk as ch\r\n     on ch.cekid=hrk.cekid \r\n     inner join Genel_Kart as car\r\n     on hrk.vercarkod=car.kod and hrk.vercartip=car.cartp\r\n     left join Genel_Kart as ban\r\n     on ban.cartp='bankkart' and hrk.bankod=ban.kod\r\n     where ch.hrk_no=@HRK_NO\r\n     end\r\n     \r\n     \r\n     \r\n     if @drm='CIR'\r\n     begin\r\n     DECLARE CRS_HRK CURSOR FAST_FORWARD FOR\r\n     select car.cartp,car.kod,\r\n     car.ad,ban.kod,ban.ad,hrk.banka,\r\n     hrk.banksub,hrk.hesepno,hrk.kesideci,\r\n     ch.tarih,ch.saat,\r\n     ceksenno,abs(ch.tutar),ch.PARABRM,\r\n     dbo.ParaOku(ABS(ch.tutar)),\r\n     ch.drmad,vadetar from\r\n     cekkart as hrk inner join cekhrk as ch\r\n     on ch.cekid=hrk.cekid \r\n     inner join Genel_Kart as car\r\n     on hrk.vercarkod=car.kod and hrk.vercartip=car.cartp\r\n     left join Genel_Kart as ban\r\n     on ban.cartp='bankkart' and hrk.bankod=ban.kod\r\n     where ch.hrk_no=@HRK_NO\r\n     end\r\n     \r\n     \r\n     \r\n     \r\n\r\n   OPEN CRS_HRK\r\n\r\n   FETCH NEXT FROM CRS_HRK INTO\r\n   @HRK_CARI_TIP,@HRK_CARI_KOD,@HRK_CARI_UNVAN,\r\n   @HRK_BANKA_KOD,@HRK_BANKA_UNVAN,@HRK_CEKBANKA,\r\n   @HRK_BANKASUBE,@HRK_HESAPNO,@HRK_CEKKESIDECI,\r\n   @HRK_TARIH,@HRK_SAAT,@HRK_CEKNO,\r\n   @HRK_TUTAR,@HRK_PARABIRIM,@HRK_PARASTR,@HRK_ISLEM,@HRK_VADTAR\r\n\r\n  WHILE @@FETCH_STATUS = 0\r\n  BEGIN\r\n\r\n    INSERT @EKSTRE_TEMP\r\n      SELECT\r\n       @HRK_CARI_TIP,@HRK_CARI_KOD,@HRK_CARI_UNVAN,\r\n       @HRK_BANKA_KOD,@HRK_BANKA_UNVAN,@HRK_CEKBANKA,\r\n       @HRK_BANKASUBE,@HRK_HESAPNO,@HRK_CEKKESIDECI,\r\n       @HRK_TARIH,@HRK_SAAT,@HRK_CEKNO,\r\n       @HRK_PARABIRIM,@HRK_PARASTR,@HRK_ISLEM,@HRK_TUTAR,@HRK_VADTAR,\r\n       0,0,0\r\n\r\n    FETCH NEXT FROM CRS_HRK INTO\r\n    @HRK_CARI_TIP,@HRK_CARI_KOD,@HRK_CARI_UNVAN,\r\n    @HRK_BANKA_KOD,@HRK_BANKA_UNVAN,@HRK_CEKBANKA,\r\n    @HRK_BANKASUBE,@HRK_HESAPNO,@HRK_CEKKESIDECI,\r\n    @HRK_TARIH,@HRK_SAAT,@HRK_CEKNO,\r\n   @HRK_TUTAR,@HRK_PARABIRIM,@HRK_PARASTR,@HRK_ISLEM,@HRK_VADTAR\r\n  END\r\n\r\n  CLOSE CRS_HRK\r\n  DEALLOCATE CRS_HRK\r\n  /*---------------------------------------------------------------------------- */\r\n\r\n  UPDATE @EKSTRE_TEMP SET \r\n   CARI_FISBAKIYE=DT.fisbak,\r\n    CARI_BAKIYE=dt.carbak,\r\n    CARI_TOPBAKIYE=dt.topbak\r\n    from @EKSTRE_TEMP as t \r\n    join \r\n    (select kod,cartp,fisbak,carbak,topbak \r\n    from View_Cariler_Kart_Bakiye as cb )\r\n    dt on t.CARI_TIP=dt.cartp and t.CARI_KOD=dt.kod\r\n\r\n\r\n\r\n  INSERT @TB_CEK_DEKONT\r\n    SELECT * FROM @EKSTRE_TEMP\r\n\r\n  RETURN\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "Cek_Senet_Cari",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.Cek_Senet_Cari",
    "definition": "CREATE FUNCTION [dbo].Cek_Senet_Cari (\r\n@firmano\tint,\r\n@ISLEMHRK  \tVARCHAR(200),\r\n@DRMIN   \tVARCHAR(200),\r\n@TARTIP  \tVARCHAR(20),\r\n@BASTAR  \tDATETIME,\r\n@BITTAR  \tDATETIME,\r\n@BANKA\t\tVARCHAR(100),\r\n@SILIN   \tVARCHAR(20),\r\n@SONUC\t\tint)\r\nRETURNS\r\n  @TB_CEK_CARILER TABLE (\r\n  CAR_TIP     VARCHAR(30)  COLLATE Turkish_CI_AS,\r\n  CAR_KOD     VARCHAR(50)  COLLATE Turkish_CI_AS,\r\n  CAR_UNVAN   VARCHAR(150)  COLLATE Turkish_CI_AS)\r\nAS\r\nBEGIN\r\n\r\n   DECLARE @GC_TB_CEK_CARILER TABLE (\r\n   FirmaNo\t   INT, \r\n   CAR_TIP     VARCHAR(30)  COLLATE Turkish_CI_AS,\r\n   CAR_KOD     VARCHAR(50)  COLLATE Turkish_CI_AS,\r\n   CAR_UNVAN   VARCHAR(150)  COLLATE Turkish_CI_AS,\r\n   BNK_UNVAN   VARCHAR(100)  COLLATE Turkish_CI_AS,\r\n   DRM         VARCHAR(30)  COLLATE Turkish_CI_AS,\r\n   ISLEMHRK   \tVARCHAR(30)  COLLATE Turkish_CI_AS,\r\n   SONUC\t\tINT)\r\n\r\n\r\n    if @TARTIP='tarih'\r\n    begin\r\n     insert into @GC_TB_CEK_CARILER\r\n     (FirmaNo,CAR_TIP,CAR_KOD,CAR_UNVAN,BNK_UNVAN,\r\n     DRM,ISLEMHRK,SONUC)\r\n     SELECT cek.firmano,\r\n     case when gctip='G' THEN cartip else vercartip end,\r\n     case when gctip='G' THEN carkod else vercarkod end,\r\n     case when gctip='G' THEN ac.ad else vc.ad end,\r\n     cek.banka,drm,cek.islmhrk,cek.sonuc\r\n     from cekkart as cek\r\n     left join genel_kart as ac on cek.carkod=ac.kod\r\n     and cek.cartip=ac.cartp\r\n     left join genel_kart as vc on cek.vercarkod=vc.kod\r\n     and cek.vercartip=vc.cartp\r\n     where tarih>=@BASTAR and tarih<=@BITTAR\r\n     and cek.sil in (select * from CsvToSTR(@SILIN) )\r\n    end\r\n    \r\n    \r\n     if @TARTIP='vadetar'\r\n    begin\r\n     insert into @GC_TB_CEK_CARILER\r\n     (Firmano,CAR_TIP,CAR_KOD,CAR_UNVAN,BNK_UNVAN,\r\n     DRM,ISLEMHRK,SONUC)\r\n     SELECT cek.firmano,\r\n     case when gctip='G' THEN cartip else vercartip end,\r\n     case when gctip='G' THEN carkod else vercarkod end,\r\n     case when gctip='G' THEN ac.ad else vc.ad end,\r\n     cek.banka,drm,cek.islmhrk,cek.sonuc\r\n     from cekkart as cek\r\n     left join genel_kart as ac on cek.carkod=ac.kod\r\n     and cek.cartip=ac.cartp\r\n     left join genel_kart as vc on cek.vercarkod=vc.kod\r\n     and cek.vercartip=vc.cartp\r\n     where vadetar>=@BASTAR and vadetar<=@BITTAR\r\n     and cek.sil in (select * from CsvToSTR(@SILIN) )\r\n    end\r\n    \r\n    \r\n    if @firmano>0\r\n      delete from @GC_TB_CEK_CARILER where FirmaNo not in (@firmano,0)\r\n    \r\n\r\n    if @SONUC=1\r\n      delete from @GC_TB_CEK_CARILER where SONUC not in (0,NULL)\r\n\r\n\r\n    \r\n    \r\n    if @ISLEMHRK<>'' and @BANKA=''\r\n     begin\r\n     insert into @TB_CEK_CARILER\r\n     (CAR_TIP,CAR_KOD,CAR_UNVAN)\r\n     SELECT CAR_TIP,CAR_KOD,CAR_UNVAN FROM @GC_TB_CEK_CARILER\r\n     where ISLEMHRK=@ISLEMHRK\r\n     GROUP BY CAR_TIP,CAR_KOD,CAR_UNVAN order by CAR_UNVAN\r\n     RETURN\r\n     end \r\n    \r\n     if @ISLEMHRK<>'' and @BANKA<>''\r\n     begin\r\n     insert into @TB_CEK_CARILER\r\n     (CAR_TIP,CAR_KOD,CAR_UNVAN)\r\n     SELECT CAR_TIP,CAR_KOD,CAR_UNVAN FROM @GC_TB_CEK_CARILER\r\n     where ISLEMHRK=@ISLEMHRK AND BNK_UNVAN=@BANKA\r\n     GROUP BY CAR_TIP,CAR_KOD,CAR_UNVAN order by CAR_UNVAN\r\n     RETURN\r\n     end \r\n    \r\n   \r\n     if @DRMIN <> '' and @BANKA=''\r\n     insert into @TB_CEK_CARILER\r\n     (CAR_TIP,CAR_KOD,CAR_UNVAN)\r\n     SELECT CAR_TIP,CAR_KOD,CAR_UNVAN FROM @GC_TB_CEK_CARILER\r\n     where drm in (select * from CsvToSTR(@DRMIN) )\r\n     GROUP BY CAR_TIP,CAR_KOD,CAR_UNVAN order by CAR_UNVAN\r\n     \r\n     if @DRMIN <> '' and @BANKA<>''\r\n     insert into @TB_CEK_CARILER\r\n     (CAR_TIP,CAR_KOD,CAR_UNVAN)\r\n     SELECT CAR_TIP,CAR_KOD,CAR_UNVAN FROM @GC_TB_CEK_CARILER\r\n     where drm in (select * from CsvToSTR(@DRMIN) ) AND BNK_UNVAN=@BANKA\r\n     GROUP BY CAR_TIP,CAR_KOD,CAR_UNVAN order by CAR_UNVAN\r\n     \r\n     \r\n     if @DRMIN = '' and @BANKA=''\r\n     insert into @TB_CEK_CARILER\r\n     (CAR_TIP,CAR_KOD,CAR_UNVAN)\r\n     SELECT CAR_TIP,CAR_KOD,CAR_UNVAN FROM @GC_TB_CEK_CARILER\r\n     GROUP BY CAR_TIP,CAR_KOD,CAR_UNVAN order by CAR_UNVAN\r\n     \r\n     if @DRMIN = '' and @BANKA<>''\r\n     insert into @TB_CEK_CARILER\r\n     (CAR_TIP,CAR_KOD,CAR_UNVAN)\r\n     SELECT CAR_TIP,CAR_KOD,CAR_UNVAN FROM @GC_TB_CEK_CARILER\r\n     where  BNK_UNVAN=@BANKA\r\n     GROUP BY CAR_TIP,CAR_KOD,CAR_UNVAN order by CAR_UNVAN   \r\n     \r\n      \r\n    \r\n\r\nRETURN\r\n  \r\n  \r\n  \r\nEND"
  },
  {
    "schema": "dbo",
    "name": "Cek_Senet_Kontrol",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.Cek_Senet_Kontrol",
    "definition": "CREATE FUNCTION [dbo].Cek_Senet_Kontrol\r\n(@cekno varchar(30),\r\n@cekid int)\r\nRETURNS\r\n   @TB_CEK_KONT TABLE (\r\n    gctip         VARCHAR(20)   COLLATE Turkish_CI_AS,\r\n    tarih         datetime,\r\n    islmtipad     VARCHAR(50)   COLLATE Turkish_CI_AS,\r\n    ceksenno      VARCHAR(30)   COLLATE Turkish_CI_AS,\r\n    cartip        VARCHAR(30)   COLLATE Turkish_CI_AS,\r\n    unvan         VARCHAR(100)   COLLATE Turkish_CI_AS,\r\n    olususer      VARCHAR(50)   COLLATE Turkish_CI_AS,\r\n    tutar         float)\r\nAS\r\nBEGIN\r\n\r\n\r\n insert into @TB_CEK_KONT\r\n (gctip,tarih,islmtipad,ceksenno,cartip,unvan,tutar,olususer)\r\n select gctip,tarih,islmtipad,ceksenno,\r\n case when  gctip='G' then cartip else vercartip end,\r\n case when  gctip='G' then ck.ad else vck.ad end,\r\n case when  gctip='G' then giren else cikan end,\r\n olususer\r\n from cekkart as cek\r\n left join Genel_Kart as ck on ck.kod=carkod and ck.cartp=cek.cartip\r\n left join Genel_Kart as vck on vck.kod=vercarkod and vck.cartp=cek.vercartip\r\n where ceksenno=@cekno and cekid<>@cekid and cek.sil=0\r\n  \r\n  \r\n  \r\n return\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "Cek_Son_Drm",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.Cek_Son_Drm",
    "definition": "CREATE FUNCTION [dbo].Cek_Son_Drm \r\n(\r\n@FIRMANO \t\tint,\r\n@DRM\t\t\tVARCHAR(20),\r\n@BAS_TAR\t\tdatetime,\r\n@BIT_TAR\t\tdatetime\r\n)\r\nRETURNS\r\n\r\n  @TABLE_CEK_DRM TABLE (\r\n   id\t\t\t\t\tint,\r\n   Drm\t\t\t\t\tVARCHAR(20) COLLATE Turkish_CI_AS,\r\n   Car_Tip\t\t\t\tVARCHAR(30) COLLATE Turkish_CI_AS,\r\n   Car_Kod\t\t\t\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n   BelgeNo\t\t\t\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n   Borc\t\t\t\t\tfloat,\r\n   Alacak\t\t\t\tfloat,\r\n   Tarih\t\t\t\tdatetime)\r\nAS\r\nBEGIN\r\n\r\n    declare @son_drm   \tvarchar(20)\r\n    declare @CEK_ID\t\tint   \r\n    declare @BelgeNo   \tvarchar(50)\r\n\r\n     declare cek_cur CURSOR FAST_FORWARD  FOR \r\n      select cekid,ceksenno from cekkart as k\r\n      where k.sil=0 and \r\n      cekid=(select top 1 cekid from cekhrk as h where \r\n        h.tarih >= @BAS_TAR and h.tarih <= @BIT_TAR\r\n        and k.cekid=h.cekid and aktif=1\r\n         order by h.tarih desc,h.saat desc,h.id asc)\r\n     \r\n       open cek_cur\r\n         fetch next from  cek_cur into \r\n          @CEK_ID,@belgeNo\r\n           while @@FETCH_STATUS=0\r\n            begin \r\n        \r\n    \r\n              select top 1 @son_drm=drm from cekhrk with (NOLOCK)\r\n              where cekid=@CEK_ID \r\n              and tarih >= @BAS_TAR and tarih <= @BIT_TAR\r\n              and sil=0 and aktif=1 and drm<>'KGR'\r\n              order by id desc\r\n\r\n\r\n\r\n              if (@son_drm='TGR') and (@DRM='POR')\r\n              begin\r\n                insert into @TABLE_CEK_DRM (id,drm,Car_Tip,\r\n                Car_Kod,belgeno,Borc,Alacak,Tarih)\r\n                select top 1 id,drm,cartip,carkod,@belgeNo,\r\n                tutar,0,tarih \r\n                from cekhrk with (NOLOCK)\r\n                where cekid=@CEK_ID and drm in ('POR')\r\n                and tarih >= @BAS_TAR and tarih <= @BIT_TAR\r\n                and sil=0 and aktif=1\r\n                order by id desc\r\n               end \r\n               \r\n               \r\n              if (@son_drm='CGR') and (@DRM='POR')\r\n              begin\r\n                insert into @TABLE_CEK_DRM (id,drm,Car_Tip,\r\n                Car_Kod,belgeno,Borc,Alacak,Tarih)\r\n                select top 1 id,drm,cartip,carkod,@belgeNo,\r\n                tutar,0,tarih \r\n                from cekhrk  with (NOLOCK)\r\n                where cekid=@CEK_ID and drm in ('POR')\r\n                and tarih >= @BAS_TAR and tarih <= @BIT_TAR\r\n                and sil=0 and aktif=1\r\n                order by id desc\r\n               end \r\n               \r\n               \r\n               \r\n               \r\n                \r\n                \r\n                if (@son_drm='POR') and (@DRM='POR')\r\n                begin \r\n                  insert into @TABLE_CEK_DRM (id,drm,Car_Tip,\r\n                  Car_Kod,belgeno,Borc,Alacak,Tarih)\r\n                  select top 1 id,drm,cartip,carkod,\r\n                  @belgeNo,tutar,0,tarih from \r\n                  cekhrk with (NOLOCK) where cekid=@CEK_ID and drm in ('POR')\r\n                  and tarih >= @BAS_TAR and tarih <= @BIT_TAR\r\n                  and sil=0 and aktif=1\r\n                  order by id desc  \r\n                end\r\n                \r\n                if (@son_drm='TAK') and (@DRM='TAK')\r\n                begin \r\n                  insert into @TABLE_CEK_DRM (id,drm,Car_Tip,\r\n                  Car_Kod,belgeno,Borc,Alacak,Tarih)\r\n                  select top 1 id,drm,cartip,carkod,\r\n                  @belgeNo,tutar,0,tarih from cekhrk with (NOLOCK)\r\n                  where cekid=@CEK_ID and drm in ('TAK')\r\n                  and tarih >= @BAS_TAR and tarih <= @BIT_TAR\r\n                  and sil=0 and aktif=1\r\n                  order by id desc  \r\n                end  \r\n                \r\n  \r\n                if (@son_drm='KSN') and (@DRM='KSN')\r\n                begin \r\n                  insert into @TABLE_CEK_DRM (id,drm,Car_Tip,\r\n                  Car_Kod,belgeno,Borc,Alacak,Tarih)\r\n                  select top 1 id,drm,cartip,carkod,@belgeNo,\r\n                  0,tutar,tarih \r\n                  from cekhrk with (NOLOCK)\r\n                  where cekid=@CEK_ID and drm in ('KSN')\r\n                  and tarih >= @BAS_TAR and tarih <= @BIT_TAR\r\n                  and sil=0 and aktif=1\r\n                  order by id desc  /* tarih desc,saat desc  */\r\n                end\r\n                \r\n                \r\n                if (@son_drm='OTI') and (@DRM='TAK')\r\n                begin \r\n                  insert into @TABLE_CEK_DRM (id,drm,Car_Tip,\r\n                  Car_Kod,belgeno,Borc,Alacak,Tarih)\r\n                  select top 1 id,drm,cartip,carkod,@belgeNo,\r\n                  tutar,0,tarih from cekhrk with (NOLOCK)\r\n                  where cekid=@CEK_ID and drm in ('TAK')\r\n                  and tarih >= @BAS_TAR and tarih <= @BIT_TAR\r\n                  and sil=0 and aktif=1\r\n                  order by id desc  \r\n                end  \r\n                \r\n                \r\n                if (@son_drm='OTI') and (@DRM='KSN')\r\n                begin \r\n                  insert into @TABLE_CEK_DRM (id,drm,Car_Tip,\r\n                  Car_Kod,belgeno,Borc,Alacak,Tarih)\r\n                  select top 1 id,drm,cartip,carkod,@belgeNo,\r\n                  0,tutar,tarih from cekhrk with (NOLOCK)\r\n                  where cekid=@CEK_ID and drm in ('KSN')\r\n                  and tarih >= @BAS_TAR and tarih <= @BIT_TAR\r\n                  and sil=0 and aktif=1\r\n                  order by id desc  \r\n                end \r\n                \r\n                              \r\n                if (@son_drm='OTI') and (@DRM='POR')\r\n                begin \r\n                  insert into @TABLE_CEK_DRM (id,drm,Car_Tip,\r\n                  Car_Kod,belgeno,Borc,Alacak,Tarih)\r\n                  select top 1 id,drm,cartip,carkod,\r\n                  @belgeNo,tutar,0,tarih from \r\n                  cekhrk with (NOLOCK) where cekid=@CEK_ID and drm in ('POR')\r\n                  and tarih >= @BAS_TAR and tarih <= @BIT_TAR\r\n                  and sil=0 and aktif=1\r\n                  order by id desc  \r\n                end  \r\n                \r\n\r\n\r\n\r\n          FETCH next from  cek_cur into @CEK_ID,@belgeNo\r\n         end\r\n        Close cek_cur\r\n        deallocate cek_cur \r\n        \r\n        \r\n        \r\n        \r\n        \r\n\r\n\r\n     RETURN\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "CsvNokVirToSTR",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.CsvNokVirToSTR",
    "definition": "CREATE Function dbo.[CsvNokVirToSTR] ( @Array  varchar(8000))\r\nreturns @IntTable table (STRValue varchar(30) COLLATE Turkish_CI_AS)\r\nAS\r\nbegin\r\n\r\n declare @separator char(1)\r\n set @separator = ';'\r\n\r\n declare @separator_position int\r\n declare @array_value varchar(1000)\r\n\r\n IF (LEN(RTRIM(@array)) > 0)\r\n BEGIN\r\n  set @array = @array + ';'\r\n END\r\n\r\n while patindex('%;%' , @array) <> 0\r\n begin\r\n\r\n   select @separator_position =  patindex('%;%' , @array)\r\n   select @array_value = left(@array, @separator_position - 1)\r\n\r\n  Insert @IntTable\r\n  Values (@array_value)\r\n\r\n   select @array = stuff(@array, 1, @separator_position, '')\r\n end\r\n\r\n return\r\nend"
  },
  {
    "schema": "dbo",
    "name": "CsvToInt",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.CsvToInt",
    "definition": "CREATE Function dbo.CsvToInt ( @Array  varchar(8000))\r\nreturns @IntTable table\r\n (IntValue int)\r\nAS\r\nbegin\r\n\r\n declare @separator char(1)\r\n set @separator = ','\r\n\r\n declare @separator_position int\r\n declare @array_value varchar(1000)\r\n\r\n IF (LEN(RTRIM(@array)) > 0)\r\n BEGIN\r\n  set @array = @array + ','\r\n END\r\n\r\n while patindex('%,%' , @array) <> 0\r\n begin\r\n\r\n   select @separator_position =  patindex('%,%' , @array)\r\n   select @array_value = left(@array, @separator_position - 1)\r\n\r\n  Insert @IntTable\r\n  Values (Cast(@array_value as int))\r\n\r\n   select @array = stuff(@array, 1, @separator_position, '')\r\n end\r\n\r\n return\r\nend"
  },
  {
    "schema": "dbo",
    "name": "CsvToInt_Max",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.CsvToInt_Max",
    "definition": "CREATE Function dbo.[CsvToInt_Max] ( @Array  varchar(max))\r\nreturns @IntTable table\r\n (IntValue int)\r\nAS\r\nbegin\r\n\r\n declare @separator char(1)\r\n set @separator = ','\r\n\r\n declare @separator_position int\r\n declare @array_value varchar(1000)\r\n\r\n IF (LEN(RTRIM(@array)) > 0)\r\n BEGIN\r\n  set @array = @array + ','\r\n END\r\n\r\n while patindex('%,%' , @array) <> 0\r\n begin\r\n\r\n   select @separator_position =  patindex('%,%' , @array)\r\n   select @array_value = left(@array, @separator_position - 1)\r\n\r\n  Insert @IntTable\r\n  Values (Cast(@array_value as int))\r\n\r\n   select @array = stuff(@array, 1, @separator_position, '')\r\n end\r\n\r\n return\r\nend"
  },
  {
    "schema": "dbo",
    "name": "CsvToSTR",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.CsvToSTR",
    "definition": "CREATE Function dbo.CsvToSTR ( @Array  varchar(8000))\r\nreturns @IntTable table\r\n (STRValue varchar(30) COLLATE Turkish_CI_AS)\r\nAS\r\nbegin\r\n\r\n declare @separator char(1)\r\n set @separator = ','\r\n\r\n declare @separator_position int\r\n declare @array_value varchar(1000)\r\n\r\n IF (LEN(RTRIM(@array)) > 0)\r\n BEGIN\r\n  set @array = @array + ','\r\n END\r\n\r\n while patindex('%,%' , @array) <> 0\r\n begin\r\n\r\n   select @separator_position =  patindex('%,%' , @array)\r\n   select @array_value = left(@array, @separator_position - 1)\r\n\r\n  Insert @IntTable\r\n  Values (@array_value)\r\n\r\n   select @array = stuff(@array, 1, @separator_position, '')\r\n end\r\n\r\n return\r\nend"
  },
  {
    "schema": "dbo",
    "name": "DEKONT_DOVIZ",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.DEKONT_DOVIZ",
    "definition": "CREATE FUNCTION [dbo].DEKONT_DOVIZ (@grptip varchar(10),\r\n@islmtip varchar(10),@hrkid float)\r\nRETURNS\r\n  @TB_DOVIZ_DEKONT TABLE (\r\n    ISLEM         VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    B_CARI_TIP    VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    B_CARI_KOD    VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    B_CARI_UNVAN  VARCHAR(150) COLLATE Turkish_CI_AS,\r\n    A_CARI_TIP    VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    A_CARI_KOD    VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    A_CARI_UNVAN  VARCHAR(150) COLLATE Turkish_CI_AS,\r\n    TARIH         DATETIME,\r\n    SAAT          VARCHAR(10) COLLATE Turkish_CI_AS,\r\n    BELGENO       VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    ACK           VARCHAR(100) COLLATE Turkish_CI_AS,\r\n    B_PARABIRIM   VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    B_PARASTR     VARCHAR(70) COLLATE Turkish_CI_AS,\r\n    KUR           FLOAT,\r\n    B_TUTAR       FLOAT,\r\n    A_PARABIRIM   VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    A_PARASTR     VARCHAR(70) COLLATE Turkish_CI_AS,\r\n    A_TUTAR       FLOAT)\r\nAS\r\nBEGIN\r\n   DECLARE @EKSTRE_TEMP TABLE (\r\n    ISLEM         VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    B_CARI_TIP    VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    B_CARI_KOD    VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    B_CARI_UNVAN  VARCHAR(150) COLLATE Turkish_CI_AS,\r\n    A_CARI_TIP    VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    A_CARI_KOD    VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    A_CARI_UNVAN  VARCHAR(150) COLLATE Turkish_CI_AS,\r\n    TARIH         DATETIME,\r\n    SAAT          VARCHAR(10) COLLATE Turkish_CI_AS,\r\n    BELGENO       VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    ACK           VARCHAR(100) COLLATE Turkish_CI_AS,\r\n    B_PARABIRIM   VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    B_PARASTR     VARCHAR(70) COLLATE Turkish_CI_AS,\r\n    KUR           FLOAT,\r\n    B_TUTAR       FLOAT,\r\n    A_PARABIRIM   VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    A_PARASTR     VARCHAR(70) COLLATE Turkish_CI_AS,\r\n    A_TUTAR       FLOAT)\r\n\r\n      DECLARE @HRK_CARI_TIP     VARCHAR(20)\r\n      DECLARE @HRK_CARI_KOD     VARCHAR(20)\r\n      DECLARE @HRK_CARI_UNVAN   VARCHAR(150)\r\n      DECLARE @HRK_TARIH        DATETIME\r\n      DECLARE @HRK_SAAT         VARCHAR(10)\r\n      DECLARE @HRK_BELGENO      VARCHAR(20)\r\n      DECLARE @HRK_ACK          VARCHAR(100)\r\n      DECLARE @HRK_PARABIRIM    VARCHAR(20)\r\n      DECLARE @HRK_PARASTR      VARCHAR(70)\r\n      DECLARE @HRK_ISLEM        VARCHAR(20)\r\n      DECLARE @HRK_TUTAR        FLOAT\r\n      DECLARE @HRK_KUR          FLOAT\r\n      DECLARE @KUR              FLOAT\r\n      DECLARE @say              int\r\n\r\n     SET @KUR=1\r\n     \r\n  if (@grptip='bankahrk') \r\n   DECLARE CRS_HRK CURSOR FAST_FORWARD FOR\r\n     select car.cartp as CARI_TIP,car.kod as CARI_KOD,\r\n     car.ad as CARI_UNVAN,\r\n     tarih AS TARIH,saat AS SAAT,\r\n     belno AS BELGENO,hrk.ack,hrk.kur,abs(round(borc-alacak,2)) as TUTAR,PARABRM,\r\n     dbo.ParaOku(round(borc-alacak,2)) as PARASTR from\r\n     bankahrk hrk inner join Genel_Kart as car\r\n     on hrk.bankod=car.kod and car.cartp='bankakart' where hrk.bankhrkid=@hrkid\r\n     order by hrk.id\r\n\r\n\r\n   if (@grptip='kasahrk') \r\n   DECLARE CRS_HRK CURSOR FAST_FORWARD FOR\r\n     select car.cartp as CARI_TIP,car.kod as CARI_KOD,\r\n     car.ad as CARI_UNVAN,\r\n     tarih AS TARIH,saat AS SAAT,\r\n     belno AS BELGENO,hrk.ack,hrk.kur,abs(round(giren-cikan,2)) as TUTAR,PARABRM,\r\n     dbo.ParaOku(ABS(round(giren-cikan,2))) as PARASTR from\r\n     kasahrk hrk inner join Genel_Kart as car\r\n     on hrk.kaskod=car.kod and car.cartp='kasakart' where hrk.kashrkid=@hrkid\r\n     order by hrk.id\r\n\r\n   OPEN CRS_HRK\r\n   SET @say=1\r\n   FETCH NEXT FROM CRS_HRK INTO\r\n   @HRK_CARI_TIP,@HRK_CARI_KOD,@HRK_CARI_UNVAN,@HRK_TARIH,@HRK_SAAT,@HRK_BELGENO,\r\n   @HRK_ACK,@HRK_KUR,@HRK_TUTAR,@HRK_PARABIRIM,@HRK_PARASTR\r\n\r\n  WHILE @@FETCH_STATUS = 0\r\n  BEGIN\r\n\r\n    SET @KUR=@KUR*@HRK_KUR\r\n    \r\n    if @say=1\r\n    INSERT @EKSTRE_TEMP (B_CARI_TIP,B_CARI_KOD,B_CARI_UNVAN,\r\n    TARIH,SAAT,BELGENO,ACK,B_PARABIRIM,B_PARASTR,B_TUTAR)\r\n    SELECT @HRK_CARI_TIP,@HRK_CARI_KOD,@HRK_CARI_UNVAN,@HRK_TARIH,@HRK_SAAT,\r\n    @HRK_BELGENO,@HRK_ACK,@HRK_PARABIRIM,@HRK_PARASTR,@HRK_TUTAR\r\n    if @say=2\r\n    UPDATE @EKSTRE_TEMP SET A_CARI_TIP=@HRK_CARI_TIP,\r\n    A_CARI_KOD=@HRK_CARI_KOD,A_CARI_UNVAN=@HRK_CARI_UNVAN,\r\n    A_PARABIRIM=@HRK_PARABIRIM,A_PARASTR=@HRK_PARASTR,A_TUTAR=@HRK_TUTAR,\r\n    KUR=@KUR\r\n    \r\n    \r\n    SET @say=@say+1\r\n\r\n    FETCH NEXT FROM CRS_HRK INTO\r\n    @HRK_CARI_TIP,@HRK_CARI_KOD,@HRK_CARI_UNVAN,@HRK_TARIH,@HRK_SAAT,@HRK_BELGENO,\r\n   @HRK_ACK,@HRK_KUR,@HRK_TUTAR,@HRK_PARABIRIM,@HRK_PARASTR\r\n  END\r\n\r\n  CLOSE CRS_HRK\r\n  DEALLOCATE CRS_HRK\r\n  /*---------------------------------------------------------------------------- */\r\n\r\n  INSERT @TB_DOVIZ_DEKONT\r\n    SELECT * FROM @EKSTRE_TEMP\r\n\r\n  RETURN\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "DEKONT_MAHVIR",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.DEKONT_MAHVIR",
    "definition": "CREATE FUNCTION [dbo].DEKONT_MAHVIR (@grptip varchar(10),\r\n@islmtip varchar(10),@hrkid float)\r\nRETURNS\r\n  @TB_MAHVIR_DEKONT TABLE (\r\n    B_CARI_TIP    VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    B_CARI_KOD    VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    B_CARI_UNVAN  VARCHAR(150) COLLATE Turkish_CI_AS,\r\n    A_CARI_TIP    VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    A_CARI_KOD    VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    A_CARI_UNVAN  VARCHAR(150) COLLATE Turkish_CI_AS,\r\n    TARIH         DATETIME,\r\n    SAAT          VARCHAR(10) COLLATE Turkish_CI_AS,\r\n    BELGENO       VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    ACK           VARCHAR(100) COLLATE Turkish_CI_AS,\r\n    PARABIRIM     VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    PARASTR       VARCHAR(70) COLLATE Turkish_CI_AS,\r\n    TUTAR         FLOAT)\r\nAS\r\nBEGIN\r\n   DECLARE @EKSTRE_TEMP TABLE (\r\n    B_CARI_TIP    VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    B_CARI_KOD    VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    B_CARI_UNVAN  VARCHAR(150) COLLATE Turkish_CI_AS,\r\n    A_CARI_TIP    VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    A_CARI_KOD    VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    A_CARI_UNVAN  VARCHAR(150) COLLATE Turkish_CI_AS,\r\n    TARIH         DATETIME,\r\n    SAAT          VARCHAR(10) COLLATE Turkish_CI_AS,\r\n    BELGENO       VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    ACK           VARCHAR(100) COLLATE Turkish_CI_AS,\r\n    PARABIRIM     VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    PARASTR       VARCHAR(70) COLLATE Turkish_CI_AS,\r\n    TUTAR         FLOAT)\r\n\r\n      DECLARE @HRK_CARI_TIP     VARCHAR(20)\r\n      DECLARE @HRK_CARI_KOD     VARCHAR(20)\r\n      DECLARE @HRK_CARI_UNVAN   VARCHAR(150)\r\n      DECLARE @HRK_TARIH        DATETIME\r\n      DECLARE @HRK_SAAT         VARCHAR(10)\r\n      DECLARE @HRK_BELGENO      VARCHAR(20)\r\n      DECLARE @HRK_ACK          VARCHAR(100)\r\n      DECLARE @HRK_PARABIRIM    VARCHAR(20)\r\n      DECLARE @HRK_PARASTR      VARCHAR(70)\r\n      DECLARE @HRK_ISLEM        VARCHAR(20)\r\n      DECLARE @HRK_TUTAR        FLOAT\r\n      DECLARE @say              int\r\n\r\n/*MAHSUP */\r\n  if (@grptip='carihrk') and  (@islmtip='MAH')\r\n   DECLARE CRS_HRK CURSOR FAST_FORWARD FOR\r\n     select car.cartp as CARI_TIP,car.kod as CARI_KOD,\r\n     car.ad as CARI_UNVAN,\r\n     tarih AS TARIH,saat AS SAAT,\r\n     belno AS BELGENO,hrk.ack,abs(borc-alacak) as TUTAR,PARABRM,\r\n     dbo.ParaOku(ABS(borc-alacak)) as PARASTR from\r\n     carihrk hrk inner join Genel_Kart as car\r\n     on hrk.carkod=car.kod and hrk.cartip=car.cartp where hrk.carhrkid=@hrkid\r\n     order by hrk.id\r\n\r\n\r\n  if (@grptip='bankahrk') and  (@islmtip='VIR')\r\n   DECLARE CRS_HRK CURSOR FAST_FORWARD FOR\r\n     select car.cartp as CARI_TIP,car.kod as CARI_KOD,\r\n     car.ad as CARI_UNVAN,\r\n     tarih AS TARIH,saat AS SAAT,\r\n     belno AS BELGENO,hrk.ack,abs(borc-alacak) as TUTAR,PARABRM,\r\n     dbo.ParaOku(ABS(borc-alacak)) as PARASTR from\r\n     bankahrk hrk inner join Genel_Kart as car\r\n     on hrk.bankod=car.kod and car.cartp='bankakart' where hrk.bankhrkid=@hrkid\r\n     order by hrk.id\r\n\r\n\r\n   if (@grptip='kasahrk') and  (@islmtip='VIR')\r\n   DECLARE CRS_HRK CURSOR FAST_FORWARD FOR\r\n     select car.cartp as CARI_TIP,car.kod as CARI_KOD,\r\n     car.ad as CARI_UNVAN,\r\n     tarih AS TARIH,saat AS SAAT,\r\n     belno AS BELGENO,hrk.ack,abs(giren-cikan) as TUTAR,PARABRM,\r\n     dbo.ParaOku(ABS(giren-cikan)) as PARASTR from\r\n     kasahrk hrk inner join Genel_Kart as car\r\n     on hrk.kaskod=car.kod and car.cartp='kasakart' where hrk.kashrkid=@hrkid\r\n     order by hrk.id\r\n\r\n   OPEN CRS_HRK\r\n   SET @say=1\r\n FETCH NEXT FROM CRS_HRK INTO\r\n   @HRK_CARI_TIP,@HRK_CARI_KOD,@HRK_CARI_UNVAN,@HRK_TARIH,@HRK_SAAT,@HRK_BELGENO,\r\n   @HRK_ACK,@HRK_TUTAR,@HRK_PARABIRIM,@HRK_PARASTR\r\n\r\n  WHILE @@FETCH_STATUS = 0\r\n  BEGIN\r\n\r\n    if @say=1\r\n    INSERT @EKSTRE_TEMP (B_CARI_TIP,B_CARI_KOD,B_CARI_UNVAN,\r\n    TARIH,SAAT,BELGENO,ACK,PARABIRIM,\r\n    PARASTR,TUTAR)\r\n    SELECT @HRK_CARI_TIP,@HRK_CARI_KOD,@HRK_CARI_UNVAN,@HRK_TARIH,@HRK_SAAT,\r\n    @HRK_BELGENO,@HRK_ACK,@HRK_PARABIRIM,@HRK_PARASTR,@HRK_TUTAR\r\n    if @say=2\r\n    UPDATE @EKSTRE_TEMP SET A_CARI_TIP=@HRK_CARI_TIP,\r\n    A_CARI_KOD=@HRK_CARI_KOD,A_CARI_UNVAN=@HRK_CARI_UNVAN\r\n    \r\n    SET @say=@say+1\r\n\r\n    FETCH NEXT FROM CRS_HRK INTO\r\n    @HRK_CARI_TIP,@HRK_CARI_KOD,@HRK_CARI_UNVAN,@HRK_TARIH,@HRK_SAAT,@HRK_BELGENO,\r\n   @HRK_ACK,@HRK_TUTAR,@HRK_PARABIRIM,@HRK_PARASTR\r\n  END\r\n\r\n  CLOSE CRS_HRK\r\n  DEALLOCATE CRS_HRK\r\n  /*---------------------------------------------------------------------------- */\r\n\r\n  INSERT @TB_MAHVIR_DEKONT\r\n    SELECT * FROM @EKSTRE_TEMP\r\n\r\n  RETURN\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "DEKONT_TAHTED",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.DEKONT_TAHTED",
    "definition": "CREATE FUNCTION [dbo].DEKONT_TAHTED (@islmtip varchar(10),\r\n@islmhrk varchar(10),@hrkid float)\r\nRETURNS\r\n  @TB_CARI_DEKONT TABLE (\r\n    KART_TIP            VARCHAR(30)  COLLATE Turkish_CI_AS,\r\n    KART_KOD            VARCHAR(30)  COLLATE Turkish_CI_AS,\r\n    KART_UNVAN          VARCHAR(150)  COLLATE Turkish_CI_AS,\r\n    CARI_TIP    VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    CARI_KOD    VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    CARI_UNVAN  VARCHAR(150) COLLATE Turkish_CI_AS,\r\n    CARI_ADRES1  \t\tVARCHAR(150) COLLATE Turkish_CI_AS,\r\n    CARI_ADRES2  \t\tVARCHAR(150) COLLATE Turkish_CI_AS,\r\n    CARI_TEL     \t\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n    CARI_CEP     \t\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n    CARI_FAX     \t\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n    CARI_VERGIDAIRE \tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n    CARI_VERGINO \t\tVARCHAR(50) COLLATE Turkish_CI_AS,    \r\n    TARIH       DATETIME,\r\n    SAAT        VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    BELGENO     VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    PARABIRIM   VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    PARASTR     VARCHAR(70) COLLATE Turkish_CI_AS,\r\n    ISLEM       VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    ACK         VARCHAR(100) COLLATE Turkish_CI_AS,\r\n    TUTAR       FLOAT,\r\n    VADTAR      DATETIME,\r\n    FIS_BAKIYE  FLOAT,\r\n    CAR_BAKIYE  FLOAT,\r\n    TOP_BAKIYE  FLOAT)\r\nAS\r\nBEGIN\r\n   DECLARE @EKSTRE_TEMP TABLE (\r\n    KART_TIP            VARCHAR(30)  COLLATE Turkish_CI_AS,\r\n    KART_KOD            VARCHAR(30)  COLLATE Turkish_CI_AS,\r\n    KART_UNVAN          VARCHAR(150)  COLLATE Turkish_CI_AS,\r\n    CARI_TIP            VARCHAR(30)  COLLATE Turkish_CI_AS,\r\n    CARI_KOD     \t\tVARCHAR(30)  COLLATE Turkish_CI_AS,\r\n    CARI_UNVAN  \t\tVARCHAR(150) COLLATE Turkish_CI_AS,\r\n    CARI_ADRES1  \t\tVARCHAR(150) COLLATE Turkish_CI_AS,\r\n    CARI_ADRES2  \t\tVARCHAR(150) COLLATE Turkish_CI_AS,\r\n    CARI_TEL     \t\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n    CARI_CEP     \t\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n    CARI_FAX     \t\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n    CARI_VERGIDAIRE \tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n    CARI_VERGINO \t\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n    TARIH       \t\tDATETIME,\r\n    SAAT        \t\tVARCHAR(20) COLLATE Turkish_CI_AS,\r\n    BELGENO     \t\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n    PARABIRIM   \t\tVARCHAR(20) COLLATE Turkish_CI_AS,\r\n    PARASTR     \t\tVARCHAR(70) COLLATE Turkish_CI_AS,\r\n    ISLEM       \t\tVARCHAR(20) COLLATE Turkish_CI_AS,\r\n    ACK         \t\tVARCHAR(100) COLLATE Turkish_CI_AS,\r\n    TUTAR       \t\tFLOAT,\r\n    VADTAR      \t\tDATETIME,\r\n    FIS_BAKIYE  \t\tFLOAT,\r\n    CAR_BAKIYE  \t\tFLOAT,\r\n    TOP_BAKIYE  \t\tFLOAT)\r\n\r\n\r\n  DECLARE @HRK_KART_TIP             VARCHAR(30)\r\n  DECLARE @HRK_KART_KOD     \t\tVARCHAR(30)\r\n  DECLARE @HRK_KART_UNVAN   \t\tVARCHAR(150)\r\n\r\n\r\n  DECLARE @HRK_CARI_TIP             VARCHAR(30)\r\n  DECLARE @HRK_CARI_KOD     \t\tVARCHAR(30)\r\n  DECLARE @HRK_CARI_UNVAN   \t\tVARCHAR(150)\r\n  DECLARE @HRK_CARI_ADRES1  \t\tVARCHAR(150)\r\n  DECLARE @HRK_CARI_ADRES2  \t\tVARCHAR(150)  \r\n  DECLARE @HRK_CARI_TEL     \t\tVARCHAR(50)    \r\n  DECLARE @HRK_CARI_FAX     \t\tVARCHAR(50)    \r\n  DECLARE @HRK_CARI_CEP     \t\tVARCHAR(50)    \r\n  DECLARE @HRK_CARI_VERGINO \t\tVARCHAR(50)    \r\n  DECLARE @HRK_CARI_VERGIDAIRE \t\tVARCHAR(50) \r\n  DECLARE @HRK_TARIH        \t\tDATETIME\r\n  DECLARE @HRK_SAAT         \t\tVARCHAR(20)\r\n  DECLARE @HRK_BELGENO      \t\tVARCHAR(50)\r\n  DECLARE @HRK_PARABIRIM    \t\tVARCHAR(20)\r\n  DECLARE @HRK_PARASTR      \t\tVARCHAR(70)\r\n  DECLARE @HRK_ISLEM        \t\tVARCHAR(20)\r\n  DECLARE @HRK_ACK          \t\tVARCHAR(100)\r\n  DECLARE @HRK_TUTAR        \t\tFLOAT\r\n  DECLARE @HRK_VADTAR       \t\tDATETIME\r\n  DECLARE @HRK_FISBAKIYE    \t\tFLOAT\r\n  DECLARE @HRK_CARBAKIYE    \t\tFLOAT\r\n  DECLARE @HRK_TOPBAKIYE    \t\tFLOAT\r\n  \r\n\r\n/*NAKIT TAHSILAT VE ODEME */\r\n  if ((@islmtip='TAH') OR (@islmtip='ODE')) AND (@islmhrk='NAK')\r\n   DECLARE CRS_HRK CURSOR FAST_FORWARD FOR\r\n     select \r\n     'kasakart',hrk.kaskod,'',\r\n     hrk.cartip as CARI_TIP,hrk.carkod as CARI_KOD,\r\n     '','','','','','','','',\r\n     tarih AS TARIH,saat AS SAAT,\r\n     belno AS BELGENO,hrk.ack,abs(giren-cikan) as TUTAR,PARABRM,\r\n     dbo.ParaOku(ABS(giren-cikan)) as PARASTR,\r\n     case when giren>0 then 'TAHSİLAT' else 'ÖDEME' end as ISLEM,\r\n     tarih AS VADTAR,\r\n     0,0,0\r\n     from kasahrk hrk\r\n     /*inner join View_Cariler_Kart_Bakiye as car */\r\n    /* on hrk.carkod=car.kod and hrk.cartip=car.cartp  */\r\n     where kashrkid=@hrkid\r\n /*POS TAHSILAT */\r\n   if (@islmtip='TAH') AND (@islmhrk='POS')\r\n     DECLARE CRS_HRK CURSOR FAST_FORWARD FOR\r\n     select \r\n     'poskart',hrk.poskod,'',\r\n     hrk.cartip as CARI_TIP,hrk.carkod as CARI_KOD,\r\n     '','','','','','','','',\r\n     tarih AS TARIH,saat AS SAAT,\r\n     belno AS BELGENO,hrk.ack,abs(giren-cikan) as TUTAR,PARABRM,\r\n     dbo.ParaOku(ABS(giren-cikan)) as PARASTR,\r\n     case when giren>0 then 'TAHSİLAT' else 'ÖDEME' end as ISLEM,\r\n     vadetar as VADTAR,\r\n     0,0,0\r\n     from poshrk hrk \r\n     /*left join View_Cariler_Kart_Bakiye as car */\r\n     /*on hrk.carkod=car.kod and hrk.cartip=car.cartp  */\r\n     where poshrkid=@hrkid\r\n\r\n   /*banka dekont */\r\n   if (@islmtip='BNK') \r\n     DECLARE CRS_HRK CURSOR FAST_FORWARD FOR\r\n     select \r\n     case when hrk.cartip='kasakart' then 'kasakart' else 'bankakart' end,\r\n     case when hrk.cartip='kasakart' then hrk.carkod else hrk.bankod end,\r\n     '',\r\n     case when hrk.cartip='kasakart' then 'bankakart' else hrk.cartip end,\r\n     /*car.cartp as CARI_TIP, */\r\n     case when hrk.cartip='kasakart' then hrk.bankod else hrk.carkod end,\r\n     /*car.kod as CARI_KOD, */\r\n     '','','','','','','','',\r\n     tarih AS TARIH,saat AS SAAT,\r\n     belno AS BELGENO,hrk.ack,abs(borc-alacak) as TUTAR,PARABRM,\r\n     dbo.ParaOku(ABS(borc-alacak)) as PARASTR,\r\n     case when alacak>0 then 'TAHSİLAT' else 'ÖDEME' end as ISLEM,\r\n     NULL AS VADTAR,\r\n     0,0,0 from\r\n     bankahrk hrk \r\n     /*inner join View_Cariler_Kart_Bakiye as car */\r\n     /*on hrk.carkod=car.kod and hrk.cartip=car.cartp where  */\r\n     where bankhrkid=@hrkid\r\n     \r\n     \r\n  \r\n\r\n   /*kredi kart dekont */\r\n    if (@islmtip='ODE') AND (@islmhrk='IKK')\r\n     DECLARE CRS_HRK CURSOR FAST_FORWARD FOR\r\n     select \r\n     'istkart',hrk.istkkod,'',\r\n     hrk.cartip as CARI_TIP,hrk.carkod as CARI_KOD,\r\n     '','','','','','','','',\r\n     tarih AS TARIH,saat AS SAAT,\r\n     belno AS BELGENO,hrk.ack,abs(borc-alacak) as TUTAR,PARABRM,\r\n     dbo.ParaOku(ABS(borc-alacak)) as PARASTR,\r\n     case when Borc>0 then 'TAHSİLAT' else 'ÖDEME' end as ISLEM,\r\n     vadetar as VADTAR,\r\n     0,0,0 from\r\n     istkhrk hrk \r\n     /*inner join View_Cariler_Kart_Bakiye as car */\r\n     /*on hrk.carkod=car.kod and hrk.cartip=car.cartp  */\r\n     where istkhrkid=@hrkid\r\n\r\n   /*cek dekont */\r\n    if (@islmtip='CEK') \r\n     DECLARE CRS_HRK CURSOR FAST_FORWARD FOR\r\n     select \r\n     'cekkart','','',\r\n     hrk.cartip as CARI_TIP,hrk.carkod as CARI_KOD,\r\n     '','','','','','','','',\r\n     tarih AS TARIH,saat AS SAAT,\r\n     ceksenno AS BELGENO,hrk.ack,abs(giren-cikan) as TUTAR,PARABRM,\r\n     dbo.ParaOku(ABS(giren-cikan)) as PARASTR,\r\n     case when giren>0 then 'TAHSİLAT' else 'ÖDEME' end as ISLEM,\r\n     vadetar as VADTAR,\r\n     0,0,0  from\r\n     cekkart hrk \r\n     /*inner join View_Cariler_Kart_Bakiye as car */\r\n     /*on hrk.carkod=car.kod and hrk.cartip=car.cartp  */\r\n     where cekid=@hrkid\r\n\r\n\r\n   OPEN CRS_HRK\r\n\r\n FETCH NEXT FROM CRS_HRK INTO\r\n   @HRK_KART_TIP,@HRK_KART_KOD,@HRK_KART_UNVAN,\r\n   @HRK_CARI_TIP,@HRK_CARI_KOD,@HRK_CARI_UNVAN,\r\n   @HRK_CARI_ADRES1,@HRK_CARI_ADRES2,@HRK_CARI_TEL,@HRK_CARI_CEP,\r\n   @HRK_CARI_FAX,@HRK_CARI_VERGINO,@HRK_CARI_VERGIDAIRE,\r\n   @HRK_TARIH,@HRK_SAAT,@HRK_BELGENO,\r\n   @HRK_ACK,@HRK_TUTAR,@HRK_PARABIRIM,@HRK_PARASTR,@HRK_ISLEM,@HRK_VADTAR,\r\n   @HRK_FISBAKIYE,@HRK_CARBAKIYE,@HRK_TOPBAKIYE\r\n\r\n  WHILE @@FETCH_STATUS = 0\r\n  BEGIN\r\n\r\n    INSERT @EKSTRE_TEMP\r\n      SELECT\r\n       @HRK_KART_TIP,@HRK_KART_KOD,@HRK_KART_UNVAN,\r\n       @HRK_CARI_TIP,@HRK_CARI_KOD,@HRK_CARI_UNVAN,\r\n       @HRK_CARI_ADRES1,@HRK_CARI_ADRES2,@HRK_CARI_TEL,@HRK_CARI_CEP,\r\n       @HRK_CARI_FAX,@HRK_CARI_VERGINO,@HRK_CARI_VERGIDAIRE,\r\n       @HRK_TARIH,@HRK_SAAT,@HRK_BELGENO,\r\n       @HRK_PARABIRIM,@HRK_PARASTR,@HRK_ISLEM,@HRK_ACK,@HRK_TUTAR,@HRK_VADTAR,\r\n       @HRK_FISBAKIYE,@HRK_CARBAKIYE,@HRK_TOPBAKIYE\r\n\r\n    FETCH NEXT FROM CRS_HRK INTO\r\n    @HRK_KART_TIP,@HRK_KART_KOD,@HRK_KART_UNVAN,\r\n    @HRK_CARI_TIP,@HRK_CARI_KOD,@HRK_CARI_UNVAN,\r\n    @HRK_CARI_ADRES1,@HRK_CARI_ADRES2,@HRK_CARI_TEL,@HRK_CARI_CEP,\r\n   @HRK_CARI_FAX,@HRK_CARI_VERGINO,@HRK_CARI_VERGIDAIRE,\r\n    @HRK_TARIH,@HRK_SAAT,@HRK_BELGENO,\r\n    @HRK_ACK,@HRK_TUTAR,@HRK_PARABIRIM,@HRK_PARASTR,@HRK_ISLEM,@HRK_VADTAR,\r\n    @HRK_FISBAKIYE,@HRK_CARBAKIYE,@HRK_TOPBAKIYE\r\n  END\r\n\r\n  CLOSE CRS_HRK\r\n  DEALLOCATE CRS_HRK\r\n  /*---------------------------------------------------------------------------- */\r\n\r\n\r\n\r\n\r\n   update @EKSTRE_TEMP set KART_UNVAN=dt.AD\r\n   FROM @EKSTRE_TEMP AS T join\r\n   (select cartp,kod,ad from genel_kart) dt\r\n   on dt.cartp=t.KART_TIP and dt.kod=t.KART_KOD\r\n   \r\n   \r\n   update @EKSTRE_TEMP set \r\n   CARI_UNVAN=dt.AD,\r\n   CARI_ADRES1=dt.adres,\r\n   CARI_ADRES2=dt.adres2,\r\n   CARI_TEL=dt.tel,\r\n   CARI_CEP=DT.cep,\r\n   CARI_FAX=DT.fax,\r\n   CARI_VERGINO=DT.vergino,\r\n   CARI_VERGIDAIRE=DT.vergidaire,\r\n   FIS_BAKIYE=fisbak,\r\n   CAR_BAKIYE=carbak,\r\n   TOP_BAKIYE=topbak  \r\n   FROM @EKSTRE_TEMP AS T join\r\n   (select cartp,kod,ad,adres,adres2,tel,cep,fax,\r\n    vergino,vergidaire,fisbak,carbak,topbak \r\n    from View_Cariler_Kart_Bakiye) dt\r\n    on dt.cartp=t.CARI_TIP and dt.kod=t.CARI_KOD\r\n   \r\n   \r\n\r\n     \r\n\r\n  INSERT @TB_CARI_DEKONT\r\n    SELECT * FROM @EKSTRE_TEMP\r\n\r\n  RETURN\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "Depo_Kodin_Str",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.Depo_Kodin_Str",
    "definition": "CREATE FUNCTION [dbo].Depo_Kodin_Str \r\n(@KOD         VARCHAR(50))\r\nreturns @KodTable table\r\n (STRValue varchar(50) COLLATE Turkish_CI_AS)\r\nAS\r\nBEGIN\r\n\r\n    if @KOD=''\r\n      Insert @KodTable\r\n       select kod from Depo_Kart_Listesi\r\n  \r\n    if @KOD<>''\r\n      Insert @KodTable\r\n       Values (@KOD)\r\n  \r\n    RETURN\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "Depo_Stok_Miktar",
    "type": "SQL_SCALAR_FUNCTION",
    "full_name": "dbo.Depo_Stok_Miktar",
    "definition": "CREATE FUNCTION dbo.[Depo_Stok_Miktar] \r\n(\r\n@Depo_id \t\t\tint,\r\n@Depo_Kod \t\t\tvarchar(30),\r\n@Stk_id \t\t\tint,\r\n@Stk_Kod \t\t\tvarchar(30),\r\n@StkTip_id\t\t\tint,\r\n@StkTip\t\t\t\tvarchar(20)\r\n)\r\nRETURNS Float\r\nAS\r\nBEGIN\r\n  declare @Miktar float\r\n\r\n  select @Miktar=sum(giren-cikan) from stkhrk as h\r\n  where h.Depkod=@Depo_kod and h.stktip=@StkTip\r\n  and h.stkod=@Stk_Kod  and h.sil=0\r\n\r\n\r\n if @Miktar is null\r\n  set @Miktar=0\r\n\r\n return @Miktar\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "DEPO_TARIHLI_GRUP_STOKIN",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.DEPO_TARIHLI_GRUP_STOKIN",
    "definition": "CREATE FUNCTION dbo.[DEPO_TARIHLI_GRUP_STOKIN] (@VARTIP VARCHAR(20),\r\n@VARNIN VARCHAR(8000))\r\nRETURNS\r\n  @TB_DEP_TARIH TABLE (\r\n    GRUPANA_ID    int,\r\n    GRUPANA_AD    VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    GRUP_ID    int,\r\n    GRUP_AD    VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    DEP_KOD    VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    MIKTAR     FLOAT,\r\n    TUTAR      FLOAT)\r\nBEGIN\r\n\r\n /*declare @var_tarsaat   datetime */\r\n\r\n DECLARE  @STK_TIP   VARCHAR(10)\r\n\r\n DECLARE  @MAX_TAR   DATETIME\r\n\r\n  declare @Market_Stok_AltGrup int\r\n  \r\n  select @Market_Stok_AltGrup=isnull(Market_Stok_AltGrup,0) From sistemtanim\r\n\r\n\r\n \r\n  DECLARE @TB_TEMP_STOKLIST\r\n  TABLE (\r\n   GRUPANA_ID    int,\r\n   GRUPANA_AD    VARCHAR(50) COLLATE Turkish_CI_AS,\r\n   GRUP_ID    int,\r\n   GRUP_AD    VARCHAR(50) COLLATE Turkish_CI_AS,\r\n   tarih      datetime,\r\n   depkod     varchar(50))\r\n   \r\n   if @VARTIP='marvardimas'\r\n   begin\r\n     SET @STK_TIP='markt'\r\n    \r\n   \r\n    if @Market_Stok_AltGrup=0\r\n       insert into @TB_TEMP_STOKLIST\r\n       (GRUPANA_ID,GRUPANA_AD,GRUP_ID,GRUP_AD,tarih,depkod)\r\n       select SK.grp1,'',grp.id,grp.ad,\r\n       max(cast(mv.tarih as float)+cast(mv.saat as datetime)),\r\n       mv.depkod\r\n       from marvardimas as mv\r\n       left join stokkart as sk on sk.sil=0 and sk.tip=@STK_TIP\r\n       left join grup as grp on grp.id=SK.grp1 and grp.sil=0\r\n       where mv.sil=0 \r\n       and mv.varno in (select * from CsvToSTR(@VARNIN))\r\n       group by SK.grp1,grp.id,grp.ad,mv.depkod\r\n   \r\n   \r\n    if @Market_Stok_AltGrup=1\r\n       insert into @TB_TEMP_STOKLIST\r\n       (GRUPANA_ID,GRUPANA_AD,GRUP_ID,GRUP_AD,tarih,depkod)\r\n       select SK.grp1,'',grp.id,grp.ad,\r\n       max(cast(mv.tarih as float)+cast(mv.saat as datetime)),\r\n       mv.depkod\r\n       from marvardimas as mv\r\n       left join stokkart as sk on sk.sil=0 and sk.tip=@STK_TIP\r\n       left join grup as grp on grp.id=\r\n       case when sk.grp3>0 then sk.grp3\r\n       when sk.grp2>0 then sk.grp2\r\n       when sk.grp1>0 then sk.grp1 end \r\n       and grp.sil=0\r\n       where mv.sil=0 \r\n       and mv.varno in (select * from CsvToSTR(@VARNIN))\r\n       group by SK.grp1,grp.id,grp.ad,mv.depkod\r\n     \r\n     \r\n       SELECT @MAX_TAR=max(tarih) from @TB_TEMP_STOKLIST\r\n       \r\n   end\r\n   \r\n\r\n  DECLARE @TB_TEMP_STOKMIKTAR_TUTAR\r\n  TABLE (\r\n   GRUPANA_ID    int,\r\n   GRUP_ID    int,\r\n   depkod     varchar(50),\r\n   miktar     FLOAT,\r\n   tutar      FLOAT)\r\n\r\n\r\n\r\n  if @Market_Stok_AltGrup=0\r\n    insert into @TB_TEMP_STOKMIKTAR_TUTAR\r\n     (GRUPANA_ID,GRUP_ID,depkod,miktar,tutar)\r\n     select SK.grp1,sk.grp1,h.depkod,ISNULL(SUM(h.giren-h.cikan),0),\r\n       ISNULL(SUM((h.giren-h.cikan)*case when sk.sat1kdvtip='Dahil' then sk.sat1fiy ELSE\r\n       sk.sat1fiy*(1+(sk.sat1kdv/100)) end),0) from stokkart as sk \r\n       left join stkhrk as h on h.stktip=sk.tip \r\n       and h.stkod=sk.kod and sk.tip=@STK_TIP and sk.sil=0 and h.sil=0 \r\n       AND  (h.tarih+cast(h.saat as datetime))<@MAX_TAR\r\n      group by sk.grp1,h.depkod\r\n\r\n\r\n\r\n   if @Market_Stok_AltGrup=1\r\n    insert into @TB_TEMP_STOKMIKTAR_TUTAR\r\n     (GRUPANA_ID,GRUP_ID,depkod,miktar,tutar)\r\n     select SK.grp1,case when sk.grp3>0 then sk.grp3\r\n       when sk.grp2>0 then sk.grp2\r\n       when sk.grp1>0 then sk.grp1 end,h.depkod,ISNULL(SUM(h.giren-h.cikan),0),\r\n       ISNULL(SUM((h.giren-h.cikan)*case when sk.sat1kdvtip='Dahil' then sk.sat1fiy ELSE\r\n       sk.sat1fiy*(1+(sk.sat1kdv/100)) end),0) from stokkart as sk \r\n       left join stkhrk as h on h.stktip=sk.tip \r\n       and h.stkod=sk.kod and sk.tip=@STK_TIP and sk.sil=0 and h.sil=0 \r\n       AND  (h.tarih+cast(h.saat as datetime))<@MAX_TAR\r\n      group by sk.grp1,sk.grp2,sk.grp3,h.depkod\r\n\r\n\r\n  IF @VARTIP='marvardimas'\r\n  begin\r\n   INSERT @TB_DEP_TARIH (GRUPANA_ID,GRUP_ID,GRUP_AD,DEP_KOD,MIKTAR,TUTAR)\r\n    SELECT\r\n       MV.GRUPANA_ID,mv.GRUP_ID,mv.GRUP_AD,mv.depkod,\r\n       ISNULL(SUM(miktar),0),ISNULL(SUM(tutar),0)\r\n       from @TB_TEMP_STOKLIST as mv\r\n       left join @TB_TEMP_STOKMIKTAR_TUTAR as sh on sh.depkod=mv.depkod\r\n       and sh.GRUP_ID=mv.GRUP_ID\r\n       group by MV.GRUPANA_ID,mv.GRUP_ID,mv.GRUP_AD,mv.depkod\r\n          \r\n    end\r\n\r\n\r\n   UPDATE @TB_DEP_TARIH SET GRUPANA_AD=dt.ad from @TB_DEP_TARIH\r\n   as t join (select * from grup ) dt on \r\n   dt.id=t.GRUPANA_ID\r\n   \r\n\r\n  RETURN\r\n  \r\n END"
  },
  {
    "schema": "dbo",
    "name": "DEPO_TARIHLI_ONCE_MIKTAR",
    "type": "SQL_SCALAR_FUNCTION",
    "full_name": "dbo.DEPO_TARIHLI_ONCE_MIKTAR",
    "definition": "CREATE FUNCTION [dbo].DEPO_TARIHLI_ONCE_MIKTAR (\r\n @depkod varchar(20),\r\n @TARIH1 datetime)\r\nRETURNS  FLOAT\r\nBEGIN\r\n\r\n  RETURN (select ISNULL(SUM(h.giren-h.cikan),0) from stkhrk as h\r\n where depkod=@depkod and sil=0\r\n AND tarih+cast(saat as datetime) <= @TARIH1)\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "DEPO_TARIHLI_STOK",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.DEPO_TARIHLI_STOK",
    "definition": "CREATE FUNCTION dbo.DEPO_TARIHLI_STOK(@depkod varchar(20),@stktip varchar(20),\r\n@stkod varchar(20),@TARIH1 datetime,@SAAT1 VARCHAR(8))\r\nRETURNS\r\n  @TB_DEP_TARIH TABLE (\r\n    MIKTAR     FLOAT,\r\n    TUTAR      FLOAT)\r\nBEGIN\r\nDECLARE @MIKTAR FLOAT\r\nDECLARE @TUTAR FLOAT\r\nDECLARE @BRMFIYAT FLOAT\r\n\r\n/*\r\nselect @BRMFIYAT=case when alskdvtip='Dahil' then alsfiy else\r\n(case when alskdv=0 then alsfiy else alsfiy*(1+(alsfiy/100)) end)\r\nend from stokkart where tip=@stktip and kod=@stkod\r\n*/\r\n\r\nif @depkod<>''\r\nselect @MIKTAR=ISNULL(SUM(h.giren-h.cikan),0),\r\n@TUTAR=ISNULL(SUM((h.giren-h.cikan)*h.brmfiykdvli),0) from stkhrk as h\r\nwhere depkod=@depkod and stktip=@stktip and stkod=@stkod and sil=0\r\n AND (tarih+cast(saat as datetime)) <= (@TARIH1+cast(@SAAT1 as datetime))\r\n\r\n\r\nif @depkod=''\r\nselect @MIKTAR=ISNULL(SUM(h.giren-h.cikan),0),\r\n@TUTAR=ISNULL(SUM((h.giren-h.cikan)*h.brmfiykdvli),0) from stkhrk as h\r\nwhere stktip=@stktip and stkod=@stkod and sil=0\r\n AND (tarih+cast(saat as datetime)) <= (@TARIH1+cast(@SAAT1 as datetime))\r\n\r\n  INSERT @TB_DEP_TARIH (MIKTAR,TUTAR)\r\n   VALUES (@MIKTAR,@TUTAR)\r\n\r\n  RETURN\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "DEPO_TARIHLI_STOKIN",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.DEPO_TARIHLI_STOKIN",
    "definition": "CREATE FUNCTION dbo.DEPO_TARIHLI_STOKIN \r\n(@VARTIP VARCHAR(20),@VARNIN VARCHAR(1000))\r\nRETURNS\r\n  @TB_DEP_TARIH TABLE (\r\n    VAR_NO     FLOAT,\r\n    DEP_KOD    VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    STOK_TIP   VARCHAR(10) COLLATE Turkish_CI_AS,\r\n    STOK_KOD   VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    MIKTAR     FLOAT,\r\n    TUTAR      FLOAT)\r\nBEGIN\r\n\r\n DECLARE @EKSTRE_TEMP TABLE (\r\n    VARNO      FLOAT)\r\n  declare @separator char(1) \r\n  set @separator = ','\r\n\r\n  declare @separator_position int\r\n  declare @array_value varchar(1000)\r\n\r\n IF (LEN(RTRIM(@VARNIN)) > 0)\r\n BEGIN\r\n  set @VARNIN = @VARNIN + ','\r\n END\r\n\r\n while patindex('%,%' , @VARNIN) <> 0\r\n begin\r\n\r\n   select @separator_position =  patindex('%,%' , @VARNIN)\r\n   select @array_value = left(@VARNIN, @separator_position - 1)\r\n\r\n  Insert @EKSTRE_TEMP\r\n  Values (Cast(@array_value as float))\r\n  select @VARNIN = stuff(@VARNIN, 1, @separator_position, '')\r\n end\r\n\r\n  DECLARE @TB_TEMP_STOKLIST\r\n  TABLE (\r\n   tarih  datetime,\r\n   depkod varchar(50) COLLATE Turkish_CI_AS,\r\n   stktip varchar(20) COLLATE Turkish_CI_AS,\r\n   stkkod varchar(50) COLLATE Turkish_CI_AS )\r\n   \r\n   if @VARTIP='marvardimas'\r\n   begin\r\n       insert into @TB_TEMP_STOKLIST\r\n       (tarih,depkod,stktip,stkkod)\r\n       select max(cast(mv.tarih as float)+cast(mv.saat as datetime)),\r\n       mv.depkod,mhk.stktip,mhk.stkod\r\n       from marvardimas as mv\r\n       inner join marsathrk as mhk on mhk.varno=mv.varno\r\n       and mv.sil=0 and mhk.sil=0\r\n       and mv.varno in (select varno from @EKSTRE_TEMP)\r\n       group by mv.depkod,mhk.stktip,mhk.stkod\r\n   end\r\n   \r\n   if @VARTIP='pomvardimas'\r\n   begin\r\n       insert into @TB_TEMP_STOKLIST\r\n       (tarih,depkod,stktip,stkkod)\r\n       select max(cast(p.tarih as float)+cast(p.saat as datetime)),\r\n       ps.tankod,ps.stktip,ps.stkod\r\n       from  pomvardisayac as ps\r\n       inner join pomvardimas as p on ps.varno=p.varno\r\n       and p.sil=0 and ps.perkod='Diger'\r\n       and ps.varno in (select varno from @EKSTRE_TEMP)\r\n       group by ps.tankod,ps.stktip,ps.stkod\r\n   end\r\n   \r\n  DECLARE @VAR_NO   FLOAT\r\n  DECLARE @DEP_KOD  VARCHAR(50)\r\n  DECLARE @STOK_TIP VARCHAR(10)\r\n  DECLARE @STOK_KOD VARCHAR(50)\r\n  DECLARE @MIKTAR   FLOAT\r\n  DECLARE @TUTAR    FLOAT\r\n\r\n  IF @VARTIP='marvardimas'\r\n  begin\r\n    DECLARE CRS_DEPO_STOK_HRK CURSOR FAST_FORWARD FOR\r\n    SELECT\r\n       mv.depkod,sk.tip,sk.kod,ISNULL(SUM(h.giren-h.cikan),0),\r\n       ISNULL(SUM((h.giren-h.cikan)*case when sk.sat1kdvtip='Dahil' then \r\n       sk.sat1fiy ELSE\r\n        sk.sat1fiy*(1+(sk.sat1kdv/100)) end),0)\r\n       from @TB_TEMP_STOKLIST as mv\r\n       inner join stokkart as sk on sk.kod=mv.stkkod and sk.tip=mv.stktip\r\n       left join stkhrk as h on h.depkod=mv.depkod  and h.stktip=mv.stktip\r\n       and h.stkod=sk.kod and h.sil=0\r\n       AND (mv.tarih) >  (h.tarih+cast(h.saat as datetime))\r\n       group by mv.depkod,sk.tip,sk.kod\r\n    end\r\n       \r\n    IF @VARTIP='pomvardimas'\r\n    begin\r\n     DECLARE CRS_DEPO_STOK_HRK CURSOR FAST_FORWARD FOR\r\n     SELECT\r\n       ps.depkod,sk.tip,sk.kod,ISNULL(SUM(h.giren-h.cikan),0),\r\n       ISNULL(SUM((h.giren-h.cikan)*h.brmfiykdvli),0)\r\n       from @TB_TEMP_STOKLIST as ps\r\n       inner join stokkart as sk on sk.kod=ps.stkkod and sk.tip=ps.stktip\r\n       left join stkhrk as h on h.depkod=ps.depkod  and h.stktip=sk.tip\r\n       and h.stkod=sk.kod and h.sil=0\r\n       AND ps.tarih > cast(h.tarih as float)+cast(h.saat as datetime)\r\n       /*  (h.tarih+cast(h.saat as datetime)) */\r\n       group by ps.depkod,sk.tip,sk.kod\r\n     end\r\n     \r\n    OPEN CRS_DEPO_STOK_HRK\r\n    \r\n   FETCH NEXT FROM CRS_DEPO_STOK_HRK INTO\r\n   @DEP_KOD,@STOK_TIP,@STOK_KOD,@MIKTAR,@TUTAR\r\n   WHILE @@FETCH_STATUS = 0\r\n   BEGIN\r\n\r\n    INSERT @TB_DEP_TARIH (DEP_KOD,STOK_TIP,STOK_KOD,MIKTAR,TUTAR)\r\n    VALUES (@DEP_KOD,@STOK_TIP,@STOK_KOD,@MIKTAR,@TUTAR)\r\n\r\n   FETCH NEXT FROM CRS_DEPO_STOK_HRK INTO\r\n   @DEP_KOD,@STOK_TIP,@STOK_KOD,@MIKTAR,@TUTAR\r\n  END\r\n\r\n  CLOSE CRS_DEPO_STOK_HRK\r\n  DEALLOCATE CRS_DEPO_STOK_HRK\r\n\r\n\r\n  RETURN\r\n  \r\n END"
  },
  {
    "schema": "dbo",
    "name": "Epdk_Fatura_Liste",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.Epdk_Fatura_Liste",
    "definition": "CREATE FUNCTION dbo.Epdk_Fatura_Liste \r\n(@fattip varchar(100),\r\n@bastar  datetime,\r\n@bittar  datetime)\r\nRETURNS\r\n   \r\n   @TABLE_EPDK_FATURA TABLE (\r\n   id\t\t\t\t\t    int,   \r\n   fattip\t\t\t\t\tVARCHAR(20) COLLATE Turkish_CI_AS,\r\n   CariKod\t\t\t\t\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n   LisansNo\t\t\t\t\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n   Tarih\t\t\t\t\tdatetime,\r\n   Fat_Seri\t\t\t\t\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n   Fat_No\t\t\t\t\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n   Fat_SeriNo\t\t\t\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n   Stok_Kod\t\t\t\t\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n   Epdk_Yakit_Tur\t\t\tint,\r\n   Litre\t\t\t\t\tFloat)\r\n   \r\nAS\r\nBEGIN\r\n  \r\n\r\n    insert into @TABLE_EPDK_FATURA \r\n    (id,fattip,CariKod,LisansNo,Tarih,\r\n    Fat_Seri,Fat_No,Fat_SeriNo,Stok_Kod,Epdk_Yakit_Tur,Litre)\r\n    Select M.id,M.fattip,M.carkod,'',m.tarih,\r\n    m.fatseri,m.fatno,\r\n    cast(m.fatseri as varchar(20))+cast(m.fatno as varchar(20)),\r\n    h.stkod,s.Epdk_Tur,(h.mik*h.carpan)\r\n      \r\n    from faturamas as m WITH (NOLOCK)\r\n    inner join faturahrk as h WITH (NOLOCK) \r\n    on h.fatid=m.fatid\r\n    and h.sil=0 and m.sil=0 and m.fattip in (select * from CsvToSTR(@fattip))\r\n    and m.tarih>=@bastar and m.tarih<=@bittar\r\n    inner join Stokkart as s on S.kod=h.stkod\r\n    and s.tip='akykt' and s.sil=0 and S.Epdk_Tur>0 \r\n    Where m.cartip='carikart' \r\n    and ISNULL(m.entegre_tip,'')<>'EPDK' and h.stktip='akykt'\r\n    and M.carkod in \r\n    (select kod from carikart as k where k.sil=0 and k.Epdk_LisansNo<>'')\r\n    \r\n    \r\n    update @TABLE_EPDK_FATURA set LisansNo=dt.Epdk_LisansNo from @TABLE_EPDK_FATURA as t\r\n    join (select Kod,Epdk_LisansNo from carikart as c where c.sil=0 ) dt \r\n    on dt.Kod=t.CariKod\r\n\r\n    \r\n\r\n\r\n  return\r\n\r\n\r\n\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "Epdk_IRS_FAT_Liste",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.Epdk_IRS_FAT_Liste",
    "definition": "CREATE FUNCTION dbo.Epdk_IRS_FAT_Liste \r\n(@EntTip int,\r\n@fattip varchar(100),\r\n@bastar  datetime,\r\n@bittar  datetime)\r\nRETURNS\r\n   \r\n   @TABLE_EPDK_FATURA TABLE (\r\n   id\t\t\t\t\t    int,   \r\n   fattip\t\t\t\t\tVARCHAR(20) COLLATE Turkish_CI_AS,\r\n   CariKod\t\t\t\t\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n   LisansNo\t\t\t\t\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n   Tarih\t\t\t\t\tdatetime,\r\n   Fat_Seri\t\t\t\t\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n   Fat_No\t\t\t\t\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n   Fat_SeriNo\t\t\t\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n   Stok_Kod\t\t\t\t\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n   Epdk_Yakit_Tur\t\t\tint,\r\n   Litre\t\t\t\t\tFloat)\r\n   \r\nAS\r\nBEGIN\r\n  \r\n if @EntTip=0  \r\n    insert into @TABLE_EPDK_FATURA \r\n    (id,fattip,CariKod,LisansNo,Tarih,\r\n    Fat_Seri,Fat_No,Fat_SeriNo,Stok_Kod,Epdk_Yakit_Tur,Litre)\r\n    Select M.id,M.irtip,M.carkod,'',m.tarih,\r\n    m.irseri,m.irno,\r\n    cast(m.irseri as varchar(20))+cast(m.irno as varchar(20)),\r\n    h.stkod,s.Epdk_Tur,(h.mik*h.carpan)\r\n      \r\n    from irsaliyemas as m WITH (NOLOCK)\r\n    inner join irsaliyehrk as h WITH (NOLOCK) \r\n    on h.irid=m.irid\r\n    and h.sil=0 and m.sil=0 and m.irtip in (select * from CsvToSTR(@fattip))\r\n    and m.tarih>=@bastar and m.tarih<=@bittar\r\n    inner join Stokkart as s on S.kod=h.stkod\r\n    and s.tip='akykt' and s.sil=0 and S.Epdk_Tur>0 \r\n    Where m.cartip='carikart' \r\n    and ISNULL(m.entegre_tip,'')<>'EPDK' and h.stktip='akykt'\r\n    and M.carkod in \r\n    (select kod from carikart as k where k.sil=0 and k.Epdk_LisansNo<>'')\r\n      \r\n\r\n\r\n\r\n\r\n\r\n   if @EntTip=1  \r\n    insert into @TABLE_EPDK_FATURA \r\n    (id,fattip,CariKod,LisansNo,Tarih,\r\n    Fat_Seri,Fat_No,Fat_SeriNo,Stok_Kod,Epdk_Yakit_Tur,Litre)\r\n    Select M.id,M.fattip,M.carkod,'',m.tarih,\r\n    m.fatseri,m.fatno,\r\n    cast(m.fatseri as varchar(20))+cast(m.fatno as varchar(20)),\r\n    h.stkod,s.Epdk_Tur,(h.mik*h.carpan)\r\n      \r\n    from faturamas as m WITH (NOLOCK)\r\n    inner join faturahrk as h WITH (NOLOCK) \r\n    on h.fatid=m.fatid\r\n    and h.sil=0 and m.sil=0 and m.fattip in (select * from CsvToSTR(@fattip))\r\n    and m.tarih>=@bastar and m.tarih<=@bittar\r\n    inner join Stokkart as s on S.kod=h.stkod\r\n    and s.tip='akykt' and s.sil=0 and S.Epdk_Tur>0 \r\n    Where m.cartip='carikart' \r\n    and ISNULL(m.entegre_tip,'')<>'EPDK' and h.stktip='akykt'\r\n    and M.carkod in \r\n    (select kod from carikart as k where k.sil=0 and k.Epdk_LisansNo<>'')\r\n      \r\n \r\n    \r\n    update @TABLE_EPDK_FATURA set LisansNo=dt.Epdk_LisansNo from @TABLE_EPDK_FATURA as t\r\n    join (select Kod,Epdk_LisansNo from carikart as c where c.sil=0 ) dt \r\n    on dt.Kod=t.CariKod\r\n\r\n    \r\n\r\n\r\n  return\r\n\r\n\r\n\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "FATURA_BASLIK",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.FATURA_BASLIK",
    "definition": "CREATE FUNCTION dbo.FATURA_BASLIK(@fatid float)\r\nRETURNS\r\n @TB_FATURA_BASLIK TABLE (\r\n    FIRMA_NO         int,\r\n    FIRMA_UNVAN      VARCHAR(150) COLLATE Turkish_CI_AS,\r\n    FATURA_TIP       VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    FATURA_TUR       VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    FATURA_TARIH     DATETIME,\r\n    FATURA_TAR_GUN   INT,\r\n    FATURA_TAR_AY    INT,\r\n    FATURA_TAR_YIL   INT,\r\n    FATURA_VADETAR   DATETIME,\r\n    FATURA_SAAT      VARCHAR(10) COLLATE Turkish_CI_AS,\r\n    FATURA_SERI      VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    FATURA_ACIK      VARCHAR(200) COLLATE Turkish_CI_AS,\r\n    CARI_KOD         VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    CARI_UNVAN       VARCHAR(150) COLLATE Turkish_CI_AS,\r\n    CARI_FAT_UNVAN   VARCHAR(150) COLLATE Turkish_CI_AS,\r\n    CARI_ADRES       VARCHAR(100) COLLATE Turkish_CI_AS,\r\n    CARI_ADRES2      VARCHAR(100) COLLATE Turkish_CI_AS,\r\n    CARI_IL          VARCHAR(100) COLLATE Turkish_CI_AS,\r\n    CARI_ILCE        VARCHAR(100) COLLATE Turkish_CI_AS,\r\n    CARI_VERGIDAIRE  VARCHAR(100) COLLATE Turkish_CI_AS,\r\n    CARI_VERGINO     VARCHAR(100) COLLATE Turkish_CI_AS,\r\n    CARI_TEL\t\t VARCHAR(100) COLLATE Turkish_CI_AS,\r\n    CARI_EMAIL       VARCHAR(100) COLLATE Turkish_CI_AS,\r\n    CARI_TCNO        VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    CARI_PLAKA       VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    CARI_YKT_ALM_DEF VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    CARI_ARAC_AD     VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    CARI_FISBAKIYE   FLOAT,\r\n    CARI_CARBAKIYE   FLOAT,\r\n    CARI_TOPBAKIYE   FLOAT,\r\n    ARATOPLAM        FLOAT,\r\n    ISKONTOTOPLAMI   FLOAT,\r\n    ISKONTOLUTOPLAM  FLOAT,\r\n    KDV_TOPLAM       FLOAT,\r\n    TEVKIFAT_TOPLAM  FLOAT,\r\n    YUVARLAMATOP     FLOAT,\r\n    MATRAH_AK        FLOAT,\r\n    ISK_YUZDE_AK     FLOAT,\r\n    ISK_TUTAR_AK     FLOAT,\r\n    MATRAH_MR        FLOAT,\r\n    ISK_YUZDE_MR     FLOAT,\r\n    ISK_TUTAR_MR     FLOAT,\r\n    MATRAH_GL        FLOAT,\r\n    ISK_YUZDE_GL     FLOAT,\r\n    ISK_TUTAR_GL     FLOAT,\r\n    KDVSIZ_TOPLAM    FLOAT,\r\n    KDVLI_TOPLAM     FLOAT,\r\n    TOPLAM_YAZI      VARCHAR(150) COLLATE Turkish_CI_AS,\r\n    ISK1_YUZDE       FLOAT,\r\n    KDV0_TOPLAM      FLOAT,\r\n    KDV1_TOPLAM      FLOAT,\r\n    KDV8_TOPLAM      FLOAT,\r\n    KDV18_TOPLAM     FLOAT,\r\n    KDV26_TOPLAM     FLOAT,\r\n    YKFIS_NO         VARCHAR(8000) COLLATE Turkish_CI_AS,\r\n    IRSALIYE_NO      VARCHAR(8000) COLLATE Turkish_CI_AS,\r\n    VERFIS_NO\t\t VARCHAR(8000) COLLATE Turkish_CI_AS,\r\n    OTV_MIKTAR\t\t FLOAT,\r\n    OTV_TUTAR        FLOAT)\r\nAS\r\nBEGIN\r\n\r\n insert into @TB_FATURA_BASLIK (FIRMA_NO,\r\n FATURA_TIP,FATURA_TUR,FATURA_TARIH,\r\n  FATURA_TAR_GUN,FATURA_TAR_AY,FATURA_TAR_YIL,\r\n  FATURA_VADETAR,FATURA_SAAT,FATURA_SERI,FATURA_ACIK,\r\n  CARI_KOD,CARI_UNVAN,CARI_FAT_UNVAN,CARI_ADRES,CARI_ADRES2,CARI_IL,\r\n  CARI_ILCE,CARI_VERGIDAIRE,CARI_VERGINO,CARI_TCNO,CARI_TEL,CARI_EMAIL,\r\n  CARI_PLAKA,CARI_YKT_ALM_DEF,CARI_ARAC_AD,\r\n  CARI_FISBAKIYE,CARI_CARBAKIYE,CARI_TOPBAKIYE,\r\n  ARATOPLAM,ISKONTOTOPLAMI,\r\n  ISKONTOLUTOPLAM,KDV_TOPLAM,TEVKIFAT_TOPLAM,YUVARLAMATOP,\r\n  MATRAH_AK,ISK_YUZDE_AK,ISK_TUTAR_AK,\r\n  MATRAH_MR,ISK_YUZDE_MR,ISK_TUTAR_MR,\r\n  MATRAH_GL,ISK_YUZDE_GL,ISK_TUTAR_GL,\r\n  KDVSIZ_TOPLAM,KDVLI_TOPLAM,TOPLAM_YAZI,\r\n  KDV0_TOPLAM,KDV1_TOPLAM,KDV8_TOPLAM,KDV18_TOPLAM,KDV26_TOPLAM,ISK1_YUZDE,\r\n  YKFIS_NO,IRSALIYE_NO,\r\n  OTV_MIKTAR,OTV_TUTAR)\r\n\r\n SELECT ft.firmano,ft.fattip,ft.fattur,ft.tarih,\r\n DAY(ft.tarih),MONTH(ft.tarih),YEAR(ft.tarih),\r\n ft.vadtar,ft.saat,\r\n (ft.fatseri+ft.fatno),ft.ack,ck.kod,ck.ad,ck.fatunvan,ck.adres,ck.adres2,ck.evil,\r\n ck.evilce,ck.vergidaire,case when ck.vergino<>'' then ck.vergino else ck.tcno end,\r\n ck.tcno,ck.tel,ck.mail,\r\n ft.plaka,ck.ykt_alm_def_no,ck.Arac_Ad,\r\n ck.fisbak,ck.carbak,ck.topbak,\r\n (ft.genel_ara_top),\r\n (ft.genel_isk_top),(ft.genel_ara_top-(genel_isk_top)),\r\n (ft.kdvtop+ft.giderkdvtop),ft.genel_kdv_tevkifat_top,(ft.yuvtop),\r\n ft.ak_matrah,ft.ak_isk_yuz,ft.ak_isk_top,\r\n ft.mr_matrah,ft.mr_isk_yuz,ft.mr_isk_top,\r\n ft.gn_matrah,ft.geniskyuz,ft.genisktop,\r\n ((ft.genel_ara_top-(ft.genel_isk_top))+(ft.gidertop+yuvtop)),(ft.genel_top),\r\n DBO.ParaOku( ft.genel_top ),\r\n isnull((select sum(kdvtut*(mik)) from faturahrklistesi as h WITH (NOLOCK) where h.fatid=@fatid and h.sil=0 and h.kdvyuz=0),0),\r\n isnull((select sum(kdvtut*(mik)) from faturahrklistesi as h WITH (NOLOCK) where h.fatid=@fatid and h.sil=0 and h.kdvyuz=0.01),0),\r\n isnull((select sum(kdvtut*(mik)) from faturahrklistesi as h WITH (NOLOCK) where h.fatid=@fatid and h.sil=0 and h.kdvyuz=0.08),0),\r\n isnull((select sum(kdvtut*(mik)) from faturahrklistesi as h WITH (NOLOCK) where h.fatid=@fatid and h.sil=0 and h.kdvyuz=0.18),0),\r\n isnull((select sum(kdvtut*(mik)) from faturahrklistesi as h WITH (NOLOCK) where h.fatid=@fatid and h.sil=0 and h.kdvyuz=0.26),0),\r\n round((ft.genel_isk_top/ft.fattop)*100,2),\r\n ft.ykfisno,FT.irs_no,\r\n isnull((select sum((mik)) from faturahrklistesi as h WITH (NOLOCK) where h.fatid=@fatid and h.sil=0 and h.otv_carpan>0),0),\r\n isnull((select sum((mik*h.otv_carpan)) from faturahrklistesi as h WITH (NOLOCK) where h.fatid=@fatid and h.sil=0 and h.otv_carpan>0),0)\r\n FROM  faturamas AS ft WITH (NOLOCK)\r\n INNER JOIN View_Cariler_Kart_Bakiye as ck WITH (NOLOCK)\r\n ON ck.kod=ft.carkod and ck.cartp=ft.cartip\r\n where fatid=@fatid\r\n \r\n declare @VERFIS_NO  varchar(8000)\r\n \r\n if (select count(*) from veresimas WITH (NOLOCK) where sil=0 and fatid=@fatid)<=500\r\n select  @VERFIS_NO=COALESCE(@VERFIS_NO+',','')+\r\n (seri+' '+no)  from veresimas  WITH (NOLOCK) where sil=0 and fatid=@fatid\r\n \r\n /*declare @VERFIS_NO  varchar(8000) */\r\n /*select  @VERFIS_NO=COALESCE(@VERFIS_NO+',','')+ir.irseri+cast(ir.irno as varchar(50)) from irsaliyemas as ir where sil=0 and fatid=@fatid */\r\n\r\n \r\n  update @TB_FATURA_BASLIK set FIRMA_UNVAN=dt.ad from @TB_FATURA_BASLIK as t \r\n  join (select id,ad from firma where sil=0 ) dt on dt.id=t.FIRMA_NO\r\n\r\n\r\n  update @TB_FATURA_BASLIK set VERFIS_NO=@VERFIS_NO\r\n\r\n\r\nRETURN\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "FATURA_GRS_HRK",
    "type": "SQL_INLINE_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.FATURA_GRS_HRK",
    "definition": "CREATE FUNCTION dbo.FATURA_GRS_HRK (@fatid float)\r\nRETURNS TABLE AS\r\nRETURN(\r\nselect TOP 100 PERCENT\r\nfhrk.*,\r\nsk.stktur as stktur,\r\n(sk.ad) stkad,\r\n(mik*\r\ncase when kesafet>0 then kesafet else 1 end) mikkg,\r\n(kdvyuz*100) as kdv,\r\n (case when kesafet>0 then brmfiy/kesafet \r\n else brmfiy end) as brmfiykg,\r\n((brmfiy*mik)+otvtut) tutar,\r\n((brmfiy*mik)+otvtut)*(1+kdvyuz) tutarkdv,\r\ndep.ad as depad from faturahrk as fhrk\r\ninner join gelgidlistok as sk on sk.kod=stkod and stktip=tip\r\nleft join Depo_Kart_Listesi as dep on dep.kod=depkod\r\nwhere fhrk.fatid=@fatid and fhrk.sil=0 order by fhrk.id )"
  },
  {
    "schema": "dbo",
    "name": "FATURA_HRK",
    "type": "SQL_INLINE_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.FATURA_HRK",
    "definition": "CREATE FUNCTION dbo.FATURA_HRK(@fatid float)\r\nRETURNS TABLE AS\r\nRETURN(select fhrk.stkod AS STOK_KOD,fhrk.barkod,\r\ngstk.ad as STOK_AD,gstk.Gtip AS GTIP,\r\n(fhrk.mik) MIKTAR,(fhrk.kdvyuz*100) as KDV,\r\nfhrk.brim AS STOK_BIRIM,\r\n(fhrk.brmfiy) BIRIM_FIYAT,\r\nfhrk.satiskyuz as ISKONTO_YUZDE,\r\n(fhrk.brmfiy)*(1+fhrk.kdvyuz) BIRIM_FIYATKDVLI,\r\n((fhrk.brmfiy*fhrk.mik)+otvtut) TUTAR,\r\n((fhrk.brmfiy*fhrk.mik)+otvtut)*(1+fhrk.kdvyuz) TUTARKDVLI\r\nfrom faturahrk AS fhrk WITH (NOLOCK) \r\ninner join gelgidlistok as gstk WITH (NOLOCK) \r\non gstk.kod=fhrk.stkod\r\nand fhrk.stktip=gstk.tip where fhrk.fatid=@fatid and fhrk.sil=0 )"
  },
  {
    "schema": "dbo",
    "name": "FATURA_HRK_SATIS",
    "type": "SQL_INLINE_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.FATURA_HRK_SATIS",
    "definition": "CREATE FUNCTION dbo.[FATURA_HRK_SATIS](@fatid float)\r\nRETURNS TABLE AS\r\nRETURN(\r\nselect fhrk.stkod AS STOK_KOD,fhrk.barkod,\r\ngstk.ad as STOK_AD,\r\n(fhrk.mik) MIKTAR,(fhrk.kdvyuz*100) as KDV,\r\nfhrk.brim AS STOK_BIRIM,\r\n((fhrk.brmfiy+fhrk.otvbrim)-(fhrk.satisktut+fhrk.genisktut)) BIRIM_FIYAT,\r\n((fhrk.brmfiy+fhrk.otvbrim)-(fhrk.satisktut+fhrk.genisktut))*(1+fhrk.kdvyuz) BIRIM_FIYATKDVLI,\r\n((fhrk.brmfiy+fhrk.otvbrim)-(fhrk.satisktut+fhrk.genisktut))*fhrk.mik TUTAR,\r\n((fhrk.brmfiy+fhrk.otvbrim)-(fhrk.satisktut+fhrk.genisktut))*(1+fhrk.kdvyuz)*fhrk.mik TUTARKDVLI,\r\ncase when gstk.sat1kdvtip='Dahil' then  sat1fiy \r\nelse gstk.sat1fiy*(1+(gstk.sat1kdv/100)) END SAT_BIRIM_FIYATKDVLI,\r\n\r\nfhrk.mik*case when gstk.sat1kdvtip='Dahil' then  sat1fiy \r\nelse gstk.sat1fiy*(1+(gstk.sat1kdv/100)) END SAT_TUTARKDVLI,\r\n\r\n\r\n\r\n -1*round( (1-((case when gstk.sat1kdvtip='Dahil' then  sat1fiy else gstk.sat1fiy*(1+(gstk.sat1kdv/100)) END) / \r\n (case when ((fhrk.brmfiy+fhrk.otvbrim)-(fhrk.satisktut+fhrk.genisktut))*(1+fhrk.kdvyuz)=0 then\r\n 1 else ((fhrk.brmfiy+fhrk.otvbrim)-(fhrk.satisktut+fhrk.genisktut))*(1+fhrk.kdvyuz) end)))*100,2) KAR_YUZDE\r\n\r\n\r\nfrom faturahrk AS fhrk WITH (NOLOCK) \r\ninner join gelgidlistok as gstk WITH (NOLOCK) \r\non gstk.kod=fhrk.stkod\r\nand fhrk.stktip=gstk.tip \r\nwhere fhrk.fatid=@fatid and fhrk.sil=0 )"
  },
  {
    "schema": "dbo",
    "name": "FATURA_OTV_HRK",
    "type": "SQL_INLINE_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.FATURA_OTV_HRK",
    "definition": "CREATE FUNCTION dbo.[FATURA_OTV_HRK](@fatid float)\r\nRETURNS TABLE AS\r\nRETURN(select fhrk.stkod AS STOK_KOD,fhrk.barkod,\r\ngstk.ad as STOK_AD,\r\n(fhrk.mik) MIKTAR,\r\nfhrk.Otv_Carpan as OTV_CARPAN,\r\n(fhrk.kdvyuz*100) as KDV,\r\nfhrk.brim AS STOK_BIRIM,\r\n(fhrk.brmfiy) BIRIM_FIYAT,\r\n(fhrk.brmfiy)*(1+fhrk.kdvyuz) BIRIM_FIYATKDVLI,\r\n((fhrk.Otv_Carpan*fhrk.mik)) OTV_TUTAR\r\nfrom faturahrk AS fhrk with (nolock) \r\ninner join gelgidlistok as gstk WITH (NOLOCK) \r\non gstk.kod=fhrk.stkod\r\nand fhrk.stktip=gstk.tip \r\nwhere fhrk.fatid=@fatid and fhrk.sil=0 and fhrk.Otv_Carpan>0 )"
  },
  {
    "schema": "dbo",
    "name": "FATURA_STOK_DURUM",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.FATURA_STOK_DURUM",
    "definition": "CREATE FUNCTION FATURA_STOK_DURUM(\r\n@firmano int,\r\n@MEV_CHK int,\r\n@BASTAR DATETIME,@BITTAR DATETIME,\r\n@FATIN VARCHAR(200),\r\n@ZRAPIN VARCHAR(200),\r\n@AKSTKIN \t\tVARCHAR(8000),\r\n@MARSTKGRPIN  \tVARCHAR(8000),\r\n@GELSTKIN  \t\tVARCHAR(8000),\r\n@VERIN          VARCHAR(8000))\r\nRETURNS\r\n  @TB_FAT_STK_DRM TABLE (\r\n    ACK                  VARCHAR(150) COLLATE Turkish_CI_AS,\r\n    STOK_TIP             VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    DEVIR_MIK            FLOAT,\r\n    DEVIR_TUT            FLOAT,\r\n    DEVIR_KDV            FLOAT,\r\n    ALIS_MIK             FLOAT,\r\n    ALIS_TUT             FLOAT,\r\n    ALIS_KDV             FLOAT,\r\n    SATIS_MIK            FLOAT,\r\n    SATIS_TUT            FLOAT,\r\n    SATIS_KDV            FLOAT,\r\n    ALS_SAT_KDV          FLOAT,\r\n    KES_MIK              FLOAT,\r\n    KES_TUT              FLOAT,\r\n    KES_KDV              FLOAT,\r\n    MEV_MIK              FLOAT,\r\n    MEV_TUT              FLOAT,\r\n    MEV_KDV              FLOAT)\r\nAS\r\nBEGIN\r\n\r\n   DECLARE  @EXTRA_FAT_STK_DRM TABLE (\r\n    STOK_GRUP            VARCHAR(150) COLLATE Turkish_CI_AS,\r\n    STOK_TIP             VARCHAR(10) COLLATE Turkish_CI_AS,\r\n    STOK_GENKOD          VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    DEVIR_MIK            FLOAT,\r\n    DEVIR_TUT            FLOAT,\r\n    DEVIR_KDV            FLOAT,\r\n    ALIS_MIK             FLOAT,\r\n    ALIS_TUT             FLOAT,\r\n    ALIS_KDV             FLOAT,\r\n    SATIS_MIK            FLOAT,\r\n    SATIS_TUT            FLOAT,\r\n    SATIS_KDV            FLOAT,\r\n    ALS_SAT_KDV          FLOAT,\r\n    KES_MIK              FLOAT,\r\n    KES_TUT              FLOAT,\r\n    KES_KDV              FLOAT,\r\n    MEV_MIK              FLOAT,\r\n    MEV_TUT              FLOAT,\r\n    MEV_KDV              FLOAT)\r\n\r\n\r\n\r\n  DECLARE @EKSTRE_TEMP TABLE (\r\n  Firmano\t\t  int,\r\n  TIP             VARCHAR(1)  COLLATE Turkish_CI_AS,\r\n  STOK_GENKOD     VARCHAR(30)  COLLATE Turkish_CI_AS,\r\n  STOK_TIP        VARCHAR(10)  COLLATE Turkish_CI_AS,\r\n  STOK_MIK        FLOAT,\r\n  STOK_MATRAH     FLOAT,\r\n  TARIH           DATETIME,\r\n  KDV_ORAN        FLOAT,\r\n  MATRAH          FLOAT,\r\n  KDV_TUTAR       FLOAT)\r\n\r\n\r\n  insert into @EKSTRE_TEMP (Firmano,TIP,STOK_TIP,STOK_GENKOD,STOK_MIK,\r\n  TARIH,STOK_MATRAH,KDV_TUTAR,KDV_ORAN)\r\n  SELECT m.firmano,t.gc,h.stktip,h.stkod,h.mik,\r\n  m.tarih,isnull(((h.brmfiy-(h.satisktut+h.genisktut))*mik),0),\r\n  h.kdvtut*mik,h.kdvyuz\r\n  from faturahrklistesi as h with (nolock)\r\n  inner join faturamas as m with (nolock) on m.fatid=h.fatid\r\n  and h.sil=0 and m.sil=0 and h.satirtip='S'\r\n  inner join fattip as t with (nolock) on t.kod=m.fattip and t.tip='FAT'\r\n  inner join raporlar as r with (nolock) on t.kod=r.rapkod \r\n  and m.fatrap_id=r.id  where h.kdvyuz>0 and m.fatrap_id \r\n   in (select * from CsvToSTR(@FATIN))\r\n   and m.firmano in (select * from FirmaList_Ver(@firmano)) \r\n  \r\n  /*veresiye */\r\n  insert into @EKSTRE_TEMP (Firmano,TIP,STOK_TIP,STOK_GENKOD,STOK_MIK,\r\n  TARIH,STOK_MATRAH,KDV_TUTAR,KDV_ORAN)\r\n  SELECT m.firmano,t.gc,h.stktip,h.stkod,h.mik,\r\n  m.tarih,isnull(((h.brmfiy*(1-(h.iskyuz/100)))*mik),0),\r\n  isnull(((h.brmfiy*(1-(h.iskyuz/100)))*mik),0)/(1+(h.kdvyuz/100)),h.kdvyuz\r\n  from veresihrk as h with (nolock)\r\n  inner join veresimas as m with (nolock) on m.verid=h.verid\r\n  and h.sil=0 and m.sil=0  and m.aktip='BK'\r\n  inner join fattip as t with (nolock) on t.kod=m.fistip and t.tip='FIS'\r\n  inner join raporlar as r with (nolock) on t.kod=r.rapkod \r\n  and m.fisrap_id=r.id  where h.kdvyuz>0 and m.fisrap_id \r\n   in (select * from CsvToSTR(@VERIN))\r\n   and m.firmano in (select * from FirmaList_Ver(@firmano)) \r\n  \r\n  \r\n /* update @EKSTRE_TEMP set STOK_GRP=STOK_KOD */\r\n /* where STOK_TIP in ('akykt','gelgid') */\r\n  \r\n  update @EKSTRE_TEMP set STOK_GENKOD=\r\n  case when k.grp3>0 then k.grp3\r\n  when k.grp2>0 then k.grp2\r\n  when k.grp1>0 then k.grp1 end\r\n  from @EKSTRE_TEMP as t inner join stokkart as k with (nolock)\r\n  on k.kod=t.STOK_GENKOD and t.STOK_TIP='markt'\r\n  and t.STOK_TIP ='markt'\r\n\r\n  \r\n  insert into @EKSTRE_TEMP (Firmano,TIP,STOK_TIP,STOK_GENKOD,STOK_MIK,\r\n  TARIH,STOK_MATRAH,KDV_TUTAR,KDV_ORAN)\r\n  SELECT m.firmano,'C',h.tip,h.kod,h.miktar,m.tarih,\r\n  ((h.brmfiy*h.miktar)/(1+h.kdvyuz)),\r\n  (h.brmfiy*h.miktar)-((h.brmfiy*h.miktar)/(1+h.kdvyuz)),\r\n  h.kdvyuz\r\n  from zraporhrk as h with (nolock)\r\n  inner join zrapormas as m with (nolock) on m.zrapid=h.zrapid\r\n  and h.sil=0 and m.sil=0 \r\n  /*inner join fattip as t on t.kod=m.zraptip and t.tip='ZRP' */\r\n  where h.kdvyuz>0 and m.zraptip in (select * from CsvToSTR(@ZRAPIN))\r\n  and m.firmano in (select * from FirmaList_Ver(@firmano)) \r\n  \r\n  if @Firmano>0\r\n   delete from @EKSTRE_TEMP where firmano not in (@Firmano,0)\r\n  \r\n  \r\n  delete from @EKSTRE_TEMP\r\n  where STOK_TIP='akykt' and  STOK_GENKOD not in (select * from CsvToSTR(@AKSTKIN))\r\n\r\n  delete from @EKSTRE_TEMP\r\n  where STOK_TIP='gelgid' and STOK_GENKOD not in (select * from CsvToSTR(@GELSTKIN))\r\n  \r\n  delete from @EKSTRE_TEMP\r\n  where STOK_TIP='markt' and STOK_GENKOD not in (select * from CsvToSTR(@MARSTKGRPIN))\r\n  \r\n\r\n  \r\n  DECLARE @STK_TEMP TABLE (\r\n  STOK_TIP        VARCHAR(10)  COLLATE Turkish_CI_AS,\r\n  STOK_GENKOD     VARCHAR(30)  COLLATE Turkish_CI_AS,\r\n  STOK_GENAD      VARCHAR(100)  COLLATE Turkish_CI_AS,\r\n  MEV_MIKTAR      FLOAT,\r\n  SAT1_KDVLI      FLOAT,\r\n  SAT1_KDVSIZ     FLOAT,\r\n  SAT1_KDV        FLOAT)\r\n  \r\n  \r\n /*--geçiçi kod stok gruplu tablo */\r\n  insert into @STK_TEMP\r\n  (STOK_TIP,STOK_GENKOD,STOK_GENAD,MEV_MIKTAR,SAT1_KDVLI,\r\n  SAT1_KDVSIZ,SAT1_KDV)\r\n  select k.tip,\r\n  case when k.tip='akykt' then k.kod\r\n   when k.tip='gelgid' then  k.kod\r\n   when k.tip='markt' then  cast(g.id as varchar) end,\r\n  case when k.tip='akykt' then k.ad\r\n   when k.tip='gelgid' then  k.ad\r\n   when k.tip='markt' then  g.ad end,\r\n   k.mev_miktar,k.sat1fiykdvli,k.sat1fiykdvsiz,k.sat1kdv\r\n   FROM Stok_Kart_Listesi AS k\r\n  left join grup as g on g.id=case when k.grp3>0 then k.grp3\r\n   when k.grp2>0 then k.grp2\r\n   when k.grp1>0 then k.grp1 end \r\n  /* where k.firmano in (select * from FirmaList_Ver(@firmano))  */\r\n/*------------------------------------- */\r\n  \r\n  DECLARE @STK_DVR_TEMP TABLE (\r\n  STOK_TIP        VARCHAR(10)  COLLATE Turkish_CI_AS,\r\n  STOK_GENKOD     VARCHAR(30)  COLLATE Turkish_CI_AS,\r\n  STOK_MIK        FLOAT,\r\n  STOK_MATRAH     FLOAT,\r\n  STOK_KDVTUT     FLOAT)\r\n  \r\n  insert into @STK_DVR_TEMP\r\n  (STOK_TIP,STOK_GENKOD,STOK_MIK,STOK_MATRAH,STOK_KDVTUT)\r\n  select STOK_TIP,STOK_GENKOD,\r\n  ISNULL(sum(case when TIP='G' THEN\r\n  STOK_MIK ELSE -1*STOK_MIK END),0),\r\n  sum(case when TIP='G' THEN\r\n  STOK_MATRAH ELSE -1*STOK_MATRAH END),\r\n  sum(case when TIP='G' THEN\r\n  KDV_TUTAR ELSE -1*KDV_TUTAR END)\r\n  FROM\r\n  @EKSTRE_TEMP where TARIH<@BASTAR\r\n  GROUP BY STOK_TIP,STOK_GENKOD\r\n\r\n  \r\n\r\n   insert into @EXTRA_FAT_STK_DRM\r\n   (STOK_TIP,STOK_GENKOD,\r\n   ALIS_MIK,ALIS_TUT,ALIS_KDV,\r\n   SATIS_MIK,SATIS_TUT,SATIS_KDV)\r\n   select T.STOK_TIP,T.STOK_GENKOD,\r\n   sum(case when T.TIP='G' THEN T.STOK_MIK ELSE 0 END),\r\n   sum(case when T.TIP='G' THEN T.STOK_MATRAH ELSE 0 END),\r\n   sum(case when T.TIP='G' THEN T.KDV_TUTAR ELSE 0 END),\r\n   sum(case when T.TIP='C' THEN T.STOK_MIK ELSE 0 END),\r\n   sum(case when T.TIP='C' THEN T.STOK_MATRAH ELSE 0 END),\r\n   sum(case when T.TIP='C' THEN T.KDV_TUTAR ELSE 0 END)\r\n\r\n   from @EKSTRE_TEMP AS T WHERE\r\n   T.TARIH>=@BASTAR and T.TARIH <=@BITTAR\r\n   group by T.STOK_TIP,T.STOK_GENKOD\r\n\r\n\r\n   UPDATE @EXTRA_FAT_STK_DRM SET\r\n   DEVIR_MIK=dt.DEVIR_MIK ,\r\n   DEVIR_TUT=dt.DEVIR_TUT ,\r\n   DEVIR_KDV=dt.DEVIR_KDV\r\n   from @EXTRA_FAT_STK_DRM as t join\r\n   (select STOK_TIP,STOK_GENKOD,\r\n    isnull(sum(DVR.STOK_MIK),0) as DEVIR_MIK,\r\n   isnull(sum(DVR.STOK_MATRAH),0) as DEVIR_TUT,\r\n   isnull(sum(DVR.STOK_KDVTUT),0) as DEVIR_KDV\r\n   from @STK_DVR_TEMP AS DVR GROUP BY STOK_TIP,STOK_GENKOD)\r\n   dt on dt.STOK_TIP=T.STOK_TIP\r\n   AND dt.STOK_GENKOD=T.STOK_GENKOD\r\n\r\n   UPDATE @EXTRA_FAT_STK_DRM SET\r\n   STOK_GRUP=dt.STOK_GENAD,\r\n   ALS_SAT_KDV=ALIS_KDV-SATIS_KDV,\r\n   KES_MIK=isnull(DEVIR_MIK,0)+isnull(ALIS_MIK,0)-isnull(SATIS_MIK,0),\r\n   KES_TUT=isnull(DEVIR_TUT,0)+isnull(ALIS_TUT,0)-isnull(SATIS_TUT,0),\r\n   KES_KDV=isnull(DEVIR_KDV,0)+isnull(ALIS_KDV,0)-isnull(SATIS_KDV,0),\r\n   MEV_MIK=MEV_MIKTAR,\r\n   MEV_TUT=dt.MEV_MIKTAR*dt.SAT1_KDVLI,\r\n   MEV_KDV=(dt.MEV_MIKTAR*dt.SAT1_KDVSIZ)\r\n   *(case when dt.SAT1_KDV=0 then 0 else (dt.SAT1_KDV/100) end)\r\n   FROM @EXTRA_FAT_STK_DRM as t\r\n   join (select STOK_GENAD,\r\n   k.STOK_TIP,k.STOK_GENKOD,\r\n   k.MEV_MIKTAR,k.SAT1_KDVLI,\r\n   k.SAT1_KDVSIZ,k.SAT1_KDV\r\n   from @STK_TEMP AS k)\r\n   dt on t.STOK_TIP=DT.STOK_TIP\r\n   and t.STOK_GENKOD=dt.STOK_GENKOD\r\n  \r\n   if @MEV_CHK=0\r\n   insert into @TB_FAT_STK_DRM\r\n    (ACK,STOK_TIP,DEVIR_MIK,DEVIR_TUT,DEVIR_KDV,ALIS_MIK,ALIS_TUT,\r\n    ALIS_KDV,SATIS_MIK,SATIS_TUT,SATIS_KDV,ALS_SAT_KDV,\r\n    KES_MIK,KES_TUT,KES_KDV,MEV_MIK,MEV_TUT,MEV_KDV)\r\n    select STOK_GRUP,\r\n    CASE\r\n    WHEN STOK_TIP='akykt' then 'AKARYAKIT'\r\n    WHEN STOK_TIP='markt' then 'MARKET'\r\n    WHEN STOK_TIP='gelgid' then 'GELIR-GIDER' END,\r\n    isnull(sum(DEVIR_MIK),0),isnull(sum(DEVIR_TUT),0),isnull(sum(DEVIR_KDV),0),\r\n    isnull(sum(ALIS_MIK),0),isnull(sum(ALIS_TUT),0),isnull(sum(ALIS_KDV),0),\r\n    sum(SATIS_MIK),sum(SATIS_TUT),sum(SATIS_KDV),sum(ALS_SAT_KDV),\r\n    isnull(sum(KES_MIK),0),isnull(sum(KES_TUT),0),isnull(sum(KES_KDV),0),\r\n    isnull(sum(MEV_MIK),0),isnull(sum(MEV_TUT),0),isnull(sum(MEV_KDV),0) from @EXTRA_FAT_STK_DRM\r\n    group by STOK_TIP,STOK_GRUP ORDER BY STOK_TIP\r\n\r\n\r\n\r\n   if @MEV_CHK=1\r\n   insert into @TB_FAT_STK_DRM\r\n    (ACK,STOK_TIP,DEVIR_MIK,DEVIR_TUT,DEVIR_KDV,ALIS_MIK,ALIS_TUT,\r\n    ALIS_KDV,SATIS_MIK,SATIS_TUT,SATIS_KDV,ALS_SAT_KDV,\r\n    KES_MIK,KES_TUT,KES_KDV,MEV_MIK,MEV_TUT,MEV_KDV)\r\n    select STOK_GRUP,\r\n    CASE\r\n    WHEN STOK_TIP='akykt' then 'AKARYAKIT'\r\n    WHEN STOK_TIP='markt' then 'MARKET'\r\n    WHEN STOK_TIP='gelgid' then 'GELIR-GIDER' END,\r\n    isnull(sum(DEVIR_MIK),0),isnull(sum(DEVIR_TUT),0),isnull(sum(DEVIR_KDV),0),\r\n    isnull(sum(ALIS_MIK),0),isnull(sum(ALIS_TUT),0),isnull(sum(ALIS_KDV),0),\r\n    sum(SATIS_MIK),sum(SATIS_TUT),sum(SATIS_KDV),sum(ALS_SAT_KDV),\r\n    isnull(sum(KES_MIK),0)-isnull(sum(MEV_MIK),0),\r\n    isnull(sum(KES_TUT),0)-isnull(sum(MEV_TUT),0),\r\n    isnull(sum(KES_KDV),0)-isnull(sum(MEV_KDV),0),\r\n    isnull(sum(MEV_MIK),0),isnull(sum(MEV_TUT),0),isnull(sum(MEV_KDV),0) from @EXTRA_FAT_STK_DRM\r\n    group by STOK_TIP,STOK_GRUP ORDER BY STOK_TIP\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n RETURN\r\n\r\n  \r\nEND"
  },
  {
    "schema": "dbo",
    "name": "FATURA_STOK_KONTROL",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.FATURA_STOK_KONTROL",
    "definition": "CREATE FUNCTION [dbo].[FATURA_STOK_KONTROL](\r\n@firmano int,\r\n@BASTAR DATETIME,@BITTAR DATETIME,\r\n@FATIN VARCHAR(200),\r\n@AKSTKIN \t\tVARCHAR(8000),\r\n@VERIN          VARCHAR(8000))\r\nRETURNS\r\n  @TB_FAT_STK_DRM TABLE (\r\n    ACK                  VARCHAR(150) COLLATE Turkish_CI_AS,\r\n    STOK_TIP             VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    SAYAC_MIK            FLOAT,\r\n    SAYAC_TUT            FLOAT,\r\n    SAYAC_KDV            FLOAT,\r\n    KES_MIK              FLOAT,\r\n    KES_TUT              FLOAT,\r\n    KES_KDV              FLOAT,\r\n    VER_MIK              FLOAT,\r\n    VER_TUT              FLOAT,\r\n    VER_KDV              FLOAT,    \r\n    MEV_MIK              FLOAT,\r\n    MEV_TUT              FLOAT,\r\n    MEV_KDV              FLOAT)\r\nAS\r\nBEGIN\r\n\r\n   DECLARE  @EXTRA_FAT_STK_DRM TABLE (\r\n    STOK_GRUP            VARCHAR(150) COLLATE Turkish_CI_AS,\r\n    STOK_TIP             VARCHAR(10) COLLATE Turkish_CI_AS,\r\n    STOK_GENKOD          VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    SAYAC_MIK            FLOAT,\r\n    SAYAC_TUT            FLOAT,\r\n    SAYAC_KDV            FLOAT,\r\n    KES_MIK              FLOAT,\r\n    KES_TUT              FLOAT,\r\n    KES_KDV              FLOAT,\r\n    VER_MIK              FLOAT,\r\n    VER_TUT              FLOAT,\r\n    VER_KDV              FLOAT,    \r\n    MEV_MIK              FLOAT,\r\n    MEV_TUT              FLOAT,\r\n    MEV_KDV              FLOAT)\r\n\r\n\r\n\r\n  DECLARE @EKSTRE_TEMP TABLE (\r\n  Firmano\t\t  int,\r\n  EVRAKTIP        VARCHAR(1)  COLLATE Turkish_CI_AS, \r\n  TIP             VARCHAR(1)  COLLATE Turkish_CI_AS,\r\n  STOK_GENKOD     VARCHAR(30)  COLLATE Turkish_CI_AS,\r\n  STOK_TIP        VARCHAR(10)  COLLATE Turkish_CI_AS,\r\n  STOK_MIK        FLOAT,\r\n  STOK_MATRAH     FLOAT,\r\n  TARIH           DATETIME,\r\n  KDV_ORAN        FLOAT,\r\n  MATRAH          FLOAT,\r\n  KDV_TUTAR       FLOAT)\r\n\r\n\r\n  insert into @EKSTRE_TEMP (Firmano,EVRAKTIP,TIP,STOK_TIP,STOK_GENKOD,STOK_MIK,\r\n  TARIH,STOK_MATRAH,KDV_TUTAR,KDV_ORAN)\r\n  SELECT m.firmano,'F',t.gc,h.stktip,h.stkod,h.mik,\r\n  m.tarih,\r\n  isnull(((h.brmfiy-(h.satisktut+h.genisktut))*mik),0),\r\n  h.kdvtut*mik,h.kdvyuz\r\n  from faturahrklistesi as h with (nolock)\r\n  inner join faturamas as m with (nolock) on m.fatid=h.fatid\r\n  and h.sil=0 and m.sil=0 and h.satirtip='S'\r\n  inner join fattip as t with (nolock) on t.kod=m.fattip and t.tip='FAT'\r\n  inner join raporlar as r with (nolock) on t.kod=r.rapkod \r\n  and m.fatrap_id=r.id  \r\n  where h.kdvyuz>0 and\r\n  m.tarih>=@BASTAR and m.tarih <=@BITTAR\r\n  and m.fatrap_id in (select * from CsvToSTR(@FATIN))\r\n  and m.firmano in (select * from FirmaList_Ver(@firmano))\r\n  \r\n  \r\n  /*veresiye */\r\n  insert into @EKSTRE_TEMP (Firmano,EVRAKTIP,TIP,STOK_TIP,STOK_GENKOD,STOK_MIK,\r\n  TARIH,STOK_MATRAH,KDV_TUTAR,KDV_ORAN)\r\n  SELECT m.firmano,'V',t.gc,h.stktip,h.stkod,h.mik,\r\n  m.tarih,isnull(((h.brmfiy*(1-(h.iskyuz/100)))*mik),0),\r\n  isnull(((h.brmfiy*(1-(h.iskyuz/100)))*mik),0)/(1+(h.kdvyuz/100)),\r\n  h.kdvyuz\r\n  from veresihrk as h\r\n  inner join veresimas as m  with (nolock) on m.verid=h.verid\r\n  and h.sil=0 and m.sil=0  and m.aktip='BK'\r\n  inner join fattip as t with (nolock) on t.kod=m.fistip and t.tip='FIS'\r\n  inner join raporlar as r with (nolock) on t.kod=r.rapkod \r\n  and m.fisrap_id=r.id  where h.kdvyuz>0 \r\n  and m.tarih>=@BASTAR and m.tarih <=@BITTAR\r\n  and m.fisrap_id in (select * from CsvToSTR(@VERIN))\r\n  and m.firmano in (select * from FirmaList_Ver(@firmano)) \r\n  \r\n  \r\n /*SAYAC SATIŞ */\r\n  insert into @EKSTRE_TEMP (Firmano,EVRAKTIP,TIP,STOK_TIP,STOK_GENKOD,STOK_MIK,\r\n  TARIH,STOK_MATRAH,KDV_TUTAR,KDV_ORAN)\r\n  SELECT m.firmano,'S','C',h.stktip,h.stkod,h.cikan,\r\n  m.tarih,isnull(((h.brmfiykdvli*(1-(0/100)))*h.cikan),0),\r\n  isnull(((h.brmfiykdvli*(1-(0/100)))*h.cikan),0)/(1+(h.kdvyuz/100)),\r\n  h.kdvyuz\r\n  from stkhrk as h with (nolock)\r\n  inner join pomvardimas as m with (nolock) on m.varno=h.varno\r\n  and h.sil=0 and m.sil=0 and h.yertip='pomvardimas'\r\n  and h.stktip='akykt'\r\n  and h.tarih>=@BASTAR and h.tarih <=@BITTAR\r\n  and m.firmano in (select * from FirmaList_Ver(@firmano)) \r\n \r\n  \r\n    \r\n   \r\n  if @Firmano>0\r\n   delete from @EKSTRE_TEMP where firmano not in (@Firmano,0)\r\n  \r\n  \r\n  delete from @EKSTRE_TEMP\r\n  where STOK_TIP='akykt' and  STOK_GENKOD not in (select * from CsvToSTR(@AKSTKIN))\r\n\r\n \r\n\r\n  \r\n  DECLARE @STK_TEMP TABLE (\r\n  STOK_TIP        VARCHAR(10)  COLLATE Turkish_CI_AS,\r\n  STOK_GENKOD     VARCHAR(30)  COLLATE Turkish_CI_AS,\r\n  STOK_GENAD      VARCHAR(100)  COLLATE Turkish_CI_AS,\r\n  MEV_MIKTAR      FLOAT,\r\n  SAT1_KDVLI      FLOAT,\r\n  SAT1_KDVSIZ     FLOAT,\r\n  SAT1_KDV        FLOAT)\r\n  \r\n  \r\n /*--geçiçi kod stok gruplu tablo */\r\n  insert into @STK_TEMP\r\n  (STOK_TIP,STOK_GENKOD,STOK_GENAD,MEV_MIKTAR,SAT1_KDVLI,\r\n  SAT1_KDVSIZ,SAT1_KDV)\r\n  select k.tip,\r\n  case when k.tip='akykt' then k.kod\r\n   when k.tip='gelgid' then  k.kod\r\n   when k.tip='markt' then  cast(g.id as varchar) end,\r\n  case when k.tip='akykt' then k.ad\r\n   when k.tip='gelgid' then  k.ad\r\n   when k.tip='markt' then  g.ad end,\r\n   k.mev_miktar,k.sat1fiykdvli,k.sat1fiykdvsiz,k.sat1kdv\r\n   FROM\r\n  Stok_Kart_Listesi AS k\r\n  left join grup as g on g.id=case when k.grp3>0 then k.grp3\r\n   when k.grp2>0 then k.grp2\r\n   when k.grp1>0 then k.grp1 end\r\n   /*where k.firmano in (select * from FirmaList_Ver(@firmano))   */\r\n   /*------------------------------------- */\r\n  \r\n \r\n   insert into @EXTRA_FAT_STK_DRM\r\n   (STOK_TIP,STOK_GENKOD,\r\n   SAYAC_MIK,SAYAC_TUT,SAYAC_KDV,\r\n   KES_MIK,KES_TUT,KES_KDV,\r\n   VER_MIK,VER_TUT,VER_KDV)\r\n\r\n   select T.STOK_TIP,T.STOK_GENKOD,\r\n   sum(case when T.EVRAKTIP='S' THEN T.STOK_MIK ELSE 0 END),\r\n   sum(case when T.EVRAKTIP='S' THEN T.STOK_MATRAH ELSE 0 END),\r\n   sum(case when T.EVRAKTIP='S' THEN T.KDV_TUTAR ELSE 0 END),\r\n   \r\n   \r\n   sum(case when T.EVRAKTIP='F' THEN T.STOK_MIK ELSE 0 END),\r\n   sum(case when T.EVRAKTIP='F' THEN T.STOK_MATRAH ELSE 0 END),\r\n   sum(case when T.EVRAKTIP='F' THEN T.KDV_TUTAR ELSE 0 END),\r\n   sum(case when T.EVRAKTIP='V' THEN T.STOK_MIK ELSE 0 END),\r\n   sum(case when T.EVRAKTIP='V' THEN T.STOK_MATRAH ELSE 0 END),\r\n   sum(case when T.EVRAKTIP='V' THEN T.KDV_TUTAR ELSE 0 END)\r\n   \r\n\r\n   FROM @EKSTRE_TEMP AS T WHERE\r\n   T.TARIH>=@BASTAR and T.TARIH <=@BITTAR\r\n   group by T.STOK_TIP,T.STOK_GENKOD\r\n\r\n\r\n  \r\n   UPDATE @EXTRA_FAT_STK_DRM SET\r\n   STOK_GRUP=dt.STOK_GENAD,\r\n   MEV_MIK=SAYAC_MIK-(KES_MIK+VER_MIK),\r\n   MEV_TUT=SAYAC_TUT-(KES_TUT+VER_TUT),\r\n   MEV_KDV=SAYAC_KDV-(KES_KDV+VER_KDV)\r\n   FROM @EXTRA_FAT_STK_DRM as t\r\n   join (\r\n   select STOK_GENAD,STOK_TIP,STOK_GENKOD\r\n   from @STK_TEMP AS k)\r\n   dt on t.STOK_TIP=DT.STOK_TIP\r\n   and t.STOK_GENKOD=dt.STOK_GENKOD\r\n  \r\n  \r\n    insert into @TB_FAT_STK_DRM\r\n    (ACK,STOK_TIP,\r\n     SAYAC_MIK,SAYAC_TUT,SAYAC_KDV,\r\n     KES_MIK,KES_TUT,KES_KDV,\r\n     VER_MIK,VER_TUT,VER_KDV,\r\n     MEV_MIK,MEV_TUT,MEV_KDV)\r\n    select STOK_GRUP,\r\n    CASE\r\n    WHEN STOK_TIP='akykt' then 'AKARYAKIT'\r\n    WHEN STOK_TIP='markt' then 'MARKET'\r\n    WHEN STOK_TIP='gelgid' then 'GELIR-GIDER' END,\r\n    isnull(sum(SAYAC_MIK),0),isnull(sum(SAYAC_TUT),0),isnull(sum(SAYAC_KDV),0),\r\n    isnull(sum(KES_MIK),0),isnull(sum(KES_TUT),0),isnull(sum(KES_KDV),0),\r\n    isnull(sum(VER_MIK),0),isnull(sum(VER_TUT),0),isnull(sum(VER_KDV),0),\r\n    isnull(sum(MEV_MIK),0),isnull(sum(MEV_TUT),0),isnull(sum(MEV_KDV),0) \r\n    from @EXTRA_FAT_STK_DRM\r\n    group by STOK_TIP,STOK_GRUP ORDER BY STOK_TIP\r\n\r\n\r\n\r\n   \r\n\r\n\r\n\r\n\r\n RETURN\r\n\r\n  \r\nEND"
  },
  {
    "schema": "dbo",
    "name": "FATURAFIS_HRK",
    "type": "SQL_INLINE_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.FATURAFIS_HRK",
    "definition": "CREATE FUNCTION dbo.FATURAFIS_HRK(@fatid float)\r\nRETURNS TABLE AS\r\nRETURN(\r\nSELECT fishrk.stkod AS STOK_KOD,gstk.ad as STOK_AD,\r\nfis.plaka as PLAKA,fis.tarih AS TARIH,fis.saat AS SAAT,\r\nfis.ykno AS YKNO,seri+cast([no] as varchar) AS FISNO,\r\nfis.surucu as SURUCU,\r\nfishrk.brim as BIRIM,\r\nfishrk.mik as MIKTAR,fishrk.brmfiy as BRIMFIYAT,\r\nfishrk.mik*fishrk.brmfiy AS TUTAR,\r\nfis.ack as ACIKLAMA from faturamas as fat\r\ninner join veresimas as fis on fis.akid=fat.fatid\r\nand fis.aktip='FT' and fat.fatid=@fatid\r\ninner join veresihrk as fishrk on fishrk.verid=fis.verid and fishrk.sil=0\r\ninner join gelgidlistok as gstk on gstk.kod=fishrk.stkod and gstk.tip=fishrk.stktip)"
  },
  {
    "schema": "dbo",
    "name": "FirmaList_Ver",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.FirmaList_Ver",
    "definition": "CREATE FUNCTION dbo.FirmaList_Ver \r\n(@No int)\r\nRETURNS\r\n    @TB_FIRMA_NO TABLE (\r\n     No         FLOAT)\r\nAS\r\nBEGIN\r\n\r\n\r\n    if @No=0\r\n     insert into @TB_FIRMA_NO (NO)\r\n     select 0 union all SELECT id from firma\r\n   \r\n     if @No>0\r\n     insert into @TB_FIRMA_NO (NO)\r\n     select 0 union all SELECT id from firma where id in (@No)\r\n\r\n    return\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "Fn_Kod_Seri",
    "type": "SQL_SCALAR_FUNCTION",
    "full_name": "dbo.Fn_Kod_Seri",
    "definition": "CREATE FUNCTION [dbo].Fn_Kod_Seri \r\n(\r\n @DEGER varchar(50) \r\n )\r\n RETURNS   VARCHAR(50) \r\nAS\r\nBEGIN\r\n   \r\n  DECLARE @I \t\t   INT\r\n  DECLARE @NUMARA      FLOAT\r\n  DECLARE @SERI        VARCHAR(30)\r\n  DECLARE @UZUNLUK     INT\r\n  DECLARE @SERI_NO     VARCHAR(50)\r\n  \r\n  SET @SERI = ''\r\n  SET @SERI_NO =''\r\n  \r\n\r\n  IF CHARINDEX (',',@DEGER)>0\r\n   RETURN @SERI_NO\r\n\r\n  IF CHARINDEX (' ',@DEGER)>0\r\n   RETURN @SERI_NO\r\n\r\n\r\n  SET @I    = 1\r\n\r\n  WHILE @I <= LEN(@DEGER)\r\n  BEGIN\r\n    IF ( (SELECT ISNUMERIC(SUBSTRING(@DEGER,@I,1))) = 0 )\r\n    BEGIN\r\n      SET @SERI = @SERI + ( SELECT SUBSTRING(@DEGER,@I,1) )\r\n    END\r\n    ELSE\r\n    BEGIN\r\n/*     PRINT RIGHT(@DEGER,LEN(@DEGER) - @I + 1) */\r\n      IF ISNUMERIC(RIGHT(@DEGER,LEN(@DEGER) - @I + 1))=1\r\n      AND RIGHT(@DEGER,LEN(@DEGER) -@I + 1)>'0'\r\n      BEGIN\r\n      SET @UZUNLUK=LEN(@DEGER) - @I + 1\r\n      SELECT @NUMARA = CAST(RIGHT(@DEGER,LEN(@DEGER) - @I + 1) AS FLOAT)\r\n      BREAK\r\n      END\r\n    END\r\n\r\n    SET @I = @I + 1\r\n  END\r\n\r\n  set @NUMARA=isnull(@NUMARA,0)\r\n\r\n  set @UZUNLUK=isnull(@UZUNLUK,5)\r\n\r\n  SET @SERI_NO=@SERI+RIGHT('00000000000000000000' + CAST(@NUMARA + 1 AS VARCHAR(15)),@UZUNLUK) \r\n\r\n  RETURN @SERI_NO\r\n  \r\nEND"
  },
  {
    "schema": "dbo",
    "name": "Fn_Prom_Urun_Puan_Tip",
    "type": "SQL_SCALAR_FUNCTION",
    "full_name": "dbo.Fn_Prom_Urun_Puan_Tip",
    "definition": "CREATE FUNCTION [dbo].[Fn_Prom_Urun_Puan_Tip] (\r\n@id int\r\n)\r\nRETURNS varchar(50)\r\n AS\r\nBEGIN\r\ndeclare @SNC VARCHAR(50)\r\n\r\n SELECT @SNC=AD_TR FROM Prom_Urun_Puan_Tip WHERE id=@id\r\n\r\n RETURN @SNC \r\n \r\n \r\nEND"
  },
  {
    "schema": "dbo",
    "name": "Fn_Prom_Urun_Sat_Tip",
    "type": "SQL_SCALAR_FUNCTION",
    "full_name": "dbo.Fn_Prom_Urun_Sat_Tip",
    "definition": "CREATE FUNCTION [dbo].Fn_Prom_Urun_Sat_Tip (\r\n@id int\r\n)\r\nRETURNS varchar(50)\r\n AS\r\nBEGIN\r\ndeclare @SNC VARCHAR(50)\r\n\r\n SELECT @SNC=AD_TR FROM Prom_Urun_Sat_Tip WHERE id=@id\r\n\r\n RETURN @SNC \r\n \r\n \r\nEND"
  },
  {
    "schema": "dbo",
    "name": "Fn_Stok_Tip",
    "type": "SQL_SCALAR_FUNCTION",
    "full_name": "dbo.Fn_Stok_Tip",
    "definition": "CREATE FUNCTION [dbo].[Fn_Stok_Tip] (\r\n@id int\r\n)\r\nRETURNS varchar(50)\r\n AS\r\nBEGIN\r\ndeclare @SNC VARCHAR(50)\r\n\r\n SELECT @SNC=ack_Tr FROM Stk_Tip WHERE id=@id\r\n\r\n RETURN @SNC \r\n \r\n \r\nEND"
  },
  {
    "schema": "dbo",
    "name": "Fn_StokFifo",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.Fn_StokFifo",
    "definition": "CREATE FUNCTION [dbo].Fn_StokFifo (\r\n@Firmano    int,\r\n@Stok_Tip VARCHAR(20),\r\n@Stok_KodIn VARCHAR(8000),\r\n@Tarih DATETIME)\r\n/*@SonTarih DATETIME) */\r\nRETURNS\r\n   @FIFO_MALSTK TABLE (\r\n    STOK_GRUP         VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    STOK_TIP          VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    STOK_KOD          VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    STOK_AD           VARCHAR(150)  COLLATE Turkish_CI_AS,\r\n    MIKTAR      FLOAT,\r\n    BRMTUT             FLOAT)\r\nAS\r\nBEGIN\r\n\r\nDECLARE @STOKMALIYET_TEMP TABLE (\r\n    STOK_GRUP          \tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n    STOK_KOD    \t\tVARCHAR(30) COLLATE Turkish_CI_AS,\r\n    STOK_AD    \t\t\tVARCHAR(150)  COLLATE Turkish_CI_AS,\r\n    STOK_TIP    \t\tVARCHAR(20)  COLLATE Turkish_CI_AS,\r\n    ONCEKIMIKTAR      \tFLOAT,\r\n    ONCEKITUTAR       \tFLOAT,\r\n    ALISMIKTAR        \tFLOAT,\r\n    ALISTUTAR         \tFLOAT,\r\n    SATISMIKTAR        \tFLOAT,\r\n    SATISTUTAR         \tFLOAT,\r\n    MALIYETYUZDE       \tFLOAT,\r\n    SATISKAR           \tFLOAT,\r\n    ALISKAR            \tFLOAT,\r\n    DONEMSONUMIKTAR    \tFLOAT,\r\n    DONEMSONUTUTAR     \tFLOAT,\r\n    BRMTUT             \tFLOAT)\r\n\r\n/*FÄ°FO Ä°Ã‡Ä°N GIRIS TABLOSU */\r\nDECLARE @STOKHRK_TEMP TABLE (\r\n    ID           FLOAT,\r\n    STOK_KOD     VARCHAR(30),\r\n    STOK_AD      VARCHAR(150),\r\n    STOK_TIP     VARCHAR(20),\r\n    DEPOKOD      VARCHAR(20),\r\n    HRKTIP       VARCHAR(1),\r\n    MIKTAR       FLOAT,\r\n    BRMTUT       FLOAT,\r\n    CIKMIK       FLOAT,\r\n    TARIH        DATETIME)\r\n\r\n\r\n  DECLARE @ID              FLOAT\r\n  DECLARE @HRK_ID          FLOAT\r\n  DECLARE @HRK_STOK_KOD    VARCHAR(30)\r\n  DECLARE @HRK_STOK_TIP    VARCHAR(20)\r\n  DECLARE @HRK_HRKTIP      VARCHAR(30)\r\n  DECLARE @HRK_TARIH       DATETIME\r\n  DECLARE @HRK_MIKTAR      FLOAT\r\n  DECLARE @HRK_BRMTUT      FLOAT\r\n  DECLARE @HRK_CIKMIK      FLOAT\r\n  DECLARE @KALANMIK        FLOAT\r\n  DECLARE @DUSMIK          FLOAT\r\n\r\n\r\n  /*---Stok kartlarÄ± gecici tabloya atÄ±ldÄ± */\r\n  INSERT @STOKMALIYET_TEMP (STOK_GRUP,STOK_KOD,STOK_AD,STOK_TIP)\r\n  SELECT ST.tip,st.kod,ST.ad,ST.tip\r\n  from stokkart st with (NOLOCK)\r\n  where st.sil=0 and st.drm='Aktif' and st.tip=@Stok_Tip\r\n  and st.Kod in (select * from CsvToSTR(@Stok_KodIn) )\r\n  /*---Stok kartlarÄ± gecici tabloya atÄ±ldÄ± */\r\n\r\n/*---stokhrk kartlarÄ± gecici tabloya atÄ±ldÄ± */\r\n/*-GIRISLER */\r\n  INSERT @STOKHRK_TEMP (ID,STOK_KOD,STOK_TIP,DEPOKOD,TARIH,HRKTIP,MIKTAR,BRMTUT,CIKMIK)\r\n  SELECT S.id,s.stkod,S.stktip,S.depkod,S.tarih+cast(saat as datetime),'G',S.giren,S.brmfiykdvli,0\r\n  FROM stkhrk as s with (NOLOCK) \r\n  inner join @STOKMALIYET_TEMP as stkt on s.stkod=stkt.STOK_KOD\r\n  AND S.stktip=stkt.STOK_TIP and s.sil=0 and s.firmano in (0,@Firmano)\r\n  where s.giren>0 and (s.tarih <= @Tarih)\r\n  ORDER BY S.tarih+cast(saat as datetime)\r\n\r\n    /*----CIKISLAR */\r\n    DECLARE STM_HRK CURSOR FAST_FORWARD FOR\r\n    SELECT  S.id,s.stkod,S.stktip,'C',S.tarih+cast(saat as datetime),S.cikan\r\n    FROM stkhrk as s with (NOLOCK) inner join @STOKMALIYET_TEMP as stkt on s.stkod=stkt.STOK_KOD\r\n    AND S.stktip=stkt.STOK_TIP and s.sil=0 and s.firmano in (0,@Firmano)\r\n    where S.cikan>0 and (s.tarih <= @Tarih)\r\n    ORDER BY (S.tarih+cast(saat as datetime))\r\n\r\n   OPEN STM_HRK\r\n\r\n   FETCH NEXT FROM STM_HRK INTO\r\n   @HRK_ID,@HRK_STOK_KOD,@HRK_STOK_TIP,@HRK_HRKTIP,@HRK_TARIH,@HRK_CIKMIK\r\n   WHILE @@FETCH_STATUS = 0\r\n   BEGIN\r\n\r\n\r\n     WHILE @HRK_CIKMIK>0 \r\n     BEGIN\r\n     SET @HRK_BRMTUT=0\r\n     SET @KALANMIK=0\r\n\r\n     SELECT top 1 @ID=ID,@KALANMIK=ISNULL(MIKTAR-CIKMIK,0),@HRK_BRMTUT=ISNULL(BRMTUT,0)\r\n     FROM @STOKHRK_TEMP WHERE STOK_TIP=@HRK_STOK_TIP AND STOK_KOD=@HRK_STOK_KOD\r\n     AND (MIKTAR-CIKMIK)>0 AND HRKTIP='G' ORDER BY TARIH\r\n\r\n    \r\n     IF @KALANMIK=0\r\n     BEGIN\r\n       SET @DUSMIK=@HRK_CIKMIK\r\n     END\r\n     ELSE\r\n     BEGIN\r\n     IF @HRK_CIKMIK>@KALANMIK\r\n       SET @DUSMIK=@KALANMIK\r\n     ELSE\r\n       SET @DUSMIK=@HRK_CIKMIK\r\n     END\r\n    \r\n     /*-SET @DUSMIK=@HRK_CIKMIK */\r\n      INSERT @STOKHRK_TEMP (ID,STOK_KOD,STOK_TIP,HRKTIP,TARIH,MIKTAR,BRMTUT)\r\n      VALUES (@HRK_ID,@HRK_STOK_KOD,@HRK_STOK_TIP,'C',@HRK_TARIH,-1*@DUSMIK,@HRK_BRMTUT)\r\n\r\n      /*-------------------------------- */\r\n      UPDATE @STOKHRK_TEMP SET CIKMIK=CIKMIK+@DUSMIK WHERE ID=@ID\r\n\r\n      SET @HRK_CIKMIK=@HRK_CIKMIK-@DUSMIK\r\n\r\n    END;\r\n\r\n   FETCH NEXT FROM STM_HRK INTO\r\n   @HRK_ID,@HRK_STOK_KOD ,@HRK_STOK_TIP,@HRK_HRKTIP,@HRK_TARIH,@HRK_CIKMIK\r\n  END\r\n\r\n  CLOSE STM_HRK\r\n  DEALLOCATE STM_HRK\r\n\r\n\r\n \r\n\r\n  INSERT @FIFO_MALSTK (STOK_KOD,STOK_TIP,MIKTAR,BRMTUT)\r\n   select STOK_KOD,STOK_TIP,SUM(MIKTAR),\r\n   ISNULL( (CASE when SUM(MIKTAR)>0 then SUM(MIKTAR*BRMTUT)/sum(MIKTAR)  \r\n    ELSE 0 END  )  ,0) from @STOKHRK_TEMP\r\n    GROUP BY STOK_KOD,STOK_TIP\r\n    \r\n   \r\n    \r\nRETURN\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "GELGIDFIFODONEM",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.GELGIDFIFODONEM",
    "definition": "CREATE FUNCTION [dbo].GELGIDFIFODONEM (\r\n/*@firmano          \tint, */\r\n@KDVTIP \t\t\tVARCHAR(10),\r\n@STOK_TIP \t\t\tVARCHAR(20),\r\n@STOK_KOD \t\t\tVARCHAR(30),\r\n@TARIH1 \t\t\tDATETIME,\r\n@TARIH2 \t\t\tDATETIME)\r\nRETURNS\r\n   @FIFO_STK TABLE (\r\n    TARIH        \t\tDATETIME,\r\n    HRKTIP       \t\tVARCHAR(1)  COLLATE Turkish_CI_AS,\r\n    STOK_KOD    \t\tVARCHAR(30)  COLLATE Turkish_CI_AS,\r\n    STOK_AD    \t\t\tVARCHAR(150)   COLLATE Turkish_CI_AS,\r\n    STOK_TIP    \t\tVARCHAR(20)  COLLATE Turkish_CI_AS,\r\n    STOK_GRUP    \t\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n    DBASIMIKTAR  \t\tFLOAT DEFAULT 0,\r\n    DBASITUTAR   \t\tFLOAT DEFAULT 0,\r\n    ALISMIKTAR   \t\tFLOAT DEFAULT 0,\r\n    ALISTUTAR    \t\tFLOAT DEFAULT 0,\r\n    SATISMIKTAR  \t\tFLOAT DEFAULT 0,\r\n    SATISTUTAR   \t\tFLOAT DEFAULT 0,\r\n    SATISMALIYET \t\tFLOAT DEFAULT 0,\r\n    ALISKARTUTAR      \tFLOAT DEFAULT 0,\r\n    SATISKARTUTAR     \tFLOAT DEFAULT 0,\r\n    SATISKARYUZDE     \tFLOAT DEFAULT 0,\r\n    ALISKARYUZDE      \tFLOAT DEFAULT 0,\r\n    DONEMSONUMIKTAR   \tFLOAT DEFAULT 0,\r\n    DONEMSONUTUTAR    \tFLOAT DEFAULT 0,\r\n    BRMORTFIYAT       \tFLOAT DEFAULT 0,\r\n    SATISMIKTAR2        FLOAT DEFAULT 0,\r\n    SATISTUTAR2         FLOAT DEFAULT 0)\r\nAS\r\nBEGIN\r\n/*\r\n1= ALIS FIFO ORT\r\n2= SATIS FIFO ORT\r\n*/\r\n\r\n\r\nDECLARE @STOKFIFO_TEMP TABLE (\r\n    ID          \t\tFLOAT,\r\n    STOK_KOD    \t\tVARCHAR(30) COLLATE Turkish_CI_AS,\r\n    STOK_TIP    \t\tVARCHAR(20) COLLATE Turkish_CI_AS,\r\n    HRKTIP      \t\tVARCHAR(1)  COLLATE Turkish_CI_AS,\r\n    TARIH       \t\tDATETIME,\r\n    GIRMIKTAR    \t\tFLOAT,\r\n    GIRBRMTUT    \t\tFLOAT,\r\n    CIKMIKTAR    \t\tFLOAT,\r\n    CIKBRMTUT    \t\tFLOAT)\r\n\r\n  DECLARE @ID              FLOAT\r\n  DECLARE @HRK_ID          FLOAT\r\n  DECLARE @HRK_STOK_KOD    VARCHAR(30)\r\n  DECLARE @HRK_STOK_TIP    VARCHAR(10)\r\n  DECLARE @HRK_HRKTIP      VARCHAR(30)\r\n  DECLARE @HRK_TARIH       DATETIME\r\n  DECLARE @HRK_GIRMIKTAR    FLOAT\r\n  DECLARE @HRK_GIRBRMTUT    FLOAT\r\n  DECLARE @HRK_CIKMIKTAR    FLOAT\r\n  DECLARE @HRK_CIKBRMTUT    FLOAT\r\n\r\n  DECLARE @KALANMIK         FLOAT\r\n\r\n  DECLARE @DUSMIK           FLOAT\r\n\r\n  /*----GIRISLER */\r\n\r\n/*  if @firmano=0 */\r\n  if @KDVTIP='Dahil'\r\n  INSERT @FIFO_STK (STOK_KOD,STOK_TIP,STOK_AD,STOK_GRUP,\r\n  DBASIMIKTAR,DBASITUTAR,ALISMIKTAR,ALISTUTAR,SATISMIKTAR,SATISTUTAR,\r\n  SATISMALIYET,ALISKARTUTAR,ALISKARYUZDE,\r\n  SATISKARTUTAR,SATISKARYUZDE,DONEMSONUMIKTAR,\r\n  DONEMSONUTUTAR,BRMORTFIYAT)\r\n  SELECT k.kod,S.cartip,k.ad,gp.ad,\r\n  0,0,\r\n  isnull(case when SUM(s.borc-S.alacak) >0 then count(*) end,0),\r\n  isnull(case when SUM(s.borc-S.alacak) >0 then SUM(s.borc-S.alacak) end,0),\r\n  isnull(case when SUM(s.borc-S.alacak) <0 then count(*) end,0),\r\n  isnull(case when SUM(s.borc-S.alacak) <0 then SUM(s.borc-S.alacak) end,0),\r\n  isnull(case when SUM(s.borc-S.alacak) <0 then 0 else SUM(s.borc-S.alacak) end,0),\r\n  -1*isnull(SUM(s.borc-S.alacak),0),\r\n  isnull(case when SUM(s.borc-S.alacak) >0 then -100 else 100 end,0),\r\n  -1*isnull(SUM(s.borc-S.alacak),0),\r\n  isnull(case when SUM(s.borc-S.alacak) >0 then -100 else 100 end,0),\r\n  0,0,0\r\n  FROM gelgidkart as k with (NOLOCK)\r\n  left join carihrk as s with (NOLOCK)\r\n  on s.carkod=k.kod and s.sil=0\r\n  and (s.tarih >= @TARIH1)\r\n  and (s.tarih <= @TARIH2)\r\n  left join grup as gp with (NOLOCK) on gp.id=k.grp1\r\n  where s.carkod=@STOK_KOD AND S.cartip=@STOK_TIP\r\n  \r\n  group by k.kod,S.cartip,k.ad,gp.ad\r\n  \r\n  \r\n  if @KDVTIP='Hariç'\r\n  INSERT @FIFO_STK (STOK_KOD,STOK_TIP,STOK_AD,STOK_GRUP,\r\n  DBASIMIKTAR,DBASITUTAR,ALISMIKTAR,ALISTUTAR,SATISMIKTAR,SATISTUTAR,\r\n  SATISMALIYET,ALISKARTUTAR,ALISKARYUZDE,\r\n  SATISKARTUTAR,SATISKARYUZDE,DONEMSONUMIKTAR,\r\n  DONEMSONUTUTAR,BRMORTFIYAT)\r\n  SELECT k.kod,S.cartip,k.ad,gp.ad,\r\n  0,0,\r\n  isnull(case when SUM(s.borc-S.alacak) >0 then count(*) end,0),/*Alis Miktar */\r\n  isnull(case when SUM(s.borc-S.alacak) >0 then SUM((s.borc-S.alacak)/(1+(s.kdvyuz))) end,0),/*Alis Tutar */\r\n  isnull(case when SUM(s.borc-S.alacak) <0 then count(*) end,0),  /*Satis Miktar */\r\n  isnull(case when SUM(s.borc-S.alacak) <0 then SUM((s.borc-S.alacak)/(1+(s.kdvyuz))) end,0), /*Satis Tutar */\r\n  isnull(case when SUM(s.borc-S.alacak) <0 then 0 else SUM((s.borc-S.alacak)/(1+(s.kdvyuz))) end,0), /*Satis Maliyet */\r\n  -1*isnull(SUM((s.borc-S.alacak)/(1+(s.kdvyuz))),0),   /*AlisKarTutar */\r\n  isnull(case when SUM((s.borc-S.alacak)/(1+(s.kdvyuz))) >0 then -100 else 100 end,0), /*KarYuzde */\r\n  -1*isnull(SUM((s.borc-S.alacak)/(1+(s.kdvyuz))),0), \r\n  isnull(case when SUM((s.borc-S.alacak)/(1+(s.kdvyuz))) >0 then -100 else 100 end,0),\r\n  0,0,0\r\n  FROM gelgidkart as k with (NOLOCK)\r\n  left join carihrk as s with (NOLOCK)\r\n  on s.carkod=k.kod and s.sil=0\r\n  and (s.tarih >= @TARIH1)\r\n  and (s.tarih <= @TARIH2)\r\n  left join grup as gp with (NOLOCK) on gp.id=k.grp1\r\n  where s.carkod=@STOK_KOD AND S.cartip=@STOK_TIP\r\n  and s.islmtip+'_'+s.islmhrk <> 'GLG_FIK'\r\n  \r\n  group by k.kod,S.cartip,k.ad,gp.ad\r\n  \r\n  \r\n  \r\n   \r\n  \r\n   UPDATE @FIFO_STK SET SATISMIKTAR2=SATISMIKTAR,SATISTUTAR2=SATISTUTAR\r\n  \r\n \r\n  \r\nRETURN\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "Genel_Grup_Ad_Ver",
    "type": "SQL_SCALAR_FUNCTION",
    "full_name": "dbo.Genel_Grup_Ad_Ver",
    "definition": "CREATE FUNCTION [dbo].Genel_Grup_Ad_Ver \r\n(@grp1 int,@grp2 int,@grp3 int )\r\nRETURNS varchar(100)\r\nAS\r\nBEGIN\r\ndeclare @sonuc varchar(100) \r\n\r\n  select @sonuc=ad from grup \r\n  where id=case \r\n  when @grp3>0 then @grp3\r\n  when @grp2>0 then @grp2\r\n  when @grp1>0 then @grp1\r\n  end\r\n  \r\n  RETURN @sonuc\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "Genel_Rapor2",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.Genel_Rapor2",
    "definition": "CREATE FUNCTION dbo.Genel_Rapor2 (\r\n@Firmano int,\r\n@TARIH1 DATETIME,\r\n@TARIH2 DATETIME)\r\nRETURNS\r\n    @TB_GENEL_2 TABLE (\r\n    ID\t\t\tint IDENTITY(1, 1) NOT NULL,\r\n    GRP_ID\t\tint,\r\n    HESAP     VARCHAR(150)  COLLATE Turkish_CI_AS,\r\n    ACK     VARCHAR(150)  COLLATE Turkish_CI_AS,\r\n    GIREN      FLOAT,\r\n    CIKAN       FLOAT,\r\n    BAKIYE          FLOAT)\r\nAS\r\nBEGIN\r\n\r\n  INSERT @TB_GENEL_2 (GRP_ID,HESAP,ACK,GIREN,CIKAN,BAKIYE)\r\n  select 1,'AKARYAKIT GELİRLERİ','',\r\n  isnull(sum(h.cikan*h.brmfiykdvli),0),\r\n  0,/*isnull(sum(h.giren*h.brmfiykdvli),0), */\r\n  0\r\n  FROM  stokkart as st\r\n  inner join stkhrk as h on st.kod=h.stkod and h.stktip=st.tip\r\n  and h.sil=0 and st.sil=0\r\n  and h.tarih>=@TARIH1 and h.tarih<=@TARIH2\r\n  where st.tip='akykt'\r\n  \r\n  \r\n  INSERT @TB_GENEL_2 (GRP_ID,HESAP,ACK,GIREN,CIKAN,BAKIYE)\r\n  select 2,'MAKKET GELİRLERİ','',\r\n  isnull(sum(h.cikan*h.brmfiykdvli),0),\r\n  0,/*isnull(sum(h.giren*h.brmfiykdvli),0), */\r\n  0\r\n  FROM  stokkart as st\r\n  inner join stkhrk as h on st.kod=h.stkod and h.stktip=st.tip\r\n  and h.sil=0 and st.sil=0\r\n  and h.tarih>=@TARIH1 and h.tarih<=@TARIH2\r\n  where st.tip='markt'  \r\n  \r\n  \r\n  /*3 pompaci gelirleri */\r\n   INSERT @TB_GENEL_2 (GRP_ID,HESAP,ACK,GIREN,CIKAN,BAKIYE)\r\n   select 3,'POMPACI GELİRLERİ','',0,0,0 \r\n  \r\n  \r\n  \r\n  INSERT @TB_GENEL_2 (GRP_ID,HESAP,ACK,GIREN,CIKAN,BAKIYE)\r\n  select 4,k.ad,'',0,isnull(sum(h.giren),0),0\r\n  FROM poskart as k\r\n  inner join poshrk as h on k.kod=h.poskod and h.PosIsle=0\r\n  and k.sil=0 and h.tarih>=@TARIH1 and h.tarih<=@TARIH2 and h.sil=0\r\n  group by k.ad\r\n  \r\n  \r\n  \r\n  INSERT @TB_GENEL_2 (GRP_ID,HESAP,ACK,GIREN,CIKAN,BAKIYE)\r\n  select 5,h.carkod,'',isnull(sum(h.giren),0),0,0\r\n  FROM poskart as k\r\n  inner join poshrk as h on k.kod=h.poskod \r\n  and h.PosIsle=1 and h.carkod<>''\r\n  and k.sil=0 and h.tarih>=@TARIH1 and h.tarih<=@TARIH2 and h.sil=0\r\n  group by h.carkod\r\n  \r\n    \r\n  \r\n\r\n  INSERT @TB_GENEL_2 (GRP_ID,HESAP,ACK,GIREN,CIKAN,BAKIYE)\r\n  select 6,h.carkod,'',\r\n  ISNULL(SUM(case when fistip='FISALCSAT' THEN h.toptut-h.isktop else 0 end),0),\r\n  0,0\r\n  FROM veresimas as h\r\n  where h.sil=0 and h.tarih>=@TARIH1 and h.tarih<=@TARIH2 and h.sil=0\r\n  group by h.carkod\r\n  \r\n  \r\n   DELETE FROM @TB_GENEL_2 WHERE GIREN=0 and CIKAN=0 and GRP_ID=6\r\n  \r\n  \r\n   declare @Pos_Top1  float\r\n   declare @Pos_Top2  float\r\n     \r\n   select @Pos_Top1=sum(CIKAN) from @TB_GENEL_2 where GRP_ID=4\r\n   \r\n   select @Pos_Top2=isnull(sum(h.giren),0) FROM poskart as k\r\n   inner join poshrk as h on k.kod=h.poskod \r\n   and h.PosIsle=1 and k.sil=0 and \r\n   h.tarih>=@TARIH1 and h.tarih<=@TARIH2 and h.sil=0\r\n  \r\n    \r\n  \r\n  /*7 rapor farkı */\r\n  if ISNULL((@Pos_Top1-@Pos_Top2),0)>=0\r\n   INSERT @TB_GENEL_2 (GRP_ID,HESAP,ACK,GIREN,CIKAN,BAKIYE)\r\n   select 7,'RAPOR FARKLARI','',ISNULL((@Pos_Top1-@Pos_Top2),0),0,0\r\n   else\r\n   INSERT @TB_GENEL_2 (GRP_ID,HESAP,ACK,GIREN,CIKAN,BAKIYE)\r\n   select 7,'RAPOR FARKLARI','',0,-1*(@Pos_Top1-@Pos_Top2),0 \r\n  \r\n\r\n  \r\n  \r\n  INSERT @TB_GENEL_2 (GRP_ID,HESAP,ACK,GIREN,CIKAN,BAKIYE)\r\n  select 10,'VERESİYE FİŞİ','',\r\n  0,ISNULL(SUM(case when fistip='FISVERSAT' THEN h.toptut-h.isktop else 0 end),0),\r\n  0\r\n  FROM veresimas as h\r\n  where h.sil=0 and h.Ototag=0 \r\n  and h.tarih>=@TARIH1 and h.tarih<=@TARIH2 and h.sil=0\r\n  \r\n  \r\n  \r\n  INSERT @TB_GENEL_2 (GRP_ID,HESAP,ACK,GIREN,CIKAN,BAKIYE)\r\n  select 11,'TAŞITMATİK SATIŞLARI','',\r\n  0,ISNULL(SUM(case when fistip='FISVERSAT' THEN h.toptut-h.isktop else 0 end),0),\r\n  0\r\n  FROM veresimas as h\r\n  where h.sil=0 and h.Ototag=1 \r\n  and h.tarih>=@TARIH1 and h.tarih<=@TARIH2 and h.sil=0\r\n  \r\n  \r\n  \r\n  INSERT @TB_GENEL_2 (GRP_ID,HESAP,ACK,GIREN,CIKAN,BAKIYE)\r\n  select 12,'IST. TAŞITMATİK SATIŞLARI','',\r\n  0,ISNULL(SUM(case when fistip='FISVERSAT' THEN h.toptut-h.isktop else 0 end),0),\r\n  0\r\n  FROM veresimas as h\r\n  where h.sil=0 and h.Ototag=2 \r\n  and h.tarih>=@TARIH1 and h.tarih<=@TARIH2 and h.sil=0\r\n  \r\n  \r\n   /*13 Peşin SATIŞLAR */\r\n   INSERT @TB_GENEL_2 (GRP_ID,HESAP,ACK,GIREN,CIKAN,BAKIYE)\r\n   select 13,'PEŞİN SATIŞLAR','',0,0,0 \r\n   \r\n   \r\n    /*14 PROMOSYON GİDERLERİ */\r\n   INSERT @TB_GENEL_2 (GRP_ID,HESAP,ACK,GIREN,CIKAN,BAKIYE)\r\n   select 14,'PROMOSYON GİDERLERİ','',0,0,0 \r\n   \r\n   \r\n   /*15 GÜNLÜK GİDERLER */\r\n   INSERT @TB_GENEL_2 (GRP_ID,HESAP,ACK,GIREN,CIKAN,BAKIYE)\r\n   select 15,'GÜNLÜK GİDERLER','',0,0,0  \r\n     \r\n   \r\n   /*16 POMPACI AÇIK/FAZLA */\r\n   INSERT @TB_GENEL_2 (GRP_ID,HESAP,ACK,GIREN,CIKAN,BAKIYE)\r\n   select 16,'POMPACI AÇIK/FAZLA','',0,0,0  \r\n   \r\n   \r\n   \r\n  declare @Id int\r\n  declare @Giren float\r\n  declare @Cikan float\r\n  declare @Bakiye float\r\n  set @Bakiye=0\r\n  declare pom_var CURSOR FAST_FORWARD  FOR \r\n  select ID,GIREN,CIKAN from @TB_GENEL_2\r\n   open pom_var\r\n  fetch next from  pom_var into @Id,@Giren,@Cikan\r\n  while @@FETCH_STATUS=0\r\n   begin\r\n   set @Bakiye=@Bakiye+@Giren-@Cikan\r\n   \r\n   update @TB_GENEL_2 set  BAKIYE=@Bakiye where Id=@Id\r\n   \r\n   FETCH next from  pom_var into @Id,@Giren,@Cikan\r\n  end\r\n close Pom_Var\r\n deallocate pom_var\r\n   \r\n   \r\n\r\n   RETURN\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "grupad",
    "type": "SQL_SCALAR_FUNCTION",
    "full_name": "dbo.grupad",
    "definition": "CREATE FUNCTION dbo.grupad(@grpno1 int,@grpno2 int,@grpno3 int,@tabload varchar(30))\r\nRETURNS varchar(50)\r\nAS\r\nBEGIN\r\ndeclare @sonuc varchar(50)\r\n\r\nif @grpno3 > 0 \r\nselect @sonuc=ad from grup where tabload=@tabload and sr=2 and id=@grpno3;\r\nELSE\r\nbegin\r\nif (@grpno2 > 0) and (@grpno1>0)\r\nselect @sonuc=ad from grup where tabload=@tabload and sr=1 and id=@grpno2;\r\n\r\nif (@grpno1>0) and (@grpno2=0)\r\nselect @sonuc=ad from grup where tabload=@tabload and sr=0 and id=@grpno1;\r\nend;\r\n\r\nRETURN @sonuc;\r\n\r\n  \r\n  \r\nEND"
  },
  {
    "schema": "dbo",
    "name": "IRSALIYE_BASLIK",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.IRSALIYE_BASLIK",
    "definition": "CREATE FUNCTION dbo.IRSALIYE_BASLIK(@irid float)\r\nRETURNS\r\n @TB_IRSALIYE_BASLIK TABLE (\r\n    IRSALIYE_TIP     VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    IRSALIYE_TUR     VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    IRSALIYE_TARIH   DATETIME,\r\n    IRSALIYE_SAAT    VARCHAR(10) COLLATE Turkish_CI_AS,\r\n    IRSALIYE_SERI    VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    IRSALIYE_ACIK    VARCHAR(100) COLLATE Turkish_CI_AS,\r\n    CARI_UNVAN       VARCHAR(150) COLLATE Turkish_CI_AS,\r\n    CARI_ADRES       VARCHAR(100) COLLATE Turkish_CI_AS,\r\n    CARI_ADRES2      VARCHAR(100) COLLATE Turkish_CI_AS,\r\n    CARI_IL          VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    CARI_ILCE        VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    CARI_VERGIDAIRE  VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    CARI_VERGINO     VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    CARI_TEL \t\t VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    PLAKA\t\t\t VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    SOFOR\t\t\t VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    ACIKLAMA\t\t VARCHAR(150) COLLATE Turkish_CI_AS,\r\n    ARATOPLAM        FLOAT,\r\n    ISKONTOTOPLAMI   FLOAT,\r\n    ISKONTOLUTOPLAM  FLOAT,\r\n    KDV_TOPLAM       FLOAT,\r\n    YUVARLAMATOP     FLOAT,\r\n    KDVSIZ_TOPLAM    FLOAT,\r\n    KDVLI_TOPLAM     FLOAT,\r\n    TOPLAM_YAZI      VARCHAR(150) COLLATE Turkish_CI_AS,\r\n    KDV0_TOPLAM      FLOAT,\r\n    KDV1_TOPLAM      FLOAT,\r\n    KDV8_TOPLAM      FLOAT,\r\n    KDV18_TOPLAM     FLOAT)\r\nAS\r\nBEGIN\r\n\r\n insert into @TB_IRSALIYE_BASLIK (IRSALIYE_TIP,IRSALIYE_TUR,IRSALIYE_TARIH,\r\n IRSALIYE_SAAT,IRSALIYE_SERI,IRSALIYE_ACIK,\r\n CARI_UNVAN,CARI_ADRES,CARI_ADRES2,CARI_IL,\r\n CARI_ILCE,CARI_VERGIDAIRE,CARI_VERGINO,CARI_TEL,PLAKA,SOFOR,\r\n ACIKLAMA,ARATOPLAM,\r\n ISKONTOTOPLAMI,ISKONTOLUTOPLAM,KDV_TOPLAM,YUVARLAMATOP,\r\n KDVSIZ_TOPLAM,KDVLI_TOPLAM,TOPLAM_YAZI,\r\n KDV0_TOPLAM,KDV1_TOPLAM,KDV8_TOPLAM,KDV18_TOPLAM)\r\n\r\n SELECT ft.irtip,ft.irtur,ft.tarih,ft.saat,\r\n (ft.irseri+ft.irno),ft.ack,ck.ad,ck.adres,ck.adres2,ck.evil,\r\n ck.evilce,ck.vergidaire,ck.vergino,ck.tel,\r\n ft.plaka,ft.Sofor,ft.ack,\r\n (irtop),\r\n 0,/*(ft.satisktop+ft.genisktop), */\r\n 0,/*(fattop-(ft.satisktop+ft.genisktop)), */\r\n (genel_kdv_top),\r\n 0, /*(yuvtop), */\r\n (genel_top-genel_kdv_top),\r\n (genel_top),\r\n DBO.ParaOku(\r\n round( (genel_top),2)),\r\n isnull((select sum(kdvtut*(mik)) from irsaliyehrklistesi as h where h.irid=@irid and h.sil=0 and h.kdvyuz=0),0),\r\n isnull((select sum(kdvtut*(mik)) from irsaliyehrklistesi as h where h.irid=@irid and h.sil=0 and h.kdvyuz=0.01),0),\r\n isnull((select sum(kdvtut*(mik)) from irsaliyehrklistesi as h where h.irid=@irid and h.sil=0 and h.kdvyuz=0.08),0),\r\n isnull((select sum(kdvtut*(mik)) from irsaliyehrklistesi as h where h.irid=@irid and h.sil=0 and h.kdvyuz=0.18),0)\r\n \r\n FROM  irsaliyemas AS ft\r\n INNER JOIN Genel_Kart as ck\r\n ON ck.kod=ft.carkod and ck.cartp=ft.cartip\r\n where irid=@irid\r\n\r\n\r\nRETURN\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "IRSALIYE_HRK",
    "type": "SQL_INLINE_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.IRSALIYE_HRK",
    "definition": "CREATE FUNCTION dbo.IRSALIYE_HRK(@irid float)\r\nRETURNS TABLE AS\r\nRETURN(select fhrk.stkod AS STOK_KOD,gstk.ad as STOK_AD,\r\n(fhrk.mik) MIKTAR,(fhrk.kdvyuz*100) as KDV,\r\nfhrk.brim AS STOK_BIRIM,\r\n(fhrk.brmfiy) BIRIM_FIYAT,((fhrk.brmfiy*fhrk.mik)) TUTAR\r\nfrom irsaliyehrk AS fhrk\r\ninner join gelgidlistok as gstk on gstk.kod=fhrk.stkod\r\nand fhrk.stktip=gstk.tip where fhrk.irid=@irid and fhrk.sil=0 )"
  },
  {
    "schema": "dbo",
    "name": "KDV_DRUM_RAPORU",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.KDV_DRUM_RAPORU",
    "definition": "CREATE FUNCTION [dbo].KDV_DRUM_RAPORU (\r\n@firmano int,\t\r\n@BASTAR DATETIME,\r\n@BITTAR DATETIME,\r\n@FATTIPIN VARCHAR(2000),\r\n@ZTIPIN VARCHAR(100),\r\n@DEVIR INT)\r\nRETURNS\r\n  @TB_KDV_DRUM_EKSTRE TABLE (\r\n    ACK           VARCHAR(100)  COLLATE Turkish_CI_AS,\r\n    KDV_ORAN      FLOAT,\r\n    MATRAH        FLOAT,\r\n    KDV_TUTAR     FLOAT,\r\n    KDV_ODENEN    FLOAT,\r\n    KDV_TAHSIL    FLOAT,\r\n    TIP           VARCHAR(1)  COLLATE Turkish_CI_AS )\r\nBEGIN\r\n\r\n  DECLARE @EKSTRE_TEMP TABLE (\r\n  FirmaNo\t\t  int,\r\n  TIP            VARCHAR(1)  COLLATE Turkish_CI_AS,\r\n  ACK            VARCHAR(100)  COLLATE Turkish_CI_AS,\r\n  TARIH          DATETIME,\r\n  KDV_ORAN       FLOAT,\r\n  MATRAH         FLOAT,\r\n  KDV_TUTAR      FLOAT)\r\n\r\n\r\n\r\n  insert into @EKSTRE_TEMP (FirmaNo,TIP,ACK,TARIH,MATRAH,KDV_TUTAR,KDV_ORAN)\r\n  SELECT m.firmano,t.gc,r.ack,m.tarih,((h.brmfiy-(h.satisktut+h.genisktut))*mik),h.kdvtut*mik,h.kdvyuz\r\n  from faturahrklistesi as h\r\n  inner join faturamas as m on m.fatid=h.fatid\r\n  and h.sil=0 and m.sil=0 /*and h.satirtip='S' */\r\n  inner join fattip as t on \r\n  t.kod=m.fattip and t.tip='FAT' \r\n  inner join raporlar as r on t.kod=r.rapkod\r\n  and m.fatrap_id=r.id   \r\n  where h.kdvyuz>0 and m.fatrap_id\r\n  in (select * from CsvToSTR(@FATTIPIN))\r\n  \r\n  \r\n  if @ZTIPIN<>''\r\n  insert into @EKSTRE_TEMP (FirmaNo,TIP,ACK,TARIH,MATRAH,KDV_TUTAR,KDV_ORAN)\r\n  SELECT m.firmano,'C','Z RAPOR',m.tarih,((h.brmfiy*h.miktar)/(1+h.kdvyuz)),\r\n  (h.brmfiy*h.miktar)-((h.brmfiy*h.miktar)/(1+h.kdvyuz)),\r\n  h.kdvyuz\r\n  from zraporhrk as h\r\n  inner join zrapormas as m on m.zrapid=h.zrapid\r\n  and h.sil=0 and m.sil=0 \r\n  where h.kdvyuz>0 and m.zraptip in (select * from CsvToSTR(@ZTIPIN))\r\n\r\n\r\n  if @DEVIR=1 and @firmano=0\r\n   insert into @TB_KDV_DRUM_EKSTRE (ACK,MATRAH,\r\n   KDV_TUTAR,KDV_ORAN,\r\n   KDV_ODENEN,KDV_TAHSIL,TIP)\r\n   select 'ÖNCEKİ DÖNEMDEN DEVREDEN KDV',\r\n   isnull(SUM(MATRAH),0),isnull(SUM(KDV_TUTAR),0),\r\n   (KDV_ORAN*100),\r\n   sum(case when TIP='G' THEN KDV_TUTAR ELSE 0 END),\r\n   sum(case when TIP='C' THEN KDV_TUTAR ELSE 0 END),\r\n   TIP\r\n   from @EKSTRE_TEMP\r\n   where TARIH<@BASTAR\r\n   group by TIP,KDV_ORAN\r\n   \r\n   \r\n   if @DEVIR=1 and @firmano>0\r\n   insert into @TB_KDV_DRUM_EKSTRE (ACK,MATRAH,\r\n   KDV_TUTAR,KDV_ORAN,\r\n   KDV_ODENEN,KDV_TAHSIL,TIP)\r\n   select 'ÖNCEKİ DÖNEMDEN DEVREDEN KDV',\r\n   isnull(SUM(MATRAH),0),isnull(SUM(KDV_TUTAR),0),\r\n   (KDV_ORAN*100),\r\n   sum(case when TIP='G' THEN KDV_TUTAR ELSE 0 END),\r\n   sum(case when TIP='C' THEN KDV_TUTAR ELSE 0 END),\r\n   TIP\r\n   from @EKSTRE_TEMP\r\n   where Firmano in (@firmano,0)\r\n   and TARIH<@BASTAR\r\n   group by TIP,KDV_ORAN\r\n   \r\n   \r\n   \r\n   \r\n   \r\n   if @firmano=0\r\n   insert into @TB_KDV_DRUM_EKSTRE (ACK,MATRAH,\r\n   KDV_TUTAR,KDV_ORAN,\r\n   KDV_ODENEN,KDV_TAHSIL,TIP)\r\n   select ACK,\r\n   isnull(SUM(MATRAH),0),isnull(SUM(KDV_TUTAR),0),\r\n   (KDV_ORAN*100),\r\n   sum(case when TIP='G' THEN KDV_TUTAR ELSE 0 END),\r\n   sum(case when TIP='C' THEN KDV_TUTAR ELSE 0 END),\r\n   TIP\r\n   from @EKSTRE_TEMP\r\n   where TARIH>=@BASTAR and TARIH <=@BITTAR\r\n   group by TIP,ACK,KDV_ORAN\r\n   \r\n\r\n   if @firmano>0\r\n   insert into @TB_KDV_DRUM_EKSTRE (ACK,MATRAH,\r\n   KDV_TUTAR,KDV_ORAN,\r\n   KDV_ODENEN,KDV_TAHSIL,TIP)\r\n   select ACK,\r\n   isnull(SUM(MATRAH),0),isnull(SUM(KDV_TUTAR),0),\r\n   (KDV_ORAN*100),\r\n   sum(case when TIP='G' THEN KDV_TUTAR ELSE 0 END),\r\n   sum(case when TIP='C' THEN KDV_TUTAR ELSE 0 END),\r\n   TIP\r\n   from @EKSTRE_TEMP\r\n   where Firmano in (@firmano,0)\r\n   and TARIH>=@BASTAR and TARIH <=@BITTAR\r\n   group by TIP,ACK,KDV_ORAN\r\n\r\n /*   insert into @TB_KDV_DRUM_EKSTRE (TIP,MATRAH,KDV_TUTAR,KDV_ORAN) */\r\n /*  select TIP,MATRAH,KDV_TUTAR,KDV_ORAN from @EKSTRE_TEMP */\r\n\r\n  \r\n RETURN\r\n  \r\nEND"
  },
  {
    "schema": "dbo",
    "name": "kdvoranver",
    "type": "SQL_SCALAR_FUNCTION",
    "full_name": "dbo.kdvoranver",
    "definition": "CREATE FUNCTION [dbo].kdvoranver (@kdvoran float)\r\nRETURNS float\r\nAS\r\nBEGIN\r\ndeclare @sonuc float\r\n \r\n if @kdvoran=0 \r\n set @sonuc=1\r\n else\r\n set @sonuc=1+(@kdvoran/100)\r\n\r\n\r\n RETURN @sonuc\r\n \r\nEND"
  },
  {
    "schema": "dbo",
    "name": "MALALIS_TARIHLI_STOK",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.MALALIS_TARIHLI_STOK",
    "definition": "CREATE FUNCTION dbo.MALALIS_TARIHLI_STOK (@depkod varchar(20),\r\n@stktip varchar(20),@stkod varchar(20),@TARIH1 datetime,@TARIH2 datetime,\r\n@SAAT1 VARCHAR(8), @SAAT2 VARCHAR(8) )\r\nRETURNS\r\n   @TB_MAL_ALIS TABLE (\r\n    MIKTAR     FLOAT,\r\n    TUTAR      FLOAT)\r\nBEGIN\r\n\r\nDECLARE @MIKTAR FLOAT\r\nDECLARE @TUTAR FLOAT\r\n\r\nif @depkod<>''\r\nselect @MIKTAR=ISNULL(SUM(giren-cikan),0),\r\n@TUTAR=ISNULL(SUM((giren*brmfiykdvli)-(cikan*brmfiykdvli)),0) from stkhrk\r\nwhere depkod=@depkod and stktip=@stktip and stkod=@stkod and islmtip='alis'\r\nand tabload='faturahrk' and sil=0\r\n AND (tarih > @TARIH1 OR (tarih = @TARIH1 AND saat > @SAAT1))\r\n AND (tarih < @TARIH2 OR (tarih = @TARIH2 AND saat < @SAAT2))\r\n\r\n\r\nif @depkod=''\r\nselect @MIKTAR=ISNULL(SUM(giren-cikan),0),\r\n@TUTAR=ISNULL(SUM((giren*brmfiykdvli)-(cikan*brmfiykdvli)),0) from stkhrk\r\nwhere stktip=@stktip and stkod=@stkod and islmtip='alis' and tabload='faturahrk'\r\nand sil=0\r\n AND (tarih > @TARIH1 OR (tarih = @TARIH1 AND saat > @SAAT1))\r\n AND (tarih < @TARIH2 OR (tarih = @TARIH2 AND saat < @SAAT2))\r\n\r\n  INSERT @TB_MAL_ALIS (MIKTAR,TUTAR)\r\n   VALUES (@MIKTAR,@TUTAR)\r\n\r\n  RETURN\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "MALCIKIS_TARIHLI_STOK",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.MALCIKIS_TARIHLI_STOK",
    "definition": "CREATE FUNCTION dbo.MALCIKIS_TARIHLI_STOK (@depkod varchar(20),\r\n@stktip varchar(20),@stkod varchar(20),@TARIH1 datetime,@TARIH2 datetime,\r\n@SAAT1 VARCHAR(8), @SAAT2 VARCHAR(8) )\r\nRETURNS\r\n   @TB_MAL_SATIS TABLE (\r\n    MIKTAR     FLOAT,\r\n    TUTAR      FLOAT)\r\nBEGIN\r\n\r\nDECLARE @MIKTAR FLOAT\r\nDECLARE @TUTAR FLOAT\r\n\r\nif @depkod<>''\r\nselect @MIKTAR=ISNULL(SUM(giren-cikan),0),\r\n@TUTAR=ISNULL(SUM((giren*brmfiykdvli)-(cikan*brmfiykdvli)),0) from stkhrk\r\nwhere depkod=@depkod and stktip=@stktip and stkod=@stkod and islmtip='satis'\r\nand tabload='faturahrk' and sil=0\r\n AND (tarih > @TARIH1 OR (tarih = @TARIH1 AND saat > @SAAT1))\r\n AND (tarih < @TARIH2 OR (tarih = @TARIH2 AND saat < @SAAT2))\r\n\r\n\r\nif @depkod=''\r\nselect @MIKTAR=ISNULL(SUM(giren-cikan),0),\r\n@TUTAR=ISNULL(SUM((giren*brmfiykdvli)-(cikan*brmfiykdvli)),0) from stkhrk\r\nwhere stktip=@stktip and stkod=@stkod and islmtip='satis' and tabload='faturahrk'\r\nand sil=0\r\n AND (tarih > @TARIH1 OR (tarih = @TARIH1 AND saat > @SAAT1))\r\n AND (tarih < @TARIH2 OR (tarih = @TARIH2 AND saat < @SAAT2))\r\n\r\n  INSERT @TB_MAL_SATIS (MIKTAR,TUTAR)\r\n   VALUES (@MIKTAR,@TUTAR)\r\n\r\n  RETURN\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "Market_Sat_FisAktarim",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.Market_Sat_FisAktarim",
    "definition": "CREATE FUNCTION [dbo].Market_Sat_FisAktarim (\r\n@marsatid int)\r\nRETURNS\r\n@TB_MARKET_ODEME TABLE (\r\n    tip                  VARCHAR(10) COLLATE Turkish_CI_AS,\r\n    hrk_id               float)\r\nAS\r\nBEGIN\r\n\r\n\r\n\r\n    insert into @TB_MARKET_ODEME (tip,hrk_id)\r\n    select 'poshrk',poshrkid from poshrk with (nolock) \r\n    where sil=0 and marsatid=@marsatid\r\n    and aktip in ('AK')\r\n      \r\n    insert into @TB_MARKET_ODEME (tip,hrk_id)\r\n    select 'veresimas',verid from veresimas with (nolock) \r\n    where sil=0 and marsatid=@marsatid\r\n    and aktip in ('FT','CH')\r\n    \r\n    \r\n RETURN\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "ParaOku",
    "type": "SQL_SCALAR_FUNCTION",
    "full_name": "dbo.ParaOku",
    "definition": "CREATE FUNCTION [dbo].ParaOku (@Sayi float)\r\nRETURNS nvarchar(300)\r\nAS\r\nBEGIN\r\n  DECLARE @Tam nvarchar(20),@Ondalik nvarchar(20),@SONUC nvarchar(300),\r\n  @TamSayi bigint,@OndSayi int\r\n  SET @Tam='TL'\r\n  SET @Ondalik='Kr'\r\n  SET @TamSayi=@Sayi\r\n  SET @SONUC=dbo.RakamOku(@TamSayi)+' '+@Tam\r\n  SET @TamSayi=Round((@Sayi-@TamSayi)*100,2)\r\n  SET @SONUC=@SONUC+' '+dbo.RakamOku(@TamSayi)+' '+@Ondalik\r\n  RETURN @SONUC\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "POS_DETAY_RAPOR",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.POS_DETAY_RAPOR",
    "definition": "CREATE FUNCTION [dbo].POS_DETAY_RAPOR\r\n(@firmano int,\r\n@POS_IN VARCHAR(4000),@TARINDEX INT,@TARIH1 DATETIME,@TARIH2 DATETIME,\r\n@AKTIPIN VARCHAR(20))\r\nRETURNS\r\n  @TB_POS_RAPOR_TOPLAM TABLE (\r\n    BANKA_KOD         VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    BANKA_AD          VARCHAR(150)  COLLATE Turkish_CI_AS,\r\n    POS_KOD           VARCHAR(50)  COLLATE Turkish_CI_AS,\r\n    POS_ADI           VARCHAR(150)  COLLATE Turkish_CI_AS,\r\n    CARI_TIP\t\t   VARCHAR(50)  COLLATE Turkish_CI_AS,\r\n    CARI_KOD\t\t   VARCHAR(50)  COLLATE Turkish_CI_AS,\r\n    CARI_UNVAN\t\t   VARCHAR(200)  COLLATE Turkish_CI_AS,\r\n    POSTUTAR          FLOAT,\r\n    KOMISYONTUTAR     FLOAT,\r\n    HESGECTUTAR       FLOAT,\r\n    ISLEM_TARIHI      DATETIME,\r\n    VADETARIHI        DATETIME)\r\nAS\r\nBEGIN\r\n DECLARE @EKSTRE_TEMP TABLE (\r\n pos_kod      varchar(50) COLLATE Turkish_CI_AS )\r\n\r\ndeclare @separator char(1)\r\n set @separator = ','\r\n\r\n declare @separator_position int\r\n declare @array_value varchar(1000)\r\n\r\n IF (LEN(RTRIM(@POS_IN)) > 0)\r\n BEGIN\r\n  set @POS_IN = @POS_IN + ','\r\n END\r\n\r\n while patindex('%,%' , @POS_IN) <> 0\r\n begin\r\n\r\n   select @separator_position =  patindex('%,%' , @POS_IN)\r\n   select @array_value = left(@POS_IN, @separator_position - 1)\r\n\r\n  Insert @EKSTRE_TEMP\r\n  Values (@array_value)\r\n\r\n   select @POS_IN = stuff(@POS_IN, 1, @separator_position, '')\r\n end\r\n\r\n\r\n  IF @TARINDEX=0 /*islem tarihi */\r\n  begin\r\n  if @firmano<=0\r\n  INSERT @TB_POS_RAPOR_TOPLAM (BANKA_KOD,BANKA_AD,POS_KOD,POS_ADI,\r\n  CARI_TIP,CARI_KOD,CARI_UNVAN,\r\n  POSTUTAR,KOMISYONTUTAR,HESGECTUTAR,ISLEM_TARIHI,VADETARIHI)\r\n  select h.bankod,bk.ad,h.poskod,pk.ad,\r\n  h.cartip,h.carkod,'',h.giren,\r\n  ((h.giren*h.bankomyuz)+((h.giren*h.bankomyuz)*h.extrakomyuz)+(h.giren*h.ekkomyuz)),\r\n  h.giren-((h.giren*h.bankomyuz)+((h.giren*h.bankomyuz)*h.extrakomyuz)+(h.giren*h.ekkomyuz)),\r\n  h.tarih,h.vadetar\r\n  FROM  poshrk as h with (nolock)\r\n  inner join poskart as pk with (nolock) on pk.kod=h.poskod and h.PosIsle=1\r\n  left join bankakart as bk with (nolock) on bk.kod=pk.bankod\r\n  where h.poskod in (select * from @EKSTRE_TEMP)\r\n  and h.sil=0 and h.tarih>=@TARIH1 and h.tarih <= @TARIH2\r\n  and h.aktip in (SELECT * FROM dbo.CsvToSTR (@AKTIPIN))\r\n  \r\n  if @firmano>0\r\n  INSERT @TB_POS_RAPOR_TOPLAM (BANKA_KOD,BANKA_AD,POS_KOD,POS_ADI,\r\n  CARI_TIP,CARI_KOD,CARI_UNVAN,\r\n  POSTUTAR,KOMISYONTUTAR,HESGECTUTAR,ISLEM_TARIHI,VADETARIHI)\r\n  select h.bankod,bk.ad,h.poskod,pk.ad,\r\n  h.cartip,h.carkod,'',h.giren,\r\n  ((h.giren*h.bankomyuz)+((h.giren*h.bankomyuz)*h.extrakomyuz)+(h.giren*h.ekkomyuz)),\r\n  h.giren-((h.giren*h.bankomyuz)+((h.giren*h.bankomyuz)*h.extrakomyuz)+(h.giren*h.ekkomyuz)),\r\n  h.tarih,h.vadetar\r\n  FROM  poshrk as h with (nolock)\r\n  inner join poskart as pk with (nolock) on pk.kod=h.poskod and h.PosIsle=1 and h.firmano=@firmano\r\n  left join bankakart as bk with (nolock) on bk.kod=pk.bankod\r\n  where h.poskod in (select * from @EKSTRE_TEMP)\r\n  and h.sil=0 and h.tarih>=@TARIH1 and h.tarih <= @TARIH2\r\n  and h.aktip in (SELECT * FROM dbo.CsvToSTR (@AKTIPIN))\r\n  \r\n  \r\n  end\r\n  \r\n  IF @TARINDEX=1 /*vade tarihi */\r\n  begin\r\n  if @firmano<=0\r\n  INSERT @TB_POS_RAPOR_TOPLAM (BANKA_KOD,BANKA_AD,POS_KOD,POS_ADI,\r\n  CARI_TIP,CARI_KOD,CARI_UNVAN,POSTUTAR,\r\n  KOMISYONTUTAR,HESGECTUTAR,ISLEM_TARIHI,VADETARIHI)\r\n  select h.bankod,bk.ad,h.poskod,pk.ad,\r\n    h.cartip,h.carkod,'',h.giren,\r\n  ((h.giren*h.bankomyuz)+((h.giren*h.bankomyuz)*h.extrakomyuz)+(h.giren*h.ekkomyuz)),\r\n  h.giren-((h.giren*h.bankomyuz)+((h.giren*h.bankomyuz)*h.extrakomyuz)+(h.giren*h.ekkomyuz)),\r\n  h.tarih,h.vadetar\r\n  FROM  poshrk as h with (nolock)\r\n  inner join poskart as pk with (nolock) on pk.kod=h.poskod and h.PosIsle=1\r\n  left join bankakart as bk with (nolock) on bk.kod=pk.bankod\r\n  where h.poskod in (select * from @EKSTRE_TEMP)\r\n  and h.sil=0 and h.vadetar>=@TARIH1 and h.vadetar <= @TARIH2\r\n  and h.aktip in (SELECT * FROM dbo.CsvToSTR (@AKTIPIN))\r\n  \r\n  if @firmano>0\r\n  INSERT @TB_POS_RAPOR_TOPLAM (BANKA_KOD,BANKA_AD,POS_KOD,POS_ADI,\r\n  CARI_TIP,CARI_KOD,CARI_UNVAN,POSTUTAR,\r\n  KOMISYONTUTAR,HESGECTUTAR,ISLEM_TARIHI,VADETARIHI)\r\n  select h.bankod,bk.ad,h.poskod,pk.ad,\r\n    h.cartip,h.carkod,'',h.giren,\r\n  ((h.giren*h.bankomyuz)+((h.giren*h.bankomyuz)*h.extrakomyuz)+(h.giren*h.ekkomyuz)),\r\n  h.giren-((h.giren*h.bankomyuz)+((h.giren*h.bankomyuz)*h.extrakomyuz)+(h.giren*h.ekkomyuz)),\r\n  h.tarih,h.vadetar\r\n  FROM  poshrk as h with (nolock)\r\n  inner join poskart as pk with (nolock) on pk.kod=h.poskod and h.PosIsle=1 and h.firmano=@firmano\r\n  left join bankakart as bk with (nolock) on bk.kod=pk.bankod\r\n  where h.poskod in (select * from @EKSTRE_TEMP)\r\n  and h.sil=0 and h.vadetar>=@TARIH1 and h.vadetar <= @TARIH2\r\n  and h.aktip in (SELECT * FROM dbo.CsvToSTR (@AKTIPIN)) \r\n  \r\n  end\r\n  \r\n  \r\n  \r\n  \r\n   update @TB_POS_RAPOR_TOPLAM set CARI_UNVAN=DT.UNVAN FROM @TB_POS_RAPOR_TOPLAM AS t \r\n   join (select cartip,kod,unvan from Genel_Cari_Kart with (nolock)) dt\r\n   on dt.carTip=t.CARI_TIP and dt.kod=t.CARI_KOD\r\n  \r\n  \r\n\r\n\r\n  RETURN\r\n\r\nend"
  },
  {
    "schema": "dbo",
    "name": "POS_GRUP_TOPLAM",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.POS_GRUP_TOPLAM",
    "definition": "CREATE FUNCTION [dbo].POS_GRUP_TOPLAM\r\n(@firmano int,\r\n@POS_IN VARCHAR(4000),\r\n@TARINDEX INT,@TARIH1 DATETIME,@TARIH2 DATETIME,\r\n@AKTIPIN VARCHAR(20),\r\n@PERTIP INT)\r\nRETURNS\r\n  @TB_POS_RAPOR_TOPLAM TABLE (\r\n    BANKA_KOD         VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    BANKA_AD          VARCHAR(150)  COLLATE Turkish_CI_AS,\r\n    POS_KOD           VARCHAR(50)  COLLATE Turkish_CI_AS,\r\n    POS_ADI           VARCHAR(150)  COLLATE Turkish_CI_AS,\r\n    POSTUTAR          FLOAT,\r\n    KOMISYONTUTAR     FLOAT,\r\n    HESGECTUTAR       FLOAT,\r\n    PERIYOT_ACK       VARCHAR(50) COLLATE Turkish_CI_AS)\r\nAS\r\nBEGIN\r\n\r\n\r\n   DECLARE @TB_POS_EXTRA_TOPLAM TABLE (\r\n    BANKA_KOD         VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    BANKA_AD          VARCHAR(100)  COLLATE Turkish_CI_AS,\r\n    POS_KOD           VARCHAR(50)  COLLATE Turkish_CI_AS,\r\n    POS_ADI           VARCHAR(150)  COLLATE Turkish_CI_AS,\r\n    POSTUTAR          FLOAT,\r\n    KOMISYONTUTAR     FLOAT,\r\n    HESGECTUTAR       FLOAT,\r\n    TAR               VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    HAFTA             INT,\r\n    AY                INT,\r\n    YIL               INT)\r\n\r\n\r\n\r\n\r\n\r\n\r\n DECLARE @EKSTRE_TEMP TABLE (\r\n pos_kod      varchar(50) COLLATE Turkish_CI_AS )\r\n\r\ndeclare @separator char(1)\r\n set @separator = ','\r\n\r\n declare @separator_position int\r\n declare @array_value varchar(1000)\r\n\r\n IF (LEN(RTRIM(@POS_IN)) > 0)\r\n BEGIN\r\n  set @POS_IN = @POS_IN + ','\r\n END\r\n\r\n while patindex('%,%' , @POS_IN) <> 0\r\n begin\r\n\r\n   select @separator_position =  patindex('%,%' , @POS_IN)\r\n   select @array_value = left(@POS_IN, @separator_position - 1)\r\n\r\n  Insert @EKSTRE_TEMP\r\n  Values (@array_value)\r\n\r\n   select @POS_IN = stuff(@POS_IN, 1, @separator_position, '')\r\n end\r\n/*---------------------------------------------------- */\r\n  IF @TARINDEX=0 /*islem tarihi */\r\n  begin\r\n\r\n if @firmano<=0\r\n  INSERT @TB_POS_EXTRA_TOPLAM (BANKA_KOD,BANKA_AD,POS_KOD,POS_ADI,POSTUTAR,\r\n  KOMISYONTUTAR,HESGECTUTAR,TAR,HAFTA,AY,YIL)\r\n  select h.bankod,bk.ad,h.poskod,pk.ad,sum(h.giren),\r\n  sum((h.giren*h.bankomyuz)+((h.giren*h.bankomyuz)*h.extrakomyuz)+(h.giren*h.ekkomyuz)),\r\n  sum(h.giren-((h.giren*h.bankomyuz)+((h.giren*h.bankomyuz)*h.extrakomyuz)+(h.giren*h.ekkomyuz))),\r\n  convert(varchar,h.tarih,104),\r\n  case when datepart(wk,(h.tarih-1))=53 then\r\n  1 else datepart(wk,(h.tarih-1)) end,\r\n  MONTH(h.tarih),YEAR(h.tarih)\r\n  FROM  poshrk as h with (nolock)\r\n  inner join poskart as pk with (nolock) on pk.kod=h.poskod and H.PosIsle=1\r\n  left join bankakart as bk with (nolock) on bk.kod=pk.bankod\r\n  where h.poskod in (select * from @EKSTRE_TEMP)\r\n  and h.sil=0 and h.tarih>=@TARIH1 and h.tarih <= @TARIH2\r\n  and h.aktip in (SELECT * FROM dbo.CsvToSTR (@AKTIPIN))\r\n  group by h.bankod,bk.ad,h.poskod,pk.ad,h.tarih\r\n  order by h.tarih\r\n  \r\n  \r\n  if @firmano>0\r\n  INSERT @TB_POS_EXTRA_TOPLAM (BANKA_KOD,BANKA_AD,POS_KOD,POS_ADI,POSTUTAR,\r\n  KOMISYONTUTAR,HESGECTUTAR,TAR,HAFTA,AY,YIL)\r\n  select h.bankod,bk.ad,h.poskod,pk.ad,sum(h.giren),\r\n  sum((h.giren*h.bankomyuz)+((h.giren*h.bankomyuz)*h.extrakomyuz)+(h.giren*h.ekkomyuz)),\r\n  sum(h.giren-((h.giren*h.bankomyuz)+((h.giren*h.bankomyuz)*h.extrakomyuz)+(h.giren*h.ekkomyuz))),\r\n  convert(varchar,h.tarih,104),\r\n  case when datepart(wk,(h.tarih-1))=53 then\r\n  1 else datepart(wk,(h.tarih-1)) end,\r\n  MONTH(h.tarih),YEAR(h.tarih)\r\n  FROM  poshrk as h with (nolock)\r\n  inner join poskart as pk with (nolock) on pk.kod=h.poskod and H.PosIsle=1 and h.firmano=@firmano\r\n  left join bankakart as bk with (nolock) on bk.kod=pk.bankod\r\n  where h.poskod in (select * from @EKSTRE_TEMP)\r\n  and h.sil=0 and h.tarih>=@TARIH1 and h.tarih <= @TARIH2\r\n  and h.aktip in (SELECT * FROM dbo.CsvToSTR (@AKTIPIN))\r\n  group by h.bankod,bk.ad,h.poskod,pk.ad,h.tarih\r\n  order by h.tarih\r\n  \r\n  end\r\n  \r\n  IF @TARINDEX=1 /*vade tarihi */\r\n  begin\r\n  if @firmano<=0\r\n    INSERT @TB_POS_EXTRA_TOPLAM (BANKA_KOD,BANKA_AD,POS_KOD,POS_ADI,POSTUTAR,\r\n    KOMISYONTUTAR,HESGECTUTAR,TAR,HAFTA,AY,YIL)\r\n    select h.bankod,bk.ad,h.poskod,pk.ad,sum(h.giren),\r\n    sum((h.giren*h.bankomyuz)+((h.giren*h.bankomyuz)*h.extrakomyuz)+(h.giren*h.ekkomyuz)),\r\n    sum(h.giren-((h.giren*h.bankomyuz)+((h.giren*h.bankomyuz)*h.extrakomyuz)+(h.giren*h.ekkomyuz))),\r\n    convert(varchar,h.vadetar,104),\r\n    case when datepart(wk,(h.vadetar-1))=53 then\r\n    1 else datepart(wk,(h.vadetar-1)) end,\r\n    MONTH(h.vadetar),YEAR(h.vadetar)\r\n    FROM  poshrk as h with (nolock)\r\n    inner join poskart as pk with (nolock) on pk.kod=h.poskod and H.PosIsle=1\r\n    left join bankakart as bk with (nolock) on bk.kod=pk.bankod\r\n    where h.poskod in (select * from @EKSTRE_TEMP)\r\n    and h.sil=0 and h.vadetar>=@TARIH1 and h.vadetar <= @TARIH2\r\n    and h.aktip in (SELECT * FROM dbo.CsvToSTR (@AKTIPIN))\r\n    group by h.bankod,bk.ad,h.poskod,pk.ad,h.vadetar\r\n    order by h.vadetar\r\n    \r\n   if @firmano>0\r\n    INSERT @TB_POS_EXTRA_TOPLAM (BANKA_KOD,BANKA_AD,POS_KOD,POS_ADI,POSTUTAR,\r\n    KOMISYONTUTAR,HESGECTUTAR,TAR,HAFTA,AY,YIL)\r\n    select h.bankod,bk.ad,h.poskod,pk.ad,sum(h.giren),\r\n    sum((h.giren*h.bankomyuz)+((h.giren*h.bankomyuz)*h.extrakomyuz)+(h.giren*h.ekkomyuz)),\r\n    sum(h.giren-((h.giren*h.bankomyuz)+((h.giren*h.bankomyuz)*h.extrakomyuz)+(h.giren*h.ekkomyuz))),\r\n    convert(varchar,h.vadetar,104),\r\n    case when datepart(wk,(h.vadetar-1))=53 then\r\n    1 else datepart(wk,(h.vadetar-1)) end,\r\n    MONTH(h.vadetar),YEAR(h.vadetar)\r\n    FROM  poshrk as h with (nolock)\r\n    inner join poskart as pk with (nolock) on pk.kod=h.poskod and H.PosIsle=1 and h.firmano=@firmano\r\n    left join bankakart as bk with (nolock) on bk.kod=pk.bankod\r\n    where h.poskod in (select * from @EKSTRE_TEMP)\r\n    and h.sil=0 and h.vadetar>=@TARIH1 and h.vadetar <= @TARIH2\r\n    and h.aktip in (SELECT * FROM dbo.CsvToSTR (@AKTIPIN))\r\n    group by h.bankod,bk.ad,h.poskod,pk.ad,h.vadetar\r\n    order by h.vadetar \r\n    \r\n  end\r\n  \r\n\r\n  IF @PERTIP=0 /*TUMU */\r\n   BEGIN\r\n      INSERT INTO @TB_POS_RAPOR_TOPLAM (PERIYOT_ACK,BANKA_KOD,BANKA_AD,POS_KOD,POS_ADI,POSTUTAR,\r\n      KOMISYONTUTAR,HESGECTUTAR)\r\n      SELECT TAR,BANKA_KOD,BANKA_AD,POS_KOD,POS_ADI,POSTUTAR,\r\n      KOMISYONTUTAR,HESGECTUTAR FROM @TB_POS_EXTRA_TOPLAM\r\n  END\r\n  \r\n  \r\n   IF @PERTIP=1 /*GUNLUK */\r\n   BEGIN\r\n      INSERT INTO @TB_POS_RAPOR_TOPLAM (PERIYOT_ACK,BANKA_KOD,BANKA_AD,POS_KOD,POS_ADI,POSTUTAR,\r\n      KOMISYONTUTAR,HESGECTUTAR)\r\n      SELECT TAR,BANKA_KOD,BANKA_AD,POS_KOD,POS_ADI,SUM(POSTUTAR),\r\n      SUM(KOMISYONTUTAR),SUM(HESGECTUTAR) FROM @TB_POS_EXTRA_TOPLAM\r\n      GROUP BY BANKA_KOD,BANKA_AD,POS_KOD,POS_ADI,TAR\r\n      ORDER BY TAR\r\n  END\r\n  \r\n  \r\n  \r\n  \r\n   IF @PERTIP=2 /*HAFTALIK */\r\n   BEGIN\r\n      INSERT INTO @TB_POS_RAPOR_TOPLAM (PERIYOT_ACK,BANKA_KOD,BANKA_AD,POS_KOD,POS_ADI,POSTUTAR,\r\n      KOMISYONTUTAR,HESGECTUTAR)\r\n      SELECT CAST(YIL as varchar)+'-'+CAST(HAFTA as varchar),BANKA_KOD,BANKA_AD,POS_KOD,POS_ADI,SUM(POSTUTAR),\r\n      SUM(KOMISYONTUTAR),SUM(HESGECTUTAR) FROM @TB_POS_EXTRA_TOPLAM\r\n      GROUP BY BANKA_KOD,BANKA_AD,POS_KOD,POS_ADI,HAFTA,YIL\r\n      ORDER BY CAST(HAFTA as varchar)+'-'+CAST(HAFTA as varchar)\r\n  END\r\n  \r\n   IF @PERTIP=3 /*AYLIK */\r\n   BEGIN\r\n      INSERT INTO @TB_POS_RAPOR_TOPLAM (PERIYOT_ACK,BANKA_KOD,BANKA_AD,POS_KOD,POS_ADI,POSTUTAR,\r\n      KOMISYONTUTAR,HESGECTUTAR)\r\n      SELECT CAST(YIL as varchar)+'-'+\r\n       (CASE AY\r\n           WHEN 1 THEN 'OCAK'\r\n           WHEN 2 THEN 'ŞUBAT'\r\n           WHEN 3 THEN 'MART'\r\n           WHEN 4 THEN 'NİSAN'\r\n           WHEN 5 THEN 'MAYIS'\r\n           WHEN 6 THEN 'HAZİRAN'\r\n           WHEN 7 THEN 'TEMMUZ'\r\n           WHEN 8 THEN 'AĞUSTOS'\r\n           WHEN 9 THEN 'EYLÜL'\r\n           WHEN 10 THEN 'EKİM'\r\n           WHEN 11 THEN 'KASIM'\r\n           WHEN 12 THEN 'ARALIK'\r\n           end),\r\n           BANKA_KOD,BANKA_AD,POS_KOD,POS_ADI,SUM(POSTUTAR),\r\n      SUM(KOMISYONTUTAR),SUM(HESGECTUTAR) FROM @TB_POS_EXTRA_TOPLAM\r\n      GROUP BY BANKA_KOD,BANKA_AD,POS_KOD,POS_ADI,AY,YIL\r\n      ORDER BY CAST(YIL as varchar)+'-'+CAST(AY as varchar)\r\n\r\n  END\r\n  \r\n  \r\n\r\n\r\n  RETURN\r\n\r\nend"
  },
  {
    "schema": "dbo",
    "name": "PROM_TARIH_ISLEM",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.PROM_TARIH_ISLEM",
    "definition": "CREATE FUNCTION [dbo].PROM_TARIH_ISLEM \r\n(\r\n@FirmaNo    int,\r\n@RapTip\t\tint,\r\n@Bas_Tar\tDatetime,\r\n@Bit_Tar\tDatetime)\r\nRETURNS\r\n    @TB_PROM_ISLEM TABLE (\r\n    FIRMA_NO\t\t   INT,\r\n    FIRMA_UNVAN\t   VARCHAR(200) COLLATE Turkish_CI_AS,\r\n    TARIH\t\t\tDATETIME,\r\n    CARITIP_ID     INT,\r\n    CARI_ID        INT,\r\n    CARI_KOD\t    VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    CARI_UNVAN      VARCHAR(150) COLLATE Turkish_CI_AS,\r\n    CARI_PLAKA      VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    STOKTIP_ID\t   INT,\r\n    STOK_ID         INT,\r\n    STOK_KOD        VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    STOK_AD         VARCHAR(150) COLLATE Turkish_CI_AS,\r\n    BELGE_NO       VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    BIRIM_FIYAT\t   FLOAT,\r\n    MIKTAR\t\t   FLOAT,\r\n    TUTAR\t\t   FLOAT,\r\n    PUAN\t\t   FLOAT,\r\n    ISLEM_SAYI     INT)\r\nAS\r\nBEGIN\r\n\r\n   DECLARE  @TM_PROM_ISLEM TABLE (\r\n    FIRMA_NO\t\tINT,\r\n    FIRMA_UNVAN\t    VARCHAR(200) COLLATE Turkish_CI_AS,\r\n    TARIH\t\t\tDATETIME,\r\n    CARITIP_ID      INT,\r\n    CARI_ID         INT,\r\n    CARI_KOD\t    VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    CARI_UNVAN      VARCHAR(150) COLLATE Turkish_CI_AS,\r\n    CARI_PLAKA      VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    STOKTIP_ID\t    INT,\r\n    STOK_ID         INT,\r\n    STOK_KOD        VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    STOK_AD         VARCHAR(150) COLLATE Turkish_CI_AS,\r\n    BELGE_NO       VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    BIRIM_FIYAT\t    FLOAT,\r\n    MIKTAR\t\t    FLOAT,\r\n    TUTAR\t\t    FLOAT,\r\n    PUAN\t\t    FLOAT,\r\n    ISLEM_SAYI      INT)\r\n\r\n\r\n\r\n\r\n   if @RapTip=0 /*urun bazli */\r\n   begin\r\n    insert into @TM_PROM_ISLEM\r\n    (FIRMA_NO,FIRMA_UNVAN,\r\n    CARITIP_ID,CARI_ID,CARI_KOD,CARI_UNVAN,\r\n    CARI_PLAKA,\r\n    STOKTIP_ID,STOK_ID,STOK_KOD,STOK_AD,\r\n    BIRIM_FIYAT,MIKTAR,TUTAR,PUAN,ISLEM_SAYI)\r\n    Select h.firmano,'',\r\n     0,0,'','','',\r\n     stktip_id,stk_id,stkkod,'',\r\n     0,/*h.Brm_Fiyat_Kdvli, */\r\n     -1*sum(h.Mik_Giren-h.Mik_Cikan),\r\n     -1*sum((h.Mik_Giren-h.Mik_Cikan)*h.Brm_Fiyat_Kdvli),\r\n     SUM(h.Puan_Giren),\r\n     count(h.Stk_id)\r\n     from  Prom_Puan_Hrk as h \r\n     where h.sil=0 and stktip_id>0 and \r\n     tarih>=@Bas_Tar and tarih<=@Bit_Tar\r\n     group by firmano,stktip_id,stk_id,stkkod\r\n    end\r\n    \r\n\r\n   if @RapTip=1 /*musteri bazli */\r\n   begin\r\n    insert into @TM_PROM_ISLEM\r\n    (FIRMA_NO,FIRMA_UNVAN,\r\n    CARITIP_ID,CARI_ID,CARI_KOD,CARI_UNVAN,\r\n    CARI_PLAKA,\r\n    STOKTIP_ID,STOK_ID,STOK_KOD,STOK_AD,\r\n    BIRIM_FIYAT,MIKTAR,TUTAR,PUAN,ISLEM_SAYI)\r\n    Select firmano,'',\r\n    h.Cartip_id,h.Car_id,'','',h.Car_Plaka,\r\n    0,0,'','',0,/*h.Brm_Fiyat_Kdvli, */\r\n    -1*sum(h.Mik_Giren-h.Mik_Cikan),\r\n    -1*sum((h.Mik_Giren-h.Mik_Cikan)*h.Brm_Fiyat_Kdvli),\r\n    SUM(h.Puan_Giren),\r\n    count(h.Cartip_id)\r\n    from  Prom_Puan_Hrk as h \r\n    where h.sil=0 and Cartip_id>0 and \r\n    tarih>=@Bas_Tar and tarih<=@Bit_Tar\r\n    group by h.firmano,h.Cartip_id,h.Car_id,h.Car_Plaka\r\n   end\r\n   \r\n   \r\n   \r\n   if @RapTip=2 /*Plaka */\r\n   begin\r\n    insert into @TM_PROM_ISLEM\r\n    (FIRMA_NO,FIRMA_UNVAN,TARIH,\r\n    CARITIP_ID,CARI_ID,CARI_KOD,CARI_UNVAN,\r\n    CARI_PLAKA,\r\n    STOKTIP_ID,STOK_ID,STOK_KOD,STOK_AD,BELGE_NO,\r\n    BIRIM_FIYAT,MIKTAR,TUTAR,PUAN,ISLEM_SAYI)\r\n    Select firmano,'',H.Tarih,\r\n    h.Cartip_id,h.Car_id,'','',h.Car_Plaka,\r\n    h.Stktip_id,h.Stk_id,h.Stkkod,'',h.BelNo,0,/*h.Brm_Fiyat_Kdvli, */\r\n    -1*(h.Mik_Giren-h.Mik_Cikan),\r\n    -1*((h.Mik_Giren-h.Mik_Cikan)*h.Brm_Fiyat_Kdvli),\r\n    (h.Puan_Giren-h.Puan_Cikan),\r\n    1\r\n    from  Prom_Puan_Hrk as h \r\n    where h.sil=0 and Cartip_id>0 and \r\n    tarih>=@Bas_Tar and tarih<=@Bit_Tar\r\n   \r\n   end\r\n   \r\n   \r\n\r\n  \r\n   if @FirmaNo>0\r\n    delete from @TM_PROM_ISLEM where FIRMA_NO<>@FirmaNo\r\n\r\n\r\n   update @TM_PROM_ISLEM \r\n   set FIRMA_UNVAN=dt.ad from @TM_PROM_ISLEM t\r\n   join (select id,ad from Firma) dt\r\n   on dt.id=t.FIRMA_NO \r\n\r\n  if (@RapTip=0) OR (@RapTip=2)\r\n   update @TM_PROM_ISLEM set STOK_AD=dt.ad from @TM_PROM_ISLEM t\r\n   join (select tip_id,id,kod,ad from stokkart) dt\r\n   on dt.id=STOK_ID and dt.tip_id=t.STOKTIP_ID\r\n   \r\n   if (@RapTip=1) OR (@RapTip=2)\r\n   update @TM_PROM_ISLEM set \r\n   CARI_KOD=dt.kod,\r\n   CARI_UNVAN=dt.Unvan from @TM_PROM_ISLEM t\r\n   join (select CarTip_id,id,kod,Unvan from Genel_Cari_Kart) dt\r\n   on dt.id=CARI_ID and dt.CarTip_id=t.CARITIP_ID\r\n   \r\n  insert @TB_PROM_ISLEM (\r\n  FIRMA_NO,FIRMA_UNVAN,TARIH,\r\n  CARITIP_ID,CARI_ID,CARI_KOD,CARI_UNVAN,\r\n  CARI_PLAKA,\r\n  STOKTIP_ID,STOK_ID,\r\n  STOK_KOD,STOK_AD,BELGE_NO,\r\n  BIRIM_FIYAT,MIKTAR,TUTAR,\r\n  PUAN,ISLEM_SAYI)\r\n  select FIRMA_NO,FIRMA_UNVAN,TARIH,\r\n  CARITIP_ID,CARI_ID,CARI_KOD,CARI_UNVAN,\r\n  CARI_PLAKA,\r\n  STOKTIP_ID,STOK_ID,STOK_KOD,STOK_AD,BELGE_NO,\r\n /* BIRIM_FIYAT, */\r\n  case when (MIKTAR)>0 then (TUTAR)/(MIKTAR)\r\n  else (BIRIM_FIYAT) end,  \r\n  MIKTAR,TUTAR,PUAN,\r\n  ISLEM_SAYI from @TM_PROM_ISLEM\r\n  ORDER BY CARI_UNVAN,CARI_PLAKA\r\n  \r\n\r\n\r\n\r\n RETURN\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "PROM_TARIH_RAPOR",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.PROM_TARIH_RAPOR",
    "definition": "CREATE FUNCTION [dbo].[PROM_TARIH_RAPOR] \r\n(\r\n@FirmaNo    int,\r\n@RapTip\t\tint,\r\n@Tip\t\tint,\r\n@Bas_Tar\tDatetime,\r\n@Bit_Tar\tDatetime)\r\nRETURNS\r\n    @TB_PROM_ISLEM TABLE (\r\n    FIRMA_NO\t\t   INT,\r\n    FIRMA_UNVAN\t   VARCHAR(200) COLLATE Turkish_CI_AS,\r\n    TARIH\t\t\tDATETIME,\r\n    TIP\t\t\t\tINT,\r\n    CARITIP_ID     INT,\r\n    CARI_ID        INT,\r\n    CARI_KOD\t    VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    CARI_UNVAN      VARCHAR(150) COLLATE Turkish_CI_AS,\r\n    CARI_PLAKA     VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    STOKTIP_ID\t   INT,\r\n    STOK_ID         INT,\r\n    STOK_KOD        VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    STOK_AD         VARCHAR(150) COLLATE Turkish_CI_AS,\r\n    BELGE_NO       VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    BIRIM_FIYAT\t   FLOAT,\r\n    MIKTAR\t\t   FLOAT,\r\n    TUTAR\t\t   FLOAT,\r\n    PUAN\t       FLOAT,\r\n    ISLEM_SAYI     INT)\r\nAS\r\nBEGIN\r\n\r\n   DECLARE  @TM_PROM_ISLEM TABLE (\r\n    FIRMA_NO\t\tINT,\r\n    FIRMA_UNVAN\t    VARCHAR(200) COLLATE Turkish_CI_AS,\r\n    TARIH\t\t\tDATETIME,\r\n    TIP\t\t\t\tINT,\r\n    CARITIP_ID      INT,\r\n    CARI_ID         INT,\r\n    CARI_KOD\t    VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    CARI_UNVAN      VARCHAR(150) COLLATE Turkish_CI_AS,\r\n    CARI_PLAKA     VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    STOKTIP_ID\t    INT,\r\n    STOK_ID         INT,\r\n    STOK_KOD        VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    STOK_AD         VARCHAR(150) COLLATE Turkish_CI_AS,\r\n    BELGE_NO       VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    BIRIM_FIYAT\t    FLOAT,\r\n    MIKTAR\t\t    FLOAT,\r\n    TUTAR\t\t    FLOAT,\r\n    PUAN\t\t    FLOAT,\r\n    ISLEM_SAYI      INT)\r\n\r\n\r\n\r\n\r\n   if @RapTip=0 /*urun bazli */\r\n   begin\r\n    insert into @TM_PROM_ISLEM\r\n    (FIRMA_NO,FIRMA_UNVAN,\r\n    CARITIP_ID,CARI_ID,CARI_KOD,CARI_UNVAN,\r\n    TIP,STOKTIP_ID,STOK_ID,STOK_KOD,STOK_AD,\r\n    BIRIM_FIYAT,MIKTAR,TUTAR,PUAN,ISLEM_SAYI)\r\n    Select h.firmano,'',\r\n     0,0,'','',\r\n     case when h.Puan_Giren>0 then 1 else -1 end,\r\n     stktip_id,stk_id,stkkod,'',\r\n     0,/*h.Brm_Fiyat_Kdvli, */\r\n     sum(ABS(h.Mik_Giren-h.Mik_Cikan)),\r\n     sum(h.Tutar_Kdvli),\r\n     SUM(ABS(h.Puan_Giren-h.Puan_Cikan)),\r\n     count(h.Stk_id)\r\n     from  Prom_Puan_Hrk as h \r\n     where h.sil=0 and stktip_id>0 and \r\n     tarih>=@Bas_Tar and tarih<=@Bit_Tar\r\n     group by firmano,h.Puan_Giren,stktip_id,stk_id,stkkod\r\n    end\r\n    \r\n\r\n   if @RapTip=1 /*musteri bazli */\r\n   begin\r\n    insert into @TM_PROM_ISLEM\r\n    (FIRMA_NO,FIRMA_UNVAN,\r\n    CARITIP_ID,CARI_ID,CARI_KOD,CARI_UNVAN,\r\n    TIP,STOKTIP_ID,STOK_ID,STOK_KOD,STOK_AD,\r\n    BIRIM_FIYAT,MIKTAR,TUTAR,PUAN,ISLEM_SAYI)\r\n    Select firmano,'',\r\n    h.Cartip_id,h.Car_id,'','',\r\n    case when h.Puan_Giren>0 then 1 else -1 end,\r\n    stktip_id,stk_id,stkkod,'',0,/*h.Brm_Fiyat_Kdvli, */\r\n    sum(ABS(h.Mik_Giren-h.Mik_Cikan)),\r\n    sum(h.Tutar_Kdvli),\r\n    SUM(ABS(h.Puan_Giren-h.Puan_Cikan)),\r\n    count(h.Cartip_id)\r\n    from  Prom_Puan_Hrk as h \r\n    where h.sil=0 and Cartip_id>0 and \r\n    tarih>=@Bas_Tar and tarih<=@Bit_Tar\r\n    group by h.firmano,h.Cartip_id,h.Car_id,h.Puan_Giren,\r\n    stktip_id,stk_id,stkkod\r\n   end\r\n   \r\n   \r\n   if @RapTip=2 /*Plaka */\r\n   begin\r\n    insert into @TM_PROM_ISLEM\r\n    (FIRMA_NO,FIRMA_UNVAN,TARIH,\r\n    CARITIP_ID,CARI_ID,CARI_KOD,CARI_UNVAN,\r\n    CARI_PLAKA,TIP,\r\n    STOKTIP_ID,STOK_ID,STOK_KOD,STOK_AD,BELGE_NO,\r\n    BIRIM_FIYAT,MIKTAR,TUTAR,PUAN,ISLEM_SAYI)\r\n    Select firmano,'',H.Tarih,\r\n    h.Cartip_id,h.Car_id,'','',h.Car_Plaka,\r\n    case when h.Puan_Giren>0 then 1 else -1 end,\r\n    h.Stktip_id,h.Stk_id,h.Stkkod,'',h.BelNo,0,/*h.Brm_Fiyat_Kdvli, */\r\n    -1*(h.Mik_Giren-h.Mik_Cikan),\r\n    -1*((h.Mik_Giren-h.Mik_Cikan)*h.Brm_Fiyat_Kdvli),\r\n    (h.Puan_Giren-h.Puan_Cikan),\r\n    1\r\n    from  Prom_Puan_Hrk as h \r\n    where h.sil=0 and Cartip_id>0 and \r\n    tarih>=@Bas_Tar and tarih<=@Bit_Tar\r\n   \r\n   end \r\n   \r\n   \r\n\r\n  \r\n   if @FirmaNo>0\r\n    delete from @TM_PROM_ISLEM where FIRMA_NO<>@FirmaNo\r\n\r\n\r\n   update @TM_PROM_ISLEM \r\n   set FIRMA_UNVAN=dt.ad from @TM_PROM_ISLEM t\r\n   join (select id,ad from Firma) dt\r\n   on dt.id=t.FIRMA_NO \r\n\r\n  if (@RapTip=0) OR (@RapTip=1) OR (@RapTip=2)\r\n   update @TM_PROM_ISLEM set STOK_AD=dt.ad from @TM_PROM_ISLEM t\r\n   join (select tip_id,id,kod,ad from stokkart) dt\r\n   on dt.id=STOK_ID and dt.tip_id=t.STOKTIP_ID\r\n   \r\n   if (@RapTip=1) OR (@RapTip=2)\r\n   update @TM_PROM_ISLEM set \r\n   CARI_KOD=dt.kod,\r\n   CARI_UNVAN=dt.Unvan from @TM_PROM_ISLEM t\r\n   join (select CarTip_id,id,kod,Unvan from Genel_Cari_Kart) dt\r\n   on dt.id=CARI_ID and dt.CarTip_id=t.CARITIP_ID\r\n  \r\n  \r\n    \r\n  insert @TB_PROM_ISLEM (\r\n  FIRMA_NO,FIRMA_UNVAN,TARIH,\r\n  TIP,CARITIP_ID,CARI_ID,CARI_KOD,CARI_UNVAN,CARI_PLAKA,\r\n  STOKTIP_ID,STOK_ID,\r\n  STOK_KOD,STOK_AD,BELGE_NO,\r\n  BIRIM_FIYAT,MIKTAR,TUTAR,\r\n  PUAN,ISLEM_SAYI)\r\n  \r\n  select FIRMA_NO,FIRMA_UNVAN,TARIH,\r\n  TIP,CARITIP_ID,CARI_ID,CARI_KOD,CARI_UNVAN,CARI_PLAKA,\r\n  STOKTIP_ID,STOK_ID,STOK_KOD,STOK_AD,BELGE_NO,\r\n  case \r\n  when sum(MIKTAR)>0 then sum(TUTAR)/sum(MIKTAR)\r\n  else avg(BIRIM_FIYAT) end,\r\n  sum(MIKTAR),sum(TUTAR),sum(PUAN),\r\n  sum(ISLEM_SAYI) from @TM_PROM_ISLEM\r\n  where TIP=@Tip\r\n  group by FIRMA_NO,FIRMA_UNVAN,TARIH,\r\n  TIP,CARITIP_ID,CARI_ID,CARI_KOD,CARI_UNVAN,CARI_PLAKA,\r\n  STOKTIP_ID,STOK_ID,\r\n  STOK_KOD,STOK_AD,BELGE_NO\r\n  ORDER BY CARI_UNVAN\r\n  \r\n\r\n\r\n\r\n RETURN\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "PROMOSYON_BASLIK",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.PROMOSYON_BASLIK",
    "definition": "CREATE FUNCTION dbo.[PROMOSYON_BASLIK] (@promid float)\r\nRETURNS\r\n @TB_PROMOSYON_BASLIK TABLE (\r\n    FIS_TIP\t\t\t VARCHAR(10) COLLATE Turkish_CI_AS,\r\n    FIS_AD           VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    FIS_YKNO         VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    FIS_TARIH        DATETIME,\r\n    FIS_VAD_TARIH    DATETIME,\r\n    FIS_SAAT         VARCHAR(10) COLLATE Turkish_CI_AS,\r\n    FIS_SERINO       VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    FIS_SERI         VARCHAR(10) COLLATE Turkish_CI_AS,\r\n    FIS_NO           VARCHAR(40) COLLATE Turkish_CI_AS,\r\n    FIS_PLAKA        VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    FIS_SURUCU\t\t VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    FIS_KM           VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    FIS_ACIKLAMA     VARCHAR(100) COLLATE Turkish_CI_AS,\r\n    PER_AD           VARCHAR(100) COLLATE Turkish_CI_AS,\r\n    CARI_GRUP        VARCHAR(100) COLLATE Turkish_CI_AS, \r\n    CARI_KOD         VARCHAR(50) COLLATE Turkish_CI_AS, \r\n    CARI_UNVAN       VARCHAR(150) COLLATE Turkish_CI_AS,\r\n    CARI_FAT_UNVAN   VARCHAR(150) COLLATE Turkish_CI_AS,\r\n    CARI_ADRES       VARCHAR(100) COLLATE Turkish_CI_AS,\r\n    CARI_ADRES2      VARCHAR(100) COLLATE Turkish_CI_AS,\r\n    CARI_IL          VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    CARI_ILCE        VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    CARI_VERGIDAIRE  VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    CARI_VERGINO     VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    CARI_TCNO        VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    CARI_ONCE_PUAN   FLOAT,\r\n    CARI_KAZ_PUAN    FLOAT,\r\n    CARI_TOP_PUAN    FLOAT,\r\n    ARA_TOPLAM       FLOAT,\r\n    ISKONTOTOPLAMI   FLOAT,\r\n    ISKONTOLUTOPLAM  FLOAT,\r\n    KDV_TOPLAM       FLOAT,\r\n    YUVARLAMATOP     FLOAT,\r\n    KDVSIZ_TOPLAM    FLOAT,\r\n    KDVLI_TOPLAM     FLOAT,\r\n    FIS_TOPLAM       FLOAT,\r\n    ODEMETIPAD       VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    TOPLAM_YAZI      VARCHAR(150) COLLATE Turkish_CI_AS)\r\n\r\nAS\r\nBEGIN\r\n\r\n insert into @TB_PROMOSYON_BASLIK (FIS_TIP,FIS_AD,FIS_YKNO,FIS_TARIH,\r\n FIS_VAD_TARIH,FIS_SAAT,FIS_SERINO,\r\n FIS_SERI,FIS_NO,FIS_PLAKA,FIS_SURUCU,FIS_KM,FIS_ACIKLAMA,PER_AD,\r\n CARI_GRUP,CARI_KOD,CARI_UNVAN,\r\n CARI_ONCE_PUAN,CARI_KAZ_PUAN,CARI_TOP_PUAN,\r\n ARA_TOPLAM,ISKONTOTOPLAMI,\r\n ISKONTOLUTOPLAM,KDV_TOPLAM,YUVARLAMATOP,KDVSIZ_TOPLAM,KDVLI_TOPLAM,\r\n FIS_TOPLAM,ODEMETIPAD,TOPLAM_YAZI)\r\n SELECT ver.fistip,ver.fisad,ver.ykno,ver.tarih,\r\n ver.vadtar,ver.saat,(ver.seri+' '+ver.no),(ver.seri),(ver.no),\r\n (ver.plaka),(ver.surucu),(ver.km),ver.ack,pk.ad+' '+pk.soyad,\r\n ck.Grup_Ad,CK.KOD, ck.unvan,\r\n ck.Mevcut_Puan-ver.Genel_Top_Puan,ver.Genel_Top_Puan,ck.Mevcut_Puan,\r\n ver.Genel_Top_Kdvsiz, /* ARA_TOPLAM, */\r\n 0,/*ISKONTOTOPLAMI */\r\n 0,/*ISKONTOLUTOPLAM */\r\n ver.Genel_Top_Kdv,/* KDV_TOPLAM, */\r\n 0,/*YUVARLAMATOP */\r\n 0,/*KDVSIZ_TOPLAM */\r\n 0,/*KDVLI_TOPLAM, */\r\n round(ver.Genel_Top_Kdvli,2) ,/*FIS_TOPLAM */\r\n VER.OdeTip_Ad,\r\n DBO.ParaOku(round(Genel_Top_Kdvli,2))\r\nFROM  Prom_Sat_Baslik AS ver\r\nINNER JOIN Prom_Musteri_Listesi as ck\r\nON ck.kod=ver.carkod and ck.cartip=ver.cartip\r\nand ck.KartId=ver.KartId\r\nLEFT JOIN Perkart as pk on\r\npk.kod=ver.perkod \r\nwhere ver.promid=@promid\r\n\r\n update @TB_PROMOSYON_BASLIK set \r\n     KDVSIZ_TOPLAM=FIS_TOPLAM-KDV_TOPLAM,\r\n     KDVLI_TOPLAM=FIS_TOPLAM\r\n\r\n return\r\n\r\nend"
  },
  {
    "schema": "dbo",
    "name": "PROMOSYON_HRK",
    "type": "SQL_INLINE_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.PROMOSYON_HRK",
    "definition": "CREATE FUNCTION dbo.[PROMOSYON_HRK] \r\n(@promid float)\r\nRETURNS TABLE AS\r\nRETURN(select h.stkod AS STOK_KOD,gstk.ad as STOK_AD,\r\n(h.mik) MIKTAR,h.brim AS STOK_BIRIM,\r\n(h.brmfiy) BIRIM_FIYAT,\r\n(h.brmfiy/(1+h.kdvyuz)) BIRIM_KDVSIZ,\r\nround((h.brmfiy*h.mik),2) TUTAR,\r\nround( ((h.brmfiy*h.mik)/(1+h.kdvyuz)),2) TUTAR_KDVSIZ,\r\n(h.kdvyuz*100) KDV_ORAN,\r\nabs(h.Kaz_Brm_Puan-h.Sat_Brm_Puan) BRIM_PUAN,\r\nabs(h.Kaz_Top_Puan-h.Sat_Top_Puan) TOPLAM_PUAN\r\n\r\n\r\nfrom Prom_Sat_Hrk AS h inner join \r\ngelgidlistok as gstk on gstk.kod=h.stkod\r\nand h.stktip=gstk.tip where h.promid=@promid and h.sil=0 )"
  },
  {
    "schema": "dbo",
    "name": "RakamOku",
    "type": "SQL_SCALAR_FUNCTION",
    "full_name": "dbo.RakamOku",
    "definition": "CREATE FUNCTION [dbo].RakamOku (@Sayi bigint)\r\nRETURNS nvarchar(300)\r\nAS\r\nBEGIN\r\nDECLARE @n int,@i int,@UcHane int,@Yed nvarchar(300),@UcluHane nvarchar(300),\r\n @HangiBasamak int,@Negatif bit,@BasamakYaz bit,@SONUC nvarchar(300)\r\n  SET @n=9\r\n  SET @SONUC=NULL\r\n  BEGIN\r\n    SET @SONUC=''\r\n    IF (@Sayi=0) SET @SONUC='Sıfır' ELSE BEGIN\r\n      IF (@Sayi<0) BEGIN\r\n        SET @Negatif=1\r\n        SET @Sayi=-@Sayi\r\n      END ELSE SET @Negatif=0\r\n      SET @HangiBasamak=0;\r\n      WHILE (@Sayi>0) BEGIN\r\n        SET @UcHane=@Sayi % 1000\r\n        SET @Sayi=@Sayi / 1000\r\n        IF (@UcHane>0) SET @BasamakYaz=1 ELSE SET @BasamakYaz=0\r\n        IF ((@HangiBasamak=1) and (@UcHane=1)) SET @UcluHane=''\r\n        ELSE BEGIN\r\n          SET @UcluHane=''\r\n          SET @i=@UcHane%10 SET @UcHane=@UcHane/10\r\n          SET @UcluHane=CASE @i\r\n            WHEN 1 THEN 'Bir'\r\n            WHEN 2 THEN 'İki'\r\n            WHEN 3 THEN 'Üç'\r\n            WHEN 4 THEN 'Dört'\r\n            WHEN 5 THEN 'Beş'\r\n            WHEN 6 THEN 'Altı'\r\n            WHEN 7 THEN 'Yedi'\r\n            WHEN 8 THEN 'Sekiz'\r\n            WHEN 9 THEN 'Dokuz'\r\n          ELSE '' END\r\n          SET @i=@UcHane%10 SET @UcHane=@UcHane/10\r\n          SET @UcluHane=CASE @i\r\n            WHEN 1 THEN 'On'\r\n            WHEN 2 THEN 'Yirmi'\r\n            WHEN 3 THEN 'Otuz'\r\n            WHEN 4 THEN 'Kırk'\r\n            WHEN 5 THEN 'Elli'\r\n            WHEN 6 THEN 'Altmış'\r\n            WHEN 7 THEN 'Yetmiş'\r\n            WHEN 8 THEN 'Seksen'\r\n            WHEN 9 THEN 'Doksan'\r\n          ELSE '' END+@UcluHane\r\n          SET @i=@UcHane%10 /*SET @UcHane=@UcHane/10 */\r\n          IF (@i>0) SET @Yed='Yüz' ELSE SET @Yed=''\r\n          IF (@i>1) SET @Yed=CASE @i\r\n            WHEN 1 THEN 'Bir'\r\n            WHEN 2 THEN 'İki'\r\n            WHEN 3 THEN 'Üç'\r\n            WHEN 4 THEN 'Dört'\r\n            WHEN 5 THEN 'Beş'\r\n            WHEN 6 THEN 'Altı'\r\n            WHEN 7 THEN 'Yedi'\r\n            WHEN 8 THEN 'Sekiz'\r\n            WHEN 9 THEN 'Dokuz'\r\n          ELSE '' END+@Yed\r\n          SET @UcluHane=@Yed+@UcluHane;\r\n        END\r\n        IF (@BasamakYaz=1) SET @SONUC=@UcluHane+CASE @HangiBasamak\r\n          WHEN 1 THEN 'Bin'\r\n          WHEN 2 THEN 'Milyon'\r\n          WHEN 3 THEN 'Milyar'\r\n          WHEN 4 THEN 'Trilyon'\r\n          WHEN 5 THEN 'Katrilyon'\r\n          WHEN 6 THEN 'Kentrilyon'\r\n          WHEN 7 THEN 'Sekstilyon'\r\n          WHEN 8 THEN 'Septilyon'\r\n          WHEN 9 THEN 'Oktilyon'\r\n        ELSE '' END+@SONUC\r\n        SET @HangiBasamak=@HangiBasamak+1\r\n      END\r\n      IF (@Negatif=1) SET @SONUC='Eksi'+@SONUC\r\n    END\r\n  END\r\n  RETURN @SONUC\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "rap_pompersonel",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.rap_pompersonel",
    "definition": "CREATE FUNCTION dbo.rap_pompersonel (@VARNIN VARCHAR(8000))\r\nRETURNS\r\n@TB_POMPERSONEL_EKSTRE TABLE (\r\n    PER_KOD    VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    PER_AD     VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    NAKIT       FLOAT,\r\n    VERESIYE    FLOAT,\r\n    POS         FLOAT,\r\n    GIDER\t\tFLOAT,\r\n    ACIKFAZLA   FLOAT,\r\n    TOPTUTAR    FLOAT)\r\nAS\r\nBEGIN\r\n  DECLARE @POMPERSONEL_TEMP TABLE (\r\n    PER_KOD    VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    PER_AD     VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    NAKIT       FLOAT,\r\n    VERESIYE    FLOAT,\r\n    POS         FLOAT,\r\n    GIDER\t\tFLOAT,\r\n    ACIKFAZLA   FLOAT,\r\n    TOPTUTAR    FLOAT)\r\n\r\n  DECLARE @HRK_PER_KOD    VARCHAR(20)\r\n  DECLARE @HRK_PER_AD     VARCHAR(50)\r\n  DECLARE @HRK_NAKIT       FLOAT\r\n  DECLARE @HRK_VERESIYE    FLOAT\r\n  DECLARE @HRK_POS         FLOAT\r\n  DECLARE @HRK_ACIKFAZLA   FLOAT\r\n  DECLARE @HRK_TOPTUTAR    FLOAT\r\n\r\n\r\nINSERT @POMPERSONEL_TEMP (PER_KOD,PER_AD,NAKIT,VERESIYE,POS,GIDER,ACIKFAZLA,TOPTUTAR)\r\n      SELECT P.per,P.perad,0,0,0,0,p.perackfaz,0 FROM pomvardiper AS P with (nolock) \r\n      WHERE isnull(p.sil,0)=0 and p.varno in (select * from CsvToInt(@VARNIN))\r\n\r\n\r\n/*---NAKIT nakit toplam */\r\nupdate @POMPERSONEL_TEMP set NAKIT=dt.nak from @POMPERSONEL_TEMP t join\r\n(select perkod,isnull(sum(kur*(giren-cikan)),0) as nak from kasahrk  with (nolock) \r\nwhere kasahrk.varno in (select * from CsvToInt(@VARNIN))\r\nand yertip='pomvardimas' and islmhrk='TES' \r\nand sil=0 group by perkod) dt on t.PER_KOD=dt.perkod\r\n\r\n\r\n/*---VERESIYE  toplam */\r\nupdate @POMPERSONEL_TEMP set VERESIYE=dt.ver from @POMPERSONEL_TEMP t join\r\n(select perkod,isnull(sum(toptut),0) as ver from veresimas with (nolock)  \r\nwhere veresimas.varno in (select * from CsvToInt(@VARNIN))\r\nand yertip='pomvardimas' and sil=0 group by perkod) dt on t.PER_KOD=dt.perkod\r\n\r\n/*---POS toplam */\r\nupdate @POMPERSONEL_TEMP set POS=dt.pos from @POMPERSONEL_TEMP t join\r\n(select perkod,isnull(sum(kur*(giren-cikan)),0) as pos from poshrk  with (nolock) \r\nwhere poshrk.varno in (select * from CsvToInt(@VARNIN))\r\nand yertip='pomvardimas' and sil=0 group by perkod) dt on t.PER_KOD=dt.perkod\r\n\r\n\r\n/*---GIDER nakit toplam */\r\nupdate @POMPERSONEL_TEMP set GIDER=dt.nak from @POMPERSONEL_TEMP t join\r\n(select perkod,isnull(sum(kur*(cikan)),0) as nak from kasahrk  with (nolock) \r\nwhere kasahrk.varno in (select * from CsvToInt(@VARNIN))\r\nand yertip='pomvardimas' and islmtip='ODE'  and islmhrk='NAK'\r\nand cartip='gelgidkart' \r\nand sil=0 group by perkod) dt on t.PER_KOD=dt.perkod\r\n\r\n\r\n\r\n\r\nupdate @POMPERSONEL_TEMP set TOPTUTAR=(NAKIT+VERESIYE+POS+GIDER)\r\n\r\n\r\nINSERT @TB_POMPERSONEL_EKSTRE\r\n    SELECT PER_KOD,PER_AD,NAKIT,VERESIYE,POS,GIDER,ACIKFAZLA,TOPTUTAR\r\n     FROM @POMPERSONEL_TEMP\r\n\r\n\r\n\r\n  RETURN\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "rap_pomsayac",
    "type": "SQL_INLINE_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.rap_pomsayac",
    "definition": "CREATE FUNCTION dbo.rap_pomsayac(@varno float)\r\nRETURNS TABLE AS\r\nRETURN(SELECT  P.SAYACKOD,S.ad as SAYACAD,P.ADAD,P.ilkendk AS ILKENDKS,\r\nP.sonendk AS SONENDKS,P.satmik AS SATISMIKTAR,\r\nP.testmik AS TESTMIKTAR,P.brimfiy AS BRIMFIYAT,P.tutar AS TUTAR\r\nFROM  pomvardisayac AS P\r\nWITH(NOLOCK) INNER JOIN sayackart AS S\r\nON (P.sayackod=S.kod and p.varno=@varno)  )"
  },
  {
    "schema": "dbo",
    "name": "sayachrkvarmi",
    "type": "SQL_SCALAR_FUNCTION",
    "full_name": "dbo.sayachrkvarmi",
    "definition": "CREATE FUNCTION [dbo].sayachrkvarmi (@sayackod varchar(20))\r\nRETURNS bit\r\nAS\r\nBEGIN\r\ndeclare @sonuc bit\r\n\r\nif isnull((select count(*) from sayachrk with (NOLOCK) \r\nwhere sayackod=@sayackod and sil=0),0)=0\r\nset @sonuc=0\r\nelse\r\nset @sonuc=1\r\n\r\n\r\nRETURN @sonuc\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "sayimvarmi",
    "type": "SQL_SCALAR_FUNCTION",
    "full_name": "dbo.sayimvarmi",
    "definition": "CREATE FUNCTION dbo.sayimvarmi(\r\n@firmano\tint,\r\n@depkod \tvarchar(20),\r\n@stktip \tvarchar(10),\r\n@stkod \t\tvarchar(20))\r\nRETURNS int\r\nAS\r\nBEGIN\r\n declare @sayid \tint\r\n declare @sonuc \tint\r\n declare @SayimKont int\r\n \r\n   set @sonuc=0\r\n \r\n  select @SayimKont=isnull(SayimKont,0) From sistemtanim\r\n  \r\n\r\n  \r\n  if @SayimKont=1\r\n   select @sayid=count(h.sayid) from sayimhrk as h with (NOLOCK)\r\n    inner join sayimmas as m with (NOLOCK) on m.sayid=h.sayid\r\n    and h.depkod=@depkod and h.saydrm='B'\r\n    and h.stkod=@stkod and h.stktip=@stktip and m.drm='B' \r\n    and m.sil=0\r\n\r\n   if @sayid>0\r\n    set @sonuc=1\r\n\r\n\r\n\r\n RETURN @sonuc\r\n\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "sifirat",
    "type": "SQL_SCALAR_FUNCTION",
    "full_name": "dbo.sifirat",
    "definition": "CREATE FUNCTION [dbo].sifirat (@deger float,@tane int)\r\nRETURNS varchar(10)\r\nAS\r\nBEGIN\r\ndeclare @sonuc varchar(10)\r\ndeclare @ii int\r\n\r\nset @ii=LEN(@deger)\r\n\r\nset @sonuc=''\r\nwhile @tane>@ii begin\r\nset @sonuc=@sonuc+'0'\r\nset @ii=@ii+1\r\nend;\r\n\r\nset @sonuc=@sonuc+cast(@deger as varchar)\r\n\r\nRETURN @sonuc\r\n  \r\n  \r\nEND"
  },
  {
    "schema": "dbo",
    "name": "Stok_Brim_Carpan",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.Stok_Brim_Carpan",
    "definition": "CREATE FUNCTION [dbo].Stok_Brim_Carpan (@tip varchar(30),@kod varchar(30))\r\nRETURNS\r\n @TB_STOK_BRIM TABLE (\r\n    kod    VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    ad     VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    carpan      FLOAT)\r\nAS\r\nBEGIN\r\n\r\n    DECLARE @BRMKOD VARCHAR(20)\r\n    DECLARE @BRMCAR FLOAT\r\n    \r\n    DECLARE @BRMKOD1 VARCHAR(20)\r\n    DECLARE @BRMCAR1 FLOAT\r\n\r\n    DECLARE @BRMKOD2 VARCHAR(20)\r\n    DECLARE @BRMCAR2 FLOAT\r\n\r\n\r\n  if @tip='gelgid'\r\n   begin\r\n    SELECT @BRMKOD=brim,@BRMCAR=1\r\n    from gelgidkart with (NOLOCK) where kod=@kod and sil=0\r\n\r\n    insert into @TB_STOK_BRIM (kod,ad,carpan)\r\n    select @BRMKOD,k.ad,@BRMCAR from stkbrm as k with (NOLOCK) where kod=@BRMKOD\r\n    return\r\n   end\r\n\r\n\r\n    SELECT @BRMKOD=brim,@BRMCAR=1,\r\n    @BRMKOD1=brmust,@BRMCAR1=brmcarp,\r\n    @BRMKOD2=brmust2,@BRMCAR2=brmcarp2\r\n    from stokkart with (NOLOCK) where tip=@tip and kod=@kod and sil=0\r\n\r\n    if @BRMKOD<>''\r\n    insert into @TB_STOK_BRIM (kod,ad,carpan)\r\n    select @BRMKOD,k.ad,@BRMCAR from stkbrm as k with (NOLOCK) where kod=@BRMKOD \r\n    \r\n\r\n    if @BRMKOD1<>''\r\n    insert into @TB_STOK_BRIM (kod,ad,carpan)\r\n    select @BRMKOD1,k.ad,@BRMCAR1 from stkbrm as k with (NOLOCK) where kod=@BRMKOD1 \r\n    \r\n    \r\n    if @BRMKOD2<>''\r\n    insert into @TB_STOK_BRIM (kod,ad,carpan)\r\n    select @BRMKOD2,k.ad,@BRMCAR2 from stkbrm as k with (NOLOCK) where kod=@BRMKOD2 \r\n\r\n  \r\n  \r\nRETURN\r\n  \r\n  \r\nEND"
  },
  {
    "schema": "dbo",
    "name": "STOK_FIRMA_FIYAT_ANALIZ",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.STOK_FIRMA_FIYAT_ANALIZ",
    "definition": "CREATE FUNCTION [dbo].[STOK_FIRMA_FIYAT_ANALIZ] (\r\n@STOK_TIP VARCHAR(10),\r\n@STOK_KODIN VARCHAR (8000),\r\n@FIYTIP   INT,\r\n@KRITER   INT)\r\nRETURNS\r\n @TB_STOKFIY_ANALIZ TABLE (\r\n    FIRMANO\t\tINT,\r\n    FIRMAUNVAN\tVARCHAR(100) COLLATE Turkish_CI_AS,\r\n    STOK_ID\t\tINT,\r\n    STOK_TIP    VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    STOK_KOD    VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    STOK_AD     VARCHAR(100) COLLATE Turkish_CI_AS,\r\n    SATISFIYAT      FLOAT,\r\n    ALISFIYAT       FLOAT,\r\n    PARABIRIM         VARCHAR(20)  COLLATE Turkish_CI_AS)\r\n AS\r\n BEGIN\r\n\r\n DECLARE @TB_STOKFIY_TEMP TABLE (\r\n    FIRMANO\t\tINT,\r\n    STOK_ID\t\tINT,\r\n    STOK_TIP    VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    STOK_KOD    VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    STOK_AD     VARCHAR(100) COLLATE Turkish_CI_AS,\r\n    SATISFIYAT      FLOAT,\r\n    ALISFIYAT       FLOAT,\r\n    PARABIRIM         VARCHAR(20)  COLLATE Turkish_CI_AS)\r\n\r\n\r\n DECLARE @EKSTRE_IN TABLE (\r\n stkkod     varchar(30))\r\n\r\n declare @separator char(1)\r\n set @separator = ','\r\n\r\n declare @separator_position int\r\n declare @array_value varchar(1000)\r\n\r\n IF (LEN(RTRIM(@STOK_KODIN)) > 0)\r\n BEGIN\r\n  set @STOK_KODIN = @STOK_KODIN + ','\r\n END\r\n\r\n while patindex('%,%' , @STOK_KODIN) <> 0\r\n begin\r\n\r\n   select @separator_position =  patindex('%,%' , @STOK_KODIN)\r\n   select @array_value = left(@STOK_KODIN, @separator_position - 1)\r\n\r\n  Insert @EKSTRE_IN\r\n  Values (@array_value)\r\n\r\n   select @STOK_KODIN = stuff(@STOK_KODIN, 1, @separator_position, '')\r\n end\r\n\r\n  INSERT @TB_STOKFIY_TEMP\r\n  (FIRMANO,STOK_ID,STOK_TIP,STOK_KOD,STOK_AD,SATISFIYAT,ALISFIYAT,PARABIRIM)\r\n  SELECT f.Firmano,k.id,k.tip,k.kod,k.ad,0,\r\n  case when KdvTip=1 then Fiyat Else Fiyat*(1+(kdv/100)) end,F.ParaBrm\r\n  \r\n  /*\r\n  CASE\r\n  when @FIYTIP=1 and (K.sat1kdvtip='Dahil') then k.sat1fiy\r\n  when (@FIYTIP=1) and (K.sat1kdvtip='Hariç') then  k.sat1fiy*(1+(k.sat1kdv/100))\r\n  when @FIYTIP=2 and (K.sat2kdvtip='Dahil') then  k.sat2fiy\r\n  when (@FIYTIP=2) and (K.sat2kdvtip='Hariç') then k.sat2fiy*(1+(k.sat2kdv/100))\r\n  when @FIYTIP=3 and (K.sat3kdvtip='Dahil') then  k.sat3fiy\r\n  when (@FIYTIP=3) and (K.sat3kdvtip='Hariç') then k.sat3fiy*(1+(k.sat3kdv/100))\r\n  when @FIYTIP=4 and (K.sat4kdvtip='Dahil') then k.sat4fiy\r\n  when (@FIYTIP=4) and (K.sat4kdvtip='Hariç') then k.sat4fiy*(1+(k.sat4kdv/100)) end,\r\n  CASE when K.alskdvtip='Dahil' then  k.alsfiy\r\n  when (K.alskdvtip='Hariç') then  k.alsfiy*(1+(k.alskdv/100)) end,\r\n  CASE\r\n  WHEN @FIYTIP=1 then   k.sat1pbrm\r\n  WHEN @FIYTIP=2 then   k.sat2pbrm\r\n  WHEN @FIYTIP=3 then   k.sat1pbrm\r\n  WHEN @FIYTIP=4 then   k.sat4pbrm end\r\n*/\r\n  from stokkart k with (NOLOCK)\r\n  inner join Stok_Fiyat as F with (NOLOCK) on F.Stk_id=K.id and F.FiyTip=2\r\n  where k.tip=@STOK_TIP and k.sil=0 and k.kod in (select * FROM @EKSTRE_IN)\r\n  \r\n  \r\n   \r\n   update @TB_STOKFIY_TEMP Set SATISFIYAT=case when dt.KdvTip=1 then dt.Fiyat Else dt.Fiyat*(1+(dt.kdv/100)) end\r\n   from @TB_STOKFIY_TEMP as t join (select Firmano,Stk_id,Fiyat,KdvTip,Kdv from Stok_Fiyat as F with (NOLOCK)\r\n   where FiyTip=2 and FiyNo=@FIYTIP) dt \r\n   on Dt.Stk_id=T.STOK_ID and  t.FIRMANO=Dt.Firmano \r\n  \r\n \r\n  if @KRITER=0\r\n  INSERT @TB_STOKFIY_ANALIZ\r\n  (FIRMANO,STOK_TIP,STOK_KOD,STOK_AD,SATISFIYAT,ALISFIYAT,PARABIRIM)\r\n  SELECT FIRMANO,STOK_TIP,STOK_KOD,STOK_AD,SATISFIYAT,ALISFIYAT,PARABIRIM\r\n  FROM @TB_STOKFIY_TEMP WHERE ALISFIYAT>SATISFIYAT\r\n  \r\n  if @KRITER=1\r\n  INSERT @TB_STOKFIY_ANALIZ\r\n  (FIRMANO,STOK_TIP,STOK_KOD,STOK_AD,SATISFIYAT,ALISFIYAT,PARABIRIM)\r\n  SELECT FIRMANO,STOK_TIP,STOK_KOD,STOK_AD,SATISFIYAT,ALISFIYAT,PARABIRIM\r\n  FROM @TB_STOKFIY_TEMP WHERE SATISFIYAT=0\r\n\r\n\r\n  if @KRITER=2\r\n  INSERT @TB_STOKFIY_ANALIZ\r\n  (FIRMANO,STOK_TIP,STOK_KOD,STOK_AD,SATISFIYAT,ALISFIYAT,PARABIRIM)\r\n  SELECT FIRMANO,STOK_TIP,STOK_KOD,STOK_AD,SATISFIYAT,ALISFIYAT,PARABIRIM\r\n  FROM @TB_STOKFIY_TEMP WHERE ALISFIYAT=SATISFIYAT\r\n\r\n\r\n  if @KRITER=3\r\n  INSERT @TB_STOKFIY_ANALIZ\r\n  (FIRMANO,STOK_TIP,STOK_KOD,STOK_AD,SATISFIYAT,ALISFIYAT,PARABIRIM)\r\n  SELECT FIRMANO,STOK_TIP,STOK_KOD,STOK_AD,SATISFIYAT,ALISFIYAT,PARABIRIM\r\n  FROM @TB_STOKFIY_TEMP WHERE ALISFIYAT<SATISFIYAT\r\n\r\n\r\n  UPDATE @TB_STOKFIY_ANALIZ SET FIRMAUNVAN=dt.ad from @TB_STOKFIY_ANALIZ as t \r\n  join (Select id,Ad From Firma) dt on dt.id=t.FIRMANO\r\n\r\n\r\n\r\nRETURN\r\n \r\nEND"
  },
  {
    "schema": "dbo",
    "name": "STOK_FIYAT_ANALIZ",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.STOK_FIYAT_ANALIZ",
    "definition": "CREATE FUNCTION [dbo].STOK_FIYAT_ANALIZ (\r\n@STOK_TIP VARCHAR(10),\r\n@STOK_KODIN VARCHAR (8000),\r\n@FIYTIP   INT,\r\n@KRITER   INT)\r\nRETURNS\r\n @TB_STOKFIY_ANALIZ TABLE (\r\n    STOK_TIP    VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    STOK_KOD    VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    STOK_AD     VARCHAR(100) COLLATE Turkish_CI_AS,\r\n    SATISFIYAT      FLOAT,\r\n    ALISFIYAT       FLOAT,\r\n    PARABIRIM         VARCHAR(20)  COLLATE Turkish_CI_AS)\r\n AS\r\n BEGIN\r\n\r\n DECLARE @TB_STOKFIY_TEMP TABLE (\r\n    STOK_TIP    VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    STOK_KOD    VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    STOK_AD     VARCHAR(100) COLLATE Turkish_CI_AS,\r\n    SATISFIYAT      FLOAT,\r\n    ALISFIYAT       FLOAT,\r\n    PARABIRIM         VARCHAR(20)  COLLATE Turkish_CI_AS)\r\n\r\n\r\n DECLARE @EKSTRE_IN TABLE (\r\n stkkod     varchar(30))\r\n\r\n declare @separator char(1)\r\n set @separator = ','\r\n\r\n declare @separator_position int\r\n declare @array_value varchar(1000)\r\n\r\n IF (LEN(RTRIM(@STOK_KODIN)) > 0)\r\n BEGIN\r\n  set @STOK_KODIN = @STOK_KODIN + ','\r\n END\r\n\r\n while patindex('%,%' , @STOK_KODIN) <> 0\r\n begin\r\n\r\n   select @separator_position =  patindex('%,%' , @STOK_KODIN)\r\n   select @array_value = left(@STOK_KODIN, @separator_position - 1)\r\n\r\n  Insert @EKSTRE_IN\r\n  Values (@array_value)\r\n\r\n   select @STOK_KODIN = stuff(@STOK_KODIN, 1, @separator_position, '')\r\n end\r\n\r\n  INSERT @TB_STOKFIY_TEMP\r\n  (STOK_TIP,STOK_KOD,STOK_AD,SATISFIYAT,ALISFIYAT,PARABIRIM)\r\n  SELECT k.tip,k.kod,k.ad,\r\n  CASE\r\n  when @FIYTIP=1 and (K.sat1kdvtip='Dahil') then\r\n  k.sat1fiy\r\n  when (@FIYTIP=1) and (K.sat1kdvtip='Hariç') then\r\n  k.sat1fiy*(1+(k.sat1kdv/100))\r\n  when @FIYTIP=2 and (K.sat2kdvtip='Dahil') then\r\n  k.sat2fiy\r\n  when (@FIYTIP=2) and (K.sat2kdvtip='Hariç') then\r\n  k.sat2fiy*(1+(k.sat2kdv/100))\r\n  when @FIYTIP=3 and (K.sat3kdvtip='Dahil') then\r\n  k.sat3fiy\r\n  when (@FIYTIP=3) and (K.sat3kdvtip='Hariç') then\r\n  k.sat3fiy*(1+(k.sat3kdv/100))\r\n  when @FIYTIP=4 and (K.sat4kdvtip='Dahil') then\r\n  k.sat4fiy\r\n  when (@FIYTIP=4) and (K.sat4kdvtip='Hariç') then\r\n  k.sat4fiy*(1+(k.sat4kdv/100)) end,\r\n  CASE when K.alskdvtip='Dahil' then\r\n  k.alsfiy\r\n  when (K.alskdvtip='Hariç') then\r\n  k.alsfiy*(1+(k.alskdv/100)) end,\r\n  CASE\r\n  WHEN @FIYTIP=1 then\r\n  k.sat1pbrm\r\n  WHEN @FIYTIP=2 then\r\n  k.sat2pbrm\r\n  WHEN @FIYTIP=3 then\r\n  k.sat1pbrm\r\n  WHEN @FIYTIP=4 then\r\n  k.sat4pbrm end\r\n\r\n  from stokkart k with (NOLOCK)\r\n  where k.tip=@STOK_TIP and k.sil=0 and\r\n  k.kod in (select * FROM @EKSTRE_IN)\r\n  \r\n  \r\n  \r\n  if @KRITER=0\r\n  INSERT @TB_STOKFIY_ANALIZ\r\n  (STOK_TIP,STOK_KOD,STOK_AD,SATISFIYAT,ALISFIYAT,PARABIRIM)\r\n  SELECT STOK_TIP,STOK_KOD,STOK_AD,SATISFIYAT,ALISFIYAT,PARABIRIM\r\n  FROM @TB_STOKFIY_TEMP WHERE ALISFIYAT>SATISFIYAT\r\n  \r\n  if @KRITER=1\r\n  INSERT @TB_STOKFIY_ANALIZ\r\n  (STOK_TIP,STOK_KOD,STOK_AD,SATISFIYAT,ALISFIYAT,PARABIRIM)\r\n  SELECT STOK_TIP,STOK_KOD,STOK_AD,SATISFIYAT,ALISFIYAT,PARABIRIM\r\n  FROM @TB_STOKFIY_TEMP WHERE SATISFIYAT=0\r\n\r\n\r\n  if @KRITER=2\r\n  INSERT @TB_STOKFIY_ANALIZ\r\n  (STOK_TIP,STOK_KOD,STOK_AD,SATISFIYAT,ALISFIYAT,PARABIRIM)\r\n  SELECT STOK_TIP,STOK_KOD,STOK_AD,SATISFIYAT,ALISFIYAT,PARABIRIM\r\n  FROM @TB_STOKFIY_TEMP WHERE ALISFIYAT=SATISFIYAT\r\n\r\n\r\n  if @KRITER=3\r\n  INSERT @TB_STOKFIY_ANALIZ\r\n  (STOK_TIP,STOK_KOD,STOK_AD,SATISFIYAT,ALISFIYAT,PARABIRIM)\r\n  SELECT STOK_TIP,STOK_KOD,STOK_AD,SATISFIYAT,ALISFIYAT,PARABIRIM\r\n  FROM @TB_STOKFIY_TEMP WHERE ALISFIYAT<SATISFIYAT\r\n\r\n\r\nRETURN\r\n \r\nEND"
  },
  {
    "schema": "dbo",
    "name": "STOK_KOD_DEPO_DRM",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.STOK_KOD_DEPO_DRM",
    "definition": "CREATE FUNCTION [dbo].STOK_KOD_DEPO_DRM\r\n(@tip varchar(20),\r\n@kod  varchar(30))\r\nRETURNS\r\n  @TB_STOK_DEPO_DRM TABLE (\r\n    stok_tip             VARCHAR(10) COLLATE Turkish_CI_AS,\r\n    stok_kod             VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    stok_ad              VARCHAR(150) COLLATE Turkish_CI_AS,\r\n    depo_kod             VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    depo_ad              VARCHAR(100) COLLATE Turkish_CI_AS,\r\n    giren                FLOAT,\r\n    cikan                FLOAT,\r\n    kalan                FLOAT)\r\nAS\r\nBEGIN\r\n\r\n\r\n   insert into @TB_STOK_DEPO_DRM (stok_tip,stok_kod,stok_ad,\r\n   depo_kod,depo_ad,giren,cikan,kalan)\r\n   select k.tip,k.kod,k.ad,d.kod,d.ad,\r\n   sum(giren),sum(cikan),sum(giren-cikan)\r\n   from stokkart as k\r\n   left join stkhrk as h on \r\n   k.tip=h.stktip and k.kod=h.stkod\r\n   and h.sil=0 and k.sil=0\r\n   left join Depo_Kart_Listesi as d on d.kod=h.depkod\r\n   where k.tip=@tip and k.kod=@kod \r\n   group by k.tip,k.kod,k.ad,d.kod,d.ad\r\n\r\n\r\n  RETURN\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "Stok_Listesi",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.Stok_Listesi",
    "definition": "CREATE FUNCTION [dbo].[Stok_Listesi] (\r\n@firmano \t\tvarchar(500),\r\n@tip  \t\t\tvarchar(5),\r\n@tip_id \t\tint,\r\n@Dep_Tip \t\tvarchar(5),\r\n@Dep_id         varchar(500), \r\n@Depo_kod \t\tvarchar(1000)\r\n)\r\nRETURNS\r\n   @TB_STOK_LIST TABLE (\r\n    id\t\t\t\t\tint,\r\n    remote_id           int,\r\n    Tip_id              int,\r\n    firmano             int, \r\n    tip                 VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    kod                 VARCHAR(30) COLLATE Turkish_CI_AS, \r\n    ad                  VARCHAR(200) COLLATE Turkish_CI_AS, \r\n    barkod              VARCHAR(30) COLLATE Turkish_CI_AS, \r\n    grp1                int,\r\n    grp2                int,\r\n    grp3                int,\r\n    grup\t\t\t\tVARCHAR(100) COLLATE Turkish_CI_AS, \r\n    sat1fiy \t        float, \r\n    sat1kdv             float,\r\n    sat1kdvtip          VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    sat1pbrm            VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    sat2fiy \t        float,\r\n    sat2kdv             float,\r\n    sat2kdvtip          VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    sat2pbrm            VARCHAR(20) COLLATE Turkish_CI_AS,    \r\n    sat3fiy \t        float, \r\n    sat3kdv             float,\r\n    sat3kdvtip          VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    sat3pbrm            VARCHAR(20) COLLATE Turkish_CI_AS,    \r\n    sat4fiy \t        float, \r\n    sat4kdv             float,\r\n    sat4kdvtip          VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    sat4pbrm            VARCHAR(20) COLLATE Turkish_CI_AS,    \r\n    alsfiy              float,  \r\n    alskdv \t\t\t\tfloat,\t\r\n    alskdvtip \t\t\tVARCHAR(20) COLLATE Turkish_CI_AS,\r\n    alspbrm \t\t\tVARCHAR(20) COLLATE Turkish_CI_AS,\r\n    kesft\t\t\t\tfloat,\r\n    brim                VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    otv\t\t\t\t\tfloat,\r\n    eksat\t\t\t\tVARCHAR(20) COLLATE Turkish_CI_AS,\r\n    minmik              float,\r\n    drm\t\t\t\t\tVarchar(10),\r\n    zrapor\t\t\t\ttinyint,\r\n    muhonkod            VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    muhgrskod           VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    muhckskod\t\t\tVARCHAR(20) COLLATE Turkish_CI_AS,\r\n    muh_als_iad_kod     VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    muh_sat_iad_kod\t\tVARCHAR(20) COLLATE Turkish_CI_AS,\r\n    muh_als_isk_kod     VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    muh_sat_isk_kod\t\tVARCHAR(20) COLLATE Turkish_CI_AS,\r\n    muh_als_otv_kod     VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    muh_sat_otv_kod\t\tVARCHAR(20) COLLATE Turkish_CI_AS,\r\n    muh_sat_mal_kod\t\tVARCHAR(20) COLLATE Turkish_CI_AS,\r\n    brmcarp             float,\r\n    brmust              VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    ykno                VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    sil                 tinyint,\r\n    olususer\t\t\tVARCHAR(100) COLLATE Turkish_CI_AS,\r\n    olustarsaat         Datetime,\r\n    deguser\t\t\t\tVARCHAR(100) COLLATE Turkish_CI_AS,\r\n    degtarsaat\t\t\tDatetime,\t\r\n    dataok              Tinyint,\r\n    acmik               float,\r\n    Prom  \t\t\t\tbit,\r\n    Prom_Urun\t\t\tbit,\r\n    Prom_Kac_Satis\t\tint,\r\n    Prom_Sat_Tip\t\tint,\r\n    Prom_Sat_Puan\t\tfloat,\r\n    Puan_Brm\t\t\tfloat,\r\n    karoran1            float,\r\n    karoran2\t\t\tfloat,\r\n    grpkdvoran\t\t\tfloat,\r\n    alsiademik\t\t\tfloat,\r\n    satiademik\t\t\tfloat,\r\n    brmust2\t\t\t\tVARCHAR(20) COLLATE Turkish_CI_AS,\r\n    brmcarp2\t\t\tfloat,\r\n    har_miktar\t\t\tfloat,\r\n    gir_miktar\t\t\tfloat,\r\n    cik_miktar\t\t\tfloat,\r\n    gir_topkdvli\t\tfloat,\r\n    gir_topkdvsiz\t\tfloat,\r\n    cik_topkdvli\t\tfloat,\r\n    cik_topkdvsiz\t\tfloat,\r\n    mev_miktar\t\t\tfloat,\r\n    alsiade_mik\t\t\tfloat,\r\n    satiade_mik\t\t\tfloat,\r\n    alsiade_topkdvli\tfloat,\r\n    satiade_topkdvli\tfloat,\r\n    ortals_fiykdvli\t\tfloat,\r\n    ortals_fiykdvsiz\tfloat,\r\n    \r\n    alsiadesiztopmik\tfloat,\r\n    satiadesiztopmik\tfloat,\r\n    alsiadesiztoptut\tfloat,\r\n    satiadesiztoptut    float,\r\n    agirorttoptut\t\tfloat,\r\n    \r\n    satfiykdvli\t\t\tfloat,\r\n    satfiykdvsiz\t\tfloat,\r\n   \r\n    sat2fiykdvli\t\tfloat,\r\n    sat2fiykdvsiz\t\tfloat,\r\n    \r\n    sat3fiykdvli\t\tfloat,\r\n    sat3fiykdvsiz\t\tfloat,\r\n    \r\n    sat4fiykdvli\t\tfloat,\r\n    sat4fiykdvsiz\t\tfloat,\r\n    alsfiykdvli\t\t\tfloat,\r\n    alsfiykdvsiz\t\tfloat,\r\n    kalsattopkdvsiz\t\tfloat,\r\n    kalsattopkdvli\t\tfloat,\r\n    kalalstopkdvsiz\t\tfloat,\r\n    kalalstopkdvli\t\tfloat,\r\n    ozel_kod1\t\t\tint,\r\n    ozel_kod2\t\t\tint,\r\n    ozel_kod1_ad    \tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n    ozel_kod2_ad\t\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n    Gtip\t\t\t\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n    Yerli \t\t\t\tbit Default 0 ,\r\n    UretimYerId\t\t\tint Default 0,\r\n    UretimYerAd\t\t\tVARCHAR(100) COLLATE Turkish_CI_AS,\r\n    SatisFiyat1DegisimTarih Datetime,\r\n    SatisFiyat2DegisimTarih Datetime,\r\n    SatisFiyat3DegisimTarih Datetime,\r\n    SatisFiyat4DegisimTarih Datetime,\r\n    BagliCariKod            varchar(50),\r\n    BagliCariUnvan          varchar(250)\r\n    PRIMARY KEY ([id])\r\n    /* PRIMARY KEY ([id],[tip],[sil]) */\r\n   )\r\nAS\r\nBEGIN\r\n\r\n\r\n  DECLARE @TB_TEMP_STOKLIST\r\n   TABLE (\r\n     tip     varchar(20),\r\n     kod     varchar(30),\r\n     har_miktar float,\r\n     gir_miktar   float,\r\n     cik_miktar   float,\r\n     gir_topkdvli  float,\r\n     gir_topkdvsiz  float,\r\n     cik_topkdvli   float,\r\n     cik_topkdvsiz  float,\r\n     mev_miktar    float,\r\n     alsiade_mik  float, \r\n     satiade_mik  float,\r\n     alsiade_topkdvli    float,\r\n     satiade_topkdvli   float,\r\n     ortals_fiykdvli   float,\r\n     ortals_fiykdvsiz    float\r\n     )\r\n   \r\n\r\n\r\n\r\n declare @onda_tip  int\r\n \r\n  set @onda_tip=2\r\n \r\n   \r\n     insert into @TB_STOK_LIST (id,remote_id,firmano,tip,kod,\r\n     ad,barkod,grp1,grp2,grp3,\r\n     sat1fiy,sat1kdv,sat1kdvtip,sat1pbrm,\r\n     sat2fiy,sat2kdv,sat2kdvtip,sat2pbrm,\r\n     sat3fiy,sat3kdv,sat3kdvtip,sat3pbrm,\r\n     sat4fiy,sat4kdv,sat4kdvtip,sat4pbrm,\r\n     alsfiy,alskdv,alskdvtip,alspbrm,\r\n     kesft,brim,otv,eksat,\r\n     minmik,drm,zrapor,\r\n     Prom,Prom_Urun,Prom_Kac_Satis,\r\n     Prom_Sat_Tip,Prom_Sat_Puan,\r\n     Puan_Brm,\r\n          \r\n     muhonkod,muhgrskod,muhckskod,\r\n     muh_als_iad_kod,muh_sat_iad_kod,\r\n     muh_als_isk_kod,muh_sat_isk_kod,\r\n     muh_als_otv_kod,muh_sat_otv_kod,\r\n     muh_sat_mal_kod,brmcarp,brmust,ykno,\r\n     sil,olususer,olustarsaat,\r\n     deguser,degtarsaat,dataok,\r\n     acmik,karoran1,karoran2,grpkdvoran,\r\n     alsiademik,satiademik,brmust2,brmcarp2, \r\n     ozel_kod1,ozel_kod2,Gtip,Yerli,UretimYerId,\r\n     SatisFiyat1DegisimTarih,SatisFiyat2DegisimTarih,\r\n     SatisFiyat3DegisimTarih,SatisFiyat4DegisimTarih,\r\n     BagliCariKod)\r\n       select id,remote_id,firmano,tip,kod,\r\n       ad,barkod,grp1,grp2,grp3,\r\n       sat1fiy,sat1kdv,sat1kdvtip,sat1pbrm,\r\n       sat2fiy,sat2kdv,sat2kdvtip,sat2pbrm,\r\n       sat3fiy,sat3kdv,sat3kdvtip,sat3pbrm,\r\n       sat4fiy,sat4kdv,sat4kdvtip,sat4pbrm,\r\n       alsfiy,alskdv,alskdvtip,alspbrm,\r\n       kesft,brim,otv,eksat,\r\n       minmik,drm,zrapor,\r\n       Prom,Prom_Urun,Prom_Kac_Satis,\r\n       Prom_Sat_Tip,Prom_Sat_Puan,\r\n       Puan_Brm,\r\n       muhonkod,muhgrskod,muhckskod,\r\n       muh_als_iad_kod,muh_sat_iad_kod,\r\n       muh_als_isk_kod,muh_sat_isk_kod,\r\n       muh_als_otv_kod,muh_sat_otv_kod,\r\n       muh_sat_mal_kod,brmcarp,brmust,ykno,\r\n       sil,olususer,olustarsaat,\r\n       deguser,degtarsaat,dataok,\r\n       acmik,karoran1,karoran2,grpkdvoran,\r\n       alsiademik,satiademik,brmust2,brmcarp2, \r\n       ozel_kod1,ozel_kod2,Gtip,Yerli,UretimYerId,\r\n       SatisFiyat1DegisimTarih,SatisFiyat2DegisimTarih,\r\n       SatisFiyat3DegisimTarih,SatisFiyat4DegisimTarih,\r\n       BagliCariKod\r\n        from stokkart with (NOLOCK) where tip=@tip \r\n        \r\n  \r\n   if @Depo_kod<>'' \r\n   insert @TB_TEMP_STOKLIST (tip,kod,har_miktar,gir_miktar,cik_miktar,gir_topkdvli,gir_topkdvsiz,\r\n   cik_topkdvli,cik_topkdvsiz,mev_miktar,alsiade_mik,satiade_mik,alsiade_topkdvli,satiade_topkdvli,\r\n   ortals_fiykdvli,ortals_fiykdvsiz )\r\n   select stktip,stkod,har_miktar,\r\n      gir_miktar,cik_miktar,gir_topkdvli,gir_topkdvsiz,\r\n      cik_topkdvli,cik_topkdvsiz,mev_miktar,\r\n      alsiade_mik,alsiade_topkdvli,satiade_mik,\r\n      satiade_topkdvli,ortals_fiykdvli,\r\n      ortals_fiykdvsiz\r\n      from StokDepoDurum as Mk with (nolock)\r\n      where mk.stktip=@tip and  mk.depkod=@Depo_kod \r\n  \r\n    if @firmano<>''\r\n     insert @TB_TEMP_STOKLIST (tip,kod,har_miktar,gir_miktar,cik_miktar,gir_topkdvli,gir_topkdvsiz,\r\n      cik_topkdvli,cik_topkdvsiz,mev_miktar,alsiade_mik,satiade_mik,alsiade_topkdvli,satiade_topkdvli,\r\n      ortals_fiykdvli,ortals_fiykdvsiz )\r\n      select stktip,stkod,har_miktar,\r\n      gir_miktar,cik_miktar,gir_topkdvli,gir_topkdvsiz,\r\n      cik_topkdvli,cik_topkdvsiz,mev_miktar,\r\n      alsiade_mik,alsiade_topkdvli,satiade_mik,\r\n      satiade_topkdvli,ortals_fiykdvli,\r\n      ortals_fiykdvsiz\r\n      from StokFirmaDurum as Mk with (nolock)\r\n      where mk.stktip=@tip and mk.firmano in (Select * From CsvToInt(@firmano))\r\n\r\n    \r\n \r\n     \r\n     update @TB_STOK_LIST\r\n     set har_miktar=dt.har_miktar,\r\n     gir_miktar=dt.gir_miktar,\r\n     cik_miktar=dt.cik_miktar,\r\n     gir_topkdvli=dt.gir_topkdvli,\r\n     gir_topkdvsiz=dt.gir_topkdvsiz,\r\n     cik_topkdvli=dt.cik_topkdvli,\r\n     cik_topkdvsiz=dt.cik_topkdvsiz,\r\n     mev_miktar=isnull(dt.mev_miktar,0),\r\n     alsiade_mik=dt.alsiade_mik, /*alsiademik */\r\n     satiade_mik=dt.satiade_mik,  /*satiademik */\r\n     alsiade_topkdvli=dt.alsiade_topkdvli,\r\n     satiade_topkdvli=dt.satiade_topkdvli,\r\n     ortals_fiykdvli=dt.ortals_fiykdvli,\r\n     ortals_fiykdvsiz=dt.ortals_fiykdvsiz\r\n     from @TB_STOK_LIST as t join ( \r\n     select \r\n      tip,kod,sum(har_miktar) har_miktar,\r\n      sum(gir_miktar) gir_miktar ,sum(cik_miktar)cik_miktar,\r\n      sum(gir_topkdvli) gir_topkdvli,sum(gir_topkdvsiz) gir_topkdvsiz,\r\n      sum(cik_topkdvli) cik_topkdvli,sum(cik_topkdvsiz) cik_topkdvsiz,\r\n      sum(mev_miktar) mev_miktar,Sum(alsiade_mik) alsiade_mik,\r\n      sum(alsiade_topkdvli) alsiade_topkdvli ,Sum(satiade_mik) satiade_mik, \r\n      sum(satiade_topkdvli) satiade_topkdvli,\r\n      avg(ortals_fiykdvli) ortals_fiykdvli, avg(ortals_fiykdvsiz) ortals_fiykdvsiz\r\n      from @TB_TEMP_STOKLIST as Mk group by Tip,Kod ) dt on\r\n       dt.tip=t.tip and dt.kod=t.kod  \r\n      \r\n   \r\n \r\n    update @TB_STOK_LIST\r\n     set har_miktar=isnull(har_miktar,0),\r\n     gir_miktar=isnull(gir_miktar,0),\r\n     cik_miktar=isnull(cik_miktar,0),\r\n     gir_topkdvli=isnull(gir_topkdvli,0),\r\n     gir_topkdvsiz=isnull(gir_topkdvsiz,0),\r\n     cik_topkdvli=isnull(cik_topkdvli,0),\r\n     cik_topkdvsiz=isnull(cik_topkdvsiz,0),\r\n     mev_miktar=isnull(mev_miktar,0),\r\n     alsiade_mik=isnull(alsiade_mik,0), \r\n     satiade_mik=isnull(satiade_mik,0),\r\n     alsiade_topkdvli=isnull(alsiade_topkdvli,0),\r\n     satiade_topkdvli=isnull(satiade_topkdvli,0),\r\n     ortals_fiykdvli=isnull(ortals_fiykdvli,0),\r\n     ortals_fiykdvsiz=isnull(ortals_fiykdvsiz,0)\r\n     \r\n     \r\n   update @TB_STOK_LIST\r\n   set\r\n   alsiadesiztopmik=(gir_miktar-(satiade_mik+alsiade_mik)),\r\n   satiadesiztopmik=(cik_miktar-(satiade_mik+alsiade_mik)) ,\r\n   alsiadesiztoptut=(gir_miktar-(satiade_mik+alsiade_mik))*(alsfiy) ,\r\n   satiadesiztoptut=(cik_miktar-(satiade_mik+alsiade_mik))*\r\n    (case when sat1kdvtip='Dahil' then sat1fiy else sat1fiy*(1+(sat1kdv/100)) end ),\r\n    agirorttoptut=(mev_miktar)*(ortals_fiykdvli) ,\r\n  \r\n   satfiykdvli=case when sat1kdvtip='Dahil' then sat1fiy else sat1fiy*(1+(sat1kdv/100)) end,\r\n   satfiykdvsiz=case when sat1kdvtip='Hariç' then sat1fiy else sat1fiy/(1+(sat1kdv/100)) end ,\r\n   \r\n   sat2fiykdvli=case when sat2kdvtip='Dahil' then sat2fiy else sat2fiy*(1+(sat2kdv/100)) end,\r\n   sat2fiykdvsiz=case when sat2kdvtip='Hariç' then sat2fiy else sat2fiy/(1+(sat2kdv/100)) end ,\r\n\r\n   sat3fiykdvli=case when sat3kdvtip='Dahil' then sat3fiy else sat3fiy*(1+(sat3kdv/100)) end,\r\n   sat3fiykdvsiz=case when sat3kdvtip='Hariç' then sat3fiy else sat3fiy/(1+(sat3kdv/100)) end ,\r\n\r\n   sat4fiykdvli=case when sat4kdvtip='Dahil' then sat4fiy else sat4fiy*(1+(sat4kdv/100)) end,\r\n   sat4fiykdvsiz=case when sat4kdvtip='Hariç' then sat4fiy else sat4fiy/(1+(sat4kdv/100)) end ,\r\n   \r\n   \r\n   alsfiykdvli=case when alskdvtip='Dahil' then alsfiy else alsfiy*(1+(alskdv/100)) end ,\r\n   alsfiykdvsiz=case when alskdvtip='Hariç' then alsfiy else alsfiy/(1+(alskdv/100)) end ,\r\n\r\n   kalsattopkdvsiz=case when sat1kdvtip='Hariç' then (mev_miktar)*sat1fiy\r\n   else (mev_miktar)*(sat1fiy/(1+(sat1kdv/100))) end ,\r\n   kalsattopkdvli=case when sat1kdvtip='Dahil' then (mev_miktar)*sat1fiy\r\n   else (mev_miktar)*(sat1fiy*(1+(sat1kdv/100))) end ,\r\n   kalalstopkdvsiz=case when alskdvtip='Hariç' then (mev_miktar)*alsfiy\r\n   else (mev_miktar)*(alsfiy/(1+(alskdv/100))) end,\r\n   kalalstopkdvli=case when alskdvtip='Dahil' then (mev_miktar)*alsfiy\r\n   else (mev_miktar)*(alsfiy*(1+(alskdv/100))) end\r\n    \r\n   \r\n   update @TB_STOK_LIST set \r\n   ozel_kod1_ad=o.ad\r\n   from @TB_STOK_LIST inner join Ozel_Kod as o on \r\n   ozel_kod1=o.id\r\n     \r\n   update @TB_STOK_LIST set \r\n   ozel_kod2_ad=o.ad\r\n   from @TB_STOK_LIST inner join Ozel_Kod as o on \r\n   ozel_kod2=o.id\r\n   \r\n   \r\n   update @TB_STOK_LIST set \r\n   grup=g.ad\r\n   from @TB_STOK_LIST  as s\r\n   left join grup as g  on g.id=case when s.grp3>0 then s.grp3\r\n   when s.grp2>0 then s.grp2\r\n   when s.grp1>0 then s.grp1 end \r\n   \r\n   \r\n   update @TB_STOK_LIST set \r\n   UretimYerAd=g.ad\r\n   from @TB_STOK_LIST  as s\r\n   left join UlkeList as g  on g.Id=s.UretimYerId \r\n   \r\n   \r\n   update @TB_STOK_LIST set \r\n   BagliCariUnvan=g.Unvan\r\n   from @TB_STOK_LIST  as s\r\n   left join carikart as g  on g.Kod=s.BagliCariKod  \r\n   \r\n \r\n RETURN\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "STOK_SAYIM_GRUP_DEPO",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.STOK_SAYIM_GRUP_DEPO",
    "definition": "CREATE FUNCTION [dbo].STOK_SAYIM_GRUP_DEPO (\r\n@sayim      int,\r\n@stkgrp1id   int,\r\n@stkgrp2id   int,\r\n@stkgrp3id   int,\r\n@depokod    varchar(30),\r\n@tarih      datetime)\r\nRETURNS\r\n  @TB_STOK_SAYIM_GRUP_DEPO TABLE (\r\n    DEP_KOD             VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    STOK_TIP            VARCHAR(10) COLLATE Turkish_CI_AS,\r\n    STOK_KOD            VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    MIKTAR              FLOAT,\r\n    ORT_BRMFIY_D        FLOAT,\r\n    ORT_BRMFIY_H        FLOAT,\r\n    SAT1_BRMFIY_D       FLOAT,\r\n    SAT1_BRMFIY_H       FLOAT,\r\n    SAT2_BRMFIY_D       FLOAT,\r\n    SAT2_BRMFIY_H       FLOAT,\r\n    ALS_BRMFIY_D        FLOAT,\r\n    ALS_BRMFIY_H        FLOAT,\r\n    SAT1_KDV_YUZ        FLOAT,\r\n    SAT2_KDV_YUZ        FLOAT,\r\n    ALS_KDV_YUZ         FLOAT\r\n    )\r\nAS\r\nBEGIN\r\n\r\n\r\n  insert into @TB_STOK_SAYIM_GRUP_DEPO\r\n  (DEP_KOD,STOK_TIP,STOK_KOD,MIKTAR,\r\n  ORT_BRMFIY_D,ORT_BRMFIY_H,SAT1_BRMFIY_D,SAT1_BRMFIY_H,\r\n  SAT2_BRMFIY_D,SAT2_BRMFIY_H,ALS_BRMFIY_D,ALS_BRMFIY_H,\r\n  SAT1_KDV_YUZ,SAT2_KDV_YUZ,ALS_KDV_YUZ)\r\n  select @depokod,k.tip,k.kod,isnull(sum(h.giren-cikan),0),\r\n  isnull( case when sum(h.giren)>0 then\r\n  (sum(h.giren*h.brmfiykdvli)) / sum(h.giren)\r\n  else 0 end , 0)  ortfiykdvli,\r\n  isnull( case when sum(h.giren)>0 then\r\n  (sum(h.giren*(h.brmfiykdvli / (1+kdvyuz)) )) / sum(h.giren)\r\n  else 0 end , 0)  ortfiykdvsiz,\r\n  case when k.sat1kdvtip='Dahil' then k.sat1fiy else k.sat1fiy*(1+(k.sat1kdv/100)) end sat1fiykdvli,\r\n  case when k.sat1kdvtip='Hariç' then k.sat1fiy else k.sat1fiy/(1+(k.sat1kdv/100)) end sat1fiykdvsiz,\r\n  case when k.sat2kdvtip='Dahil' then k.sat2fiy else k.sat2fiy*(1+(k.sat2kdv/100)) end sat2fiykdvli,\r\n  case when k.sat2kdvtip='Hariç' then k.sat2fiy else k.sat2fiy/(1+(k.sat2kdv/100)) end sat2fiykdvsiz,\r\n  case when k.alskdvtip='Dahil' then k.alsfiy else k.alsfiy*(1+(k.alskdv/100)) end  alsfiykdvli,\r\n  case when k.alskdvtip='Hariç' then k.alsfiy else k.alsfiy/(1+(k.alskdv/100)) end  alsfiykdvsiz,\r\n  k.sat1kdv/100,k.sat2kdv/100,k.alskdv/100\r\n  from stokkart as k with (nolock)\r\n  left join stkhrk as h with (nolock) on h.stktip=k.tip and h.stkod=k.kod\r\n  and h.depkod=@depokod\r\n  and (h.tarih+cast(h.saat as datetime))<=@tarih\r\n  and h.sil=0\r\n  where k.sil=0\r\n  and k.grp1=@stkgrp1id\r\n  and k.grp2=@stkgrp2id\r\n  and k.grp3=@stkgrp3id\r\n  group by k.tip,k.kod,\r\n  k.sat1fiy,k.sat1kdvtip,k.sat1kdv,\r\n  k.sat2fiy,k.sat2kdvtip,k.sat2kdv,\r\n  k.alsfiy,k.alskdvtip,k.alskdv\r\n  \r\n  \r\n\r\n  RETURN\r\n  \r\nEND"
  },
  {
    "schema": "dbo",
    "name": "STOK_SAYIM_GRUP_FIRMA_DEPO",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.STOK_SAYIM_GRUP_FIRMA_DEPO",
    "definition": "CREATE FUNCTION [dbo].[STOK_SAYIM_GRUP_FIRMA_DEPO] (\r\n@sayid       int,\r\n@stkgrp1id   int,\r\n@stkgrp2id   int,\r\n@stkgrp3id   int,\r\n@depokod    varchar(30),\r\n@tarih      datetime)\r\nRETURNS\r\n  @TB_STOK_SAYIM_GRUP_DEPO TABLE (\r\n    FIRMANO            INT,\r\n    DEP_KOD             VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    STOK_ID             INT,\r\n    STOK_TIP            VARCHAR(10) COLLATE Turkish_CI_AS,\r\n    STOK_KOD            VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    MIKTAR              FLOAT,\r\n    ORT_BRMFIY_D        FLOAT,\r\n    ORT_BRMFIY_H        FLOAT,\r\n    SAT1_BRMFIY_D       FLOAT,\r\n    SAT1_BRMFIY_H       FLOAT,\r\n    SAT2_BRMFIY_D       FLOAT,\r\n    SAT2_BRMFIY_H       FLOAT,\r\n    ALS_BRMFIY_D        FLOAT,\r\n    ALS_BRMFIY_H        FLOAT,\r\n    SAT1_KDV_YUZ        FLOAT,\r\n    SAT2_KDV_YUZ        FLOAT,\r\n    ALS_KDV_YUZ         FLOAT\r\n    )\r\nAS\r\nBEGIN\r\n\r\n   declare @Market_Sube  int\r\n   Declare @Firmano int\r\n   select @Firmano=firmano from sayimmas with (nolock)\r\n   where id=@sayid\r\n   \r\n   Select @Market_Sube=Market_Sube  from sistemtanim\r\n   \r\n if @Firmano>0 \r\n  begin\r\n    insert into @TB_STOK_SAYIM_GRUP_DEPO\r\n    (FIRMANO,DEP_KOD,STOK_ID,STOK_TIP,STOK_KOD,MIKTAR,\r\n    ORT_BRMFIY_D,ORT_BRMFIY_H,SAT1_BRMFIY_D,SAT1_BRMFIY_H,\r\n    SAT2_BRMFIY_D,SAT2_BRMFIY_H,ALS_BRMFIY_D,ALS_BRMFIY_H,\r\n    SAT1_KDV_YUZ,SAT2_KDV_YUZ,ALS_KDV_YUZ)\r\n    select @Firmano,@depokod,k.id,k.tip,k.kod,\r\n    isnull(sum(h.giren-cikan),0),\r\n    isnull( case when sum(h.giren)>0 then\r\n    (sum(h.giren*h.brmfiykdvli)) / sum(h.giren)\r\n    else 0 end , 0)  ortfiykdvli,\r\n    isnull( case when sum(h.giren)>0 then\r\n    (sum(h.giren*(h.brmfiykdvli / (1+kdvyuz)) )) / sum(h.giren)\r\n    else 0 end , 0)  ortfiykdvsiz,\r\n    case when k.sat1kdvtip='Dahil' then k.sat1fiy else k.sat1fiy*(1+(k.sat1kdv/100)) end sat1fiykdvli,\r\n    case when k.sat1kdvtip='Hariç' then k.sat1fiy else k.sat1fiy/(1+(k.sat1kdv/100)) end sat1fiykdvsiz,\r\n    case when k.sat2kdvtip='Dahil' then k.sat2fiy else k.sat2fiy*(1+(k.sat2kdv/100)) end sat2fiykdvli,\r\n    case when k.sat2kdvtip='Hariç' then k.sat2fiy else k.sat2fiy/(1+(k.sat2kdv/100)) end sat2fiykdvsiz,\r\n    case when k.alskdvtip='Dahil' then k.alsfiy else k.alsfiy*(1+(k.alskdv/100)) end  alsfiykdvli,\r\n    case when k.alskdvtip='Hariç' then k.alsfiy else k.alsfiy/(1+(k.alskdv/100)) end  alsfiykdvsiz,\r\n    k.sat1kdv/100,k.sat2kdv/100,k.alskdv/100\r\n    from stokkart as k with (nolock)\r\n    left join stkhrk as h with (nolock) on h.stktip=k.tip and h.stkod=k.kod\r\n    and h.depkod=@depokod and isnull(h.firmano,0) in (0,@Firmano)\r\n    and (h.tarih+cast(h.saat as datetime))<=@tarih\r\n    and h.sil=0\r\n    where k.sil=0\r\n    and k.grp1=@stkgrp1id\r\n    and k.grp2=@stkgrp2id\r\n    and k.grp3=@stkgrp3id\r\n    group by k.id,k.tip,k.kod,\r\n    k.sat1fiy,k.sat1kdvtip,k.sat1kdv,\r\n    k.sat2fiy,k.sat2kdvtip,k.sat2kdv,\r\n    k.alsfiy,k.alskdvtip,k.alskdv\r\n    \r\n    \r\n    if @Market_Sube=1\r\n     begin\r\n      update @TB_STOK_SAYIM_GRUP_DEPO set\r\n      SAT1_BRMFIY_D=dt.SatisFiyat1KdvDahil,\r\n      SAT1_BRMFIY_H=dt.SatisFiyat1KdvDahil/(1+(dt.SatisFiyat1Kdv/100)) ,\r\n      SAT2_BRMFIY_D=dt.SatisFiyat2KdvDahil,\r\n      SAT2_BRMFIY_H=dt.SatisFiyat2KdvDahil/(1+(dt.SatisFiyat1Kdv/100)) ,\r\n      ALS_BRMFIY_D=dt.AlisFiyatKdvDahil,\r\n      ALS_BRMFIY_H=dt.AlisFiyatKdvDahil/ (1+(dt.AlisFiyatKdv/100)) \r\n      \r\n      from @TB_STOK_SAYIM_GRUP_DEPO as t \r\n      join (select StkId,SatisFiyat1KdvDahil,SatisFiyat1Kdv,\r\n      SatisFiyat2KdvDahil,SatisFiyat2Kdv,\r\n      AlisFiyatKdvDahil,AlisFiyatKdv  from  V_StokFirmaSubeFiyat \r\n      WHERE firmano=@Firmano ) dt on \r\n      dt.StkId=t.STOK_ID\r\n   \r\n     end\r\n   end\r\n   \r\n  if @Firmano=0 \r\n   begin\r\n   \r\n   insert into @TB_STOK_SAYIM_GRUP_DEPO\r\n    (FIRMANO,DEP_KOD,STOK_ID,STOK_TIP,STOK_KOD,MIKTAR,\r\n    ORT_BRMFIY_D,ORT_BRMFIY_H,SAT1_BRMFIY_D,SAT1_BRMFIY_H,\r\n    SAT2_BRMFIY_D,SAT2_BRMFIY_H,ALS_BRMFIY_D,ALS_BRMFIY_H,\r\n    SAT1_KDV_YUZ,SAT2_KDV_YUZ,ALS_KDV_YUZ)\r\n    select @Firmano,@depokod,k.id,k.tip,k.kod,isnull(sum(h.giren-cikan),0),\r\n    isnull( case when sum(h.giren)>0 then\r\n    (sum(h.giren*h.brmfiykdvli)) / sum(h.giren)\r\n    else 0 end , 0)  ortfiykdvli,\r\n    isnull( case when sum(h.giren)>0 then\r\n    (sum(h.giren*(h.brmfiykdvli / (1+kdvyuz)) )) / sum(h.giren)\r\n    else 0 end , 0)  ortfiykdvsiz,\r\n    case when k.sat1kdvtip='Dahil' then k.sat1fiy else k.sat1fiy*(1+(k.sat1kdv/100)) end sat1fiykdvli,\r\n    case when k.sat1kdvtip='Hariç' then k.sat1fiy else k.sat1fiy/(1+(k.sat1kdv/100)) end sat1fiykdvsiz,\r\n    case when k.sat2kdvtip='Dahil' then k.sat2fiy else k.sat2fiy*(1+(k.sat2kdv/100)) end sat2fiykdvli,\r\n    case when k.sat2kdvtip='Hariç' then k.sat2fiy else k.sat2fiy/(1+(k.sat2kdv/100)) end sat2fiykdvsiz,\r\n    case when k.alskdvtip='Dahil' then k.alsfiy else k.alsfiy*(1+(k.alskdv/100)) end  alsfiykdvli,\r\n    case when k.alskdvtip='Hariç' then k.alsfiy else k.alsfiy/(1+(k.alskdv/100)) end  alsfiykdvsiz,\r\n    k.sat1kdv/100,k.sat2kdv/100,k.alskdv/100\r\n    from stokkart as k with (nolock)\r\n    left join stkhrk as h with (nolock) on h.stktip=k.tip and h.stkod=k.kod\r\n    and h.depkod=@depokod /*and h.firmano=@Firmano */\r\n    and (h.tarih+cast(h.saat as datetime))<=@tarih\r\n    and h.sil=0\r\n    where k.sil=0\r\n    and k.grp1=@stkgrp1id\r\n    and k.grp2=@stkgrp2id\r\n    and k.grp3=@stkgrp3id\r\n    group by k.id,k.tip,k.kod,\r\n    k.sat1fiy,k.sat1kdvtip,k.sat1kdv,\r\n    k.sat2fiy,k.sat2kdvtip,k.sat2kdv,\r\n    k.alsfiy,k.alskdvtip,k.alskdv\r\n  \r\n   \r\n   end \r\n   \r\n   \r\n  \r\n\r\n  RETURN\r\n  \r\nEND"
  },
  {
    "schema": "dbo",
    "name": "STOKAGIRLIKDONEM",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.STOKAGIRLIKDONEM",
    "definition": "CREATE FUNCTION STOKAGIRLIKDONEM (\r\n/*@firmano          int, */\r\n@DEPO_IN\t\t  VARCHAR(5000),\r\n@MALIYET_TIP      int,\r\n@HRK_KRITER       VARCHAR(4000),\r\n@KDVTIP           VARCHAR(10),\r\n@DS_HSPTIP        int,\r\n@STOK_TIP         VARCHAR(10),\r\n@STOK_IN          VARCHAR(8000),\r\n@TARIH1           DATETIME,\r\n@TARIH2           DATETIME)\r\nRETURNS\r\n   @AGIRLIKLI_STK TABLE (\r\n    TARIH                 DATETIME,\r\n    HRKTIP                VARCHAR(1) COLLATE Turkish_CI_AS,\r\n    STOK_KOD              VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    STOK_AD               VARCHAR(150)  COLLATE Turkish_CI_AS,\r\n    STOK_TIP              VARCHAR(10) COLLATE Turkish_CI_AS,\r\n    STOK_GRUP             VARCHAR(100) COLLATE Turkish_CI_AS,\r\n    DBASIMIKTAR           Decimal(30,12) DEFAULT 0,\r\n    DBALSMIKTAR           Decimal(30,12) DEFAULT 0,\r\n    DBASITUTAR            Decimal(30,12) DEFAULT 0,\r\n    DBBRMORTFIYAT         Decimal(30,12) DEFAULT 0,\r\n    ALISMIKTAR            Decimal(30,12) DEFAULT 0,\r\n    ALISBRMORTFIYAT       Decimal(30,12) DEFAULT 0,\r\n    ALISTUTAR             decimal(20,12) DEFAULT 0,\r\n    ALISIADEMIKTAR        Decimal(30,12) DEFAULT 0,\r\n    ALISIADETUTAR         Decimal(30,12) DEFAULT 0,\r\n    ALISMIKTARIADESIZ     Decimal(30,12) DEFAULT 0,\r\n    ALISTUTARIADESIZ      Decimal(30,12) DEFAULT 0,\r\n    SATISMIKTAR           Decimal(30,12) DEFAULT 0,\r\n    SATISTUTAR            Decimal(30,12) DEFAULT 0,\r\n    SATISIADEMIKTAR       Decimal(30,12) DEFAULT 0,\r\n    SATISIADETUTAR        Decimal(30,12) DEFAULT 0,\r\n    SATISMIKTARIADESIZ    Decimal(30,12) DEFAULT 0,\r\n    SATISTUTARIADESIZ     Decimal(30,12) DEFAULT 0,\r\n    SATISMALIYET          Decimal(30,12) DEFAULT 0,\r\n    ALISKARTUTAR          Decimal(30,12) DEFAULT 0,\r\n    SATISKARTUTAR         Decimal(30,12) DEFAULT 0,\r\n    SATISKARYUZDE         Decimal(30,12) DEFAULT 0,\r\n    ALISKARYUZDE          Decimal(30,12) DEFAULT 0,\r\n    DONEMSONUMIKTAR       Decimal(30,12) DEFAULT 0,\r\n    DONEMSONUTUTAR        Decimal(30,12) DEFAULT 0,\r\n    BRMORTFIYAT           Decimal(30,12) DEFAULT 0,\r\n    BRMSAT1FIYAT          Decimal(30,12) DEFAULT 0,\r\n    BRMSAT2FIYAT          Decimal(30,12) DEFAULT 0,\r\n    BRMSAT3FIYAT          Decimal(30,12) DEFAULT 0,\r\n    BRMSAT4FIYAT          Decimal(30,12) DEFAULT 0,\r\n    BRMALSFIYAT           Decimal(30,12) DEFAULT 0,\r\n    BRMSONALSFIYAT        Decimal(30,12) DEFAULT 0,\r\n    BRMSONSATFIYAT        Decimal(30,12) DEFAULT 0,\r\n    \r\n    SATISMIKTAR2           Decimal(30,12) DEFAULT 0,\r\n    SATISTUTAR2            Decimal(30,12) DEFAULT 0,\r\n    \r\n    FATURA_ALIS_MIK\t\t  Decimal(30,12) DEFAULT 0,\r\n    FATURA_ALIS_TUT\t\t  Decimal(30,12) DEFAULT 0,\t\r\n    FATURA_SATIS_MIK\t  Decimal(30,12) DEFAULT 0,\r\n    FATURA_SATIS_TUT\t  Decimal(30,12) DEFAULT 0,\r\n    SAYAC_MIK\t\t  \t  Decimal(30,12) DEFAULT 0,\r\n    SAYAC_TUT\t\t  \t  Decimal(30,12) DEFAULT 0,\t\r\n    FIRE_CIKIS_MIK\t  \t  Decimal(30,12) DEFAULT 0,\r\n    FIRE_CIKIS_TUT\t  \t  Decimal(30,12) DEFAULT 0,\r\n    FIRE_GIRIS_MIK\t  \t  Decimal(30,12) DEFAULT 0,\r\n    FIRE_GIRIS_TUT\t  \t  Decimal(30,12) DEFAULT 0\r\n    \r\n    \r\n    \r\n    \r\n    )\r\nAS\r\nBEGIN\r\n/*\r\n1= ALIS FIFO ORT\r\n2= SATIS FIFO ORT\r\n*/\r\n\r\nDECLARE @STOKAGIRLIKLI_TEMP TABLE (\r\n    ID          Decimal(30,12),\r\n    STOK_KOD    VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    STOK_TIP    VARCHAR(10) COLLATE Turkish_CI_AS,\r\n    HRKTIP      VARCHAR(1)  COLLATE Turkish_CI_AS,\r\n    TARIH       DATETIME,\r\n    GIRMIKTAR     Decimal(30,12),\r\n    GIRIADEMIKTAR Decimal(30,12),\r\n    GIRBRMTUT     Decimal(30,12),\r\n    CIKMIKTAR     Decimal(30,12),\r\n    CIKIADEMIKTAR Decimal(30,12),\r\n    CIKBRMTUT     Decimal(30,12))\r\n\r\n  DECLARE @HRK_STOK_KOD    VARCHAR(20)\r\n  DECLARE @HRK_STOK_TIP    VARCHAR(10)\r\n  DECLARE @HRK_HRKTIP      VARCHAR(30)\r\n  DECLARE @HRK_TARIH       DATETIME\r\n  DECLARE @HRK_GIRMIKTAR    Decimal(30,12)\r\n  DECLARE @HRK_GIRIADEMIK   Decimal(30,12)\r\n  DECLARE @HRK_GIRBRMTUT    Decimal(30,12)\r\n  DECLARE @HRK_CIKMIKTAR    Decimal(30,12)\r\n  DECLARE @HRK_CIKIADEMIK   Decimal(30,12)\r\n  DECLARE @HRK_CIKBRMTUT    Decimal(30,12)\r\n\r\n  DECLARE @KALANMIK         Decimal(30,12)\r\n\r\n  DECLARE @DUSMIK           Decimal(30,12)\r\n  DECLARE @DUSIADEMIK       Decimal(30,12)\r\n\r\n\r\n    /*\r\n     --if @firmano>0\r\n      INSERT @AGIRLIKLI_STK (STOK_KOD,STOK_AD,STOK_TIP,TARIH,HRKTIP,STOK_GRUP,\r\n      DBASIMIKTAR,DBALSMIKTAR,\r\n      DBASITUTAR,ALISMIKTAR,ALISTUTAR,ALISIADEMIKTAR,ALISIADETUTAR,\r\n      ALISMIKTARIADESIZ,ALISTUTARIADESIZ,SATISMIKTAR,SATISIADEMIKTAR,\r\n      SATISIADETUTAR,SATISTUTAR,SATISMIKTARIADESIZ,SATISTUTARIADESIZ,\r\n      SATISMALIYET,ALISKARTUTAR,SATISKARTUTAR,SATISKARYUZDE,ALISKARYUZDE,\r\n      DONEMSONUMIKTAR,DONEMSONUTUTAR,BRMORTFIYAT)\r\n      SELECT k.kod,k.ad,k.tip,null,'X',g.ad,\r\n      isnull(sum((h.giren-h.cikan)),0),\r\n      isnull(sum( h.giren),0),\r\n      sum( isnull(((h.giren)),0)\r\n      *isnull((CASE WHEN  @KDVTIP='Dahil' then h.brmfiykdvli ELSE\r\n      h.brmfiykdvli/(1+h.kdvyuz) END),0)),\r\n      0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,\r\n      case when sum(h.giren)>0 then\r\n      round(((sum( isnull( ((h.giren)),0)\r\n      *isnull((CASE WHEN  @KDVTIP='Dahil' then h.brmfiykdvli ELSE\r\n      h.brmfiykdvli/(1+h.kdvyuz) END),0)))/sum(h.giren)),6)\r\n      else 0 end\r\n      FROM stokkart as k left join grup as g\r\n      on g.id=k.grp1 \r\n      left join stkhrk as h\r\n      on h.firmano=@firmano and h.stkod=k.kod and h.stktip=k.tip\r\n      and h.islmtip not in (select kod from Stk_Kriter where raptip=@RAP_TIP and sec=0)\r\n      and (h.tarih < @TARIH1) and k.sil=0 and h.sil=0\r\n      WHERE k.kod in (select * from CsvToSTR(@STOK_IN))\r\n      AND k.tip=@STOK_TIP\r\n      group by k.kod,k.ad,k.tip,g.ad\r\n     */ \r\n           \r\n      /*if @firmano=0 */\r\n      INSERT @AGIRLIKLI_STK (STOK_KOD,STOK_AD,STOK_TIP,TARIH,HRKTIP,STOK_GRUP,\r\n      DBASIMIKTAR,DBALSMIKTAR,\r\n      DBASITUTAR,ALISMIKTAR,ALISTUTAR,ALISIADEMIKTAR,ALISIADETUTAR,\r\n      ALISMIKTARIADESIZ,ALISTUTARIADESIZ,SATISMIKTAR,SATISIADEMIKTAR,\r\n      SATISIADETUTAR,SATISTUTAR,SATISMIKTARIADESIZ,SATISTUTARIADESIZ,\r\n      SATISMALIYET,ALISKARTUTAR,SATISKARTUTAR,SATISKARYUZDE,ALISKARYUZDE,\r\n      DONEMSONUMIKTAR,DONEMSONUTUTAR,BRMORTFIYAT,ALISBRMORTFIYAT)\r\n      SELECT k.kod,k.ad,k.tip,null,'X',g.ad,\r\n      isnull(sum((h.giren-h.cikan)),0),\r\n      isnull(sum( h.giren),0),\r\n      sum( isnull(((h.giren)),0)\r\n      *isnull((CASE WHEN  @KDVTIP='Dahil' then h.brmfiykdvli ELSE\r\n      h.brmfiykdvli/(1+h.kdvyuz) END),0)),\r\n      0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,\r\n      case when sum(h.giren)>0 then\r\n      round(((sum( isnull( ((h.giren)),0)\r\n      *isnull((CASE WHEN  @KDVTIP='Dahil' then h.brmfiykdvli ELSE\r\n      h.brmfiykdvli/(1+h.kdvyuz) END),0)))/sum(h.giren)),6)\r\n      else 0 end,0 alisortfiyat\r\n      FROM stokkart as k with (NOLOCK) left join grup as g with (NOLOCK)\r\n      on g.id=k.grp1 \r\n      left join stkhrk as h with (NOLOCK)\r\n      on h.stkod=k.kod and h.stktip=k.tip\r\n      and h.islmtip not in \r\n      (select * from CsvToSTR(@HRK_KRITER))\r\n       and h.depkod in (select * from CsvToSTR(@DEPO_IN))\r\n      and (h.tarih < @TARIH1) and k.sil=0 and h.sil=0\r\n      WHERE k.kod in (select * from CsvToSTR(@STOK_IN))\r\n      AND k.tip=@STOK_TIP\r\n      group by k.kod,k.ad,k.tip,g.ad \r\n      \r\n   \r\n    /*satis miktar market */\r\n        UPDATE @AGIRLIKLI_STK SET \r\n         SATISMIKTAR2=SAT_MIK,\r\n         SATISTUTAR2=SAT_TUT\r\n         FROM @AGIRLIKLI_STK AS T JOIN\r\n         (select stkod,stktip,           /*S.aiademik */\r\n         sum(case when S.cikan>0 then S.cikan else 0 end) SAT_MIK,\r\n         SUM(CASE WHEN  @KDVTIP='Dahil' then  S.cikan*S.brmfiykdvli ELSE\r\n         S.cikan*(S.brmfiykdvli/(1+s.kdvyuz)) END) SAT_TUT\r\n         FROM stkhrk AS S with (NOLOCK) WHERE \r\n         s.stkod in (select * from CsvToSTR(@STOK_IN))\r\n         and s.depkod in (select * from CsvToSTR(@DEPO_IN))\r\n         and s.islmtip in ('MARSAT') \r\n          and s.stktip=@STOK_TIP\r\n          AND (s.cikan>0 ) and s.sil=0\r\n         AND (tarih >= @TARIH1) AND (tarih <= @TARIH2)\r\n         GROUP BY  stkod,stktip) DT ON\r\n         DT.stkod=T.STOK_KOD AND DT.stktip=T.STOK_TIP\r\n\r\n        \r\n      if @DS_HSPTIP=0   /*'SON ALIS'  */\r\n      BEGIN\r\n       DECLARE STK_KART CURSOR FAST_FORWARD FOR\r\n         SELECT STOK_TIP,STOK_KOD from @AGIRLIKLI_STK\r\n       OPEN  STK_KART\r\n       FETCH NEXT FROM STK_KART INTO\r\n         @HRK_STOK_TIP,@HRK_STOK_KOD\r\n          WHILE @@FETCH_STATUS = 0\r\n            BEGIN  \r\n             \r\n             UPDATE @AGIRLIKLI_STK SET BRMSONALSFIYAT=BRMSONALSFIY\r\n                 FROM @AGIRLIKLI_STK AS T JOIN\r\n                 (SELECT TOP 1 \r\n                    isnull(case when @KDVTIP='Dahil' then \r\n                    h.brmfiykdvli else (h.brmfiykdvli/(1+(h.kdvyuz))) end\r\n                    ,0) AS BRMSONALSFIY\r\n                    from stkhrk as h with (NOLOCK)\r\n                    where stktip=@HRK_STOK_TIP and stkod=@HRK_STOK_KOD\r\n                     and h.islmtip not in \r\n                    (select * from CsvToSTR(@HRK_KRITER))\r\n                    and h.depkod in (select * from CsvToSTR(@DEPO_IN))\r\n                    and h.tarih<=@TARIH2 and h.sil=0 and h.giren>0\r\n                    order by h.tarih desc,h.saat desc )\r\n                    dt on t.STOK_TIP=@HRK_STOK_TIP\r\n                    and t.STOK_KOD=@HRK_STOK_KOD\r\n           \r\n             FETCH NEXT FROM STK_KART INTO\r\n            @HRK_STOK_TIP,@HRK_STOK_KOD         \r\n          END\r\n   \r\n       CLOSE STK_KART\r\n       DEALLOCATE STK_KART\r\n\r\n   \r\n      END\r\n      \r\n      \r\n      if @DS_HSPTIP=1   /*'SON SATIS'  */\r\n      BEGIN\r\n       DECLARE STK_KART CURSOR FAST_FORWARD FOR\r\n         SELECT STOK_TIP,STOK_KOD from @AGIRLIKLI_STK\r\n       OPEN  STK_KART\r\n       FETCH NEXT FROM STK_KART INTO\r\n         @HRK_STOK_TIP,@HRK_STOK_KOD\r\n          WHILE @@FETCH_STATUS = 0\r\n            BEGIN  \r\n             \r\n             UPDATE @AGIRLIKLI_STK SET BRMSONSATFIYAT=BRMSONSATFIY\r\n                 FROM @AGIRLIKLI_STK AS T JOIN\r\n                 (SELECT TOP 1 \r\n                    isnull(case when @KDVTIP='Dahil' then \r\n                    h.brmfiykdvli else (h.brmfiykdvli/(1+(h.kdvyuz))) end\r\n                    ,0) AS BRMSONSATFIY\r\n                    from stkhrk as h with (NOLOCK)\r\n                    where stktip=@HRK_STOK_TIP and stkod=@HRK_STOK_KOD\r\n                    and h.islmtip not in \r\n                    (select * from CsvToSTR(@HRK_KRITER))\r\n                    and h.depkod in (select * from CsvToSTR(@DEPO_IN))\r\n                    and h.tarih<=@TARIH2 and h.sil=0 and h.cikan>0\r\n                    order by h.tarih desc,h.saat desc )\r\n                    dt on t.STOK_TIP=@HRK_STOK_TIP\r\n                    and t.STOK_KOD=@HRK_STOK_KOD\r\n           \r\n             FETCH NEXT FROM STK_KART INTO\r\n            @HRK_STOK_TIP,@HRK_STOK_KOD         \r\n          END\r\n   \r\n       CLOSE STK_KART\r\n       DEALLOCATE STK_KART\r\n\r\n   \r\n      END\r\n      \r\n \r\n      update @AGIRLIKLI_STK set\r\n      BRMSAT1FIYAT=dt.BRMSAT1FIY,\r\n      BRMSAT2FIYAT=dt.BRMSAT2FIY,\r\n      BRMSAT3FIYAT=dt.BRMSAT3FIY,\r\n      BRMSAT4FIYAT=dt.BRMSAT4FIY,\r\n      BRMALSFIYAT=BRMALSFIY FROM \r\n      @AGIRLIKLI_STK as t join\r\n      (select k.tip,k.kod,\r\n       BRMSAT1FIY=case\r\n       when k.sat1kdvtip=@KDVTIP then k.sat1fiy\r\n       when k.sat1kdvtip='Hariç' and @KDVTIP='Dahil' then k.sat1fiy*(1+(k.sat1kdv/100))\r\n       when k.sat1kdvtip='Dahil' and @KDVTIP='Hariç' then k.sat1fiy/(1+(k.sat1kdv/100)) end,\r\n       BRMSAT2FIY=case when k.sat2kdvtip=@KDVTIP then k.sat2fiy\r\n       when k.sat2kdvtip='Hariç' and @KDVTIP='Dahil' then k.sat2fiy*(1+(k.sat2kdv/100))\r\n       when k.sat2kdvtip='Dahil' and @KDVTIP='Hariç' then k.sat2fiy/(1+(k.sat2kdv/100)) end,\r\n       BRMSAT3FIY=case when k.sat3kdvtip=@KDVTIP then k.sat3fiy\r\n       when k.sat3kdvtip='Hariç' and @KDVTIP='Dahil' then k.sat3fiy*(1+(k.sat3kdv/100))\r\n       when k.sat3kdvtip='Dahil' and @KDVTIP='Hariç' then k.sat3fiy/(1+(k.sat3kdv/100)) end,\r\n       BRMSAT4FIY=case when k.sat4kdvtip=@KDVTIP then k.sat4fiy\r\n       when k.sat4kdvtip='Hariç' and @KDVTIP='Dahil' then k.sat4fiy*(1+(k.sat4kdv/100))\r\n       when k.sat4kdvtip='Dahil' and @KDVTIP='Hariç' then k.sat4fiy/(1+(k.sat4kdv/100)) end,\r\n       BRMALSFIY=case when k.alskdvtip=@KDVTIP then k.alsfiy\r\n       when k.alskdvtip='Hariç' and @KDVTIP='Dahil' then k.alsfiy*(1+(k.alskdv/100))\r\n       when k.alskdvtip='Dahil' and @KDVTIP='Hariç' then k.alsfiy/(1+(k.alskdv/100)) end\r\n       FROM stokkart as k with (NOLOCK) WHERE k.kod in (select * from CsvToSTR(@STOK_IN))\r\n       AND k.tip=@STOK_TIP) DT ON\r\n       DT.kod=T.STOK_KOD AND DT.tip=T.STOK_TIP\r\n\r\n     UPDATE @AGIRLIKLI_STK SET\r\n     ALISMIKTAR=DT.ALISMIK,\r\n     ALISTUTAR=DT.ALISTUT,\r\n     ALISIADEMIKTAR=DT.ALISIADEMIK,\r\n     ALISIADETUTAR=DT.ALISIADETUT,\r\n     /*ALISMIKTARIADESIZ=DT.ALISMIKIADESIZ, */\r\n     /*ALISTUTARIADESIZ= */\r\n     SATISMIKTAR=DT.SATISMIK,\r\n     SATISTUTAR=DT.SATISTUT,\r\n     SATISIADEMIKTAR=DT.SATISIADEMIK,\r\n     SATISIADETUTAR=DT.SATISIADETUT,\r\n     /*SATISMIKTARIADESIZ= */\r\n     /*SATISTUTARIADESIZ= */\r\n     \r\n   \r\n      \r\n      ALISBRMORTFIYAT=\r\n     case when (DT.ALISMIK)>0 then\r\n     round(((DT.ALISTUT)/(DT.ALISMIK)),6)\r\n      else 0 end,\r\n      \r\n      \r\n      DBBRMORTFIYAT=case \r\n      when @MALIYET_TIP=1 then /*normal agırlıklı ort. */\r\n     ( case when (DBALSMIKTAR)>0 then\r\n      round(((DBASITUTAR)/(DBALSMIKTAR)),6) else\r\n      0 end)\r\n      when @MALIYET_TIP=2 then /*donem ici agırlıklı ort. */\r\n     ( case when (DBALSMIKTAR)>0 then\r\n      round(((DBASITUTAR)/(DBALSMIKTAR)),6) else\r\n      0 end)\r\n     when @MALIYET_TIP=3 then /*kart alis fiyat */\r\n     (BRMALSFIYAT)\r\n     end\r\n     \r\n     \r\n      \r\n     FROM @AGIRLIKLI_STK AS T JOIN\r\n     (select k.kod,k.tip,\r\n     isnull(sum((h.giren)),0) AS ALISMIK,\r\n     isnull(sum( ((h.giren))\r\n     *(CASE WHEN  @KDVTIP='Dahil' then h.brmfiykdvli ELSE\r\n     h.brmfiykdvli/(1+h.kdvyuz) END)),0) AS ALISTUT,\r\n     isnull(sum((h.aiademik)),0) AS ALISIADEMIK,\r\n     sum( ((h.aiademik))\r\n     *(CASE WHEN  @KDVTIP='Dahil' then h.brmfiykdvli ELSE\r\n     h.brmfiykdvli/(1+h.kdvyuz) END)) AS ALISIADETUT,\r\n\r\n     isnull(sum((h.cikan)),0) AS SATISMIK,\r\n     sum( ((h.cikan))\r\n     *(CASE WHEN  @KDVTIP='Dahil' then h.brmfiykdvli ELSE\r\n     h.brmfiykdvli/(1+h.kdvyuz) END)) AS SATISTUT,\r\n     isnull(sum((h.siademik)),0) AS SATISIADEMIK,\r\n     sum( ((h.siademik))\r\n     *(CASE WHEN  @KDVTIP='Dahil' then h.brmfiykdvli ELSE\r\n     h.brmfiykdvli/(1+h.kdvyuz) END)) AS SATISIADETUT\r\n\r\n     FROM stokkart as k with (NOLOCK) inner join stkhrk as h\r\n     on h.stkod=k.kod and h.stktip=k.tip\r\n     and h.tarih >= @TARIH1 and h.tarih <= @TARIH2\r\n     and k.sil=0 and h.sil=0\r\n     WHERE k.kod in (select * from CsvToSTR(@STOK_IN))\r\n     and h.islmtip not in \r\n     (select * from CsvToSTR(@HRK_KRITER))\r\n     AND k.tip=@STOK_TIP\r\n     and h.depkod in (select * from CsvToSTR(@DEPO_IN))\r\n     group by k.kod,k.tip) DT ON\r\n     DT.kod=T.STOK_KOD AND DT.tip=T.STOK_TIP\r\n     \r\n\r\n    update @AGIRLIKLI_STK SET \r\n     BRMORTFIYAT=\r\n     case when (ALISMIKTAR+DBASIMIKTAR)>0 then\r\n     round(((ALISTUTAR+(DBASIMIKTAR*DBBRMORTFIYAT))/(ALISMIKTAR+DBASIMIKTAR)),6)\r\n      else 0 end,\r\n      SATISMALIYET=\r\n      case \r\n     when @MALIYET_TIP=1 then /*normal agırlıklı ort. */\r\n     ( SATISMIKTAR*\r\n     case when (ALISMIKTAR+DBASIMIKTAR)>0 then\r\n     round(((ALISTUTAR+(DBASIMIKTAR*DBBRMORTFIYAT))/(ALISMIKTAR+DBASIMIKTAR)),6) else\r\n     0 end )\r\n     when @MALIYET_TIP=2 then /*donem ici agırlıklı ort. */\r\n     ( SATISMIKTAR*\r\n     case when (ALISMIKTAR)>0 then\r\n     round(((ALISTUTAR)/(ALISMIKTAR)),6) else\r\n     0 end)\r\n     when @MALIYET_TIP=3 then /*kart alis fiyat */\r\n     (SATISMIKTAR*BRMALSFIYAT)\r\n     end      \r\n      \r\n     \r\n     \r\n  /* FATURA ALIS SATIS MIKTAR TUTAR */\r\n  update @AGIRLIKLI_STK set \r\n  FATURA_ALIS_MIK=dt.FAT_ALS_MIK,\r\n  FATURA_SATIS_MIK=dt.FAT_SAT_MIK,\r\n  FATURA_ALIS_TUT=dt.FAT_ALS_TUT,\r\n  FATURA_SATIS_TUT=dt.FAT_SAT_TUT\r\n  from @AGIRLIKLI_STK as t join\r\n  (select h.stktip,h.stkod,\r\n    sum(giren) FAT_ALS_MIK,\r\n    sum(cikan) FAT_SAT_MIK,\r\n    sum(case when @KDVTIP='Dahil' then\r\n    (giren*H.brmfiykdvli) ELSE\r\n    giren* (H.brmfiykdvli/(1+H.kdvyuz))  end)\r\n    FAT_ALS_TUT,\r\n    sum(case when @KDVTIP='Dahil' then\r\n    (cikan*H.brmfiykdvli) ELSE\r\n    cikan* (H.brmfiykdvli/(1+H.kdvyuz))  end)\r\n    FAT_SAT_TUT\r\n    from stkhrk as h with (NOLOCK) where \r\n    h.sil=0  and h.tarih >= @TARIH1 and h.tarih <= @TARIH2\r\n    and islmtip in (SELECT kod from fattip with (NOLOCK) where tip='FAT' )\r\n    and h.depkod in (select * from CsvToSTR(@DEPO_IN))\r\n    group by h.stktip,h.stkod )\r\n    dt ON DT.stkod=T.STOK_KOD AND DT.stktip=T.STOK_TIP \r\n    \r\n    \r\n    \r\n    update @AGIRLIKLI_STK set \r\n    SAYAC_MIK=dt.SYC_MIK,\r\n    SAYAC_TUT=dt.SYC_TUT\r\n    from @AGIRLIKLI_STK as t join\r\n    (select h.stktip,h.stkod,\r\n    sum(cikan) SYC_MIK,\r\n    sum(case when @KDVTIP='Dahil' then\r\n    (cikan*H.brmfiykdvli) ELSE\r\n    cikan* (H.brmfiykdvli/(1+H.kdvyuz))  end)\r\n    SYC_TUT\r\n    from stkhrk as h with (NOLOCK) where \r\n    h.sil=0 and h.tarih >= @TARIH1 and h.tarih <= @TARIH2\r\n    and  islmtip in ('POMSAYSAT')\r\n    and h.depkod in (select * from CsvToSTR(@DEPO_IN))\r\n    group by h.stktip,h.stkod )\r\n    dt ON DT.stkod=T.STOK_KOD AND DT.stktip=T.STOK_TIP \r\n    \r\n    \r\n   update @AGIRLIKLI_STK set \r\n   FIRE_CIKIS_MIK=dt.FR_CIKIS_MIK,\r\n   FIRE_CIKIS_TUT=dt.FR_CIKIS_TUT,\r\n   FIRE_GIRIS_MIK=dt.FR_GIRIS_MIK,\r\n   FIRE_GIRIS_TUT=dt.FR_GIRIS_TUT\r\n   from @AGIRLIKLI_STK as t join\r\n  (select h.stktip,h.stkod,\r\n    sum(giren) FR_GIRIS_MIK,\r\n    sum(cikan) FR_CIKIS_MIK,\r\n    sum(case when @KDVTIP='Dahil' then\r\n    (giren*H.brmfiykdvli) ELSE\r\n    giren* (H.brmfiykdvli/(1+H.kdvyuz))  end)\r\n    FR_GIRIS_TUT,\r\n    sum(case when @KDVTIP='Dahil' then\r\n    (cikan*H.brmfiykdvli) ELSE\r\n    cikan* (H.brmfiykdvli/(1+H.kdvyuz))  end)\r\n    FR_CIKIS_TUT\r\n    from stkhrk as h with (NOLOCK) where \r\n    h.sil=0 and h.tarih >= @TARIH1 and h.tarih <= @TARIH2\r\n    and islmtip in ('STKFIRE')\r\n    and h.depkod in (select * from CsvToSTR(@DEPO_IN))\r\n    group by h.stktip,h.stkod )\r\n    dt ON DT.stkod=T.STOK_KOD AND DT.stktip=T.STOK_TIP      \r\n    \r\n     \r\n     \r\n     \r\n     \r\n\r\n\r\n    update @AGIRLIKLI_STK SET\r\n    DBASITUTAR=DBASIMIKTAR*DBBRMORTFIYAT,\r\n    ALISKARTUTAR=SATISTUTAR-SATISMALIYET,\r\n    SATISKARTUTAR=SATISTUTAR-SATISMALIYET,\r\n    SATISKARYUZDE=CASE WHEN ABS(SATISTUTAR)>0 THEN (SATISTUTAR-SATISMALIYET)/SATISTUTAR ELSE 0 END*100,\r\n    ALISKARYUZDE=CASE WHEN ABS(SATISMALIYET)>0 THEN ((SATISTUTAR-SATISMALIYET))/(SATISMALIYET) ELSE 0 END*100,\r\n    DONEMSONUMIKTAR=CASE WHEN ABS((ALISMIKTAR+DBASIMIKTAR)-SATISMIKTAR)>0 THEN ((ALISMIKTAR+DBASIMIKTAR))-(SATISMIKTAR) ELSE 0 END\r\n   /* DONEMSONUTUTAR=((ALISMIKTAR+DBASIMIKTAR)-(SATISMIKTAR))*BRMORTFIYAT */\r\n\r\n\r\n\r\n    if @DS_HSPTIP=0   /*'son tarihteki alis' */\r\n    update @AGIRLIKLI_STK SET DONEMSONUTUTAR=DONEMSONUMIKTAR*BRMSONALSFIYAT\r\n    \r\n    if @DS_HSPTIP=1   /*'son tarihteki satis' */\r\n    update @AGIRLIKLI_STK SET DONEMSONUTUTAR=DONEMSONUMIKTAR*BRMSONSATFIYAT\r\n    \r\n    \r\n    \r\n    if @DS_HSPTIP=2   /*'ALSFIY' */\r\n    update @AGIRLIKLI_STK SET DONEMSONUTUTAR=DONEMSONUMIKTAR*BRMALSFIYAT\r\n\r\n    if @DS_HSPTIP=3   /*'SATFIY1' */\r\n    update @AGIRLIKLI_STK SET DONEMSONUTUTAR=DONEMSONUMIKTAR*BRMSAT1FIYAT\r\n\r\n    if @DS_HSPTIP=4   /*'SATFIY2' */\r\n    update @AGIRLIKLI_STK SET DONEMSONUTUTAR=DONEMSONUMIKTAR*BRMSAT2FIYAT\r\n\r\n    if @DS_HSPTIP=5   /*'SATFIY3' */\r\n    update @AGIRLIKLI_STK SET DONEMSONUTUTAR=DONEMSONUMIKTAR*BRMSAT3FIYAT\r\n\r\n    if @DS_HSPTIP=6   /*'SATFIY4' */\r\n    update @AGIRLIKLI_STK SET DONEMSONUTUTAR=DONEMSONUMIKTAR*BRMSAT4FIYAT\r\n\r\n    if @DS_HSPTIP=7   /*'ORTALS' */\r\n    update @AGIRLIKLI_STK SET DONEMSONUTUTAR=DONEMSONUMIKTAR*BRMORTFIYAT\r\n    \r\n   /*\r\n   if @DS_HSPTIP=8   --'ORTALS'\r\n   \r\n   */ \r\n    \r\n\r\n    if @DS_HSPTIP=9   /*'(DB+ALS)-MALIYET' */\r\n    update @AGIRLIKLI_STK SET DONEMSONUTUTAR=\r\n    (DBASITUTAR+ALISTUTAR)-SATISMALIYET\r\n     \r\n\r\n\r\n\r\n\r\n\r\n update @AGIRLIKLI_STK set STOK_AD=DT.STOKAD,STOK_GRUP=dt.grupad from\r\n  @AGIRLIKLI_STK as t join\r\n (select s.tip,s.kod,S.AD AS STOKAD,gp.ad as grupad from stokkart as s with (NOLOCK)\r\n left join grup as gp with (NOLOCK) on gp.id=s.grp1 )\r\n dt ON DT.KOD=T.STOK_KOD AND DT.tip=T.STOK_TIP\r\n\r\n\r\n\r\nRETURN\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "STOKDPALSSAT_TARIHLI_STOK",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.STOKDPALSSAT_TARIHLI_STOK",
    "definition": "CREATE FUNCTION dbo.STOKDPALSSAT_TARIHLI_STOK (@depkod varchar(20),\r\n@stktip varchar(20),@stkod varchar(20),@TARIH1 datetime,@TARIH2 datetime,\r\n@SAAT1 VARCHAR(8), @SAAT2 VARCHAR(8) )\r\nRETURNS\r\n   @TB_MAL_ALIS TABLE (\r\n    DEPO_MIKTAR     FLOAT,\r\n    DEPO_TUTAR      FLOAT,\r\n    ALIS_MIKTAR     FLOAT,\r\n    ALIS_TUTAR      FLOAT,\r\n    SATIS_MIKTAR     FLOAT,\r\n    SATIS_TUTAR      FLOAT)\r\nBEGIN\r\n\r\n DECLARE @STOK_TEMP TABLE (\r\n    STOK_TIP    VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    STOK_KOD    VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    MIKTAR      FLOAT,\r\n    TUTAR       FLOAT)\r\n\r\n\r\n\r\n\r\n  DECLARE @DEPO_MIKTAR FLOAT\r\n  DECLARE @DEPO_TUTAR FLOAT\r\n  DECLARE @ALIS_MIKTAR FLOAT\r\n  DECLARE @ALIS_TUTAR FLOAT\r\n  DECLARE @SATIS_MIKTAR FLOAT\r\n  DECLARE @SATIS_TUTAR FLOAT\r\n  \r\n  \r\n  \r\n  \r\n  \r\n  \r\n  RETURN\r\n  \r\n\r\n  \r\n\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "STOKFIFO",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.STOKFIFO",
    "definition": "CREATE FUNCTION [dbo].STOKFIFO \r\n(@MALIYETTIPI INT,\r\n@DEPO_KOD VARCHAR(20),\r\n@STOK_TIP VARCHAR(10),\r\n@STOK_KOD VARCHAR(20),\r\n@TARIH1 DATETIME,\r\n@TARIH2 DATETIME)\r\nRETURNS\r\n   @FIFO_STK TABLE (\r\n    MALIYET   FLOAT)\r\nAS\r\nBEGIN\r\n/*\r\n1= ALIS FIFO ORT\r\n2= SATIS FIFO ORT\r\n*/\r\n\r\n\r\nDECLARE @STOKMALIYET_TEMP TABLE (\r\n    ID          FLOAT,\r\n    STOK_KOD    VARCHAR(20),\r\n    STOK_TIP    VARCHAR(10),\r\n    HRKTIP      VARCHAR(1),\r\n    TARIH       DATETIME,\r\n    MIKTAR      FLOAT,\r\n    BRMTUT       FLOAT,\r\n    CIKMIK       FLOAT)\r\n\r\n  DECLARE @ID              FLOAT\r\n  DECLARE @HRK_ID          FLOAT\r\n  DECLARE @HRK_STOK_KOD    VARCHAR(20)\r\n  DECLARE @HRK_STOK_TIP    VARCHAR(10)\r\n  DECLARE @HRK_HRKTIP      VARCHAR(30)\r\n  DECLARE @HRK_TARIH       DATETIME\r\n  DECLARE @HRK_MIKTAR       FLOAT\r\n  DECLARE @HRK_BRMTUT       FLOAT\r\n  DECLARE @HRK_CIKMIK       FLOAT\r\n\r\n  DECLARE @KALANMIK         FLOAT\r\n\r\n  DECLARE @DUSMIK           FLOAT\r\n\r\n/*-GIRISLER */\r\n    if @DEPO_KOD<>''\r\n    INSERT @STOKMALIYET_TEMP\r\n      SELECT S.id,s.stkod,S.stktip,'G',S.tarih+cast(saat as datetime),S.giren,S.brmfiykdvli,0\r\n      FROM stkhrk as s with (NOLOCK)\r\n      WHERE s.stkod=@STOK_KOD and s.stktip=@STOK_TIP\r\n      AND S.depkod=@DEPO_KOD\r\n      AND S.giren>0 and s.sil=0\r\n      and (tarih <= @TARIH2)\r\n      ORDER BY S.tarih+cast(saat as datetime)\r\n\r\n    if @DEPO_KOD=''\r\n    INSERT @STOKMALIYET_TEMP\r\n      SELECT S.id,s.stkod,S.stktip,'G',S.tarih+cast(saat as datetime),S.giren,S.brmfiykdvli,0\r\n      FROM stkhrk as s with (NOLOCK)\r\n      WHERE s.stkod=@STOK_KOD and s.stktip=@STOK_TIP\r\n      AND S.giren>0 and s.sil=0\r\n      and (tarih <= @TARIH2)\r\n      ORDER BY S.tarih+cast(saat as datetime)\r\n\r\n/*----CIKISLAR */\r\n    if @DEPO_KOD<>''\r\n    begin\r\n    DECLARE STKFIFO_HRK CURSOR FAST_FORWARD FOR\r\n    SELECT  S.id,s.stkod,S.stktip,'C',S.tarih+cast(saat as datetime),S.cikan\r\n    FROM stkhrk as s with (NOLOCK)\r\n    WHERE s.stkod=@STOK_KOD and s.stktip=@STOK_TIP\r\n    AND S.depkod=@DEPO_KOD\r\n    AND S.cikan>0 and s.sil=0\r\n    and (tarih <= @TARIH2)\r\n    ORDER BY S.tarih+cast(saat as datetime)\r\n    end\r\n    \r\n    \r\n    \r\n    \r\n    if @DEPO_KOD=''\r\n    begin\r\n    DECLARE STKFIFO_HRK CURSOR FAST_FORWARD FOR\r\n    SELECT  S.id,s.stkod,S.stktip,'C',S.tarih+cast(saat as datetime),S.cikan\r\n    FROM stkhrk as s with (NOLOCK)\r\n    WHERE s.stkod=@STOK_KOD and s.stktip=@STOK_TIP\r\n    AND S.cikan>0 and s.sil=0\r\n    and (tarih <= @TARIH2)\r\n    ORDER BY S.tarih+cast(saat as datetime)\r\n    end\r\n\r\n\r\n\r\n\r\n   OPEN STKFIFO_HRK\r\n\r\n   FETCH NEXT FROM STKFIFO_HRK INTO\r\n   @HRK_ID,@HRK_STOK_KOD ,@HRK_STOK_TIP,@HRK_HRKTIP,@HRK_TARIH,@HRK_CIKMIK\r\n   WHILE @@FETCH_STATUS = 0\r\n   BEGIN\r\n\r\n\r\n     WHILE @HRK_CIKMIK>0 BEGIN\r\n     SET @HRK_BRMTUT=0\r\n     SET @KALANMIK=0\r\n\r\n     SELECT top 1 @ID=ID,@KALANMIK=ISNULL(MIKTAR-CIKMIK,0),\r\n     @HRK_BRMTUT=ISNULL(BRMTUT,0)\r\n     FROM @STOKMALIYET_TEMP WHERE STOK_TIP=@HRK_STOK_TIP \r\n     AND STOK_KOD=@HRK_STOK_KOD\r\n     AND (MIKTAR-CIKMIK)>0 AND HRKTIP='G' ORDER BY TARIH\r\n\r\n     IF @KALANMIK=0\r\n     BEGIN\r\n     SET @DUSMIK=@HRK_CIKMIK\r\n     END\r\n     ELSE\r\n     BEGIN\r\n     IF @HRK_CIKMIK>@KALANMIK\r\n     SET @DUSMIK=@KALANMIK\r\n     ELSE\r\n     SET @DUSMIK=@HRK_CIKMIK\r\n     END\r\n\r\n      INSERT @STOKMALIYET_TEMP (ID,STOK_KOD,STOK_TIP,HRKTIP,TARIH,MIKTAR,BRMTUT)\r\n      VALUES (@HRK_ID,@HRK_STOK_KOD,@HRK_STOK_TIP,'C',@HRK_TARIH,-1*@DUSMIK,@HRK_BRMTUT)\r\n\r\n      /*-------------------------------- */\r\n      UPDATE @STOKMALIYET_TEMP SET CIKMIK=CIKMIK+@DUSMIK WHERE ID=@ID\r\n\r\n      SET @HRK_CIKMIK=@HRK_CIKMIK-@DUSMIK\r\n\r\n    END;\r\n\r\n   FETCH NEXT FROM STKFIFO_HRK INTO\r\n   @HRK_ID,@HRK_STOK_KOD ,@HRK_STOK_TIP,@HRK_HRKTIP,@HRK_TARIH,@HRK_CIKMIK\r\n  END\r\n\r\n  CLOSE STKFIFO_HRK\r\n  DEALLOCATE STKFIFO_HRK\r\n\r\n\r\n\r\n  INSERT @FIFO_STK\r\n   select ISNULL( (CASE when \r\n   SUM(MIKTAR)>0 then\r\n    SUM(MIKTAR*BRMTUT)/sum(MIKTAR)  \r\n    ELSE 0 END  )  ,0) from @STOKMALIYET_TEMP\r\nRETURN\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "STOKFIFODONEM",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.STOKFIFODONEM",
    "definition": "CREATE FUNCTION [dbo].[STOKFIFODONEM] (\r\n@DEPO_IN\t\t  VARCHAR(5000),\r\n@MALIYET_TIP      int,\r\n@HRK_KRITER       VARCHAR(4000),\r\n@KDVTIP           VARCHAR(10),\r\n@DS_HSPTIP        int,\r\n@STOK_TIP         VARCHAR(20),\r\n@STOK_IN          VARCHAR(8000),\r\n@TARIH1           DATETIME,\r\n@TARIH2           DATETIME)\r\nRETURNS\r\n   @FIFO_STK TABLE (\r\n    TARIH                 DATETIME,\r\n    HRKTIP                VARCHAR(1)    COLLATE Turkish_CI_AS,\r\n    STOK_KOD              VARCHAR(30)   COLLATE Turkish_CI_AS,\r\n    STOK_AD               VARCHAR(150)  COLLATE Turkish_CI_AS,\r\n    STOK_TIP              VARCHAR(20)   COLLATE Turkish_CI_AS,\r\n    STOK_GRUP             VARCHAR(100)  COLLATE Turkish_CI_AS,\r\n    DBASIMIKTAR           FLOAT DEFAULT 0,\r\n    DBASITUTAR            FLOAT DEFAULT 0,\r\n    DBASIFIYAT            FLOAT DEFAULT 0,    \r\n    ALISMIKTAR            FLOAT DEFAULT 0,\r\n    ALISIADEMIKTAR        FLOAT DEFAULT 0,\r\n    ALISIADETUTAR         FLOAT DEFAULT 0,\r\n    ALISTUTAR             FLOAT DEFAULT 0,\r\n    ALISMIKTARIADESIZ     FLOAT DEFAULT 0,\r\n    ALISTUTARIADESIZ      FLOAT DEFAULT 0,\r\n    SATISMIKTAR           FLOAT DEFAULT 0,\r\n    SATISIADEMIKTAR       FLOAT DEFAULT 0,\r\n    SATISIADETUTAR        FLOAT DEFAULT 0,\r\n    SATISTUTAR            FLOAT DEFAULT 0,\r\n    SATISMIKTARIADESIZ    FLOAT DEFAULT 0,\r\n    SATISTUTARIADESIZ     FLOAT DEFAULT 0,\r\n    SATISMALIYET          FLOAT DEFAULT 0,\r\n    ALISKARTUTAR          FLOAT DEFAULT 0,\r\n    SATISKARTUTAR         FLOAT DEFAULT 0,\r\n    SATISKARYUZDE         FLOAT DEFAULT 0,\r\n    ALISKARYUZDE          FLOAT DEFAULT 0,\r\n    DONEMSONUMIKTAR       FLOAT DEFAULT 0,\r\n    DONEMSONUTUTAR        FLOAT DEFAULT 0,\r\n    BRMORTFIYAT           FLOAT DEFAULT 0,\r\n    BRMSAT1FIYAT          FLOAT DEFAULT 0,\r\n    BRMSAT2FIYAT          FLOAT DEFAULT 0,\r\n    BRMSAT3FIYAT          FLOAT DEFAULT 0,\r\n    BRMSAT4FIYAT          FLOAT DEFAULT 0,\r\n    BRMALSFIYAT           FLOAT DEFAULT 0,\r\n    BRMSONALSFIYAT        FLOAT DEFAULT 0,\r\n    BRMSATFIYAT           FLOAT DEFAULT 0,\r\n    BRMSONSATFIYAT        FLOAT DEFAULT 0,\r\n    \r\n    SATISMIKTAR2           FLOAT DEFAULT 0,\r\n    SATISTUTAR2            FLOAT DEFAULT 0,\r\n    \r\n    FATURA_ALIS_MIK\t\t  FLOAT DEFAULT 0,\r\n    FATURA_ALIS_TUT\t\t  FLOAT DEFAULT 0,\t\r\n    FATURA_SATIS_MIK\t  FLOAT DEFAULT 0,\r\n    FATURA_SATIS_TUT\t  FLOAT DEFAULT 0,\r\n    SAYAC_MIK\t\t  \t  FLOAT DEFAULT 0,\r\n    SAYAC_TUT\t\t  \t  FLOAT DEFAULT 0,\t\r\n    FIRE_CIKIS_MIK\t  \t  FLOAT DEFAULT 0,\r\n    FIRE_CIKIS_TUT\t  \t  FLOAT DEFAULT 0,\r\n    FIRE_GIRIS_MIK\t  \t  FLOAT DEFAULT 0,\r\n    FIRE_GIRIS_TUT\t  \t  FLOAT DEFAULT 0\r\n    )\r\nAS\r\nBEGIN\r\n/*\r\n1= ALIS FIFO ORT\r\n2= SATIS FIFO ORT\r\n*/\r\n\r\n\r\ndeclare @CSVSTOK_IN table\r\n(Value   VARCHAR(30))\r\ninsert into @CSVSTOK_IN \r\nselect * from CsvToSTR(@STOK_IN)\r\n\r\ndeclare @CSVDEPO_IN table\r\n(Value   VARCHAR(30))\r\ninsert into @CSVDEPO_IN \r\nselect * from CsvToSTR(@DEPO_IN)\r\n\r\ndeclare @CSVHRK_KRITER table\r\n(Value   VARCHAR(30))\r\ninsert into @CSVHRK_KRITER \r\nselect * from CsvToSTR(@HRK_KRITER)\r\n\r\n\r\nDECLARE @STOKFIFO_TEMP TABLE (\r\n    ID          \tFLOAT,\r\n    STOK_KOD    \tVARCHAR(30) COLLATE Turkish_CI_AS,\r\n    STOK_TIP    \tVARCHAR(20) COLLATE Turkish_CI_AS,\r\n    STOK_KDV    \tFLOAT,\r\n    HRKTIP      \tVARCHAR(1)  COLLATE Turkish_CI_AS,\r\n    TARIH       \tDATETIME,\r\n    GIRMIKTAR     \tFLOAT,\r\n    GIRIADEMIKTAR \tFLOAT,\r\n    GIRBRMTUT     \tFLOAT,\r\n    CIKMIKTAR     \tFLOAT,\r\n    CIKIADEMIKTAR \tFLOAT,\r\n    CIKBRMTUT     \tFLOAT,\r\n    DBSGIRBRMTUT    FLOAT)\r\n\r\n      DECLARE @ID               FLOAT\r\n      DECLARE @HRK_ID           FLOAT\r\n      DECLARE @HRK_STOK_KOD     VARCHAR(30)\r\n      DECLARE @HRK_STOK_TIP     VARCHAR(20)\r\n      DECLARE @HRK_HRKTIP       VARCHAR(30)\r\n      DECLARE @HRK_TARIH        DATETIME\r\n      DECLARE @HRK_GIRMIKTAR    FLOAT\r\n      DECLARE @HRK_GIRIADEMIK   FLOAT\r\n      DECLARE @HRK_GIRBRMTUT    FLOAT\r\n      DECLARE @HRK_CIKMIKTAR    FLOAT\r\n      DECLARE @HRK_CIKIADEMIK   FLOAT\r\n      DECLARE @HRK_CIKBRMTUT    FLOAT\r\n\r\n      DECLARE @HRK_GIRTARIH     DATETIME\r\n      DECLARE @HRK_DBSGIRBRMTUT FLOAT\r\n\r\n      DECLARE @KALANMIK         FLOAT\r\n\r\n      DECLARE @DUSMIK           FLOAT\r\n      DECLARE @DUSIADEMIK       FLOAT\r\n\r\n\r\n   /*-GIRISLER */\r\n      INSERT @STOKFIFO_TEMP (ID,STOK_KOD,STOK_TIP,STOK_KDV,TARIH,\r\n      HRKTIP,GIRMIKTAR,GIRIADEMIKTAR,\r\n      GIRBRMTUT,CIKMIKTAR,CIKIADEMIKTAR,CIKBRMTUT,\r\n      DBSGIRBRMTUT)\r\n      \r\n      SELECT max(S.id),s.stkod,S.stktip,S.kdvyuz,\r\n      (S.tarih),'G',\r\n      \r\n      sum(case when S.giren>0 then S.giren else s.siademik  end) GIRMIKTAR,\r\n      sum(case when S.siademik>0 then siademik else 0 end) GIRIADEMIKTAR,\r\n      \r\n      \r\n      \r\n      case when \r\n      sum(case when S.giren>0 then S.giren else S.aiademik end)>0 then \r\n      Sum(\r\n      (CASE WHEN  @KDVTIP='Dahil' then  S.brmfiykdvli ELSE\r\n      S.brmfiykdvli/(1+s.kdvyuz) END)*\r\n      (case when S.giren>0 then S.giren else S.aiademik end)  ) / \r\n      sum(case when S.giren>0 then S.giren else S.aiademik end)\r\n      else 0 end GIRBRMTUT,\r\n      \r\n      \r\n      0,0,0,\r\n      \r\n      case when \r\n      sum(case when S.giren>0 then S.giren else S.aiademik end)>0 then \r\n      Sum(\r\n      (CASE WHEN  @KDVTIP='Dahil' then  S.brmfiykdvli ELSE\r\n      S.brmfiykdvli/(1+s.kdvyuz) END)*\r\n      (case when S.giren>0 then S.giren else S.aiademik end)  ) / \r\n      sum(case when S.giren>0 then S.giren else S.aiademik end)\r\n      else 0 end DBSGIRBRMTUT\r\n      \r\n      \r\n      \r\n      FROM stkhrk as s with (NOLOCK) WHERE s.stkod in \r\n      (select * from @CSVSTOK_IN)\r\n      and s.depkod in (select * from @CSVDEPO_IN)\r\n      and s.islmtip not in\r\n      (select * from CsvToSTR(@HRK_KRITER))\r\n      AND S.stktip=@STOK_TIP and s.sil=0\r\n      AND (s.giren>0 or s.siademik>0)\r\n      and (s.tarih <= @TARIH2)\r\n      group by s.stkod,S.stktip,S.kdvyuz,S.tarih\r\n      /*s.saat,S.brmfiykdvli */\r\n      ORDER BY s.stkod,S.tarih\r\n      /*,s.saat */\r\n      \r\n\r\n     /*--CIKISLAR */\r\n    DECLARE STM_HRK CURSOR FAST_FORWARD FOR\r\n    SELECT  max(S.id),\r\n    s.stkod,S.stktip,'C',\r\n    (S.tarih),\r\n    /*+cast(saat as datetime)), */\r\n    sum(case when S.cikan>0 then S.cikan else S.aiademik end) CikanMiktar,\r\n    sum(case when S.aiademik>0 then S.aiademik else 0 end) CikanAideMiktar,\r\n    \r\n    \r\n    case when \r\n    sum(case when S.cikan>0 then S.cikan else S.aiademik end)>0 then \r\n    \r\n     Sum(\r\n      (CASE WHEN  @KDVTIP='Dahil' then  S.brmfiykdvli ELSE\r\n      S.brmfiykdvli/(1+s.kdvyuz) END)*\r\n      (case when S.cikan>0 then S.cikan else S.aiademik end)  ) / \r\n      sum(case when S.cikan>0 then S.cikan else S.aiademik end)\r\n \r\n    else 0 end CikanBirimFiyat\r\n    \r\n  \r\n   \r\n    /*0 CikanBirimFiyat */\r\n    FROM stkhrk as s with (NOLOCK)\r\n    WHERE s.stkod in (select * from @CSVSTOK_IN)\r\n    and s.depkod in (select * from @CSVDEPO_IN)\r\n    and s.islmtip not in \r\n    (select * from @CSVHRK_KRITER) \r\n    and s.stktip=@STOK_TIP\r\n    AND (s.cikan>0 or s.aiademik>0) and s.sil=0\r\n    AND (tarih <= @TARIH2)\r\n    group by s.stkod,S.stktip,S.tarih\r\n    /*,s.saat,S.brmfiykdvli,S.kdvyuz, */\r\n    ORDER BY s.stkod,S.tarih\r\n    /*,s.saat */\r\n\r\n   OPEN STM_HRK\r\n\r\n   FETCH NEXT FROM STM_HRK INTO\r\n   @HRK_ID,@HRK_STOK_KOD ,@HRK_STOK_TIP,@HRK_HRKTIP,@HRK_TARIH,\r\n   @HRK_CIKMIKTAR,@HRK_CIKIADEMIK,@HRK_CIKBRMTUT\r\n   WHILE @@FETCH_STATUS = 0\r\n   BEGIN\r\n\r\n\r\n     WHILE @HRK_CIKMIKTAR>0 BEGIN\r\n     SET @HRK_GIRBRMTUT=0\r\n     SET @KALANMIK=0\r\n\r\n     SELECT top 1 @ID=ID,@KALANMIK=ISNULL((GIRMIKTAR-CIKMIKTAR),0),\r\n     @HRK_GIRBRMTUT=ISNULL(GIRBRMTUT,0),\r\n     @HRK_GIRTARIH=TARIH\r\n     FROM @STOKFIFO_TEMP WHERE STOK_TIP=@HRK_STOK_TIP\r\n     AND STOK_KOD=@HRK_STOK_KOD\r\n     AND (GIRMIKTAR-CIKMIKTAR)>0 AND HRKTIP='G' ORDER BY TARIH\r\n     \r\n     \r\n     /* DONEM BASI BRM FIYAT */\r\n     SET @HRK_DBSGIRBRMTUT=0\r\n     IF @HRK_GIRTARIH<@TARIH1\r\n       SET @HRK_DBSGIRBRMTUT=@HRK_GIRBRMTUT\r\n\r\n\r\n\r\n\r\n     IF @KALANMIK=0\r\n     BEGIN\r\n      SET @DUSMIK=@HRK_CIKMIKTAR\r\n       SET @HRK_GIRBRMTUT=0\r\n     END\r\n     ELSE\r\n      BEGIN\r\n\r\n       /*IF (@HRK_CIKMIKTAR+@HRK_CIKIADEMIK)>=@KALANMIK */\r\n       IF (@HRK_CIKMIKTAR)>=@KALANMIK\r\n        BEGIN\r\n         SET @DUSMIK=@KALANMIK\r\n     /* SET @DUSIADEMIK=@HRK_CIKIADEMIK */\r\n        END\r\n       ELSE\r\n        BEGIN\r\n         SET @DUSMIK=@HRK_CIKMIKTAR\r\n         /* SET @DUSIADEMIK=@HRK_CIKIADEMIK */\r\n        END\r\n\r\n\r\n      END /*else */\r\n\r\n      INSERT @STOKFIFO_TEMP (ID,STOK_KOD,STOK_TIP,HRKTIP,TARIH,\r\n      GIRMIKTAR,GIRIADEMIKTAR,GIRBRMTUT,CIKMIKTAR,\r\n      CIKIADEMIKTAR,CIKBRMTUT,DBSGIRBRMTUT)\r\n      VALUES (@HRK_ID,@HRK_STOK_KOD,@HRK_STOK_TIP,'C',\r\n      @HRK_TARIH,-1*@DUSMIK,-1*@DUSIADEMIK,@HRK_GIRBRMTUT,\r\n      @DUSMIK,@DUSIADEMIK,@HRK_CIKBRMTUT,@HRK_DBSGIRBRMTUT)\r\n\r\n      /*------------------------------------------------- */\r\n      UPDATE @STOKFIFO_TEMP SET CIKMIKTAR=CIKMIKTAR+@DUSMIK\r\n      WHERE ID=@ID AND (GIRMIKTAR-CIKMIKTAR)>0\r\n      /*-------------------------------------------------- */\r\n\r\n      SET @HRK_CIKMIKTAR=@HRK_CIKMIKTAR-@DUSMIK\r\n    END\r\n\r\n   FETCH NEXT FROM STM_HRK INTO\r\n   @HRK_ID,@HRK_STOK_KOD ,@HRK_STOK_TIP,@HRK_HRKTIP,@HRK_TARIH,@HRK_CIKMIKTAR,@HRK_CIKIADEMIK,@HRK_CIKBRMTUT\r\n  END\r\n\r\n  CLOSE STM_HRK\r\n  DEALLOCATE STM_HRK\r\n\r\n\r\n/*\r\n  INSERT @FIFO_STK (HRKTIP,TARIH,STOK_KOD,STOK_TIP,DBASIMIKTAR,DBASITUTAR,ALISMIKTAR,ALISTUTAR)\r\n  select HRKTIP,TARIH,STOK_KOD,STOK_TIP,GIRMIKTAR,GIRBRMTUT,CIKMIKTAR,CIKBRMTUT    from @STOKFIFO_TEMP\r\n*/\r\n/*----DONEM BASI TUTAR ALINIYOR TARIHTEN ONCEKI STOKLAR VE TUTAR */\r\n\r\n  \r\n     INSERT @FIFO_STK (STOK_KOD,STOK_TIP,BRMORTFIYAT,\r\n     BRMSAT1FIYAT,BRMSAT2FIYAT,BRMSAT3FIYAT,BRMSAT4FIYAT,BRMALSFIYAT,\r\n     SATISMIKTAR2,SATISTUTAR2)\r\n     SELECT s.kod,s.tip,0,\r\n     case\r\n     when s.sat1kdvtip=@KDVTIP then s.sat1fiy\r\n     when s.sat1kdvtip='Hariç' and @KDVTIP='Dahil' then s.sat1fiy*(1+(s.sat1kdv/100))\r\n     when s.sat1kdvtip='Dahil' and @KDVTIP='Hariç' then s.sat1fiy/(1+(s.sat1kdv/100)) end,\r\n     case when s.sat2kdvtip=@KDVTIP then s.sat2fiy\r\n     when s.sat2kdvtip='Hariç' and @KDVTIP='Dahil' then s.sat2fiy*(1+(s.sat2kdv/100))\r\n     when s.sat2kdvtip='Dahil' and @KDVTIP='Hariç' then s.sat2fiy/(1+(s.sat2kdv/100)) end,\r\n     case when s.sat3kdvtip=@KDVTIP then s.sat3fiy\r\n     when s.sat3kdvtip='Hariç' and @KDVTIP='Dahil' then s.sat3fiy*(1+(s.sat3kdv/100))\r\n     when s.sat3kdvtip='Dahil' and @KDVTIP='Hariç' then s.sat3fiy/(1+(s.sat3kdv/100)) end,\r\n     case when s.sat4kdvtip=@KDVTIP then s.sat4fiy\r\n     when s.sat4kdvtip='Hariç' and @KDVTIP='Dahil' then s.sat4fiy*(1+(s.sat4kdv/100))\r\n     when s.sat4kdvtip='Dahil' and @KDVTIP='Hariç' then s.sat4fiy/(1+(s.sat4kdv/100)) end,\r\n     case when s.alskdvtip=@KDVTIP then s.alsfiy\r\n     when s.alskdvtip='Hariç' and @KDVTIP='Dahil' then s.alsfiy*(1+(s.alskdv/100))\r\n     when s.alskdvtip='Dahil' and @KDVTIP='Hariç' then s.alsfiy/(1+(s.alskdv/100)) end,\r\n     0,0\r\n      from stokkart as s with (NOLOCK)\r\n     where s.tip=@STOK_TIP and s.kod in (select * from @CSVSTOK_IN)\r\n     /*VALUES (@STOK_KOD,@STOK_TIP) */\r\n     \r\n     /*satis miktar market  */\r\n     \r\n         UPDATE @FIFO_STK SET \r\n         SATISMIKTAR2=SAT_MIK,\r\n         SATISTUTAR2=SAT_TUT\r\n         FROM @FIFO_STK AS T JOIN\r\n         (select stkod,stktip,           /*S.aiademik */\r\n         sum(case when S.cikan>0 then S.cikan else 0 end) SAT_MIK,\r\n         SUM(CASE WHEN  @KDVTIP='Dahil' then  S.cikan*S.brmfiykdvli ELSE\r\n         S.cikan*(S.brmfiykdvli/(1+s.kdvyuz)) END) SAT_TUT\r\n         FROM stkhrk AS S with (NOLOCK) WHERE \r\n         s.stkod in (select * from @CSVSTOK_IN)\r\n         and s.depkod in (select * from @CSVDEPO_IN)\r\n         and s.islmtip in ('MARSAT') \r\n          and s.stktip=@STOK_TIP\r\n          AND (s.cikan>0 ) and s.sil=0\r\n         AND (tarih >= @TARIH1) AND (tarih <= @TARIH2)\r\n         GROUP BY  stkod,stktip) DT ON\r\n         DT.stkod=T.STOK_KOD AND DT.stktip=T.STOK_TIP\r\n     \r\n     \r\n     \r\n     \r\n     \r\n     if (@DS_HSPTIP=0) or (@DS_HSPTIP=1)   /*'SON ALIS'  */\r\n      BEGIN\r\n       DECLARE STK_KART CURSOR FAST_FORWARD FOR\r\n         SELECT STOK_TIP,STOK_KOD from @FIFO_STK\r\n       OPEN  STK_KART\r\n       FETCH NEXT FROM STK_KART INTO\r\n         @HRK_STOK_TIP,@HRK_STOK_KOD\r\n          WHILE @@FETCH_STATUS = 0\r\n            BEGIN  \r\n            \r\n            declare @SONTUTAR FLOAT\r\n            \r\n            declare @DBASIFIYAT FLOAT\r\n            \r\n            \r\n            SET @SONTUTAR=0\r\n            \r\n            SET @DBASIFIYAT=0 \r\n           \r\n            \r\n            \r\n            if (@DS_HSPTIP=0) \r\n             begin\r\n             \r\n               declare @EvrakTarih datetime\r\n               declare @EvrakSaat  datetime\r\n               declare @KdvYuz  float\r\n               \r\n                       \r\n             \r\n                    SELECT TOP 1 @EvrakTarih=h.tarih,@EvrakSaat=h.saat,\r\n                    @KdvYuz=h.kdvyuz,\r\n                    @SONTUTAR=case when @KDVTIP='Dahil' then \r\n                    h.brmfiykdvli else (h.brmfiykdvli/(1+(h.kdvyuz))) end\r\n                     from stkhrk as h with (NOLOCK)\r\n                    where stktip=@HRK_STOK_TIP and stkod=@HRK_STOK_KOD\r\n                    and h.islmtip not in \r\n                    (select * from @CSVHRK_KRITER) \r\n                    and h.depkod in (select * from @CSVDEPO_IN)\r\n                    and h.tarih<=@TARIH2 and h.sil=0 and h.giren>0\r\n                    and h.brmfiykdvli>0 and h.islmtip<>'MARIAD'\r\n                    order by h.tarih desc,h.saat desc \r\n                 \r\n                  /*Ayn1\u0001 Zaman Dilinde 1 den fazla Kay1\u0001t Varsa  */\r\n                    if (Select Count(id) from stkhrk as h with (NOLOCK)\r\n                    where stktip=@HRK_STOK_TIP and stkod=@HRK_STOK_KOD\r\n                    and h.islmtip not in \r\n                    (select * from @CSVHRK_KRITER) \r\n                    and h.depkod in (select * from @CSVDEPO_IN)\r\n                    and h.tarih=@EvrakTarih and h.saat=@EvrakSaat \r\n                    and h.sil=0 and h.giren>0\r\n                    and h.brmfiykdvli>0 and h.islmtip<>'MARIAD')>1\r\n                    begin\r\n                    \r\n                      SELECT @SONTUTAR=case when @KDVTIP='Dahil' then \r\n                       sum(h.brmfiykdvli*h.giren)/sum(h.giren)\r\n                       else\r\n                         (sum(h.brmfiykdvli*h.giren)/sum(h.giren))/(1+@KdvYuz) \r\n                       end\r\n                       from stkhrk as h with (NOLOCK)\r\n                       where stktip=@HRK_STOK_TIP and stkod=@HRK_STOK_KOD\r\n                       and h.islmtip not in \r\n                       (select * from @CSVHRK_KRITER) \r\n                       and h.depkod in (select * from @CSVDEPO_IN)\r\n                       and h.tarih=@EvrakTarih and h.saat=@EvrakSaat \r\n                       and h.sil=0 and h.giren>0\r\n                       and h.brmfiykdvli>0 and h.islmtip<>'MARIAD'\r\n                       \r\n\r\n                     end \r\n          \r\n          \r\n          \r\n                    SELECT TOP 1 @EvrakTarih=h.tarih,@EvrakSaat=h.saat,\r\n                    @KdvYuz=h.kdvyuz,\r\n                    @DBASIFIYAT=case when @KDVTIP='Dahil' then \r\n                    h.brmfiykdvli else (h.brmfiykdvli/(1+(h.kdvyuz))) end\r\n                     from stkhrk as h with (NOLOCK)\r\n                    where stktip=@HRK_STOK_TIP and stkod=@HRK_STOK_KOD\r\n                    and h.islmtip not in \r\n                    (select * from @CSVHRK_KRITER) \r\n                    and h.depkod in (select * from @CSVDEPO_IN)\r\n                    and h.tarih<@TARIH1 and h.sil=0 and h.giren>0\r\n                    and h.brmfiykdvli>0 and h.islmtip<>'MARIAD'\r\n                    order by h.tarih desc,h.saat desc \r\n            \r\n                    \r\n                    /*Ayn1\u0001 Zaman Dilinde 1 den fazla Kay1\u0001t Varsa  */\r\n                    if (Select Count(id) from stkhrk as h with (NOLOCK)\r\n                    where stktip=@HRK_STOK_TIP and stkod=@HRK_STOK_KOD\r\n                    and h.islmtip not in \r\n                    (select * from @CSVHRK_KRITER) \r\n                    and h.depkod in (select * from @CSVDEPO_IN)\r\n                    and h.tarih=@EvrakTarih and h.saat=@EvrakSaat \r\n                    and h.sil=0 and h.giren>0\r\n                    and h.brmfiykdvli>0 and h.islmtip<>'MARIAD')>1\r\n                    begin\r\n                    \r\n                      SELECT @DBASIFIYAT=case when @KDVTIP='Dahil' then \r\n                       sum(h.brmfiykdvli*h.giren)/sum(h.giren) \r\n                        else\r\n                         (sum(h.brmfiykdvli*h.giren)/sum(h.giren))/(1+@KdvYuz) \r\n                        end\r\n                       from stkhrk as h with (NOLOCK)\r\n                       where stktip=@HRK_STOK_TIP and stkod=@HRK_STOK_KOD\r\n                       and h.islmtip not in \r\n                       (select * from @CSVHRK_KRITER) \r\n                       and h.depkod in (select * from @CSVDEPO_IN)\r\n                       and h.tarih=@EvrakTarih and h.saat=@EvrakSaat \r\n                       and h.sil=0 and h.giren>0\r\n                       and h.brmfiykdvli>0 and h.islmtip<>'MARIAD'\r\n                      \r\n\r\n                     end  \r\n                    \r\n                    \r\n                    \r\n                    \r\n                    \r\n          \r\n               end\r\n\r\n      \r\n                         \r\n                 if (@DS_HSPTIP=1)\r\n                  begin\r\n  \r\n\r\n                  SELECT TOP 1 @SONTUTAR=case when @KDVTIP='Dahil' then \r\n                    h.brmfiykdvli else (h.brmfiykdvli/(1+(h.kdvyuz))) end\r\n                     from stkhrk as h with (NOLOCK)\r\n                    where stktip=@HRK_STOK_TIP and stkod=@HRK_STOK_KOD\r\n                    and h.islmtip not in \r\n                    (select * from @CSVHRK_KRITER) \r\n                    and h.depkod in (select * from @CSVDEPO_IN)\r\n                    and h.tarih<=@TARIH2 and h.sil=0 and h.cikan>0\r\n                    and h.brmfiykdvli>0\r\n                    order by h.tarih desc,h.saat desc \r\n\r\n                    SELECT TOP 1 @DBASIFIYAT=case when @KDVTIP='Dahil' then \r\n                    h.brmfiykdvli else (h.brmfiykdvli/(1+(h.kdvyuz))) end\r\n                     from stkhrk as h with (NOLOCK)\r\n                    where stktip=@HRK_STOK_TIP and stkod=@HRK_STOK_KOD\r\n                    and h.islmtip not in \r\n                    (select * from @CSVHRK_KRITER) \r\n                    and h.depkod in (select * from @CSVDEPO_IN)\r\n                    and h.tarih<@TARIH1 and h.sil=0 and h.cikan>0\r\n                    and h.brmfiykdvli>0\r\n                    order by h.tarih desc,h.saat desc \r\n                    \r\n               end\r\n               \r\n                                  \r\n             \r\n             UPDATE @FIFO_STK SET DBASIFIYAT=isnull(@DBASIFIYAT,0),\r\n             BRMSONALSFIYAT=isnull(@SONTUTAR,0)\r\n             WHERE  STOK_TIP=@HRK_STOK_TIP and STOK_KOD=@HRK_STOK_KOD\r\n                                 \r\n           \r\n             FETCH NEXT FROM STK_KART INTO\r\n            @HRK_STOK_TIP,@HRK_STOK_KOD         \r\n          END\r\n   \r\n       CLOSE STK_KART\r\n       DEALLOCATE STK_KART\r\n\r\n   \r\n      END\r\n     \r\n\r\n     if @DS_HSPTIP=7   /*'ORTALS' */\r\n      begin\r\n         UPDATE @FIFO_STK SET BRMORTFIYAT=BRMORTFIY\r\n         FROM @FIFO_STK AS T JOIN\r\n         (select STOK_KOD,STOK_TIP,\r\n         case when\r\n         sum(GIRMIKTAR)>0 and @KDVTIP='Dahil' then\r\n         /*round( */\r\n         SUM(GIRBRMTUT*GIRMIKTAR)/sum(GIRMIKTAR)\r\n         /*,6) */\r\n         when sum(GIRMIKTAR)>0 and @KDVTIP='Hariç' then\r\n         /*round( */\r\n         SUM( (GIRBRMTUT*GIRMIKTAR)/1+(STOK_KDV))/sum(GIRMIKTAR)\r\n         /*,6) */\r\n         else 0 end BRMORTFIY FROM @STOKFIFO_TEMP\r\n         WHERE TARIH <= @TARIH2 AND HRKTIP='G' GROUP BY STOK_KOD,STOK_TIP) DT ON\r\n         DT.STOK_KOD=T.STOK_KOD AND DT.STOK_TIP=T.STOK_TIP\r\n         \r\n         \r\n         \r\n         \r\n         UPDATE @FIFO_STK SET DBASIFIYAT=DBASIFIY\r\n         FROM @FIFO_STK AS T JOIN\r\n         (select STOK_KOD,STOK_TIP,\r\n         case when\r\n         sum(GIRMIKTAR)>0 and @KDVTIP='Dahil' then\r\n         /*round( */\r\n         SUM(GIRBRMTUT*GIRMIKTAR)/sum(GIRMIKTAR)\r\n         /*,6) */\r\n         when sum(GIRMIKTAR)>0 and @KDVTIP='Hariç' then\r\n         /*round( */\r\n         SUM( (GIRBRMTUT*GIRMIKTAR)/1+(STOK_KDV))/sum(GIRMIKTAR)\r\n         /*,6) */\r\n         else 0 end DBASIFIY FROM @STOKFIFO_TEMP\r\n         WHERE TARIH < @TARIH1 AND HRKTIP='G' GROUP BY STOK_KOD,STOK_TIP) DT ON\r\n         DT.STOK_KOD=T.STOK_KOD AND DT.STOK_TIP=T.STOK_TIP\r\n         \r\n  \r\n \r\n       end\r\n      \r\n\r\n     if @DS_HSPTIP=8   /*'SON_GRS KAYDINA GORE ORTALS' */\r\n      begin\r\n         UPDATE @FIFO_STK SET BRMORTFIYAT=BRMORTFIY\r\n         FROM @FIFO_STK AS T JOIN (select STOK_KOD,STOK_TIP,\r\n         case when \r\n         sum(GIRMIKTAR-CIKMIKTAR)>0 and @KDVTIP='Dahil' then\r\n         (SUM(GIRBRMTUT*GIRMIKTAR)-SUM(GIRBRMTUT*CIKMIKTAR))\r\n         /SUM(GIRMIKTAR-CIKMIKTAR)\r\n         \r\n         when sum(GIRMIKTAR-CIKMIKTAR)>0 and @KDVTIP='Hariç' then\r\n         (SUM( (GIRBRMTUT*GIRMIKTAR)/1+(STOK_KDV)) \r\n          - SUM((GIRBRMTUT*CIKMIKTAR)/1+(STOK_KDV)))\r\n          /SUM(GIRMIKTAR-CIKMIKTAR)\r\n          \r\n          else 0 end BRMORTFIY FROM @STOKFIFO_TEMP\r\n         WHERE TARIH <= @TARIH2 AND HRKTIP='G' \r\n         GROUP BY STOK_KOD,STOK_TIP) DT ON\r\n         DT.STOK_KOD=T.STOK_KOD AND DT.STOK_TIP=T.STOK_TIP\r\n         \r\n         \r\n         \r\n         UPDATE @FIFO_STK SET DBASIFIYAT=DBASIFIY\r\n         FROM @FIFO_STK AS T JOIN (select STOK_KOD,STOK_TIP,\r\n         case when \r\n         sum(GIRMIKTAR-CIKMIKTAR)>0 and @KDVTIP='Dahil' then\r\n         (SUM(GIRBRMTUT*GIRMIKTAR)-SUM(GIRBRMTUT*CIKMIKTAR))\r\n         /SUM(GIRMIKTAR-CIKMIKTAR)\r\n         \r\n         when sum(GIRMIKTAR-CIKMIKTAR)>0 and @KDVTIP='Hariç' then\r\n         (SUM( (GIRBRMTUT*GIRMIKTAR)/1+(STOK_KDV)) \r\n          - SUM((GIRBRMTUT*CIKMIKTAR)/1+(STOK_KDV)))\r\n          /SUM(GIRMIKTAR-CIKMIKTAR)\r\n          \r\n          else 0 end DBASIFIY FROM @STOKFIFO_TEMP\r\n         WHERE TARIH < @TARIH1 AND HRKTIP='G' \r\n         GROUP BY STOK_KOD,STOK_TIP) DT ON\r\n         DT.STOK_KOD=T.STOK_KOD AND DT.STOK_TIP=T.STOK_TIP  \r\n         \r\n           \r\n      end\r\n \r\n     UPDATE @FIFO_STK SET DBASIMIKTAR=DT.DBASMIKTAR,\r\n     DBASITUTAR=DT.DBASTUTAR\r\n     FROM @FIFO_STK AS T JOIN\r\n     (select STOK_KOD,STOK_TIP,\r\n     ISNULL(SUM(GIRMIKTAR),0) AS DBASMIKTAR,\r\n     ISNULL(SUM((DBSGIRBRMTUT*GIRMIKTAR)),0) AS DBASTUTAR\r\n     FROM @STOKFIFO_TEMP\r\n     WHERE TARIH < @TARIH1\r\n     GROUP BY STOK_KOD,STOK_TIP) DT ON\r\n     DT.STOK_KOD=T.STOK_KOD AND DT.STOK_TIP=T.STOK_TIP\r\n     \r\n     \r\n     UPDATE @FIFO_STK\r\n     SET\r\n     ALISIADEMIKTAR=DT.ALISIADEMIKTAR,\r\n     ALISIADETUTAR=DT.ALISIADETUTAR,\r\n     SATISIADEMIKTAR=DT.SATISIADEMIKTAR,\r\n     SATISIADETUTAR=DT.SATISIADETUTAR\r\n     FROM @FIFO_STK AS T JOIN\r\n     (select stkod,stktip,\r\n     ISNULL(SUM(aiademik),0) AS ALISIADEMIKTAR,\r\n     ISNULL(SUM((aiademik*CASE WHEN  @KDVTIP='Dahil' then  S.brmfiykdvli ELSE\r\n     S.brmfiykdvli/(1+s.kdvyuz) END)),0) AS ALISIADETUTAR,\r\n     ISNULL(SUM(siademik),0) AS SATISIADEMIKTAR,\r\n     ISNULL(SUM((siademik*CASE WHEN  @KDVTIP='Dahil' then  S.brmfiykdvli ELSE\r\n      S.brmfiykdvli/(1+s.kdvyuz) END)),0) AS SATISIADETUTAR\r\n     FROM stkhrk as s with (NOLOCK)\r\n     WHERE s.stkod in (select * from @CSVSTOK_IN)\r\n     and s.islmtip not in \r\n     (select * from @CSVHRK_KRITER) \r\n     and s.stktip=@STOK_TIP\r\n     and s.depkod in (select * from @CSVDEPO_IN)\r\n     and s.tarih >= @TARIH1 and s.tarih <= @TARIH2\r\n     GROUP BY stkod,stktip) DT ON\r\n     DT.stkod=T.STOK_KOD AND DT.stktip=T.STOK_TIP\r\n    \r\n\r\n   /*----ALIS TUTAR ALINIYOR */\r\n   UPDATE @FIFO_STK SET ALISMIKTAR=DT.ALISMIK,\r\n    /*ALISIADEMIKTAR=DT.ALISIADEMIK, */\r\n    /*ALISIADETUTAR=DT.ALISIADETUT, */\r\n    /*ALISMIKTARIADESIZ=DT.ALISMIK-DT.ALISIADEMIK, */\r\n   /* ALISTUTARIADESIZ=DT.ALISTUT-DT.ALISIADETUT, */\r\n    ALISTUTAR=DT.ALISTUT FROM @FIFO_STK AS T JOIN\r\n    (select STOK_KOD,STOK_TIP,\r\n    ISNULL(SUM(GIRMIKTAR),0) AS ALISMIK,\r\n    ISNULL(SUM(GIRIADEMIKTAR),0) AS ALISIADEMIK,\r\n    ISNULL(SUM(GIRIADEMIKTAR*GIRMIKTAR),0) AS ALISIADETUT,\r\n    ISNULL(SUM(GIRBRMTUT*GIRMIKTAR),0) AS ALISTUT\r\n    FROM @STOKFIFO_TEMP\r\n    WHERE HRKTIP='G' AND TARIH >= @TARIH1\r\n    GROUP BY STOK_KOD,STOK_TIP) DT \r\n    ON DT.STOK_KOD=T.STOK_KOD AND DT.STOK_TIP=T.STOK_TIP\r\n\r\n   /*----SATIS TUTAR ALINIYOR */\r\n    UPDATE @FIFO_STK SET\r\n    SATISMALIYET=DT.SATISMAL,\r\n    SATISMIKTAR=DT.SATISMIK,\r\n    /*ALISMIKTARIADESIZ=ALISMIKTARIADESIZ-DT.SATISIADEMIK, */\r\n    /*ALISTUTARIADESIZ=ALISTUTARIADESIZ-DT.SATISIADETUT, */\r\n    /*SATISIADETUTAR=DT.SATISIADETUT, */\r\n    /*SATISIADEMIKTAR=DT.SATISIADEMIK, */\r\n    /*SATISMIKTARIADESIZ=DT.SATISMIK-(DT.SATISIADEMIK+ALISIADEMIKTAR), */\r\n    /*SATISTUTARIADESIZ=DT.SATISTUT-(DT.SATISIADETUT+ALISIADETUTAR), */\r\n    SATISTUTAR=DT.SATISTUT FROM @FIFO_STK AS T JOIN\r\n    (select STOK_KOD,STOK_TIP,\r\n    ISNULL(SUM(CIKMIKTAR),0) AS SATISMIK,\r\n    /*ISNULL(SUM(CIKIADEMIKTAR),0) AS SATISIADEMIK, */\r\n    /*ISNULL(SUM(CIKIADEMIKTAR*CIKBRMTUT),0) AS SATISIADETUT, */\r\n    ISNULL(SUM(CIKMIKTAR*CIKBRMTUT),0) AS SATISTUT,\r\n    ISNULL(SUM(CIKMIKTAR*GIRBRMTUT),0) AS SATISMAL\r\n    FROM @STOKFIFO_TEMP\r\n    WHERE HRKTIP='C' AND TARIH >= @TARIH1\r\n    GROUP BY STOK_KOD,STOK_TIP) DT \r\n    ON DT.STOK_KOD=T.STOK_KOD AND DT.STOK_TIP=T.STOK_TIP\r\n\r\n\r\n   /*--SATIS KAR */\r\n    UPDATE @FIFO_STK SET SATISKARTUTAR=SATISTUTAR-SATISMALIYET,\r\n    ALISKARTUTAR=SATISTUTAR-SATISMALIYET,                                    /*ALISTUTAR */\r\n    SATISKARYUZDE=CASE WHEN ABS(SATISTUTAR)>0 THEN \r\n    (SATISTUTAR-SATISMALIYET)/SATISTUTAR ELSE 0 END*100,\r\n    ALISKARYUZDE=CASE WHEN ABS(SATISMALIYET)>0 THEN \r\n    ((SATISTUTAR-SATISMALIYET))/(SATISMALIYET) ELSE 0 END*100,\r\n    DONEMSONUMIKTAR=CASE WHEN ABS((ALISMIKTAR+DBASIMIKTAR)-SATISMIKTAR)>0 THEN\r\n     ((ALISMIKTAR+DBASIMIKTAR))-(SATISMIKTAR) ELSE 0 END\r\n\r\n\r\n    /*,DONEMSONUTUTAR=CASE WHEN ABS(((ALISMIKTAR+DBASIMIKTAR))-(SATISMIKTAR))>0 THEN ((ALISTUTAR+DBASITUTAR))-(SATISMALIYET) */\r\n   /* ELSE 0 END */\r\n\r\n    if @DS_HSPTIP=0   /*'son tarihteki alis' */\r\n      update @FIFO_STK SET \r\n       DONEMSONUTUTAR=DONEMSONUMIKTAR*BRMSONALSFIYAT,\r\n       DBASITUTAR=DBASIMIKTAR*DBASIFIYAT\r\n    \r\n    \r\n    if @DS_HSPTIP=1   /*'son tarihteki satis' */\r\n    update @FIFO_STK SET DONEMSONUTUTAR=DONEMSONUMIKTAR*BRMSONSATFIYAT,\r\n       DBASITUTAR=DBASIMIKTAR*DBASIFIYAT\r\n   \r\n    if @DS_HSPTIP=2   /*'ALSFIY' */\r\n    update @FIFO_STK SET DONEMSONUTUTAR=DONEMSONUMIKTAR*BRMALSFIYAT,\r\n       DBASITUTAR=DBASIMIKTAR*BRMALSFIYAT\r\n\r\n    if @DS_HSPTIP=3   /*'SATFIY1' */\r\n    update @FIFO_STK SET DONEMSONUTUTAR=DONEMSONUMIKTAR*BRMSAT1FIYAT,\r\n       DBASITUTAR=DBASIMIKTAR*BRMSAT1FIYAT\r\n\r\n    if @DS_HSPTIP=4   /*'SATFIY2' */\r\n    update @FIFO_STK SET DONEMSONUTUTAR=DONEMSONUMIKTAR*BRMSAT2FIYAT,\r\n       DBASITUTAR=DBASIMIKTAR*BRMSAT2FIYAT\r\n\r\n    if @DS_HSPTIP=5   /*'SATFIY3' */\r\n    update @FIFO_STK SET DONEMSONUTUTAR=DONEMSONUMIKTAR*BRMSAT3FIYAT,\r\n       DBASITUTAR=DBASIMIKTAR*BRMSAT3FIYAT\r\n\r\n    if @DS_HSPTIP=6   /*'SATFIY4' */\r\n    update @FIFO_STK SET DONEMSONUTUTAR=DONEMSONUMIKTAR*BRMSAT4FIYAT,\r\n       DBASITUTAR=DBASIMIKTAR*BRMSAT4FIYAT\r\n\r\n    if @DS_HSPTIP=7   /*'ORTALS' */\r\n    update @FIFO_STK SET DONEMSONUTUTAR=DONEMSONUMIKTAR*BRMORTFIYAT,\r\n       DBASITUTAR=DBASIMIKTAR*DBASIFIYAT\r\n   \r\n\r\n    if @DS_HSPTIP=8   /*'GONGIRORTALS' */\r\n    update @FIFO_STK SET DONEMSONUTUTAR=DONEMSONUMIKTAR*BRMORTFIYAT,\r\n       DBASITUTAR=DBASIMIKTAR*DBASIFIYAT\r\n\r\n   \r\n   if @DS_HSPTIP=9   /*'(DB+ALS)-MALIYET' */\r\n    update @FIFO_STK SET \r\n     /*DBASITUTAR=DBASIMIKTAR*DBASIFIYAT, */\r\n     /*DONEMSONUTUTAR=((DBASIMIKTAR*DBASIFIYAT)+ALISTUTAR)-SATISMALIYET */\r\n     DONEMSONUTUTAR=(DBASITUTAR+ALISTUTAR)-SATISMALIYET\r\n       \r\n /* FATURA ALIS SATIS MIKTAR TUTAR */\r\n  update @FIFO_STK set \r\n  FATURA_ALIS_MIK=dt.FAT_ALS_MIK,\r\n  FATURA_SATIS_MIK=dt.FAT_SAT_MIK,\r\n  FATURA_ALIS_TUT=dt.FAT_ALS_TUT,\r\n  FATURA_SATIS_TUT=dt.FAT_SAT_TUT\r\n  from @FIFO_STK as t join\r\n  (select h.stktip,h.stkod,\r\n    sum(giren) FAT_ALS_MIK,\r\n    sum(cikan) FAT_SAT_MIK,\r\n    sum(case when @KDVTIP='Dahil' then\r\n    (giren*H.brmfiykdvli) ELSE\r\n    giren* (H.brmfiykdvli/(1+H.kdvyuz))  end)\r\n    FAT_ALS_TUT,\r\n    sum(case when @KDVTIP='Dahil' then\r\n    (cikan*H.brmfiykdvli) ELSE\r\n    cikan* (H.brmfiykdvli/(1+H.kdvyuz))  end)\r\n    FAT_SAT_TUT\r\n    from stkhrk as h  with (NOLOCK) where \r\n    h.sil=0  and h.tarih >= @TARIH1 and h.tarih <= @TARIH2\r\n    and h.islmtip in (SELECT kod from fattip with (NOLOCK) where tip='FAT' )\r\n    and h.depkod in (select * from @CSVDEPO_IN)\r\n    group by h.stktip,h.stkod )\r\n    dt ON DT.stkod=T.STOK_KOD AND DT.stktip=T.STOK_TIP \r\n    \r\n    \r\n   /*\r\n    update @FIFO_STK set \r\n    SAYAC_MIK=dt.SYC_MIK,\r\n    SAYAC_TUT=dt.SYC_TUT\r\n    from @FIFO_STK as t join\r\n    (select h.stktip,h.stkod,\r\n    sum(cikan) SYC_MIK,\r\n    sum(case when @KDVTIP='Dahil' then\r\n    (cikan*H.brmfiykdvli) ELSE\r\n    cikan* (H.brmfiykdvli/(1+H.kdvyuz))  end)\r\n    SYC_TUT\r\n    from stkhrk as h with (NOLOCK) where \r\n    h.sil=0 and h.tarih >= @TARIH1 and h.tarih <= @TARIH2\r\n    and  h.islmtip in ('POMSAYSAT')\r\n    and h.depkod in (select * from @CSVDEPO_IN)\r\n    group by h.stktip,h.stkod )\r\n    dt ON DT.stkod=T.STOK_KOD AND DT.stktip=T.STOK_TIP \r\n    \r\n    \r\n   update @FIFO_STK set \r\n   FIRE_CIKIS_MIK=dt.FR_CIKIS_MIK,\r\n   FIRE_CIKIS_TUT=dt.FR_CIKIS_TUT,\r\n   FIRE_GIRIS_MIK=dt.FR_GIRIS_MIK,\r\n   FIRE_GIRIS_TUT=dt.FR_GIRIS_TUT\r\n   from @FIFO_STK as t join\r\n    (select h.stktip,h.stkod,\r\n    sum(giren) FR_GIRIS_MIK,\r\n    sum(cikan) FR_CIKIS_MIK,\r\n    sum(case when @KDVTIP='Dahil' then\r\n    (giren*H.brmfiykdvli) ELSE\r\n    giren* (H.brmfiykdvli/(1+H.kdvyuz))  end)\r\n    FR_GIRIS_TUT,\r\n    sum(case when @KDVTIP='Dahil' then\r\n    (cikan*H.brmfiykdvli) ELSE\r\n    cikan* (H.brmfiykdvli/(1+H.kdvyuz))  end)\r\n    FR_CIKIS_TUT\r\n    from stkhrk as h with (NOLOCK) where \r\n    h.sil=0 and h.tarih >= @TARIH1 and h.tarih <= @TARIH2\r\n    and h.islmtip in ('STKFIRE')\r\n    and h.depkod in (select * from @CSVDEPO_IN)\r\n    group by h.stktip,h.stkod )\r\n    dt ON DT.stkod=T.STOK_KOD AND DT.stktip=T.STOK_TIP      \r\n  \r\n*/\r\n   update @FIFO_STK set STOK_AD=DT.STOKAD,STOK_GRUP=dt.grupad from\r\n    @FIFO_STK as t join\r\n   (select s.tip,s.kod,S.AD AS STOKAD,gp.ad as grupad from stokkart as s with (NOLOCK)\r\n   left join grup as gp with (NOLOCK) on gp.id=s.grp1 )\r\n   dt ON DT.KOD=T.STOK_KOD AND DT.tip=T.STOK_TIP\r\n\r\n\r\n  \r\nRETURN\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "STOKMALIYETFIFO",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.STOKMALIYETFIFO",
    "definition": "CREATE FUNCTION [dbo].STOKMALIYETFIFO (@STOK_AKTIPIN VARCHAR(8000),\r\n@STOK_MARIN VARCHAR(8000),\r\n@STOK_GGTIPIN VARCHAR(8000),\r\n@TARIH1 DATETIME,@TARIH2 DATETIME)\r\nRETURNS\r\n   @FIFO_MALSTK TABLE (\r\n    STOK_GRUP         VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    STOK_KOD          VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    STOK_AD           VARCHAR(150)  COLLATE Turkish_CI_AS,\r\n    STOK_TIP          VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    ONCEKIMIKTAR      FLOAT,\r\n    ONCEKITUTAR       FLOAT,\r\n    ALISMIKTAR        FLOAT,\r\n    ALISTUTAR         FLOAT,\r\n    SATISMIKTAR        FLOAT,\r\n    SATISTUTAR         FLOAT,\r\n    MALIYETYUZDE       FLOAT,\r\n    SATISKAR           FLOAT,\r\n    ALISKAR            FLOAT,\r\n    DONEMSONUMIKTAR    FLOAT,\r\n    DONEMSONUTUTAR     FLOAT,\r\n    BRMTUT             FLOAT,\r\n    TARIH              DATETIME)\r\nAS\r\nBEGIN\r\n\r\nDECLARE @STOKMALIYET_TEMP TABLE (\r\n    STOK_GRUP          \tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n    STOK_KOD    \t\tVARCHAR(30) COLLATE Turkish_CI_AS,\r\n    STOK_AD    \t\t\tVARCHAR(150)  COLLATE Turkish_CI_AS,\r\n    STOK_TIP    \t\tVARCHAR(20)  COLLATE Turkish_CI_AS,\r\n    ONCEKIMIKTAR      \tFLOAT,\r\n    ONCEKITUTAR       \tFLOAT,\r\n    ALISMIKTAR        \tFLOAT,\r\n    ALISTUTAR         \tFLOAT,\r\n    SATISMIKTAR        \tFLOAT,\r\n    SATISTUTAR         \tFLOAT,\r\n    MALIYETYUZDE       \tFLOAT,\r\n    SATISKAR           \tFLOAT,\r\n    ALISKAR            \tFLOAT,\r\n    DONEMSONUMIKTAR    \tFLOAT,\r\n    DONEMSONUTUTAR     \tFLOAT,\r\n    BRMTUT             \tFLOAT)\r\n\r\n/*FİFO İÇİN GIRIS TABLOSU */\r\nDECLARE @STOKHRK_TEMP TABLE (\r\n    ID           FLOAT,\r\n    STOK_KOD     VARCHAR(30),\r\n    STOK_AD      VARCHAR(150),\r\n    STOK_TIP     VARCHAR(20),\r\n    DEPOKOD      VARCHAR(20),\r\n    HRKTIP       VARCHAR(1),\r\n    MIKTAR       FLOAT,\r\n    BRMTUT       FLOAT,\r\n    CIKMIK       FLOAT,\r\n    TARIH        DATETIME)\r\n\r\n\r\n  DECLARE @ID              FLOAT\r\n  DECLARE @HRK_ID          FLOAT\r\n  DECLARE @HRK_STOK_KOD    VARCHAR(30)\r\n  DECLARE @HRK_STOK_TIP    VARCHAR(20)\r\n  DECLARE @HRK_HRKTIP      VARCHAR(30)\r\n  DECLARE @HRK_TARIH       DATETIME\r\n  DECLARE @HRK_MIKTAR      FLOAT\r\n  DECLARE @HRK_BRMTUT      FLOAT\r\n  DECLARE @HRK_CIKMIK      FLOAT\r\n  DECLARE @KALANMIK        FLOAT\r\n  DECLARE @DUSMIK          FLOAT\r\n\r\n/*-------------STOK KARTLARI AKARYAKIT */\r\n\r\nDECLARE @IN_TEMP TABLE (\r\n    id      FLOAT)\r\n declare @separator char(1)\r\n set @separator = ','\r\n\r\n declare @separator_position int\r\n declare @array_value varchar(1000)\r\n\r\n IF (LEN(RTRIM(@STOK_AKTIPIN)) > 0)\r\n BEGIN\r\n  set @STOK_AKTIPIN = @STOK_AKTIPIN + ','\r\n END\r\n\r\n while patindex('%,%' , @STOK_AKTIPIN) <> 0\r\n begin\r\n\r\n   select @separator_position =  patindex('%,%' , @STOK_AKTIPIN)\r\n   select @array_value = left(@STOK_AKTIPIN, @separator_position - 1)\r\n\r\n  Insert @IN_TEMP\r\n  Values (Cast(@array_value as float))\r\n  select @STOK_AKTIPIN = stuff(@STOK_AKTIPIN, 1, @separator_position, '')\r\n end\r\n\r\n/*---akaryakıt kartları gecici tabloya atıldı */\r\nINSERT @STOKMALIYET_TEMP (STOK_GRUP,STOK_KOD,STOK_AD,STOK_TIP)\r\nSELECT 'Akaryakıt',st.kod,ST.ad,ST.tip\r\nfrom stokkart st with (NOLOCK)\r\nwhere st.sil=0 and st.drm='Aktif' and st.id in (select id from @IN_TEMP)\r\n/*---akaryakıt kartları gecici tabloya atıldı */\r\n\r\n/*---stokhrk kartları gecici tabloya atıldı */\r\n/*-GIRISLER */\r\nINSERT @STOKHRK_TEMP (ID,STOK_KOD,STOK_TIP,DEPOKOD,TARIH,HRKTIP,MIKTAR,BRMTUT,CIKMIK)\r\nSELECT S.id,s.stkod,S.stktip,S.depkod,S.tarih+cast(saat as datetime),'G',S.giren,S.brmfiykdvli,0\r\nFROM stkhrk as s with (NOLOCK) inner join @STOKMALIYET_TEMP as stkt on s.stkod=stkt.STOK_KOD\r\nAND S.stktip=stkt.STOK_TIP\r\nwhere s.giren>0 and (s.tarih <= @TARIH2)\r\nORDER BY S.tarih+cast(saat as datetime)\r\n\r\n    /*----CIKISLAR */\r\n    DECLARE STM_HRK CURSOR FAST_FORWARD FOR\r\n    SELECT  S.id,s.stkod,S.stktip,'C',S.tarih+cast(saat as datetime),S.cikan\r\n    FROM stkhrk as s with (NOLOCK) inner join @STOKMALIYET_TEMP as stkt on s.stkod=stkt.STOK_KOD\r\n    AND S.stktip=stkt.STOK_TIP\r\n    where S.cikan>0 and (s.tarih <= @TARIH2)\r\n    ORDER BY (S.tarih+cast(saat as datetime))\r\n\r\n   OPEN STM_HRK\r\n\r\n   FETCH NEXT FROM STM_HRK INTO\r\n   @HRK_ID,@HRK_STOK_KOD,@HRK_STOK_TIP,@HRK_HRKTIP,@HRK_TARIH,@HRK_CIKMIK\r\n   WHILE @@FETCH_STATUS = 0\r\n   BEGIN\r\n\r\n\r\n     WHILE @HRK_CIKMIK>0 BEGIN\r\n     SET @HRK_BRMTUT=0\r\n     SET @KALANMIK=0\r\n\r\n     SELECT top 1 @ID=ID,@KALANMIK=ISNULL(MIKTAR-CIKMIK,0),@HRK_BRMTUT=ISNULL(BRMTUT,0)\r\n     FROM @STOKHRK_TEMP WHERE STOK_TIP=@HRK_STOK_TIP AND STOK_KOD=@HRK_STOK_KOD\r\n     AND (MIKTAR-CIKMIK)>0 AND HRKTIP='G' ORDER BY TARIH\r\n\r\n    \r\n     IF @KALANMIK=0\r\n     BEGIN\r\n     SET @DUSMIK=@HRK_CIKMIK\r\n     END\r\n     ELSE\r\n     BEGIN\r\n     IF @HRK_CIKMIK>@KALANMIK\r\n     SET @DUSMIK=@KALANMIK\r\n     ELSE\r\n     SET @DUSMIK=@HRK_CIKMIK\r\n     END\r\n    \r\n     /*-SET @DUSMIK=@HRK_CIKMIK */\r\n      INSERT @STOKHRK_TEMP (ID,STOK_KOD,STOK_TIP,HRKTIP,TARIH,MIKTAR,BRMTUT)\r\n      VALUES (@HRK_ID,@HRK_STOK_KOD,@HRK_STOK_TIP,'C',@HRK_TARIH,-1*@DUSMIK,@HRK_BRMTUT)\r\n\r\n      /*-------------------------------- */\r\n      UPDATE @STOKHRK_TEMP SET CIKMIK=CIKMIK+@DUSMIK WHERE ID=@ID\r\n\r\n      SET @HRK_CIKMIK=@HRK_CIKMIK-@DUSMIK\r\n\r\n    END;\r\n\r\n   FETCH NEXT FROM STM_HRK INTO\r\n   @HRK_ID,@HRK_STOK_KOD ,@HRK_STOK_TIP,@HRK_HRKTIP,@HRK_TARIH,@HRK_CIKMIK\r\n  END\r\n\r\n  CLOSE STM_HRK\r\n  DEALLOCATE STM_HRK\r\n\r\n\r\n\r\n  INSERT @FIFO_MALSTK (STOK_KOD,STOK_TIP,ONCEKIMIKTAR,ONCEKITUTAR,ALISMIKTAR,TARIH)\r\n   select STOK_KOD,HRKTIP,MIKTAR,BRMTUT,CIKMIK,TARIH from @STOKHRK_TEMP\r\nRETURN\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "stoksonmik",
    "type": "SQL_SCALAR_FUNCTION",
    "full_name": "dbo.stoksonmik",
    "definition": "CREATE FUNCTION dbo.stoksonmik (@depkod varchar(20),\r\n@stktip varchar(20),@stkod varchar(20))\r\nRETURNS float\r\nAS\r\nBEGIN\r\ndeclare @miktar float;\r\n\r\nif @stktip='markt'\r\nselect top 1 @miktar=sum(giren-cikan) from stkhrk as h with (NOLOCK)\r\nwhere h.depkod=@depkod and h.stktip=@stktip and h.stkod=@stkod\r\nand h.sil=0\r\n\r\nif @stktip='akykt'\r\nselect top 1 @miktar=sum(giren-cikan) from stkhrk as h with (NOLOCK)\r\nwhere h.depkod=@depkod and h.stktip=@stktip and h.stkod=@stkod\r\nand h.sil=0\r\n\r\n\r\nif @miktar is null\r\nset @miktar=0\r\n\r\nreturn @miktar\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "tabloalanscp",
    "type": "SQL_SCALAR_FUNCTION",
    "full_name": "dbo.tabloalanscp",
    "definition": "CREATE FUNCTION [dbo].tabloalanscp (@tabload varchar(30)\r\n)\r\nRETURNS varchar(4000)\r\nAS\r\nBEGIN\r\ndeclare @alanadi varchar(40)\r\ndeclare @id float\r\ndeclare @sqlstr varchar(1000)\r\n\r\ndeclare @fieldstr  varchar(1000);\r\ndeclare @valuestr  varchar(1500);\r\n\r\nset @fieldstr=''\r\nset @valuestr=''\r\n\r\n  Declare curpos CURSOR static FOR\r\n  SELECT col.name FROM syscolumns as col\r\n  left join sysobjects as obj on obj.id=col.id\r\n  where obj.xtype='U' and obj.name=@tabload\r\n  order by colorder\r\n  OPEN curpos\r\n  FETCH First FROM curpos into @alanadi\r\n  WHILE (@@FETCH_STATUS = 0) begin\r\n\r\n    if @fieldstr=''\r\n    set @fieldstr =@alanadi\r\n    else\r\n    set @fieldstr = COALESCE(@fieldstr+',','' )+@alanadi\r\n    FETCH Next FROM curpos into @alanadi\r\n  end;\r\n  CLOSE curpos\r\n  DEALLOCATE curpos\r\n\r\n\r\n set @sqlstr='select '+@valuestr+'=COALESCE('''+@valuestr+''','','')+'''+@fieldstr+N'FROM '+@tabload+'';\r\n\r\n exec @sqlstr\r\n\r\n\r\n\r\nRETURN @fieldstr\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "TERAZI_BARKOD_GETIR",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.TERAZI_BARKOD_GETIR",
    "definition": "CREATE FUNCTION TERAZI_BARKOD_GETIR\r\n(@TIP varchar(10),@BARKOD VARCHAR(20))\r\nRETURNS\r\n   @TB_BARKOD_STOK TABLE (\r\n    STOK_FIRMANO         INT,\r\n    STOK_TIP             VARCHAR(10) COLLATE Turkish_CI_AS,\r\n    STOK_ID              INT,\r\n    STOK_BARKOD          VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    STOK_KOD             VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    STOK_AD              VARCHAR(150) COLLATE Turkish_CI_AS,\r\n    STOK_EKSISAT         VARCHAR(10) COLLATE Turkish_CI_AS,\r\n    STOK_MIN             FLOAT,\r\n    SATISMIK             FLOAT,\r\n    TERAZI               INT,\r\n    CARPAN               FLOAT,\r\n    SAT1FIYAT            FLOAT,\r\n    SAT2FIYAT            FLOAT,\r\n    SAT3FIYAT            FLOAT,\r\n    SAT4FIYAT            FLOAT,\r\n    STOK_GTIP            VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    STOK_BEDELSIZ        BIT DEFAULT 0 )\r\nAS\r\nBEGIN\r\n DECLARE @TERBARKARSAY      INT\r\n DECLARE @GEC_BARKOD    \tVARCHAR(20)\r\n DECLARE @SATISMIK      \tVARCHAR(20)\r\n DECLARE @KONT              INT\r\n DECLARE @CARPAN            FLOAT\r\n DECLARE @MIKTARKR          INT\r\n DECLARE @I                 INT\r\n DECLARE @TER               INT\r\n Declare @BedelsizBarkodKontrol      bit\r\n\r\n\r\n  select top 1 @BedelsizBarkodKontrol=BedelsizBarkodKontrol from sistemtanim\r\n\r\n\r\n/*\r\n select @TERBARKARSAY=terazikarksay from sistemtanim\r\n\r\n if len(@BARKOD)<@TERBARKARSAY\r\n  begin\r\n  SELECT @GEC_BARKOD=@BARKOD\r\n  --SET @SATISMIK='1'\r\n  end\r\n  else\r\n  begin\r\n  SELECT @GEC_BARKOD=SUBSTRING(@BARKOD,1,@TERBARKARSAY)\r\n -- if ISNUMERIC(SUBSTRING(@BARKOD,@TERBARKARSAY,LEN(@BARKOD)-@TERBARKARSAY))=0\r\n  --SET @SATISMIK='1'\r\n  --ELSE\r\n  SET @SATISMIK=SUBSTRING(@BARKOD,@TERBARKARSAY+1,LEN(@BARKOD)-@TERBARKARSAY)\r\n  end\r\n*/\r\n  SET @KONT=0\r\n  SET @TER=0\r\n  SET @GEC_BARKOD=@BARKOD\r\n \r\n  if ('27'=SUBSTRING(@BARKOD,1,2))\r\n  or ('28'=SUBSTRING(@BARKOD,1,2))\r\n  or ('29'=SUBSTRING(@BARKOD,1,2))\r\n   begin\r\n    SET @TER=1\r\n    SET @GEC_BARKOD=SUBSTRING(@BARKOD,1,7)\r\n    if len(@BARKOD)>=7\r\n    SET @SATISMIK=SUBSTRING(@BARKOD,8,5)\r\n    ELSE\r\n    SET @SATISMIK='1'\r\n   end\r\n\r\n\r\n  if (select COUNT(*) from stokkart as k with (nolock)\r\n  inner join barkod as b with (nolock) on b.barkod=@GEC_BARKOD\r\n  and b.kod=k.kod and k.tip=@TIP and k.tip=b.tip and\r\n  b.sil=0 and k.sil=0 and k.drm='Aktif')>0\r\n    begin\r\n     SET @KONT=1\r\n     insert into @TB_BARKOD_STOK\r\n     (STOK_FIRMANO,STOK_TIP,STOK_ID,STOK_BARKOD,STOK_KOD,STOK_AD,STOK_EKSISAT,\r\n     STOK_MIN,SATISMIK,TERAZI,CARPAN,SAT1FIYAT,\r\n     SAT2FIYAT,SAT3FIYAT,SAT4FIYAT,STOK_GTIP)\r\n     select k.firmano,k.tip,k.id,@BARKOD,k.kod,k.ad,k.eksat,k.minmik,\r\n     1,@TER,b.carpan,\r\n     case when sat1kdvtip='Dahil' then sat1fiy else\r\n     sat1fiy*(1+(sat1kdv/100)) end,\r\n     case when sat2kdvtip='Dahil' then sat2fiy else\r\n     sat2fiy*(1+(sat2kdv/100)) end,\r\n     case when sat3kdvtip='Dahil' then sat3fiy else\r\n     sat3fiy*(1+(sat3kdv/100)) end,\r\n     case when sat4kdvtip='Dahil' then sat4fiy else\r\n     sat4fiy*(1+(sat4kdv/100)) end,\r\n     K.Gtip\r\n     from stokkart as k with (nolock) \r\n     inner join barkod as b with (nolock) on b.barkod=@GEC_BARKOD\r\n     and b.kod=k.kod and k.tip=@TIP and k.tip=b.tip and\r\n     b.sil=0 and k.sil=0 and k.drm='Aktif'\r\n    end\r\n    \r\n   \r\n   if (@BedelsizBarkodKontrol=1) and (@KONT=0)\r\n    begin\r\n        \r\n     insert into @TB_BARKOD_STOK\r\n     (STOK_FIRMANO,STOK_TIP,STOK_ID,STOK_BARKOD,STOK_KOD,STOK_AD,STOK_EKSISAT,\r\n     STOK_MIN,SATISMIK,TERAZI,CARPAN,SAT1FIYAT,\r\n     SAT2FIYAT,SAT3FIYAT,SAT4FIYAT,STOK_GTIP,STOK_BEDELSIZ)\r\n     select k.firmano,k.tip,k.id,@BARKOD,k.kod,k.ad,k.eksat,k.minmik,\r\n     1,@TER,b.carpan,0.01,0.01,0.01,0.01,K.Gtip,1 from stokkart as k with (nolock) \r\n     inner join BarkodBedelsiz as b with (nolock) on b.barkod=@GEC_BARKOD\r\n     and b.kod=k.kod and k.tip=@TIP and k.tip=b.tip and\r\n     b.sil=0 and k.sil=0 and k.drm='Aktif' and b.Aktif=1 \r\n     \r\n     if (select count(*) from @TB_BARKOD_STOK)>0\r\n      SET @KONT=1\r\n\r\n    end   \r\n   \r\n  \r\n    if (@KONT=0)\r\n    begin\r\n     /*SET @KONT=0 */\r\n     insert into @TB_BARKOD_STOK\r\n     (STOK_FIRMANO,STOK_TIP,STOK_ID,STOK_BARKOD,STOK_KOD,STOK_AD,STOK_EKSISAT,\r\n     STOK_MIN,SATISMIK,TERAZI,CARPAN,SAT1FIYAT,\r\n     SAT2FIYAT,SAT3FIYAT,SAT4FIYAT,STOK_GTIP)\r\n     select k.firmano,k.tip,k.id,@BARKOD,k.kod,k.ad,k.eksat,k.minmik,\r\n     1,0,1,\r\n     case when sat1kdvtip='Dahil' then sat1fiy else\r\n     sat1fiy*(1+(sat1kdv/100)) end,\r\n     case when sat2kdvtip='Dahil' then sat2fiy else\r\n     sat2fiy*(1+(sat2kdv/100)) end,\r\n     case when sat3kdvtip='Dahil' then sat3fiy else\r\n     sat3fiy*(1+(sat3kdv/100)) end,\r\n     case when sat4kdvtip='Dahil' then sat4fiy else\r\n     sat4fiy*(1+(sat4kdv/100)) end,\r\n     K.Gtip from stokkart as k with (nolock)\r\n     inner join barkod as b with (nolock) on b.barkod=@BARKOD\r\n     and b.kod=k.kod and k.tip=@TIP and k.tip=b.tip and\r\n     b.sil=0 and k.sil=0 and k.drm='Aktif'\r\n    end\r\n\r\n\r\n  if ((select count(*) from @TB_BARKOD_STOK)>0) and @KONT=1\r\n   begin\r\n    select @MIKTARKR=5 FROM @TB_BARKOD_STOK\r\n    \r\n    SELECT @SATISMIK=SUBSTRING(@SATISMIK,1,@MIKTARKR)\r\n    \r\n    \r\n    IF LEN(@SATISMIK)> 0\r\n    BEGIN\r\n     SET @I=LEN(@SATISMIK)\r\n     WHILE @I> @MIKTARKR\r\n      BEGIN\r\n       SET @SATISMIK='0'+@SATISMIK\r\n      END\r\n\r\n     update @TB_BARKOD_STOK set SATISMIK=(@SATISMIK)*CARPAN\r\n     \r\n     update @TB_BARKOD_STOK set CARPAN=SATISMIK\r\n     \r\n     \r\n    end\r\n    \r\n     \r\n   end\r\n\r\n\r\n RETURN\r\n  \r\n  \r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_ALS_SAT_KONSOLIDE_ALS",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_ALS_SAT_KONSOLIDE_ALS",
    "definition": "CREATE FUNCTION [dbo].[UDF_ALS_SAT_KONSOLIDE_ALS]\r\n(@FIRMA_NO          INT,\r\n@id  \t\t\t\tINT,\r\n@BAS_TAR\t\t   DATETIME,\r\n@BIT_TAR\t\t   DATETIME)\r\nRETURNS\r\n @TB_ALS_SAT_BASLIK TABLE (\r\n    ID\t\t\t\t\t INT,\r\n    PARENTID\t\t\t INT,\t\r\n    GRPNO\t\t\t\t INT,\r\n    TIP\t\t\t \t\t VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    ACK         \t\t VARCHAR(100) COLLATE Turkish_CI_AS,\r\n    ALS_MIKTAR      \t FLOAT,\r\n    SAT_MIKTAR      \t FLOAT,\r\n    ALS_TUTAR   \t     FLOAT,\r\n    SAT_TUTAR        \t FLOAT)\r\n AS\r\n BEGIN   \r\n \r\n   DECLARE @TB_ALS_SAT TABLE (\r\n    FIRMA_NO\t\t\t VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    FIRMA_AD         VARCHAR(100) COLLATE Turkish_CI_AS,\r\n    TIP\t\t\t\t VARCHAR(50) COLLATE Turkish_CI_AS,\t\t\t\t \r\n    ACK       \t\t VARCHAR(100) COLLATE Turkish_CI_AS,\r\n    GC\t\t\t   \t INT,\r\n    MIKTAR   \t \t FLOAT,\r\n    TUTAR   \t \t FLOAT)\r\n \r\n    \r\n    \r\n   insert into @TB_ALS_SAT (FIRMA_NO,FIRMA_AD,TIP,ACK,GC,MIKTAR,TUTAR)\r\n   SELECT m.cartip,M.carkod,h.stktip,h.stkod,m.gctip,\r\n   (mik*carpan),\r\n   ( (h.brmfiy+h.otvbrim)-(h.satisktut+h.genisktut))\r\n   *(1+h.kdvyuz)*(mik*carpan)\r\n   FROM faturamas as m \r\n   inner join faturahrklistesi as h on m.fatid=h.fatid\r\n   and m.sil=0 and h.sil=0\r\n    where m.firmano=@FIRMA_NO and M.fattip='FATAKALS' and\r\n    m.tarih>=@BAS_TAR and m.tarih<=@BIT_TAR\r\n    and h.stktip in ('akykt')\r\n    \r\n    \r\n    \r\n      update @TB_ALS_SAT set ACK=dt.grp1 from @TB_ALS_SAT as t join\r\n      (select tip,kod,grp1 from stokkart where tip='akykt') dt \r\n      on t.TIP=dt.tip and t.ACK=dt.kod\r\n      \r\n      update @TB_ALS_SAT set ACK=dt.ad from @TB_ALS_SAT as t join\r\n      (select id,ad from grup ) dt \r\n      on t.ACK=dt.id\r\n      \r\n      update @TB_ALS_SAT set FIRMA_NO=dt.kod,FIRMA_AD=dt.ad from \r\n      @TB_ALS_SAT as t join\r\n      (select cartp,kod,ad from Genel_Kart ) dt \r\n      on t.FIRMA_NO=dt.cartp and t.FIRMA_AD=dt.kod\r\n  \r\n\r\n\r\n  declare @grp1id int\r\n  declare @grp2id int\r\n\r\n  declare @KOD      varchar(100)\r\n  declare @TIP      varchar(30)\r\n  declare @GRP_AD   varchar(100)\r\n  declare @GRP_ID  \tvarchar(50)\r\n\r\n  \r\n  declare @ALS_MIKTAR  \tfloat\r\n  declare @SAT_MIKTAR  \tfloat\r\n  declare @ALS_TUTAR  \tfloat\r\n  declare @SAT_TUTAR  \tfloat\r\n  \r\n  \r\n  set @grp1id=@id\r\n    \r\n  insert into @TB_ALS_SAT_BASLIK (ID,PARENTID,ACK,ALS_MIKTAR,SAT_MIKTAR,\r\n  ALS_TUTAR,SAT_TUTAR)\r\n  VALUES (@grp1id,0,'ALIŞ TOPLAMLAR',0,0,0,0)\r\n  \r\n   declare mas_cur CURSOR FAST_FORWARD  FOR \r\n    select FIRMA_NO,FIRMA_AD from @TB_ALS_SAT GROUP BY FIRMA_NO,FIRMA_AD\r\n      open mas_cur\r\n       fetch next from  mas_cur into @GRP_ID,@GRP_AD\r\n        while @@FETCH_STATUS=0\r\n         begin\r\n           set @id=@id+1 \r\n           set @grp2id=@id\r\n     \r\n            insert into @TB_ALS_SAT_BASLIK (ID,PARENTID,ACK,\r\n            ALS_MIKTAR,SAT_MIKTAR,ALS_TUTAR,SAT_TUTAR)\r\n            VALUES (@id,@grp1id,@GRP_AD,0,0,0,0)\r\n   \r\n             set @id=@id+1 \r\n             \r\n             \r\n             \r\n             declare gec_cur CURSOR FAST_FORWARD  FOR \r\n              select TIP,ACK,\r\n              SUM(CASE WHEN GC=1 THEN MIKTAR ELSE 0 END),\r\n              SUM(CASE WHEN GC=2 THEN MIKTAR ELSE 0 END),\r\n              SUM(CASE WHEN GC=1 THEN TUTAR ELSE 0 END),\r\n              SUM(CASE WHEN GC=2 THEN TUTAR ELSE 0 END)\r\n              FROM @TB_ALS_SAT \r\n              WHERE FIRMA_NO=@GRP_ID\r\n              GROUP BY TIP,ACK \r\n               open gec_cur\r\n                fetch next from  gec_cur into @TIP,@KOD,\r\n                @ALS_MIKTAR,@SAT_MIKTAR,@ALS_TUTAR,@SAT_TUTAR\r\n                 while @@FETCH_STATUS=0\r\n                  begin\r\n                  \r\n               \r\n                 insert into @TB_ALS_SAT_BASLIK (ID,PARENTID,\r\n                 TIP,ACK,ALS_MIKTAR,SAT_MIKTAR,ALS_TUTAR,SAT_TUTAR)\r\n                 VALUES (@id,@grp2id,@TIP,@KOD,@ALS_MIKTAR,@SAT_MIKTAR,\r\n                 @ALS_TUTAR,@SAT_TUTAR)\r\n\r\n                set @id=@id+1  \r\n\r\n             FETCH next from  gec_cur into @TIP,@KOD,@ALS_MIKTAR,@SAT_MIKTAR,\r\n                @ALS_TUTAR,@SAT_TUTAR\r\n           end\r\n         close gec_cur\r\n         deallocate gec_cur\r\n         \r\n         \r\n         \r\n          update @TB_ALS_SAT_BASLIK set \r\n           ALS_MIKTAR=isnull(dt.ALS_MIKTAR,0),\r\n           SAT_MIKTAR=isnull(dt.SAT_MIKTAR,0),\r\n           ALS_TUTAR=isnull(dt.ALS_TUTAR,0),\r\n           SAT_TUTAR=isnull(dt.SAT_TUTAR,0)\r\n            from @TB_ALS_SAT_BASLIK as t\r\n           join (select \r\n           sum(ALS_MIKTAR) as ALS_MIKTAR,\r\n           sum(SAT_MIKTAR) as SAT_MIKTAR,\r\n           sum(ALS_TUTAR) as ALS_TUTAR,\r\n           sum(SAT_TUTAR) as SAT_TUTAR          \r\n           from @TB_ALS_SAT_BASLIK where PARENTID=@grp2id ) dt \r\n           on t.ID=@grp2id     \r\n                   \r\n                   \r\n          FETCH next from  mas_cur into @GRP_ID,@GRP_AD\r\n         end\r\n        Close mas_cur\r\n        deallocate mas_cur      \r\n         \r\n         \r\n         \r\n         update @TB_ALS_SAT_BASLIK set \r\n          ALS_MIKTAR=isnull(dt.ALS_MIKTAR,0),\r\n           SAT_MIKTAR=isnull(dt.SAT_MIKTAR,0),\r\n           ALS_TUTAR=isnull(dt.ALS_TUTAR,0),\r\n           SAT_TUTAR=isnull(dt.SAT_TUTAR,0)\r\n            from @TB_ALS_SAT_BASLIK as t\r\n           join (select \r\n           sum(ALS_MIKTAR) as ALS_MIKTAR,\r\n           sum(SAT_MIKTAR) as SAT_MIKTAR,\r\n           sum(ALS_TUTAR) as ALS_TUTAR,\r\n           sum(SAT_TUTAR) as SAT_TUTAR \r\n         from @TB_ALS_SAT_BASLIK where PARENTID=@grp1id ) dt \r\n         on t.ID=@grp1id             \r\n                 \r\n \r\n  return\r\n\r\n END"
  },
  {
    "schema": "dbo",
    "name": "UDF_ALS_SAT_KONSOLIDE_GEN",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_ALS_SAT_KONSOLIDE_GEN",
    "definition": "CREATE FUNCTION [dbo].UDF_ALS_SAT_KONSOLIDE_GEN\r\n(@FIRMA_NO          INT,\r\n@id  \t\t\t\tINT,\r\n@BAS_TAR\t\t   DATETIME,\r\n@BIT_TAR\t\t   DATETIME)\r\nRETURNS\r\n @TB_ALS_SAT_BASLIK TABLE (\r\n    ID\t\t\t\t\t INT,\r\n    PARENTID\t\t\t INT,\t\r\n    GRPNO\t\t\t\t INT,\r\n    TIP\t\t\t \t\t VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    ACK         \t\t VARCHAR(100) COLLATE Turkish_CI_AS,\r\n    ALS_MIKTAR      \t FLOAT,\r\n    SAT_MIKTAR      \t FLOAT,\r\n    ALS_TUTAR   \t     FLOAT,\r\n    SAT_TUTAR        \t FLOAT)\r\n AS\r\n BEGIN   \r\n \r\n   DECLARE @TB_ALS_SAT TABLE (\r\n    FIRMA_NO\t\t\t INT,\r\n    FIRMA_AD         VARCHAR(100) COLLATE Turkish_CI_AS,\r\n    TIP\t\t\t\t VARCHAR(50) COLLATE Turkish_CI_AS,\t\t\t\t \r\n    ACK       \t\t VARCHAR(100) COLLATE Turkish_CI_AS,\r\n    GC\t\t\t   \t INT,\r\n    MIKTAR   \t \t FLOAT,\r\n    TUTAR   \t \t FLOAT)\r\n \r\n    \r\n    \r\n   insert into @TB_ALS_SAT (FIRMA_NO,TIP,ACK,GC,MIKTAR,TUTAR)\r\n   SELECT m.firmano,h.stktip,h.stkod,m.gctip,\r\n   (mik*carpan),\r\n   ( (h.brmfiy+h.otvbrim)-(h.satisktut+h.genisktut))\r\n   *(1+h.kdvyuz)*(mik*carpan)\r\n   FROM faturamas as m \r\n   inner join faturahrklistesi as h on m.fatid=h.fatid\r\n   and m.sil=0 and h.sil=0\r\n    where m.firmano=@FIRMA_NO and M.fattip='FATAKALS' and\r\n    m.tarih>=@BAS_TAR and m.tarih<=@BIT_TAR\r\n    and h.stktip in ('akykt')\r\n    \r\n    \r\n    \r\n   insert into @TB_ALS_SAT (FIRMA_NO,TIP,ACK,GC,MIKTAR,TUTAR)\r\n   SELECT m.firmano,h.stktip,h.stkod,2,\r\n   (miktar),\r\n   ((h.brmfiy+h.otvbrim)-(h.satisktut+h.genisktut))\r\n   *(1+h.kdvyuz)*(miktar)\r\n   FROM faturamas as m \r\n   inner join faturahrklistesi as h on m.fatid=h.fatid\r\n   and m.sil=0 and h.sil=0\r\n   inner join Fat_Dep as d on d.FatHrk_id=h.id\r\n    where m.firmano=@FIRMA_NO and M.fattip='FATAKALS' and \r\n    m.tarih>=@BAS_TAR and m.tarih<=@BIT_TAR\r\n    and h.stktip in ('akykt')\r\n    \r\n    \r\n     /*UDF_ALS_SAT_KONSOLIDE_SAT */\r\n    \r\n     /*UDF_ALS_SAT_KONSOLIDE_SAT */\r\n    \r\n    insert into @TB_ALS_SAT (FIRMA_NO,FIRMA_AD,TIP,ACK,GC,MIKTAR,TUTAR)\r\n    SELECT m.firmano,'',h.stktip,h.stkod,m.gctip,\r\n    (mik*carpan),\r\n    ( (h.brmfiy+h.otvbrim)-(h.satisktut+h.genisktut))\r\n    *(1+h.kdvyuz)*(mik*carpan)\r\n    FROM faturamas as m \r\n    inner join faturahrklistesi as h on m.fatid=h.fatid\r\n    and m.sil=0 and h.sil=0\r\n    where m.firmano=@FIRMA_NO \r\n    and M.gctip=2 and M.hrk_stk_pro=1 and \r\n    m.tarih>=@BAS_TAR and m.tarih<=@BIT_TAR\r\n    and h.stktip in ('akykt')\r\n    \r\n    \r\n    \r\n     insert into @TB_ALS_SAT (FIRMA_NO,FIRMA_AD,TIP,ACK,GC,MIKTAR,TUTAR)\r\n     SELECT m.firmano,'',h.stktip,h.stkod,m.gctip,\r\n     (mik),(h.brmfiy*mik)\r\n     FROM veresimas as m \r\n     inner join veresihrk as h on m.verid=h.verid\r\n     where m.firmano=@FIRMA_NO  and m.Sil=0\r\n     and M.gctip=2 and M.hrk_stk_pro=1 and \r\n     m.tarih>=@BAS_TAR and m.tarih<=@BIT_TAR\r\n     and h.stktip in ('akykt')\r\n    \r\n   \r\n     /*UDF_ALS_SAT_KONSOLIDE_SAT */\r\n    \r\n    \r\n    \r\n      update @TB_ALS_SAT set ACK=dt.grp1 from @TB_ALS_SAT as t join\r\n      (select tip,kod,grp1 from stokkart where tip='akykt') dt \r\n      on t.TIP=dt.tip and t.ACK=dt.kod\r\n      \r\n      update @TB_ALS_SAT set ACK=dt.ad from @TB_ALS_SAT as t join\r\n      (select id,ad from grup ) dt \r\n      on t.ACK=dt.id\r\n      \r\n      update @TB_ALS_SAT set FIRMA_AD=dt.ad from @TB_ALS_SAT as t join\r\n      (select id,ad from firma ) dt \r\n      on t.FIRMA_NO=dt.id \r\n  \r\n\r\n\r\n  declare @grp1id int\r\n  declare @grp2id int\r\n\r\n  declare @KOD      varchar(100)\r\n  declare @TIP      varchar(30)\r\n  declare @GRP_AD   varchar(100)\r\n  declare @GRP_ID  \tfloat\r\n\r\n  \r\n  declare @ALS_MIKTAR  \tfloat\r\n  declare @SAT_MIKTAR  \tfloat\r\n  declare @ALS_TUTAR  \tfloat\r\n  declare @SAT_TUTAR  \tfloat\r\n  \r\n  \r\n  set @grp1id=@id\r\n    \r\n  insert into @TB_ALS_SAT_BASLIK (ID,PARENTID,ACK,ALS_MIKTAR,SAT_MIKTAR,\r\n  ALS_TUTAR,SAT_TUTAR)\r\n  VALUES (@grp1id,0,'GENEL TOPLAMLAR',0,0,0,0)\r\n  \r\n   declare mas_cur CURSOR FAST_FORWARD  FOR \r\n    select FIRMA_NO,FIRMA_AD from @TB_ALS_SAT GROUP BY FIRMA_NO,FIRMA_AD\r\n      open mas_cur\r\n       fetch next from  mas_cur into @GRP_ID,@GRP_AD\r\n        while @@FETCH_STATUS=0\r\n         begin\r\n           set @id=@id+1 \r\n           set @grp2id=@id\r\n     \r\n            insert into @TB_ALS_SAT_BASLIK (ID,PARENTID,ACK,\r\n            ALS_MIKTAR,SAT_MIKTAR,ALS_TUTAR,SAT_TUTAR)\r\n            VALUES (@id,@grp1id,@GRP_AD,0,0,0,0)\r\n   \r\n             set @id=@id+1 \r\n             \r\n             \r\n             \r\n             declare gec_cur CURSOR FAST_FORWARD  FOR \r\n              select TIP,ACK,\r\n              SUM(CASE WHEN GC=1 THEN MIKTAR ELSE 0 END),\r\n              SUM(CASE WHEN GC=2 THEN MIKTAR ELSE 0 END),\r\n              SUM(CASE WHEN GC=1 THEN TUTAR ELSE 0 END),\r\n              SUM(CASE WHEN GC=2 THEN TUTAR ELSE 0 END)\r\n              FROM @TB_ALS_SAT \r\n              WHERE FIRMA_NO=@GRP_ID\r\n              GROUP BY TIP,ACK \r\n               open gec_cur\r\n                fetch next from  gec_cur into @TIP,@KOD,\r\n                @ALS_MIKTAR,@SAT_MIKTAR,@ALS_TUTAR,@SAT_TUTAR\r\n                 while @@FETCH_STATUS=0\r\n                  begin\r\n                  \r\n               \r\n                 insert into @TB_ALS_SAT_BASLIK (ID,PARENTID,\r\n                 TIP,ACK,ALS_MIKTAR,SAT_MIKTAR,ALS_TUTAR,SAT_TUTAR)\r\n                 VALUES (@id,@grp2id,@TIP,@KOD,@ALS_MIKTAR,@SAT_MIKTAR,\r\n                 @ALS_TUTAR,@SAT_TUTAR)\r\n\r\n                set @id=@id+1  \r\n\r\n             FETCH next from  gec_cur into @TIP,@KOD,@ALS_MIKTAR,@SAT_MIKTAR,\r\n                @ALS_TUTAR,@SAT_TUTAR\r\n           end\r\n         close gec_cur\r\n         deallocate gec_cur\r\n         \r\n         \r\n         \r\n          update @TB_ALS_SAT_BASLIK set \r\n           ALS_MIKTAR=isnull(dt.ALS_MIKTAR,0),\r\n           SAT_MIKTAR=isnull(dt.SAT_MIKTAR,0),\r\n           ALS_TUTAR=isnull(dt.ALS_TUTAR,0),\r\n           SAT_TUTAR=isnull(dt.SAT_TUTAR,0)\r\n            from @TB_ALS_SAT_BASLIK as t\r\n           join (select \r\n           sum(ALS_MIKTAR) as ALS_MIKTAR,\r\n           sum(SAT_MIKTAR) as SAT_MIKTAR,\r\n           sum(ALS_TUTAR) as ALS_TUTAR,\r\n           sum(SAT_TUTAR) as SAT_TUTAR          \r\n           from @TB_ALS_SAT_BASLIK where PARENTID=@grp2id ) dt \r\n           on t.ID=@grp2id     \r\n                   \r\n                   \r\n          FETCH next from  mas_cur into @GRP_ID,@GRP_AD\r\n         end\r\n        Close mas_cur\r\n        deallocate mas_cur      \r\n         \r\n         \r\n         \r\n         update @TB_ALS_SAT_BASLIK set \r\n          ALS_MIKTAR=isnull(dt.ALS_MIKTAR,0),\r\n           SAT_MIKTAR=isnull(dt.SAT_MIKTAR,0),\r\n           ALS_TUTAR=isnull(dt.ALS_TUTAR,0),\r\n           SAT_TUTAR=isnull(dt.SAT_TUTAR,0)\r\n            from @TB_ALS_SAT_BASLIK as t\r\n           join (select \r\n           sum(ALS_MIKTAR) as ALS_MIKTAR,\r\n           sum(SAT_MIKTAR) as SAT_MIKTAR,\r\n           sum(ALS_TUTAR) as ALS_TUTAR,\r\n           sum(SAT_TUTAR) as SAT_TUTAR \r\n         from @TB_ALS_SAT_BASLIK where PARENTID=@grp1id ) dt \r\n         on t.ID=@grp1id             \r\n                 \r\n \r\n  return\r\n\r\n END"
  },
  {
    "schema": "dbo",
    "name": "UDF_ALS_SAT_KONSOLIDE_SAT",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_ALS_SAT_KONSOLIDE_SAT",
    "definition": "CREATE FUNCTION [dbo].[UDF_ALS_SAT_KONSOLIDE_SAT]\r\n(@FIRMA_NO          INT,\r\n@id  \t\t\t\tINT,\r\n@BAS_TAR\t\t   DATETIME,\r\n@BIT_TAR\t\t   DATETIME)\r\nRETURNS\r\n @TB_ALS_SAT_BASLIK TABLE (\r\n    ID\t\t\t\t\t INT,\r\n    PARENTID\t\t\t INT,\t\r\n    GRPNO\t\t\t\t INT,\r\n    TIP\t\t\t \t\t VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    ACK         \t\t VARCHAR(100) COLLATE Turkish_CI_AS,\r\n    ALS_MIKTAR      \t FLOAT,\r\n    SAT_MIKTAR      \t FLOAT,\r\n    ALS_TUTAR   \t     FLOAT,\r\n    SAT_TUTAR        \t FLOAT)\r\n AS\r\n BEGIN   \r\n \r\n   DECLARE @TB_ALS_SAT TABLE (\r\n    FIRMA_NO\t\t\t VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    FIRMA_AD         VARCHAR(100) COLLATE Turkish_CI_AS,\r\n    TIP\t\t\t\t VARCHAR(50) COLLATE Turkish_CI_AS,\t\t\t\t \r\n    ACK       \t\t VARCHAR(100) COLLATE Turkish_CI_AS,\r\n    GC\t\t\t   \t INT,\r\n    MIKTAR   \t \t FLOAT,\r\n    TUTAR   \t \t FLOAT)\r\n \r\n    \r\n    \r\n   insert into @TB_ALS_SAT (FIRMA_NO,FIRMA_AD,TIP,ACK,GC,MIKTAR,TUTAR)\r\n   SELECT m.cartip,M.carkod,h.stktip,h.stkod,m.gctip,\r\n   (mik*carpan),\r\n   ( (h.brmfiy+h.otvbrim)-(h.satisktut+h.genisktut))\r\n   *(1+h.kdvyuz)*(mik*carpan)\r\n   FROM faturamas as m \r\n   inner join faturahrklistesi as h on m.fatid=h.fatid\r\n   and m.sil=0 and h.sil=0\r\n    where m.firmano=@FIRMA_NO \r\n    and M.gctip=2 and M.hrk_stk_pro=1 and \r\n    m.tarih>=@BAS_TAR and m.tarih<=@BIT_TAR\r\n    and h.stktip in ('akykt')\r\n    \r\n    \r\n    \r\n    insert into @TB_ALS_SAT (FIRMA_NO,FIRMA_AD,TIP,ACK,GC,MIKTAR,TUTAR)\r\n    SELECT m.cartip,M.carkod,h.stktip,h.stkod,m.gctip,\r\n     (mik),(h.brmfiy*mik)\r\n     FROM veresimas as m \r\n     inner join veresihrk as h on m.verid=h.verid\r\n      where m.firmano=@FIRMA_NO and m.sil=0\r\n      and M.gctip=2 and M.hrk_stk_pro=1 and \r\n      m.tarih>=@BAS_TAR and m.tarih<=@BIT_TAR\r\n      and h.stktip in ('akykt')\r\n    \r\n    \r\n    \r\n      update @TB_ALS_SAT set ACK=dt.grp1 from @TB_ALS_SAT as t join\r\n      (select tip,kod,grp1 from stokkart where tip='akykt') dt \r\n      on t.TIP=dt.tip and t.ACK=dt.kod\r\n      \r\n      update @TB_ALS_SAT set ACK=dt.ad from @TB_ALS_SAT as t join\r\n      (select id,ad from grup ) dt \r\n      on t.ACK=dt.id\r\n      \r\n      update @TB_ALS_SAT set FIRMA_NO=dt.kod,FIRMA_AD=dt.ad from \r\n      @TB_ALS_SAT as t join\r\n      (select cartp,kod,ad from Genel_Kart ) dt \r\n      on t.FIRMA_NO=dt.cartp and t.FIRMA_AD=dt.kod\r\n  \r\n\r\n\r\n  declare @grp1id int\r\n  declare @grp2id int\r\n\r\n  declare @KOD      varchar(100)\r\n  declare @TIP      varchar(30)\r\n  declare @GRP_AD   varchar(100)\r\n  declare @GRP_ID  \tvarchar(50)\r\n\r\n  \r\n  declare @ALS_MIKTAR  \tfloat\r\n  declare @SAT_MIKTAR  \tfloat\r\n  declare @ALS_TUTAR  \tfloat\r\n  declare @SAT_TUTAR  \tfloat\r\n  \r\n  \r\n  set @grp1id=@id\r\n    \r\n  insert into @TB_ALS_SAT_BASLIK (ID,PARENTID,ACK,ALS_MIKTAR,SAT_MIKTAR,\r\n  ALS_TUTAR,SAT_TUTAR)\r\n  VALUES (@grp1id,0,'SATIŞ TOPLAMLAR',0,0,0,0)\r\n  \r\n   declare mas_cur CURSOR FAST_FORWARD  FOR \r\n    select FIRMA_NO,FIRMA_AD from @TB_ALS_SAT GROUP BY FIRMA_NO,FIRMA_AD\r\n      open mas_cur\r\n       fetch next from  mas_cur into @GRP_ID,@GRP_AD\r\n        while @@FETCH_STATUS=0\r\n         begin\r\n           set @id=@id+1 \r\n           set @grp2id=@id\r\n     \r\n            insert into @TB_ALS_SAT_BASLIK (ID,PARENTID,ACK,\r\n            ALS_MIKTAR,SAT_MIKTAR,ALS_TUTAR,SAT_TUTAR)\r\n            VALUES (@id,@grp1id,@GRP_AD,0,0,0,0)\r\n   \r\n             set @id=@id+1 \r\n             \r\n             \r\n             \r\n             declare gec_cur CURSOR FAST_FORWARD  FOR \r\n              select TIP,ACK,\r\n              SUM(CASE WHEN GC=1 THEN MIKTAR ELSE 0 END),\r\n              SUM(CASE WHEN GC=2 THEN MIKTAR ELSE 0 END),\r\n              SUM(CASE WHEN GC=1 THEN TUTAR ELSE 0 END),\r\n              SUM(CASE WHEN GC=2 THEN TUTAR ELSE 0 END)\r\n              FROM @TB_ALS_SAT \r\n              WHERE FIRMA_NO=@GRP_ID\r\n              GROUP BY TIP,ACK \r\n               open gec_cur\r\n                fetch next from  gec_cur into @TIP,@KOD,\r\n                @ALS_MIKTAR,@SAT_MIKTAR,@ALS_TUTAR,@SAT_TUTAR\r\n                 while @@FETCH_STATUS=0\r\n                  begin\r\n                  \r\n               \r\n                 insert into @TB_ALS_SAT_BASLIK (ID,PARENTID,\r\n                 TIP,ACK,ALS_MIKTAR,SAT_MIKTAR,ALS_TUTAR,SAT_TUTAR)\r\n                 VALUES (@id,@grp2id,@TIP,@KOD,@ALS_MIKTAR,@SAT_MIKTAR,\r\n                 @ALS_TUTAR,@SAT_TUTAR)\r\n\r\n                set @id=@id+1  \r\n\r\n                FETCH next from  gec_cur into @TIP,@KOD,@ALS_MIKTAR,@SAT_MIKTAR,\r\n                @ALS_TUTAR,@SAT_TUTAR\r\n              end\r\n             close gec_cur\r\n             deallocate gec_cur\r\n         \r\n         \r\n          \r\n           update @TB_ALS_SAT_BASLIK set \r\n           ALS_MIKTAR=isnull(dt.ALS_MIKTAR,0),\r\n           SAT_MIKTAR=isnull(dt.SAT_MIKTAR,0),\r\n           ALS_TUTAR=isnull(dt.ALS_TUTAR,0),\r\n           SAT_TUTAR=isnull(dt.SAT_TUTAR,0)\r\n            from @TB_ALS_SAT_BASLIK as t\r\n           join (select \r\n           sum(ALS_MIKTAR) as ALS_MIKTAR,\r\n           sum(SAT_MIKTAR) as SAT_MIKTAR,\r\n           sum(ALS_TUTAR) as ALS_TUTAR,\r\n           sum(SAT_TUTAR) as SAT_TUTAR          \r\n           from @TB_ALS_SAT_BASLIK where PARENTID=@grp2id ) dt \r\n           on t.ID=@grp2id     \r\n                  \r\n                   \r\n          FETCH next from  mas_cur into @GRP_ID,@GRP_AD\r\n         end\r\n        Close mas_cur\r\n        deallocate mas_cur      \r\n         \r\n         \r\n         \r\n         update @TB_ALS_SAT_BASLIK set \r\n          ALS_MIKTAR=isnull(dt.ALS_MIKTAR,0),\r\n           SAT_MIKTAR=isnull(dt.SAT_MIKTAR,0),\r\n           ALS_TUTAR=isnull(dt.ALS_TUTAR,0),\r\n           SAT_TUTAR=isnull(dt.SAT_TUTAR,0)\r\n            from @TB_ALS_SAT_BASLIK as t\r\n           join (select \r\n           sum(ALS_MIKTAR) as ALS_MIKTAR,\r\n           sum(SAT_MIKTAR) as SAT_MIKTAR,\r\n           sum(ALS_TUTAR) as ALS_TUTAR,\r\n           sum(SAT_TUTAR) as SAT_TUTAR \r\n         from @TB_ALS_SAT_BASLIK where PARENTID=@grp1id ) dt \r\n         on t.ID=@grp1id             \r\n                 \r\n \r\n  return\r\n\r\n END"
  },
  {
    "schema": "dbo",
    "name": "UDF_ALS_SAT_KONSOLIDE_TRS",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_ALS_SAT_KONSOLIDE_TRS",
    "definition": "CREATE FUNCTION [dbo].[UDF_ALS_SAT_KONSOLIDE_TRS]\r\n(@FIRMA_NO          INT,\r\n@id  \t\t\t\tINT,\r\n@BAS_TAR\t\t   DATETIME,\r\n@BIT_TAR\t\t   DATETIME)\r\nRETURNS\r\n @TB_ALS_SAT_BASLIK TABLE (\r\n    ID\t\t\t\t\t INT,\r\n    PARENTID\t\t\t INT,\t\r\n    GRPNO\t\t\t\t INT,\r\n    TIP\t\t\t \t\t VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    ACK         \t\t VARCHAR(100) COLLATE Turkish_CI_AS,\r\n    ALS_MIKTAR      \t FLOAT,\r\n    SAT_MIKTAR      \t FLOAT,\r\n    ALS_TUTAR   \t     FLOAT,\r\n    SAT_TUTAR        \t FLOAT)\r\n AS\r\n BEGIN   \r\n \r\n   DECLARE @TB_ALS_SAT TABLE (\r\n    FIRMA_NO\t\t\t INT,\r\n    FIRMA_AD         VARCHAR(100) COLLATE Turkish_CI_AS,\r\n    TIP\t\t\t\t VARCHAR(50) COLLATE Turkish_CI_AS,\t\t\t\t \r\n    ACK       \t\t VARCHAR(100) COLLATE Turkish_CI_AS,\r\n    GC\t\t\t   \t INT,\r\n    MIKTAR   \t \t FLOAT,\r\n    TUTAR   \t \t FLOAT)\r\n \r\n    \r\n  \r\n   insert into @TB_ALS_SAT (FIRMA_NO,TIP,ACK,GC,MIKTAR,TUTAR)\r\n   SELECT d.gfirmano,h.stktip,h.stkod,2,\r\n   (d.miktar),\r\n   ((h.brmfiy+h.otvbrim)-(h.satisktut+h.genisktut))\r\n   *(1+h.kdvyuz)*(miktar)\r\n   FROM faturamas as m \r\n   inner join faturahrklistesi as h on m.fatid=h.fatid\r\n   and m.sil=0 and h.sil=0\r\n   inner join Fat_Dep as d on d.FatHrk_id=h.id\r\n    where m.firmano=@FIRMA_NO and M.fattip='FATAKALS' and \r\n    m.tarih>=@BAS_TAR and m.tarih<=@BIT_TAR and d.miktar>0\r\n    and h.stktip in ('akykt')\r\n    \r\n    \r\n       \r\n      update @TB_ALS_SAT set ACK=dt.grp1 from @TB_ALS_SAT as t join\r\n      (select tip,kod,grp1 from stokkart where tip='akykt') dt \r\n      on t.TIP=dt.tip and t.ACK=dt.kod\r\n      \r\n      update @TB_ALS_SAT set ACK=dt.ad from @TB_ALS_SAT as t join\r\n      (select id,ad from grup ) dt \r\n      on t.ACK=dt.id\r\n      \r\n      update @TB_ALS_SAT set FIRMA_AD=dt.ad from @TB_ALS_SAT as t join\r\n      (select id,ad from firma ) dt \r\n      on t.FIRMA_NO=dt.id \r\n  \r\n\r\n\r\n  declare @grp1id int\r\n  declare @grp2id int\r\n\r\n  declare @KOD      varchar(100)\r\n  declare @TIP      varchar(30)\r\n  declare @GRP_AD   varchar(100)\r\n  declare @GRP_ID  \tfloat\r\n\r\n  \r\n  declare @ALS_MIKTAR  \tfloat\r\n  declare @SAT_MIKTAR  \tfloat\r\n  declare @ALS_TUTAR  \tfloat\r\n  declare @SAT_TUTAR  \tfloat\r\n  \r\n  \r\n  set @grp1id=@id\r\n    \r\n  insert into @TB_ALS_SAT_BASLIK (ID,PARENTID,ACK,ALS_MIKTAR,SAT_MIKTAR,\r\n  ALS_TUTAR,SAT_TUTAR)\r\n  VALUES (@grp1id,0,'TRANSFER TOPLAMLAR',0,0,0,0)\r\n  \r\n   declare mas_cur CURSOR FAST_FORWARD  FOR \r\n    select FIRMA_NO,FIRMA_AD from @TB_ALS_SAT GROUP BY FIRMA_NO,FIRMA_AD\r\n      open mas_cur\r\n       fetch next from  mas_cur into @GRP_ID,@GRP_AD\r\n        while @@FETCH_STATUS=0\r\n         begin\r\n           set @id=@id+1 \r\n           set @grp2id=@id\r\n     \r\n            insert into @TB_ALS_SAT_BASLIK (ID,PARENTID,ACK,\r\n            ALS_MIKTAR,SAT_MIKTAR,ALS_TUTAR,SAT_TUTAR)\r\n            VALUES (@id,@grp1id,@GRP_AD,0,0,0,0)\r\n   \r\n             set @id=@id+1 \r\n             \r\n             \r\n             \r\n             declare gec_cur CURSOR FAST_FORWARD  FOR \r\n              select TIP,ACK,\r\n              SUM(CASE WHEN GC=1 THEN MIKTAR ELSE 0 END),\r\n              SUM(CASE WHEN GC=2 THEN MIKTAR ELSE 0 END),\r\n              SUM(CASE WHEN GC=1 THEN TUTAR ELSE 0 END),\r\n              SUM(CASE WHEN GC=2 THEN TUTAR ELSE 0 END)\r\n              FROM @TB_ALS_SAT \r\n              WHERE FIRMA_NO=@GRP_ID\r\n              GROUP BY TIP,ACK \r\n               open gec_cur\r\n                fetch next from  gec_cur into @TIP,@KOD,\r\n                @ALS_MIKTAR,@SAT_MIKTAR,@ALS_TUTAR,@SAT_TUTAR\r\n                 while @@FETCH_STATUS=0\r\n                  begin\r\n                  \r\n               \r\n                 insert into @TB_ALS_SAT_BASLIK (ID,PARENTID,\r\n                 TIP,ACK,ALS_MIKTAR,SAT_MIKTAR,ALS_TUTAR,SAT_TUTAR)\r\n                 VALUES (@id,@grp2id,@TIP,@KOD,@ALS_MIKTAR,@SAT_MIKTAR,\r\n                 @ALS_TUTAR,@SAT_TUTAR)\r\n\r\n                set @id=@id+1  \r\n\r\n             FETCH next from  gec_cur into @TIP,@KOD,@ALS_MIKTAR,@SAT_MIKTAR,\r\n                @ALS_TUTAR,@SAT_TUTAR\r\n           end\r\n         close gec_cur\r\n         deallocate gec_cur\r\n         \r\n         \r\n         \r\n          update @TB_ALS_SAT_BASLIK set \r\n           ALS_MIKTAR=isnull(dt.ALS_MIKTAR,0),\r\n           SAT_MIKTAR=isnull(dt.SAT_MIKTAR,0),\r\n           ALS_TUTAR=isnull(dt.ALS_TUTAR,0),\r\n           SAT_TUTAR=isnull(dt.SAT_TUTAR,0)\r\n            from @TB_ALS_SAT_BASLIK as t\r\n           join (select \r\n           sum(ALS_MIKTAR) as ALS_MIKTAR,\r\n           sum(SAT_MIKTAR) as SAT_MIKTAR,\r\n           sum(ALS_TUTAR) as ALS_TUTAR,\r\n           sum(SAT_TUTAR) as SAT_TUTAR          \r\n           from @TB_ALS_SAT_BASLIK where PARENTID=@grp2id ) dt \r\n           on t.ID=@grp2id     \r\n                   \r\n                   \r\n          FETCH next from  mas_cur into @GRP_ID,@GRP_AD\r\n         end\r\n        Close mas_cur\r\n        deallocate mas_cur      \r\n         \r\n         \r\n         \r\n         update @TB_ALS_SAT_BASLIK set \r\n          ALS_MIKTAR=isnull(dt.ALS_MIKTAR,0),\r\n           SAT_MIKTAR=isnull(dt.SAT_MIKTAR,0),\r\n           ALS_TUTAR=isnull(dt.ALS_TUTAR,0),\r\n           SAT_TUTAR=isnull(dt.SAT_TUTAR,0)\r\n            from @TB_ALS_SAT_BASLIK as t\r\n           join (select \r\n           sum(ALS_MIKTAR) as ALS_MIKTAR,\r\n           sum(SAT_MIKTAR) as SAT_MIKTAR,\r\n           sum(ALS_TUTAR) as ALS_TUTAR,\r\n           sum(SAT_TUTAR) as SAT_TUTAR \r\n         from @TB_ALS_SAT_BASLIK where PARENTID=@grp1id ) dt \r\n         on t.ID=@grp1id             \r\n                 \r\n \r\n  return\r\n\r\n END"
  },
  {
    "schema": "dbo",
    "name": "UDF_BANKA_AYLIK",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_BANKA_AYLIK",
    "definition": "CREATE FUNCTION UDF_BANKA_AYLIK (@CARI_TIP VARCHAR(20),\r\n@CARI_KOD VARCHAR(20),\r\n@TARIH1 DATETIME, @TARIH2 DATETIME)\r\nRETURNS\r\n  @TB_CARI_EKSTRE TABLE (\r\n    CARI_TIP    VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    CARI_KOD    VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    CARI_UNVAN  VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    AY           INT,\r\n    AYISIM       VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    CARIBORC         FLOAT,\r\n    CARIALACAK        FLOAT,\r\n    CARIBAKIYE        FLOAT,\r\n    BAKIYE     FLOAT )\r\nAS\r\nBEGIN\r\n  DECLARE @EKSTRE_TEMP TABLE (\r\n    CARI_TIP    VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    CARI_KOD    VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    CARI_UNVAN  VARCHAR(50) COLLATE Turkish_CI_AS,\r\n     AY           INT,\r\n     AYISIM       VARCHAR(20) COLLATE Turkish_CI_AS,\r\n     CARIBORC         FLOAT,\r\n     CARIALACAK        FLOAT,\r\n     CARIBAKIYE        FLOAT,\r\n     BAKIYE     FLOAT )\r\n\r\n  DECLARE @HRK_CARI_TIP    VARCHAR(20)\r\n  DECLARE @HRK_CARI_CARTIP VARCHAR(20)\r\n  DECLARE @HRK_CARI_KOD    VARCHAR(20)\r\n  DECLARE @HRK_CARI_UNVAN  VARCHAR(50)\r\n  DECLARE @HRK_AY           INT\r\n  DECLARE @HRK_AYISIM       VARCHAR(20)\r\n  DECLARE @HRK_BORC          FLOAT\r\n  DECLARE @HRK_ALACAK        FLOAT\r\n  DECLARE @HRK_CARIBAKIYE        FLOAT\r\n  DECLARE @HRK_GENELTOP      FLOAT\r\n  \r\n     DECLARE CRS_HRK CURSOR FAST_FORWARD FOR\r\n      SELECT\r\n      'Bank Kartları','bankakart',h.bankod,(vc.ad),MONTH(h.tarih),\r\n      isnull(sum(h.borc),0),\r\n      isnull(sum(h.alacak),0)\r\n      FROM bankahrk as h with (nolock) inner join bankakart as vc with (nolock)\r\n      on vc.kod=h.bankod\r\n      where  h.sil=0 AND (h.tarih+cast(h.saat as datetime)) >= @TARIH1 \r\n      and (h.tarih+cast(h.saat as datetime)) <= @TARIH2\r\n      group by h.bankod,vc.ad,MONTH(h.tarih)\r\n      order by MONTH(h.tarih)\r\n\r\n\r\n  OPEN CRS_HRK\r\n\r\n  FETCH NEXT FROM CRS_HRK INTO\r\n   @HRK_CARI_TIP,@HRK_CARI_CARTIP,@HRK_CARI_KOD,@HRK_CARI_UNVAN,@HRK_AY,@HRK_BORC,@HRK_ALACAK\r\n\r\n  WHILE @@FETCH_STATUS = 0\r\n  BEGIN\r\n\r\n    SET @HRK_GENELTOP=@HRK_BORC-@HRK_ALACAK\r\n    SET @HRK_CARIBAKIYE=@HRK_BORC-@HRK_ALACAK;\r\n    \r\n    \r\n    \r\n    \r\n        set @HRK_AYISIM=\r\n        (select\r\n          CASE @HRK_AY\r\n           WHEN 1 THEN 'OCAK'\r\n           WHEN 2 THEN 'ŞUBAT'\r\n           WHEN 3 THEN 'MART'\r\n           WHEN 4 THEN 'NİSAN'\r\n           WHEN 5 THEN 'MAYIS'\r\n           WHEN 6 THEN 'HAZİRAN'\r\n           WHEN 7 THEN 'TEMMUZ'\r\n           WHEN 8 THEN 'AĞUSTOS'\r\n           WHEN 9 THEN 'EYLÜL'\r\n           WHEN 10 THEN 'EKİM'\r\n           WHEN 11 THEN 'KASIM'\r\n           WHEN 12 THEN 'ARALIK'\r\n          END)\r\n    \r\n    \r\n\r\n    INSERT @EKSTRE_TEMP\r\n      SELECT\r\n       @HRK_CARI_TIP,@HRK_CARI_KOD,@HRK_CARI_UNVAN,@HRK_AY,@HRK_AYISIM,@HRK_BORC,@HRK_ALACAK,\r\n       @HRK_CARIBAKIYE,@HRK_GENELTOP\r\n       \r\n    FETCH NEXT FROM CRS_HRK INTO\r\n    @HRK_CARI_TIP,@HRK_CARI_CARTIP,@HRK_CARI_KOD,@HRK_CARI_UNVAN,@HRK_AY,@HRK_BORC,@HRK_ALACAK\r\n  END\r\n\r\n  CLOSE CRS_HRK\r\n  DEALLOCATE CRS_HRK\r\n\r\n  /*---------------------------------------------------------------------------- */\r\n\r\n  INSERT @TB_CARI_EKSTRE\r\n    SELECT * FROM @EKSTRE_TEMP ORDER BY AY\r\n\r\n  RETURN\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_BANKA_BAKIYE",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_BANKA_BAKIYE",
    "definition": "CREATE FUNCTION UDF_BANKA_BAKIYE (@CARI_TIP VARCHAR(20),\r\n@CARI_KODIN VARCHAR(8000),\r\n@TARIH1 DATETIME, \r\n@TARIH2 DATETIME)\r\nRETURNS\r\n  @TB_CARI_EKSTRE TABLE (\r\n    CARI_TIP    VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    CARI_KOD    VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    CARI_UNVAN  VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    BORC         FLOAT,\r\n    ALACAK       FLOAT,\r\n    GENELTOPLAM  FLOAT )\r\nAS\r\nBEGIN\r\n\r\nDECLARE @EKSTRE_CARITEMP TABLE (\r\n carkod     varchar(30)  COLLATE Turkish_CI_AS )\r\n\r\ndeclare @separator char(1)\r\n set @separator = ','\r\n\r\n declare @separator_position int\r\n declare @array_value varchar(1000)\r\n\r\n IF (LEN(RTRIM(@CARI_KODIN)) > 0)\r\n BEGIN\r\n  set @CARI_KODIN = @CARI_KODIN + ','\r\n END\r\n\r\n while patindex('%,%' , @CARI_KODIN) <> 0\r\n begin\r\n\r\n   select @separator_position =  patindex('%,%' , @CARI_KODIN)\r\n   select @array_value = left(@CARI_KODIN, @separator_position - 1)\r\n\r\n  Insert @EKSTRE_CARITEMP\r\n  Values (@array_value)\r\n\r\n   select @CARI_KODIN = stuff(@CARI_KODIN, 1, @separator_position, '')\r\n end\r\n\r\n\r\n\r\n\r\n  DECLARE @EKSTRE_TEMP TABLE (\r\n    CARI_TIP    VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    CARI_KOD    VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    CARI_UNVAN  VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    BORC           FLOAT,\r\n    ALACAK         FLOAT,\r\n    GENELTOPLAM    FLOAT )\r\n\r\n  DECLARE @HRK_CARI_TIP    VARCHAR(20)\r\n  DECLARE @HRK_CARI_KOD    VARCHAR(20)\r\n  DECLARE @HRK_CARI_UNVAN  VARCHAR(50)\r\n  DECLARE @HRK_BORC         FLOAT\r\n  DECLARE @HRK_ALACAK         FLOAT\r\n  DECLARE @HRK_GENELTOP        FLOAT\r\n\r\n\r\n      DECLARE CRS_HRK CURSOR FAST_FORWARD FOR\r\n      SELECT\r\n      'Bank Kartları',h.bankod,(vc.ad),\r\n      isnull(sum(h.borc),0),\r\n      isnull(sum(h.alacak),0)\r\n      FROM bankahrk as h with (nolock) inner join bankakart as vc with (nolock)\r\n      on vc.kod=h.bankod\r\n      where h.sil=0 AND (h.tarih+cast(h.saat as datetime)) >= @TARIH1 \r\n      and (h.tarih+cast(h.saat as datetime)) <= @TARIH2\r\n      and vc.kod in (select * from @EKSTRE_CARITEMP)\r\n      group by h.bankod,vc.ad\r\n\r\n\r\n  OPEN CRS_HRK\r\n\r\n  FETCH NEXT FROM CRS_HRK INTO\r\n   @HRK_CARI_TIP,@HRK_CARI_KOD,@HRK_CARI_UNVAN,@HRK_BORC,@HRK_ALACAK\r\n\r\n  WHILE @@FETCH_STATUS = 0\r\n  BEGIN\r\n    SET @HRK_GENELTOP=@HRK_BORC-@HRK_ALACAK\r\n\r\n    INSERT @EKSTRE_TEMP\r\n      SELECT\r\n       @HRK_CARI_TIP,@HRK_CARI_KOD,@HRK_CARI_UNVAN,@HRK_BORC,@HRK_ALACAK,@HRK_GENELTOP\r\n       \r\n    FETCH NEXT FROM CRS_HRK INTO\r\n    @HRK_CARI_TIP,@HRK_CARI_KOD,@HRK_CARI_UNVAN,@HRK_BORC,@HRK_ALACAK\r\n  END\r\n\r\n  CLOSE CRS_HRK\r\n  DEALLOCATE CRS_HRK\r\n\r\n  /*---------------------------------------------------------------------------- */\r\n\r\n  INSERT @TB_CARI_EKSTRE\r\n    SELECT * FROM @EKSTRE_TEMP\r\n\r\n  RETURN\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_BANKA_HRK",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_BANKA_HRK",
    "definition": "CREATE FUNCTION [dbo].UDF_BANKA_HRK\r\n(@firmano\t\tint,\r\n@HRK_KRITER     VARCHAR(4000),\r\n@BANK_KOD \t\tVARCHAR(20),\r\n@TARIH1 \t\tDATETIME,\r\n@TARIH2 \t\tDATETIME,\r\n@SAAT1 \t\t\tVARCHAR(8),\r\n@SAAT2 \t\t\tVARCHAR(8),\r\n@ORDER \t\t\tVARCHAR(20),\r\n@DEVIR \t\t\tINT)\r\nRETURNS\r\n  @TB_BANK_EKSTRE TABLE (\r\n    Firmano     int,\r\n    Firma_Ad    VARCHAR(150) COLLATE Turkish_CI_AS,\r\n    CARI_KOD    VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    CARI_UNVAN  VARCHAR(150) COLLATE Turkish_CI_AS,\r\n    TARIH       DATETIME,\r\n    SAAT        VARCHAR(8)  COLLATE Turkish_CI_AS,\r\n    BELGENO     VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    ACIKLAMA    VARCHAR(200) COLLATE Turkish_CI_AS,\r\n    ISLTIPAD    VARCHAR(50)  COLLATE Turkish_CI_AS,\r\n    ISLHRKAD    VARCHAR(50)  COLLATE Turkish_CI_AS,\r\n    YERAD       VARCHAR(50)  COLLATE Turkish_CI_AS,\r\n    YERTIP      VARCHAR(30)  COLLATE Turkish_CI_AS,\r\n    KULAD       VARCHAR(70)  COLLATE Turkish_CI_AS,\r\n    ISLTIP      VARCHAR(30)  COLLATE Turkish_CI_AS,\r\n    ISLHRK      VARCHAR(30)  COLLATE Turkish_CI_AS,\r\n    KRS_TIP     VARCHAR(30)  COLLATE Turkish_CI_AS,\r\n    KRS_KOD     VARCHAR(50)  COLLATE Turkish_CI_AS,\r\n    KRS_UNVAN   VARCHAR(150)  COLLATE Turkish_CI_AS,\r\n    VADETAR     DATETIME,\r\n    VARNO       FLOAT,\r\n    VAROK\t\tINT,\r\n    RAPID\t\tINT,\r\n    HRKID       FLOAT,\r\n    MASID       FLOAT,\r\n    BORC        DECIMAL(18,8),\r\n    ALACAK      DECIMAL(18,8),\r\n    BAKIYE      DECIMAL(18,8),\r\n    FAT_ID      INT,\r\n    FIS_ID      INT,\r\n    IRS_ID      INT,\r\n    MARSAT_ID\tINT,\r\n    SAYIM_ID    INT,\r\n    REMOTE_ID\tINT,\r\n    KASAHRK_ID  INT,\r\n    POSHRK_ID   INT,\r\n    BANKAHRK_ID INT,\r\n    CEK_ID\t\tINT,\r\n    ISTHRK_ID   INT)\r\nAS\r\nBEGIN\r\n  \r\n  DECLARE @HRK_BANK_KOD    VARCHAR(30)\r\n  DECLARE @HRK_BANK_UNVAN  VARCHAR(150)\r\n \r\n  DECLARE @KUM_BAKIYE      DECIMAL(18,8)\r\n  \r\n  DECLARE @ONDA_HANE       INT\r\n\r\n  SET @KUM_BAKIYE = 0\r\n  \r\n  \r\n  select @ONDA_HANE=Para_Ondalik from sistemtanim\r\n\r\n  select @HRK_BANK_UNVAN=AD from bankakart \r\n    where kod=@BANK_KOD\r\n\r\n  /* Devir atanıyor */\r\n  IF @DEVIR=1\r\n   BEGIN\r\n      IF @ORDER='tarih'\r\n      begin\r\n      \r\n      if @firmano=0\r\n      INSERT @TB_BANK_EKSTRE\r\n        SELECT @firmano,'',\r\n          @BANK_KOD, /* BANK_KOD */\r\n          @HRK_BANK_UNVAN, /* BANK_UNVAN */\r\n          max(tarih),\r\n          @SAAT1,\r\n          'DEVİR', /* BELGE NO */\r\n          CONVERT(VARCHAR(10), max(tarih), 104) +' DEVİR BAKİYESİ', /* AÇIKLAMA */\r\n          '-','-','-','-','-','-','-',\r\n          '-','-','-',\r\n          max(vadetar),0,0,0,0,0,\r\n          ISNULL(SUM(round(borc,@ONDA_HANE)),0), /* BORC */\r\n          ISNULL(SUM(round(alacak,@ONDA_HANE)),0), /* ALACAK */\r\n          ISNULL(SUM( round((borc-alacak),@ONDA_HANE)),0), /* BAKIYE */\r\n          0,0,0,\r\n          0,0,0,\r\n          0,0,0,\r\n          0,0\r\n        FROM bankahrk\r\n        WHERE bankod=@BANK_KOD and sil=0\r\n         AND tarih < @TARIH1\r\n        \r\n         if @firmano>0\r\n          INSERT @TB_BANK_EKSTRE\r\n           SELECT\r\n           @firmano,'',\r\n          @BANK_KOD, /* BANK_KOD */\r\n          @HRK_BANK_UNVAN, /* BANK_UNVAN */\r\n          max(tarih),\r\n          @SAAT1,\r\n          'DEVİR', /* BELGE NO */\r\n          CONVERT(VARCHAR(10), max(tarih), 104) +' DEVİR BAKİYESİ', /* AÇIKLAMA */\r\n          '-','-','-','-','-','-','-',\r\n          '-','-','-',\r\n          max(vadetar),0,0,0,0,0,\r\n          ISNULL(SUM(round(borc,@ONDA_HANE)),0), /* BORC */\r\n          ISNULL(SUM(round(alacak,@ONDA_HANE)),0), /* ALACAK */\r\n          ISNULL(SUM( round((borc-alacak),@ONDA_HANE)),0), /* BAKIYE */\r\n          0,0,0,\r\n          0,0,0,\r\n          0,0,0,\r\n          0,0\r\n        FROM bankahrk\r\n        WHERE (firmano=@firmano or firmano=0 ) and bankod=@BANK_KOD and sil=0\r\n         AND tarih < @TARIH1\r\n        \r\n    end\r\n\r\n      IF @ORDER='vadetar'\r\n      begin\r\n      \r\n      if @firmano=0\r\n      INSERT @TB_BANK_EKSTRE\r\n        SELECT\r\n          @firmano,'',\r\n          @BANK_KOD, /* BANK_KOD */\r\n          @HRK_BANK_UNVAN, /* BANK_UNVAN */\r\n          max(tarih),\r\n          @SAAT1,\r\n          'DEVİR', /* BELGE NO */\r\n          CONVERT(VARCHAR(10), max(tarih), 104) +' DEVİR BAKİYESİ', /* AÇIKLAMA */\r\n          '-','-','-','-','-','-','-',\r\n          '-','-','-',\r\n          max(vadetar),0,0,0,0,0,\r\n          ISNULL(SUM(round(borc,@ONDA_HANE)),0), /* BORC */\r\n          ISNULL(SUM(round(alacak,@ONDA_HANE)),0), /* ALACAK */\r\n          ISNULL(SUM( round((borc-alacak),@ONDA_HANE)),0), /* BAKIYE */\r\n          0,0,0,\r\n          0,0,0,\r\n          0,0,0,\r\n          0,0\r\n        FROM bankahrk\r\n        WHERE bankod=@BANK_KOD and sil=0\r\n         AND vadetar < @TARIH1\r\n         \r\n         \r\n         \r\n        if @firmano>0\r\n        INSERT @TB_BANK_EKSTRE\r\n         SELECT\r\n           @firmano,'',\r\n          @BANK_KOD, /* BANK_KOD */\r\n          @HRK_BANK_UNVAN, /* BANK_UNVAN */\r\n          max(tarih),\r\n          @SAAT1,\r\n          'DEVİR', /* BELGE NO */\r\n          CONVERT(VARCHAR(10), max(tarih), 104) +' DEVİR BAKİYESİ', /* AÇIKLAMA */\r\n          '-','-','-','-','-','-','-',\r\n          '-','-','-',\r\n          max(vadetar),0,0,0,0,0,\r\n          ISNULL(SUM(round(borc,@ONDA_HANE)),0), /* BORC */\r\n          ISNULL(SUM(round(alacak,@ONDA_HANE)),0), /* ALACAK */\r\n          ISNULL(SUM( round((borc-alacak),@ONDA_HANE)),0), /* BAKIYE */\r\n          0,0,0,\r\n          0,0,0,\r\n          0,0,0,\r\n          0,0\r\n        FROM bankahrk\r\n        WHERE  (firmano=@firmano or firmano=0 ) and bankod=@BANK_KOD and sil=0\r\n         AND vadetar < @TARIH1  \r\n       end\r\n\r\n     SELECT @KUM_BAKIYE = isnull(BAKIYE,0) FROM @TB_BANK_EKSTRE\r\n     if @KUM_BAKIYE=0\r\n      delete from @TB_BANK_EKSTRE\r\n   END\r\n\r\n\r\n\r\n  IF @ORDER='tarih'\r\n  begin\r\n  if @firmano=0\r\n   INSERT @TB_BANK_EKSTRE\r\n    SELECT\r\n       isnull(firmano,0),'',\r\n       @BANK_KOD,@HRK_BANK_UNVAN,\r\n       tarih,saat,belno,\r\n      ack, /* AÇIKLAMA, */\r\n      islmtipad,islmhrkad,yerad,yertip,olususer,islmtip,islmhrk,\r\n      Karsi_KartTip,Karsi_KartKod,'',\r\n      vadetar,\r\n      varno,varok,belrap_id,bankhrkid,masterid,\r\n      round(borc,@ONDA_HANE),\r\n      round(alacak,@ONDA_HANE),\r\n      round((borc-alacak),@ONDA_HANE) AS BAKIYE,\r\n      0,0,0,\r\n      0,0,0,\r\n      0,0,0,\r\n      0,0\r\n    FROM bankahrk\r\n    WHERE bankod=@BANK_KOD and  sil=0\r\n    and islmtip+'_'+islmhrk not in \r\n     (select * FROM CsvToSTR(@HRK_KRITER))\r\n     AND tarih >= @TARIH1 AND tarih <= @TARIH2\r\n     ORDER BY tarih,saat\r\n     \r\n    if @firmano>0\r\n   INSERT @TB_BANK_EKSTRE\r\n    SELECT\r\n       isnull(firmano,0),'',\r\n       @BANK_KOD,@HRK_BANK_UNVAN,\r\n       tarih,saat,belno,\r\n      ack, /* AÇIKLAMA, */\r\n      islmtipad,islmhrkad,yerad,yertip,olususer,islmtip,islmhrk,\r\n      Karsi_KartTip,Karsi_KartKod,'',vadetar,\r\n      varno,varok,belrap_id,bankhrkid,masterid,\r\n      round(borc,@ONDA_HANE),\r\n      round(alacak,@ONDA_HANE),\r\n      round((borc-alacak),@ONDA_HANE) AS BAKIYE,\r\n      0,0,0,\r\n      0,0,0,\r\n      0,0,0,\r\n      0,0\r\n    FROM bankahrk\r\n    WHERE  (firmano=@firmano or firmano=0 ) and bankod=@BANK_KOD and  sil=0\r\n    and islmtip+'_'+islmhrk not in \r\n     (select * FROM CsvToSTR(@HRK_KRITER))\r\n     AND tarih >= @TARIH1 AND tarih <= @TARIH2\r\n     ORDER BY tarih,saat \r\n     \r\n     \r\n     \r\n     \r\n   end\r\n   \r\n   IF @ORDER='vadetar'\r\n  begin\r\n   if @firmano=0\r\n   INSERT @TB_BANK_EKSTRE\r\n    SELECT\r\n       isnull(firmano,0),'',\r\n       @BANK_KOD,@HRK_BANK_UNVAN,\r\n       tarih,saat,belno,\r\n      ack, /* AÇIKLAMA, */\r\n      islmtipad,islmhrkad,yerad,yertip,olususer,islmtip,islmhrk,\r\n      Karsi_KartTip,Karsi_KartKod,'',vadetar,\r\n      varno,varok,belrap_id,bankhrkid,masterid,\r\n      round(borc,@ONDA_HANE),\r\n      round(alacak,@ONDA_HANE),\r\n      round((borc-alacak),@ONDA_HANE) AS BAKIYE,\r\n      0,0,0,\r\n      0,0,0,\r\n      0,0,0,\r\n      0,0\r\n    FROM bankahrk\r\n    WHERE bankod=@BANK_KOD and  sil=0\r\n    and islmtip+'_'+islmhrk not in \r\n     (select * FROM CsvToSTR(@HRK_KRITER))\r\n     and vadetar >= @TARIH1 AND vadetar <= @TARIH2\r\n     ORDER BY vadetar,saat\r\n     \r\n     if @firmano>0\r\n     INSERT @TB_BANK_EKSTRE\r\n      SELECT\r\n       isnull(firmano,0),'',\r\n       @BANK_KOD,@HRK_BANK_UNVAN,\r\n       tarih,saat,belno,\r\n       ack, /* AÇIKLAMA, */\r\n       islmtipad,islmhrkad,yerad,yertip,olususer,islmtip,islmhrk,\r\n       Karsi_KartTip,Karsi_KartKod,'',vadetar,\r\n       varno,varok,belrap_id,bankhrkid,masterid,\r\n       round(borc,@ONDA_HANE),\r\n       round(alacak,@ONDA_HANE),\r\n       round((borc-alacak),@ONDA_HANE) AS BAKIYE,\r\n      0,0,0,\r\n      0,0,0,\r\n      0,0,0,\r\n      0,0\r\n    FROM bankahrk\r\n    WHERE  (firmano=@firmano or firmano=0 ) and bankod=@BANK_KOD and  sil=0\r\n    and islmtip+'_'+islmhrk not in \r\n     (select * FROM CsvToSTR(@HRK_KRITER))\r\n     and vadetar >= @TARIH1 AND vadetar <= @TARIH2\r\n     ORDER BY vadetar,saat \r\n     \r\n     \r\n   end\r\n   \r\n  \r\n   \r\n  update @TB_BANK_EKSTRE set KRS_UNVAN=dt.AD\r\n   FROM @TB_BANK_EKSTRE AS T join\r\n   (select cartp,kod,ad from genel_kart) dt\r\n   on dt.cartp=t.KRS_TIP and dt.kod=t.KRS_KOD\r\n   \r\n    \r\n   update @TB_BANK_EKSTRE set KRS_KOD='-',KRS_UNVAN='-'\r\n   WHERE (KRS_KOD is null) \r\n   \r\n  \r\n  RETURN\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_BANKA_ISLEM_HRK",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_BANKA_ISLEM_HRK",
    "definition": "CREATE FUNCTION [dbo].UDF_BANKA_ISLEM_HRK (\r\n@firmano\t\t\tint,\r\n@BANK_KOD \t\t\tVARCHAR(50),\r\n@TARIH1 \t\t\tDATETIME,\r\n@TARIH2\t\t\t\tDATETIME,\r\n@SILIN \t\t\t\tVARCHAR(20),\r\n@DEVIR \t\t\t\tINT)\r\nRETURNS\r\n   @TB_BANK_EKSTRE TABLE (\r\n    id          int     IDENTITY(1, 1) NOT NULL,\r\n    Firmano     int,\r\n    Firma_ad    VARCHAR(150) COLLATE Turkish_CI_AS,\r\n    BANKA_KOD   VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    BANKA_AD    VARCHAR(150) COLLATE Turkish_CI_AS,\r\n    CARI_KOD    VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    CARI_TIP    VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    CARI_UNVAN  VARCHAR(150) COLLATE Turkish_CI_AS,\r\n    TARIH       DATETIME,\r\n    SAAT        VARCHAR(8)  COLLATE Turkish_CI_AS,\r\n    BELGENO     VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    ACIKLAMA    VARCHAR(200) COLLATE Turkish_CI_AS,\r\n    ISLTIP      VARCHAR(50)  COLLATE Turkish_CI_AS,\r\n    ISLTIPAD    VARCHAR(50)  COLLATE Turkish_CI_AS,\r\n    ISLHRK      VARCHAR(30)  COLLATE Turkish_CI_AS,\r\n    ISLHRKAD    VARCHAR(50)  COLLATE Turkish_CI_AS,\r\n    YERAD       VARCHAR(50)  COLLATE Turkish_CI_AS,\r\n    YERTIP      VARCHAR(30)  COLLATE Turkish_CI_AS,\r\n    KULAD       VARCHAR(70)  COLLATE Turkish_CI_AS,\r\n    KULTAR      DATETIME,\r\n    DVZ         VARCHAR(30)  COLLATE Turkish_CI_AS,\r\n    VARNO       INT,\r\n    VAROK       INT,\r\n    SIL         INT,\r\n    HRKID       FLOAT,\r\n    MASID       FLOAT,\r\n    BORC        DECIMAL(18,8),\r\n    ALACAK      DECIMAL(18,8),\r\n    BAKIYE      DECIMAL(18,8),\r\n    REMOTE_ID   FLOAT,\r\n    DEVIR       BIT,\r\n    entegre_aktar    DATETIME)\r\nAS\r\nBEGIN\r\n \r\n\r\n DECLARE @SIL_TEMP TABLE (\r\n sil      int)\r\n\r\n declare @separator char(1)\r\n  set @separator = ','\r\n\r\n declare @separator_position int\r\n declare @array_value varchar(1000)\r\n\r\n IF (LEN(RTRIM(@SILIN)) > 0)\r\n BEGIN\r\n  set @SILIN = @SILIN + ','\r\n END\r\n\r\n while patindex('%,%' , @SILIN) <> 0\r\n begin\r\n\r\n   select @separator_position =  patindex('%,%' , @SILIN)\r\n   select @array_value = left(@SILIN, @separator_position - 1)\r\n\r\n  Insert @SIL_TEMP\r\n  Values (@array_value)\r\n\r\n   select @SILIN = stuff(@SILIN, 1, @separator_position, '')\r\n end\r\n\r\n \r\n  \r\n  /*DECLARE @ONCEBKOD        VARCHAR(30) */\r\n  \r\n  DECLARE @ONDA_HANE       INT\r\n  \r\n\r\n SELECT @ONDA_HANE=PARA_ondalik from sistemtanim\r\n\r\n\r\n  /*SET @KUM_BAKIYE = 0 */\r\n  \r\n  /*SET @ONCEBKOD='' */\r\n  \r\n  /*-devir */\r\n  \r\n    \r\n    IF @BANK_KOD=''\r\n    begin\r\n      \r\n    IF @DEVIR=1\r\n     begin \r\n      if @firmano=0\r\n       insert @TB_BANK_EKSTRE\r\n       (Firmano,Firma_Ad,BANKA_KOD,BANKA_AD,CARI_KOD,CARI_TIP,CARI_UNVAN,\r\n       TARIH,SAAT,BELGENO,ACIKLAMA,ISLTIP,ISLTIPAD,ISLHRK,ISLHRKAD,\r\n       YERAD,YERTIP,KULAD,KULTAR,DVZ,SIL,VARNO,VAROK,HRKID,MASID,\r\n       BORC,ALACAK,BAKIYE,REMOTE_ID,DEVIR)\r\n       SELECT\r\n       @firmano,'','','','','','',\r\n       DATEADD(day,-1,@TARIH1),'00:00:00','DEVIR','DEVIR',\r\n       'DEV','DEVIR','-','-',\r\n       '-','-','-',NULL,'-',\r\n       0,0,0,0,0,\r\n       isnull(sum(round(h.borc,@ONDA_HANE)),0),\r\n       isnull(sum(round(h.alacak,@ONDA_HANE)),0),\r\n       isnull(sum(round(h.borc-h.alacak,@ONDA_HANE)),0),\r\n       0,1\r\n       from bankahrk as h with (nolock)  where \r\n       /*h.bankod=@HRK_BANK_KOD and  */\r\n       h.sil=0 and tarih < @TARIH1\r\n       \r\n          \r\n      if @firmano>0             \r\n      insert @TB_BANK_EKSTRE\r\n       (Firmano,Firma_Ad,BANKA_KOD,BANKA_AD,CARI_KOD,CARI_TIP,CARI_UNVAN,\r\n       TARIH,SAAT,BELGENO,ACIKLAMA,ISLTIP,ISLTIPAD,ISLHRK,ISLHRKAD,\r\n       YERAD,YERTIP,KULAD,KULTAR,DVZ,SIL,VARNO,VAROK,HRKID,MASID,\r\n       BORC,ALACAK,BAKIYE,REMOTE_ID,DEVIR)\r\n       SELECT\r\n       @firmano,'','','','','','',\r\n       DATEADD(day,-1,@TARIH1),'00:00:00','DEVIR','DEVIR',\r\n       'DEV','DEVIR','-','-',\r\n       '-','-','-',NULL,'-',\r\n       0,0,0,0,0,\r\n       isnull(sum(round(h.borc,@ONDA_HANE)),0),\r\n       isnull(sum(round(h.alacak,@ONDA_HANE)),0),\r\n       isnull(sum(round(h.borc-h.alacak,@ONDA_HANE)),0),\r\n       0,1\r\n       from bankahrk as h with (nolock) where (h.firmano=@firmano or h.firmano=0)\r\n      /*and h.bankod=@HRK_BANK_KOD */\r\n      and h.sil=0 and tarih < @TARIH1\r\n    end \r\n    \r\n    \r\n    \r\n    IF @DEVIR=2\r\n     begin \r\n      if @firmano=0\r\n       insert @TB_BANK_EKSTRE\r\n       (Firmano,Firma_Ad,BANKA_KOD,BANKA_AD,CARI_KOD,CARI_TIP,CARI_UNVAN,\r\n       TARIH,SAAT,BELGENO,ACIKLAMA,ISLTIP,ISLTIPAD,ISLHRK,ISLHRKAD,\r\n       YERAD,YERTIP,KULAD,KULTAR,DVZ,SIL,VARNO,VAROK,HRKID,MASID,\r\n       BORC,ALACAK,BAKIYE,REMOTE_ID,DEVIR)\r\n       SELECT\r\n       @firmano,'',h.bankod,b.ad,'','','',\r\n       DATEADD(day,-1,@TARIH1),'00:00:00','DEVIR','DEVIR',\r\n       'DEV','DEVIR','-','-',\r\n       '-','-','-',NULL,'-',\r\n       0,0,0,0,0,\r\n       isnull(sum(round(h.borc,@ONDA_HANE)),0),\r\n       isnull(sum(round(h.alacak,@ONDA_HANE)),0),\r\n       isnull(sum(round(h.borc-h.alacak,@ONDA_HANE)),0),\r\n       0,1\r\n        from bankakart as b with (nolock) inner join bankahrk as h with (nolock)\r\n       on h.bankod=b.kod and b.sil=0 \r\n       where h.sil=0 and tarih < @TARIH1\r\n       group by h.bankod,b.ad\r\n       \r\n          \r\n      if @firmano>0             \r\n      insert @TB_BANK_EKSTRE\r\n       (Firmano,Firma_Ad,BANKA_KOD,BANKA_AD,CARI_KOD,CARI_TIP,CARI_UNVAN,\r\n       TARIH,SAAT,BELGENO,ACIKLAMA,ISLTIP,ISLTIPAD,ISLHRK,ISLHRKAD,\r\n       YERAD,YERTIP,KULAD,KULTAR,DVZ,SIL,VARNO,VAROK,HRKID,MASID,\r\n       BORC,ALACAK,BAKIYE,REMOTE_ID,DEVIR)\r\n       SELECT\r\n       @firmano,'',h.bankod,b.ad,'','','',\r\n       DATEADD(day,-1,@TARIH1),'00:00:00','DEVIR','DEVIR',\r\n       'DEV','DEVIR','-','-',\r\n       '-','-','-',NULL,'-',\r\n       0,0,0,0,0,\r\n       isnull(sum(round(h.borc,@ONDA_HANE)),0),\r\n       isnull(sum(round(h.alacak,@ONDA_HANE)),0),\r\n       isnull(sum(round(h.borc-h.alacak,@ONDA_HANE)),0),\r\n       0,1\r\n       from bankakart as b with (nolock) inner join bankahrk as h with (nolock)\r\n       on h.bankod=b.kod and b.sil=0\r\n       where (h.firmano=@firmano or h.firmano=0)\r\n      /*and h.bankod=@HRK_BANK_KOD */\r\n      and h.sil=0 and tarih < @TARIH1\r\n       group by h.bankod,b.ad\r\n    end \r\n    \r\n               \r\n     if @firmano=0\r\n        insert @TB_BANK_EKSTRE\r\n        (Firmano,Firma_Ad,BANKA_KOD,BANKA_AD,CARI_KOD,CARI_TIP,CARI_UNVAN,\r\n        TARIH,SAAT,BELGENO,ACIKLAMA,ISLTIP,ISLTIPAD,ISLHRK,ISLHRKAD,\r\n        YERAD,YERTIP,KULAD,KULTAR,DVZ,SIL,VARNO,VAROK,HRKID,MASID,\r\n        BORC,ALACAK,BAKIYE,REMOTE_ID,DEVIR,entegre_aktar)\r\n        SELECT  h.firmano,'',b.kod,b.ad,h.carkod,h.cartip,'',h.tarih,h.saat,\r\n        h.belno,h.ack,h.islmtip,h.islmtipad,h.islmhrk,\r\n        h.islmhrkad,h.yerad,h.yertip,\r\n        h.olususer,h.olustarsaat,h.parabrm,h.sil,h.varno,h.varok,\r\n        h.bankhrkid,h.masterid,\r\n        round(h.borc,@ONDA_HANE),\r\n        round(h.alacak,@ONDA_HANE),\r\n        round(h.borc-h.alacak,@ONDA_HANE),\r\n        h.remote_id,0,H.entegre_aktar\r\n        from bankakart as b with (nolock) inner join bankahrk as h with (nolock)\r\n        on h.bankod=b.kod and b.sil=0 and h.sil in (select * from @SIL_TEMP)\r\n        where tarih  >= @TARIH1\r\n        and tarih <= @TARIH2\r\n        ORDER BY b.kod,tarih,saat\r\n        \r\n        \r\n        if @firmano>0\r\n        insert @TB_BANK_EKSTRE\r\n        (Firmano,Firma_Ad,BANKA_KOD,BANKA_AD,CARI_KOD,CARI_TIP,CARI_UNVAN,\r\n        TARIH,SAAT,BELGENO,ACIKLAMA,ISLTIP,ISLTIPAD,ISLHRK,ISLHRKAD,\r\n        YERAD,YERTIP,KULAD,KULTAR,DVZ,SIL,VARNO,VAROK,HRKID,MASID,\r\n        BORC,ALACAK,BAKIYE,REMOTE_ID,DEVIR,entegre_aktar)\r\n        SELECT  h.firmano,'',b.kod,b.ad,h.carkod,h.cartip,'',h.tarih,h.saat,\r\n        h.belno,h.ack,h.islmtip,h.islmtipad,h.islmhrk,\r\n        h.islmhrkad,h.yerad,h.yertip,\r\n        h.olususer,h.olustarsaat,h.parabrm,h.sil,\r\n        h.varno,h.varok,h.bankhrkid,h.masterid,\r\n        round(h.borc,@ONDA_HANE),\r\n        round(h.alacak,@ONDA_HANE),\r\n        round(h.borc-h.alacak,@ONDA_HANE),\r\n        h.remote_id,0,h.entegre_aktar\r\n        from bankakart as b with (nolock) inner join bankahrk as h with (nolock)\r\n        on h.bankod=b.kod and b.sil=0 and h.sil in (select * from @SIL_TEMP)\r\n        where (h.firmano=@firmano or h.firmano=0) and tarih  >= @TARIH1\r\n        and tarih <= @TARIH2\r\n        ORDER BY b.kod,tarih,saat    \r\n        \r\n        \r\n    end\r\n\r\n    IF @BANK_KOD<>''\r\n     begin\r\n      \r\n      IF @DEVIR=1\r\n        begin \r\n       if @firmano=0\r\n       insert @TB_BANK_EKSTRE\r\n       (Firmano,Firma_Ad,BANKA_KOD,BANKA_AD,CARI_KOD,CARI_TIP,CARI_UNVAN,\r\n       TARIH,SAAT,BELGENO,ACIKLAMA,ISLTIP,ISLTIPAD,ISLHRK,ISLHRKAD,\r\n       YERAD,YERTIP,KULAD,KULTAR,DVZ,SIL,VARNO,VAROK,HRKID,MASID,\r\n       BORC,ALACAK,BAKIYE,REMOTE_ID,DEVIR)\r\n       SELECT\r\n       @firmano,'','','','','','',\r\n       DATEADD(day,-1,@TARIH1),'00:00:00','DEVIR','DEVIR',\r\n       'DEV','DEVIR','-','-',\r\n       '-','-','-',NULL,'-',\r\n       0,0,0,0,0,\r\n       isnull(sum(round(h.borc,@ONDA_HANE)),0),\r\n       isnull(sum(round(h.alacak,@ONDA_HANE)),0),\r\n       isnull(sum(round(h.borc-h.alacak,@ONDA_HANE)),0),\r\n       0,1\r\n       from bankahrk as h with (nolock) where \r\n       h.bankod=@BANK_KOD and \r\n       h.sil=0 and tarih < @TARIH1\r\n       \r\n          \r\n      if @firmano>0             \r\n      insert @TB_BANK_EKSTRE\r\n      (Firmano,Firma_Ad,BANKA_KOD,BANKA_AD,CARI_KOD,CARI_TIP,CARI_UNVAN,\r\n       TARIH,SAAT,BELGENO,ACIKLAMA,ISLTIP,ISLTIPAD,ISLHRK,ISLHRKAD,\r\n       YERAD,YERTIP,KULAD,KULTAR,DVZ,SIL,VARNO,VAROK,HRKID,MASID,\r\n       BORC,ALACAK,BAKIYE,REMOTE_ID,DEVIR)\r\n       SELECT\r\n       @firmano,'','','','','','',\r\n       DATEADD(day,-1,@TARIH1),'00:00:00','DEVIR','DEVIR',\r\n       'DEV','DEVIR','-','-',\r\n       '-','-','-',NULL,'-',\r\n       0,0,0,0,0,\r\n       isnull(sum(round(h.borc,@ONDA_HANE)),0),\r\n       isnull(sum(round(h.alacak,@ONDA_HANE)),0),\r\n       isnull(sum(round(h.borc-h.alacak,@ONDA_HANE)),0),\r\n       0,1\r\n       from bankahrk as h with (nolock) where (h.firmano=@firmano or h.firmano=0)\r\n      and h.bankod=@BANK_KOD\r\n      and h.sil=0 and tarih < @TARIH1\r\n     end\r\n     \r\n     \r\n       IF @DEVIR=2\r\n        begin \r\n       if @firmano=0\r\n       insert @TB_BANK_EKSTRE\r\n       (Firmano,Firma_Ad,BANKA_KOD,BANKA_AD,CARI_KOD,CARI_TIP,CARI_UNVAN,\r\n       TARIH,SAAT,BELGENO,ACIKLAMA,ISLTIP,ISLTIPAD,ISLHRK,ISLHRKAD,\r\n       YERAD,YERTIP,KULAD,KULTAR,DVZ,SIL,VARNO,VAROK,HRKID,MASID,\r\n       BORC,ALACAK,BAKIYE,REMOTE_ID,DEVIR)\r\n       SELECT\r\n       @firmano,'',b.kod,b.ad,'','','',\r\n       DATEADD(day,-1,@TARIH1),'00:00:00','DEVIR','DEVIR',\r\n       'DEV','DEVIR','-','-',\r\n       '-','-','-',NULL,'-',\r\n       0,0,0,0,0,\r\n       isnull(sum(round(h.borc,@ONDA_HANE)),0),\r\n       isnull(sum(round(h.alacak,@ONDA_HANE)),0),\r\n       isnull(sum(round(h.borc-h.alacak,@ONDA_HANE)),0),\r\n       0,1\r\n        from bankakart as b with (nolock) inner join bankahrk as h with (nolock)\r\n        on h.bankod=b.kod and b.sil=0 \r\n        where \r\n        h.bankod=@BANK_KOD and \r\n        h.sil=0 and tarih < @TARIH1\r\n        group by b.kod,b.ad\r\n       \r\n          \r\n      if @firmano>0             \r\n      insert @TB_BANK_EKSTRE\r\n      (Firmano,Firma_Ad,BANKA_KOD,BANKA_AD,CARI_KOD,CARI_TIP,CARI_UNVAN,\r\n       TARIH,SAAT,BELGENO,ACIKLAMA,ISLTIP,ISLTIPAD,ISLHRK,ISLHRKAD,\r\n       YERAD,YERTIP,KULAD,KULTAR,DVZ,SIL,VARNO,VAROK,HRKID,MASID,\r\n       BORC,ALACAK,BAKIYE,REMOTE_ID,DEVIR)\r\n       SELECT\r\n       @firmano,'',b.kod,b.ad,'','','',\r\n       DATEADD(day,-1,@TARIH1),'00:00:00','DEVIR','DEVIR',\r\n       'DEV','DEVIR','-','-',\r\n       '-','-','-',NULL,'-',\r\n       0,0,0,0,0,\r\n       isnull(sum(round(h.borc,@ONDA_HANE)),0),\r\n       isnull(sum(round(h.alacak,@ONDA_HANE)),0),\r\n       isnull(sum(round(h.borc-h.alacak,@ONDA_HANE)),0),\r\n       0,1\r\n        from bankakart as b with (nolock) inner join bankahrk as h with (nolock)\r\n        on h.bankod=b.kod and b.sil=0 \r\n        where (h.firmano=@firmano or h.firmano=0)\r\n      and h.bankod=@BANK_KOD\r\n      and h.sil=0 and tarih < @TARIH1\r\n      group by b.kod,b.ad\r\n     end\r\n     \r\n     \r\n     \r\n     \r\n       if @firmano=0\r\n        insert @TB_BANK_EKSTRE\r\n        (Firmano,Firma_Ad,BANKA_KOD,BANKA_AD,CARI_KOD,CARI_TIP,CARI_UNVAN,\r\n        TARIH,SAAT,BELGENO,ACIKLAMA,ISLTIP,ISLTIPAD,ISLHRK,ISLHRKAD,\r\n        YERAD,YERTIP,KULAD,KULTAR,DVZ,SIL,VARNO,VAROK,HRKID,MASID,\r\n        BORC,ALACAK,BAKIYE,REMOTE_ID,DEVIR,entegre_aktar)\r\n        SELECT  h.firmano,'',b.kod,b.ad,h.carkod,h.cartip,'',h.tarih,h.saat,\r\n        h.belno,h.ack,h.islmtip,h.islmtipad,h.islmhrk,\r\n        h.islmhrkad,h.yertip,h.yerad,\r\n        h.olususer,h.olustarsaat,h.parabrm,h.sil,\r\n        h.varno,h.varok,h.bankhrkid,h.masterid,\r\n        round(h.borc,@ONDA_HANE),\r\n        round(h.alacak,@ONDA_HANE),\r\n        round(h.borc-h.alacak,@ONDA_HANE),\r\n        h.remote_id,0,h.entegre_aktar\r\n        from bankakart as b with (nolock) inner join bankahrk as h with (nolock)\r\n        on h.bankod=b.kod and b.sil=0 and h.sil in (select * from @SIL_TEMP)\r\n        and b.kod=@BANK_KOD\r\n        where tarih >= @TARIH1\r\n        and tarih  <= @TARIH2\r\n        ORDER BY b.kod,tarih,saat\r\n        \r\n        if @firmano>0\r\n        insert @TB_BANK_EKSTRE\r\n        (Firmano,Firma_Ad,BANKA_KOD,BANKA_AD,CARI_KOD,CARI_TIP,CARI_UNVAN,\r\n        TARIH,SAAT,BELGENO,ACIKLAMA,ISLTIP,ISLTIPAD,ISLHRK,ISLHRKAD,\r\n        YERAD,YERTIP,KULAD,KULTAR,DVZ,SIL,VARNO,VAROK,HRKID,MASID,\r\n        BORC,ALACAK,BAKIYE,REMOTE_ID,DEVIR,entegre_aktar)\r\n        SELECT  h.firmano,'',b.kod,b.ad,h.carkod,h.cartip,'',h.tarih,h.saat,\r\n        h.belno,h.ack,h.islmtip,h.islmtipad,h.islmhrk,\r\n        h.islmhrkad,h.yertip,h.yerad,\r\n        h.olususer,h.olustarsaat,h.parabrm,h.sil,\r\n        h.varno,h.varok,h.bankhrkid,h.masterid,\r\n        round(h.borc,@ONDA_HANE),\r\n        round(h.alacak,@ONDA_HANE),\r\n        round(h.borc-h.alacak,@ONDA_HANE),\r\n        h.remote_id,0,h.entegre_aktar\r\n        from bankakart as b with (nolock) inner join bankahrk as h with (nolock)\r\n        on h.bankod=b.kod and b.sil=0 and h.sil in (select * from @SIL_TEMP)\r\n        and b.kod=@BANK_KOD\r\n        where (h.firmano=@firmano or h.firmano=0) and tarih >= @TARIH1\r\n        and tarih  <= @TARIH2\r\n        ORDER BY b.kod,tarih,saat  \r\n        \r\n        \r\n     end\r\n     \r\n\r\n   update @TB_BANK_EKSTRE set CARI_UNVAN=dt.ad from @TB_BANK_EKSTRE as t join\r\n   (select kod,ad,cartp from Genel_Kart with (nolock))\r\n   dt on t.CARI_KOD=dt.kod and t.CARI_TIP=dt.cartp\r\n\r\n   update @TB_BANK_EKSTRE set Firma_Ad=dt.ad from @TB_BANK_EKSTRE as t join\r\n   (select id,ad from Firma with (nolock))\r\n   dt on t.Firmano=dt.id\r\n\r\n\r\n\r\n/*\r\n  INSERT @TB_BANK_EKSTRE\r\n    (Firmano,Firma_Ad,BANKA_KOD,BANKA_AD,CARI_KOD,CARI_TIP,CARI_UNVAN,\r\n    TARIH,SAAT,BELGENO,ACIKLAMA,ISLTIP,ISLTIPAD,ISLHRK,ISLHRKAD,\r\n    YERAD,YERTIP,KULAD,KULTAR,DVZ,SIL,VARNO,VAROK,HRKID,MASID,\r\n    BORC,ALACAK,BAKIYE,REMOTE_ID,DEVIR)\r\n    SELECT Firmano,Firma_Ad,BANKA_KOD,BANKA_AD,CARI_KOD,CARI_TIP,CARI_UNVAN,\r\n    TARIH,SAAT,BELGENO,ACIKLAMA,ISLTIP,ISLTIPAD,ISLHRK,ISLHRKAD,\r\n    YERAD,YERTIP,KULAD,KULTAR,DVZ,SIL,VARNO,VAROK,HRKID,MASID,\r\n    BORC,ALACAK,BAKIYE,REMOTE_ID,DEVIR FROM @EKSTRE_TEMP \r\n*/\r\n\r\n\r\n\r\n  RETURN\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_BILANCO_RAP",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_BILANCO_RAP",
    "definition": "CREATE FUNCTION [dbo].UDF_BILANCO_RAP \r\n(@FIRMA_NO\t INT,\r\n@RAP_KOD\t VARCHAR(30),\r\n@KAY_ID\t\t INT,\r\n@TARIH       DATETIME)\r\nRETURNS\r\n  \r\n  @TABLE_BILANCO TABLE (\r\n   ID\t\t\t\t\tint,\r\n   PAR_ID\t\t\t\tint,\r\n   Ana_Id\t\t\t\tINT,\r\n   Grp_No\t\t\t\tInt,\r\n   Deger_Tip\t\t\tInt,\r\n   Table_Id\t\t\t    INT,\r\n   Table_Name\t\t\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n   ACK\t\t\t\t\tVARCHAR(100) COLLATE Turkish_CI_AS,\r\n   DEGER\t\t\t\tFloat)\r\nAS\r\nBEGIN\r\n\r\n\r\n    declare @mas_id\t   \t\tint\r\n    declare @mashrk_id\t   \tint\r\n    declare @id\t   \t\t\tint\r\n    declare @Table_Id\t\tint\r\n    declare @Grp_No\t\t\tint\r\n    declare @deger\t\t\tfloat\r\n    \r\n    declare @Top_Tutar\t\tfloat\r\n    \r\n    \r\n    declare @Deger_Tip\t\t\tint\r\n    \r\n    \r\n    declare @hrk_id\t   \t\tint\r\n    \r\n    declare @grp1_id\t    int\r\n    declare @grp2_id\t    int\r\n    declare @grp3_id\t    int\r\n    \r\n    declare @grp1id \t \tint\r\n    declare @grp2id \t\tint\r\n    declare @ana_Id\t\t\tint\r\n\r\n    declare @ACK         \tvarchar(100)\r\n    declare @Table_Name   \tvarchar(100)\r\n    \r\n    \r\n\r\n     /*set @parentid=@id  */\r\n   \r\n    set @hrk_id=0\r\n\r\n\r\n     declare mas_cur CURSOR FAST_FORWARD  FOR \r\n       select id,ack,Ana_Id from rapor_mas \r\n        where Rap_Kod=@RAP_KOD and sil=0 \r\n        and Ana=1\r\n        open mas_cur\r\n          fetch next from  mas_cur into @grp1_id,@ACK,@ana_Id\r\n           while @@FETCH_STATUS=0\r\n            begin  \r\n\r\n            set @Table_Name='rapor_mas'\r\n            set @Table_Id=@grp1_id\r\n            \r\n             set @hrk_id=@hrk_id+1  \r\n            \r\n            insert into @TABLE_BILANCO \r\n            (ID,PAR_ID,Ana_Id,Grp_No,Table_Id,Table_Name,ACK,DEGER,Deger_Tip)\r\n             VALUES  (@hrk_id,0,@ana_Id,0,@Table_Id,@Table_Name,@ACK,0,0)\r\n             \r\n             set  @mas_id=@hrk_id\r\n             \r\n             \r\n           declare mas_bas CURSOR FAST_FORWARD  FOR \r\n           select id,ack,Ana_Id from rapor_mas \r\n            where Rap_Kod=@RAP_KOD and sil=0 \r\n            and Ana=0 and ana_Id=@ana_Id\r\n             open mas_bas\r\n               fetch next from  mas_bas into @grp2_id,@ACK,@ana_Id\r\n                while @@FETCH_STATUS=0\r\n                 begin    \r\n             \r\n                 set @Table_Name='rapor_mas'\r\n                 set @Table_Id=@grp2_id\r\n                 \r\n                  set @hrk_id=@hrk_id+1\r\n             \r\n             \r\n                   insert into @TABLE_BILANCO \r\n                  (ID,PAR_ID,Ana_Id,Grp_No,Table_Id,\r\n                  Table_Name,ACK,DEGER,Deger_Tip)\r\n                   VALUES  (@hrk_id,@mas_id,@ana_Id,1,\r\n                   @Table_Id,@Table_Name,@ACK,0,0)\r\n             \r\n             \t            \r\n                      set @mashrk_id=@hrk_id\r\n             \r\n                           \r\n                        declare mas_hrk CURSOR FAST_FORWARD  FOR \r\n                         select id,ack,Deger_Tip \r\n                         from Rapor_Grup_Kriter\r\n                          where Rap_Kod=@RAP_KOD and sil=0 and \r\n                            mas_Id=@grp2_id \r\n                           open mas_hrk  \r\n                          \r\n                          fetch next from  mas_hrk into \r\n                          @grp3_id,@ACK,@Deger_Tip\r\n                            while @@FETCH_STATUS=0\r\n                              begin\r\n                             \r\n                             set @Table_Name='Rapor_Grup_Kriter' \r\n                             set @Table_Id=@grp3_id\r\n                             \r\n                              set @hrk_id=@hrk_id+1     \r\n                           \r\n                          \r\n                            /* kart hrk sesaplatma */\r\n                          \r\n                            set @deger=\r\n                            dbo.UDF_RAPOR_DEGER_TUTAR \r\n                            (@FIRMA_NO,@RAP_KOD,@grp3_id,@KAY_ID,0,@TARIH)\r\n                        \r\n                                                 \r\n                              insert into @TABLE_BILANCO \r\n                              (ID,PAR_ID,Ana_Id,Grp_No,\r\n                              Table_Id,Table_Name,ACK,DEGER,Deger_Tip)\r\n                              VALUES  (@hrk_id,@mashrk_id,@ana_Id,2,\r\n                              @Table_Id,@Table_Name,@ACK,@Deger,@Deger_Tip)\r\n                \r\n                            \r\n                              \r\n                                                     \r\n                          FETCH next from  mas_hrk into @grp3_id,@ACK,@Deger_Tip\r\n                         end\r\n                        Close mas_hrk\r\n                        deallocate mas_hrk  \r\n                        \r\n                        \r\n                      select @Top_Tutar=\r\n                       Sum(Deger) from @TABLE_BILANCO     \r\n                      where PAR_ID=@mashrk_id \r\n             \r\n                      UPDATE @TABLE_BILANCO \r\n                      SET DEGER=@Top_Tutar\r\n                      where ID=@mashrk_id   \r\n                        \r\n                        \r\n                        \r\n                  FETCH next from  mas_bas into @grp2_id,@ACK,@Ana_Id\r\n               end\r\n              Close mas_bas\r\n              deallocate mas_bas\r\n                        \r\n              select @Top_Tutar=\r\n               Sum(Deger) from @TABLE_BILANCO     \r\n               where PAR_ID=@mas_id \r\n             \r\n              UPDATE @TABLE_BILANCO \r\n               SET DEGER=@Top_Tutar\r\n              where ID=@mas_id \r\n             \r\n             \r\n             \r\n          FETCH next from  mas_cur into @grp1_id,@ACK,@Ana_Id\r\n         end\r\n        Close mas_cur\r\n        deallocate mas_cur  \r\n\r\n\r\n\r\n\r\n\r\n  RETURN\r\n\r\n\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_BORC_YASLANDIRMA",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_BORC_YASLANDIRMA",
    "definition": "CREATE FUNCTION [dbo].[UDF_BORC_YASLANDIRMA] (\r\n@FirmaNo \t\tint,\r\n@CarKodIn       Varchar(1000),\r\n@RefTarih\t\tDatetime,\r\n@VadeGun        int)\r\nRETURNS\r\n   \r\n   @TABLE_BAKIYE_BORC TABLE (\r\n   id\t\t\t\t\tint ,\r\n   Cari_Tip\t\t\t    VARCHAR(20) COLLATE Turkish_CI_AS,\r\n   Cari_Tip_Id\t\t\tint,\r\n   Cari_Kod\t\t\t\t\tVARCHAR(30) COLLATE Turkish_CI_AS,\r\n   Cari_Unvan\t\t\t\tVARCHAR(200) COLLATE Turkish_CI_AS,\r\n   Islem_Ad\t\t\t\tVARCHAR(200) COLLATE Turkish_CI_AS,\r\n   Grup \t\t\t\tVARCHAR(100) COLLATE Turkish_CI_AS,\r\n   Borc      \t\t\tFloat,\r\n   Alacak\t\t\t\tFloat,\r\n   Bakiye\t\t\t\tFloat,\r\n   Vade_Tarih\t\t\tDateTime,\r\n   Vade_Gun\t\t\t\tint)\r\nAS\r\nBEGIN\r\n \r\n \r\n   declare @CariTip Varchar(20)\r\n   declare @CariTipId  int\r\n   \r\n   set @CariTip='carikart'\r\n   set @CariTipId=1 \r\n\r\n\r\n\r\n    insert into @TABLE_BAKIYE_BORC (id,Cari_Tip,Cari_Tip_Id,\r\n    Cari_Kod,Islem_Ad,\r\n    Borc,Alacak,Bakiye,Vade_Tarih,Vade_Gun)\r\n    select h.id,@CariTip,@CariTipId,carkod,\r\n    islmhrkad,Borc,0,0,VadeTar,0 From carihrk as h with (NOLOCK)\r\n \r\n    Where carTip=@CariTip\r\n    and H.Carkod in (Select * from  dbo.CsvToSTR(@CarKodIn))\r\n    and h.Sil=0 and h.Borc>0 and h.firmano in (0,@FirmaNo) \r\n    Order By h.carkod,h.Tarih\r\n    \r\n    \r\n    declare @id int\r\n    declare @Say int\r\n    declare @Kod varchar(50)\r\n    declare @Alacak  Float\r\n    declare @Bakiye  Float\r\n    declare @Tarih  Datetime\r\n    \r\n     declare pom_var CURSOR FAST_FORWARD  FOR \r\n      select carkod,Alacak,Tarih From carihrk with (NOLOCK) Where carTip=@CariTip\r\n      and Carkod in (Select * from  dbo.CsvToSTR(@CarKodIn))\r\n      and Sil=0 and Alacak>0 and firmano in (0,@FirmaNo)\r\n      Order By carkod,Tarih\r\n      open pom_var\r\n     fetch next from  pom_var into @Kod,@Alacak,@Tarih\r\n      while @@FETCH_STATUS=0\r\n      begin\r\n    \r\n      Select Top 1 @id=id,@Bakiye=Borc-Alacak From @TABLE_BAKIYE_BORC \r\n      Where  Cari_Kod=@Kod and Borc-Alacak>0 order by id\r\n\r\n      while (@Bakiye>0.1)             \r\n      begin\r\n\r\n\r\n        if @Bakiye>= @Alacak\r\n         begin\r\n            Update @TABLE_BAKIYE_BORC Set Alacak=Alacak+@Alacak \r\n            Where id=@id \r\n            set  @Bakiye=0\r\n         end\r\n        \r\n          if (@Bakiye <= @Alacak) and (@Bakiye>0.1)\r\n          begin\r\n   \r\n           Update @TABLE_BAKIYE_BORC Set Alacak=Alacak+@Bakiye Where id=@id\r\n            set @Alacak=@Alacak-@Bakiye       \r\n            \r\n            select @Say=Count(id) From @TABLE_BAKIYE_BORC \r\n            Where  Cari_Kod=@Kod and (Borc-Alacak)>0 \r\n\r\n            if @Say>0\r\n             begin\r\n               Select Top 1 @id=id,@Bakiye=isnull(Borc-Alacak,0) From @TABLE_BAKIYE_BORC \r\n               Where  Cari_Kod=@Kod and Borc-Alacak>0 order by id \r\n             end  \r\n\r\n            if @Say=0 \r\n             begin\r\n                /* Alacak Bakiye Var ise */\r\n               if @Alacak>0 \r\n                insert into @TABLE_BAKIYE_BORC (id,Cari_Tip,Cari_Tip_Id,Cari_Kod,\r\n                Islem_Ad,Borc,Alacak,Vade_Tarih,Vade_Gun)\r\n                select 0,@CariTip,@CariTipId,@Kod,'ALACAK BAKİYE',0,@Alacak,@Tarih,0 \r\n             \r\n                set @Bakiye=0\r\n             \r\n             end\r\n             \r\n   \r\n         end \r\n         \r\n         \r\n         \r\n         \r\n       end /*while */\r\n      \r\n\r\n\r\n      FETCH next from  pom_var into @Kod,@Alacak,@Tarih\r\n     end\r\n    close Pom_Var\r\n    deallocate pom_var\r\n\r\n\r\n  Update @TABLE_BAKIYE_BORC Set Bakiye=Borc-Alacak\r\n\r\n   Update @TABLE_BAKIYE_BORC Set Vade_Gun=CONVERT(float, Getdate() - Vade_Tarih)\r\n   Where Borc-Alacak>0\r\n   \r\n   \r\n   Update @TABLE_BAKIYE_BORC Set Vade_Gun=CONVERT(float, Vade_Tarih-Getdate())\r\n   Where Borc-Alacak<0\r\n\r\n\r\n   update @TABLE_BAKIYE_BORC set Grup=GrupAd, \r\n   Cari_Unvan=Dt.Unvan From @TABLE_BAKIYE_BORC as t \r\n   join (Select k.Kod,Unvan,G.ad GrupAd From carikart as k \r\n    left join grup as g on g.id=case when k.grp3>0 then k.grp3\r\n    when k.grp2>0 then k.grp2\r\n    when k.grp1>0 then k.grp1 end ) dt \r\n    on dt.kod=t.Cari_Kod\r\n   \r\n   \r\n    if @VadeGun>0\r\n     delete From @TABLE_BAKIYE_BORC Where Vade_Gun<@VadeGun\r\n   \r\n\r\n\r\n RETURN\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_CAPRAZ_KUR",
    "type": "SQL_SCALAR_FUNCTION",
    "full_name": "dbo.UDF_CAPRAZ_KUR",
    "definition": "CREATE FUNCTION [dbo].UDF_CAPRAZ_KUR\r\n(\r\n@tarih   datetime,\r\n@KUR1   varchar(20),\r\n@KUR2    varchar(20))\r\n RETURNS float\r\nAS\r\nBEGIN\r\n\r\n declare @kur1_deger float\r\n declare @kur2_deger float\r\n declare @sonuc      float\r\n \r\n /*RETURN 1 */\r\n \r\n \r\nselect @kur1_deger=isnull(dov_satis,1) from\r\npara_kur where kod=@KUR1 and\r\ntarih=(select max(tarih) from para_kur where  tarih<=@tarih)\r\n \r\nselect @kur2_deger=isnull(dov_satis,1) from\r\npara_kur where kod=@KUR2 and\r\ntarih=(select max(tarih) from para_kur where  tarih<=@tarih)\r\n \r\n if (@kur1_deger is null) or (@kur2_deger=0)\r\n   set @sonuc=1\r\n  else\r\n    set @sonuc=round(@kur1_deger/@kur2_deger,25)\r\n\r\n RETURN @sonuc\r\n \r\n \r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_CARI_AYLIK",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_CARI_AYLIK",
    "definition": "CREATE FUNCTION UDF_CARI_AYLIK (@CARI_TIP VARCHAR(20),\r\n@CARI_KODIN VARCHAR(8000),@YIL INT)\r\nRETURNS\r\n  @TB_CARI_EKSTRE TABLE (\r\n    CARI_TIP          VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    CARI_KOD          VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    CARI_UNVAN        VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    AY                INT,\r\n    AYISIM            VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    CARIDEVIR         FLOAT,\r\n    CARIFIS           FLOAT,\r\n    CARIBORC          FLOAT,\r\n    CARIALACAK        FLOAT,\r\n    CARIBAKIYE        FLOAT,\r\n    BAKIYE            FLOAT )\r\nAS\r\nBEGIN\r\n  DECLARE @EKSTRE_TEMP TABLE (\r\n     CARI_TIP         VARCHAR(20) COLLATE Turkish_CI_AS,\r\n     CARI_KOD         VARCHAR(20) COLLATE Turkish_CI_AS,\r\n     CARI_UNVAN       VARCHAR(50) COLLATE Turkish_CI_AS,\r\n     AY               INT,\r\n     AYISIM           VARCHAR(20) COLLATE Turkish_CI_AS,\r\n     CARIDEVIR        FLOAT,\r\n     CARIFIS          FLOAT,\r\n     CARIBORC         FLOAT,\r\n     CARIALACAK       FLOAT,\r\n     CARIBAKIYE       FLOAT,\r\n     BAKIYE           FLOAT )\r\n\r\n  DECLARE @HRK_CARI_TIP    VARCHAR(20)\r\n  DECLARE @HRK_CARI_KOD    VARCHAR(20)\r\n  DECLARE @HRK_CARI_UNVAN  VARCHAR(50)\r\n  DECLARE @HRK_AY           INT\r\n  DECLARE @HRK_AYISIM       VARCHAR(20)\r\n  DECLARE @HRK_FISDEVIR      FLOAT\r\n  DECLARE @HRK_CARDEVIR      FLOAT\r\n  DECLARE @HRK_CARIFIS       FLOAT\r\n  DECLARE @HRK_BORC          FLOAT\r\n  DECLARE @HRK_ALACAK        FLOAT\r\n  DECLARE @HRK_CARIBAKIYE    FLOAT\r\n  DECLARE @HRK_GENELTOP      FLOAT\r\n  DECLARE @HRK_DEVIR         FLOAT\r\n  DECLARE @HRK_ROW_COUNT     INT\r\n\r\n  DECLARE @HRK_TBASTAR       DATETIME\r\n  DECLARE @TARIH1            DATETIME\r\n  DECLARE @TARIH2            DATETIME\r\n\r\n\r\n\r\n declare @FatIskGoster   bit\r\n  select top 1 @FatIskGoster=case when FaturaFisIskonto=0 then 1 else 0 end\r\n  from sistemtanim  \r\n\r\n\r\n\r\n  DECLARE CRS_HRK_IN CURSOR FAST_FORWARD FOR\r\n     SELECT v.cartp,v.kod,v.ad FROM Genel_Kart as v where\r\n      v.cartp=@CARI_TIP and v.kod in (select * from CsvToSTR(@CARI_KODIN))\r\n      OPEN CRS_HRK_IN\r\n\r\n   FETCH NEXT FROM CRS_HRK_IN INTO\r\n   @HRK_CARI_TIP,@HRK_CARI_KOD,@HRK_CARI_UNVAN\r\n\r\n   WHILE @@FETCH_STATUS = 0\r\n     BEGIN\r\n\r\n\r\n        set @HRK_AY=1\r\n         \r\n        SET @HRK_TBASTAR=\r\n        CAST(@YIL AS VARCHAR(4))+'-'+CAST(@HRK_AY AS VARCHAR(4))+'-01'\r\n\r\n         set @HRK_DEVIR=0\r\n         if @FatIskGoster=0\r\n         (select @HRK_DEVIR=isnull(sum((d.borc+d.fisbakiye)-d.alacak),0) from\r\n         view_cari_hrk_fis_listesi as d where d.cartip=@CARI_TIP\r\n         and d.carkod=@HRK_CARI_KOD \r\n         and d.Aktip='BK'\r\n         /*and d.islmhrk not in ('CAK','FATVERSAT') */\r\n         and d.tarih<@HRK_TBASTAR)\r\n\r\n\r\n        if @FatIskGoster=1\r\n         (select @HRK_DEVIR=isnull(sum((d.borc+d.fisbakiye)-d.alacak),0) from\r\n         view_cari_hrk_fis_Isk_listesi as d where d.cartip=@CARI_TIP\r\n         and d.carkod=@HRK_CARI_KOD \r\n         and d.Aktip='BK'\r\n         /*and d.islmhrk not in ('CAK','FATVERSAT') */\r\n         and d.tarih<@HRK_TBASTAR)\r\n\r\n\r\n\r\n         \r\n          WHILE @HRK_AY<=12\r\n          begin\r\n\r\n            set @HRK_AYISIM=\r\n            (select\r\n              CASE @HRK_AY\r\n               WHEN 1 THEN 'OCAK'\r\n               WHEN 2 THEN 'ŞUBAT'\r\n               WHEN 3 THEN 'MART'\r\n               WHEN 4 THEN 'NİSAN'\r\n               WHEN 5 THEN 'MAYIS'\r\n               WHEN 6 THEN 'HAZİRAN'\r\n               WHEN 7 THEN 'TEMMUZ'\r\n               WHEN 8 THEN 'AĞUSTOS'\r\n               WHEN 9 THEN 'EYLÜL'\r\n               WHEN 10 THEN 'EKİM'\r\n               WHEN 11 THEN 'KASIM'\r\n               WHEN 12 THEN 'ARALIK'\r\n              END)\r\n\r\n             set @HRK_BORC=0\r\n             set @HRK_ALACAK=0\r\n             set @HRK_CARIFIS=0\r\n\r\n            \r\n            \r\n             if @FatIskGoster=0\r\n             SELECT\r\n              @HRK_BORC=isnull(sum(h.borc),0),\r\n              @HRK_ALACAK=isnull(sum(h.alacak),0),\r\n              @HRK_CARIFIS=isnull(sum(h.fisbakiye),0)\r\n              FROM view_cari_hrk_fis_listesi as h\r\n              where h.cartip=@CARI_TIP and\r\n              h.carkod=@HRK_CARI_KOD\r\n              /*and h.islmhrk not in ('CAK','FATVERSAT') */\r\n              and h.Aktip='BK'\r\n              and h.ay =@HRK_AY and h.yil = @YIL\r\n              group by h.cartip,h.carkod,h.unvan,h.ay\r\n              order by h.ay\r\n              \r\n              \r\n            if @FatIskGoster=1\r\n             SELECT\r\n              @HRK_BORC=isnull(sum(h.borc),0),\r\n              @HRK_ALACAK=isnull(sum(h.alacak),0),\r\n              @HRK_CARIFIS=isnull(sum(h.fisbakiye),0)\r\n              FROM view_cari_hrk_fis_Isk_listesi as h\r\n              where h.cartip=@CARI_TIP and\r\n              h.carkod=@HRK_CARI_KOD\r\n              /*and h.islmhrk not in ('CAK','FATVERSAT') */\r\n              and h.Aktip='BK'\r\n              and h.ay =@HRK_AY and h.yil = @YIL\r\n              group by h.cartip,h.carkod,h.unvan,h.ay\r\n              order by h.ay\r\n\r\n\r\n\r\n                SET @HRK_CARIBAKIYE=@HRK_BORC-@HRK_ALACAK\r\n                SET @HRK_GENELTOP=@HRK_DEVIR+@HRK_CARIFIS+@HRK_CARIBAKIYE\r\n\r\n                INSERT @EKSTRE_TEMP\r\n                 SELECT\r\n                 @HRK_CARI_TIP,@HRK_CARI_KOD,@HRK_CARI_UNVAN,@HRK_AY,@HRK_AYISIM,\r\n                 @HRK_DEVIR,@HRK_CARIFIS,@HRK_BORC,@HRK_ALACAK,\r\n                 @HRK_CARIBAKIYE,@HRK_GENELTOP\r\n\r\n                 SET @HRK_DEVIR=@HRK_GENELTOP\r\n                 \r\n           set @HRK_AY=@HRK_AY+1\r\n\r\n           end/*ay dongu */\r\n\r\n\r\n          FETCH NEXT FROM CRS_HRK_IN INTO\r\n          @HRK_CARI_TIP,@HRK_CARI_KOD,@HRK_CARI_UNVAN\r\n          END\r\n\r\n          CLOSE CRS_HRK_IN\r\n          DEALLOCATE CRS_HRK_IN\r\n\r\n\r\n/*---------------------------------------------------------------------------- */\r\n\r\n   INSERT @TB_CARI_EKSTRE\r\n    SELECT * FROM @EKSTRE_TEMP ORDER BY AY\r\n\r\n  RETURN\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_CARI_AYLIK_BA",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_CARI_AYLIK_BA",
    "definition": "CREATE FUNCTION UDF_CARI_AYLIK_BA (@CARI_TIP VARCHAR(20),\r\n@CARI_KODIN VARCHAR(8000),\r\n@YIL INT)\r\nRETURNS\r\n  @TB_CARI_EKSTRE TABLE (\r\n    CARI_TIP          VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    CARI_KOD          VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    CARI_UNVAN        VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    AY                INT,\r\n    AYISIM            VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    CARIDEVIR         FLOAT,\r\n    CARIBORC          FLOAT,\r\n    CARIALACAK        FLOAT,\r\n    BAKIYE            FLOAT )\r\nAS\r\nBEGIN\r\n  DECLARE @EKSTRE_TEMP TABLE (\r\n     CARI_TIP         VARCHAR(20) COLLATE Turkish_CI_AS,\r\n     CARI_KOD         VARCHAR(20) COLLATE Turkish_CI_AS,\r\n     CARI_UNVAN       VARCHAR(50) COLLATE Turkish_CI_AS,\r\n     AY               INT,\r\n     AYISIM           VARCHAR(20) COLLATE Turkish_CI_AS,\r\n     CARIDEVIR        FLOAT,\r\n     CARIBORC         FLOAT,\r\n     CARIALACAK       FLOAT,\r\n     BAKIYE           FLOAT )\r\n\r\n  DECLARE @HRK_CARI_TIP    VARCHAR(20)\r\n  DECLARE @HRK_CARI_CARTIP VARCHAR(20)\r\n  DECLARE @HRK_CARI_KOD    VARCHAR(20)\r\n  DECLARE @HRK_CARI_UNVAN  VARCHAR(50)\r\n  DECLARE @HRK_AY           INT\r\n  DECLARE @HRK_AYISIM       VARCHAR(20)\r\n  DECLARE @HRK_FISDEVIR      FLOAT\r\n  DECLARE @HRK_CARDEVIR      FLOAT\r\n  DECLARE @HRK_CARIFIS       FLOAT\r\n  DECLARE @HRK_BORC          FLOAT\r\n  DECLARE @HRK_ALACAK        FLOAT\r\n  DECLARE @HRK_GENELTOP      FLOAT\r\n  DECLARE @HRK_DEVIR         FLOAT\r\n  \r\n  \r\n  DECLARE @HRK_TBASTAR       DATETIME\r\n  DECLARE @TARIH1            DATETIME\r\n  DECLARE @TARIH2            DATETIME\r\n  \r\n  \r\n  \r\n   \r\n  declare @FatIskGoster   bit\r\n  select top 1 @FatIskGoster=case when FaturaFisIskonto=0 then 1 else 0 end\r\n  from sistemtanim  \r\n  \r\n  \r\n\r\n  SET  @TARIH1=CAST(@YIL AS VARCHAR(4))+'-01-01'\r\n  SET  @TARIH2=CAST(@YIL AS VARCHAR(4))+'-12-31'\r\n\r\nDECLARE @EKSTRE_IN TABLE (\r\n carkod     varchar(30) COLLATE Turkish_CI_AS)\r\n\r\ndeclare @separator char(1)\r\n set @separator = ','\r\n\r\n declare @separator_position int\r\n declare @array_value varchar(1000)\r\n\r\n IF (LEN(RTRIM(@CARI_KODIN)) > 0)\r\n BEGIN\r\n  set @CARI_KODIN = @CARI_KODIN + ','\r\n END\r\n\r\n while patindex('%,%' , @CARI_KODIN) <> 0\r\n begin\r\n\r\n   select @separator_position =  patindex('%,%' , @CARI_KODIN)\r\n   select @array_value = left(@CARI_KODIN, @separator_position - 1)\r\n\r\n  Insert @EKSTRE_IN\r\n  Values (@array_value)\r\n\r\n   select @CARI_KODIN = stuff(@CARI_KODIN, 1, @separator_position, '')\r\n end\r\n\r\n\r\n DECLARE CRS_HRK_IN CURSOR FAST_FORWARD FOR\r\n     SELECT v.cartp,v.kod,v.ad FROM Genel_Kart as v where\r\n      v.cartp=@CARI_TIP and v.kod in (select * from @EKSTRE_IN)\r\n      OPEN CRS_HRK_IN\r\n\r\n   FETCH NEXT FROM CRS_HRK_IN INTO\r\n   @HRK_CARI_TIP,@HRK_CARI_KOD,@HRK_CARI_UNVAN\r\n\r\n   WHILE @@FETCH_STATUS = 0\r\n     BEGIN\r\n\r\n\r\n        set @HRK_AY=1\r\n\r\n        SET @HRK_TBASTAR=\r\n        CAST(@YIL AS VARCHAR(4))+'-'+CAST(@HRK_AY AS VARCHAR(4))+'-01'\r\n\r\n         set @HRK_DEVIR=0\r\n         if @FatIskGoster=0\r\n         (select @HRK_DEVIR=isnull(sum((d.borc+d.fisbakiye)-d.alacak),0) from\r\n         view_cari_hrk_fis_listesi as d where d.cartip=@CARI_TIP\r\n         and d.carkod=@HRK_CARI_KOD and d.aktip='BK'\r\n         /*and d.islmhrk not in ('CAK','FATVERSAT') */\r\n          and d.tarih<@HRK_TBASTAR)\r\n          \r\n          \r\n         if @FatIskGoster=1\r\n         (select @HRK_DEVIR=isnull(sum((d.borc+d.fisbakiye)-d.alacak),0) from\r\n         view_cari_hrk_fis_Isk_listesi as d where d.cartip=@CARI_TIP\r\n         and d.carkod=@HRK_CARI_KOD and d.aktip='BK'\r\n         /*and d.islmhrk not in ('CAK','FATVERSAT') */\r\n          and d.tarih<@HRK_TBASTAR) \r\n          \r\n\r\n\r\n\r\n          WHILE @HRK_AY<=12\r\n          begin\r\n\r\n            set @HRK_AYISIM=\r\n            (select\r\n              CASE @HRK_AY\r\n               WHEN 1 THEN 'OCAK'\r\n               WHEN 2 THEN 'ŞUBAT'\r\n               WHEN 3 THEN 'MART'\r\n               WHEN 4 THEN 'NİSAN'\r\n               WHEN 5 THEN 'MAYIS'\r\n               WHEN 6 THEN 'HAZİRAN'\r\n               WHEN 7 THEN 'TEMMUZ'\r\n               WHEN 8 THEN 'AĞUSTOS'\r\n               WHEN 9 THEN 'EYLÜL'\r\n               WHEN 10 THEN 'EKİM'\r\n               WHEN 11 THEN 'KASIM'\r\n               WHEN 12 THEN 'ARALIK'\r\n              END)\r\n\r\n             set @HRK_BORC=0\r\n             set @HRK_ALACAK=0\r\n\r\n\r\n             if @FatIskGoster=0\r\n             SELECT\r\n              @HRK_BORC=isnull(sum(h.borc+h.fisbakiye),0),\r\n              @HRK_ALACAK=isnull(sum(h.alacak),0)\r\n              FROM view_cari_hrk_fis_listesi as h\r\n              where h.cartip=@CARI_TIP and\r\n              h.carkod=@HRK_CARI_KOD\r\n             and h.aktip='BK'\r\n             /* and h.islmhrk not in ('CAK','FATVERSAT') */\r\n              and h.ay =@HRK_AY and h.yil = @YIL\r\n              group by h.cartip,h.carkod,h.unvan,h.ay\r\n              order by h.ay\r\n              \r\n              \r\n             if @FatIskGoster=1\r\n             SELECT\r\n              @HRK_BORC=isnull(sum(h.borc+h.fisbakiye),0),\r\n              @HRK_ALACAK=isnull(sum(h.alacak),0)\r\n              FROM view_cari_hrk_fis_Isk_listesi as h\r\n              where h.cartip=@CARI_TIP and\r\n              h.carkod=@HRK_CARI_KOD\r\n             and h.aktip='BK'\r\n             /* and h.islmhrk not in ('CAK','FATVERSAT') */\r\n              and h.ay =@HRK_AY and h.yil = @YIL\r\n              group by h.cartip,h.carkod,h.unvan,h.ay\r\n              order by h.ay \r\n              \r\n              \r\n              \r\n\r\n             SET @HRK_GENELTOP=(@HRK_DEVIR+@HRK_BORC)-@HRK_ALACAK\r\n\r\n              INSERT @EKSTRE_TEMP\r\n              SELECT\r\n               @HRK_CARI_TIP,@HRK_CARI_KOD,@HRK_CARI_UNVAN,@HRK_AY,@HRK_AYISIM,\r\n                @HRK_DEVIR,@HRK_BORC,@HRK_ALACAK,@HRK_GENELTOP\r\n\r\n             SET @HRK_DEVIR=@HRK_GENELTOP\r\n\r\n            set @HRK_AY=@HRK_AY+1\r\n\r\n           end/*ay dongu */\r\n\r\n\r\n          FETCH NEXT FROM CRS_HRK_IN INTO\r\n          @HRK_CARI_TIP,@HRK_CARI_KOD,@HRK_CARI_UNVAN\r\n          END\r\n\r\n          CLOSE CRS_HRK_IN\r\n          DEALLOCATE CRS_HRK_IN\r\n\r\n\r\n/*---------------------------------------------------------------------------- */\r\n\r\n   INSERT @TB_CARI_EKSTRE\r\n    SELECT * FROM @EKSTRE_TEMP ORDER BY AY\r\n\r\n  RETURN\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_CARI_BAKIYE",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_CARI_BAKIYE",
    "definition": "CREATE FUNCTION UDF_CARI_BAKIYE (\r\n@FIRMANO\t\tint,\r\n@CARI_TIP VARCHAR(20),\r\n@CARI_KODIN VARCHAR(8000),\r\n@TARIH1 DATETIME, \r\n@TARIH2 DATETIME)\r\nRETURNS\r\n  @TB_CARI_EKSTRE TABLE (\r\n    FIRMANO     INT,\r\n    CARI_TIP    VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    CARI_KOD    VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    CARI_UNVAN  VARCHAR(200) COLLATE Turkish_CI_AS,\r\n    CARI_FATUNVAN  VARCHAR(200) COLLATE Turkish_CI_AS,\r\n    TEL\t\t\t VARCHAR(100) COLLATE Turkish_CI_AS,\r\n    FAX\t\t\t VARCHAR(100) COLLATE Turkish_CI_AS,\r\n    CEP\t\t\t VARCHAR(100) COLLATE Turkish_CI_AS,\r\n    EPOSTA  \t VARCHAR(100) COLLATE Turkish_CI_AS,\r\n    MUH_ON_KOD  VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    MUH_RES_KOD  VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    CARIHESAP       FLOAT,\r\n    CARIFIS         FLOAT,\r\n    CEKSENET        FLOAT,\r\n    BORCBAKIYE\t\tFLOAT,\r\n    ALACAKBAKIYE\tFLOAT,\t\r\n    GENELTOPLAM     FLOAT,\r\n    CEKHARICIBAKIYE FLOAT )\r\nAS\r\nBEGIN\r\n\r\nDECLARE @EKSTRE_CARITEMP TABLE (\r\n carkod     varchar(30) COLLATE Turkish_CI_AS )\r\n\r\ndeclare @separator char(1) \r\n set @separator = ','\r\n\r\n declare @separator_position int\r\n declare @array_value varchar(1000)\r\n\r\n IF (LEN(RTRIM(@CARI_KODIN)) > 0)\r\n BEGIN\r\n  set @CARI_KODIN = @CARI_KODIN + ','\r\n END\r\n\r\n while patindex('%,%' , @CARI_KODIN) <> 0\r\n begin\r\n\r\n   select @separator_position =  patindex('%,%' , @CARI_KODIN)\r\n   select @array_value = left(@CARI_KODIN, @separator_position - 1)\r\n\r\n  Insert @EKSTRE_CARITEMP\r\n  Values (@array_value)\r\n\r\n   select @CARI_KODIN = stuff(@CARI_KODIN, 1, @separator_position, '')\r\n end\r\n\r\n\r\n  DECLARE @EKSTRE_TEMP TABLE (\r\n    FIRMANO     INT,\r\n    CARI_TIP    VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    CARI_KOD    VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    CARI_UNVAN  VARCHAR(150) COLLATE Turkish_CI_AS,\r\n    CARI_FATUNVAN  VARCHAR(200) COLLATE Turkish_CI_AS,\r\n    TEL\t\t\t VARCHAR(100) COLLATE Turkish_CI_AS,\r\n    FAX\t\t\t VARCHAR(100) COLLATE Turkish_CI_AS,\r\n    CEP\t\t\t VARCHAR(100) COLLATE Turkish_CI_AS,\r\n    EPOSTA  \t VARCHAR(100) COLLATE Turkish_CI_AS,\r\n    MUH_ON_KOD  VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    MUH_RES_KOD  VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    CARIHESAP       FLOAT,\r\n    CARIFIS         FLOAT,\r\n    CEKSENET        FLOAT,\r\n    BORCBAKIYE\t\tFLOAT,\r\n    ALACAKBAKIYE\tFLOAT,\t    \r\n    GENELTOPLAM     FLOAT,\r\n    CEKHARICIBAKIYE FLOAT)\r\n\r\n  DECLARE @HRK_CARI_TIP    VARCHAR(30)\r\n  DECLARE @HRK_CARI_KOD    VARCHAR(30)\r\n  DECLARE @HRK_MUH_ON_KOD  VARCHAR(30)\r\n  DECLARE @HRK_MUH_RES_KOD  VARCHAR(30)\r\n  DECLARE @HRK_CARI_UNVAN  VARCHAR(200)\r\n  DECLARE @HRK_CARI_FATUNVAN  VARCHAR(200)\r\n  DECLARE @HRK_CARI_TEL  VARCHAR(100)\r\n  DECLARE @HRK_CARI_FAX  VARCHAR(100)\r\n  DECLARE @HRK_CARI_CEP  VARCHAR(100)\r\n  DECLARE @HRK_CARI_EPOSTA  VARCHAR(100)\r\n  DECLARE @HRK_CARIHESAP       FLOAT\r\n  DECLARE @HRK_CARIFIS         FLOAT\r\n  DECLARE @HRK_CEKSENET        FLOAT\r\n  DECLARE @HRK_BORCBAKIYE      FLOAT\r\n  DECLARE @HRK_ALACAKBAKIYE    FLOAT\r\n  DECLARE @HRK_GENELTOP        FLOAT\r\n  DECLARE @HRK_CEKHARICIBAKIYE  FLOAT\r\n\r\n  DECLARE @HRK_VADETUTAR   FLOAT\r\n\r\n   /*S.tarih+cast(saat as datetime)) */\r\n\r\n IF @FIRMANO=0  \r\n  DECLARE CRS_HRK CURSOR FAST_FORWARD FOR\r\n     SELECT \r\n      @CARI_TIP,vc.kod,(vc.ad),vc.fatunvan,\r\n      vc.tel,vc.fax,vc.cep,vc.mail,\r\n      vc.muhonkod,VC.muhkod,\r\n      (select isnull(sum(h.borc-h.alacak),0) from carihrk as h with (nolock) where\r\n      (h.tarih+cast(h.saat as datetime)) >= @TARIH1 \r\n      and (h.tarih+cast(h.saat as datetime)) <= @TARIH2 and h.sil=0 and \r\n      h.cartip=@CARI_TIP\r\n      and h.carkod=vc.kod and h.islmtip!='VAD' and h.islmhrk !='OFV'),\r\n      (select isnull(sum( case\r\n       when fistip='FISVERSAT' THEN (toptut-isnull(isktop,0))\r\n       when fistip='FISALCSAT' THEN -1*(toptut-isnull(isktop,0))\r\n       else 0  end),0) from veresimas as vrs with (nolock) where\r\n      (vrs.tarih+cast(vrs.saat as datetime)) >= @TARIH1 \r\n      and (vrs.tarih+cast(vrs.saat as datetime)) <= @TARIH2 \r\n      and vrs.sil=0 and vrs.cartip=@CARI_TIP and isnull(vrs.Devir,0)=0\r\n      and vrs.carkod=vc.kod and vrs.aktip in ('BK','BL')),\r\n      (select isnull(sum(-1*(giren-cikan)),0) from cekkart \r\n      as c where c.sil=0 and c.drm in ('POR','TAK','KSN')\r\n      and (c.tarih+cast(c.saat as datetime)) >= @TARIH1 \r\n      and (c.tarih+cast(c.saat as datetime)) <= @TARIH2 and \r\n      ( (c.cartip=@CARI_TIP and c.carkod=vc.kod) or \r\n      (c.vercartip=@CARI_TIP and c.vercarkod=vc.kod) ) ),\r\n      \r\n      (select isnull(sum(h.borc),0) from carihrk as h with (nolock) where\r\n      (h.tarih+cast(h.saat as datetime)) >= @TARIH1 \r\n      and (h.tarih+cast(h.saat as datetime)) <= @TARIH2 and h.sil=0 and h.cartip=@CARI_TIP\r\n      and h.carkod=vc.kod and h.islmtip!='VAD' and h.islmhrk !='OFV'), /*BORC BAKIYE */\r\n      \r\n      (select isnull(sum(h.alacak),0) from carihrk as h with (nolock) where\r\n      (h.tarih+cast(h.saat as datetime)) >= @TARIH1 \r\n      and (h.tarih+cast(h.saat as datetime)) <= @TARIH2 and h.sil=0 and h.cartip=@CARI_TIP\r\n      and h.carkod=vc.kod)/*ALACAK BAKIYE */\r\n      \r\n      FROM Genel_Kart as vc with (nolock) where  vc.cartp=@CARI_TIP and\r\n      vc.kod in (select * from @EKSTRE_CARITEMP)\r\n\r\n    \r\n  IF @FIRMANO>0  \r\n  DECLARE CRS_HRK CURSOR FAST_FORWARD FOR\r\n     SELECT \r\n      @CARI_TIP,vc.kod,(vc.ad),vc.fatunvan,\r\n      vc.tel,vc.fax,vc.cep,vc.mail,\r\n      vc.muhonkod,VC.muhkod,\r\n      \r\n      (select isnull(sum(h.borc-h.alacak),0) from carihrk as h with (nolock) where\r\n      h.firmano in (0,@FIRMANO) \r\n      and (h.tarih+cast(h.saat as datetime)) >= @TARIH1 \r\n      and (h.tarih+cast(h.saat as datetime)) <= @TARIH2 and h.sil=0 and \r\n      h.cartip=@CARI_TIP\r\n      and h.carkod=vc.kod and h.islmtip!='VAD' and h.islmhrk !='OFV'),\r\n      \r\n      (select isnull(sum( case\r\n       when fistip='FISVERSAT' THEN (toptut-isnull(isktop,0))\r\n       when fistip='FISALCSAT' THEN -1*(toptut-isnull(isktop,0))\r\n       else 0  end),0) from veresimas as vrs with (nolock) where\r\n      vrs.firmano in (0,@FIRMANO) \r\n      and (vrs.tarih+cast(vrs.saat as datetime)) >= @TARIH1 \r\n      and (vrs.tarih+cast(vrs.saat as datetime)) <= @TARIH2 \r\n      and vrs.sil=0 and vrs.cartip=@CARI_TIP and isnull(vrs.Devir,0)=0\r\n      and vrs.carkod=vc.kod and vrs.aktip in ('BK','BL')),\r\n      \r\n      (select isnull(sum(-1*(giren-cikan)),0) from cekkart as c  with (nolock) \r\n      where c.firmano in (0,@FIRMANO) and\r\n      c.sil=0 and c.drm in ('POR','TAK','KSN')\r\n      and (c.tarih+cast(c.saat as datetime)) >= @TARIH1 \r\n      and (c.tarih+cast(c.saat as datetime)) <= @TARIH2 and \r\n      ( (c.cartip=@CARI_TIP and c.carkod=vc.kod) or \r\n      (c.vercartip=@CARI_TIP and c.vercarkod=vc.kod) ) ),\r\n      \r\n      (select isnull(sum(h.borc),0) from carihrk as h with (nolock) where\r\n      h.firmano in (0,@FIRMANO) \r\n      and (h.tarih+cast(h.saat as datetime)) >= @TARIH1 \r\n      and (h.tarih+cast(h.saat as datetime)) <= @TARIH2 \r\n      and h.sil=0 and h.cartip=@CARI_TIP\r\n      and h.carkod=vc.kod and h.islmtip!='VAD' and h.islmhrk !='OFV'), /*BORC BAKIYE */\r\n      \r\n      (select isnull(sum(h.alacak),0) from carihrk as h with (nolock) \r\n      where h.firmano in (0,@FIRMANO) \r\n      and (h.tarih+cast(h.saat as datetime)) >= @TARIH1 \r\n      and (h.tarih+cast(h.saat as datetime)) <= @TARIH2 and h.sil=0 and h.cartip=@CARI_TIP\r\n      and h.carkod=vc.kod)/*ALACAK BAKIYE */\r\n      \r\n      FROM Genel_Kart as vc with (nolock) where  \r\n      vc.cartp=@CARI_TIP and  vc.kod in (select * from @EKSTRE_CARITEMP)\r\n\r\n\r\n  OPEN CRS_HRK\r\n\r\n  FETCH NEXT FROM CRS_HRK INTO\r\n   @HRK_CARI_TIP,@HRK_CARI_KOD,@HRK_CARI_UNVAN,\r\n   @HRK_CARI_FATUNVAN,@HRK_CARI_TEL,@HRK_CARI_FAX,\r\n   @HRK_CARI_CEP,@HRK_CARI_EPOSTA,\r\n   @HRK_MUH_ON_KOD,@HRK_MUH_RES_KOD,\r\n   @HRK_CARIHESAP,\r\n   @HRK_CARIFIS,@HRK_CEKSENET,@HRK_BORCBAKIYE,@HRK_ALACAKBAKIYE\r\n\r\n  WHILE @@FETCH_STATUS = 0\r\n  BEGIN\r\n    \r\n    SET @HRK_VADETUTAR=0\r\n    \r\n    Select @HRK_VADETUTAR=v.CARI_VADETUTAR from UDF_CariFisVadeFark_Tarih (@HRK_CARI_KOD,@TARIH2) AS v\r\n            \r\n    set @HRK_CARIHESAP=@HRK_CARIHESAP+ISNULL(@HRK_VADETUTAR,0)\r\n   \r\n    set @HRK_BORCBAKIYE=@HRK_BORCBAKIYE+ISNULL(@HRK_VADETUTAR,0)\r\n        \r\n    SET @HRK_GENELTOP=@HRK_CARIHESAP+@HRK_CARIFIS\r\n\r\n    SET @HRK_CEKHARICIBAKIYE=@HRK_GENELTOP-@HRK_CEKSENET\r\n\r\n\r\n\r\n    /*IF @HRK_GENELTOP<>0 */\r\n    INSERT @EKSTRE_TEMP SELECT @FIRMANO,\r\n       @HRK_CARI_TIP,@HRK_CARI_KOD,@HRK_CARI_UNVAN,\r\n       @HRK_CARI_FATUNVAN,@HRK_CARI_TEL,@HRK_CARI_FAX,\r\n       @HRK_CARI_CEP,@HRK_CARI_EPOSTA,\r\n       @HRK_MUH_ON_KOD,@HRK_MUH_RES_KOD,\r\n       @HRK_CARIHESAP,\r\n       @HRK_CARIFIS,@HRK_CEKSENET,@HRK_BORCBAKIYE,@HRK_ALACAKBAKIYE,\r\n       @HRK_GENELTOP,@HRK_CEKHARICIBAKIYE\r\n       \r\n       \r\n       \r\n    FETCH NEXT FROM CRS_HRK INTO\r\n    @HRK_CARI_TIP,@HRK_CARI_KOD,@HRK_CARI_UNVAN,\r\n    @HRK_CARI_FATUNVAN,@HRK_CARI_TEL,@HRK_CARI_FAX,\r\n    @HRK_CARI_CEP,@HRK_CARI_EPOSTA,\r\n    @HRK_MUH_ON_KOD,@HRK_MUH_RES_KOD,\r\n    @HRK_CARIHESAP,\r\n    @HRK_CARIFIS,@HRK_CEKSENET,@HRK_BORCBAKIYE,@HRK_ALACAKBAKIYE\r\n  END\r\n\r\n  CLOSE CRS_HRK\r\n  DEALLOCATE CRS_HRK\r\n\r\n  /*---------------------------------------------------------------------------- */\r\n\r\n  INSERT @TB_CARI_EKSTRE\r\n    SELECT * FROM @EKSTRE_TEMP \r\n\r\n  RETURN\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_CARI_DURAGAN",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_CARI_DURAGAN",
    "definition": "CREATE FUNCTION UDF_CARI_DURAGAN (@CARI_TIP VARCHAR(20),\r\n@CARI_KOD VARCHAR(20),\r\n@TARIH1 DATETIME, \r\n@TARIH2 DATETIME)\r\nRETURNS\r\n  @TB_CARI_EKSTRE TABLE (\r\n    CARI_TIP    VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    CARI_KOD    VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    CARI_UNVAN  VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    SONHRKTARIH    DATETIME,\r\n    HRKSAY       INT,\r\n    SONFISTARIH    DATETIME,\r\n    FISSAY       INT,\r\n    SONBAKIYE       FLOAT)\r\nAS\r\nBEGIN\r\n  DECLARE @EKSTRE_TEMP TABLE (\r\n    CARI_TIP    VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    CARI_KOD    VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    CARI_UNVAN  VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    SONHRKTARIH    DATETIME,\r\n    HRKSAY       INT,\r\n    SONFISTARIH    DATETIME,\r\n    FISSAY       INT,\r\n    SONBAKIYE       FLOAT )\r\n\r\n  DECLARE @HRK_CARI_TIP    VARCHAR(20)\r\n  DECLARE @HRK_CARI_KOD    VARCHAR(20)\r\n  DECLARE @HRK_CARI_UNVAN  VARCHAR(50)\r\n  DECLARE @HRK_HRKSAY       INT\r\n  DECLARE @HRK_FISSAY    INT\r\n  DECLARE @HRK_SONHRKTARIH    DATETIME\r\n  DECLARE @HRK_SONFISTARIH    DATETIME\r\n  DECLARE @HRK_SONBAKIYE      FLOAT\r\n\r\nDECLARE @hsay    INT\r\nDECLARE @fsay    INT\r\n\r\n   DECLARE CRS_HRK CURSOR FAST_FORWARD FOR\r\n   SELECT\r\n    'carikart',k.kod,k.unvan,(fisbak+carbak) FROM carikart as k where k.sil=0\r\n\r\n  OPEN CRS_HRK\r\n\r\n  FETCH NEXT FROM CRS_HRK INTO\r\n   @HRK_CARI_TIP,@HRK_CARI_KOD,@HRK_CARI_UNVAN,@HRK_SONBAKIYE\r\n\r\n  WHILE @@FETCH_STATUS = 0\r\n  BEGIN\r\n  \r\n  set @hsay=0\r\n  set @fsay=0\r\n  \r\n  SELECT @hsay=count(carkod) FROM carihrk as h with (nolock) \r\n  where h.carkod=@HRK_CARI_KOD\r\n  and h.cartip=@HRK_CARI_TIP and h.sil=0 AND\r\n  (h.tarih+cast(h.saat as datetime)) >= @TARIH1 \r\n  and (h.tarih+cast(h.saat as datetime)) <= @TARIH2 group by h.carkod,h.cartip\r\n  \r\n   if @hsay=0\r\n   SELECT @HRK_SONHRKTARIH=MAX(h.tarih) FROM carihrk as h  with (nolock) \r\n   where h.carkod=@HRK_CARI_KOD\r\n   and h.cartip=@HRK_CARI_TIP and h.sil=0 AND\r\n   (h.tarih+cast(h.saat as datetime)) < @TARIH1 \r\n   group by h.carkod,h.cartip\r\n\r\n\r\n     SELECT @fsay=count(carkod) FROM veresimas as h with (nolock)  \r\n     where h.carkod=@HRK_CARI_KOD\r\n     and h.cartip=@HRK_CARI_TIP and h.sil=0 AND\r\n     (h.tarih+cast(h.saat as datetime)) >= @TARIH1 \r\n     and (h.tarih+cast(h.saat as datetime)) <= @TARIH2 \r\n     group by h.carkod,h.cartip\r\n\r\n      if @fsay=0\r\n      SELECT @HRK_SONFISTARIH=MAX(h.tarih) FROM veresimas as h with (nolock) \r\n      where h.carkod=@HRK_CARI_KOD\r\n      and h.cartip=@HRK_CARI_TIP and h.sil=0 AND\r\n      (h.tarih+cast(h.saat as datetime)) < @TARIH1 group by h.carkod,h.cartip\r\n      \r\n      \r\n\r\n      INSERT @EKSTRE_TEMP (CARI_TIP,CARI_KOD,CARI_UNVAN,SONHRKTARIH,HRKSAY,SONFISTARIH,FISSAY,SONBAKIYE)\r\n      values (@HRK_CARI_TIP,@HRK_CARI_KOD,@HRK_CARI_UNVAN,@HRK_SONHRKTARIH,@hsay,\r\n      @HRK_SONFISTARIH,@fsay,@HRK_SONBAKIYE)\r\n\r\n\r\n\r\n\r\n    FETCH NEXT FROM CRS_HRK INTO\r\n    @HRK_CARI_TIP,@HRK_CARI_KOD,@HRK_CARI_UNVAN,@HRK_SONBAKIYE\r\n  END\r\n\r\n  CLOSE CRS_HRK\r\n  DEALLOCATE CRS_HRK\r\n\r\n  /*---------------------------------------------------------------------------- */\r\n\r\n  INSERT @TB_CARI_EKSTRE\r\n    SELECT * FROM @EKSTRE_TEMP\r\n\r\n  RETURN\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_CARI_ETIKET",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_CARI_ETIKET",
    "definition": "CREATE FUNCTION [dbo].UDF_CARI_ETIKET (\r\n@firmano int,\r\n@tip   varchar(20),\r\n@carin VARCHAR(8000),\r\n@bassayi int,\r\n@satirsayi int)\r\nRETURNS\r\n  @TB_ADRES_ETIKET TABLE (\r\n    CARI_KOD        VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    CARI_UNVAN      VARCHAR(200) COLLATE Turkish_CI_AS,\r\n    ADRES1          VARCHAR(100) COLLATE Turkish_CI_AS,\r\n    ADRES2          VARCHAR(100) COLLATE Turkish_CI_AS,\r\n    IL              VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    ILCE            VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    TEL\t\t\t\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n    CEP\t\t\t\tVARCHAR(50) COLLATE Turkish_CI_AS)\r\nAS\r\nBEGIN\r\n\r\n  DECLARE @HRK_CARI_KOD    VARCHAR(30)\r\n  DECLARE @HRK_CARI_UNVAN  VARCHAR(200)\r\n  DECLARE @HRK_ADRES1      VARCHAR(100)\r\n  DECLARE @HRK_ADRES2      VARCHAR(100)\r\n  DECLARE @HRK_IL          VARCHAR(50)\r\n  DECLARE @HRK_ILCE          VARCHAR(50)\r\n  DECLARE @i               INT\r\n  DECLARE @HRK_ONCARI_KOD  VARCHAR(30)\r\n  DECLARE @HRK_TEL          VARCHAR(50)\r\n  DECLARE @HRK_CEP          VARCHAR(50)\r\n\r\n\r\n   SET @HRK_ONCARI_KOD=''\r\n\r\n   DECLARE ADRES_HRK CURSOR FAST_FORWARD FOR\r\n    SELECT\r\n    k.kod,k.unvan,k.adres,k.adres2,k.evil,k.evilce,K.tel,k.cep\r\n    from carikart as k\r\n    where k.sil=0 and k.adres <>''\r\n    and k.kod IN (SELECT * FROM dbo.CsvToSTR(@carin))\r\n    order by k.kod\r\n\r\n    OPEN ADRES_HRK\r\n    FETCH NEXT FROM ADRES_HRK INTO\r\n    @HRK_CARI_KOD,@HRK_CARI_UNVAN,@HRK_ADRES1,@HRK_ADRES2,\r\n    @HRK_IL,@HRK_ILCE,@HRK_TEL,@HRK_CEP\r\n    WHILE @@FETCH_STATUS = 0\r\n    BEGIN\r\n    IF @HRK_ONCARI_KOD<>@HRK_CARI_KOD\r\n    begin\r\n    set @HRK_ONCARI_KOD=@HRK_CARI_KOD\r\n    set @i=1\r\n    end\r\n\r\n     while @i<=@satirsayi\r\n     begin\r\n     INSERT @TB_ADRES_ETIKET\r\n      SELECT\r\n        @HRK_CARI_KOD,@HRK_CARI_UNVAN,@HRK_ADRES1,@HRK_ADRES2,\r\n       @HRK_IL,@HRK_ILCE,@HRK_TEL,@HRK_CEP\r\n      set @i=@i+1\r\n      end\r\n\r\n     FETCH NEXT FROM ADRES_HRK INTO\r\n       @HRK_CARI_KOD,@HRK_CARI_UNVAN,@HRK_ADRES1,@HRK_ADRES2,\r\n     @HRK_IL,@HRK_ILCE,@HRK_TEL,@HRK_CEP\r\n     END\r\n\r\n    CLOSE ADRES_HRK\r\n    DEALLOCATE ADRES_HRK\r\n\r\n\r\n \r\n\r\n  RETURN\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_CARI_FIS_STOK_GRP",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_CARI_FIS_STOK_GRP",
    "definition": "CREATE FUNCTION [dbo].UDF_CARI_FIS_STOK_GRP (\r\n@FIRMANO\t\tINT,\r\n@CARI_TIP \t\tVARCHAR(20),\r\n@CARIKODIN \t\tVARCHAR(8000),\r\n@TARIH1 DATETIME,\r\n@TARIH2 DATETIME)\r\nRETURNS\r\n    @TB_STOKLITRE_EKSTRE TABLE (\r\n    CARI_TIP    \tVARCHAR(20)  COLLATE Turkish_CI_AS,\r\n    CARI_KOD    \tVARCHAR(50)  COLLATE Turkish_CI_AS,\r\n    CARI_UNVAN     \tVARCHAR(150)  COLLATE Turkish_CI_AS,\r\n    STOK_GRUP_ID   \tINT,\r\n    STOK_GRUP_AD\tVARCHAR(50)  COLLATE Turkish_CI_AS,\r\n    MIKTAR\t\t\tFLOAT,\r\n    TUTAR\t\t\tFLOAT)\r\nAS\r\nBEGIN\r\n\r\n    DECLARE @EKSTRE_TEMP TABLE (\r\n    STOK_GRUP_ID   \tINT,\r\n    STOK_GRUP_AD\tVARCHAR(50)  COLLATE Turkish_CI_AS,\r\n    CARI_TIP    \tVARCHAR(20)  COLLATE Turkish_CI_AS,\r\n    CARI_KOD    \tVARCHAR(50)  COLLATE Turkish_CI_AS,\r\n    CARI_UNVAN     \tVARCHAR(150)  COLLATE Turkish_CI_AS,\r\n    STOK_TIP    \tVARCHAR(20)    COLLATE Turkish_CI_AS,\r\n    STOK_KOD    \tVARCHAR(50)    COLLATE Turkish_CI_AS,\r\n    STOK_AD     \tVARCHAR(100)    COLLATE Turkish_CI_AS,\r\n    MIKTAR\t\t\tFLOAT,\r\n    TUTAR\t\t\tFLOAT)\r\n\r\n\r\n\r\n\r\n   if @CARIKODIN<>''\r\n    insert into @EKSTRE_TEMP (CARI_TIP,CARI_KOD,\r\n    STOK_TIP,STOK_KOD,MIKTAR,TUTAR)\r\n    SELECT M.cartip,m.carkod,h.stktip,h.stkod,\r\n    sum(mik),sum(h.brmfiy*h.mik) from \r\n    veresimas as m inner join veresihrk as h\r\n    on h.verid=m.verid and h.sil=0 and m.sil=0\r\n    where m.fistip='FISVERSAT'\r\n    and m.cartip=@CARI_TIP \r\n    and m.carkod in (select * from CsvToSTR(@CARIKODIN))\r\n    and m.tarih>=@TARIH1 and m.tarih<=@TARIH2 \r\n    group by m.cartip,m.carkod,h.stktip,h.stkod\r\n\r\n   if @CARIKODIN=''\r\n    insert into @EKSTRE_TEMP (CARI_TIP,CARI_KOD,\r\n    STOK_TIP,STOK_KOD,MIKTAR,TUTAR)\r\n    SELECT M.cartip,m.carkod,h.stktip,h.stkod,\r\n    sum(mik),sum(h.brmfiy*h.mik) from \r\n    veresimas as m inner join veresihrk as h\r\n    on h.verid=m.verid and h.sil=0 and m.sil=0\r\n    where m.fistip='FISVERSAT'\r\n    and m.cartip=@CARI_TIP \r\n    and m.tarih>=@TARIH1 and m.tarih<=@TARIH2 \r\n    group by m.cartip,m.carkod,h.stktip,h.stkod\r\n\r\n\r\n\r\n   update @EKSTRE_TEMP set STOK_GRUP_AD='GELİR-GİDER'\r\n\r\n    update @EKSTRE_TEMP set STOK_GRUP_ID=dt.grp1 \r\n    from @EKSTRE_TEMP as t join \r\n    (select tip,kod,grp1 from stokkart ) dt \r\n    on dt.tip=t.STOK_TIP and dt.kod=t.STOK_KOD \r\n\r\n    update @EKSTRE_TEMP set STOK_GRUP_AD=dt.AD\r\n    from @EKSTRE_TEMP as t join \r\n    (select id,ad from GRUP ) dt \r\n    on dt.id=t.STOK_GRUP_ID \r\n\r\n    update @EKSTRE_TEMP set CARI_UNVAN=dt.ad \r\n    from @EKSTRE_TEMP as t join \r\n    (select cartp,kod,ad from Genel_Kart ) dt \r\n    on dt.cartp=t.CARI_TIP and dt.kod=t.CARI_KOD \r\n\r\n\r\n\r\n    insert into @TB_STOKLITRE_EKSTRE\r\n    (CARI_TIP,CARI_KOD,CARI_UNVAN,\r\n    STOK_GRUP_ID,STOK_GRUP_AD,MIKTAR,TUTAR)\r\n    SELECT CARI_TIP,CARI_KOD,CARI_UNVAN,\r\n    STOK_GRUP_ID,STOK_GRUP_AD,MIKTAR,TUTAR \r\n    from @EKSTRE_TEMP \r\n\r\n\r\n\r\n  RETURN\r\n\r\n  \r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_CARI_HRK",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_CARI_HRK",
    "definition": "CREATE FUNCTION UDF_CARI_HRK (\r\n@firmano\t\tint,\r\n@HRK_KRITER     VARCHAR(4000),\r\n@CARI_TIP VARCHAR(20),\r\n@CARI_KOD VARCHAR(30),\r\n@TARIH1 DATETIME,\r\n@TARIH2 DATETIME,\r\n@SAAT1 VARCHAR(8),\r\n@SAAT2 VARCHAR(8),\r\n@ORDER  VARCHAR(20),\r\n@DEVIR          INT,\r\n@AVANS          INT)\r\nRETURNS\r\n  @TB_CARI_EKSTRE TABLE (\r\n    Firmano     int,\r\n    CARI_TIP    VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    CARI_KOD    VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    CARI_UNVAN  VARCHAR(150) COLLATE Turkish_CI_AS,\r\n    TARIH       DATETIME,\r\n    SAAT        VARCHAR(8)  COLLATE Turkish_CI_AS,\r\n    BELGENO     VARCHAR(50)  COLLATE Turkish_CI_AS,\r\n    PLAKA       VARCHAR(50)  COLLATE Turkish_CI_AS,\r\n    ACIKLAMA    VARCHAR(200) COLLATE Turkish_CI_AS,\r\n    ISLTIPAD    VARCHAR(50)  COLLATE Turkish_CI_AS,\r\n    ISLHRKAD    VARCHAR(50)  COLLATE Turkish_CI_AS,\r\n    YERTIP      VARCHAR(30)  COLLATE Turkish_CI_AS,\r\n    YERAD       VARCHAR(50)  COLLATE Turkish_CI_AS,\r\n    KULAD       VARCHAR(70)  COLLATE Turkish_CI_AS,\r\n    ISLTIP      VARCHAR(50)  COLLATE Turkish_CI_AS,\r\n    ISLHRK      VARCHAR(50)  COLLATE Turkish_CI_AS,\r\n    KRS_TIP     VARCHAR(30)  COLLATE Turkish_CI_AS,\r\n    KRS_KOD     VARCHAR(50)  COLLATE Turkish_CI_AS,\r\n    KRS_UNVAN   VARCHAR(150)  COLLATE Turkish_CI_AS,\r\n    VADETAR     DATETIME,\r\n    VARNO       FLOAT,\r\n    VAROK\t\tINT,\r\n    RAPID\t\tINT,\r\n    HRKID       FLOAT,\r\n    MASID       FLOAT,\r\n    BORC        FLOAT,\r\n    ALACAK      FLOAT,\r\n    BAKIYE      FLOAT,\r\n    FAT_ID      INT,\r\n    FIS_ID      INT,\r\n    IRS_ID      INT,\r\n    MARSAT_ID\tINT,\r\n    SAYIM_ID    INT,\r\n    REMOTE_ID\tINT,\r\n    KASAHRK_ID  INT,\r\n    POSHRK_ID   INT,\r\n    BANKAHRK_ID INT,\r\n    CEK_ID\t\tINT,\r\n    ISTHRK_ID   INT,\r\n    DEVIR\t\tINT)\r\nAS\r\nBEGIN\r\n\r\n\r\n  DECLARE @KUM_BAKIYE      FLOAT\r\n  DECLARE @HRK_CARI_TIP    VARCHAR(30)\r\n  DECLARE @HRK_CARI_KOD    VARCHAR(30)\r\n  DECLARE @HRK_CARI_UNVAN  VARCHAR(150)\r\n  \r\n  DECLARE @ONDA_HANE       INT\r\n\r\n  SET @KUM_BAKIYE = 0\r\n  \r\n  \r\n  set @TARIH1=(@TARIH1+cast(@SAAT1 as datetime)) \r\n  set @TARIH2=(@TARIH2+cast(@SAAT2 as datetime)) \r\n  \r\n  select @ONDA_HANE=Para_Ondalik from sistemtanim\r\n\r\n\r\n select @HRK_CARI_UNVAN=gk.ad from Genel_Kart as gk\r\n  where kod=@CARI_KOD and gk.cartp=@CARI_TIP\r\n\r\n  /* Devir atanıyor */\r\n  \r\n \r\n    IF @DEVIR=1/*------------------- */\r\n    BEGIN\r\n      \r\n      IF @ORDER='tarih' and @firmano=0\r\n      begin\r\n        INSERT @TB_CARI_EKSTRE\r\n       (Firmano,CARI_TIP,CARI_KOD,\r\n        CARI_UNVAN,TARIH,SAAT,BELGENO,\r\n        PLAKA,ACIKLAMA,\r\n        ISLTIPAD,ISLHRKAD,YERTIP,YERAD,\r\n        KULAD,ISLTIP,ISLHRK,\r\n        KRS_TIP,KRS_KOD,KRS_UNVAN,\r\n        VADETAR,VARNO,VAROK,RAPID,HRKID,\r\n        MASID,BORC,ALACAK,BAKIYE,\r\n        FAT_ID,FIS_ID,IRS_ID,\r\n        MARSAT_ID,SAYIM_ID,REMOTE_ID,\r\n        KASAHRK_ID,POSHRK_ID,BANKAHRK_ID,\r\n        CEK_ID,ISTHRK_ID,DEVIR)\r\n        SELECT\r\n          @firmano,    \r\n          @CARI_TIP,/* CARI TIP */\r\n          @CARI_KOD, /*CARI_KOD  */\r\n          @HRK_CARI_UNVAN, /* CARI_UNVAN */\r\n          max(tarih),\r\n          @SAAT1,\r\n          'DEVİR', /* BELGE NO */\r\n          '', /*PLAKA */\r\n          convert(VARCHAR(30),max(tarih),104)+' DEVİR BAKİYESİ', /* AÇIKLAMA */\r\n          '-','-','-','-','-','-','-',\r\n          '-','-','-',\r\n          max(vadetar),0,0,0,0,0,\r\n          ISNULL(SUM(borc),0), /* BORC */\r\n          ISNULL(SUM(alacak),0), /* ALACAK */\r\n          ISNULL(SUM(round((borc-alacak),@ONDA_HANE)),0), /* BAKIYE */\r\n          0,0,0,\r\n          0,0,0,\r\n          0,0,0,\r\n          0,0,1\r\n        FROM carihrk as h  with (nolock)\r\n        WHERE cartip=@CARI_TIP and carkod=@CARI_KOD\r\n         and sil=0 and isnull(CariAvans,0)=@AVANS \r\n         AND (h.tarih+cast(h.saat as datetime)) < @TARIH1\r\n       end\r\n       \r\n       \r\n      IF @ORDER='tarih' and @firmano>0\r\n      begin\r\n        INSERT @TB_CARI_EKSTRE\r\n       (Firmano,CARI_TIP,CARI_KOD,\r\n        CARI_UNVAN,TARIH,SAAT,BELGENO,\r\n        PLAKA,ACIKLAMA,\r\n        ISLTIPAD,ISLHRKAD,YERTIP,YERAD,\r\n        KULAD,ISLTIP,ISLHRK,\r\n        KRS_TIP,KRS_KOD,KRS_UNVAN,\r\n        VADETAR,VARNO,VAROK,RAPID,HRKID,\r\n        MASID,BORC,ALACAK,BAKIYE,\r\n        FAT_ID,FIS_ID,IRS_ID,\r\n        MARSAT_ID,SAYIM_ID,REMOTE_ID,\r\n        KASAHRK_ID,POSHRK_ID,BANKAHRK_ID,\r\n        CEK_ID,ISTHRK_ID,DEVIR)\r\n        SELECT\r\n          @firmano,    \r\n          @CARI_TIP,/* CARI TIP */\r\n          @CARI_KOD, /*CARI_KOD  */\r\n          @HRK_CARI_UNVAN, /* CARI_UNVAN */\r\n          max(tarih),\r\n          @SAAT1,\r\n          'DEVİR', /* BELGE NO */\r\n          '', /*PLAKA */\r\n          convert(VARCHAR(30),max(tarih),104)+' DEVİR BAKİYESİ', /* AÇIKLAMA */\r\n          '-','-','-','-','-','-','-',\r\n          '-','-','-',\r\n          max(vadetar),0,0,0,0,0,\r\n          ISNULL(SUM(borc),0), /* BORC */\r\n          ISNULL(SUM(alacak),0), /* ALACAK */\r\n          ISNULL(SUM(round((borc-alacak),@ONDA_HANE)),0), /* BAKIYE */\r\n          0,0,0,\r\n          0,0,0,\r\n          0,0,0,\r\n          0,0,1\r\n        FROM carihrk as h with (nolock)\r\n        WHERE cartip=@CARI_TIP and carkod=@CARI_KOD\r\n         and Firmano in (0,@firmano)\r\n         and sil=0 and isnull(CariAvans,0)=@AVANS \r\n         AND (h.tarih+cast(h.saat as datetime)) < @TARIH1\r\n       end \r\n       \r\n       \r\n       \r\n\r\n      IF @ORDER='vadetar' and @firmano=0\r\n      begin\r\n        INSERT @TB_CARI_EKSTRE\r\n        (Firmano,CARI_TIP,CARI_KOD,\r\n        CARI_UNVAN,TARIH,SAAT,BELGENO,\r\n        PLAKA,ACIKLAMA,\r\n        ISLTIPAD,ISLHRKAD,YERTIP,YERAD,\r\n        KULAD,ISLTIP,ISLHRK,\r\n        KRS_TIP,KRS_KOD,KRS_UNVAN,\r\n        VADETAR,VARNO,VAROK,RAPID,HRKID,\r\n        MASID,BORC,ALACAK,BAKIYE,\r\n        FAT_ID,FIS_ID,IRS_ID,\r\n        MARSAT_ID,SAYIM_ID,REMOTE_ID,\r\n        KASAHRK_ID,POSHRK_ID,BANKAHRK_ID,\r\n        CEK_ID,ISTHRK_ID,DEVIR)\r\n         SELECT \r\n          @firmano,\r\n          @CARI_TIP,/* CARI TIP */\r\n          @CARI_KOD, /*CARI_KOD  */\r\n          @HRK_CARI_UNVAN, /* CARI_UNVAN */\r\n          max(tarih),\r\n          @SAAT1,\r\n          'DEVİR', /* BELGE NO */\r\n          '', /*PLAKA */\r\n          CONVERT(VARCHAR(10), max(tarih), 104) +' DEVİR BAKİYESİ', /* AÇIKLAMA */\r\n          '-','-','-','-','-','-','-',\r\n          '-','-','-',max(vadetar),0,0,0,0,0,\r\n          ISNULL(SUM(borc),0), /* BORC */\r\n          ISNULL(SUM(alacak),0), /* ALACAK */\r\n          ISNULL(SUM(round((borc-alacak),@ONDA_HANE)),0), /* BAKIYE */\r\n          0,0,0,\r\n          0,0,0,\r\n          0,0,0,\r\n          0,0,1\r\n        FROM carihrk as h  with (nolock)\r\n        WHERE cartip=@CARI_TIP and carkod=@CARI_KOD\r\n         and sil=0 and isnull(CariAvans,0)=@AVANS \r\n         AND vadetar < @TARIH1\r\n     \r\n     end\r\n     \r\n     \r\n      IF @ORDER='vadetar' and @firmano>0\r\n      begin\r\n        INSERT @TB_CARI_EKSTRE\r\n        (Firmano,CARI_TIP,CARI_KOD,\r\n        CARI_UNVAN,TARIH,SAAT,BELGENO,\r\n        PLAKA,ACIKLAMA,\r\n        ISLTIPAD,ISLHRKAD,YERTIP,YERAD,\r\n        KULAD,ISLTIP,ISLHRK,\r\n        KRS_TIP,KRS_KOD,KRS_UNVAN,\r\n        VADETAR,VARNO,VAROK,RAPID,HRKID,\r\n        MASID,BORC,ALACAK,BAKIYE,\r\n        FAT_ID,FIS_ID,IRS_ID,\r\n        MARSAT_ID,SAYIM_ID,REMOTE_ID,\r\n        KASAHRK_ID,POSHRK_ID,BANKAHRK_ID,\r\n        CEK_ID,ISTHRK_ID,DEVIR)\r\n         SELECT \r\n          @firmano,\r\n          @CARI_TIP,/* CARI TIP */\r\n          @CARI_KOD, /*CARI_KOD  */\r\n          @HRK_CARI_UNVAN, /* CARI_UNVAN */\r\n          max(tarih),\r\n          @SAAT1,\r\n          'DEVİR', /* BELGE NO */\r\n          '', /*PLAKA */\r\n          CONVERT(VARCHAR(10), max(tarih), 104) +' DEVİR BAKİYESİ', /* AÇIKLAMA */\r\n          '-','-','-','-','-','-','-',\r\n          '-','-','-',max(vadetar),0,0,0,0,0,\r\n          ISNULL(SUM(borc),0), /* BORC */\r\n          ISNULL(SUM(alacak),0), /* ALACAK */\r\n          ISNULL(SUM(round((borc-alacak),@ONDA_HANE)),0), /* BAKIYE */\r\n          0,0,0,\r\n          0,0,0,\r\n          0,0,0,\r\n          0,0,1\r\n        FROM carihrk with (nolock)\r\n        WHERE cartip=@CARI_TIP and carkod=@CARI_KOD\r\n         and Firmano in (0,@firmano)\r\n         and sil=0 and isnull(CariAvans,0)=@AVANS AND vadetar < @TARIH1\r\n     \r\n     end\r\n     \r\n     \r\n     \r\n     \r\n   \r\n     SELECT @KUM_BAKIYE = isnull(BAKIYE,0) FROM @TB_CARI_EKSTRE\r\n\r\n     if @KUM_BAKIYE=0\r\n      delete from @TB_CARI_EKSTRE \r\n  \r\n   \r\n   END/*-------Devir */\r\n\r\n\r\n  IF @ORDER='tarih' and @firmano=0\r\n  begin\r\n   INSERT @TB_CARI_EKSTRE\r\n   (Firmano,CARI_TIP,CARI_KOD,\r\n    CARI_UNVAN,TARIH,SAAT,BELGENO,\r\n    PLAKA,ACIKLAMA,\r\n    ISLTIPAD,ISLHRKAD,YERTIP,YERAD,\r\n    KULAD,ISLTIP,ISLHRK,\r\n    KRS_TIP,KRS_KOD,KRS_UNVAN,\r\n    VADETAR,VARNO,VAROK,RAPID,HRKID,\r\n    MASID,BORC,ALACAK,BAKIYE,\r\n    FAT_ID,FIS_ID,IRS_ID,\r\n    MARSAT_ID,SAYIM_ID,REMOTE_ID,\r\n    KASAHRK_ID,POSHRK_ID,BANKAHRK_ID,\r\n    CEK_ID,ISTHRK_ID,DEVIR)\r\n    SELECT\r\n      h.firmano,\r\n      @CARI_TIP,@CARI_KOD,@HRK_CARI_UNVAN,\r\n      tarih,saat,belno,\r\n      plaka, /*PLAKA */\r\n      ack, /* AÇIKLAMA, */\r\n      islmtipad,islmhrkad,yertip,yerad,\r\n      olususer,islmtip,islmhrk,\r\n      Karsi_KartTip,Karsi_KartKod,'',\r\n      vadetar,varno,\r\n      varok,belrap_id,\r\n      carhrkid,masterid,\r\n      round(borc,@ONDA_HANE),\r\n      round(alacak,@ONDA_HANE),\r\n      ROUND(ISNULL(borc-alacak,0),@ONDA_HANE) AS BAKIYE,\r\n      h.fatid,h.fisid,h.irsid,\r\n      h.marsatid,h.say_id,h.remote_id,\r\n      h.kasahrk_id,h.Poshrk_id,h.Bankahrk_id,\r\n      h.Cek_id,h.isthrk_id,0\r\n    FROM carihrk as h with (nolock)\r\n    WHERE cartip=@CARI_TIP and carkod=@CARI_KOD\r\n     and sil=0 and isnull(CariAvans,0)=@AVANS\r\n     and islmtip+'_'+islmhrk not in \r\n     (select * FROM CsvToSTR(@HRK_KRITER))\r\n     AND ( (h.tarih+cast(h.saat as datetime))  >= @TARIH1 )\r\n     AND ( (h.tarih+cast(h.saat as datetime)) <= @TARIH2)\r\n    ORDER BY tarih,saat\r\n   end\r\n   \r\n   \r\n  IF @ORDER='tarih' and @firmano>0\r\n  begin\r\n   INSERT @TB_CARI_EKSTRE\r\n   (Firmano,CARI_TIP,CARI_KOD,\r\n    CARI_UNVAN,TARIH,SAAT,BELGENO,\r\n    PLAKA,ACIKLAMA,\r\n    ISLTIPAD,ISLHRKAD,YERTIP,YERAD,\r\n    KULAD,ISLTIP,ISLHRK,\r\n    KRS_TIP,KRS_KOD,KRS_UNVAN,\r\n    VADETAR,VARNO,VAROK,RAPID,HRKID,\r\n    MASID,BORC,ALACAK,BAKIYE,\r\n    FAT_ID,FIS_ID,IRS_ID,\r\n    MARSAT_ID,SAYIM_ID,REMOTE_ID,\r\n    KASAHRK_ID,POSHRK_ID,BANKAHRK_ID,\r\n    CEK_ID,ISTHRK_ID,DEVIR)\r\n    SELECT\r\n      h.firmano,\r\n      @CARI_TIP,@CARI_KOD,@HRK_CARI_UNVAN,\r\n      tarih,saat,belno,\r\n      plaka, /*PLAKA */\r\n      ack, /* AÇIKLAMA, */\r\n      islmtipad,islmhrkad,yertip,yerad,\r\n      olususer,islmtip,islmhrk,\r\n      Karsi_KartTip,Karsi_KartKod,'',\r\n      vadetar,varno,\r\n      varok,belrap_id,\r\n      carhrkid,masterid,\r\n      round(borc,@ONDA_HANE),\r\n      round(alacak,@ONDA_HANE),\r\n      ROUND(ISNULL(borc-alacak,0),@ONDA_HANE) AS BAKIYE,\r\n      h.fatid,h.fisid,h.irsid,\r\n      h.marsatid,h.say_id,h.remote_id,\r\n      h.kasahrk_id,h.Poshrk_id,h.Bankahrk_id,\r\n      h.Cek_id,h.isthrk_id,0\r\n    FROM carihrk as h  with (nolock)\r\n    WHERE cartip=@CARI_TIP and carkod=@CARI_KOD\r\n     and sil=0 and isnull(CariAvans,0)=@AVANS \r\n     and Firmano in (0,@firmano)\r\n     and islmtip+'_'+islmhrk not in \r\n     (select * FROM CsvToSTR(@HRK_KRITER))\r\n     AND ( (h.tarih+cast(h.saat as datetime)) >= @TARIH1 )\r\n     AND ( (h.tarih+cast(h.saat as datetime)) <= @TARIH2)\r\n    ORDER BY tarih,saat\r\n   end\r\n\r\n   \r\n   \r\n\r\n  IF @ORDER='vadetar' and @Firmano=0\r\n  begin\r\n   INSERT @TB_CARI_EKSTRE\r\n   (Firmano,CARI_TIP,CARI_KOD,\r\n    CARI_UNVAN,TARIH,SAAT,BELGENO,\r\n    PLAKA,ACIKLAMA,\r\n    ISLTIPAD,ISLHRKAD,YERTIP,YERAD,\r\n    KULAD,ISLTIP,ISLHRK,\r\n    KRS_TIP,KRS_KOD,KRS_UNVAN,\r\n    VADETAR,\r\n    VARNO,VAROK,RAPID,HRKID,\r\n    MASID,BORC,ALACAK,BAKIYE,\r\n    FAT_ID,FIS_ID,IRS_ID,\r\n    MARSAT_ID,SAYIM_ID,REMOTE_ID,\r\n    KASAHRK_ID,POSHRK_ID,BANKAHRK_ID,\r\n    CEK_ID,ISTHRK_ID,DEVIR)\r\n    SELECT\r\n      h.firmano,\r\n      @CARI_TIP,@CARI_KOD,@HRK_CARI_UNVAN,\r\n       tarih,saat,belno,\r\n      plaka, /*PLAKA */\r\n      ack, /* AÇIKLAMA, */\r\n      islmtipad,islmhrkad,yertip,yerad,olususer,islmtip,islmhrk,\r\n      Karsi_KartTip,Karsi_KartKod,'',\r\n      vadetar,varno,varok,belrap_id,carhrkid,masterid,\r\n      round(borc,@ONDA_HANE),\r\n      round(alacak,@ONDA_HANE),\r\n      ROUND(ISNULL(borc-alacak,0),@ONDA_HANE) AS BAKIYE,\r\n      h.fatid,h.fisid,h.irsid,\r\n      h.marsatid,h.say_id,h.remote_id,\r\n      h.kasahrk_id,h.Poshrk_id,h.Bankahrk_id,\r\n      h.Cek_id,h.isthrk_id,0\r\n    FROM carihrk as h with (nolock)\r\n    WHERE cartip=@CARI_TIP and carkod=@CARI_KOD\r\n     and sil=0 and isnull(CariAvans,0)=@AVANS\r\n     and islmtip+'_'+islmhrk not in \r\n     (select * FROM CsvToSTR(@HRK_KRITER))\r\n     AND (vadetar >= @TARIH1)\r\n     AND (vadetar <= @TARIH2)\r\n    ORDER BY vadetar,saat\r\n   end\r\n\r\n\r\n\r\n  IF @ORDER='vadetar' and @Firmano>0\r\n  begin\r\n   INSERT @TB_CARI_EKSTRE\r\n   (Firmano,CARI_TIP,CARI_KOD,\r\n    CARI_UNVAN,TARIH,SAAT,BELGENO,\r\n    PLAKA,ACIKLAMA,\r\n    ISLTIPAD,ISLHRKAD,YERTIP,YERAD,\r\n    KULAD,ISLTIP,ISLHRK,\r\n    KRS_TIP,KRS_KOD,KRS_UNVAN,\r\n    VADETAR,\r\n    VARNO,VAROK,RAPID,HRKID,\r\n    MASID,BORC,ALACAK,BAKIYE,\r\n    FAT_ID,FIS_ID,IRS_ID,\r\n    MARSAT_ID,SAYIM_ID,REMOTE_ID,\r\n    KASAHRK_ID,POSHRK_ID,BANKAHRK_ID,\r\n    CEK_ID,ISTHRK_ID,DEVIR)\r\n    SELECT\r\n      h.firmano,\r\n      @CARI_TIP,@CARI_KOD,@HRK_CARI_UNVAN,\r\n       tarih,saat,belno,\r\n      plaka, /*PLAKA */\r\n      ack, /* AÇIKLAMA, */\r\n      islmtipad,islmhrkad,yertip,yerad,olususer,islmtip,islmhrk,\r\n      Karsi_KartTip,Karsi_KartKod,'',\r\n      vadetar,varno,varok,belrap_id,carhrkid,masterid,\r\n      round(borc,@ONDA_HANE),\r\n      round(alacak,@ONDA_HANE),\r\n      ROUND(ISNULL(borc-alacak,0),@ONDA_HANE) AS BAKIYE,\r\n      h.fatid,h.fisid,h.irsid,\r\n      h.marsatid,h.say_id,h.remote_id,\r\n      h.kasahrk_id,h.Poshrk_id,h.Bankahrk_id,\r\n      h.Cek_id,h.isthrk_id,0\r\n    FROM carihrk as h with (nolock)\r\n    WHERE cartip=@CARI_TIP and carkod=@CARI_KOD\r\n     and sil=0  and isnull(CariAvans,0)=@AVANS\r\n     and Firmano in (0,@firmano)\r\n     and islmtip+'_'+islmhrk not in \r\n     (select * FROM CsvToSTR(@HRK_KRITER))\r\n     AND (vadetar >= @TARIH1)\r\n     AND (vadetar <= @TARIH2)\r\n    ORDER BY vadetar,saat\r\n   end\r\n\r\n\r\n  \r\n\r\n\r\n\r\n   update @TB_CARI_EKSTRE set KRS_UNVAN=dt.AD\r\n   FROM @TB_CARI_EKSTRE AS T join\r\n   (select cartp,kod,ad from genel_kart) dt\r\n   on dt.cartp=t.KRS_TIP and dt.kod=t.KRS_KOD\r\n   \r\n    \r\n   update @TB_CARI_EKSTRE set KRS_KOD='-',KRS_UNVAN='-'\r\n   WHERE (KRS_KOD is null)\r\n\r\n\r\n\r\n\r\n   RETURN\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_CARI_HRK_BAKIYE",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_CARI_HRK_BAKIYE",
    "definition": "CREATE FUNCTION [dbo].UDF_CARI_HRK_BAKIYE (\r\n@Firmano  \t\tint,\r\n@CARI_TIP \t\tVARCHAR(20),\r\n@CARI_KODIN \tVARCHAR(8000),\r\n@TARIH1 \t\tDATETIME, \r\n@TARIH2 \t\tDATETIME)\r\nRETURNS\r\n  @TB_CARIHRK_BAK_EKSTRE TABLE (\r\n    CARI_TIP    VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    CARI_KOD    VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    CARI_UNVAN  VARCHAR(150) COLLATE Turkish_CI_AS,\r\n    TARIH       DATETIME,\r\n    SAAT        VARCHAR(8)  COLLATE Turkish_CI_AS,\r\n    BELGENO     VARCHAR(30)  COLLATE Turkish_CI_AS,\r\n    PLAKA       VARCHAR(20)  COLLATE Turkish_CI_AS,\r\n    ACIKLAMA    VARCHAR(100) COLLATE Turkish_CI_AS,\r\n    ISLTIPAD    VARCHAR(30)  COLLATE Turkish_CI_AS,\r\n    ISLHRKAD    VARCHAR(30)  COLLATE Turkish_CI_AS,\r\n    YERAD       VARCHAR(30)  COLLATE Turkish_CI_AS,\r\n    KULAD       VARCHAR(50)  COLLATE Turkish_CI_AS,\r\n    ISLTIP      VARCHAR(10)  COLLATE Turkish_CI_AS,\r\n    ISLHRK      VARCHAR(10)  COLLATE Turkish_CI_AS,\r\n    VADETAR     DATETIME,\r\n    VARNO       FLOAT,\r\n    HRKID       FLOAT,\r\n    MASID       FLOAT,\r\n    BORC        DECIMAL(18,8),\r\n    ALACAK      DECIMAL(18,8),\r\n    BAKIYE      DECIMAL(18,8))\r\nAS\r\nBEGIN\r\n\r\nDECLARE @EKSTRE_CARITEMP TABLE (\r\n carkod     varchar(30))\r\n\r\ndeclare @separator char(1)\r\n set @separator = ','\r\n\r\n declare @separator_position int\r\n declare @array_value varchar(1000)\r\n\r\n IF (LEN(RTRIM(@CARI_KODIN)) > 0)\r\n BEGIN\r\n  set @CARI_KODIN = @CARI_KODIN + ','\r\n END\r\n\r\n while patindex('%,%' , @CARI_KODIN) <> 0\r\n begin\r\n\r\n   select @separator_position =  patindex('%,%' , @CARI_KODIN)\r\n   select @array_value = left(@CARI_KODIN, @separator_position - 1)\r\n\r\n  Insert @EKSTRE_CARITEMP\r\n  Values (@array_value)\r\n\r\n   select @CARI_KODIN = stuff(@CARI_KODIN, 1, @separator_position, '')\r\n end\r\n\r\n\r\n  DECLARE @EKSTRE_TEMP TABLE (\r\n    CARI_TIP    VARCHAR(20)  COLLATE Turkish_CI_AS,\r\n    CARI_KOD VARCHAR(20)     COLLATE Turkish_CI_AS,\r\n    CARI_UNVAN  VARCHAR(50)   COLLATE Turkish_CI_AS,\r\n    TARIH       DATETIME,\r\n    SAAT        VARCHAR(8)    COLLATE Turkish_CI_AS,\r\n    BELGENO    VARCHAR(30)    COLLATE Turkish_CI_AS,\r\n    PLAKA       VARCHAR(20)   COLLATE Turkish_CI_AS,\r\n    ACIKLAMA    VARCHAR(100)  COLLATE Turkish_CI_AS,\r\n    ISLTIPAD    VARCHAR(30)   COLLATE Turkish_CI_AS,\r\n    ISLHRKAD    VARCHAR(30)   COLLATE Turkish_CI_AS,\r\n    YERAD       VARCHAR(30)   COLLATE Turkish_CI_AS,\r\n    KULAD       VARCHAR(50)   COLLATE Turkish_CI_AS,\r\n    ISLTIP      VARCHAR(10)   COLLATE Turkish_CI_AS,\r\n    ISLHRK      VARCHAR(10)   COLLATE Turkish_CI_AS,\r\n    VADETAR     DATETIME,\r\n    VARNO       FLOAT,\r\n    HRKID       FLOAT,\r\n    MASID       FLOAT,\r\n    BORC        DECIMAL(18,8),\r\n    ALACAK      DECIMAL(18,8),\r\n    BAKIYE      DECIMAL(18,8))\r\n\r\n  DECLARE @HRK_CARI_TIP    VARCHAR(20)\r\n  DECLARE @HRK_CARI_KOD    VARCHAR(20)\r\n  DECLARE @HRK_CARI_UNVAN  VARCHAR(50)\r\n  DECLARE @HRK_TARIH       DATETIME\r\n  DECLARE @HRK_SAAT        VARCHAR(8)\r\n  DECLARE @HRK_BELGENO     VARCHAR(30)\r\n  DECLARE @HRK_PLAKA       VARCHAR(20)\r\n  DECLARE @HRK_ACIKLAMA    VARCHAR(100)\r\n  DECLARE @HRK_ISLTIPAD    VARCHAR(30)\r\n  DECLARE @HRK_ISLHRKAD    VARCHAR(30)\r\n  DECLARE @HRK_YERAD       VARCHAR(30)\r\n  DECLARE @HRK_KULAD       VARCHAR(50)\r\n  DECLARE @HRK_ISLTIP      VARCHAR(10)\r\n  DECLARE @HRK_ISLHRK      VARCHAR(10)\r\n  DECLARE @HRK_VADETAR     DATETIME\r\n  DECLARE @HRK_VARNO       FLOAT\r\n  DECLARE @HRK_HRKID       FLOAT\r\n  DECLARE @HRK_MASID       FLOAT\r\n  DECLARE @HRK_BORC        DECIMAL(18,8)\r\n  DECLARE @HRK_ALACAK      DECIMAL(18,8)\r\n  DECLARE @HRK_BAKIYE      DECIMAL(18,8)\r\n  DECLARE @KUM_BAKIYE      DECIMAL(18,8)\r\n  \r\n  DECLARE CRS_HRK CURSOR FAST_FORWARD FOR\r\n    /* Cari Fişlerden gelen harektler */\r\n    SELECT\r\n      vc.cartp,vc.kod,vc.ad,\r\n       tarih,saat,belno,\r\n      '', /*PLAKA */\r\n      ack, /* AÇIKLAMA, */\r\n      islmtipad,islmhrkad,yerad,olususer,islmtip,islmhrk,vadetar,varno,carhrkid,masterid,\r\n      borc,\r\n      alacak,\r\n      (borc-alacak) AS BAKIYE\r\n    FROM Genel_Kart as vc\r\n    inner join carihrk as h with (nolock) on h.cartip=vc.cartp\r\n    and h.carkod=vc.kod and\r\n    vc.cartp=@CARI_TIP and vc.kod in (select carkod from @EKSTRE_CARITEMP)\r\n    and h.sil=0  AND tarih >= @TARIH1 and tarih <= @TARIH2\r\n    ORDER BY tarih\r\n\r\n\r\n  OPEN CRS_HRK\r\n\r\n  FETCH NEXT FROM CRS_HRK INTO\r\n   @HRK_CARI_TIP,@HRK_CARI_KOD,@HRK_CARI_UNVAN,@HRK_TARIH,@HRK_SAAT,@HRK_BELGENO,@HRK_PLAKA,@HRK_ACIKLAMA,\r\n   @HRK_ISLTIPAD,@HRK_ISLHRKAD,@HRK_YERAD,@HRK_KULAD,@HRK_ISLTIP,@HRK_ISLHRK,@HRK_VADETAR,\r\n   @HRK_VARNO,@HRK_HRKID,@HRK_MASID,@HRK_BORC, @HRK_ALACAK, @HRK_BAKIYE\r\n\r\n  WHILE @@FETCH_STATUS = 0\r\n  BEGIN\r\n\r\n    INSERT @EKSTRE_TEMP\r\n      SELECT\r\n       @HRK_CARI_TIP,@HRK_CARI_KOD,@HRK_CARI_UNVAN,@HRK_TARIH,@HRK_SAAT,@HRK_BELGENO,@HRK_PLAKA,@HRK_ACIKLAMA,\r\n       @HRK_ISLTIPAD,@HRK_ISLHRKAD,@HRK_YERAD,@HRK_KULAD,@HRK_ISLTIP,@HRK_ISLHRK,@HRK_VADETAR,\r\n       @HRK_VARNO,@HRK_HRKID,@HRK_MASID,@HRK_BORC, @HRK_ALACAK, @HRK_BAKIYE\r\n\r\n    FETCH NEXT FROM CRS_HRK INTO\r\n      @HRK_CARI_TIP,@HRK_CARI_KOD, @HRK_CARI_UNVAN,@HRK_TARIH,@HRK_SAAT,@HRK_BELGENO,@HRK_PLAKA,@HRK_ACIKLAMA,\r\n      @HRK_ISLTIPAD,@HRK_ISLHRKAD,@HRK_YERAD,@HRK_KULAD,@HRK_ISLTIP,@HRK_ISLHRK,@HRK_VADETAR,\r\n      @HRK_VARNO,@HRK_HRKID,@HRK_MASID,@HRK_BORC, @HRK_ALACAK, @HRK_BAKIYE\r\n  END\r\n\r\n  CLOSE CRS_HRK\r\n  DEALLOCATE CRS_HRK\r\n\r\n  /*---------------------------------------------------------------------------- */\r\n\r\n  INSERT @TB_CARIHRK_BAK_EKSTRE\r\n    SELECT CARI_TIP,CARI_KOD,CARI_UNVAN,TARIH,SAAT,BELGENO,PLAKA,ACIKLAMA,\r\n    ISLTIPAD,ISLHRKAD,YERAD,KULAD,ISLTIP,ISLHRK,VADETAR,VARNO,HRKID,MASID,BORC,ALACAK,BAKIYE FROM @EKSTRE_TEMP\r\n\r\n  RETURN\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_CARI_HRK_RAP",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_CARI_HRK_RAP",
    "definition": "CREATE FUNCTION [dbo].[UDF_CARI_HRK_RAP] (\r\n@firmano\t\tint,\r\n@HRK_KRITER     VARCHAR(4000),\r\n@CARI_TIP \t\tVARCHAR(20),\r\n@CARI_KOD \t\tVARCHAR(4000),\r\n@TARIH1 \t\tDATETIME,\r\n@TARIH2 \t\tDATETIME)\r\nRETURNS\r\n  @TB_CARI_EKSTRE TABLE (\r\n    Firmano     int,\r\n    CARI_TIP    VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    CARI_KOD    VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    CARI_UNVAN  VARCHAR(150) COLLATE Turkish_CI_AS,\r\n    TARIH       DATETIME,\r\n    SAAT        VARCHAR(8)  COLLATE Turkish_CI_AS,\r\n    BELGENO     VARCHAR(50)  COLLATE Turkish_CI_AS,\r\n    PLAKA       VARCHAR(50)  COLLATE Turkish_CI_AS,\r\n    ACIKLAMA    VARCHAR(200) COLLATE Turkish_CI_AS,\r\n    ISLTIPAD    VARCHAR(50)  COLLATE Turkish_CI_AS,\r\n    ISLHRKAD    VARCHAR(50)  COLLATE Turkish_CI_AS,\r\n    YERTIP      VARCHAR(30)  COLLATE Turkish_CI_AS,\r\n    YERAD       VARCHAR(50)  COLLATE Turkish_CI_AS,\r\n    KULAD       VARCHAR(70)  COLLATE Turkish_CI_AS,\r\n    ISLTIP      VARCHAR(50)  COLLATE Turkish_CI_AS,\r\n    ISLHRK      VARCHAR(70)  COLLATE Turkish_CI_AS,\r\n    VADETAR     DATETIME,\r\n    VARNO       FLOAT,\r\n    VAROK\t\tINT,\r\n    RAPID\t\tINT,\r\n    HRKID       FLOAT,\r\n    MASID       FLOAT,\r\n    BORC        FLOAT,\r\n    ALACAK      FLOAT,\r\n    BAKIYE      FLOAT,\r\n    FAT_ID      INT,\r\n    FIS_ID      INT,\r\n    IRS_ID      INT,\r\n    MARSAT_ID\tINT,\r\n    SAYIM_ID    INT,\r\n    REMOTE_ID\tINT,\r\n    KASAHRK_ID  INT,\r\n    POSHRK_ID   INT,\r\n    BANKAHRK_ID INT,\r\n    CEK_ID\t\tINT,\r\n    ISTHRK_ID   INT,\r\n    DEVIR\t\tINT)\r\nAS\r\nBEGIN\r\n\r\n\r\n  DECLARE @KUM_BAKIYE      FLOAT\r\n\r\n  \r\n  DECLARE @ONDA_HANE       INT\r\n\r\n  SET @KUM_BAKIYE = 0\r\n  \r\n  \r\n  select @ONDA_HANE=Para_Ondalik from sistemtanim\r\n\r\n\r\n\r\n if @CARI_KOD<>''\r\n   INSERT @TB_CARI_EKSTRE\r\n   (Firmano,CARI_TIP,CARI_KOD,\r\n    CARI_UNVAN,TARIH,SAAT,BELGENO,\r\n    PLAKA,ACIKLAMA,\r\n    ISLTIPAD,ISLHRKAD,YERTIP,YERAD,\r\n    KULAD,ISLTIP,ISLHRK,VADETAR,\r\n    VARNO,VAROK,RAPID,HRKID,\r\n    MASID,BORC,ALACAK,BAKIYE,\r\n    FAT_ID,FIS_ID,IRS_ID,\r\n    MARSAT_ID,SAYIM_ID,REMOTE_ID,\r\n    KASAHRK_ID,POSHRK_ID,BANKAHRK_ID,\r\n    CEK_ID,ISTHRK_ID,DEVIR)\r\n    SELECT\r\n      h.firmano,\r\n      h.cartip,h.carkod,'',\r\n      tarih,saat,belno,\r\n      plaka, /*PLAKA */\r\n      ack, /* AÇIKLAMA, */\r\n      islmtipad,islmhrkad,yertip,yerad,\r\n      olususer,islmtip,islmhrk,vadetar,varno,\r\n      varok,belrap_id,\r\n      carhrkid,masterid,\r\n      round(borc,@ONDA_HANE),\r\n      round(alacak,@ONDA_HANE),\r\n      ROUND(ISNULL(borc-alacak,0),@ONDA_HANE) AS BAKIYE,\r\n      h.fatid,h.fisid,h.irsid,\r\n      h.marsatid,h.say_id,h.remote_id,\r\n      h.kasahrk_id,h.Poshrk_id,h.Bankahrk_id,\r\n      h.Cek_id,h.isthrk_id,0\r\n    FROM carihrk as h \r\n    WHERE cartip=@CARI_TIP\r\n    and carkod in (select * from CsvToSTR(@CARI_KOD)) \r\n     and sil=0 \r\n     and islmtip+'_'+islmhrk not in \r\n     (select * FROM CsvToSTR(@HRK_KRITER))\r\n     AND (tarih >= @TARIH1 )\r\n     AND (tarih <= @TARIH2)\r\n    ORDER BY tarih,saat\r\n \r\n\r\n  if @CARI_KOD=''\r\n   INSERT @TB_CARI_EKSTRE\r\n   (Firmano,CARI_TIP,CARI_KOD,\r\n    CARI_UNVAN,TARIH,SAAT,BELGENO,\r\n    PLAKA,ACIKLAMA,\r\n    ISLTIPAD,ISLHRKAD,YERTIP,YERAD,\r\n    KULAD,ISLTIP,ISLHRK,VADETAR,\r\n    VARNO,VAROK,RAPID,HRKID,\r\n    MASID,BORC,ALACAK,BAKIYE,\r\n    FAT_ID,FIS_ID,IRS_ID,\r\n    MARSAT_ID,SAYIM_ID,REMOTE_ID,\r\n    KASAHRK_ID,POSHRK_ID,BANKAHRK_ID,\r\n    CEK_ID,ISTHRK_ID,DEVIR)\r\n    SELECT\r\n      h.firmano,\r\n      h.cartip,h.carkod,'',\r\n      tarih,saat,belno,\r\n      plaka, /*PLAKA */\r\n      ack, /* AÇIKLAMA, */\r\n      islmtipad,islmhrkad,yertip,yerad,\r\n      olususer,islmtip,islmhrk,vadetar,varno,\r\n      varok,belrap_id,\r\n      carhrkid,masterid,\r\n      round(borc,@ONDA_HANE),\r\n      round(alacak,@ONDA_HANE),\r\n      ROUND(ISNULL(borc-alacak,0),@ONDA_HANE) AS BAKIYE,\r\n      h.fatid,h.fisid,h.irsid,\r\n      h.marsatid,h.say_id,h.remote_id,\r\n      h.kasahrk_id,h.Poshrk_id,h.Bankahrk_id,\r\n      h.Cek_id,h.isthrk_id,0\r\n    FROM carihrk as h \r\n    WHERE cartip=@CARI_TIP\r\n      and sil=0 \r\n     and islmtip+'_'+islmhrk not in \r\n     (select * FROM CsvToSTR(@HRK_KRITER))\r\n     AND (tarih >= @TARIH1 )\r\n     AND (tarih <= @TARIH2)\r\n    ORDER BY tarih,saat\r\n  \r\n  \r\n  UPDATE @TB_CARI_EKSTRE \r\n  SET CARI_UNVAN=dt.ad from  @TB_CARI_EKSTRE  T \r\n  join (select gk.kod,gk.ad from Genel_Kart as gk\r\n   where gk.cartp=@CARI_TIP) DT\r\n   ON dt.kod=t.CARI_KOD\r\n  \r\n  \r\n\r\n\r\n   RETURN\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_CARI_LIMIT",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_CARI_LIMIT",
    "definition": "CREATE FUNCTION UDF_CARI_LIMIT (\r\n@CARI_TIP VARCHAR(20),\r\n@CARI_KOD VARCHAR(20),\r\n@TARIH1 DATETIME,\r\n@TARIH2 DATETIME)\r\nRETURNS\r\n  @TB_CARI_EKSTRE TABLE (\r\n    CARI_TIP    \t\t VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    CARI_KOD    \t\t VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    CARI_UNVAN  \t\t VARCHAR(150) COLLATE Turkish_CI_AS,\r\n    GENELBAKIYE      \t FLOAT,\r\n    LIMIT             \t FLOAT,\r\n    CEKSENETBEKLEYEN  \t FLOAT,\r\n    FARK              \t FLOAT,\r\n    FARK_CEKBEKLEYENSIZ  FLOAT\r\n    )\r\nAS\r\nBEGIN\r\n  DECLARE @EKSTRE_TEMP TABLE (\r\n    CARI_TIP    VARCHAR(20)  COLLATE Turkish_CI_AS,\r\n    CARI_KOD    VARCHAR(30)  COLLATE Turkish_CI_AS,\r\n    CARI_UNVAN  VARCHAR(150) COLLATE Turkish_CI_AS,\r\n    GENELBAKIYE       FLOAT,\r\n    LIMIT             FLOAT,\r\n    CEKSENETBEKLEYEN  \tFLOAT,\r\n    FARK                FLOAT,\r\n    FARK_CEKBEKLEYENSIZ  FLOAT  )\r\n\r\n  DECLARE @HRK_CARI_TIP    VARCHAR(20)\r\n  DECLARE @HRK_CARI_KOD    VARCHAR(30)\r\n  DECLARE @HRK_CARI_UNVAN  VARCHAR(150)\r\n  DECLARE @HRK_GENELBAKIYE     FLOAT\r\n  DECLARE @HRK_LIMIT           FLOAT\r\n  DECLARE @HRK_FARK            FLOAT\r\n  DECLARE @HRK_CEKSENETBEKLEYEN  FLOAT\r\n\r\n  DECLARE @HRK_CARIBAKIYE      FLOAT\r\n  DECLARE @HRK_FISBAKIYE       FLOAT\r\n  \r\n  INSERT @EKSTRE_TEMP (CARI_TIP,CARI_KOD,CARI_UNVAN,\r\n  LIMIT,GENELBAKIYE,FARK,CEKSENETBEKLEYEN,FARK_CEKBEKLEYENSIZ)\r\n    SELECT\r\n      'Cari Kartlar',k.kod,k.unvan,k.toplamlimit,0,0,0,0\r\n       FROM carikart as k with (nolock) where k.sil=0\r\n  \r\n  \r\n  \r\n   DECLARE CRS_HRK CURSOR FAST_FORWARD FOR\r\n     SELECT\r\n      h.carkod,isnull(sum(h.borc-h.alacak),0)\r\n      FROM carihrk as h with (nolock)  where h.sil=0 \r\n      AND(h.tarih+cast(h.saat as datetime)) >= @TARIH1 \r\n      and (h.tarih+cast(h.saat as datetime)) <= @TARIH2\r\n      group by h.carkod\r\n\r\n  OPEN CRS_HRK\r\n\r\n  FETCH NEXT FROM CRS_HRK INTO\r\n   @HRK_CARI_KOD,@HRK_CARIBAKIYE\r\n\r\n  WHILE @@FETCH_STATUS = 0\r\n  BEGIN\r\n                         \r\n      set @HRK_FISBAKIYE=(\r\n      select isnull(sum(case WHEN fistip='FISVERSAT' THEN \r\n      toptut ELSE -1*toptut END ),0) from veresimas as vrs with (nolock)\r\n      where vrs.sil=0 and vrs.cartip='carikart'\r\n      and vrs.carkod=@HRK_CARI_KOD and vrs.aktip in ('BK','BL') \r\n      AND (vrs.tarih+cast(vrs.saat as datetime)) >= @TARIH1 \r\n      and (vrs.tarih+cast(vrs.saat as datetime)) <= @TARIH2 )\r\n      \r\n      \r\n     set @HRK_CEKSENETBEKLEYEN= \r\n     (select isnull(sum(-1*(giren-cikan)),0) from cekkart as c  with (nolock) \r\n      where c.sil=0 and c.drm in ('POR','TAK','KSN')\r\n      and (c.tarih+cast(c.saat as datetime)) >= @TARIH1 \r\n      and (c.tarih+cast(c.saat as datetime)) <= @TARIH2 and \r\n      ( (c.cartip=@CARI_TIP and c.carkod=@HRK_CARI_KOD) or \r\n      (c.vercartip=@CARI_TIP and c.vercarkod=@HRK_CARI_KOD) ) )\r\n      \r\n\r\n      SET @HRK_GENELBAKIYE=@HRK_CARIBAKIYE+@HRK_FISBAKIYE\r\n      \r\n     \r\n      \r\n\r\n    UPDATE @EKSTRE_TEMP \r\n    SET GENELBAKIYE=@HRK_GENELBAKIYE,\r\n    CEKSENETBEKLEYEN=@HRK_CEKSENETBEKLEYEN,\r\n    FARK=LIMIT-@HRK_GENELBAKIYE,\r\n    FARK_CEKBEKLEYENSIZ=LIMIT-(@HRK_GENELBAKIYE-\r\n    @HRK_CEKSENETBEKLEYEN)\r\n    WHERE CARI_KOD=@HRK_CARI_KOD\r\n       \r\n    FETCH NEXT FROM CRS_HRK INTO\r\n    @HRK_CARI_KOD,@HRK_CARIBAKIYE\r\n  END\r\n\r\n  CLOSE CRS_HRK\r\n  DEALLOCATE CRS_HRK\r\n\r\n  /*---------------------------------------------------------------------------- */\r\n\r\n  INSERT @TB_CARI_EKSTRE\r\n    SELECT * FROM @EKSTRE_TEMP\r\n\r\n  RETURN\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_CARI_LIMITPLAKA",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_CARI_LIMITPLAKA",
    "definition": "CREATE FUNCTION UDF_CARI_LIMITPLAKA (@CARI_TIP VARCHAR(20),\r\n@PLAKA VARCHAR(20),\r\n@TARIH1 DATETIME, @TARIH2 DATETIME)\r\nRETURNS\r\n  @TB_CARI_EKSTRE TABLE (\r\n    CARI_TIP    VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    CARI_KOD    VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    CARI_UNVAN  VARCHAR(150) COLLATE Turkish_CI_AS,\r\n    CARI_PLAKA  VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    LIMTIP      VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    STOK_KOD      VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    PLAKALIMIT        FLOAT,\r\n    GENELBAKIYE       FLOAT,\r\n    FARK              FLOAT )\r\nAS\r\nBEGIN\r\n  DECLARE @EKSTRE_TEMP TABLE (\r\n    CARI_TIP    VARCHAR(20)  COLLATE Turkish_CI_AS,\r\n    CARI_KOD    VARCHAR(50)  COLLATE Turkish_CI_AS,\r\n    CARI_UNVAN  VARCHAR(150)  COLLATE Turkish_CI_AS,\r\n    CARI_PLAKA  VARCHAR(50)  COLLATE Turkish_CI_AS,\r\n    LIMITTIP  VARCHAR(20)    COLLATE Turkish_CI_AS,\r\n    STOK_KOD      VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    PLAKALIMIT        FLOAT,\r\n    GENELBAKIYE       FLOAT,\r\n    FARK              FLOAT  )\r\n\r\n  DECLARE @HRK_CARI_TIP    VARCHAR(20)\r\n  DECLARE @HRK_CARI_KOD    VARCHAR(50)\r\n  DECLARE @HRK_CARI_UNVAN  VARCHAR(150)\r\n  DECLARE @HRK_PLAKA       VARCHAR(50)\r\n  DECLARE @HRK_LIMTIP      VARCHAR(20)\r\n  DECLARE @HRK_STOKKOD     VARCHAR(50)\r\n  DECLARE @HRK_GENELBAKIYE     FLOAT\r\n  DECLARE @HRK_LIMIT           FLOAT\r\n  DECLARE @HRK_FARK            FLOAT\r\n\r\n  DECLARE @HRK_CARIBAKIYE      FLOAT\r\n  DECLARE @HRK_FISBAKIYETUT    FLOAT\r\n  DECLARE @HRK_FISLITRE        FLOAT\r\n\r\n\r\n   IF @PLAKA=''\r\n   BEGIN\r\n   DECLARE CRS_HRK CURSOR FAST_FORWARD FOR\r\n     SELECT\r\n      'Cari Kartlar',k.kod,k.unvan,oto.plaka,oto.limit,oto.limitturu,oto.stkod\r\n       FROM carikart as k with (nolock) inner join otomasgenkod as oto with (nolock)\r\n       on oto.kod=k.kod and oto.cartip='carikart'\r\n       where  k.sil=0\r\n    END\r\n    \r\n    IF @PLAKA<>''\r\n   BEGIN\r\n   DECLARE CRS_HRK CURSOR FAST_FORWARD FOR\r\n     SELECT\r\n      'Cari Kartlar',k.kod,k.unvan,oto.plaka,oto.limit,oto.limitturu,oto.stkod\r\n       FROM carikart as k with (nolock) inner join otomasgenkod as oto with (nolock)\r\n       on oto.kod=k.kod and oto.cartip='carikart'\r\n       where  k.sil=0 and oto.plaka=@PLAKA\r\n    END\r\n    \r\n       \r\n       \r\n\r\n    OPEN CRS_HRK\r\n\r\n  FETCH NEXT FROM CRS_HRK INTO\r\n   @HRK_CARI_TIP,@HRK_CARI_KOD,@HRK_CARI_UNVAN,@HRK_PLAKA,@HRK_LIMIT,@HRK_LIMTIP,@HRK_STOKKOD\r\n\r\n  WHILE @@FETCH_STATUS = 0\r\n  BEGIN\r\n\r\n      if @HRK_LIMTIP='Tutar'\r\n      set @HRK_FISBAKIYETUT=(select isnull(sum(case WHEN fistip='BOR' THEN toptut ELSE -1*toptut END),0)\r\n      from veresimas as vrs with (nolock)\r\n      where vrs.plaka=@HRK_PLAKA and vrs.sil=0 and vrs.cartip='carikart'\r\n      and vrs.carkod=@HRK_CARI_KOD and vrs.aktip='BK'\r\n      AND (vrs.tarih+cast(vrs.saat as datetime)) >= @TARIH1 \r\n      and (vrs.tarih+cast(vrs.saat as datetime)) <= @TARIH2 )\r\n      \r\n      if @HRK_LIMTIP='Litre'\r\n      set @HRK_FISLITRE=(select isnull(sum(case WHEN vrs.fistip='BOR' THEN vhr.mik ELSE -1*vhr.mik END ),0) from\r\n      veresimas as vrs inner join veresihrk as vhr on vrs.verid=vhr.verid and vrs.sil=0 and vhr.sil=0\r\n      and vrs.plaka=@HRK_PLAKA\r\n      where vrs.cartip='carikart' and vrs.carkod=@HRK_CARI_KOD\r\n      and vrs.aktip='BK' \r\n      AND (vrs.tarih+cast(vrs.saat as datetime)) >= @TARIH1 \r\n      and (vrs.tarih+cast(vrs.saat as datetime)) <= @TARIH2 )\r\n      \r\n      \r\n\r\n      \r\n\r\n     if @HRK_LIMTIP='Tutar'\r\n     SET @HRK_GENELBAKIYE=@HRK_FISBAKIYETUT\r\n\r\n     if @HRK_LIMTIP='Litre'\r\n     SET @HRK_GENELBAKIYE=@HRK_FISLITRE\r\n     \r\n     if @HRK_GENELBAKIYE is null\r\n     set @HRK_GENELBAKIYE=0\r\n     \r\n     if @HRK_FARK is null\r\n     set @HRK_FARK=0\r\n     \r\n     \r\n     SET @HRK_FARK=@HRK_LIMIT-@HRK_GENELBAKIYE\r\n\r\n\r\n     INSERT @EKSTRE_TEMP (CARI_TIP,CARI_KOD,CARI_UNVAN,CARI_PLAKA,PLAKALIMIT,\r\n     LIMITTIP,STOK_KOD,GENELBAKIYE,FARK) VALUES\r\n     (@HRK_CARI_TIP,@HRK_CARI_KOD,@HRK_CARI_UNVAN,@HRK_PLAKA,@HRK_LIMIT,\r\n     @HRK_LIMTIP,@HRK_STOKKOD,@HRK_GENELBAKIYE,@HRK_FARK)\r\n\r\n       \r\n    FETCH NEXT FROM CRS_HRK INTO\r\n       @HRK_CARI_TIP,@HRK_CARI_KOD,@HRK_CARI_UNVAN,@HRK_PLAKA,@HRK_LIMIT,@HRK_LIMTIP,@HRK_STOKKOD\r\n  END\r\n\r\n  CLOSE CRS_HRK\r\n  DEALLOCATE CRS_HRK\r\n\r\n  /*---------------------------------------------------------------------------- */\r\n\r\n  INSERT @TB_CARI_EKSTRE\r\n    SELECT * FROM @EKSTRE_TEMP\r\n\r\n  RETURN\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_CARI_VADE_TARIH_VER",
    "type": "SQL_SCALAR_FUNCTION",
    "full_name": "dbo.UDF_CARI_VADE_TARIH_VER",
    "definition": "CREATE FUNCTION [dbo].[UDF_CARI_VADE_TARIH_VER](\r\n@Tip varchar(10),\r\n@Kod varchar(20),\r\n@Tarih Datetime )\r\nRETURNS Datetime\r\nAS\r\nBEGIN\r\n\tDECLARE @result Datetime\r\n    DECLARE @Sure   int\r\n    DECLARE @SureTip  varchar(10)\r\n    \r\n    \r\n    set  @result=@Tarih\r\n    \r\n    \r\n    if @Tip='fis'\r\n     begin\r\n     SELECT @Sure=fisvadsur,@SureTip=fisvadtip FROM carikart with (nolock) where Kod=@Kod\r\n     if @SureTip='fistar'\r\n      set  @result=DATEADD(DAY,@SURE,@result)\r\n     end\r\n\t\r\n    \r\n    \r\n     if @Tip='fat'\r\n      begin\r\n       SELECT @Sure=fatvadsur,@SureTip=fisvadtip FROM carikart with (nolock) where Kod=@Kod\r\n\r\n       if @SureTip='fattar'\r\n        set  @result=DATEADD(DAY,@SURE,@result)\r\n      end\r\n      \r\n      \r\n      \r\n        if @SureTip='bsaygun'  \r\n        begin\r\n        \r\n         if @SURE=0\r\n          set @SURE=1\r\n        \r\n         SELECT @result=CAST(CAST(year(@Tarih) AS varchar) + '-' + CAST(month(@Tarih) AS varchar) +\r\n          '-' + CAST(@SURE as varchar) AS datetime)\r\n      \r\n        if ISDATE(DATEADD(month,1,@result))=1 \r\n          set @result=DATEADD(month,1,@result)\r\n        else\r\n          set @result=DATEADD(month,2,@result) \r\n         \r\n        end \r\n        \r\n       if @SureTip='haysongun'   \r\n        begin\r\n        \r\n         SELECT @result=CAST(CAST(year(@Tarih) AS varchar) + '-' + CAST(month(@Tarih) AS varchar) +\r\n          '-' + CAST(1 as varchar) AS datetime)\r\n      \r\n         set @result=DATEADD(month,1,@result)\r\n    \r\n         set @result=DATEADD(day,-1,@result) \r\n        \r\n        \r\n        end\r\n      \r\n      \r\n      \r\n      \r\n        \r\n    \r\n     RETURN @result\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_CARI_WEB_HRK",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_CARI_WEB_HRK",
    "definition": "CREATE FUNCTION [dbo].[UDF_CARI_WEB_HRK] (\r\n@firmano\t\tint,\r\n@HRK_KRITER     VARCHAR(4000),\r\n@CARI_TIP VARCHAR(20),\r\n@CARI_KOD VARCHAR(30),\r\n@TARIH1 DATETIME,\r\n@TARIH2 DATETIME,\r\n@SAAT1 VARCHAR(8),\r\n@SAAT2 VARCHAR(8),\r\n@ORDER  VARCHAR(20),\r\n@DEVIR          INT)\r\nRETURNS\r\n  @TB_CARI_EKSTRE TABLE (\r\n    CARI_TIP    VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    CARI_KOD    VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    CARI_UNVAN  VARCHAR(150) COLLATE Turkish_CI_AS,\r\n    TARIH       DATETIME,\r\n    SAAT        VARCHAR(8)  COLLATE Turkish_CI_AS,\r\n    BELGENO     VARCHAR(30)  COLLATE Turkish_CI_AS,\r\n    PLAKA       VARCHAR(50)  COLLATE Turkish_CI_AS,\r\n    ACIKLAMA    VARCHAR(100) COLLATE Turkish_CI_AS,\r\n    ISLTIPAD    VARCHAR(30)  COLLATE Turkish_CI_AS,\r\n    ISLHRKAD    VARCHAR(30)  COLLATE Turkish_CI_AS,\r\n    YERTIP      VARCHAR(30)  COLLATE Turkish_CI_AS,\r\n    YERAD       VARCHAR(30)  COLLATE Turkish_CI_AS,\r\n    KULAD       VARCHAR(50)  COLLATE Turkish_CI_AS,\r\n    ISLTIP      VARCHAR(10)  COLLATE Turkish_CI_AS,\r\n    ISLHRK      VARCHAR(10)  COLLATE Turkish_CI_AS,\r\n    VADETAR     DATETIME,\r\n    VARNO       FLOAT,\r\n    VAROK\t\tINT,\r\n    RAPID\t\tINT,\r\n    HRKID       FLOAT,\r\n    MASID       FLOAT,\r\n    BORC        FLOAT,\r\n    ALACAK      FLOAT,\r\n    BAKIYE      FLOAT)\r\nAS\r\nBEGIN\r\n  DECLARE @EKSTRE_TEMP TABLE (\r\n    CARI_TIP    VARCHAR(20)  COLLATE Turkish_CI_AS,\r\n    CARI_KOD    VARCHAR(20)  COLLATE Turkish_CI_AS,\r\n    CARI_UNVAN  VARCHAR(50)  COLLATE Turkish_CI_AS,\r\n    TARIH       DATETIME,\r\n    SAAT        VARCHAR(8)    COLLATE Turkish_CI_AS,\r\n    BELGENO     VARCHAR(30)   COLLATE Turkish_CI_AS,\r\n    PLAKA       VARCHAR(50)   COLLATE Turkish_CI_AS,\r\n    ACIKLAMA    VARCHAR(100)  COLLATE Turkish_CI_AS,\r\n    ISLTIPAD    VARCHAR(30)   COLLATE Turkish_CI_AS,\r\n    ISLHRKAD    VARCHAR(30)   COLLATE Turkish_CI_AS,\r\n    YERTIP      VARCHAR(30)  COLLATE Turkish_CI_AS,    \r\n    YERAD       VARCHAR(30)   COLLATE Turkish_CI_AS,\r\n    KULAD       VARCHAR(50)   COLLATE Turkish_CI_AS,\r\n    ISLTIP      VARCHAR(10)   COLLATE Turkish_CI_AS,\r\n    ISLHRK      VARCHAR(10)   COLLATE Turkish_CI_AS,\r\n    VADETAR     DATETIME,\r\n    VARNO       FLOAT,\r\n    VAROK\t\tINT,\r\n    RAPID\t\tINT,\r\n    HRKID       FLOAT,\r\n    MASID       FLOAT,\r\n    BORC        FLOAT,\r\n    ALACAK      FLOAT,\r\n    BAKIYE      FLOAT)\r\n    \r\n\r\n  \r\n\r\n  DECLARE @HRK_CARI_TIP    VARCHAR(20)\r\n  DECLARE @HRK_CARI_KOD    VARCHAR(20)\r\n  DECLARE @HRK_CARI_UNVAN  VARCHAR(50)\r\n  DECLARE @HRK_TARIH       DATETIME\r\n  DECLARE @HRK_SAAT        VARCHAR(8)\r\n  DECLARE @HRK_BELGENO     VARCHAR(30)\r\n  DECLARE @HRK_PLAKA       VARCHAR(50)\r\n  DECLARE @HRK_ACIKLAMA    VARCHAR(100)\r\n  DECLARE @HRK_ISLTIPAD    VARCHAR(30)\r\n  DECLARE @HRK_ISLHRKAD    VARCHAR(30)\r\n  DECLARE @HRK_YERTIP      VARCHAR(30)\r\n  DECLARE @HRK_YERAD       VARCHAR(30)\r\n  DECLARE @HRK_KULAD       VARCHAR(50)\r\n  DECLARE @HRK_ISLTIP      VARCHAR(10)\r\n  DECLARE @HRK_ISLHRK      VARCHAR(10)\r\n  DECLARE @HRK_VADETAR     DATETIME\r\n  DECLARE @HRK_VARNO       FLOAT\r\n  DECLARE @HRK_VAROK       INT\r\n  DECLARE @HRK_RAPID       INT\r\n  DECLARE @HRK_HRKID       FLOAT\r\n  DECLARE @HRK_MASID       FLOAT\r\n  DECLARE @HRK_BORC        FLOAT\r\n  DECLARE @HRK_ALACAK      FLOAT\r\n  DECLARE @HRK_BAKIYE      FLOAT\r\n  DECLARE @KUM_BAKIYE      FLOAT\r\n  \r\n  DECLARE @ONDA_HANE       INT\r\n\r\n  SET @KUM_BAKIYE = 0\r\n  \r\n  \r\n  select @ONDA_HANE=Para_Ondalik from sistemtanim\r\n\r\n\r\n select @HRK_CARI_UNVAN=gk.ad from Genel_Kart as gk\r\n  where kod=@CARI_KOD and gk.cartp=@CARI_TIP\r\n\r\n  /* Devir atanıyor */\r\n  IF @DEVIR=1/*------------------- */\r\n   BEGIN\r\n  IF @ORDER='tarih'\r\n  begin\r\n  INSERT @EKSTRE_TEMP\r\n    SELECT\r\n      '',/*CARI TIP */\r\n      '', /* CARI_KOD */\r\n      @HRK_CARI_UNVAN, /* CARI_UNVAN */\r\n      max(tarih),\r\n      @SAAT1,\r\n      'DEVİR', /* BELGE NO */\r\n      '', /*PLAKA */\r\n      convert(VARCHAR(30),max(tarih),104)+' DEVİR BAKİYESİ', /* AÇIKLAMA */\r\n      '-','-','-','-','-','-','-',max(vadetar),0,0,0,0,0,\r\n      0,/*ISNULL(SUM(borc),0), -- BORC */\r\n      0,/*ISNULL(SUM(alacak),0), -- ALACAK */\r\n      ISNULL(SUM(round((borc-alacak),@ONDA_HANE)),0) /* BAKIYE */\r\n    FROM carihrk\r\n    WHERE cartip=@CARI_TIP and carkod=@CARI_KOD\r\n     and sil=0 AND (tarih < @TARIH1)  \r\n    end\r\n\r\n  IF @ORDER='vadetar'\r\n  begin\r\n  INSERT @EKSTRE_TEMP\r\n    SELECT\r\n      '',/*CARI TIP */\r\n      '', /* CARI_KOD */\r\n      @HRK_CARI_UNVAN, /* CARI_UNVAN */\r\n      max(tarih),\r\n      @SAAT1,\r\n      'DEVİR', /* BELGE NO */\r\n      '', /*PLAKA */\r\n      CONVERT(VARCHAR(10), max(tarih), 104) +' DEVİR BAKİYESİ', /* AÇIKLAMA */\r\n      '-','-','-','-','-','-','-',max(vadetar),0,0,0,0,0,\r\n      0,/*ISNULL(SUM(borc),0), -- BORC */\r\n      0,/*ISNULL(SUM(alacak),0), -- ALACAK */\r\n      ISNULL(SUM(round((borc-alacak),@ONDA_HANE)),0) /* BAKIYE */\r\n    FROM carihrk\r\n    WHERE cartip=@CARI_TIP and carkod=@CARI_KOD\r\n     and sil=0 AND (vadetar < @TARIH1)\r\n \r\n    end\r\n   \r\n     SELECT @KUM_BAKIYE = isnull(BAKIYE,0) FROM @EKSTRE_TEMP\r\n\r\n     if @KUM_BAKIYE=0\r\n      delete from @EKSTRE_TEMP \r\n  \r\n   \r\n   END/*------------------------------- */\r\n\r\n\r\n  IF @ORDER='tarih'\r\n  begin\r\n  DECLARE CRS_HRK CURSOR FAST_FORWARD FOR\r\n    SELECT\r\n      @CARI_TIP,@CARI_KOD,@HRK_CARI_UNVAN,\r\n       tarih,saat,belno,\r\n      plaka, /*PLAKA */\r\n      ack, /* AÇIKLAMA, */\r\n      islmtipad,islmhrkad,yertip,yerad,\r\n      olususer,islmtip,islmhrk,vadetar,varno,\r\n      varok,belrap_id,\r\n      carhrkid,masterid,\r\n      round(borc,@ONDA_HANE),\r\n      round(alacak,@ONDA_HANE),\r\n      ROUND(ISNULL(borc-alacak,0),@ONDA_HANE) AS BAKIYE\r\n    FROM carihrk\r\n    WHERE cartip=@CARI_TIP and carkod=@CARI_KOD\r\n     and sil=0 AND (tarih >= @TARIH1 )\r\n     AND (tarih <= @TARIH2)\r\n    ORDER BY tarih,saat\r\n   end\r\n\r\n  IF @ORDER='vadetar'\r\n  begin\r\n  DECLARE CRS_HRK CURSOR FAST_FORWARD FOR\r\n    SELECT\r\n      @CARI_TIP,@CARI_KOD,@HRK_CARI_UNVAN,\r\n       tarih,saat,belno,\r\n      plaka, /*PLAKA */\r\n      ack, /* AÇIKLAMA, */\r\n      islmtipad,islmhrkad,yertip,yerad,olususer,islmtip,islmhrk,\r\n      vadetar,varno,varok,belrap_id,carhrkid,masterid,\r\n      round(borc,@ONDA_HANE),\r\n      round(alacak,@ONDA_HANE),\r\n      ROUND(ISNULL(borc-alacak,0),@ONDA_HANE) AS BAKIYE\r\n    FROM carihrk\r\n    WHERE cartip=@CARI_TIP and carkod=@CARI_KOD\r\n     and sil=0 AND (vadetar >= @TARIH1)\r\n     AND (vadetar <= @TARIH2)\r\n    ORDER BY vadetar,saat\r\n   end\r\n\r\n\r\n\r\n  OPEN CRS_HRK\r\n\r\n  FETCH NEXT FROM CRS_HRK INTO\r\n   @HRK_CARI_TIP,@HRK_CARI_KOD,@HRK_CARI_UNVAN,@HRK_TARIH,@HRK_SAAT,@HRK_BELGENO,@HRK_PLAKA,@HRK_ACIKLAMA,\r\n   @HRK_ISLTIPAD,@HRK_ISLHRKAD,@HRK_YERTIP,@HRK_YERAD,@HRK_KULAD,@HRK_ISLTIP,@HRK_ISLHRK,@HRK_VADETAR,\r\n   @HRK_VARNO,@HRK_VAROK,@HRK_RAPID,@HRK_HRKID,@HRK_MASID,@HRK_BORC, @HRK_ALACAK, @HRK_BAKIYE\r\n\r\n  WHILE @@FETCH_STATUS = 0\r\n  BEGIN\r\n    SET @KUM_BAKIYE = @KUM_BAKIYE + @HRK_BAKIYE\r\n\r\n    INSERT @EKSTRE_TEMP\r\n      SELECT\r\n       @HRK_CARI_TIP,@HRK_CARI_KOD,@HRK_CARI_UNVAN,@HRK_TARIH,@HRK_SAAT,@HRK_BELGENO,@HRK_PLAKA,@HRK_ACIKLAMA,\r\n       @HRK_ISLTIPAD,@HRK_ISLHRKAD,@HRK_YERTIP,@HRK_YERAD,@HRK_KULAD,@HRK_ISLTIP,@HRK_ISLHRK,@HRK_VADETAR,\r\n       @HRK_VARNO,@HRK_VAROK,@HRK_RAPID,@HRK_HRKID,@HRK_MASID,@HRK_BORC, @HRK_ALACAK, @KUM_BAKIYE\r\n\r\n    FETCH NEXT FROM CRS_HRK INTO\r\n      @HRK_CARI_TIP,@HRK_CARI_KOD, @HRK_CARI_UNVAN,@HRK_TARIH,@HRK_SAAT,@HRK_BELGENO,@HRK_PLAKA,@HRK_ACIKLAMA,\r\n      @HRK_ISLTIPAD,@HRK_ISLHRKAD,@HRK_YERTIP,@HRK_YERAD,@HRK_KULAD,@HRK_ISLTIP,@HRK_ISLHRK,@HRK_VADETAR,\r\n      @HRK_VARNO,@HRK_VAROK,@HRK_RAPID,@HRK_HRKID,@HRK_MASID,@HRK_BORC, @HRK_ALACAK, @HRK_BAKIYE\r\n  END\r\n\r\n  CLOSE CRS_HRK\r\n  DEALLOCATE CRS_HRK\r\n\r\n  /*---------------------------------------------------------------------------- */\r\n\r\n  INSERT @TB_CARI_EKSTRE\r\n    SELECT CARI_TIP,CARI_KOD,CARI_UNVAN,TARIH,SAAT,BELGENO,PLAKA,ACIKLAMA,\r\n    ISLTIPAD,ISLHRKAD,YERTIP,YERAD,KULAD,ISLTIP,ISLHRK,VADETAR,\r\n    VARNO,VAROK,RAPID,HRKID,\r\n    MASID,BORC,ALACAK,BAKIYE FROM @EKSTRE_TEMP\r\n\r\n  RETURN\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_CARIFIS_BK",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_CARIFIS_BK",
    "definition": "CREATE FUNCTION [dbo].UDF_CARIFIS_BK\r\n(@CARI_TIP   VARCHAR(20),\r\n@CARI_KOD    VARCHAR(30),\r\n@AK_TIP      VARCHAR(30),\r\n@RAP_ID      INT,\r\n@CH_TARIH       INT,\r\n@BAS_TARIH\t DATETIME,\r\n@BIT_TARIH    DATETIME)\r\nRETURNS\r\n    @TB_CARI_FIS_EKSTRE TABLE (\r\n    Firmano     int,\r\n    Cartip_id   int, \r\n    Car_id     int,\r\n    CARI_TIP    VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    CARI_KOD    VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    CARI_UNVAN  VARCHAR(150) COLLATE Turkish_CI_AS,\r\n    VERID       FLOAT,\r\n    RAPID       INT,\r\n    TARIH       DATETIME,\r\n    SAAT        VARCHAR(8)  COLLATE Turkish_CI_AS,\r\n    BELGENO     VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    YKNO        VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    PLAKA       VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    TUTAR       FLOAT,\r\n    ISK_FATTUT  FLOAT,\r\n    ISK_FISTUT  FLOAT)\r\nAS\r\nBEGIN\r\n \r\n DECLARE @ISK_FATYUZDE FLOAT\r\n DECLARE @ISK_FISYUZDE FLOAT\r\n DECLARE @HRK_CARI_UNVAN VARCHAR(100)\r\n declare @CariTip_Id   int\r\n declare @Cari_Id   int\r\n \r\n \r\n select \r\n @CariTip_Id=tip_id,\r\n @Cari_Id=id,\r\n @HRK_CARI_UNVAN=ck.ad,\r\n @ISK_FATYUZDE=fat_iskonto,\r\n @ISK_FISYUZDE=fis_iskonto\r\n from Genel_Kart as ck with (nolock)\r\n  where kod=@CARI_KOD and ck.cartp=@CARI_TIP\r\n  \r\n  \r\n  \r\n\r\n  if ((@AK_TIP='CH') or (@AK_TIP='TEK_CH'))  AND (@CH_TARIH=0) \r\n     INSERT @TB_CARI_FIS_EKSTRE\r\n      (Firmano,Cartip_id,Car_id,CARI_TIP,CARI_KOD,CARI_UNVAN,VERID,RAPID,TARIH,SAAT,BELGENO,YKNO,\r\n      PLAKA,TUTAR,ISK_FATTUT,ISK_FISTUT)\r\n     SELECT v.firmano,@CariTip_Id,@Cari_Id,\r\n      @CARI_TIP,@CARI_KOD,@HRK_CARI_UNVAN,\r\n       verid,fisrap_id,tarih,saat,\r\n       seri+cast([no] as varchar),\r\n       v.ykno,/*YKNO */\r\n       plaka, /*PLAKA */\r\n       CASE WHEN fistip='FISVERSAT' THEN  (toptut-isktop) else -1*(toptut-isktop) end,\r\n       CASE WHEN fistip='FISVERSAT' THEN  (toptut-isktop)*(@ISK_FATYUZDE/100) else 0 end,\r\n       CASE WHEN fistip='FISVERSAT' THEN  (toptut-isktop)*(@ISK_FISYUZDE/100) else 0 end\r\n       FROM veresimas as v with (nolock) \r\n       where cartip=@CARI_TIP and carkod=@CARI_KOD\r\n       and v.sil=0  and v.aktip in ('BK','BL')\r\n       and  v.varok=1 and isnull(devir,0)=0\r\n       ORDER BY tarih\r\n       \r\n       \r\n    if ((@AK_TIP='CH') or (@AK_TIP='TEK_CH'))  AND (@CH_TARIH=1) \r\n     INSERT @TB_CARI_FIS_EKSTRE\r\n      (Firmano,Cartip_id,Car_id,CARI_TIP,CARI_KOD,CARI_UNVAN,VERID,RAPID,TARIH,SAAT,BELGENO,YKNO,\r\n      PLAKA,TUTAR,ISK_FATTUT,ISK_FISTUT)\r\n     SELECT v.firmano,@CariTip_Id,@Cari_Id,\r\n      @CARI_TIP,@CARI_KOD,@HRK_CARI_UNVAN,\r\n       verid,fisrap_id,tarih,saat,\r\n       seri+cast([no] as varchar),\r\n       v.ykno,/*YKNO */\r\n       plaka, /*PLAKA */\r\n       CASE WHEN fistip='FISVERSAT' THEN  (toptut-isktop) else -1*(toptut-isktop) end,\r\n       CASE WHEN fistip='FISVERSAT' THEN  (toptut-isktop)*(@ISK_FATYUZDE/100) else 0 end,\r\n       CASE WHEN fistip='FISVERSAT' THEN  (toptut-isktop)*(@ISK_FISYUZDE/100) else 0 end\r\n       FROM veresimas as v with (nolock) \r\n       where cartip=@CARI_TIP and carkod=@CARI_KOD\r\n       AND tarih>=@BAS_TARIH AND tarih<=@BIT_TARIH\r\n       and v.sil=0  and v.aktip in ('BK','BL')\r\n       and  v.varok=1 and isnull(devir,0)=0\r\n       ORDER BY tarih    \r\n       \r\n\r\n\r\n    if ((@AK_TIP='FT') or (@AK_TIP='TEK_FT')) AND (@CH_TARIH=0) \r\n     INSERT @TB_CARI_FIS_EKSTRE\r\n      (Firmano,Cartip_id,Car_id,CARI_TIP,CARI_KOD,CARI_UNVAN,VERID,RAPID,TARIH,SAAT,BELGENO,YKNO,\r\n      PLAKA,TUTAR,ISK_FATTUT,ISK_FISTUT)\r\n     SELECT v.firmano,@CariTip_Id,@Cari_Id,\r\n      @CARI_TIP,@CARI_KOD,@HRK_CARI_UNVAN,\r\n       verid,fisrap_id,tarih,saat,\r\n       seri+cast([no] as varchar),\r\n       v.ykno,/*YKNO */\r\n       plaka, /*PLAKA */\r\n       CASE WHEN fistip='FISVERSAT' THEN  (toptut-isktop) else -1*(toptut-isktop) end,\r\n       CASE WHEN fistip='FISVERSAT' THEN  (toptut-isktop)*(@ISK_FATYUZDE/100) else 0 end,\r\n       CASE WHEN fistip='FISVERSAT' THEN  (toptut-isktop)*(@ISK_FISYUZDE/100) else 0 end\r\n       FROM veresimas as v with (nolock) \r\n       where cartip=@CARI_TIP and carkod=@CARI_KOD\r\n       and v.sil=0 and v.fistip='FISVERSAT'\r\n       and v.aktip in ('BK','BL')\r\n       and  v.varok=1 and isnull(devir,0)=0\r\n       ORDER BY tarih\r\n\r\n     if ((@AK_TIP='FT') or (@AK_TIP='TEK_FT')) AND (@CH_TARIH=1) \r\n     INSERT @TB_CARI_FIS_EKSTRE\r\n      (Firmano,Cartip_id,Car_id,CARI_TIP,CARI_KOD,CARI_UNVAN,VERID,RAPID,TARIH,SAAT,BELGENO,YKNO,\r\n      PLAKA,TUTAR,ISK_FATTUT,ISK_FISTUT)\r\n     SELECT v.firmano,@CariTip_Id,@Cari_Id,\r\n      @CARI_TIP,@CARI_KOD,@HRK_CARI_UNVAN,\r\n       verid,fisrap_id,tarih,saat,\r\n       seri+cast([no] as varchar),\r\n       v.ykno,/*YKNO */\r\n       plaka, /*PLAKA */\r\n       CASE WHEN fistip='FISVERSAT' THEN  (toptut-isktop) else -1*(toptut-isktop) end,\r\n       CASE WHEN fistip='FISVERSAT' THEN  (toptut-isktop)*(@ISK_FATYUZDE/100) else 0 end,\r\n       CASE WHEN fistip='FISVERSAT' THEN  (toptut-isktop)*(@ISK_FISYUZDE/100) else 0 end\r\n       FROM veresimas as v with (nolock) \r\n       where cartip=@CARI_TIP and carkod=@CARI_KOD\r\n        AND tarih>=@BAS_TARIH AND tarih<=@BIT_TARIH\r\n       and v.sil=0 and v.fistip='FISVERSAT'\r\n       and v.aktip in ('BK','BL')\r\n       and  v.varok=1 and isnull(devir,0)=0\r\n       ORDER BY tarih\r\n  \r\n          \r\n       \r\n\r\n       if @RAP_ID>0\r\n          Delete from @TB_CARI_FIS_EKSTRE where RAPID !=@RAP_ID\r\n\r\n\r\n\r\n\r\n\r\n  RETURN\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_CARIFIS_HRK",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_CARIFIS_HRK",
    "definition": "CREATE FUNCTION [dbo].[UDF_CARIFIS_HRK] (\r\n@RAPTIP   VARCHAR(20),\r\n@CARI_TIP VARCHAR(20),\r\n@CARI_KOD VARCHAR(20),\r\n@TARIH1   DATETIME,\r\n@TARIH2   DATETIME,\r\n@SAAT1    VARCHAR(8),\r\n@SAAT2    VARCHAR(8),\r\n@DEVIR    INT\r\n)\r\nRETURNS \r\n    @TB_CARI_EKSTRE TABLE (\r\n    CARI_TIP    VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    CARI_KOD    VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    CARI_UNVAN  VARCHAR(100) COLLATE Turkish_CI_AS,\r\n    CARI_TEL\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n    CARI_FAX\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n    CARI_CEP\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n    CARI_EMAIL\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n    TARIH       DATETIME,\r\n    SAAT        VARCHAR(8)  COLLATE Turkish_CI_AS,\r\n    VADETARIH       DATETIME,\r\n    BELGENO     VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    YKNO        VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    STOKKOD     VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    STOKAD      VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    MIKTAR      FLOAT,\r\n    BFIYAT      FLOAT,\r\n    KM          float,\r\n    PLAKA       VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    SURUCU      VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    ACIKLAMA    VARCHAR(100) COLLATE Turkish_CI_AS,\r\n    ISLTIPAD    VARCHAR(30)  COLLATE Turkish_CI_AS,\r\n    ISLHRKAD    VARCHAR(30)  COLLATE Turkish_CI_AS,\r\n    YERAD       VARCHAR(30)  COLLATE Turkish_CI_AS,\r\n    KULAD       VARCHAR(50)  COLLATE Turkish_CI_AS,\r\n    ISLTIP      VARCHAR(10)   COLLATE Turkish_CI_AS,\r\n    ISLHRK      VARCHAR(10)   COLLATE Turkish_CI_AS,\r\n    HRKID       FLOAT,\r\n    MASID       FLOAT,\r\n    BORC        FLOAT,\r\n    ALACAK      FLOAT,\r\n    BAKIYE      FLOAT,\r\n    ISKTUTAR    FLOAT,\r\n    FISTUTAR    FLOAT)\r\nAS\r\nBEGIN\r\n  DECLARE @EKSTRE_TEMP TABLE (\r\n    CARI_TIP    VARCHAR(20)  COLLATE Turkish_CI_AS,\r\n    CARI_KOD VARCHAR(20)     COLLATE Turkish_CI_AS,\r\n    CARI_UNVAN  VARCHAR(50)  COLLATE Turkish_CI_AS,\r\n    CARI_TEL\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n    CARI_FAX\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n    CARI_CEP\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n    CARI_EMAIL\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n    TARIH       DATETIME,\r\n    SAAT        VARCHAR(8)   COLLATE Turkish_CI_AS,\r\n    VADETARIH       DATETIME,\r\n    BELGENO    VARCHAR(30)   COLLATE Turkish_CI_AS,\r\n    YKNO        VARCHAR(20)  COLLATE Turkish_CI_AS,\r\n    STOKKOD     VARCHAR(20)  COLLATE Turkish_CI_AS,\r\n    STOKAD      VARCHAR(50)  COLLATE Turkish_CI_AS,\r\n    MIKTAR      FLOAT,\r\n    BFIYAT      FLOAT,\r\n    KM          FLOAT,\r\n    PLAKA       VARCHAR(50)   COLLATE Turkish_CI_AS,\r\n    SURUCU      VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    ACIKLAMA    VARCHAR(100)  COLLATE Turkish_CI_AS,\r\n    ISLTIPAD    VARCHAR(30)   COLLATE Turkish_CI_AS,\r\n    ISLHRKAD    VARCHAR(30)   COLLATE Turkish_CI_AS,\r\n    YERAD       VARCHAR(30)   COLLATE Turkish_CI_AS,\r\n    KULAD       VARCHAR(50)   COLLATE Turkish_CI_AS,\r\n    ISLTIP      VARCHAR(10)   COLLATE Turkish_CI_AS,\r\n    ISLHRK      VARCHAR(10)   COLLATE Turkish_CI_AS,\r\n    HRKID       FLOAT,\r\n    MASID       FLOAT,\r\n    BORC        FLOAT,\r\n    ALACAK      FLOAT,\r\n    BAKIYE      FLOAT,\r\n    ISKTUTAR    FLOAT,\r\n    FISID       FLOAT,\r\n    FISTUTAR    FLOAT)\r\n\r\n  DECLARE @HRK_CARI_TIP    VARCHAR(20)\r\n  DECLARE @HRK_CARI_KOD    VARCHAR(20)\r\n  DECLARE @HRK_CARI_UNVAN  VARCHAR(50)\r\n  DECLARE @HRK_CARI_TEL  VARCHAR(50)\r\n  DECLARE @HRK_CARI_FAX  VARCHAR(50)\r\n  DECLARE @HRK_CARI_CEP  VARCHAR(50)\r\n  DECLARE @HRK_CARI_EMAIL  VARCHAR(50)\r\n  \r\n  \r\n  DECLARE @HRK_VADETARIH       DATETIME \r\n  DECLARE @HRK_TARIH       DATETIME\r\n  DECLARE @HRK_SAAT        VARCHAR(8)\r\n  DECLARE @HRK_BELGENO     VARCHAR(30)\r\n  DECLARE @HRK_YKNO        VARCHAR(20)\r\n  DECLARE @HRK_STOKKOD     VARCHAR(20)\r\n  DECLARE @HRK_STOKAD      VARCHAR(50)\r\n  DECLARE @HRK_MIKTAR      FLOAT\r\n  DECLARE @HRK_BFIYAT      FLOAT\r\n  DECLARE @HRK_KM          FLOAT\r\n  DECLARE @HRK_PLAKA       VARCHAR(50)\r\n  DECLARE @HRK_SURUCU      VARCHAR(50)\r\n  DECLARE @HRK_ACIKLAMA    VARCHAR(100)\r\n  DECLARE @HRK_ISLTIPAD    VARCHAR(30)\r\n  DECLARE @HRK_ISLHRKAD    VARCHAR(30)\r\n  DECLARE @HRK_YERAD       VARCHAR(30)\r\n  DECLARE @HRK_KULAD       VARCHAR(50)\r\n  DECLARE @HRK_ISLTIP      VARCHAR(10)\r\n  DECLARE @HRK_ISLHRK      VARCHAR(10)\r\n  DECLARE @HRK_HRKID       FLOAT\r\n  DECLARE @HRK_MASID       FLOAT\r\n  DECLARE @HRK_BORC        FLOAT\r\n  DECLARE @HRK_ALACAK      FLOAT\r\n  DECLARE @HRK_BAKIYE      FLOAT\r\n  DECLARE @KUM_BAKIYE      FLOAT\r\n  DECLARE @HRK_ISKTUTAR    FLOAT\r\n  DECLARE @HRK_FISID       FLOAT \r\n  DECLARE @HRK_FISTUTAR    FLOAT \r\n  \r\n  SET @KUM_BAKIYE = 0\r\n\r\n  \r\n  DECLARE @OTO_VADEFARK BIT\r\n\r\n   select @HRK_CARI_UNVAN=ck.ad,\r\n     @HRK_CARI_TEL=ck.tel,\r\n      @HRK_CARI_FAX=ck.fax,\r\n      @HRK_CARI_CEP=ck.cep,\r\n      @HRK_CARI_EMAIL=ck.mail,\r\n      @OTO_VADEFARK=Oto_FisVadeFark\r\n         \r\n from Genel_Kart as ck with (nolock) \r\n where kod=@CARI_KOD and ck.cartp=@CARI_TIP\r\n \r\n \r\n declare @FatFisIskYansit   bit\r\n  \r\n \r\n select top 1 @FatFisIskYansit=FaturaFisIskonto from sistemtanim  \r\n \r\n \r\n \r\n \r\n \r\n\r\n  /* Devir atanıyor */\r\n  \r\n  \r\n/*- HRK VE AKTARILMAMIS FİŞ DOKUMLERİ */\r\n  if @RAPTIP='HRK_BEKFIS'\r\n  BEGIN\r\n  IF @DEVIR=1\r\n   BEGIN\r\n          INSERT @EKSTRE_TEMP\r\n            SELECT\r\n              '',/*CARI TIP */\r\n              @CARI_KOD, /* CARI_KOD */\r\n              @HRK_CARI_UNVAN, /* CARI_UNVAN */\r\n              @HRK_CARI_TEL,\r\n              @HRK_CARI_FAX,\r\n              @HRK_CARI_CEP,\r\n              @HRK_CARI_EMAIL,\r\n              @TARIH1,\r\n              @SAAT1,\r\n              @TARIH1,\r\n              'DEVİR', /* BELGE NO */\r\n              '',/*YKNO */\r\n              '',/*STOKKOD */\r\n              '',/*STOKAD */\r\n              0,/*MİKTAR */\r\n              0,/*BFIYAT */\r\n              0,\r\n              '', /*PLAKA */\r\n              '',/*SURUCU */\r\n              CONVERT(VARCHAR(10), @TARIH1, 104) +' DEVİR BAKİYESİ', /* AÇIKLAMA */\r\n              '-','-','-','-','-','-',0,0,\r\n              ISNULL(SUM(CASE WHEN borc>0 THEN borc ELSE 0 END),0), /* BORC */\r\n              ISNULL(SUM(CASE WHEN alacak>0 THEN alacak ELSE 0 END),0), /* ALACAK */\r\n              ISNULL(SUM((borc-alacak)),0),\r\n              0,0,0              \r\n              FROM carihrk WITH (NOLOCK)\r\n              WHERE cartip=@CARI_TIP and carkod=@CARI_KOD\r\n             /*and islmhrk not in ('CAK','FATVERSAT') */\r\n              and sil=0  AND tarih < @TARIH1\r\n\r\n              SELECT @KUM_BAKIYE = BAKIYE FROM @EKSTRE_TEMP\r\n\r\n     \r\n              /* veresiye hareketlerinden gelen bakiye alınıyor */\r\n            SELECT\r\n                @HRK_BORC   = ISNULL(SUM(case when fistip='FISVERSAT' THEN toptut-isktop else 0 end ),0),\r\n                @HRK_ALACAK = ISNULL(SUM(case when fistip='FISALCSAT' THEN toptut-isktop else 0 end),0),\r\n                @HRK_BAKIYE = ISNULL(SUM(case when fistip='FISVERSAT' then toptut-isktop else -toptut-isktop end  ),0)\r\n              FROM veresimas WITH (NOLOCK)\r\n              WHERE cartip=@CARI_TIP and carkod=@CARI_KOD \r\n              and aktip in ('BK','BL')\r\n              and sil=0  AND tarih < @TARIH1\r\n\r\n              /* Faturalardan gelen bakiye hareketlerden gelen bakiyeye ekleniyor */\r\n              UPDATE @EKSTRE_TEMP SET\r\n                BORC    = BORC    + @HRK_BORC,\r\n                ALACAK  = ALACAK  + @HRK_ALACAK,\r\n                BAKIYE  = BAKIYE  + @HRK_BAKIYE\r\n\r\n              /* Kümülatif bakiye için kullanılacak değişkene devir bakiyesi atanıyor. */\r\n               SELECT @KUM_BAKIYE = BAKIYE FROM @EKSTRE_TEMP\r\n         END\r\n    END /*'HRK_BEKFIS' */\r\n    \r\n  if @RAPTIP='HRK_TUMFIS'\r\n  BEGIN\r\n  IF @DEVIR=1\r\n   BEGIN\r\n          INSERT @EKSTRE_TEMP\r\n            SELECT\r\n              '',/*CARI TIP */\r\n              @CARI_KOD, /* CARI_KOD */\r\n              @HRK_CARI_UNVAN, /* CARI_UNVAN */\r\n              @HRK_CARI_TEL,\r\n              @HRK_CARI_FAX,\r\n              @HRK_CARI_CEP,\r\n              @HRK_CARI_EMAIL,\r\n              @TARIH1,\r\n              @SAAT1,\r\n              @TARIH1,\r\n              'DEVİR', /* BELGE NO */\r\n              '',/*YKNO */\r\n              '',/*STOKKOD */\r\n              '',/*STOKAD */\r\n              0,/*MİKTAR */\r\n              0,/*BFIYAT */\r\n              0,\r\n              '', /*PLAKA */\r\n              '',/*SURUCU */\r\n              CONVERT(VARCHAR(10), @TARIH1, 104) +' DEVİR BAKİYESİ', /* AÇIKLAMA */\r\n              '-','-','-','-','-','-',0,0,\r\n              ISNULL(SUM(CASE WHEN borc>0 THEN borc ELSE 0 END),0), /* BORC */\r\n              ISNULL(SUM(CASE WHEN alacak>0 THEN alacak ELSE 0 END),0), /* ALACAK */\r\n              ISNULL(SUM((borc-alacak)),0),0,0,0\r\n              FROM carihrk with (nolock)\r\n              WHERE cartip=@CARI_TIP and carkod=@CARI_KOD\r\n              and islmhrk not in ('CAK','FATVERSAT','FATTTSSAT')\r\n              and sil=0  AND tarih < @TARIH1\r\n\r\n              SELECT @KUM_BAKIYE = BAKIYE FROM @EKSTRE_TEMP\r\n\r\n           \r\n              /* veresiye hareketlerinden gelen bakiye alınıyor */\r\n             /* if @FatFisIskYansit=0\r\n              SELECT\r\n                @HRK_BORC   = ISNULL(SUM(case when fistip='FISVERSAT' THEN toptut-isktop else 0 end ),0),\r\n                @HRK_ALACAK = ISNULL(SUM(case when fistip='FISALCSAT' THEN toptut-isktop else 0 end),0),\r\n                @HRK_BAKIYE = ISNULL(SUM(case when fistip='FISVERSAT' then toptut-isktop else -toptut-isktop end  ),0)\r\n               FROM veresimas as v with (nolock) \r\n               WHERE v.cartip=@CARI_TIP and v.carkod=@CARI_KOD\r\n               and isnull(v.devir,0)=0\r\n               and v.sil=0  AND v.tarih < @TARIH1\r\n           \r\n              \r\n              if @FatFisIskYansit=1\r\n              */\r\n              SELECT\r\n               @HRK_BORC   = ISNULL(SUM(CASE WHEN v.fistip='FISVERSAT' THEN  (h.brmfiy*(1-(isnull(h.Fat_IskYuz,0)/100)))*h.mik else 0 end ),0),\r\n               @HRK_ALACAK = ISNULL(SUM(CASE WHEN v.fistip='FISALCSAT' THEN (h.brmfiy*(1-(isnull(h.Fat_IskYuz,0)/100)))*h.mik else 0 end ),0),\r\n               @HRK_BAKIYE = ISNULL(SUM(CASE WHEN v.fistip='FISVERSAT' THEN  -1*(h.brmfiy*(1-(isnull(h.Fat_IskYuz,0)/100)))*h.mik else\r\n               (h.brmfiy*(1-(isnull(h.Fat_IskYuz,0)/100)))*h.mik end ),0)\r\n               FROM veresimas as v with (nolock) \r\n               inner join veresihrk h with (nolock) on\r\n               v.verid=h.verid and h.sil=0 and \r\n               v.cartip=@CARI_TIP and v.carkod=@CARI_KOD\r\n               and isnull(v.devir,0)=0\r\n               and v.sil=0  AND v.tarih < @TARIH1\r\n               \r\n         \r\n              \r\n\r\n              /* Faturalardan gelen bakiye hareketlerden gelen bakiyeye ekleniyor */\r\n              UPDATE @EKSTRE_TEMP SET\r\n                BORC    = BORC    + @HRK_BORC,\r\n                ALACAK  = ALACAK  + @HRK_ALACAK,\r\n                BAKIYE  = BAKIYE  + @HRK_BAKIYE\r\n                \r\n              /* Kümülatif bakiye için kullanılacak değişkene devir bakiyesi atanıyor. */\r\n               SELECT @KUM_BAKIYE = BAKIYE FROM @EKSTRE_TEMP\r\n         END\r\n      END /*'HRK_TUMFIS' */\r\n\r\n  if @RAPTIP='HRK_BEKFIS'\r\n   BEGIN\r\n    DECLARE CRS_HRK CURSOR FAST_FORWARD FOR\r\n    SELECT\r\n      @CARI_TIP,@CARI_KOD,@HRK_CARI_UNVAN,\r\n      @HRK_CARI_TEL,\r\n       @HRK_CARI_FAX,\r\n       @HRK_CARI_CEP,\r\n      @HRK_CARI_EMAIL,\r\n       tarih,saat,vadetar,belno,\r\n       '',/*YKNO */\r\n       '',/*STOKKOD */\r\n       '',/*STOKAD */\r\n       0,/*MİKTAR */\r\n       0,/*BFIYAT */\r\n       0,\r\n       '', /*PLAKA */\r\n       '',/*SURUCU */\r\n      ack, /* AÇIKLAMA, */\r\n      islmtipad,islmhrkad,yerad,olususer,islmtip,islmhrk,carhrkid,masterid,\r\n      borc,\r\n      alacak,\r\n      borc-alacak AS BAKIYE,\r\n      0 ISKTUTAR,0 FISID,0 FISTUTAR\r\n    FROM carihrk with (nolock)\r\n    WHERE cartip=@CARI_TIP and carkod=@CARI_KOD\r\n     /*and islmhrk not in ('CAK','FATVERSAT') */\r\n     and sil=0 AND (tarih >= @TARIH1)\r\n     AND (tarih <= @TARIH2)\r\n     UNION ALL\r\n    /* veresiye Hareketleri */\r\n     SELECT\r\n      @CARI_TIP,@CARI_KOD,@HRK_CARI_UNVAN,\r\n      @HRK_CARI_TEL,\r\n      @HRK_CARI_FAX,\r\n      @HRK_CARI_CEP,\r\n      @HRK_CARI_EMAIL,\r\n       tarih,saat,vadtar,\r\n       seri+cast([no] as varchar),\r\n       m.ykno,/*YKNO */\r\n       stkod,\r\n       s.ad,\r\n       mik,\r\n       brmfiy,/*BFIYAT */\r\n       km,\r\n       plaka, /*PLAKA */\r\n       surucu,/*SURUCU */\r\n       ack, /* AÇIKLAMA, */\r\n       fisad,fisad,yerad,h.olususer,'-',fistip,m.verid,0,\r\n       CASE WHEN fistip='FISVERSAT' THEN  (brmfiy*(1-(iskyuz/100)))*mik else 0 end,\r\n       CASE WHEN fistip='FISALCSAT' THEN (brmfiy*(1-(iskyuz/100)))*mik else 0 end,\r\n       CASE WHEN fistip='FISALCSAT' THEN  -1*(brmfiy*(1-(iskyuz/100)))*mik else\r\n       (brmfiy*(1-(iskyuz/100)))*mik end AS BAKIYE,\r\n       (brmfiy*((iskyuz/100)))*mik AS ISKTUTAR,M.verid FISID,0 FISTUTAR\r\n       \r\n       \r\n    FROM veresihrk as h with (nolock) \r\n    inner join veresimas as m with (nolock)\r\n    on h.verid=m.verid\r\n    and m.sil=0 and h.sil=0 \r\n    left join gelgidlistok as s on \r\n    s.kod=h.stkod\r\n    and s.tip=h.stktip\r\n     where cartip=@CARI_TIP and carkod=@CARI_KOD and aktip in ('BK','BL')\r\n     and (tarih >= @TARIH1) AND (tarih <= @TARIH2)\r\n    ORDER BY tarih,saat\r\n  END /*- 'HRK_BEKFIS' */\r\n\r\n\r\n\r\n\r\n\r\n  if @RAPTIP='HRK_TUMFIS'\r\n   BEGIN\r\n   \r\n \r\n    DECLARE CRS_HRK CURSOR FAST_FORWARD FOR\r\n    /* Cari Fişlerden gelen harektler */\r\n     SELECT\r\n      @CARI_TIP,@CARI_KOD,@HRK_CARI_UNVAN,\r\n      @HRK_CARI_TEL,\r\n      @HRK_CARI_FAX,\r\n      @HRK_CARI_CEP,\r\n      @HRK_CARI_EMAIL,\r\n       tarih,saat,Vadetar,belno,\r\n       '',/*YKNO */\r\n       '',/*STOKKOD */\r\n       '',/*STOKAD */\r\n       0,/*MİKTAR */\r\n       0,/*BFIYAT */\r\n       0,\r\n       '', /*PLAKA */\r\n       '',/*SURUCU */\r\n      ack, /* AÇIKLAMA, */\r\n      islmtipad,islmhrkad,yerad,olususer,islmtip,islmhrk,carhrkid,masterid,\r\n      borc,\r\n      alacak,\r\n      borc-alacak AS BAKIYE,\r\n      0 ISKTUTAR,0 FISID,0 FISTUTAR\r\n    FROM carihrk with (nolock)\r\n    WHERE cartip=@CARI_TIP and carkod=@CARI_KOD\r\n     and islmhrk not in ('CAK','FATVERSAT','FATTTSSAT')\r\n     and sil=0 AND (tarih >= @TARIH1) AND (tarih <= @TARIH2)\r\n     UNION ALL\r\n    /* veresiye Hareketleri */\r\n    \r\n     SELECT\r\n      @CARI_TIP,@CARI_KOD,@HRK_CARI_UNVAN,\r\n      @HRK_CARI_TEL,\r\n      @HRK_CARI_FAX,\r\n      @HRK_CARI_CEP,\r\n      @HRK_CARI_EMAIL,\r\n       tarih,saat,vadtar,\r\n       seri+cast([no] as varchar),\r\n       m.ykno,/*YKNO */\r\n       stkod,\r\n       s.ad,\r\n       mik,\r\n       brmfiy,/*BFIYAT */\r\n       km,\r\n       plaka, /*PLAKA */\r\n       surucu,/*SURUCU */\r\n       ack, /* AÇIKLAMA, */\r\n       fisad,fisad,yerad,h.olususer,'-',fistip,m.verid,0,\r\n       CASE WHEN fistip='FISVERSAT' THEN  (brmfiy*(1-(isnull(Fat_IskYuz,0)/100)))*mik else 0 end,\r\n       CASE WHEN fistip='FISALCSAT' THEN (brmfiy*(1-(isnull(Fat_IskYuz,0)/100)))*mik else 0 end,\r\n       CASE WHEN fistip='FISALCSAT' THEN  -1*(brmfiy*(1-(isnull(Fat_IskYuz,0)/100)))*mik \r\n       else (brmfiy*(1-(isnull(Fat_IskYuz,0)/100)))*mik end AS BAKIYE,\r\n       (brmfiy*((isnull(Fat_IskYuz,0)/100)))*mik AS ISKTUTAR,m.verid FISID,0 FISTUTAR\r\n       FROM veresihrk as h with (nolock) inner join veresimas as m  with (nolock)on\r\n       h.verid=m.verid\r\n       and m.sil=0 and h.sil=0 \r\n       left join gelgidlistok as s on \r\n      s.kod=h.stkod\r\n      and s.tip=h.stktip\r\n      where cartip=@CARI_TIP and carkod=@CARI_KOD /*and aktip in ('BK','BL') */\r\n      and (tarih >= @TARIH1) AND (tarih <= @TARIH2)\r\n      and isnull(m.devir,0)=0\r\n      ORDER BY tarih,saat\r\n    \r\n    \r\n    \r\n    END /*'HRK_TUMFIS' */\r\n\r\n \r\n \r\n     OPEN CRS_HRK\r\n\r\n       FETCH NEXT FROM CRS_HRK INTO\r\n       @HRK_CARI_TIP,@HRK_CARI_KOD,@HRK_CARI_UNVAN,\r\n       @HRK_CARI_TEL,@HRK_CARI_FAX,@HRK_CARI_CEP,@HRK_CARI_EMAIL,\r\n       @HRK_TARIH,@HRK_SAAT,@HRK_VADETARIH,@HRK_BELGENO,@HRK_YKNO,@HRK_STOKKOD,\r\n       @HRK_STOKAD,@HRK_MIKTAR,@HRK_BFIYAT,@HRK_KM,@HRK_PLAKA,@HRK_SURUCU,@HRK_ACIKLAMA,\r\n       @HRK_ISLTIPAD,@HRK_ISLHRKAD,@HRK_YERAD,@HRK_KULAD,@HRK_ISLTIP,@HRK_ISLHRK,@HRK_HRKID,@HRK_MASID,\r\n       @HRK_BORC,@HRK_ALACAK,@HRK_BAKIYE,@HRK_ISKTUTAR,@HRK_FISID,@HRK_FISTUTAR \r\n\r\n      WHILE @@FETCH_STATUS = 0\r\n      BEGIN\r\n        SET @KUM_BAKIYE = @KUM_BAKIYE + @HRK_BAKIYE\r\n        \r\n        if @HRK_FISID>0\r\n         SET @HRK_FISTUTAR=@HRK_ISKTUTAR+@HRK_BORC\r\n        \r\n       \r\n        INSERT @EKSTRE_TEMP\r\n          SELECT\r\n           @HRK_CARI_TIP,@HRK_CARI_KOD,@HRK_CARI_UNVAN,\r\n           @HRK_CARI_TEL,@HRK_CARI_FAX,@HRK_CARI_CEP,@HRK_CARI_EMAIL,\r\n           @HRK_TARIH,@HRK_SAAT,@HRK_VADETARIH,@HRK_BELGENO,@HRK_YKNO,@HRK_STOKKOD,\r\n           @HRK_STOKAD,@HRK_MIKTAR,@HRK_BFIYAT,@HRK_KM,@HRK_PLAKA,@HRK_SURUCU,@HRK_ACIKLAMA,\r\n           @HRK_ISLTIPAD,@HRK_ISLHRKAD,@HRK_YERAD,@HRK_KULAD,@HRK_ISLTIP,@HRK_ISLHRK,@HRK_HRKID,@HRK_MASID,\r\n           @HRK_BORC, @HRK_ALACAK,@KUM_BAKIYE,@HRK_ISKTUTAR,@HRK_FISID,@HRK_FISTUTAR\r\n   \r\n        FETCH NEXT FROM CRS_HRK INTO\r\n          @HRK_CARI_TIP,@HRK_CARI_KOD, @HRK_CARI_UNVAN,\r\n          @HRK_CARI_TEL,@HRK_CARI_FAX,@HRK_CARI_CEP,@HRK_CARI_EMAIL,\r\n          @HRK_TARIH,@HRK_SAAT,@HRK_VADETARIH,@HRK_BELGENO,@HRK_YKNO,@HRK_STOKKOD,\r\n          @HRK_STOKAD,@HRK_MIKTAR,@HRK_BFIYAT,@HRK_KM,@HRK_PLAKA,@HRK_SURUCU,@HRK_ACIKLAMA,\r\n          @HRK_ISLTIPAD,@HRK_ISLHRKAD,@HRK_YERAD,@HRK_KULAD,@HRK_ISLTIP,@HRK_ISLHRK,@HRK_HRKID,@HRK_MASID,\r\n          @HRK_BORC, @HRK_ALACAK, @HRK_BAKIYE,@HRK_ISKTUTAR,@HRK_FISID,@HRK_FISTUTAR\r\n      END\r\n\r\n      CLOSE CRS_HRK\r\n      DEALLOCATE CRS_HRK\r\n      \r\n      \r\n      \r\n     if @OTO_VADEFARK=1\r\n     begin\r\n     \r\n     if @TARIH2>=DATEADD(day, DATEDIFF(day, 0, GETDATE()), 0)\r\n       set @TARIH2=DATEADD(day, DATEDIFF(day, 0, GETDATE()), 0)\r\n     \r\n      delete from @EKSTRE_TEMP where ISLTIP='VAD' and ISLHRK='OFV'\r\n\r\n     INSERT @EKSTRE_TEMP\r\n     (CARI_TIP,CARI_KOD,CARI_UNVAN,\r\n     CARI_TEL,CARI_FAX,CARI_CEP,CARI_EMAIL,\r\n     TARIH,SAAT,VADETARIH,BELGENO,\r\n     YKNO,STOKKOD,STOKAD,MIKTAR,BFIYAT,\r\n     KM,PLAKA,SURUCU,ACIKLAMA,\r\n     ISLTIPAD,ISLHRKAD,YERAD,\r\n     KULAD,ISLTIP,ISLHRK,\r\n     HRKID,MASID,\r\n     BORC,ALACAK,BAKIYE,ISKTUTAR,FISTUTAR)\r\n     SELECT @CARI_TIP,@CARI_KOD,@HRK_CARI_UNVAN,\r\n     @HRK_CARI_TEL,@HRK_CARI_FAX,@HRK_CARI_CEP,@HRK_CARI_EMAIL,\r\n     @TARIH2,CONVERT(VARCHAR(8),GETDATE(),108),@TARIH2,'',\r\n     '','','',0,0,0,\r\n     '','','OTOMATİK FİŞ VADE FARKI',\r\n     'VADE','CARİ OTO. FİŞ VADE FARKI','CARİ KART',\r\n     'SERVIS','VAD','OFV',\r\n     0,0,\r\n     ISNULL(v.CARI_VADETUTAR,0),0,0,0,0 \r\n     from UDF_CariFisVadeFark_Tarih (@CARI_KOD,@TARIH2) AS v\r\n    \r\n    end\r\n      \r\n       \r\n      \r\n\r\n\r\n    INSERT @TB_CARI_EKSTRE\r\n    SELECT CARI_TIP,CARI_KOD,CARI_UNVAN,\r\n    CARI_TEL,CARI_FAX,CARI_CEP,CARI_EMAIL,\r\n    TARIH,SAAT,VADETARIH,BELGENO,YKNO,STOKKOD,\r\n    STOKAD,MIKTAR,BFIYAT,KM,PLAKA,SURUCU,ACIKLAMA,ISLTIPAD,ISLHRKAD,YERAD,KULAD,ISLTIP,ISLHRK,\r\n    HRKID,MASID,BORC,ALACAK,BAKIYE,ISKTUTAR,FISTUTAR FROM @EKSTRE_TEMP\r\n\r\n  RETURN\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_CARIFIS_TARIH_KM",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_CARIFIS_TARIH_KM",
    "definition": "CREATE FUNCTION dbo.[UDF_CARIFIS_TARIH_KM] (\r\n@CARI_TIP VARCHAR(20),\r\n@CARIKOD_IN  VARCHAR(8000),\r\n@VERIDIN  VARCHAR(8000),\r\n@TARINDEX  INT,\r\n@TARIH1 DATETIME,\r\n@TARIH2 DATETIME,\r\n@AKTIPIN VARCHAR(30),\r\n@PLAKA   VARCHAR(30))\r\nRETURNS\r\n    @TB_FIS_TARIH TABLE (\r\n    Verid       INT,\r\n    CARI_TIP\t\tVARCHAR(20) COLLATE Turkish_CI_AS,\r\n    CARI_KOD\t\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n    STK_KOD     VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    STK_AD      VARCHAR(150) COLLATE Turkish_CI_AS,\r\n    STK_BRM     VARCHAR(10) COLLATE Turkish_CI_AS,\r\n    TARIH       DATETIME,\r\n    SAAT        VARCHAR(10) COLLATE Turkish_CI_AS,\r\n    PLAKA       VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    SURUCU      VARCHAR(100) COLLATE Turkish_CI_AS,\r\n    ONCEKI_KM    FLOAT,    \r\n    KM          FLOAT,\r\n    FARK_KM     FLOAT DEFAULT 0,\r\n    LITRE_KM    FLOAT DEFAULT 0,\r\n    FISNO       VARCHAR(40) COLLATE Turkish_CI_AS,\r\n    YKNO        VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    YKFISNO     VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    ACK\t\t\tVARCHAR(200) COLLATE Turkish_CI_AS,\r\n    MIKTAR      FLOAT,\r\n    BRMFIY      FLOAT,\r\n    TUTAR       FLOAT,\r\n    VADTAR      DATETIME)\r\nAS\r\nBEGIN\r\n    DECLARE     @TB_FIS TABLE (\r\n    Verid       INT,\r\n    CARI_TIP\t\tVARCHAR(20) COLLATE Turkish_CI_AS,\r\n    CARI_KOD\t\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n    STK_KOD     VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    STK_AD      VARCHAR(150) COLLATE Turkish_CI_AS,\r\n    STK_BRM     VARCHAR(10) COLLATE Turkish_CI_AS,\r\n    TARIH       DATETIME,\r\n    SAAT        VARCHAR(10) COLLATE Turkish_CI_AS,\r\n    PLAKA       VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    SURUCU      VARCHAR(100) COLLATE Turkish_CI_AS,\r\n    ONCEKI_KM    FLOAT,  \r\n    KM          FLOAT,\r\n    FARK_KM     FLOAT DEFAULT 0,\r\n    LITRE_KM    FLOAT DEFAULT 0,\r\n    FISNO       VARCHAR(40) COLLATE Turkish_CI_AS,\r\n    YKNO        VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    YKFISNO     VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    ACK\t\t\tVARCHAR(200) COLLATE Turkish_CI_AS,\r\n    MIKTAR      FLOAT,\r\n    BRMFIY      FLOAT,\r\n    TUTAR       FLOAT,\r\n    VADTAR      DATETIME,\r\n    AKTIP       VARCHAR(10) COLLATE Turkish_CI_AS)\r\n    \r\n    \r\n    \r\n\r\n  if (@TARINDEX=0) AND (@VERIDIN<>'') and  (@CARIKOD_IN<>'') \r\n  begin\r\n  insert @TB_FIS (Verid,CARI_TIP,CARI_KOD,STK_KOD,STK_AD,STK_BRM,PLAKA,SURUCU,ONCEKI_KM,KM,TARIH,SAAT,\r\n  YKNO,YKFISNO,FISNO,MIKTAR,BRMFIY,TUTAR,VADTAR,AKTIP,ACK)\r\n  SELECT fis.verid,fis.cartip,fis.carkod,fishrk.stkod,gstk.ad,fishrk.brim,\r\n  fis.plaka,fis.surucu,fis.OncekiKm,fis.km,fis.tarih,fis.saat,\r\n  fis.ykno AS YKNO,fis.YkFisNo,\r\n  seri+cast([no] as varchar) AS FISNO,\r\n  case WHEN Fistip='FISVERSAT' then\r\n  fishrk.mik else\r\n  -1*(fishrk.mik) end,\r\n  fishrk.brmfiy,\r\n  case WHEN Fistip='FISVERSAT' then\r\n  fishrk.mik*fishrk.brmfiy else\r\n  -1*(fishrk.mik*fishrk.brmfiy) end,\r\n  fis.vadtar,\r\n  fis.aktip,fis.ack from veresimas as fis with (nolock) \r\n  inner join veresihrk as fishrk with (nolock) \r\n  on fishrk.verid=fis.verid\r\n  and fishrk.sil=0 and cartip=@CARI_TIP \r\n  and carkod IN (SELECT * FROM CsvNokVirToSTR(@CARIKOD_IN))\r\n  and (fis.tarih+cast(fis.saat as datetime))>=@TARIH1 \r\n  and (fis.tarih+cast(fis.saat as datetime))<=@TARIH2\r\n  and fis.verid in (select * from dbo.CsvToInt(@VERIDIN))\r\n  inner join gelgidlistok as gstk\r\n  on gstk.kod=fishrk.stkod and gstk.tip=fishrk.stktip\r\n  order by tarih\r\n  end\r\n  \r\n  \r\n  if (@TARINDEX=0) AND (@VERIDIN='') and  (@CARIKOD_IN<>'')\r\n  begin\r\n  insert @TB_FIS (Verid,CARI_TIP,CARI_KOD,STK_KOD,STK_AD,STK_BRM,PLAKA,SURUCU,ONCEKI_KM,KM,TARIH,SAAT,\r\n  YKNO,YKFISNO,FISNO,MIKTAR,BRMFIY,TUTAR,VADTAR,AKTIP,ACK)\r\n  SELECT fis.verid,fis.cartip,fis.carkod,fishrk.stkod,gstk.ad,fishrk.brim,\r\n  fis.plaka,fis.surucu,fis.OncekiKm,fis.km,fis.tarih,fis.saat,\r\n  fis.ykno AS YKNO,fis.YkFisNo,\r\n  seri+cast([no] as varchar) AS FISNO,\r\n   case WHEN Fistip='FISVERSAT' then\r\n  fishrk.mik else\r\n  -1*(fishrk.mik) end,\r\n  fishrk.brmfiy,\r\n  case WHEN Fistip='FISVERSAT' then\r\n  fishrk.mik*fishrk.brmfiy else\r\n  -1*(fishrk.mik*fishrk.brmfiy) end,\r\n  fis.vadtar,\r\n  fis.aktip,fis.ack from veresimas as fis with (nolock) \r\n  inner join veresihrk as fishrk with (nolock) \r\n  on fishrk.verid=fis.verid\r\n  and fishrk.sil=0 and cartip=@CARI_TIP \r\n  and carkod IN (SELECT * FROM CsvNokVirToSTR(@CARIKOD_IN))\r\n  and (fis.tarih+cast(fis.saat as datetime))>=@TARIH1 \r\n  and (fis.tarih+cast(fis.saat as datetime))<=@TARIH2\r\n  inner join gelgidlistok as gstk\r\n  on gstk.kod=fishrk.stkod and gstk.tip=fishrk.stktip\r\n  order by tarih\r\n  end\r\n  \r\n  \r\n\r\n  if (@TARINDEX=1) AND (@VERIDIN<>'') and  (@CARIKOD_IN<>'')\r\n  begin\r\n  insert @TB_FIS (Verid,CARI_TIP,CARI_KOD,STK_KOD,STK_AD,STK_BRM,PLAKA,SURUCU,ONCEKI_KM,KM,TARIH,SAAT,\r\n  YKNO,YKFISNO,FISNO,MIKTAR,BRMFIY,TUTAR,VADTAR,AKTIP,ACK)\r\n  SELECT fis.verid,fis.cartip,fis.carkod,fishrk.stkod,gstk.ad,fishrk.brim,\r\n  fis.plaka,fis.surucu,fis.OncekiKm,fis.km,fis.tarih,fis.saat,\r\n  fis.ykno AS YKNO,fis.YkFisNo,\r\n  seri+cast([no] as varchar) AS FISNO,\r\n  case WHEN Fistip='FISVERSAT' then\r\n  fishrk.mik else\r\n  -1*(fishrk.mik) end,fishrk.brmfiy,\r\n  case WHEN Fistip='FISVERSAT' then\r\n  fishrk.mik*fishrk.brmfiy else\r\n  -1*(fishrk.mik*fishrk.brmfiy) end,\r\n  fis.vadtar,\r\n  fis.aktip,fis.ack from veresimas as fis with (nolock)\r\n  inner join veresihrk as fishrk with (nolock)\r\n  on fishrk.verid=fis.verid\r\n  and fishrk.sil=0 and cartip=@CARI_TIP \r\n   and carkod IN (SELECT * FROM CsvNokVirToSTR(@CARIKOD_IN))\r\n  and fis.vadtar>=@TARIH1 and fis.vadtar<=@TARIH2\r\n  and fis.verid in (select * from dbo.CsvToInt(@VERIDIN))\r\n  inner join gelgidlistok as gstk\r\n  on gstk.kod=fishrk.stkod and gstk.tip=fishrk.stktip\r\n    order by tarih\r\n  end\r\n  \r\n  \r\n  \r\n  if (@TARINDEX=1) AND (@VERIDIN='') and  (@CARIKOD_IN<>'')\r\n  begin\r\n  insert @TB_FIS (Verid,CARI_TIP,CARI_KOD,STK_KOD,STK_AD,STK_BRM,PLAKA,SURUCU,ONCEKI_KM,KM,TARIH,SAAT,\r\n  YKNO,YKFISNO,FISNO,MIKTAR,BRMFIY,TUTAR,VADTAR,AKTIP,ACK)\r\n  SELECT fis.verid,fis.cartip,fis.carkod,fishrk.stkod,gstk.ad,fishrk.brim,\r\n  fis.plaka,fis.surucu,fis.OncekiKm,fis.km,fis.tarih,fis.saat,\r\n  fis.ykno AS YKNO,fis.YkFisNo,\r\n  seri+cast([no] as varchar) AS FISNO,\r\n  case WHEN Fistip='FISVERSAT' then\r\n  fishrk.mik else\r\n  -1*(fishrk.mik) end,fishrk.brmfiy,\r\n  case WHEN Fistip='FISVERSAT' then\r\n  fishrk.mik*fishrk.brmfiy else\r\n  -1*(fishrk.mik*fishrk.brmfiy) end,\r\n  fis.vadtar,\r\n  fis.aktip,fis.ack from veresimas as fis with (nolock)\r\n  inner join veresihrk as fishrk with (nolock)\r\n  on fishrk.verid=fis.verid\r\n  and fishrk.sil=0 and cartip=@CARI_TIP \r\n   and carkod IN (SELECT * FROM CsvNokVirToSTR(@CARIKOD_IN))\r\n  and fis.vadtar>=@TARIH1 and fis.vadtar<=@TARIH2\r\n  inner join gelgidlistok as gstk\r\n  on gstk.kod=fishrk.stkod and gstk.tip=fishrk.stktip\r\n    order by tarih\r\n  end\r\n  \r\n  \r\n  if (@TARINDEX=0) AND (@VERIDIN='') and  (@CARIKOD_IN='')\r\n  begin\r\n  insert @TB_FIS (Verid,CARI_TIP,CARI_KOD,STK_KOD,STK_AD,STK_BRM,PLAKA,SURUCU,ONCEKI_KM,KM,TARIH,SAAT,\r\n  YKNO,YKFISNO,FISNO,MIKTAR,BRMFIY,TUTAR,VADTAR,AKTIP,ACK)\r\n  SELECT fis.verid,fis.cartip,fis.carkod,fishrk.stkod,gstk.ad,fishrk.brim,\r\n  fis.plaka,fis.surucu,fis.OncekiKm,fis.km,fis.tarih,fis.saat,\r\n  fis.ykno AS YKNO,fis.YkFisNo,\r\n  seri+cast([no] as varchar) AS FISNO,\r\n   case WHEN Fistip='FISVERSAT' then\r\n  fishrk.mik else\r\n  -1*(fishrk.mik) end,\r\n  fishrk.brmfiy,\r\n  case WHEN Fistip='FISVERSAT' then\r\n  fishrk.mik*fishrk.brmfiy else\r\n  -1*(fishrk.mik*fishrk.brmfiy) end,\r\n  fis.vadtar,\r\n  fis.aktip,fis.ack from veresimas as fis with (nolock)\r\n  inner join veresihrk as fishrk with (nolock)\r\n  on fishrk.verid=fis.verid\r\n  and fishrk.sil=0 \r\n  and (fis.tarih+cast(fis.saat as datetime))>=@TARIH1 \r\n  and (fis.tarih+cast(fis.saat as datetime))<=@TARIH2\r\n  inner join gelgidlistok as gstk\r\n  on gstk.kod=fishrk.stkod and gstk.tip=fishrk.stktip\r\n  order by tarih\r\n  end\r\n  \r\n  \r\n  \r\n  if (@TARINDEX=1) AND (@VERIDIN='') and  (@CARIKOD_IN='')\r\n  begin\r\n  insert @TB_FIS (Verid,CARI_TIP,CARI_KOD,STK_KOD,STK_AD,STK_BRM,PLAKA,SURUCU,ONCEKI_KM,KM,TARIH,SAAT,\r\n  YKNO,YKFISNO,FISNO,MIKTAR,BRMFIY,TUTAR,VADTAR,AKTIP,ACK)\r\n  SELECT fis.verid,fis.cartip,fis.carkod,fishrk.stkod,gstk.ad,fishrk.brim,\r\n  fis.plaka,fis.surucu,fis.OncekiKm,fis.km,fis.tarih,fis.saat,\r\n  fis.ykno AS YKNO,fis.YkFisNo,\r\n  seri+cast([no] as varchar) AS FISNO,\r\n  case WHEN Fistip='FISVERSAT' then\r\n  fishrk.mik else\r\n  -1*(fishrk.mik) end,fishrk.brmfiy,\r\n  case WHEN Fistip='FISVERSAT' then\r\n  fishrk.mik*fishrk.brmfiy else\r\n  -1*(fishrk.mik*fishrk.brmfiy) end,\r\n  fis.vadtar,\r\n  fis.aktip,fis.ack from veresimas as fis\r\n  inner join veresihrk as fishrk\r\n  on fishrk.verid=fis.verid\r\n  and fishrk.sil=0 \r\n  and fis.vadtar>=@TARIH1 and fis.vadtar<=@TARIH2\r\n  inner join gelgidlistok as gstk\r\n  on gstk.kod=fishrk.stkod and gstk.tip=fishrk.stktip\r\n    order by tarih\r\n  end\r\n  \r\n\r\n\r\n  if (@AKTIPIN<>'') AND (@PLAKA='')\r\n  insert @TB_FIS_TARIH (Verid,CARI_TIP,CARI_KOD,STK_KOD,STK_AD,STK_BRM,PLAKA,SURUCU,ONCEKI_KM,KM,TARIH,SAAT,\r\n  YKNO,YKFISNO,FISNO,MIKTAR,BRMFIY,TUTAR,VADTAR,ACK)\r\n  select Verid,CARI_TIP,CARI_KOD,STK_KOD,STK_AD,STK_BRM,PLAKA,SURUCU,ONCEKI_KM,KM,TARIH,SAAT,\r\n  YKNO,YKFISNO,FISNO,MIKTAR,BRMFIY,TUTAR,VADTAR,ACK FROM @TB_FIS\r\n  WHERE AKTIP in (SELECT * FROM dbo.CsvToSTR (@AKTIPIN))\r\n\r\n  if (@AKTIPIN<>'') AND (@PLAKA<>'')\r\n  insert @TB_FIS_TARIH (Verid,CARI_TIP,CARI_KOD,STK_KOD,STK_AD,STK_BRM,PLAKA,SURUCU,ONCEKI_KM,KM,TARIH,SAAT,\r\n  YKNO,YKFISNO,FISNO,MIKTAR,BRMFIY,TUTAR,VADTAR,ACK)\r\n  select Verid,CARI_TIP,CARI_KOD,STK_KOD,STK_AD,STK_BRM,PLAKA,SURUCU,ONCEKI_KM,KM,TARIH,SAAT,\r\n  YKNO,YKFISNO,FISNO,MIKTAR,BRMFIY,TUTAR,VADTAR,ACK FROM @TB_FIS\r\n  WHERE PLAKA=@PLAKA AND AKTIP in (SELECT * FROM dbo.CsvToSTR (@AKTIPIN))\r\n\r\n\r\n   if (@AKTIPIN='') AND (@PLAKA='')\r\n   insert @TB_FIS_TARIH (Verid,CARI_TIP,CARI_KOD,STK_KOD,STK_AD,STK_BRM,PLAKA,SURUCU,ONCEKI_KM,KM,TARIH,SAAT,\r\n   YKNO,YKFISNO,FISNO,MIKTAR,BRMFIY,TUTAR,VADTAR,ACK)\r\n   select Verid,CARI_TIP,CARI_KOD,STK_KOD,STK_AD,STK_BRM,PLAKA,SURUCU,ONCEKI_KM,KM,TARIH,SAAT,\r\n   YKNO,YKFISNO,FISNO,MIKTAR,BRMFIY,TUTAR,VADTAR,ACK FROM @TB_FIS\r\n\r\n   if (@AKTIPIN='') AND (@PLAKA<>'')\r\n   insert @TB_FIS_TARIH (Verid,CARI_TIP,CARI_KOD,STK_KOD,STK_AD,STK_BRM,PLAKA,SURUCU,ONCEKI_KM,KM,TARIH,SAAT,\r\n   YKNO,YKFISNO,FISNO,MIKTAR,BRMFIY,TUTAR,VADTAR,ACK)\r\n   select Verid,CARI_TIP,CARI_KOD,STK_KOD,STK_AD,STK_BRM,PLAKA,SURUCU,ONCEKI_KM,KM,TARIH,SAAT,\r\n   YKNO,YKFISNO,FISNO,MIKTAR,BRMFIY,TUTAR,VADTAR,ACK FROM @TB_FIS\r\n   WHERE PLAKA=@PLAKA\r\n   \r\n   \r\n   update  @TB_FIS_TARIH set FARK_KM=isnull(KM,0)-isnull(ONCEKI_KM,0)\r\n   update  @TB_FIS_TARIH set LITRE_KM=\r\n   CASE WHEN FARK_KM>0 THEN MIKTAR/FARK_KM ELSE 0 END\r\n   \r\n   \r\n  \r\n\r\n\r\n\r\n RETURN\r\n\r\n\r\nend"
  },
  {
    "schema": "dbo",
    "name": "UDF_CARIGRUP_FIS_BK",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_CARIGRUP_FIS_BK",
    "definition": "CREATE FUNCTION [dbo].UDF_CARIGRUP_FIS_BK\r\n(\r\n@CARI_TIP   VARCHAR(20),\r\n@CARI_KODIN VARCHAR(8000),\r\n@RAP_ID      INT,\r\n@AK_TIP     VARCHAR(6),/*FT,CH,TEK_CH */\r\n@TARTIP     VARCHAR(20),\r\n@BASTAR     DATETIME,\r\n@BITTAR     DATETIME)\r\nRETURNS\r\n    @TB_CARI_FIS_EKSTRE TABLE (\r\n    CARI_TIP    VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    CARI_KOD    VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    CARI_UNVAN  VARCHAR(150) COLLATE Turkish_CI_AS,\r\n    FAT_TIP     VARCHAR(10) COLLATE Turkish_CI_AS,\r\n    RAPID      INT,\r\n    VERID       FLOAT,\r\n    TARIH       DATETIME,\r\n    SAAT        VARCHAR(8)  COLLATE Turkish_CI_AS,\r\n    BELGENO     VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    YKNO        VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    PLAKA       VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    TUTAR       FLOAT,\r\n    ISK_TUTAR  FLOAT)\r\nAS\r\nBEGIN\r\n\r\n    DECLARE    @TB_CARI_FIS_TEMP TABLE (\r\n    CARI_TIP    VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    CARI_KOD    VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    CARI_UNVAN  VARCHAR(150) COLLATE Turkish_CI_AS,\r\n    FAT_TIP     VARCHAR(10) COLLATE Turkish_CI_AS,\r\n    VERID       FLOAT,\r\n    RAPID      INT,\r\n    TARIH       DATETIME,\r\n    SAAT        VARCHAR(8)  COLLATE Turkish_CI_AS,\r\n    BELGENO     VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    YKNO        VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    PLAKA       VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    TUTAR       FLOAT,\r\n    ISK_FATTUT  FLOAT,\r\n    ISK_FISTUT  FLOAT)\r\n\r\n\r\n \r\n     IF @TARTIP='tarih'\r\n     BEGIN\r\n     INSERT @TB_CARI_FIS_TEMP\r\n      (CARI_TIP,CARI_KOD,CARI_UNVAN,FAT_TIP,VERID,RAPID,TARIH,SAAT,BELGENO,YKNO,\r\n      PLAKA,TUTAR,ISK_FATTUT,ISK_FISTUT)\r\n     SELECT\r\n      @CARI_TIP,ck.kod,ck.ad,fistip,\r\n       verid,fisrap_id,tarih,saat,\r\n       seri+cast([no] as varchar),\r\n       v.ykno,/*YKNO */\r\n       plaka, /*PLAKA */\r\n       CASE WHEN fistip='FISVERSAT' THEN  toptut else -1*toptut end,\r\n       CASE WHEN fistip='FISVERSAT' THEN  toptut*(ck.fat_iskonto/100) else 0 end,\r\n       CASE WHEN fistip='FISVERSAT' THEN  toptut*(ck.fis_iskonto/100) else 0 end\r\n       FROM veresimas as v\r\n       inner join genel_kart ck on ck.cartp=v.cartip\r\n       and ck.kod=v.carkod and ck.sl=0\r\n       where cartip=@CARI_TIP\r\n       and ck.kod in (select * from dbo.CsvToSTR(@CARI_KODIN))\r\n       and v.sil=0\r\n       and v.tarih>=@BASTAR and v.tarih<=@BITTAR\r\n       and v.aktip in ('BK','BL')\r\n       and  v.varok=1\r\n       ORDER BY tarih\r\n      END\r\n      \r\n      \r\n     IF @TARTIP='vadetar'\r\n     BEGIN\r\n      INSERT @TB_CARI_FIS_TEMP\r\n      (CARI_TIP,CARI_KOD,CARI_UNVAN,FAT_TIP,VERID,RAPID,TARIH,SAAT,BELGENO,YKNO,\r\n      PLAKA,TUTAR,ISK_FATTUT,ISK_FISTUT)\r\n     SELECT\r\n      @CARI_TIP,ck.kod,ck.ad,fistip,\r\n       verid,fisrap_id,tarih,saat,\r\n       seri+cast([no] as varchar),\r\n       v.ykno,/*YKNO */\r\n       plaka, /*PLAKA */\r\n       CASE WHEN fistip='FISVERSAT' THEN  toptut else -1*toptut end,\r\n       CASE WHEN fistip='FISVERSAT' THEN  toptut*(ck.fat_iskonto/100) else 0 end,\r\n       CASE WHEN fistip='FISVERSAT' THEN  toptut*(ck.fis_iskonto/100) else 0 end\r\n       FROM veresimas as v\r\n       inner join genel_kart ck on ck.cartp=v.cartip\r\n       and ck.kod=v.carkod and ck.sl=0\r\n       where cartip=@CARI_TIP\r\n       and ck.kod in (select * from dbo.CsvToSTR(@CARI_KODIN))\r\n       and v.sil=0\r\n       and v.vadtar<=@BITTAR\r\n       and v.aktip in ('BK','BL')\r\n       and  v.varok=1\r\n       ORDER BY tarih\r\n      END\r\n      \r\n     IF (@AK_TIP='CH') OR (@AK_TIP='TEK_CH')\r\n      INSERT @TB_CARI_FIS_EKSTRE\r\n      (CARI_TIP,CARI_KOD,CARI_UNVAN,VERID,RAPID,TARIH,SAAT,BELGENO,YKNO,\r\n      PLAKA,TUTAR,ISK_TUTAR)\r\n      SELECT\r\n      CARI_TIP,CARI_KOD,CARI_UNVAN,VERID,RAPID,TARIH,SAAT,BELGENO,YKNO,\r\n      PLAKA,TUTAR,ISK_FISTUT FROM @TB_CARI_FIS_TEMP\r\n      \r\n      IF @AK_TIP='FT'\r\n      INSERT @TB_CARI_FIS_EKSTRE\r\n      (CARI_TIP,CARI_KOD,CARI_UNVAN,VERID,RAPID,TARIH,SAAT,BELGENO,YKNO,\r\n      PLAKA,TUTAR,ISK_TUTAR)\r\n      SELECT\r\n      CARI_TIP,CARI_KOD,CARI_UNVAN,VERID,RAPID,TARIH,SAAT,BELGENO,YKNO,\r\n      PLAKA,TUTAR,ISK_FATTUT FROM @TB_CARI_FIS_TEMP\r\n      WHERE FAT_TIP='FISVERSAT'\r\n      \r\n     \r\n     \r\n     if @RAP_ID>0\r\n      Delete from @TB_CARI_FIS_EKSTRE where RAPID !=@RAP_ID\r\n      \r\n\r\n\r\n  RETURN\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_CARILITRE_GRUP",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_CARILITRE_GRUP",
    "definition": "CREATE FUNCTION [dbo].UDF_CARILITRE_GRUP (\r\n@CARI_TIP VARCHAR(20),\r\n@CARI_KOD VARCHAR(20),\r\n@TARIH1 DATETIME,\r\n@TARIH2 DATETIME)\r\nRETURNS\r\n  @TB_STOKLITRE_EKSTRE TABLE (\r\n    STOK_TIP    VARCHAR(20)  COLLATE Turkish_CI_AS,\r\n    STOK_KOD    VARCHAR(20)  COLLATE Turkish_CI_AS,\r\n    STOK_AD     VARCHAR(50)  COLLATE Turkish_CI_AS)\r\nAS\r\nBEGIN\r\n  DECLARE @EKSTRE_TEMP TABLE (\r\n    STOK_TIP    VARCHAR(20)    COLLATE Turkish_CI_AS,\r\n    STOK_KOD    VARCHAR(20)    COLLATE Turkish_CI_AS,\r\n    STOK_AD     VARCHAR(50)    COLLATE Turkish_CI_AS)\r\n\r\n  DECLARE @HRK_STOK_TIP    VARCHAR(20)\r\n  DECLARE @HRK_STOK_KOD    VARCHAR(20)\r\n  DECLARE @HRK_STOK_AD     VARCHAR(50)\r\n\r\n\r\n  /* Devir atanıyor */\r\n  /*---------------------------------------------------------------------------- */\r\n  INSERT @EKSTRE_TEMP\r\n    SELECT\r\n       stktip,stkod,k.ad\r\n       FROM veresihrk as h inner join veresimas as m on h.verid=m.verid\r\n       and m.sil=0 and h.sil=0\r\n       inner join stokkart as k on k.kod=h.stkod\r\n       and k.tip=h.stktip\r\n       WHERE cartip=@CARI_TIP and carkod=@CARI_KOD\r\n       AND (m.tarih <= @TARIH2)\r\n       group by h.stktip,h.stkod,k.ad\r\n       \r\n       \r\n  /*---------------------------------------------------------------------------- */\r\n\r\n  INSERT @TB_STOKLITRE_EKSTRE\r\n    SELECT STOK_TIP,STOK_KOD,STOK_AD FROM @EKSTRE_TEMP\r\n\r\n  RETURN\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_CARILITRE_HRK",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_CARILITRE_HRK",
    "definition": "CREATE FUNCTION [dbo].UDF_CARILITRE_HRK (\r\n@FIRMANO   INT,\r\n@DEVIR     INT,\r\n@CARI_TIP  VARCHAR(30),\r\n@CARI_KOD  VARCHAR(8000),\r\n@STK_TIP   VARCHAR(30),\r\n@STK_KOD   VARCHAR(30),\r\n@FISTIP    VARCHAR(30),\r\n@PLAKA     VARCHAR(50),\r\n@TARIH1    DATETIME,\r\n@TARIH2    DATETIME,\r\n@FISDRMIN  VARCHAR(50))\r\nRETURNS\r\n  @TB_STOKLITRE_EKSTRE TABLE (\r\n    CARI_TIP    VARCHAR(20)    COLLATE Turkish_CI_AS,\r\n    CARI_KOD    VARCHAR(50)    COLLATE Turkish_CI_AS,\r\n    CARI_UNVAN  VARCHAR(100)    COLLATE Turkish_CI_AS,\r\n    STOK_TIP    VARCHAR(20)    COLLATE Turkish_CI_AS,\r\n    STOK_KOD    VARCHAR(50)    COLLATE Turkish_CI_AS,\r\n    STOK_AD     VARCHAR(100)    COLLATE Turkish_CI_AS,\r\n    TARIH       DATETIME,\r\n    SAAT        VARCHAR(8)    COLLATE Turkish_CI_AS,\r\n    BELGENO     VARCHAR(30)   COLLATE Turkish_CI_AS,\r\n    YKNO        VARCHAR(30)   COLLATE Turkish_CI_AS,\r\n    PLAKA       VARCHAR(50)   COLLATE Turkish_CI_AS,\r\n    ACIKLAMA    VARCHAR(100)  COLLATE Turkish_CI_AS,\r\n    FISAD       VARCHAR(50)   COLLATE Turkish_CI_AS,\r\n    YERAD       VARCHAR(50)   COLLATE Turkish_CI_AS,\r\n    KULAD       VARCHAR(50)   COLLATE Turkish_CI_AS,\r\n    FISTIP      VARCHAR(10)   COLLATE Turkish_CI_AS,\r\n    HRKID       FLOAT,\r\n    BRMFIY      FLOAT,\r\n    BIRIM       VARCHAR(10)   COLLATE Turkish_CI_AS,\r\n    ALCAKMIK    FLOAT,\r\n    VERILENMIK  FLOAT,\r\n    ALACAKTUT   FLOAT,\r\n    VERILENTUT  FLOAT,\r\n    BAKIYE      DECIMAL(18,8),\r\n    DEVIR       TINYINT)\r\nAS\r\nBEGIN\r\n  DECLARE @EKSTRE_TEMP TABLE (\r\n    CARI_TIP    VARCHAR(20)    COLLATE Turkish_CI_AS,\r\n    CARI_KOD    VARCHAR(50)    COLLATE Turkish_CI_AS,\r\n    CARI_UNVAN  VARCHAR(100)    COLLATE Turkish_CI_AS,\r\n    STOK_TIP    VARCHAR(20)    COLLATE Turkish_CI_AS,\r\n    STOK_KOD    VARCHAR(50)    COLLATE Turkish_CI_AS,\r\n    STOK_AD     VARCHAR(100)    COLLATE Turkish_CI_AS,\r\n    TARIH       DATETIME,\r\n    SAAT        VARCHAR(8)      COLLATE Turkish_CI_AS,\r\n    BELGENO     VARCHAR(30)     COLLATE Turkish_CI_AS,\r\n    YKNO        VARCHAR(30)     COLLATE Turkish_CI_AS,\r\n    PLAKA       VARCHAR(50)     COLLATE Turkish_CI_AS,\r\n    ACIKLAMA    VARCHAR(100)    COLLATE Turkish_CI_AS,\r\n    FISAD       VARCHAR(50)     COLLATE Turkish_CI_AS,\r\n    YERAD       VARCHAR(50)     COLLATE Turkish_CI_AS,\r\n    KULAD       VARCHAR(50)     COLLATE Turkish_CI_AS,\r\n    FISTIP      VARCHAR(10)     COLLATE Turkish_CI_AS,\r\n    HRKID       FLOAT,\r\n    BRMFIY      FLOAT,\r\n    BIRIM       VARCHAR(10)     COLLATE Turkish_CI_AS,\r\n    ALCAKMIK    FLOAT,\r\n    VERILENMIK  FLOAT,\r\n    ALACAKTUT   FLOAT,\r\n    VERILENTUT  FLOAT,\r\n    BAKIYE      DECIMAL(18,8),\r\n    DEVIR       TINYINT)\r\n\r\n  DECLARE @HRK_STOK_TIP    VARCHAR(20)\r\n  DECLARE @HRK_STOK_KOD    VARCHAR(50)\r\n  DECLARE @HRK_STOK_AD     VARCHAR(100)\r\n  DECLARE @HRK_CARI_TIP    VARCHAR(20)\r\n  DECLARE @HRK_CARI_KOD    VARCHAR(50)\r\n  DECLARE @HRK_CARI_UNVAN  VARCHAR(100)\r\n  DECLARE @HRK_TARIH       DATETIME\r\n  DECLARE @HRK_SAAT        VARCHAR(8)\r\n  DECLARE @HRK_BELGENO     VARCHAR(30)\r\n  DECLARE @HRK_YKNO        VARCHAR(30)\r\n  DECLARE @HRK_PLAKA       VARCHAR(50)\r\n  DECLARE @HRK_ACIKLAMA    VARCHAR(100)\r\n  DECLARE @HRK_FISAD       VARCHAR(30)\r\n  DECLARE @HRK_YERAD       VARCHAR(50)\r\n  DECLARE @HRK_KULAD       VARCHAR(50)\r\n  DECLARE @HRK_FISTIP      VARCHAR(10)\r\n  DECLARE @HRK_HRKID       FLOAT\r\n  DECLARE @HRK_BRMFIY      FLOAT\r\n  DECLARE @HRK_BIRIM       VARCHAR(10)\r\n  DECLARE @HRK_ALCAKMIK    FLOAT\r\n  DECLARE @HRK_VERILENMIK  FLOAT\r\n  DECLARE @HRK_ALACAKTUT   FLOAT\r\n  DECLARE @HRK_VERILENTUT  FLOAT\r\n  DECLARE @HRK_BAKIYE      DECIMAL(18,8)\r\n  DECLARE @KUM_BAKIYE      DECIMAL(18,8)\r\n  DECLARE @HRK_DEVIR       TINYINT\r\n  DECLARE @HRK_ONSTOK_TIP    VARCHAR(20)\r\n  DECLARE @HRK_ONSTOK_KOD    VARCHAR(20)\r\n  set @KUM_BAKIYE=0\r\n\r\n\r\n  /* Devir atanıyor */\r\n  /*---------------------------------------------------------------------------- */\r\n  if @DEVIR=1\r\n    begin\r\n    \r\n  \r\n      if (@CARI_KOD<>'') and (@STK_KOD='') and (@FIRMANO=0)  /* tum stok kartları */\r\n      begin\r\n      INSERT @EKSTRE_TEMP\r\n        SELECT\r\n           '','','','','','',/*m.cartip,m.carkod,'',   */\r\n           /*stktip,stkod,k.ad, */\r\n           @TARIH1,\r\n           '00:00:00',\r\n           'DEVIR',/*SERİNO */\r\n           'DEVIR',/*YKNO */\r\n           '', /*PLAKA */\r\n           CONVERT(VARCHAR(10), @TARIH1, 104) +' DEVİR BAKİYESİ', /* AÇIKLAMA, */\r\n           'DEVIR','DEVIR','DEVIR','-',0,0,'-',\r\n           ISNULL(SUM(CASE WHEN fistip='FISALCSAT' THEN  mik else 0 end),0),\r\n           ISNULL(SUM(CASE WHEN fistip='FISVERSAT' THEN  mik else 0 end),0),\r\n           ISNULL(SUM(CASE WHEN fistip='FISALCSAT' THEN  mik*brmfiy else 0 end),0),\r\n           ISNULL(SUM(CASE WHEN fistip='FISVERSAT' THEN  mik*brmfiy else 0 end),0),\r\n           ISNULL(SUM(CASE WHEN fistip='FISALCSAT' THEN  mik else -1*mik end),0),\r\n           1\r\n           FROM veresihrk as h inner join veresimas as m on h.verid=m.verid\r\n           and m.sil=0 and h.sil=0\r\n           inner join stokkart as k on k.kod=h.stkod\r\n           and k.tip=h.stktip\r\n           WHERE cartip=@CARI_TIP and carkod in (select * from CsvToSTR(@CARI_KOD) )\r\n           AND (m.tarih < @TARIH1) and m.aktip in (select * from CsvToSTR(@FISDRMIN))\r\n\r\n        end\r\n        \r\n        \r\n        \r\n      if (@CARI_KOD<>'') and (@STK_KOD='') and (@FIRMANO>0)  /* tum stok kartları */\r\n      begin\r\n       INSERT @EKSTRE_TEMP\r\n        SELECT\r\n           '','','','','','',/*m.cartip,m.carkod,'',   */\r\n           /*stktip,stkod,k.ad, */\r\n           @TARIH1,\r\n           '00:00:00',\r\n           'DEVIR',/*SERİNO */\r\n           'DEVIR',/*YKNO */\r\n           '', /*PLAKA */\r\n           CONVERT(VARCHAR(10), @TARIH1, 104) +' DEVİR BAKİYESİ', /* AÇIKLAMA, */\r\n           'DEVIR','DEVIR','DEVIR','-',0,0,'-',\r\n           ISNULL(SUM(CASE WHEN fistip='FISALCSAT' THEN  mik else 0 end),0),\r\n           ISNULL(SUM(CASE WHEN fistip='FISVERSAT' THEN  mik else 0 end),0),\r\n           ISNULL(SUM(CASE WHEN fistip='FISALCSAT' THEN  mik*brmfiy else 0 end),0),\r\n           ISNULL(SUM(CASE WHEN fistip='FISVERSAT' THEN  mik*brmfiy else 0 end),0),\r\n           ISNULL(SUM(CASE WHEN fistip='FISALCSAT' THEN  mik else -1*mik end),0),\r\n           1\r\n           FROM veresihrk as h \r\n           inner join veresimas as m on h.verid=m.verid\r\n           and m.sil=0 and h.sil=0\r\n           and m.firmano in (@FIRMANO,0)\r\n           inner join stokkart as k on k.kod=h.stkod\r\n           and k.tip=h.stktip\r\n           WHERE cartip=@CARI_TIP and carkod in (select * from CsvToSTR(@CARI_KOD) )\r\n           AND (m.tarih < @TARIH1) and m.aktip in (select * from CsvToSTR(@FISDRMIN))\r\n\r\n        end\r\n        \r\n        \r\n\r\n    \r\n      if (@STK_KOD<>'') and (@FISTIP='') and (@FIRMANO=0) /* tek stok kartları */\r\n      begin\r\n      INSERT @EKSTRE_TEMP\r\n        SELECT\r\n           '','','','','','',/*m.cartip,m.carkod,'',   */\r\n           /*stktip,stkod,k.ad, */\r\n           @TARIH1,\r\n           '00:00:00',\r\n           'DEVIR',/*SERİNO */\r\n           'DEVIR',/*YKNO */\r\n           '', /*PLAKA */\r\n           CONVERT(VARCHAR(10), @TARIH1, 104) +' DEVİR BAKİYESİ', /* AÇIKLAMA, */\r\n           'DEVIR','DEVIR','DEVIR','-',0,0,'-',\r\n           ISNULL(SUM(CASE WHEN fistip='FISALCSAT' THEN  mik else 0 end),0),\r\n           ISNULL(SUM(CASE WHEN fistip='FISVERSAT' THEN  mik else 0 end),0),\r\n           ISNULL(SUM(CASE WHEN fistip='FISALCSAT' THEN  mik*brmfiy else 0 end),0),\r\n           ISNULL(SUM(CASE WHEN fistip='FISVERSAT' THEN  mik*brmfiy else 0 end),0),\r\n           ISNULL(SUM(CASE WHEN fistip='FISALCSAT' THEN  mik else -1*mik end),0),\r\n           1\r\n           FROM veresihrk as h inner join veresimas as m on h.verid=m.verid\r\n           and m.sil=0 and h.sil=0\r\n           inner join stokkart as k on k.kod=h.stkod\r\n           and k.tip=h.stktip and k.tip=@STK_TIP and k.kod=@STK_KOD\r\n           WHERE cartip=@CARI_TIP and carkod in (select * from CsvToSTR(@CARI_KOD) )\r\n           AND (m.tarih < @TARIH1) and m.aktip in (select * from CsvToSTR(@FISDRMIN))\r\n              \r\n        end\r\n        \r\n        \r\n      if (@STK_KOD<>'') and (@FISTIP='') and (@FIRMANO>0) /* tek stok kartları */\r\n       begin\r\n        INSERT @EKSTRE_TEMP\r\n        SELECT\r\n           '','','','','','',/*m.cartip,m.carkod,'',   */\r\n           /*stktip,stkod,k.ad, */\r\n           @TARIH1,\r\n           '00:00:00',\r\n           'DEVIR',/*SERİNO */\r\n           'DEVIR',/*YKNO */\r\n           '', /*PLAKA */\r\n           CONVERT(VARCHAR(10), @TARIH1, 104) +' DEVİR BAKİYESİ', /* AÇIKLAMA, */\r\n           'DEVIR','DEVIR','DEVIR','-',0,0,'-',\r\n           ISNULL(SUM(CASE WHEN fistip='FISALCSAT' THEN  mik else 0 end),0),\r\n           ISNULL(SUM(CASE WHEN fistip='FISVERSAT' THEN  mik else 0 end),0),\r\n           ISNULL(SUM(CASE WHEN fistip='FISALCSAT' THEN  mik*brmfiy else 0 end),0),\r\n           ISNULL(SUM(CASE WHEN fistip='FISVERSAT' THEN  mik*brmfiy else 0 end),0),\r\n           ISNULL(SUM(CASE WHEN fistip='FISALCSAT' THEN  mik else -1*mik end),0),\r\n           1\r\n           FROM veresihrk as h \r\n           inner join veresimas as m on h.verid=m.verid\r\n           and m.sil=0 and h.sil=0\r\n           and m.firmano in (@FIRMANO,0)\r\n           inner join stokkart as k on k.kod=h.stkod\r\n           and k.tip=h.stktip and k.tip=@STK_TIP and k.kod=@STK_KOD\r\n           WHERE cartip=@CARI_TIP and carkod in (select * from CsvToSTR(@CARI_KOD) )\r\n           AND (m.tarih < @TARIH1) and m.aktip in (select * from CsvToSTR(@FISDRMIN))\r\n              \r\n        end\r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n      if (@FISTIP<>'') and (@PLAKA='') and (@FIRMANO=0) /* TEK FISTIP kartları */\r\n      begin\r\n      INSERT @EKSTRE_TEMP\r\n        SELECT\r\n           '','','','','','',/*m.cartip,m.carkod,'',   */\r\n           /*stktip,stkod,k.ad, */\r\n           @TARIH1,\r\n           '00:00:00',\r\n           'DEVIR',/*SERİNO */\r\n           'DEVIR',/*YKNO */\r\n           '', /*PLAKA */\r\n           CONVERT(VARCHAR(10), @TARIH1, 104) +' DEVİR BAKİYESİ', /* AÇIKLAMA, */\r\n           'DEVIR','DEVIR','DEVIR','-',0,0,'-',\r\n           ISNULL(SUM(CASE WHEN fistip='FISALCSAT' THEN  mik else 0 end),0),\r\n           ISNULL(SUM(CASE WHEN fistip='FISVERSAT' THEN  mik else 0 end),0),\r\n           ISNULL(SUM(CASE WHEN fistip='FISALCSAT' THEN  mik*brmfiy else 0 end),0),\r\n           ISNULL(SUM(CASE WHEN fistip='FISVERSAT' THEN  mik*brmfiy else 0 end),0),\r\n           ISNULL(SUM(CASE WHEN fistip='FISALCSAT' THEN  mik else -1*mik end),0),\r\n           1\r\n           FROM veresihrk as h inner join veresimas as m on h.verid=m.verid\r\n           and m.sil=0 and h.sil=0\r\n           inner join stokkart as k on k.kod=h.stkod\r\n           and k.tip=h.stktip and k.tip=@STK_TIP and k.kod=@STK_KOD\r\n           WHERE cartip=@CARI_TIP and carkod in (select * from CsvToSTR(@CARI_KOD) )\r\n           AND (m.tarih < @TARIH1) and m.aktip in (select * from CsvToSTR(@FISDRMIN))\r\n           AND m.fistip=@FISTIP\r\n       end\r\n        \r\n       \r\n       \r\n      if (@FISTIP<>'') and (@PLAKA='') and (@FIRMANO>0) /* TEK FISTIP kartları */\r\n      begin\r\n      INSERT @EKSTRE_TEMP\r\n        SELECT\r\n           '','','','','','',/*m.cartip,m.carkod,'',   */\r\n           /*stktip,stkod,k.ad, */\r\n           @TARIH1,\r\n           '00:00:00',\r\n           'DEVIR',/*SERİNO */\r\n           'DEVIR',/*YKNO */\r\n           '', /*PLAKA */\r\n           CONVERT(VARCHAR(10), @TARIH1, 104) +' DEVİR BAKİYESİ', /* AÇIKLAMA, */\r\n           'DEVIR','DEVIR','DEVIR','-',0,0,'-',\r\n           ISNULL(SUM(CASE WHEN fistip='FISALCSAT' THEN  mik else 0 end),0),\r\n           ISNULL(SUM(CASE WHEN fistip='FISVERSAT' THEN  mik else 0 end),0),\r\n           ISNULL(SUM(CASE WHEN fistip='FISALCSAT' THEN  mik*brmfiy else 0 end),0),\r\n           ISNULL(SUM(CASE WHEN fistip='FISVERSAT' THEN  mik*brmfiy else 0 end),0),\r\n           ISNULL(SUM(CASE WHEN fistip='FISALCSAT' THEN  mik else -1*mik end),0),\r\n           1\r\n           FROM veresihrk as h \r\n           inner join veresimas as m on h.verid=m.verid\r\n           and m.sil=0 and h.sil=0\r\n           and m.firmano in (@FIRMANO,0)\r\n           inner join stokkart as k on k.kod=h.stkod\r\n           and k.tip=h.stktip and k.tip=@STK_TIP and k.kod=@STK_KOD\r\n           WHERE cartip=@CARI_TIP and carkod in (select * from CsvToSTR(@CARI_KOD) )\r\n           AND (m.tarih < @TARIH1) and m.aktip in (select * from CsvToSTR(@FISDRMIN))\r\n           AND m.fistip=@FISTIP\r\n       end\r\n       \r\n       \r\n       \r\n        \r\n      if (@PLAKA<>'') and (@FIRMANO=0) /* TEK FISTIP kartları */\r\n      begin\r\n      INSERT @EKSTRE_TEMP\r\n        SELECT\r\n           '','','','','','',/*m.cartip,m.carkod,'',   */\r\n           /*stktip,stkod,k.ad, */\r\n           @TARIH1,\r\n           '00:00:00',\r\n           'DEVIR',/*SERİNO */\r\n           'DEVIR',/*YKNO */\r\n           '', /*PLAKA */\r\n           CONVERT(VARCHAR(10), @TARIH1, 104) +' DEVİR BAKİYESİ', /* AÇIKLAMA, */\r\n           'DEVIR','DEVIR','DEVIR','-',0,0,'-',\r\n           ISNULL(SUM(CASE WHEN fistip='FISALCSAT' THEN  mik else 0 end),0),\r\n           ISNULL(SUM(CASE WHEN fistip='FISVERSAT' THEN  mik else 0 end),0),\r\n           ISNULL(SUM(CASE WHEN fistip='FISALCSAT' THEN  mik*brmfiy else 0 end),0),\r\n           ISNULL(SUM(CASE WHEN fistip='FISVERSAT' THEN  mik*brmfiy else 0 end),0),\r\n           ISNULL(SUM(CASE WHEN fistip='FISALCSAT' THEN  mik else -1*mik end),0),\r\n           1\r\n           FROM veresihrk as h inner join veresimas as m on h.verid=m.verid\r\n           and m.sil=0 and h.sil=0\r\n           inner join stokkart as k on k.kod=h.stkod\r\n           and k.tip=h.stktip and k.tip=@STK_TIP and k.kod=@STK_KOD\r\n           WHERE cartip=@CARI_TIP and carkod in (select * from CsvToSTR(@CARI_KOD) )\r\n           AND (m.tarih < @TARIH1) and m.aktip in (select * from CsvToSTR(@FISDRMIN))\r\n           and m.fistip=@FISTIP AND m.plaka=@PLAKA\r\n           /*group by m.cartip,m.carkod, */\r\n           /*h.stktip,h.stkod,k.ad */\r\n           \r\n        end \r\n        \r\n        \r\n        \r\n        if (@PLAKA<>'') and (@FIRMANO>0) /* TEK FISTIP kartları */\r\n      begin\r\n      INSERT @EKSTRE_TEMP\r\n        SELECT\r\n           '','','','','','',/*m.cartip,m.carkod,'',   */\r\n           /*stktip,stkod,k.ad, */\r\n           @TARIH1,\r\n           '00:00:00',\r\n           'DEVIR',/*SERİNO */\r\n           'DEVIR',/*YKNO */\r\n           '', /*PLAKA */\r\n           CONVERT(VARCHAR(10), @TARIH1, 104) +' DEVİR BAKİYESİ', /* AÇIKLAMA, */\r\n           'DEVIR','DEVIR','DEVIR','-',0,0,'-',\r\n           ISNULL(SUM(CASE WHEN fistip='FISALCSAT' THEN  mik else 0 end),0),\r\n           ISNULL(SUM(CASE WHEN fistip='FISVERSAT' THEN  mik else 0 end),0),\r\n           ISNULL(SUM(CASE WHEN fistip='FISALCSAT' THEN  mik*brmfiy else 0 end),0),\r\n           ISNULL(SUM(CASE WHEN fistip='FISVERSAT' THEN  mik*brmfiy else 0 end),0),\r\n           ISNULL(SUM(CASE WHEN fistip='FISALCSAT' THEN  mik else -1*mik end),0),\r\n           1\r\n           FROM veresihrk as h \r\n           inner join veresimas as m on h.verid=m.verid\r\n           and m.sil=0 and h.sil=0\r\n           and m.firmano in (@FIRMANO,0)\r\n           inner join stokkart as k on k.kod=h.stkod\r\n           and k.tip=h.stktip and k.tip=@STK_TIP and k.kod=@STK_KOD\r\n           WHERE cartip=@CARI_TIP and carkod in (select * from CsvToSTR(@CARI_KOD) )\r\n           AND (m.tarih < @TARIH1) and m.aktip in (select * from CsvToSTR(@FISDRMIN))\r\n           and m.fistip=@FISTIP AND m.plaka=@PLAKA\r\n            \r\n        end \r\n        \r\n        \r\n        \r\n        \r\n     end/*--devir int */\r\n    \r\n\r\n   SET @HRK_ONSTOK_TIP=''\r\n   SET @HRK_ONSTOK_KOD=''\r\n\r\n\r\n\r\n   if (@CARI_KOD<>'') and (@STK_KOD='') and (@FIRMANO=0) /* tum stok kartları */\r\n   begin\r\n   DECLARE CRS_HRK CURSOR FAST_FORWARD FOR\r\n    SELECT\r\n       m.cartip,m.carkod,'',\r\n       stktip,stkod,k.ad,\r\n       tarih,saat,\r\n       seri+cast([no] as varchar),\r\n       m.ykno,m.plaka, /*PLAKA */\r\n      ack, /* AÇIKLAMA, */\r\n      fisad,yerad,h.olususer,fistip,\r\n      m.verid,brmfiy,h.brim,\r\n       CASE WHEN fistip='FISALCSAT' THEN  mik else 0 end,\r\n       CASE WHEN fistip='FISVERSAT' THEN mik else 0 end,\r\n       CASE WHEN fistip='FISALCSAT' THEN  -1*mik else mik end,\r\n       0\r\n       FROM veresihrk as h \r\n       inner join veresimas as m on h.verid=m.verid\r\n       and m.sil=0 and h.sil=0\r\n       inner join stokkart as k on k.kod=h.stkod\r\n       and k.tip=h.stktip\r\n       WHERE cartip=@CARI_TIP \r\n       and carkod in (select * from CsvToSTR(@CARI_KOD) )\r\n       AND (tarih >= @TARIH1)\r\n       AND (tarih <= @TARIH2) \r\n       and m.aktip in (select * from CsvToSTR(@FISDRMIN))\r\n     ORDER BY m.cartip,m.carkod,\r\n     h.stktip,h.stkod,tarih,saat\r\n    end\r\n    \r\n    \r\n    \r\n    if (@CARI_KOD<>'') and (@STK_KOD='') and (@FIRMANO>0) /* tum stok kartları */\r\n   begin\r\n   DECLARE CRS_HRK CURSOR FAST_FORWARD FOR\r\n    SELECT\r\n       m.cartip,m.carkod,'',\r\n       stktip,stkod,k.ad,\r\n       tarih,saat,\r\n       seri+cast([no] as varchar),\r\n       m.ykno,m.plaka, /*PLAKA */\r\n      ack, /* AÇIKLAMA, */\r\n      fisad,yerad,h.olususer,fistip,\r\n      m.verid,brmfiy,h.brim,\r\n       CASE WHEN fistip='FISALCSAT' THEN  mik else 0 end,\r\n       CASE WHEN fistip='FISVERSAT' THEN mik else 0 end,\r\n       CASE WHEN fistip='FISALCSAT' THEN  -1*mik else mik end,\r\n       0\r\n       FROM veresihrk as h \r\n       inner join veresimas as m on h.verid=m.verid\r\n       and m.sil=0 and h.sil=0\r\n       and m.firmano in (@FIRMANO,0)\r\n       inner join stokkart as k on k.kod=h.stkod\r\n       and k.tip=h.stktip\r\n       WHERE cartip=@CARI_TIP \r\n       and carkod in (select * from CsvToSTR(@CARI_KOD) )\r\n       AND (tarih >= @TARIH1)\r\n       AND (tarih <= @TARIH2) \r\n       and m.aktip in (select * from CsvToSTR(@FISDRMIN))\r\n     ORDER BY m.cartip,m.carkod,\r\n     h.stktip,h.stkod,tarih,saat\r\n    end\r\n\r\n    \r\n    \r\n    \r\n\r\n   if (@STK_KOD<>'') and (@FISTIP='')  and (@FIRMANO=0)/* tek stok kartları */\r\n   begin\r\n   DECLARE CRS_HRK CURSOR FAST_FORWARD FOR\r\n    SELECT\r\n      m.cartip,m.carkod,'',\r\n      stktip,stkod,k.ad,\r\n       tarih,saat,\r\n       seri+cast([no] as varchar),\r\n       m.ykno,m.plaka, /*PLAKA */\r\n      ack, /* AÇIKLAMA, */\r\n      fisad,yerad,h.olususer,fistip,\r\n      m.verid,brmfiy,h.brim,\r\n       CASE WHEN fistip='FISALCSAT' THEN  mik else 0 end,\r\n       CASE WHEN fistip='FISVERSAT' THEN mik else 0 end,\r\n       CASE WHEN fistip='FISALCSAT' THEN  -1*mik else mik end,\r\n       0\r\n       FROM veresihrk as h inner join veresimas as m on h.verid=m.verid\r\n       and m.sil=0 and h.sil=0\r\n       inner join stokkart as k on k.kod=h.stkod\r\n       and k.tip=h.stktip and k.tip=@STK_TIP and k.kod=@STK_KOD\r\n       WHERE cartip=@CARI_TIP \r\n       and carkod in (select * from CsvToSTR(@CARI_KOD) )\r\n       AND (tarih >= @TARIH1)\r\n       AND (tarih <= @TARIH2)\r\n       and m.aktip in (select * from CsvToSTR(@FISDRMIN))\r\n     ORDER BY m.cartip,m.carkod,\r\n     h.stktip,h.stkod,tarih,saat\r\n    end\r\n    \r\n   \r\n    if (@STK_KOD<>'') and (@FISTIP='')  and (@FIRMANO>0)/* tek stok kartları */\r\n   begin\r\n   DECLARE CRS_HRK CURSOR FAST_FORWARD FOR\r\n    SELECT\r\n      m.cartip,m.carkod,'',\r\n      stktip,stkod,k.ad,\r\n       tarih,saat,\r\n       seri+cast([no] as varchar),\r\n       m.ykno,m.plaka, /*PLAKA */\r\n      ack, /* AÇIKLAMA, */\r\n      fisad,yerad,h.olususer,fistip,\r\n      m.verid,brmfiy,h.brim,\r\n       CASE WHEN fistip='FISALCSAT' THEN  mik else 0 end,\r\n       CASE WHEN fistip='FISVERSAT' THEN mik else 0 end,\r\n       CASE WHEN fistip='FISALCSAT' THEN  -1*mik else mik end,\r\n       0\r\n       FROM veresihrk as h \r\n       inner join veresimas as m on h.verid=m.verid\r\n       and m.sil=0 and h.sil=0\r\n       and m.firmano in (@FIRMANO,0)\r\n       inner join stokkart as k on k.kod=h.stkod\r\n       and k.tip=h.stktip and k.tip=@STK_TIP and k.kod=@STK_KOD\r\n       WHERE cartip=@CARI_TIP \r\n       and carkod in (select * from CsvToSTR(@CARI_KOD) )\r\n       AND (tarih >= @TARIH1)\r\n       AND (tarih <= @TARIH2)\r\n       and m.aktip in (select * from CsvToSTR(@FISDRMIN))\r\n     ORDER BY m.cartip,m.carkod,\r\n     h.stktip,h.stkod,tarih,saat\r\n    end\r\n    \r\n   \r\n   \r\n   \r\n   if (@FISTIP<>'') and (@PLAKA='') and (@FIRMANO=0) /* tek stok kartları */\r\n   begin\r\n   DECLARE CRS_HRK CURSOR FAST_FORWARD FOR\r\n    SELECT\r\n      m.cartip,m.carkod,'',\r\n      stktip,stkod,k.ad,\r\n       tarih,saat,\r\n       seri+cast([no] as varchar),\r\n       m.ykno,m.plaka, /*PLAKA */\r\n      ack, /* AÇIKLAMA, */\r\n      fisad,yerad,h.olususer,fistip,\r\n      m.verid,brmfiy,h.brim,\r\n       CASE WHEN fistip='FISALCSAT' THEN  mik else 0 end,\r\n       CASE WHEN fistip='FISVERSAT' THEN mik else 0 end,\r\n       CASE WHEN fistip='FISALCSAT' THEN  -1*mik else mik end,\r\n       0\r\n       FROM veresihrk as h inner join veresimas as m on h.verid=m.verid\r\n       and m.sil=0 and h.sil=0\r\n       inner join stokkart as k on k.kod=h.stkod\r\n       and k.tip=h.stktip and k.tip=@STK_TIP and k.kod=@STK_KOD\r\n       WHERE cartip=@CARI_TIP \r\n       and carkod in (select * from CsvToSTR(@CARI_KOD) )\r\n       AND (tarih >= @TARIH1)\r\n       AND (tarih <= @TARIH2)\r\n       and m.aktip in (select * from CsvToSTR(@FISDRMIN))\r\n       AND m.fistip=@FISTIP\r\n     ORDER BY m.cartip,m.carkod,\r\n     h.stktip,h.stkod,m.fistip,tarih,saat\r\n    end  \r\n    \r\n    if (@FISTIP<>'') and (@PLAKA='') and (@FIRMANO>0) /* tek stok kartları */\r\n   begin\r\n   DECLARE CRS_HRK CURSOR FAST_FORWARD FOR\r\n    SELECT\r\n      m.cartip,m.carkod,'',\r\n      stktip,stkod,k.ad,\r\n       tarih,saat,\r\n       seri+cast([no] as varchar),\r\n       m.ykno,m.plaka, /*PLAKA */\r\n      ack, /* AÇIKLAMA, */\r\n      fisad,yerad,h.olususer,fistip,\r\n      m.verid,brmfiy,h.brim,\r\n       CASE WHEN fistip='FISALCSAT' THEN  mik else 0 end,\r\n       CASE WHEN fistip='FISVERSAT' THEN mik else 0 end,\r\n       CASE WHEN fistip='FISALCSAT' THEN  -1*mik else mik end,\r\n       0\r\n       FROM veresihrk as h \r\n       inner join veresimas as m on h.verid=m.verid\r\n       and m.sil=0 and h.sil=0\r\n       and m.firmano in (@FIRMANO,0)\r\n       inner join stokkart as k on k.kod=h.stkod\r\n       and k.tip=h.stktip and k.tip=@STK_TIP and k.kod=@STK_KOD\r\n       WHERE cartip=@CARI_TIP \r\n       and carkod in (select * from CsvToSTR(@CARI_KOD) )\r\n       AND (tarih >= @TARIH1)\r\n       AND (tarih <= @TARIH2)\r\n       and m.aktip in (select * from CsvToSTR(@FISDRMIN))\r\n       AND m.fistip=@FISTIP\r\n     ORDER BY m.cartip,m.carkod,\r\n     h.stktip,h.stkod,m.fistip,tarih,saat\r\n    end  \r\n    \r\n    \r\n   if (@PLAKA<>'')  and (@FIRMANO=0)/* tek stok kartları */\r\n   begin\r\n   DECLARE CRS_HRK CURSOR FAST_FORWARD FOR\r\n    SELECT\r\n      m.cartip,m.carkod,'',\r\n      stktip,stkod,k.ad,\r\n       tarih,saat,\r\n       seri+cast([no] as varchar),\r\n       m.ykno,m.plaka, /*PLAKA */\r\n      ack, /* AÇIKLAMA, */\r\n      fisad,yerad,h.olususer,fistip,\r\n      m.verid,brmfiy,h.brim,\r\n       CASE WHEN fistip='FISALCSAT' THEN  mik else 0 end,\r\n       CASE WHEN fistip='FISVERSAT' THEN mik else 0 end,\r\n       CASE WHEN fistip='FISALCSAT' THEN  -1*mik else mik end,\r\n       0\r\n       FROM veresihrk as h inner join veresimas as m on h.verid=m.verid\r\n       and m.sil=0 and h.sil=0\r\n       inner join stokkart as k on k.kod=h.stkod\r\n       and k.tip=h.stktip and k.tip=@STK_TIP and k.kod=@STK_KOD \r\n       WHERE cartip=@CARI_TIP \r\n       and carkod in (select * from CsvToSTR(@CARI_KOD) )\r\n       AND (tarih >= @TARIH1)\r\n       AND (tarih <= @TARIH2)\r\n       and m.aktip in (select * from CsvToSTR(@FISDRMIN))\r\n       AND m.fistip=@FISTIP \r\n       AND m.plaka=@PLAKA \r\n     ORDER BY m.cartip,m.carkod,\r\n     h.stktip,h.stkod,m.fistip,m.plaka,tarih,saat\r\n    end \r\n    \r\n    \r\n   if (@PLAKA<>'')  and (@FIRMANO>0)/* tek stok kartları */\r\n   begin\r\n   DECLARE CRS_HRK CURSOR FAST_FORWARD FOR\r\n    SELECT\r\n      m.cartip,m.carkod,'',\r\n      stktip,stkod,k.ad,\r\n       tarih,saat,\r\n       seri+cast([no] as varchar),\r\n       m.ykno,m.plaka, /*PLAKA */\r\n      ack, /* AÇIKLAMA, */\r\n      fisad,yerad,h.olususer,fistip,\r\n      m.verid,brmfiy,h.brim,\r\n       CASE WHEN fistip='FISALCSAT' THEN  mik else 0 end,\r\n       CASE WHEN fistip='FISVERSAT' THEN mik else 0 end,\r\n       CASE WHEN fistip='FISALCSAT' THEN  -1*mik else mik end,\r\n       0\r\n       FROM veresihrk as h \r\n       inner join veresimas as m on h.verid=m.verid\r\n       and m.sil=0 and h.sil=0\r\n       and m.firmano in (@FIRMANO,0)\r\n       inner join stokkart as k on k.kod=h.stkod\r\n       and k.tip=h.stktip and k.tip=@STK_TIP and k.kod=@STK_KOD \r\n       WHERE cartip=@CARI_TIP \r\n       and carkod in (select * from CsvToSTR(@CARI_KOD) )\r\n       AND (tarih >= @TARIH1)\r\n       AND (tarih <= @TARIH2)\r\n       and m.aktip in (select * from CsvToSTR(@FISDRMIN))\r\n       AND m.fistip=@FISTIP \r\n       AND m.plaka=@PLAKA \r\n     ORDER BY m.cartip,m.carkod,\r\n     h.stktip,h.stkod,m.fistip,m.plaka,tarih,saat\r\n    end  \r\n     \r\n \r\n  OPEN CRS_HRK\r\n\r\n  SET @KUM_BAKIYE=0\r\n\r\n  FETCH NEXT FROM CRS_HRK INTO\r\n   @HRK_CARI_TIP,@HRK_CARI_KOD,@HRK_CARI_UNVAN,\r\n   @HRK_STOK_TIP,@HRK_STOK_KOD,@HRK_STOK_AD,\r\n   @HRK_TARIH,@HRK_SAAT,@HRK_BELGENO,@HRK_YKNO,@HRK_PLAKA,@HRK_ACIKLAMA,\r\n   @HRK_FISAD,@HRK_YERAD,@HRK_KULAD,@HRK_FISTIP,@HRK_HRKID,@HRK_BRMFIY,\r\n   @HRK_BIRIM,@HRK_ALCAKMIK,@HRK_VERILENMIK,@HRK_BAKIYE,\r\n   @HRK_DEVIR\r\n\r\n  WHILE @@FETCH_STATUS = 0\r\n  BEGIN\r\n\r\n     if @DEVIR=1\r\n       begin\r\n       \r\n        SELECT @KUM_BAKIYE = BAKIYE FROM @EKSTRE_TEMP where\r\n         HRKID=0\r\n       \r\n        /*\r\n         if (@HRK_ONSTOK_TIP<>@HRK_STOK_TIP) and\r\n         (@HRK_ONSTOK_KOD<>@HRK_STOK_KOD)\r\n         begin\r\n         SELECT @KUM_BAKIYE = BAKIYE FROM @EKSTRE_TEMP where\r\n         STOK_TIP=@HRK_STOK_TIP and STOK_KOD=@HRK_STOK_KOD\r\n         and HRKID=0\r\n         set @HRK_ONSTOK_TIP=@HRK_STOK_TIP\r\n          set @HRK_ONSTOK_KOD=@HRK_STOK_KOD\r\n         end\r\n        */ \r\n       end\r\n       \r\n\r\n\r\n\r\n\r\n       \r\n    SET @KUM_BAKIYE = @KUM_BAKIYE - @HRK_BAKIYE\r\n\r\n    SET @HRK_ALACAKTUT=@HRK_ALCAKMIK*@HRK_BRMFIY\r\n    SET @HRK_VERILENTUT=@HRK_VERILENMIK*@HRK_BRMFIY\r\n\r\n\r\n    INSERT @EKSTRE_TEMP\r\n      SELECT\r\n       @HRK_CARI_TIP,@HRK_CARI_KOD,@HRK_CARI_UNVAN,\r\n       @HRK_STOK_TIP,@HRK_STOK_KOD,@HRK_STOK_AD,\r\n       @HRK_TARIH,@HRK_SAAT,@HRK_BELGENO,@HRK_YKNO,\r\n       @HRK_PLAKA,@HRK_ACIKLAMA,\r\n       @HRK_FISAD,@HRK_YERAD,@HRK_KULAD,@HRK_FISTIP,\r\n       @HRK_HRKID,@HRK_BRMFIY,@HRK_BIRIM,@HRK_ALCAKMIK,@HRK_VERILENMIK,\r\n       @HRK_ALACAKTUT,@HRK_VERILENTUT,@KUM_BAKIYE,@HRK_DEVIR\r\n\r\n    FETCH NEXT FROM CRS_HRK INTO\r\n      @HRK_CARI_TIP,@HRK_CARI_KOD,@HRK_CARI_UNVAN,\r\n      @HRK_STOK_TIP,@HRK_STOK_KOD,@HRK_STOK_AD,\r\n      @HRK_TARIH,@HRK_SAAT,@HRK_BELGENO,@HRK_YKNO,\r\n      @HRK_PLAKA,@HRK_ACIKLAMA,\r\n      @HRK_FISAD,@HRK_YERAD,@HRK_KULAD,@HRK_FISTIP,\r\n      @HRK_HRKID,@HRK_BRMFIY,@HRK_BIRIM,@HRK_ALCAKMIK,@HRK_VERILENMIK,\r\n      @HRK_BAKIYE,@HRK_DEVIR\r\n  END\r\n\r\n  CLOSE CRS_HRK\r\n  DEALLOCATE CRS_HRK\r\n\r\n  /*---------------------------------------------------------------------------- */\r\n\r\n\r\n   UPDATE @EKSTRE_TEMP SET\r\n   CARI_UNVAN=DT.unvan FROM @EKSTRE_TEMP AS T \r\n   JOIN (SELECT cartip,kod,unvan FROM Genel_Cari_Kart )\r\n   dt on dt.cartip=t.CARI_TIP and dt.kod=t.CARI_KOD\r\n\r\n\r\n  INSERT @TB_STOKLITRE_EKSTRE\r\n    SELECT \r\n    CARI_TIP,CARI_KOD,CARI_UNVAN,\r\n    STOK_TIP,STOK_KOD,STOK_AD,\r\n    TARIH,SAAT,BELGENO,YKNO,PLAKA,ACIKLAMA,\r\n    FISAD,YERAD,KULAD,FISTIP,HRKID,BRMFIY,BIRIM,ALCAKMIK,\r\n    VERILENMIK,ALACAKTUT,\r\n    VERILENTUT,BAKIYE,DEVIR \r\n    FROM @EKSTRE_TEMP order by TARIH,SAAT\r\n\r\n\r\n  RETURN\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_CARIWEBFIS_HRK",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_CARIWEBFIS_HRK",
    "definition": "CREATE FUNCTION [dbo].UDF_CARIWEBFIS_HRK (\r\n@FISTIP INT,\r\n@CARI_TIP VARCHAR(20),\r\n@CARI_KOD VARCHAR(20),\r\n@TARIH1 DATETIME,@TARIH2 DATETIME)\r\nRETURNS\r\n  @TB_STOKFIS_EKSTRE TABLE (\r\n    STOK_KOD    VARCHAR(20)   COLLATE Turkish_CI_AS,\r\n    STOK_AD     VARCHAR(50)   COLLATE Turkish_CI_AS,\r\n    TARIH       DATETIME,\r\n    SAAT        VARCHAR(8)    COLLATE Turkish_CI_AS,\r\n    BELGENO     VARCHAR(30)   COLLATE Turkish_CI_AS,\r\n    YKNO        VARCHAR(30)   COLLATE Turkish_CI_AS,\r\n    PLAKA       VARCHAR(30)   COLLATE Turkish_CI_AS,\r\n    SURUCU      VARCHAR(50)   COLLATE Turkish_CI_AS,\r\n    ACIKLAMA    VARCHAR(100)  COLLATE Turkish_CI_AS,\r\n    FISAD       VARCHAR(30)   COLLATE Turkish_CI_AS,\r\n    BRMFIY      FLOAT,\r\n    BIRIM       VARCHAR(10)   COLLATE Turkish_CI_AS,\r\n    TUTAR       FLOAT)\r\nAS\r\nBEGIN\r\n  DECLARE @EKSTRE_TEMP TABLE (\r\n    STOK_KOD    VARCHAR(20)  COLLATE Turkish_CI_AS,\r\n    STOK_AD     VARCHAR(50)  COLLATE Turkish_CI_AS,\r\n    TARIH       DATETIME,\r\n    SAAT        VARCHAR(8)   COLLATE Turkish_CI_AS,\r\n    BELGENO     VARCHAR(30)  COLLATE Turkish_CI_AS,\r\n    YKNO        VARCHAR(30)  COLLATE Turkish_CI_AS,\r\n    PLAKA       VARCHAR(20)  COLLATE Turkish_CI_AS,\r\n    SURUCU      VARCHAR(50)   COLLATE Turkish_CI_AS,\r\n    ACIKLAMA    VARCHAR(100) COLLATE Turkish_CI_AS,\r\n    FISAD       VARCHAR(30)  COLLATE Turkish_CI_AS,\r\n    BRMFIY      FLOAT,\r\n    BIRIM       VARCHAR(10)  COLLATE Turkish_CI_AS,\r\n    TUTAR       FLOAT)\r\n\r\n  DECLARE @HRK_STOK_KOD    VARCHAR(20)\r\n  DECLARE @HRK_STOK_AD     VARCHAR(50)\r\n  DECLARE @HRK_TARIH       DATETIME\r\n  DECLARE @HRK_SAAT        VARCHAR(8)\r\n  DECLARE @HRK_BELGENO     VARCHAR(30)\r\n  DECLARE @HRK_YKNO        VARCHAR(30)\r\n  DECLARE @HRK_PLAKA       VARCHAR(20)\r\n  DECLARE @HRK_SURUCU      VARCHAR(50)\r\n  DECLARE @HRK_ACIKLAMA    VARCHAR(100)\r\n  DECLARE @HRK_FISAD       VARCHAR(30)\r\n  DECLARE @HRK_BRMFIY      FLOAT\r\n  DECLARE @HRK_BIRIM       VARCHAR(10)\r\n  DECLARE @HRK_MIKTAR      FLOAT\r\n  DECLARE @HRK_TUTAR       FLOAT\r\n  DECLARE @FISTIPIN        VARCHAR(20)\r\n\r\n\r\n  IF @FISTIP=1 \r\n  SET @FISTIPIN='BK,BL,HV'\r\n  IF @FISTIP=0 \r\n  SET @FISTIPIN='FT,CH'\r\n\r\n\r\n  DECLARE CRS_HRK CURSOR FAST_FORWARD FOR\r\n    /* Cari Fişlerden gelen harektler */\r\n    SELECT\r\n       stkod,k.ad,tarih,saat,\r\n       seri+cast([no] as varchar),\r\n       m.ykno,m.plaka,m.surucu,\r\n       ack, /* AÇIKLAMA, */\r\n       fisad,brmfiy,h.brim,\r\n       CASE WHEN fistip='FISVERSAT' THEN mik else  -1*mik end \r\n       FROM veresihrk as h inner join veresimas as m on h.verid=m.verid\r\n       and m.sil=0 and h.sil=0\r\n       inner join stokkart as k on k.kod=h.stkod\r\n       and k.tip=h.stktip\r\n       WHERE cartip=@CARI_TIP\r\n       and carkod=@CARI_KOD and m.aktip in (SELECT * FROM CsvToSTR(@FISTIPIN))\r\n       AND tarih >= @TARIH1  AND tarih <= @TARIH2\r\n      ORDER BY tarih\r\n\r\n\r\n   OPEN CRS_HRK\r\n\r\n  FETCH NEXT FROM CRS_HRK INTO\r\n   @HRK_STOK_KOD,@HRK_STOK_AD,@HRK_TARIH,@HRK_SAAT,@HRK_BELGENO,@HRK_YKNO,\r\n   @HRK_PLAKA,@HRK_SURUCU,@HRK_ACIKLAMA,\r\n   @HRK_FISAD,@HRK_BRMFIY,@HRK_BIRIM,@HRK_MIKTAR\r\n\r\n  WHILE @@FETCH_STATUS = 0\r\n  BEGIN\r\n\r\n    SET @HRK_TUTAR=(@HRK_BRMFIY*@HRK_MIKTAR)\r\n    \r\n\r\n    INSERT @EKSTRE_TEMP\r\n      SELECT\r\n       @HRK_STOK_KOD,@HRK_STOK_AD,@HRK_TARIH,@HRK_SAAT,@HRK_BELGENO,@HRK_YKNO,\r\n       @HRK_PLAKA,@HRK_SURUCU,@HRK_ACIKLAMA,\r\n       @HRK_FISAD,@HRK_BRMFIY,@HRK_BIRIM,@HRK_TUTAR\r\n\r\n    FETCH NEXT FROM CRS_HRK INTO\r\n      @HRK_STOK_KOD,@HRK_STOK_AD,@HRK_TARIH,@HRK_SAAT,@HRK_BELGENO,@HRK_YKNO,\r\n      @HRK_PLAKA,@HRK_SURUCU,@HRK_ACIKLAMA,\r\n      @HRK_FISAD,@HRK_BRMFIY,@HRK_BIRIM,@HRK_MIKTAR\r\n  END\r\n\r\n  CLOSE CRS_HRK\r\n  DEALLOCATE CRS_HRK\r\n\r\n  /*---------------------------------------------------------------------------- */\r\n\r\n  INSERT @TB_STOKFIS_EKSTRE\r\n    SELECT STOK_KOD,STOK_AD,TARIH,SAAT,BELGENO,YKNO,PLAKA,SURUCU,ACIKLAMA,\r\n    FISAD,BRMFIY,BIRIM,TUTAR FROM @EKSTRE_TEMP\r\n\r\n  RETURN\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_Cari_Risk_Rap_Hrk",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_Cari_Risk_Rap_Hrk",
    "definition": "create FUNCTION [dbo].[UDF_Cari_Risk_Rap_Hrk] (\r\n@firmano \t\tint,\r\n@BasTar\t\tDatetime,\r\n@BitTar\t\tDatetime,\r\n@RefTar     Datetime)\r\nRETURNS\r\n   \r\n   @TABLE_BAKIYE_SATIS TABLE (\r\n   id\t\t\t\t\tint IDENTITY(1, 1) NOT NULL,\r\n   Cari_Tip\t\t\t\tVARCHAR(30) COLLATE Turkish_CI_AS,\r\n   Cari_Kod\t\t\t\tVARCHAR(30) COLLATE Turkish_CI_AS,\r\n   Cari_Unvan\t\t\tVARCHAR(200) COLLATE Turkish_CI_AS,\r\n   SrNo\t\t\t\t\tint,\r\n   Ack\t\t\t\t\tVARCHAR(200) COLLATE Turkish_CI_AS,\r\n   Tutar\t\t\t\tfloat)\r\n  \r\nAS\r\nBEGIN\r\n \r\n   declare  @TABLE_BAKIYE TABLE (\r\n   id\t\t\t\t\tint IDENTITY(1, 1) NOT NULL,\r\n   Cari_Tip\t\t\t\tVARCHAR(30) COLLATE Turkish_CI_AS,\r\n   Cari_Kod\t\t\t\tVARCHAR(30) COLLATE Turkish_CI_AS,\r\n   Cari_Unvan\t\t\tVARCHAR(200) COLLATE Turkish_CI_AS,\r\n   Tarih\t\t\t\tDatetime,\r\n   Vade_Tarih\t\t\tDatetime,\r\n   Islem_Ad\t\t\t\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n   Borc\t\t\t\t\tfloat,\r\n   Odeme\t\t\t\tfloat,\r\n   Alacak\t\t\t    float,\r\n   Ack\t\t\t\t\tVARCHAR(200) COLLATE Turkish_CI_AS)\r\n\r\n\r\n /*borc */\r\n  if @firmano=0\r\n  insert into @TABLE_BAKIYE\r\n  select k.cartip,k.kod,k.Unvan,\r\n  h.tarih,h.vadetar,h.islmhrkad,\r\n  Borc,0,Alacak,Ack  \r\n  from carihrk as h  with (NOLOCK)\r\n  inner join Genel_Cari_Kart as k \r\n  on h.cartip=k.cartip and h.carkod=k.kod\r\n  and h.sil=0 and k.CarTip_id=1\r\n  where h.tarih>=@BasTar\r\n  and h.tarih<=@BitTar\r\n  \r\n  \r\n  if @firmano>0\r\n  insert into @TABLE_BAKIYE\r\n  select k.cartip,k.kod,k.Unvan,\r\n  h.tarih,h.vadetar,h.islmhrkad,\r\n  Borc,0,Alacak,Ack  \r\n  from carihrk as h with (NOLOCK)\r\n  inner join Genel_Cari_Kart as k \r\n  on h.cartip=k.cartip and h.carkod=k.kod\r\n  and h.sil=0 and k.CarTip_id=1\r\n  and h.firmano in (0,@firmano)\r\n  where h.tarih>=@BasTar\r\n  and h.tarih<=@BitTar\r\n  \r\n  \r\n  \r\n    declare @id int\r\n    declare @Say int\r\n    declare @Kod varchar(50)\r\n    declare @Alacak  Float\r\n    declare @Bakiye  Float\r\n    declare @Tarih  Datetime\r\n    \r\n     declare pom_var CURSOR FAST_FORWARD  FOR \r\n      select Cari_Kod,Alacak,Tarih From @TABLE_BAKIYE       \r\n      where Alacak>0 Order By Cari_Kod,Vade_Tarih\r\n      open pom_var\r\n     fetch next from  pom_var into @Kod,@Alacak,@Tarih\r\n      while @@FETCH_STATUS=0\r\n      begin\r\n    \r\n     SET @Bakiye=0\r\n    \r\n      Select Top 1 @id=id,@Bakiye=Borc-Odeme From @TABLE_BAKIYE \r\n      Where  Cari_Kod=@Kod and Borc-Odeme>0 order by id\r\n\r\n\r\n      while (@Bakiye>0.1)             \r\n      begin\r\n\r\n        if @Bakiye>= @Alacak\r\n         begin\r\n            Update @TABLE_BAKIYE Set Odeme=Odeme+@Alacak \r\n            Where id=@id \r\n            set  @Bakiye=0\r\n         end\r\n        \r\n          if (@Bakiye <= @Alacak) and (@Bakiye>0.1)\r\n          begin\r\n   \r\n           Update @TABLE_BAKIYE Set Odeme=Odeme+@Bakiye Where id=@id\r\n            set @Alacak=@Alacak-@Bakiye       \r\n            \r\n            \r\n             Select Top 1 @id=id,@Bakiye=isnull(Borc-Odeme,0) From @TABLE_BAKIYE \r\n              Where  Cari_Kod=@Kod and (Borc-Odeme)>0 order by id \r\n          end \r\n          \r\n       end /*while */\r\n      \r\n\r\n\r\n      FETCH next from  pom_var into @Kod,@Alacak,@Tarih\r\n     end\r\n    close Pom_Var\r\n    deallocate pom_var\r\n\r\n  \r\n  \r\n  \r\n  \r\n  \r\n  \r\n  insert into @TABLE_BAKIYE_SATIS\r\n  select Cari_Tip,Cari_Kod,Cari_Unvan,\r\n  1,'YAPILAN ALIM',Sum(Borc) from  @TABLE_BAKIYE\r\n  Group by  Cari_Tip,Cari_Kod,Cari_Unvan\r\n  order by Cari_Tip,Cari_Kod,Cari_Unvan\r\n\r\n  \r\n  \r\n  insert into @TABLE_BAKIYE_SATIS\r\n   select Cari_Tip,Cari_Kod,Cari_Unvan,\r\n   2,'YAPILAN ÖDEME',Sum(ALACAK) from @TABLE_BAKIYE\r\n   Group by  Cari_Tip,Cari_Kod,Cari_Unvan\r\n   order by Cari_Tip,Cari_Kod,Cari_Unvan \r\n   \r\n   \r\n   \r\n   insert into @TABLE_BAKIYE_SATIS\r\n   select Cari_Tip,Cari_Kod,Cari_Unvan,\r\n   3,'VADESİ GEÇMİŞ BORÇ',Sum(borc-Odeme) from  @TABLE_BAKIYE\r\n   Where Vade_Tarih<@RefTar\r\n   Group by  Cari_Tip,Cari_Kod,Cari_Unvan\r\n   order by Cari_Tip,Cari_Kod,Cari_Unvan \r\n   \r\n   /* not in */\r\n   insert into @TABLE_BAKIYE_SATIS\r\n   select Cari_Tip,Cari_Kod,Cari_Unvan,\r\n   3,'VADESİ GEÇMİŞ BORÇ',0 from  @TABLE_BAKIYE\r\n   Where Cari_Kod not in (Select Cari_Kod From @TABLE_BAKIYE_SATIS Where SrNo=3)\r\n   Group by  Cari_Tip,Cari_Kod,Cari_Unvan\r\n   order by Cari_Tip,Cari_Kod,Cari_Unvan \r\n   \r\n\r\n   \r\n   insert into @TABLE_BAKIYE_SATIS\r\n   select Cari_Tip,Cari_Kod,Cari_Unvan,\r\n   4,'VADESİ GELECEK BORÇ',Sum(borc-Odeme) from  @TABLE_BAKIYE\r\n   Where Vade_Tarih>=@RefTar\r\n   Group by  Cari_Tip,Cari_Kod,Cari_Unvan\r\n   order by Cari_Tip,Cari_Kod,Cari_Unvan \r\n   \r\n   \r\n   \r\n   /* not in */\r\n   insert into @TABLE_BAKIYE_SATIS\r\n   select Cari_Tip,Cari_Kod,Cari_Unvan,\r\n   4,'VADESİ GELECEK BORÇ',0 from  @TABLE_BAKIYE\r\n   Where Cari_Kod not in (Select Cari_Kod From @TABLE_BAKIYE_SATIS Where SrNo=4)\r\n   Group by  Cari_Tip,Cari_Kod,Cari_Unvan\r\n   order by Cari_Tip,Cari_Kod,Cari_Unvan \r\n   \r\n     \r\n   insert into @TABLE_BAKIYE_SATIS\r\n   select Cari_Tip,Cari_Kod,Cari_Unvan,\r\n   5,'CARİ BORÇ', Sum(Tutar) from  @TABLE_BAKIYE_SATIS\r\n   Where SrNo in (3,4)\r\n   Group by  Cari_Tip,Cari_Kod,Cari_Unvan\r\n   order by Cari_Tip,Cari_Kod,Cari_Unvan \r\n   \r\n   \r\n   insert into @TABLE_BAKIYE_SATIS\r\n   select 'carikart',Kod,'',\r\n   6,'TEMİNAT TUTAR', isnull(Sum(Tutar),0) from  cariteminat\r\n   Where Kod in (Select Cari_Kod From @TABLE_BAKIYE_SATIS)\r\n   Group by  Kod   order by Kod\r\n  \r\n  \r\n   /* not in */\r\n   insert into @TABLE_BAKIYE_SATIS\r\n   select Cari_Tip,Cari_Kod,Cari_Unvan,\r\n   6,'TEMİNAT TUTAR',0 from  @TABLE_BAKIYE\r\n   Where Cari_Kod not in (Select Cari_Kod From @TABLE_BAKIYE_SATIS Where SrNo=6)\r\n   Group by  Cari_Tip,Cari_Kod,Cari_Unvan\r\n   order by Cari_Tip,Cari_Kod,Cari_Unvan \r\n   \r\n   \r\n  insert into @TABLE_BAKIYE_SATIS\r\n   select 'carikart',carkod,'',\r\n   7,'İLERİ VADELİ ÇEK',Sum(giren) from cekkart where cartip='carikart'\r\n   and Sil=0 and vadetar>=@RefTar\r\n   and carkod in (Select Cari_Kod From @TABLE_BAKIYE_SATIS)\r\n   Group by  carkod  \r\n\r\n   \r\n   /* not in */\r\n   insert into @TABLE_BAKIYE_SATIS\r\n   select Cari_Tip,Cari_Kod,Cari_Unvan,\r\n   7,'İLERİ VADELİ ÇEK',0 from  @TABLE_BAKIYE\r\n   Where Cari_Kod not in (Select Cari_Kod From @TABLE_BAKIYE_SATIS Where SrNo=7)\r\n   Group by  Cari_Tip,Cari_Kod,Cari_Unvan\r\n   order by Cari_Tip,Cari_Kod,Cari_Unvan \r\n\r\n\r\n\r\n   insert into @TABLE_BAKIYE_SATIS\r\n   select Cari_Tip,Cari_Kod,Cari_Unvan,\r\n   8,'RİSK',Sum(Tutar) from  @TABLE_BAKIYE_SATIS\r\n   Where SrNo in (5)\r\n   Group by  Cari_Tip,Cari_Kod,Cari_Unvan\r\n   order by Cari_Tip,Cari_Kod,Cari_Unvan \r\n   \r\n   \r\n   UPDATE @TABLE_BAKIYE_SATIS SET Tutar=Tutar+isnull(dt.Tutr,0) from  @TABLE_BAKIYE_SATIS\r\n   as t join (Select Cari_Kod,Tutar as  Tutr From @TABLE_BAKIYE_SATIS where SrNo=7) dt \r\n   on Dt.Cari_Kod=t.Cari_Kod and T.Srno=8\r\n   \r\n   \r\n   \r\n   UPDATE @TABLE_BAKIYE_SATIS SET Tutar=Tutar-isnull(dt.Tutr,0) from  @TABLE_BAKIYE_SATIS\r\n   as t join (Select Cari_Kod,Tutar as Tutr From @TABLE_BAKIYE_SATIS where SrNo=6) dt \r\n   on Dt.Cari_Kod=t.Cari_Kod and T.Srno=8\r\n   \r\n   \r\n   \r\n    UPDATE @TABLE_BAKIYE_SATIS SET Cari_Unvan=Unvan from  @TABLE_BAKIYE_SATIS\r\n   as t join (Select kod,Unvan From Genel_Cari_Kart) dt \r\n   on Dt.Kod=t.Cari_Kod \r\n   \r\n\r\n\r\n RETURN\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_Cari_Web_Bakiye",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_Cari_Web_Bakiye",
    "definition": "CREATE FUNCTION [dbo].UDF_Cari_Web_Bakiye (\r\n@id int)\r\nRETURNS\r\n  @TB_CAR_WEB_GENEL TABLE\r\n  (id           int,\r\n  carkod        VARCHAR (30),\r\n  ad            VARCHAR (100),\r\n  soyad         VARCHAR (100),\r\n  fis_bakiye    float,\r\n  car_bakiye   float,\r\n  top_bakiye    float\r\n  )\r\nAS\r\nBEGIN\r\n\r\n  insert into @TB_CAR_WEB_GENEL\r\n  (id,carkod,ad,soyad,fis_bakiye,car_bakiye,top_bakiye)\r\n  select\r\n  id,kod,ad,soyad,fis_bakiye,car_bakiye,top_bakiye\r\n  from Cari_Kart_Listesi where id=@id\r\n  \r\n  return\r\n\r\n\r\n  \r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_CariFisVadeFark_Hrk",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_CariFisVadeFark_Hrk",
    "definition": "CREATE FUNCTION [dbo].[UDF_CariFisVadeFark_Hrk] \r\n(@CariKod  VARCHAR(50),\r\n@BitTarih   Datetime)\r\nRETURNS\r\n    @TB_VADE_FARK TABLE (\r\n    Id\t\t\t\t\tint,/* IDENTITY(1, 1) NOT NULL, */\r\n    TId\t\t\t\t\tint ,\r\n   CariTip\t\t\t    VARCHAR(20) COLLATE Turkish_CI_AS,\r\n   CariTip_Id\t\t\tint,\r\n   CariId\t\t\t\tint,\r\n   CariKod\t\t\t\tVARCHAR(30) COLLATE Turkish_CI_AS,\r\n   Bolundu              int default 0,\r\n   KTip                 int,\r\n   FisSeriNo            VARCHAR(50) COLLATE Turkish_CI_AS,\r\n   BorcFisTutar         Float default 0,   \r\n   Borc      \t\t\tFloat,\r\n   Alacak\t\t\t\tFloat,\r\n   Odenen\t\t\t\tFloat default 0,\r\n   VadeTarih\t\t\tDateTime,\r\n   DevirliVadeTarih\t    DateTime,\r\n   VadeOran\t\t\t    float,\r\n   VadeGun\t\t\t\tint,\r\n   OdemeTarih\t\t\tDateTime,\r\n   VadeTutar\t\t\tfloat)\r\nAS\r\nBEGIN\r\n\r\n   declare @TABLE_BAKIYE_BORC TABLE (\r\n   Id\t\t\t\t\tint IDENTITY(1, 1) NOT NULL,\r\n   TId\t\t\t\t\tint ,\r\n   CariTip\t\t\t    VARCHAR(20) COLLATE Turkish_CI_AS,\r\n   CariTip_Id\t\t\tint,\r\n   CariId\t\t\t\tint,\r\n   CariKod\t\t\t\tVARCHAR(30) COLLATE Turkish_CI_AS,\r\n   Bolundu              int default 0,\r\n   KTip                 int,\r\n   FisSeriNo            VARCHAR(50) COLLATE Turkish_CI_AS,\r\n   BorcFisTutar         Float default 0,   \r\n   Borc      \t\t\tFloat,\r\n   Alacak\t\t\t\tFloat,\r\n   Odenen\t\t\t\tFloat default 0,\r\n   VadeTarih\t\t\tDateTime,\r\n   DevirliVadeTarih\t    DateTime,\r\n   VadeOran\t\t\t    float,\r\n   VadeGun\t\t\t\tint,\r\n   OdemeTarih\t\t\tDateTime,\r\n   VadeTutar\t\t\tfloat)\r\n   \r\n   declare @Devirlimi int\r\n   set @Devirlimi=0\r\n   \r\n   Declare @GunTarih Datetime\r\n   Set @GunTarih=DATEADD(day, DATEDIFF(day, 0, @BitTarih),0)\r\n   \r\n if @CariKod<>'' \r\n  insert into @TABLE_BAKIYE_BORC (TId,KTip,CariTip,CariKod,VadeTarih,DevirliVadeTarih,OdemeTarih,\r\n  FisSeriNo,BorcFisTutar,Borc,Alacak)\r\n  Select id,1 KTip,cartip,carkod,Tarih,null,null,'CARI BORC',\r\n  Round(Borc,2) BorcFisTutar,Round(Borc,2),Round(Alacak,2) From CariHrk with (nolock) \r\n  Where cartip='carikart' and carkod=@CariKod\r\n  and Sil=0 and islmhrk not in ('FATVERSAT','OFV') and \r\n  carkod in (select Kod From Carikart with (nolock) Where Kod=@CariKod \r\n  and Sil=0 and Oto_FisVadeFark=1)\r\n  union all \r\n  \r\n  Select id,1 KTip,cartip,carkod,Tarih,\r\n  DevirliVadeTarih,@GunTarih,cast(seri as varchar)+cast(no as varchar), 0 BorcFisTutar,0 Borc,Round(toptut,2) Alacak From veresimas with (nolock) \r\n  Where cartip='carikart' and carkod=@CariKod and Sil=0 and fistip = 'FISALCSAT'\r\n  and carkod in (select Kod From Carikart with (nolock) Where Kod=@CariKod and Sil=0 and Oto_FisVadeFark=1)\r\n  union all \r\n  \r\n  Select id,2 KTip,cartip,carkod, \r\n  case \r\n  when @Devirlimi=0  and DevirliVadeTarih is not null then DevirliVadeTarih \r\n  when @Devirlimi=0  and DevirliVadeTarih is null then VadTar \r\n  when @Devirlimi=1  then  VadTar \r\n  end, \r\n  DevirliVadeTarih,@GunTarih,cast(seri as varchar)+cast(no as varchar),Round(toptut,2) BorcFisTutar,Round(toptut,2) Borc,0 Alacak From veresimas with (nolock) \r\n  Where cartip='carikart' and carkod=@CariKod and Sil=0 and fistip != 'FISALCSAT'\r\n  and carkod in (select Kod From Carikart with (nolock) Where Kod=@CariKod and Sil=0 and Oto_FisVadeFark=1)\r\n  order By Carkod\r\n  \r\n  else\r\n  \r\n  insert into @TABLE_BAKIYE_BORC (TId,KTip,CariTip,CariKod,VadeTarih,DevirliVadeTarih,OdemeTarih,\r\n  FisSeriNo,BorcFisTutar,Borc,Alacak)\r\n  Select id,1 KTip,cartip,carkod,Tarih,null,null,\r\n  'CARI BORC',Round(Borc,2) BorcFisTutar,Round(Borc,2),Round(Alacak,2) From CariHrk with (nolock) \r\n  Where cartip='carikart' and Sil=0 and islmhrk not in ('FATVERSAT','OFV') and \r\n  carkod in (select Kod From Carikart with (nolock) Where Sil=0 and Oto_FisVadeFark=1)\r\n  union all \r\n  \r\n  Select id,1 KTip,cartip,carkod,\r\n  case \r\n  when @Devirlimi=0  and DevirliVadeTarih is not null then DevirliVadeTarih \r\n  when @Devirlimi=0  and DevirliVadeTarih is null then VadTar \r\n  when @Devirlimi=1  then  VadTar \r\n  end,\r\n  DevirliVadeTarih,@GunTarih,cast(seri as varchar)+cast(no as varchar),0 BorcFisTutar,0 Borc,Round(toptut,2) Alacak From veresimas with (nolock)\r\n  Where cartip='carikart' and Sil=0 and fistip = 'FISALCSAT'\r\n  and carkod in (select Kod From Carikart with (nolock)  Where Sil=0 and Oto_FisVadeFark=1)\r\n  union all \r\n  \r\n  \r\n  Select id,2 KTip,cartip,carkod,\r\n  case \r\n  when @Devirlimi=0  and DevirliVadeTarih is not null then DevirliVadeTarih \r\n  when @Devirlimi=0  and DevirliVadeTarih is null then VadTar \r\n  when @Devirlimi=1  then  VadTar  \r\n  end,    \r\n  DevirliVadeTarih,@GunTarih,cast(seri as varchar)+cast(no as varchar),\r\n  Round(toptut,2) BorcFisTutar,Round(toptut,2) Borc,0 Alacak From veresimas with (nolock)\r\n  Where cartip='carikart' and Sil=0 and fistip != 'FISALCSAT'\r\n  and carkod in (select Kod From Carikart with (nolock)  Where Sil=0 and Oto_FisVadeFark=1)\r\n  order By Carkod\r\n  \r\n  \r\n  \r\n  \r\n    declare @Id int,@TId int,@Say int,@KTip int\r\n    declare @Kod varchar(50),@Cari_Tip  varchar(30)\r\n    declare @Borc Float,@Alacak  Float\r\n    declare @Bakiye  Float\r\n    declare @Tarih  Datetime\r\n    declare @DevirliVadeTarih Datetime\r\n  \r\n  \r\n  \r\n \r\n    \r\n    Declare @Odenen  float  /*Hem Fiş Hemde Alacaktan Düşecek */\r\n    Declare @FisBorc  float\r\n    Declare @FisBakiye  float\r\n    Declare @AlacakBakiye  float\r\n    \r\n    Declare @TempId\t  float\r\n    Declare @Sayac  int,@MaxSayac int\r\n    Declare @OdemeTarih  Datetime\r\n    Declare @FisVadeTarih  Datetime\r\n    \r\n     \r\n   /*- Vade Fark Hesapla */\r\n \r\n    Declare @STarih Datetime\r\n    declare pom_var CURSOR FAST_FORWARD  FOR \r\n     select Id,CariKod,Round(Alacak,2),VadeTarih as OdemeTarih from @TABLE_BAKIYE_BORC \r\n     where Round(Alacak,2)>0  /* and KTip=1  */\r\n     order by CariKod,VadeTarih\r\n     open pom_var\r\n     fetch next from  pom_var into @Id,@Kod,@Alacak,@OdemeTarih\r\n      while @@FETCH_STATUS=0\r\n      begin\r\n  \r\n  \r\n       set @AlacakBakiye=@Alacak\r\n       \r\n       set @Sayac=1\r\n       set @MaxSayac=50\r\n      \r\n        \r\n      \r\n      \r\n       while @Sayac<@MaxSayac \r\n       begin\r\n       \r\n        Set @TempId=null\r\n        set @FisVadeTarih=null\r\n        \r\n        \r\n        \r\n        /*Fiş Borç ve Vade Tarihi Bilgileri */\r\n         Select top 1 @TempId=Id,@FisBorc=Round(Borc,2),@FisVadeTarih=VadeTarih From @TABLE_BAKIYE_BORC \r\n         Where CariKod=@Kod and round(Borc-Odenen,2)>0 and Bolundu=0 /*and KTip=2 */\r\n         order by VadeTarih,TId\r\n       \r\n       \r\n         /* print('Id='+cast(@Id as  varchar(20))+' TempId='+cast(@TempId as  varchar(20)) ) */\r\n       \r\n          if @TempId is null  /*Bakiye Yoksa */\r\n          begin\r\n            set @sayac=@MaxSayac\r\n            break\r\n            /*set  @OdemeTarih=@DevirTarih--DATEADD(day, DATEDIFF(day, 0, GetDate()), 0) */\r\n            \r\n          end  \r\n         else \r\n          begin\r\n             /*Fis Bakiyesi Alacaktan Buyukse İse */\r\n             /* Kalan Borc Kadar Yeni Fis Hrk Olustur */\r\n                     \r\n             \r\n             \r\n             if @AlacakBakiye<@FisBorc\r\n              begin\r\n               set @FisBakiye=(@FisBorc-@AlacakBakiye)\r\n               \r\n                insert into @TABLE_BAKIYE_BORC (TId,KTip,CariTip,CariKod,VadeTarih,DevirliVadeTarih,FisSeriNo,Borc,Alacak)\r\n                select TId,KTip,CariTip,CariKod,case when @FisVadeTarih>@OdemeTarih then @FisVadeTarih else @OdemeTarih end,\r\n                DevirliVadeTarih,FisSeriNo,@FisBakiye,0  from @TABLE_BAKIYE_BORC\r\n                where Id=@TempId               /*VadeTarih */\r\n                 \r\n                /*borc İcin    */\r\n                update @TABLE_BAKIYE_BORC set OdemeTarih=@OdemeTarih,Odenen=@AlacakBakiye,Bolundu=1 where Id=@TempId \r\n              \r\n                 /*Odeme İşlemi İçin  */\r\n                 update @TABLE_BAKIYE_BORC set Odenen=Odenen+@AlacakBakiye where Id=@Id \r\n              \r\n               set @AlacakBakiye=0\r\n               set @sayac=@MaxSayac\r\n               \r\n               /* print('BREAK Id='+cast(@Id as  varchar(20))+' TempId='+cast(@TempId as  varchar(20)) ) */\r\n                \r\n                BREAK\r\n               \r\n              end\r\n             /*borc Bakiyesi Alacaktan Kücük İse  */\r\n                          \r\n              if @AlacakBakiye>=@FisBorc\r\n              begin\r\n                 \r\n                /*borc İçin                  */\r\n                update @TABLE_BAKIYE_BORC set OdemeTarih=@OdemeTarih,Odenen=@FisBorc where Id=@TempId \r\n        \r\n                 /*Odeme İşlemi İçin  */\r\n                 update @TABLE_BAKIYE_BORC set Odenen=Odenen+@FisBorc where Id=@Id \r\n        \r\n        \r\n                set @AlacakBakiye=round(@AlacakBakiye-@FisBorc,2)\r\n                \r\n                set @sayac=@sayac+1\r\n              end\r\n             \r\n             \r\n             \r\n          end \r\n       end\r\n  \r\n  \r\n      FETCH next from  pom_var into @Id,@Kod,@Alacak,@OdemeTarih\r\n     end\r\n    close Pom_Var\r\n    deallocate pom_var\r\n    \r\n    \r\n    update @TABLE_BAKIYE_BORC Set CariId=dt.id,VadeOran=Dt.fisvadfark \r\n    From @TABLE_BAKIYE_BORC as t\r\n    join (select id,kod,fisvadfark from carikart with (nolock) )\r\n     dt on dt.Kod=t.CariKod\r\n  \r\n   Update @TABLE_BAKIYE_BORC Set VadeTutar=0,VadeGun=0\r\n   \r\n    \r\n    update @TABLE_BAKIYE_BORC set  OdemeTarih=@GunTarih \r\n    where OdemeTarih is null and Ktip=2\r\n  \r\n    \r\n    Update @TABLE_BAKIYE_BORC Set VadeGun=\r\n    case when round(CONVERT(float, OdemeTarih - VadeTarih),0)>0 then \r\n    round(CONVERT(float, OdemeTarih - VadeTarih),0) else 0 end\r\n    Where Ktip=2  /*Sadece Fis İslemine */\r\n\r\n   \r\n    Update @TABLE_BAKIYE_BORC Set VadeTutar=Borc*(VadeGun*(VadeOran/30)/100)\r\n    \r\n\r\n\r\n     Declare @Saat varchar(10)\r\n  \r\n     Set @Tarih=@GunTarih\r\n     Set @Saat=CONVERT(VARCHAR(8),GETDATE(),108)\r\n    \r\n   \r\n   if @CariKod<>''\r\n       INSERT @TB_VADE_FARK\r\n       select * from @TABLE_BAKIYE_BORC \r\n     /* WHERE Ktip=2 */\r\n      WHERE Borc>0\r\n       ORDER BY TId,Id asc, Bolundu desc\r\n\r\n       \r\n     \r\n   \r\n     \r\n   \r\n   \r\n   RETURN\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_CariFisVadeFark_Tarih",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_CariFisVadeFark_Tarih",
    "definition": "CREATE FUNCTION [dbo].[UDF_CariFisVadeFark_Tarih] \r\n(@CariKod  VARCHAR(50),\r\n@BitTarih   Datetime)\r\nRETURNS\r\n    @TB_VADE_FARK TABLE (\r\n    CARI_KOD    \tVARCHAR(30) COLLATE Turkish_CI_AS,\r\n    CARI_VADETUTAR  FLOAT)\r\nAS\r\nBEGIN\r\n\r\n   declare @TABLE_BAKIYE_BORC TABLE (\r\n   Id\t\t\t\t\tint IDENTITY(1, 1) NOT NULL,\r\n   TId\t\t\t\t\tint ,\r\n   CariTip\t\t\t    VARCHAR(20) COLLATE Turkish_CI_AS,\r\n   CariTip_Id\t\t\tint,\r\n   CariId\t\t\t\tint,\r\n   CariKod\t\t\t\tVARCHAR(30) COLLATE Turkish_CI_AS,\r\n   Bolundu              int default 0,\r\n   KTip                 int,\r\n   Borc      \t\t\tFloat,\r\n   Alacak\t\t\t\tFloat,\r\n   Odenen\t\t\t\tFloat default 0,\r\n   VadeTarih\t\t\tDateTime,\r\n   DevirliVadeTarih\t    DateTime,\r\n   VadeOran\t\t\t    float,\r\n   VadeGun\t\t\t\tint,\r\n   OdemeTarih\t\t\tDateTime,\r\n   VadeTutar\t\t\tfloat)\r\n   \r\n   declare @Devirlimi int\r\n   set @Devirlimi=0\r\n   \r\n   Declare @GunTarih Datetime\r\n   Set @GunTarih=DATEADD(day, DATEDIFF(day, 0, @BitTarih),0)\r\n   \r\n  if @CariKod<>'' \r\n  insert into @TABLE_BAKIYE_BORC (TId,KTip,CariTip,CariKod,VadeTarih,DevirliVadeTarih,OdemeTarih,Borc,Alacak)\r\n  Select id,1 KTip,cartip,carkod,Tarih,null,null,Round(Borc,2),Round(Alacak,2) From CariHrk with (nolock) \r\n  Where cartip='carikart' and carkod=@CariKod\r\n  and Sil=0 and islmhrk not in ('FATVERSAT') and \r\n  carkod in (select Kod From Carikart with (nolock) Where Kod=@CariKod \r\n  and Sil=0 and Oto_FisVadeFark=1)\r\n  union all \r\n  \r\n  Select id,1 KTip,cartip,carkod,Tarih,\r\n  DevirliVadeTarih,@GunTarih,0 Borc,Round(toptut,2) Alacak From veresimas with (nolock) \r\n  Where cartip='carikart' and carkod=@CariKod and Sil=0 and fistip = 'FISALCSAT'\r\n  and carkod in (select Kod From Carikart with (nolock) Where Kod=@CariKod and Sil=0 and Oto_FisVadeFark=1)\r\n  union all \r\n  \r\n  Select id,2 KTip,cartip,carkod, \r\n  case \r\n  when @Devirlimi=0  and DevirliVadeTarih is not null then DevirliVadeTarih \r\n  when @Devirlimi=0  and DevirliVadeTarih is null then VadTar \r\n  when @Devirlimi=1  then  VadTar \r\n  end, \r\n  DevirliVadeTarih,@GunTarih,Round(toptut,2) Borc,0 Alacak From veresimas with (nolock) \r\n  Where cartip='carikart' and carkod=@CariKod and Sil=0 and fistip != 'FISALCSAT'\r\n  and carkod in (select Kod From Carikart with (nolock) Where Kod=@CariKod and Sil=0 and Oto_FisVadeFark=1)\r\n  order By Carkod\r\n  \r\n  else\r\n  \r\n  insert into @TABLE_BAKIYE_BORC (TId,KTip,CariTip,CariKod,VadeTarih,DevirliVadeTarih,OdemeTarih,Borc,Alacak)\r\n  Select id,1 KTip,cartip,carkod,Tarih,null,null,Round(Borc,2),Round(Alacak,2) From CariHrk with (nolock) \r\n  Where cartip='carikart' and Sil=0 and islmhrk not in ('FATVERSAT') and \r\n  carkod in (select Kod From Carikart with (nolock) Where Sil=0 and Oto_FisVadeFark=1)\r\n  union all \r\n  \r\n  Select id,1 KTip,cartip,carkod,\r\n  case \r\n  when @Devirlimi=0  and DevirliVadeTarih is not null then DevirliVadeTarih \r\n  when @Devirlimi=0  and DevirliVadeTarih is null then VadTar \r\n  when @Devirlimi=1  then  VadTar \r\n  end,\r\n  DevirliVadeTarih,@GunTarih,0 Borc,Round(toptut,2) Alacak From veresimas with (nolock)\r\n  Where cartip='carikart' and Sil=0 and fistip = 'FISALCSAT'\r\n  and carkod in (select Kod From Carikart with (nolock)  Where Sil=0 and Oto_FisVadeFark=1)\r\n  union all \r\n  \r\n  \r\n  Select id,2 KTip,cartip,carkod,\r\n  case \r\n  when @Devirlimi=0  and DevirliVadeTarih is not null then DevirliVadeTarih \r\n  when @Devirlimi=0  and DevirliVadeTarih is null then VadTar \r\n  when @Devirlimi=1  then  VadTar  \r\n  end,    \r\n  DevirliVadeTarih,@GunTarih,Round(toptut,2) Borc,0 Alacak From veresimas with (nolock)\r\n  Where cartip='carikart' and Sil=0 and fistip != 'FISALCSAT'\r\n  and carkod in (select Kod From Carikart with (nolock)  Where Sil=0 and Oto_FisVadeFark=1)\r\n  order By Carkod\r\n  \r\n  \r\n  \r\n  \r\n  \r\n    declare @Id int,@TId int,@Say int,@KTip int\r\n    declare @Kod varchar(50),@Cari_Tip  varchar(30)\r\n    declare @Borc Float,@Alacak  Float\r\n    declare @Bakiye  Float\r\n    declare @Tarih  Datetime\r\n    declare @DevirliVadeTarih Datetime\r\n  \r\n  \r\n  \r\n \r\n    \r\n    Declare @Odenen  float  /*Hem Fiş Hemde Alacaktan Düşecek */\r\n    Declare @FisBorc  float\r\n    Declare @FisBakiye  float\r\n    Declare @AlacakBakiye  float\r\n    \r\n    Declare @TempId\t  float\r\n    Declare @Sayac  int,@MaxSayac int\r\n    Declare @OdemeTarih  Datetime\r\n    Declare @FisVadeTarih  Datetime\r\n     \r\n  /*- Vade Fark Hesapla */\r\n \r\n    Declare @STarih Datetime\r\n    declare pom_var CURSOR FAST_FORWARD  FOR \r\n     select Id,CariKod,Round(Alacak,2),VadeTarih as OdemeTarih from @TABLE_BAKIYE_BORC \r\n     where Round(Alacak,2)>0  /* and KTip=1  */\r\n     order by CariKod,VadeTarih\r\n     open pom_var\r\n     fetch next from  pom_var into @Id,@Kod,@Alacak,@OdemeTarih\r\n      while @@FETCH_STATUS=0\r\n      begin\r\n  \r\n  \r\n       set @AlacakBakiye=@Alacak\r\n       \r\n       set @Sayac=1\r\n       set @MaxSayac=50\r\n      \r\n        \r\n      \r\n      \r\n       while @Sayac<@MaxSayac \r\n       begin\r\n       \r\n        Set @TempId=null\r\n        set @FisVadeTarih=null\r\n        \r\n        \r\n        \r\n        /*Fiş Borç ve Vade Tarihi Bilgileri */\r\n         Select top 1 @TempId=Id,@FisBorc=Round(Borc,2),@FisVadeTarih=VadeTarih From @TABLE_BAKIYE_BORC \r\n         Where CariKod=@Kod and round(Borc-Odenen,2)>0 and Bolundu=0 /*and KTip=2 */\r\n         order by VadeTarih,TId\r\n       \r\n       \r\n         /* print('Id='+cast(@Id as  varchar(20))+' TempId='+cast(@TempId as  varchar(20)) ) */\r\n       \r\n          if @TempId is null  /*Bakiye Yoksa */\r\n          begin\r\n            set @sayac=@MaxSayac\r\n            break\r\n            /*set  @OdemeTarih=@DevirTarih--DATEADD(day, DATEDIFF(day, 0, GetDate()), 0) */\r\n            \r\n          end  \r\n         else \r\n          begin\r\n             /*Fis Bakiyesi Alacaktan Buyukse İse */\r\n             /* Kalan Borc Kadar Yeni Fis Hrk Olustur */\r\n                     \r\n             \r\n             \r\n             if @AlacakBakiye<@FisBorc\r\n              begin\r\n               set @FisBakiye=(@FisBorc-@AlacakBakiye)\r\n               \r\n                insert into @TABLE_BAKIYE_BORC (TId,KTip,CariTip,CariKod,VadeTarih,DevirliVadeTarih,Borc,Alacak)\r\n                select TId,KTip,CariTip,CariKod,case when @FisVadeTarih>@OdemeTarih then @FisVadeTarih else @OdemeTarih end,\r\n                DevirliVadeTarih,@FisBakiye,0  from @TABLE_BAKIYE_BORC\r\n                where Id=@TempId               /*VadeTarih */\r\n                 \r\n                /*borc İcin    */\r\n                update @TABLE_BAKIYE_BORC set OdemeTarih=@OdemeTarih,Odenen=@AlacakBakiye,Bolundu=1 where Id=@TempId \r\n              \r\n                 /*Odeme İşlemi İçin  */\r\n                 update @TABLE_BAKIYE_BORC set Odenen=Odenen+@AlacakBakiye where Id=@Id \r\n              \r\n               set @AlacakBakiye=0\r\n               set @sayac=@MaxSayac\r\n               \r\n               /* print('BREAK Id='+cast(@Id as  varchar(20))+' TempId='+cast(@TempId as  varchar(20)) ) */\r\n                \r\n                BREAK\r\n               \r\n              end\r\n             /*borc Bakiyesi Alacaktan Kücük İse  */\r\n                          \r\n              if @AlacakBakiye>=@FisBorc\r\n              begin\r\n                 \r\n                /*borc İçin                  */\r\n                update @TABLE_BAKIYE_BORC set OdemeTarih=@OdemeTarih,Odenen=@FisBorc where Id=@TempId \r\n        \r\n                 /*Odeme İşlemi İçin  */\r\n                 update @TABLE_BAKIYE_BORC set Odenen=Odenen+@FisBorc where Id=@Id \r\n        \r\n        \r\n                set @AlacakBakiye=@AlacakBakiye-@FisBorc\r\n                \r\n                set @sayac=@sayac+1\r\n              end\r\n             \r\n             \r\n             \r\n          end \r\n       end\r\n  \r\n  \r\n      FETCH next from  pom_var into @Id,@Kod,@Alacak,@OdemeTarih\r\n     end\r\n    close Pom_Var\r\n    deallocate pom_var\r\n    \r\n    \r\n    update @TABLE_BAKIYE_BORC Set CariId=dt.id,VadeOran=Dt.fisvadfark \r\n    From @TABLE_BAKIYE_BORC as t\r\n    join (select id,kod,fisvadfark from carikart with (nolock) )\r\n     dt on dt.Kod=t.CariKod\r\n  \r\n   Update @TABLE_BAKIYE_BORC Set VadeTutar=0,VadeGun=0\r\n   \r\n    \r\n    update @TABLE_BAKIYE_BORC set  OdemeTarih=@GunTarih \r\n    where OdemeTarih is null and Ktip=2\r\n  \r\n    \r\n    Update @TABLE_BAKIYE_BORC Set VadeGun=\r\n    case when round(CONVERT(float, OdemeTarih - VadeTarih),0)>0 then \r\n    round(CONVERT(float, OdemeTarih - VadeTarih),0) else 0 end\r\n    Where Ktip=2  /*Sadece Fis İslemine */\r\n\r\n   \r\n    Update @TABLE_BAKIYE_BORC Set VadeTutar=Borc*(VadeGun*(VadeOran/30)/100)\r\n    \r\n\r\n\r\n     Declare @Saat varchar(10)\r\n  \r\n     Set @Tarih=@GunTarih\r\n     Set @Saat=CONVERT(VARCHAR(8),GETDATE(),108)\r\n    \r\n   \r\n   if @CariKod<>''\r\n       INSERT @TB_VADE_FARK\r\n       select CariKod,Sum(isnull(VadeTutar,0)) AS VadeTutar from @TABLE_BAKIYE_BORC Group By CariKod\r\n\r\n       \r\n\r\n   RETURN\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_CEK_DRM",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_CEK_DRM",
    "definition": "CREATE FUNCTION [dbo].UDF_CEK_DRM (\r\n@FIRMANO    INT,\r\n@TARIH_TIP INT,\r\n@TARIH1 DATETIME,\r\n@TARIH2 DATETIME,\r\n@REFNO  VARCHAR(30),\r\n@CEKIDIN VARCHAR(8000))\r\nRETURNS\r\n  @TB_CARI_EKSTRE TABLE (\r\n    FIRMANO     INT,\r\n    CEKID       FLOAT,\r\n    CARI_TIP    VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    CARI_KOD    VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    CARI_UNVAN  VARCHAR(150) COLLATE Turkish_CI_AS,\r\n    ISLEMTARIH  DATETIME,\r\n    VADETARIH   DATETIME,\r\n    CEKNO       VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    REFNO       VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    CEKBANKAAD  VARCHAR(100) COLLATE Turkish_CI_AS,\r\n    CEKTURU     VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    DRMTIP      VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    DURUM       VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    BANKA_KOD   VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    BANKA_AD    VARCHAR(100) COLLATE Turkish_CI_AS,\r\n    NERTUR      VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    NERDEAD     VARCHAR(150) COLLATE Turkish_CI_AS,\r\n    BRIM        VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    TUTAR       DECIMAL(18,8))\r\n    AS\r\nBEGIN\r\n  DECLARE @EKSTRE_TEMP TABLE (\r\n    FIRMANO     INT,\r\n    CEKID       FLOAT,\r\n    CARI_TIP    VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    CARI_KOD    VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    CARI_UNVAN  VARCHAR(150) COLLATE Turkish_CI_AS,\r\n    ISLEMTARIH   DATETIME,\r\n    VADETARIH   DATETIME,\r\n    CEKNO       VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    REFNO       VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    CEKBANKAAD  VARCHAR(100) COLLATE Turkish_CI_AS,\r\n    CEKTURU     VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    DRMTIP      VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    DURUM       VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    BANKA_KOD   VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    BANKA_AD    VARCHAR(100) COLLATE Turkish_CI_AS,\r\n    NERTUR      VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    NERDEAD     VARCHAR(150) COLLATE Turkish_CI_AS,\r\n    BRIM        VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    TUTAR       DECIMAL(18,8))\r\n\r\n  DECLARE @HRK_CEKID       FLOAT\r\n  DECLARE @HRK_CARI_TIP    VARCHAR(20)\r\n  DECLARE @HRK_CARI_KOD    VARCHAR(30)\r\n  DECLARE @HRK_CARI_UNVAN  VARCHAR(150)\r\n  DECLARE @HRK_TARIH       DATETIME\r\n  DECLARE @HRK_VADETAR       DATETIME\r\n  DECLARE @HRK_CEKNO        VARCHAR(30)\r\n  DECLARE @HRK_REFNO        VARCHAR(20)\r\n  DECLARE @HRK_CEKBANKAAD   VARCHAR(100)\r\n  DECLARE @HRK_DRMTIP       VARCHAR(20)\r\n  DECLARE @HRK_DURUM        VARCHAR(30)\r\n  DECLARE @HRK_BANKA_KOD    VARCHAR(20)\r\n  DECLARE @HRK_BANKA_AD     VARCHAR(100)\r\n  DECLARE @HRK_NERTUR      VARCHAR(30)\r\n  DECLARE @HRK_NERDEAD     VARCHAR(150)\r\n  DECLARE @HRK_BRIM        VARCHAR(30)\r\n  DECLARE @HRK_TUTAR       FLOAT\r\n\r\n  /*---------------------------------------------------------------------------- */\r\n  if @REFNO=''\r\n   begin\r\n        IF @TARIH_TIP=0 /*ISLEMTARIHI */\r\n        INSERT @EKSTRE_TEMP (FIRMANO,CEKID,CARI_TIP,CARI_KOD,CARI_UNVAN,CEKNO,\r\n        REFNO,ISLEMTARIH,VADETARIH,\r\n        DRMTIP,DURUM,CEKTURU,CEKBANKAAD,\r\n        NERTUR,NERDEAD,TUTAR,BRIM)\r\n          SELECT C.firmano,C.cekid,\r\n          (case when islmhrk='ALN' THEN car.cartp else carver.cartp end),\r\n          (case when islmhrk='ALN' then car.kod else carver.kod end),\r\n          (case when islmhrk='ALN' then car.ad else carver.ad end),\r\n          c.ceksenno,c.refno,c.tarih,c.vadetar,c.drm,c.drmad,c.islmhrkad,c.banka,\r\n          hrkver.tip,hrkver.ad,\r\n          (case when c.giren>0 then c.giren else c.cikan end),\r\n          c.parabrm\r\n         from cekkart as c inner join cekhrk as h on h.id=c.hrkid \r\n         left join Genel_Kart as car on (c.carkod=car.kod and c.cartip=car.cartp)\r\n         left join Genel_Kart as carver on (c.vercarkod=carver.kod and c.vercartip=carver.cartp)\r\n         left join Genel_Kart as hrkver on (h.carkod=hrkver.kod and h.cartip=hrkver.cartp)\r\n         where c.sil=0 and c.tarih >= @TARIH1 and c.tarih <= @TARIH2\r\n\r\n          IF @TARIH_TIP=1    /*--'VADETARIH' */\r\n          INSERT @EKSTRE_TEMP (FIRMANO,CEKID,CARI_TIP,CARI_KOD,CARI_UNVAN,CEKNO,\r\n          REFNO,ISLEMTARIH,VADETARIH,\r\n          DRMTIP,DURUM,CEKTURU,CEKBANKAAD,\r\n          NERTUR,NERDEAD,TUTAR,BRIM)\r\n          SELECT C.firmano,C.cekid,\r\n          (case when carver.cartp<>'' then carver.cartp else car.cartp end),\r\n          (case when carver.kod<>'' then carver.kod else car.kod end),\r\n          (case when carver.ad<>'' then carver.ad else car.ad end),\r\n          c.ceksenno,c.refno,c.tarih,c.vadetar,\r\n          c.drm,c.drmad,c.islmhrkad,c.banka,\r\n          hrkver.tip,hrkver.ad,\r\n          (case when c.giren>0 then c.giren else c.cikan end),\r\n          c.parabrm\r\n         from cekkart as c inner join cekhrk as h on h.id=c.hrkid\r\n         left join Genel_Kart as car on (c.carkod=car.kod and c.cartip=car.cartp)\r\n         left join Genel_Kart as carver on (c.vercarkod=carver.kod and c.vercartip=carver.cartp)\r\n         left join Genel_Kart as hrkver on (h.carkod=hrkver.kod and h.cartip=hrkver.cartp)\r\n         where c.sil=0 and c.vadetar >= @TARIH1 and c.vadetar <= @TARIH2\r\n    end\r\n    \r\n    if @REFNO<>''\r\n     Begin\r\n          INSERT @EKSTRE_TEMP (FIRMANO,CEKID,CARI_TIP,CARI_KOD,CARI_UNVAN,CEKNO,\r\n          REFNO,ISLEMTARIH,VADETARIH,\r\n          DRMTIP,DURUM,CEKTURU,CEKBANKAAD,\r\n          NERTUR,NERDEAD,TUTAR,BRIM)\r\n          SELECT C.firmano,C.cekid,\r\n          (case when carver.cartp<>'' then carver.cartp else car.cartp end),\r\n          (case when carver.kod<>'' then carver.kod else car.kod end),\r\n          (case when carver.ad<>'' then carver.ad else car.ad end),\r\n          c.ceksenno,c.refno,c.tarih,c.vadetar,\r\n          c.drm,c.drmad,c.islmhrkad,c.banka,\r\n          hrkver.tip,hrkver.ad,\r\n          (case when c.giren>0 then c.giren else c.cikan end),\r\n          c.parabrm\r\n         from cekkart as c inner join cekhrk as h on h.id=c.hrkid\r\n         left join Genel_Kart as car on (c.carkod=car.kod and c.cartip=car.cartp)\r\n         left join Genel_Kart as carver on (c.vercarkod=carver.kod and c.vercartip=carver.cartp)\r\n         left join Genel_Kart as hrkver on (h.carkod=hrkver.kod and h.cartip=hrkver.cartp)\r\n         where c.sil=0 and c.refno= @REFNO\r\n     end\r\n     \r\n    if @CEKIDIN<>''\r\n     Begin\r\n          INSERT @EKSTRE_TEMP (FIRMANO,CEKID,CARI_TIP,CARI_KOD,CARI_UNVAN,CEKNO,\r\n          REFNO,ISLEMTARIH,VADETARIH,\r\n          DRMTIP,DURUM,CEKTURU,CEKBANKAAD,\r\n          NERTUR,NERDEAD,TUTAR,BRIM)\r\n          SELECT C.firmano,C.cekid,\r\n          (case when carver.cartp<>'' then carver.cartp else car.cartp end),\r\n          (case when carver.kod<>'' then carver.kod else car.kod end),\r\n          (case when carver.ad<>'' then carver.ad else car.ad end),\r\n          c.ceksenno,c.refno,c.tarih,c.vadetar,\r\n          c.drm,c.drmad,c.islmhrkad,c.banka,\r\n          hrkver.tip,hrkver.ad,\r\n          (case when c.giren>0 then c.giren else c.cikan end),\r\n          c.parabrm\r\n         from cekkart as c inner join cekhrk as h on h.id=c.hrkid\r\n         left join Genel_Kart as car on (c.carkod=car.kod and c.cartip=car.cartp)\r\n         left join Genel_Kart as carver on (c.vercarkod=carver.kod and c.vercartip=carver.cartp)\r\n         left join Genel_Kart as hrkver on (h.carkod=hrkver.kod and h.cartip=hrkver.cartp)\r\n         where c.sil=0 and c.cekid in (select * from CsvToInt(@CEKIDIN))\r\n     end  \r\n  \r\n  if @FIRMANO>0\r\n   delete from @EKSTRE_TEMP where FIRMANO not in (@FIRMANO)  \r\n    \r\n\r\n  /*---------------------------------------------------------------------------- */\r\n  if @TARIH_TIP=0\r\n  INSERT @TB_CARI_EKSTRE\r\n    SELECT * FROM @EKSTRE_TEMP ORDER BY ISLEMTARIH\r\n\r\n  if @TARIH_TIP=1\r\n  INSERT @TB_CARI_EKSTRE\r\n    SELECT * FROM @EKSTRE_TEMP ORDER BY VADETARIH\r\n\r\n  RETURN\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_CEK_DRM_HRK",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_CEK_DRM_HRK",
    "definition": "CREATE FUNCTION [dbo].[UDF_CEK_DRM_HRK] (\r\n@CEKIDIN VARCHAR(8000))\r\nRETURNS\r\n  @TB_CEK_HRK TABLE (\r\n    CEKID       FLOAT,\r\n    CARI_TIP    VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    CARI_KOD    VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    CARI_UNVAN  VARCHAR(150) COLLATE Turkish_CI_AS,\r\n    TARIH\t\tDATETIME,\r\n    DURUM       VARCHAR(30) COLLATE Turkish_CI_AS)\r\n    AS\r\nBEGIN\r\n \r\n\r\n   INSERT @TB_CEK_HRK (CEKID,CARI_TIP,CARI_KOD,CARI_UNVAN,TARIH,DURUM)\r\n    select h.cekid,car.tip,car.KOD,car.ad,H.tarih,h.DRMAD\r\n    from cekhrk as h left join Genel_Kart as car on \r\n    (h.carkod=car.kod and h.cartip=car.cartp)\r\n     where h.cekid in (select * from CsvToInt(@CEKIDIN))\r\n    order by h.cekid \r\n\r\n  RETURN\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_CEKLER_POR_BAKIYE",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_CEKLER_POR_BAKIYE",
    "definition": "CREATE FUNCTION [dbo].UDF_CEKLER_POR_BAKIYE ()\r\nRETURNS\r\n   @TB_CEKLER_BAKIYE TABLE (\r\n    PORTFOY     FLOAT,\r\n    BANKAPOR    FLOAT)\r\nBEGIN\r\nDECLARE @PORTFOY FLOAT\r\nDECLARE @BANKAPOR   FLOAT\r\n\r\ndeclare @firmano int\r\nset @firmano=0\r\n\r\n SELECT @PORTFOY=ISNULL(sum(giren),0) from cekkart where sil=0\r\n and firmano=@firmano and drm='POR'\r\n \r\n SELECT @PORTFOY=ISNULL(sum(giren),0) from cekkart where sil=0\r\n and firmano=@firmano and drm='TAK'\r\n\r\n\r\n  INSERT @TB_CEKLER_BAKIYE (PORTFOY,BANKAPOR)\r\n   VALUES (@PORTFOY,@BANKAPOR)\r\n\r\n  RETURN\r\n\r\n \r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_DEPO_HRK",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_DEPO_HRK",
    "definition": "CREATE FUNCTION [dbo].UDF_DEPO_HRK (\r\n@FIRMANO\t     INT,\r\n@HRK_KRITER       VARCHAR(4000),\r\n@STOK_TIP        VARCHAR(20),\r\n@STOK_DEPKOD     VARCHAR(30),\r\n@ALSATTIP        INT,\r\n@TARIH1 \t\t DATETIME,\r\n@TARIH2 \t\t DATETIME,\r\n@SAAT1 \t\t\t VARCHAR(8),\r\n@SAAT2 \t\t\t VARCHAR(8),\r\n@DEVIR \t\t\t INT)\r\nRETURNS\r\n  @TB_STOK_HRK TABLE (\r\n    id          int,\r\n    FIRMANO     INT,\r\n    STOK_TIP    VARCHAR(20)  COLLATE Turkish_CI_AS,\r\n    STOK_KOD    VARCHAR(30)  COLLATE Turkish_CI_AS,\r\n    STOK_AD     VARCHAR(100)  COLLATE Turkish_CI_AS,\r\n    STOK_BARKOD VARCHAR(50)  COLLATE Turkish_CI_AS,\r\n    DEPO_KOD    VARCHAR(30)   COLLATE Turkish_CI_AS,\r\n    DEPO_AD     VARCHAR(100)   COLLATE Turkish_CI_AS,\r\n    TARIH       DATETIME,\r\n    SAAT        VARCHAR(10)   COLLATE Turkish_CI_AS,\r\n    BELGENO     VARCHAR(50)  COLLATE Turkish_CI_AS,\r\n    ACIKLAMA    VARCHAR(200)  COLLATE Turkish_CI_AS,\r\n    ISLTIPAD    VARCHAR(50)   COLLATE Turkish_CI_AS,\r\n    YERAD       VARCHAR(30)   COLLATE Turkish_CI_AS,\r\n    KULAD       VARCHAR(70)   COLLATE Turkish_CI_AS,\r\n    ISLTIP      VARCHAR(20)    COLLATE Turkish_CI_AS,\r\n    KRS_TIP     VARCHAR(30)  COLLATE Turkish_CI_AS,\r\n    KRS_KOD     VARCHAR(50)  COLLATE Turkish_CI_AS,\r\n    KRS_UNVAN   VARCHAR(150)  COLLATE Turkish_CI_AS,\r\n    ISLID       FLOAT,\r\n    BRMFIYKDVLI FLOAT,\r\n    KDVYUZ      FLOAT,\r\n    VARNO\t    FLOAT,\r\n    GIREN       DECIMAL(18,8),\r\n    CIKAN       DECIMAL(18,8),\r\n    KALAN       DECIMAL(18,8),\r\n    RAP_ID\t\tINT DEFAULT 0,\r\n    FIS_ID      INT,\r\n    FAT_ID      INT,\r\n    IRS_ID      INT,\r\n    MARSAT_ID   INT,\r\n    SAY_ID      INT,\r\n    REMOTE_ID   INT )\r\nAS\r\nBEGIN\r\n\r\n  \r\n  DECLARE @HRK_DEPO_AD     VARCHAR(100)\r\n  DECLARE @HRK_STOK_BARKOD VARCHAR(30)\r\n  DECLARE @KUM_KALAN       DECIMAL(18,8)\r\n  \r\n  DECLARE @ONDA_HANE       INT\r\n  \r\n\r\n  SET @KUM_KALAN = 0\r\n   \r\n\r\n select @HRK_DEPO_AD=d.ad from Depo_Kart_Listesi as d\r\n  where kod=@STOK_DEPKOD \r\n  \r\n  SET @ONDA_HANE=2\r\n\r\n SELECT @ONDA_HANE=isnull(Ondalik_Hane,2) from Stk_Tip\r\n   where kod=@STOK_TIP\r\n\r\n\r\n  /* Devir atanıyor */\r\n  IF @DEVIR=1\r\n   BEGIN\r\n  IF @ALSATTIP=0 /*TUMU */\r\n  INSERT @TB_STOK_HRK (id,FIRMANO,\r\n    STOK_TIP,STOK_KOD,STOK_AD,\r\n    STOK_BARKOD,DEPO_KOD,DEPO_AD,\r\n    TARIH,SAAT,BELGENO,ACIKLAMA,\r\n    ISLTIPAD,YERAD,KULAD,ISLTIP,\r\n    KRS_TIP,KRS_KOD,KRS_UNVAN,\r\n    ISLID,BRMFIYKDVLI,\r\n    KDVYUZ,VARNO,GIREN,CIKAN,KALAN,\r\n    FAT_ID,FIS_ID,IRS_ID,MARSAT_ID,SAY_ID,\r\n    REMOTE_ID)\r\n    SELECT\r\n      0,/*id */\r\n      @FIRMANO,\r\n      '',/*STOK TIP */\r\n      '-', /* STOK_KOD */\r\n      '-', /* STOK_AD */\r\n      '-',\r\n      '-', /* STOK_DEPKOD */\r\n      @HRK_DEPO_AD,/*DEPOAD */\r\n      MAX(tarih),\r\n      @SAAT1,\r\n      'DEVİR', /* BELGE NO */\r\n      CONVERT(VARCHAR(10), MAX(tarih), 104) +' DEVİR BAKİYESİ', /* AÇIKLAMA */\r\n      '-','-','-','-',\r\n      '-','-','-',\r\n      0,0,0,0,\r\n      ISNULL(SUM(round(giren,@ONDA_HANE)),0), /* giren */\r\n      ISNULL(SUM(round(cikan,@ONDA_HANE)),0), /* cikan */\r\n      ISNULL(SUM( round((giren-cikan),@ONDA_HANE) ),0), /* kalan */\r\n      0,0,0,0,0,0      \r\n    FROM stkhrk as h\r\n    WHERE h.depkod=@STOK_DEPKOD and h.sil=0\r\n    AND tarih < @TARIH1\r\n\r\n     IF @ALSATTIP=1 /*GIRISLER */\r\n     INSERT @TB_STOK_HRK (id,FIRMANO,\r\n    STOK_TIP,STOK_KOD,STOK_AD,\r\n    STOK_BARKOD,DEPO_KOD,DEPO_AD,\r\n    TARIH,SAAT,BELGENO,ACIKLAMA,\r\n    ISLTIPAD,YERAD,KULAD,ISLTIP,\r\n    KRS_TIP,KRS_KOD,KRS_UNVAN,\r\n    ISLID,BRMFIYKDVLI,\r\n    KDVYUZ,VARNO,GIREN,CIKAN,KALAN,\r\n    FAT_ID,FIS_ID,IRS_ID,MARSAT_ID,SAY_ID,\r\n    REMOTE_ID)\r\n     SELECT\r\n      0,/*id */\r\n      @FIRMANO,\r\n      '',/*STOK TIP */\r\n      '-', /* STOK_KOD */\r\n      '-', /* STOK_AD */\r\n      '-',\r\n      '-', /* STOK_DEPKOD */\r\n      @HRK_DEPO_AD,/*DEPOAD */\r\n      MAX(tarih),\r\n      @SAAT1,\r\n      'DEVİR', /* BELGE NO */\r\n      CONVERT(VARCHAR(10), MAX(tarih), 104) +' DEVİR BAKİYESİ', /* AÇIKLAMA */\r\n      '-','-','-','-',\r\n      '-','-','-',\r\n      0,0,0,0,\r\n      ISNULL(SUM(round(giren,@ONDA_HANE)),0), /* giren */\r\n      ISNULL(SUM(round(cikan,@ONDA_HANE)),0), /* cikan */\r\n      ISNULL(SUM( round((giren-cikan),@ONDA_HANE) ),0), /* kalan */\r\n      0,0,0,0,0,0\r\n    FROM stkhrk as h\r\n    WHERE h.cikan=0 and h.depkod=@STOK_DEPKOD\r\n    and h.sil=0\r\n    AND tarih < @TARIH1\r\n\r\n    IF @ALSATTIP=2 /*CIKISLAR */\r\n     INSERT @TB_STOK_HRK (id,FIRMANO,\r\n    STOK_TIP,STOK_KOD,STOK_AD,\r\n    STOK_BARKOD,DEPO_KOD,DEPO_AD,\r\n    TARIH,SAAT,BELGENO,ACIKLAMA,\r\n    ISLTIPAD,YERAD,KULAD,ISLTIP,\r\n    KRS_TIP,KRS_KOD,KRS_UNVAN,\r\n    ISLID,BRMFIYKDVLI,\r\n    KDVYUZ,VARNO,GIREN,CIKAN,KALAN,\r\n    FAT_ID,FIS_ID,IRS_ID,MARSAT_ID,SAY_ID,\r\n    REMOTE_ID)\r\n    SELECT\r\n      0,/*id */\r\n      @FIRMANO,\r\n      '',/*STOK TIP */\r\n      '-', /* STOK_KOD */\r\n      '-', /* STOK_AD */\r\n      '-',\r\n      '-', /* STOK_DEPKOD */\r\n      @HRK_DEPO_AD,/*DEPOAD */\r\n      MAX(tarih),\r\n      @SAAT1,\r\n      'DEVİR', /* BELGE NO */\r\n      CONVERT(VARCHAR(10), MAX(tarih), 104) +' DEVİR BAKİYESİ', /* AÇIKLAMA */\r\n      '-','-','-','-',\r\n      '-','-','-',\r\n      0,0,0,0,\r\n       ISNULL(SUM(round(giren,@ONDA_HANE)),0), /* giren */\r\n      ISNULL(SUM(round(cikan,@ONDA_HANE)),0), /* cikan */\r\n      ISNULL(SUM( round((giren-cikan),@ONDA_HANE) ),0), /* kalan */\r\n      0,0,0,0,0,0\r\n    FROM stkhrk as h\r\n    WHERE h.giren=0 and h.depkod=@STOK_DEPKOD\r\n    and h.sil=0\r\n    AND tarih < @TARIH1\r\n    \r\n     SELECT @KUM_KALAN = isnull(KALAN,0) FROM @TB_STOK_HRK\r\n    if (SELECT COUNT(*) FROM @TB_STOK_HRK WHERE (GIREN>0 OR CIKAN>0))=0 \r\n      delete from @TB_STOK_HRK \r\n\r\n   END\r\n   \r\n   \r\n   \r\n  /* Hareketler işleniyor */\r\n  IF @ALSATTIP=0 /*TUMU */\r\n  begin\r\n   INSERT @TB_STOK_HRK (id,FIRMANO,\r\n    STOK_TIP,STOK_KOD,STOK_AD,\r\n    STOK_BARKOD,DEPO_KOD,DEPO_AD,\r\n    TARIH,SAAT,BELGENO,ACIKLAMA,\r\n    ISLTIPAD,YERAD,KULAD,ISLTIP,\r\n    KRS_TIP,KRS_KOD,KRS_UNVAN,\r\n    ISLID,BRMFIYKDVLI,\r\n    KDVYUZ,VARNO,GIREN,CIKAN,KALAN,\r\n    FAT_ID,FIS_ID,IRS_ID,MARSAT_ID,SAY_ID,\r\n    REMOTE_ID)\r\n    SELECT\r\n      h.id,@FIRMANO,\r\n      k.tip,k.kod,k.ad,\r\n      h.barkod,@STOK_DEPKOD,@HRK_DEPO_AD,\r\n       tarih,saat,belno,\r\n      ack, /* AÇIKLAMA, */\r\n      islmtipad,yerad,h.olususer,islmtip,\r\n      Karsi_KartTip,Karsi_KartKod,'',\r\n      stkhrkid,\r\n      brmfiykdvli,kdvyuz,h.varno,\r\n      round(giren,@ONDA_HANE),\r\n      round(cikan,@ONDA_HANE),\r\n      round((giren-cikan),@ONDA_HANE) AS KALAN,\r\n      h.fatid,h.fisid,h.irid,h.marsatid,h.sayid,h.remote_id\r\n    FROM stkhrk as h \r\n    inner join stokkart as k on k.kod=h.stkod\r\n    WHERE h.stktip=k.tip and h.sil=0\r\n    AND depkod=@STOK_DEPKOD\r\n    and h.islmtip not in \r\n      (select * from CsvToSTR(@HRK_KRITER))\r\n     AND tarih >= @TARIH1  AND tarih <= @TARIH2\r\n    ORDER BY tarih,saat\r\n  END\r\n\r\n  IF @ALSATTIP=1 /*GIRISLER */\r\n  begin\r\n  INSERT @TB_STOK_HRK (id,FIRMANO,\r\n    STOK_TIP,STOK_KOD,STOK_AD,\r\n    STOK_BARKOD,DEPO_KOD,DEPO_AD,\r\n    TARIH,SAAT,BELGENO,ACIKLAMA,\r\n    ISLTIPAD,YERAD,KULAD,ISLTIP,\r\n    KRS_TIP,KRS_KOD,KRS_UNVAN,\r\n    ISLID,BRMFIYKDVLI,\r\n    KDVYUZ,VARNO,GIREN,CIKAN,KALAN,\r\n    FAT_ID,FIS_ID,IRS_ID,MARSAT_ID,SAY_ID,\r\n    REMOTE_ID)\r\n    SELECT\r\n      h.id,@FIRMANO,k.tip,k.kod,k.ad,\r\n      h.barkod,@STOK_DEPKOD,@HRK_DEPO_AD,\r\n       tarih,saat,belno,\r\n      ack, /* AÇIKLAMA, */\r\n      islmtipad,yerad,h.olususer,islmtip,\r\n      Karsi_KartTip,Karsi_KartKod,'',\r\n      stkhrkid,\r\n      brmfiykdvli,kdvyuz,h.varno,\r\n      round(giren,@ONDA_HANE),\r\n      round(cikan,@ONDA_HANE),\r\n      round((giren-cikan),@ONDA_HANE) AS KALAN,\r\n      h.fatid,h.fisid,h.irid,h.marsatid,h.sayid,h.remote_id\r\n    FROM stkhrk as h inner join stokkart as k on k.kod=h.stkod\r\n    WHERE h.cikan=0 and h.stktip=k.tip and h.sil=0\r\n    AND depkod=@STOK_DEPKOD\r\n     and h.islmtip not in \r\n      (select * from CsvToSTR(@HRK_KRITER)) \r\n     AND tarih >= @TARIH1  AND tarih <= @TARIH2\r\n    ORDER BY tarih,saat\r\n  END\r\n\r\n  IF @ALSATTIP=2 /*CIKISLAR */\r\n  begin\r\n  INSERT @TB_STOK_HRK (id,FIRMANO,\r\n    STOK_TIP,STOK_KOD,STOK_AD,\r\n    STOK_BARKOD,DEPO_KOD,DEPO_AD,\r\n    TARIH,SAAT,BELGENO,ACIKLAMA,\r\n    ISLTIPAD,YERAD,KULAD,ISLTIP,\r\n    KRS_TIP,KRS_KOD,KRS_UNVAN,\r\n    ISLID,BRMFIYKDVLI,\r\n    KDVYUZ,VARNO,GIREN,CIKAN,KALAN,\r\n    FAT_ID,FIS_ID,IRS_ID,MARSAT_ID,SAY_ID,\r\n    REMOTE_ID)\r\n    SELECT\r\n      h.id,@FIRMANO,k.tip,k.kod,k.ad,\r\n      h.barkod,@STOK_DEPKOD,@HRK_DEPO_AD,\r\n       tarih,saat,belno,\r\n      ack, /* AÇIKLAMA, */\r\n      islmtipad,yerad,h.olususer,islmtip,\r\n      Karsi_KartTip,Karsi_KartKod,'',\r\n      stkhrkid,\r\n      brmfiykdvli,kdvyuz,h.varno,\r\n      round(giren,@ONDA_HANE),\r\n      round(cikan,@ONDA_HANE),\r\n      round((giren-cikan),@ONDA_HANE) AS KALAN,\r\n      h.fatid,h.fisid,h.irid,h.marsatid,h.sayid,h.remote_id\r\n    FROM stkhrk as h inner join stokkart as k on k.kod=h.stkod\r\n    WHERE h.giren=0 and h.stktip=k.tip and h.sil=0\r\n    AND depkod=@STOK_DEPKOD\r\n    and h.islmtip not in \r\n      (select * from CsvToSTR(@HRK_KRITER))\r\n     AND tarih >= @TARIH1  AND tarih <= @TARIH2\r\n    ORDER BY tarih,saat\r\n  END\r\n\r\n\r\n\r\n   update @TB_STOK_HRK set KRS_UNVAN=dt.AD\r\n   FROM @TB_STOK_HRK AS T join\r\n   (select cartp,kod,ad from genel_kart) dt\r\n   on dt.cartp=t.KRS_TIP and dt.kod=t.KRS_KOD\r\n   \r\n   \r\n   update @TB_STOK_HRK set RAP_ID=dt.fatrap_id\r\n   FROM @TB_STOK_HRK AS T join\r\n   (select fatid,fatrap_id from faturamas with (nolock)) dt\r\n   on t.FAT_ID=dt.fatid \r\n\r\n   \r\n    \r\n   update @TB_STOK_HRK set KRS_KOD='-',KRS_UNVAN='-'\r\n   WHERE (KRS_KOD is null)\r\n\r\n  RETURN\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_DEPO_MARKET_GENEL",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_DEPO_MARKET_GENEL",
    "definition": "CREATE FUNCTION [dbo].UDF_DEPO_MARKET_GENEL (\r\n@DEPO_KOD VARCHAR(20),\r\n@GRP1_ID INT,@GRP2_ID INT,\r\n@GRP3_ID INT,\r\n@DEVIR INT)\r\nRETURNS\r\n @TB_DEPO_TARIH_HRK TABLE (\r\n    DEPO_TIP      VARCHAR(20)   COLLATE Turkish_CI_AS,\r\n    DEPO_KOD      VARCHAR(20)   COLLATE Turkish_CI_AS,\r\n    DEPO_AD       VARCHAR(50)   COLLATE Turkish_CI_AS,\r\n    STOK_TIP      VARCHAR(20)   COLLATE Turkish_CI_AS,\r\n    STOK_KOD      VARCHAR(20)   COLLATE Turkish_CI_AS,\r\n    STOK_AD       VARCHAR(100)  COLLATE Turkish_CI_AS,\r\n    STOK_BRM      VARCHAR(20)   COLLATE Turkish_CI_AS,\r\n    STOK_GRP      VARCHAR(50)   COLLATE Turkish_CI_AS,\r\n    ALIS_KDV      FLOAT,\r\n    ALIS_FKDVSIZ  FLOAT,\r\n    ALIS_FKDVLI   FLOAT,\r\n    SATIS_KDV     FLOAT,\r\n    SATIS_FKDVSIZ FLOAT,\r\n    SATIS_FKDVLI  FLOAT,\r\n    GIREN_MIK     FLOAT,\r\n    CIKAN_MIK     FLOAT,\r\n    MEVCUT_MIK    FLOAT,\r\n    MEV_ALSKDVLI  FLOAT,\r\n    MEV_ALSKDVSIZ FLOAT,\r\n    MEV_SATKDVLI  FLOAT,\r\n    MEV_SATKDVSIZ FLOAT)\r\nAS\r\nBEGIN\r\n\r\n  DECLARE @HRK_DEP0_KOD        VARCHAR(20)\r\n  DECLARE @HRK_DEPO_AD         VARCHAR(150)\r\n  DECLARE @HRK_STOK_KOD        VARCHAR(20)\r\n  DECLARE @HRK_STOK_TIP        VARCHAR(20)\r\n  DECLARE @HRK_STOK_AD         VARCHAR(150)\r\n  DECLARE @HRK_STOK_BRM        VARCHAR(20)\r\n  DECLARE @HRK_STOK_GRP        VARCHAR(50)\r\n  DECLARE @HRK_GIREN_MIK       FLOAT\r\n  DECLARE @HRK_CIKAN_MIK       FLOAT\r\n  DECLARE @HRK_MEVCUT_MIK       FLOAT\r\n  DECLARE @HRK_ALIS_KDV        FLOAT\r\n  DECLARE @HRK_ALIS_FKDVSIZ    FLOAT\r\n  DECLARE @HRK_ALIS_FKDVLI     FLOAT\r\n  DECLARE @HRK_SATIS_KDV       FLOAT\r\n  DECLARE @HRK_SATIS_FKDVSIZ   FLOAT\r\n  DECLARE @HRK_SATIS_FKDVLI    FLOAT\r\n  \r\n  DECLARE @TB_STOK_KART TABLE (\r\n  STOK_TIP      VARCHAR(20)   COLLATE Turkish_CI_AS,\r\n  STOK_KOD      VARCHAR(20)   COLLATE Turkish_CI_AS,\r\n  STOK_AD       VARCHAR(100)  COLLATE Turkish_CI_AS,\r\n  STOK_BRM      VARCHAR(20)   COLLATE Turkish_CI_AS,\r\n  STOK_GRP      VARCHAR(50)   COLLATE Turkish_CI_AS,\r\n  ALIS_KDV      FLOAT,\r\n  ALIS_FKDVSIZ  FLOAT,\r\n  ALIS_FKDVLI   FLOAT,\r\n  SATIS_KDV     FLOAT,\r\n  SATIS_FKDVSIZ FLOAT,\r\n  SATIS_FKDVLI  FLOAT)\r\n  \r\n  /*TUM GRUPLAR */\r\n  if (@GRP1_ID=0) AND (@GRP2_ID=0) AND (@GRP3_ID=0)\r\n  insert into @TB_STOK_KART\r\n  (STOK_GRP,STOK_TIP,STOK_KOD,STOK_AD,STOK_BRM,\r\n  ALIS_KDV,ALIS_FKDVSIZ,ALIS_FKDVLI,SATIS_KDV,\r\n  SATIS_FKDVSIZ,SATIS_FKDVLI)\r\n  select k.grup,k.tip,k.kod,k.ad,k.brim,\r\n  k.alskdv,k.alsfiykdvsiz,k.alsfiykdvli,k.sat1kdv,k.satfiykdvsiz,k.satfiykdvli\r\n  from Stok_Kart_Market as k where k.sil=0\r\n\r\n   /*1. GRUP GRUPLAR */\r\n  if (@GRP1_ID>0)\r\n  insert into @TB_STOK_KART\r\n  (STOK_GRP,STOK_TIP,STOK_KOD,STOK_AD,STOK_BRM,\r\n  ALIS_KDV,ALIS_FKDVSIZ,ALIS_FKDVLI,SATIS_KDV,\r\n  SATIS_FKDVSIZ,SATIS_FKDVLI)\r\n  select k.grup,k.tip,k.kod,k.ad,k.brim,\r\n  k.alskdv,k.alsfiykdvsiz,k.alsfiykdvli,k.sat1kdv,k.satfiykdvsiz,k.satfiykdvli\r\n  from Stok_Kart_Market as k where k.sil=0 and k.grp1=@GRP1_ID\r\n\r\n  /*2. GRUP GRUPLAR */\r\n  if (@GRP2_ID>0)\r\n  insert into @TB_STOK_KART\r\n  (STOK_GRP,STOK_TIP,STOK_KOD,STOK_AD,STOK_BRM,\r\n  ALIS_KDV,ALIS_FKDVSIZ,ALIS_FKDVLI,SATIS_KDV,\r\n  SATIS_FKDVSIZ,SATIS_FKDVLI)\r\n  select k.grup,k.tip,k.kod,k.ad,k.brim,\r\n  k.alskdv,k.alsfiykdvsiz,k.alsfiykdvli,k.sat1kdv,k.satfiykdvsiz,k.satfiykdvli\r\n  from Stok_Kart_Market as k where k.sil=0 and k.grp2=@GRP2_ID\r\n  \r\n  \r\n  /*3. GRUP GRUPLAR */\r\n  if (@GRP3_ID>0)\r\n  insert into @TB_STOK_KART\r\n  (STOK_GRP,STOK_TIP,STOK_KOD,STOK_AD,STOK_BRM,\r\n  ALIS_KDV,ALIS_FKDVSIZ,ALIS_FKDVLI,SATIS_KDV,\r\n  SATIS_FKDVSIZ,SATIS_FKDVLI)\r\n  select k.grup,k.tip,k.kod,k.ad,k.brim,\r\n  k.alskdv,k.alsfiykdvsiz,k.alsfiykdvli,k.sat1kdv,k.satfiykdvsiz,k.satfiykdvli\r\n  from Stok_Kart_Market as k where k.sil=0 and k.grp3=@GRP3_ID\r\n  \r\n  \r\n  \r\n\r\n\r\n  IF @DEPO_KOD=''\r\n   begin\r\n   DECLARE DEP_HRK CURSOR FAST_FORWARD FOR\r\n    SELECT h.depkod,d.ad,\r\n    k.STOK_GRP,k.STOK_TIP,\r\n    k.STOK_KOD,k.STOK_AD,k.STOK_BRM,\r\n    k.ALIS_KDV,k.ALIS_FKDVSIZ,k.ALIS_FKDVLI,k.SATIS_KDV,\r\n    k.SATIS_FKDVSIZ,k.SATIS_FKDVLI,\r\n    sum(giren),sum(cikan),sum(giren-cikan) from stkhrk as h\r\n    inner join @TB_STOK_KART as k on\r\n    k.STOK_TIP=h.stktip and k.STOK_KOD=h.stkod\r\n    inner join depokart as d on d.kod=h.depkod and d.sil=0\r\n    where h.sil=0\r\n    group by h.depkod,d.ad,\r\n    k.STOK_GRP,k.STOK_TIP,\r\n    k.STOK_KOD,k.STOK_AD,k.STOK_BRM,\r\n    k.ALIS_KDV,k.ALIS_FKDVSIZ,k.ALIS_FKDVLI,k.SATIS_KDV,\r\n    k.SATIS_FKDVSIZ,k.SATIS_FKDVLI\r\n    order by h.depkod,k.STOK_KOD\r\n   end\r\n\r\n   IF @DEPO_KOD<>''\r\n   begin\r\n   DECLARE DEP_HRK CURSOR FAST_FORWARD FOR\r\n    SELECT h.depkod,d.ad,\r\n    k.STOK_GRP,k.STOK_TIP,\r\n    k.STOK_KOD,k.STOK_AD,k.STOK_BRM,\r\n    k.ALIS_KDV,k.ALIS_FKDVSIZ,k.ALIS_FKDVLI,k.SATIS_KDV,\r\n    k.SATIS_FKDVSIZ,k.SATIS_FKDVLI,\r\n    sum(giren),sum(cikan),sum(giren-cikan) from stkhrk as h\r\n    inner join @TB_STOK_KART as k on\r\n    k.STOK_TIP=h.stktip and k.STOK_KOD=h.stkod\r\n    inner join depokart as d on d.kod=h.depkod and d.sil=0\r\n    where h.sil=0 and h.depkod=@DEPO_KOD\r\n    group by h.depkod,d.ad,\r\n    k.STOK_GRP,k.STOK_TIP,\r\n    k.STOK_KOD,k.STOK_AD,k.STOK_BRM,\r\n    k.ALIS_KDV,k.ALIS_FKDVSIZ,k.ALIS_FKDVLI,k.SATIS_KDV,\r\n    k.SATIS_FKDVSIZ,k.SATIS_FKDVLI\r\n    order by h.depkod,k.STOK_KOD\r\n   end\r\n\r\n   OPEN DEP_HRK\r\n       FETCH NEXT FROM DEP_HRK INTO\r\n        @HRK_DEP0_KOD,@HRK_DEPO_AD,@HRK_STOK_GRP,@HRK_STOK_TIP,\r\n        @HRK_STOK_KOD,@HRK_STOK_AD,@HRK_STOK_BRM,\r\n        @HRK_ALIS_KDV,@HRK_ALIS_FKDVSIZ,@HRK_ALIS_FKDVLI,@HRK_SATIS_KDV,\r\n        @HRK_SATIS_FKDVSIZ,@HRK_SATIS_FKDVLI,\r\n        @HRK_GIREN_MIK,@HRK_CIKAN_MIK,@HRK_MEVCUT_MIK\r\n         WHILE @@FETCH_STATUS = 0\r\n          BEGIN\r\n\r\n          insert into @TB_DEPO_TARIH_HRK\r\n          (DEPO_KOD,DEPO_AD,STOK_GRP,\r\n          STOK_TIP,STOK_KOD,STOK_AD,STOK_BRM,\r\n          ALIS_KDV,ALIS_FKDVSIZ,ALIS_FKDVLI,SATIS_KDV,\r\n          SATIS_FKDVSIZ,SATIS_FKDVLI,\r\n          GIREN_MIK,CIKAN_MIK,MEVCUT_MIK)\r\n          values (@HRK_DEP0_KOD,@HRK_DEPO_AD,@HRK_STOK_GRP,\r\n          @HRK_STOK_TIP,@HRK_STOK_KOD,@HRK_STOK_AD,@HRK_STOK_BRM,\r\n          @HRK_ALIS_KDV,@HRK_ALIS_FKDVSIZ,@HRK_ALIS_FKDVLI,@HRK_SATIS_KDV,\r\n          @HRK_SATIS_FKDVSIZ,@HRK_SATIS_FKDVLI,\r\n          @HRK_GIREN_MIK,@HRK_CIKAN_MIK,@HRK_MEVCUT_MIK)\r\n\r\n         FETCH NEXT FROM DEP_HRK INTO\r\n         @HRK_DEP0_KOD,@HRK_DEPO_AD,@HRK_STOK_GRP,@HRK_STOK_TIP,\r\n         @HRK_STOK_KOD,@HRK_STOK_AD,@HRK_STOK_BRM,\r\n         @HRK_ALIS_KDV,@HRK_ALIS_FKDVSIZ,@HRK_ALIS_FKDVLI,@HRK_SATIS_KDV,\r\n         @HRK_SATIS_FKDVSIZ,@HRK_SATIS_FKDVLI,\r\n         @HRK_GIREN_MIK,@HRK_CIKAN_MIK,@HRK_MEVCUT_MIK\r\n          END\r\n         CLOSE DEP_HRK\r\n         DEALLOCATE DEP_HRK\r\n\r\n\r\n       UPDATE @TB_DEPO_TARIH_HRK SET MEV_ALSKDVLI=MEVCUT_MIK*ALIS_FKDVLI,\r\n       MEV_ALSKDVSIZ=MEVCUT_MIK*ALIS_FKDVSIZ,\r\n       MEV_SATKDVLI=MEVCUT_MIK*SATIS_FKDVSIZ,\r\n       MEV_SATKDVSIZ=MEVCUT_MIK*SATIS_FKDVSIZ\r\n\r\n\r\n\r\n\r\n RETURN\r\n\r\n\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_DOVIZLIKASATOPLAM",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_DOVIZLIKASATOPLAM",
    "definition": "CREATE FUNCTION [dbo].UDF_DOVIZLIKASATOPLAM (\r\n@yertip varchar(20),\r\n@VARNIN varchar(4000))\r\nRETURNS\r\n@TB_KASA_DOVIZLI TABLE (\r\n    KOD        VARCHAR(20)  COLLATE Turkish_CI_AS,\r\n    AD         VARCHAR(20)   COLLATE Turkish_CI_AS,\r\n    KURYTL        FLOAT,\r\n    NAKIT         FLOAT,\r\n    KREDIKART     FLOAT,\r\n    YTLTOPLAM        FLOAT )\r\nAS\r\nBEGIN\r\n\r\nDECLARE @KOD VARCHAR(10)\r\nDECLARE @KUR FLOAT\r\n\r\n/*PARA BIRIMLERI */\r\n\r\n declare @tarih datetime\r\n\r\n if @yertip='marvardimas'\r\n   select @tarih=max(tarih) from markasahrk where \r\n   sil=0 and  varno in (select * from CsvToInt(@VARNIN) )\r\n  /* else */\r\n  /* set @tarih=getdate() */\r\n  \r\n  \r\n  if @yertip='resvardimas'\r\n   select @tarih=max(tarih) from resSatkasahrk where \r\n    sil=0 and  varno in (select * from CsvToInt(@VARNIN) )\r\n \r\n\r\n\r\n\r\n     insert into @TB_KASA_DOVIZLI \r\n        select kod,ad,1,0,0,0 from parabrm order by kod\r\n        \r\n DECLARE gunkurlar CURSOR FAST_FORWARD FOR SELECT KOD FROM @TB_KASA_DOVIZLI\r\n OPEN gunkurlar\r\n FETCH NEXT FROM gunkurlar INTO  @KOD\r\n WHILE @@FETCH_STATUS = 0\r\n BEGIN\r\n set @KUR=1\r\n \r\n IF @KOD='EURO'\r\n SELECT @KUR=dov_satis FROM para_kur WHERE Kod=@KOD and tarih=(SELECT MAX(tarih) FROM para_kur where Tarih<=@tarih)\r\n IF @KOD='USD'\r\n SELECT @KUR=dov_satis FROM para_kur WHERE Kod=@KOD and tarih=(SELECT MAX(tarih) FROM para_kur where Tarih<=@tarih )\r\n IF @KOD='GBP'\r\n SELECT @KUR=dov_satis FROM para_kur WHERE Kod=@KOD and tarih=(SELECT MAX(tarih) FROM para_kur where Tarih<=@tarih)\r\n\r\n\r\n\r\n\r\n UPDATE @TB_KASA_DOVIZLI SET KURYTL=@KUR WHERE KOD=@KOD\r\n \r\n  FETCH NEXT FROM gunkurlar INTO  @KOD\r\n  END\r\n CLOSE gunkurlar\r\n DEALLOCATE gunkurlar\r\n\r\n        \r\n\r\n/*PARA BIRIMLERI */\r\n\r\n  if @yertip='marvardimas'\r\n  update @TB_KASA_DOVIZLI  set \r\n  NAKIT=NAKIT+dt.nakl,\r\n  KREDIKART=KREDIKART+dt.krel,\r\n  YTLTOPLAM=(NAKIT+dt.nakl)*KURYTL from @TB_KASA_DOVIZLI  t\r\n   INNER JOIN (select h.parabrm,\r\n   SUM(h.giren-h.cikan) as nakl,\r\n   0 as krel FROM markasahrk as h\r\n   inner join marsatmas as m  on m.marsatid=h.marsatid \r\n   where m.sil=0 and h.sil=0 and\r\n   m.varno in (select * from CsvToInt(@VARNIN) )\r\n   group by h.parabrm ) \r\n   as dt on dt.parabrm=t.kod\r\n \r\n \r\n \r\n if @yertip='resvardimas'\r\n  update @TB_KASA_DOVIZLI  set \r\n  NAKIT=NAKIT+dt.nakl,\r\n  KREDIKART=KREDIKART+dt.krel,\r\n  YTLTOPLAM=(NAKIT+dt.nakl)*KURYTL from @TB_KASA_DOVIZLI  t\r\n   INNER JOIN (select h.parabirim,\r\n   SUM(h.Tutar) as nakl,\r\n   0 as krel FROM ResSatkasahrk as h\r\n   inner join Ressatmas as m  on m.Id=h.RessatId \r\n   where m.sil=0 and h.sil=0 and\r\n   m.varno in (select * from CsvToInt(@VARNIN) )\r\n   group by h.parabirim ) \r\n   as dt on dt.parabirim=t.kod\r\n \r\n \r\n\r\n RETURN\r\n\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "Udf_EFatura_Hrk",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.Udf_EFatura_Hrk",
    "definition": "CREATE FUNCTION [dbo].[Udf_EFatura_Hrk]\r\n(@Firmano   int,\r\n@fatRapin  varchar(8000),\r\n@Bastar DATETIME,\r\n@Bittar DATETIME)\r\nRETURNS\r\n  @TB_LOGO_FATURA TABLE (\r\n  fat_id                 int,\r\n  FatRap_id\t\t\t\t int,\r\n  fat_tarih              datetime,\r\n  fat_saat               varchar(10),            \r\n  stk_kod\t\t\t\t varchar(30),\r\n  Stk_Ad\t\t\t\t varchar(150),\r\n  stk_muhonkod\t\t\t varchar(30),\r\n  stk_muhkod\t\t\t varchar(30),\r\n  stk_muhkdvkod\t\t\t varchar(30),\r\n  stk_brim\t\t\t\t varchar(5),\r\n  stk_brmfiy\t\t\t float,\r\n  stk_brmfiykdvli    \t float,\r\n  stk_isktolubrmfiykdvsiz float,\r\n  stk_miktar\t\t\t float,\r\n  stk_iskyuz\t\t\t float,\r\n  stk_isktop\t\t\t float,\t\t\t\t\t\r\n  stk_kdvyuz   \t\t\t float,\r\n  stk_kdvtop     \t     float,\r\n  stk_kdvtevkifatYuz     float,\r\n  stk_kdvtevkifatTop     float,\r\n  stk_kdvtevkifatKod     varchar(5),\r\n  stk_kdvtevkifatAck     varchar(150),\r\n  stk_aratop             float,\r\n  stk_isktolutop         float,\r\n  stk_olustarsaat        datetime\r\n  )\r\nAS\r\nBEGIN\r\n\r\n  insert into @TB_LOGO_FATURA\r\n  (fat_id,FatRap_id,fat_tarih,\r\n  fat_saat,stk_kod,Stk_Ad,\r\n  stk_muhonkod,stk_muhkdvkod,stk_brim,\r\n  stk_brmfiy,stk_brmfiykdvli,\r\n  stk_miktar,stk_isktolubrmfiykdvsiz,\r\n  stk_iskyuz,stk_isktop,stk_kdvyuz,stk_kdvtop,\r\n  stk_kdvtevkifatYuz,stk_kdvtevkifatTop,\r\n  stk_kdvtevkifatKod,stk_kdvtevkifatAck,\r\n  stk_aratop,stk_isktolutop,stk_olustarsaat)\r\n\r\n  select m.fatid,m.fatrap_id,\r\n    m.tarih,m.saat,\r\n    h.stkod,sk.ad,sk.muhonkod,\r\n    h.kdvyuz,sk.brim,\r\n    h.brmfiy,(h.brmfiy*(1+h.kdvyuz)),\r\n    (h.mik*carpan),\r\n    (h.brmfiy-h.genisktut),\r\n    h.Top_isk_Yuz,\r\n    (h.Top_isk_Tut),\r\n    (h.kdvyuz*100),\r\n    h.kdvtut*(h.mik*h.carpan) stk_kdvtop,\r\n    h.kdvtevkifatYuzde*100,\r\n    h.kdvtevkifatTutar,\r\n    h.kdvtevkifatKod,\r\n    h.kdvtevkifatAck,\r\n    (h.mik*carpan)*h.brmfiy stk_aratop,\r\n    ((h.mik*carpan)*h.brmfiy)-(h.genisktut*h.mik*carpan) stk_isktolutop,\r\n    \r\n   stk_olustarsaat=m.olustarsaat\r\n  from faturahrklistesi as h \r\n  inner join faturamas as m \r\n  on h.fatid=m.fatid and h.sil=0 and m.sil=0\r\n  left join Genel_Cari_Kart as car on car.cartip=m.cartip \r\n  and car.kod=m.carkod    \r\n  left join gelgidlistok as sk on sk.tip=h.stktip and sk.kod=h.stkod\r\n  Where  m.Firmano=@Firmano \r\n  and isnull(m.EBelgeTipId,0)>0 and m.gctip=2 /* Sadece Satis */\r\n  /*and car.Efatura=1 */\r\n  and m.tarih>=@bastar and m.tarih <=@bittar\r\n  and m.fatRap_id in (select * from CsvToSTR(@fatRapin) )\r\n   order by m.fatid\r\n   \r\n\r\n return\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "Udf_EFatura_Mas",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.Udf_EFatura_Mas",
    "definition": "CREATE FUNCTION [dbo].[Udf_EFatura_Mas]\r\n(@Firmano   int,\r\n@fatRapin  varchar(8000),\r\n@Bastar DATETIME,\r\n@Bittar DATETIME)\r\nRETURNS\r\n  @TB_LOGO_FATURA TABLE (\r\n  fat_id                 int,\r\n  FatRap_id\t\t\t\t int,\r\n  Petro_Evrak_Tip        varchar(30),\r\n  hrk_tipno\t\t\t\t int,\r\n  hrk_tipad\t\t\t\t varchar(50),\r\n  hrk_ack\t\t\t\t varchar(200),\r\n  tarih                  datetime,\r\n  saat                   varchar(10),\r\n  vadetarih              datetime,\r\n  EFaturaTip\t\t\t int,\r\n  EBelgeTipId  \t\t\t int,\r\n  EBelgeEntegrasyonId    int,\r\n  Car_Kod\t\t\t\t varchar(30),\r\n  Car_VergiKNo\t\t\t varchar(30),\r\n  Car_VergiDairesi\t     varchar(150),\r\n  Car_TicSicilNo         varchar(50),\r\n  Car_Ad\t\t\t\t varchar(150),\r\n  Car_Soyad\t\t\t\t varchar(150),\r\n  Car_unvan\t\t\t\t varchar(150),  \r\n  Car_Il                 varchar(50),\r\n  Car_Ilce               varchar(100),\r\n  Car_Adres\t\t\t\t varchar(150),\r\n  Car_Vergiposta         varchar(100),\r\n  Car_Tel                varchar(50),\r\n  Car_Fax                varchar(50),\r\n  Car_Mail               varchar(100),\r\n  Car_WebAdres           varchar(100),\r\n  Car_AdresPostaKod      Varchar(30),\r\n  Belgeno\t\t\t     Varchar(30),\r\n  Irsaliye_No\t\t\t varchar(100),\r\n  Aciklama\t\t\t\t varchar(200),\r\n  fat_gider              float,\r\n  fat_aratop\t\t\t float,\r\n  fat_iskonto\t\t\t float,\r\n  fat_isk_yuz            float,\r\n  fat_iskontotop\t\t float,\r\n  fat_yuvtop\t\t\t float,\t\t\r\n  fat_kdvtop\t\t\t float,\r\n  fat_kdvtevkifattop\t float,\r\n  fat_geneltop\t\t\t float,\r\n  fat_olustarsaat        datetime,\r\n  Efatura                bit,\r\n  EFatura_Tip\t\t\t int,\r\n  Efatura_Id\t\t\t varchar(100),\r\n  EFaturaTipAd\t\t\t\t varchar(30),\r\n  EBelgeTipAd\t\t\t\t varchar(30),\r\n  EBelgeOId\t\t\t        varchar(30),\r\n  EBelgeGibSeriNo           varchar(30),\r\n  EBelgeMailTarihSaat       Datetime,\r\n  IadeFatNo1                 varchar(30),\r\n  IadeFatTarih1              datetime,\r\n  IadeFatNo2                 varchar(30),\r\n  IadeFatTarih2              datetime,\r\n  IadeFatNo3                 varchar(30),\r\n  IadeFatTarih3              datetime,\r\n  IadeFatNo4                 varchar(30),\r\n  IadeFatTarih4              datetime,\r\n  IadeFatNo5                 varchar(30),\r\n  IadeFatTarih5              datetime\r\n  )\r\nAS\r\nBEGIN\r\n\r\n\r\n\r\n\r\n\r\n  insert into @TB_LOGO_FATURA\r\n  (fat_id,FatRap_id,Petro_Evrak_Tip,\r\n  hrk_tipno,hrk_tipad,hrk_ack,\r\n  tarih,saat,vadetarih,\r\n  EfaturaTip,EFaturaTipAd,\r\n  EBelgeTipId,EBelgeTipAd,\r\n  EBelgeEntegrasyonId,\r\n  car_kod,car_VergiKNo,\r\n  Car_VergiDairesi,Car_AdresPostaKod,Car_TicSicilNo,\r\n  Car_Ad,Car_Soyad,car_unvan,\r\n  Car_Il,Car_Ilce,Car_Adres,Car_VergiPosta,\r\n  Car_Tel,Car_Fax,Car_Mail,Car_WebAdres,\r\n  belgeno,Irsaliye_No,Aciklama,\r\n  fat_gider,\r\n  fat_aratop,\r\n  fat_iskonto,\r\n  fat_isk_yuz,\r\n  fat_iskontotop,\r\n  fat_yuvtop,\r\n  fat_kdvtop,\r\n  fat_kdvtevkifattop,\r\n  fat_geneltop,\r\n  fat_olustarsaat,\r\n  Efatura,EFatura_Tip,EFatura_Id,EBelgeOId,\r\n  EBelgeGibSeriNo,EBelgeMailTarihSaat)\r\n\r\n   select m.fatid,m.fatrap_id,\r\n  m.fattip,\r\n  hrk_tipno=case\r\n     when m.gctip=2 and m.fattip not in ('FATIADALS','FATIADSAT','FATTEVSAT') then 2  /* SATIS */\r\n     when m.gctip=1 and m.fattip not in ('FATIADALS','FATIADSAT','FATTEVSAT') then 1  /* ALIS */\r\n     when m.fattip='FATTEVSAT' then  4  /*TEVKIFAT */\r\n     when m.fattip='FATIADALS' then  3  /*IADE */\r\n     when m.fattip='FATIADSAT' then  1 end, \r\n     case\r\n     when m.gctip=2 and m.fattip not in ('FATIADALS','FATIADSAT','FATTEVSAT') then  'SATIS FATURASI'\r\n     when m.gctip=1 and m.fattip not in ('FATIADALS','FATIADSAT','FATTEVSAT') then   'ALIS FATURASI'\r\n     when m.fattip='FATIADALS' then  'ALISDAN IADE FATURASI'\r\n     when m.fattip='FATIADSAT' then  'SATISDAN IADE FATURASI' \r\n     when m.fattip='FATTEVSAT' then  'TEVKIFAT FATURASI'     \r\n     end,\r\n     m.ack,  \r\n    m.tarih,m.saat,m.vadtar,\r\n    car.EFaturaTip,\r\n    case \r\n    When isnull(car.EFaturaTip,0)=0 then 'YOK' \r\n    When isnull(car.EFaturaTip,0)=1 then 'TICARI'\r\n    When isnull(car.EFaturaTip,0)=2 then 'TEMEL' end,\r\n    isnull(m.EBelgeTipId,0),\r\n    case \r\n    When isnull(m.EBelgeTipId,0)=0 then 'YOK' \r\n    When isnull(m.EBelgeTipId,0)=1 then 'E-FATURA'\r\n    When isnull(m.EBelgeTipId,0)=2 then 'E-ARSIV' end, \r\n    case when isnull(m.EFatura_Tip,0)>0 then isnull(m.EFatura_Tip,0)\r\n    else isnull(EBelgeEntegrasyonId,0) end,\r\n  \r\n    m.carkod,case when isnull(car.VergiKNo,0)='' then car.tcno else car.VergiKNo end,\r\n    car.vergidaire,car.AdresPostaKod,car.TicSicilNo,\r\n    Car.Ad,Car.Soyad,\r\n    case when Rtrim(Car.fatunvan)<>'' then Car.fatunvan else \r\n    car.Unvan end ,car.evil,car.evilce,\r\n    car.adres+' '+car.adres2,car.vergiEposta,\r\n    car.tel,car.fax,car.mail,car.webadres,\r\n    fat_serino=m.fatseri+cast(m.fatno as varchar), /* Varchar(30) */\r\n    m.irs_no,m.ack,\r\n    fat_gider=m.gidertop,\r\n    fat_aratop=m.genel_ara_top+m.gidertop,\r\n    fat_iskonto=(m.genel_isk_top),\r\n    fat_yuvtop=isnull(m.yuvtop,0),\r\n    fat_isk_yuz= case when m.fattop=0 then 0 else (m.genel_isk_top*100)/ m.fattop end,\r\n    fat_iskontotop=m.genel_ara_top+m.gidertop-m.genel_isk_top,    \r\n    fat_kdvtop=m.genel_kdv_top,/*kdv genel tutar */\r\n    fat_kdvtevkifattop=m.genel_kdv_tevkifat_top,\r\n    fat_geneltop=m.genel_top,\r\n    fat_olustarsaat=m.olustarsaat,\r\n    isnull(m.Efatura,0),ISNULL(m.EFatura_Tip,0),\r\n    m.EFatura_Id,EFaturaEFinansBelgeOId,\r\n    m.EBelgeGibSeriNo,m.EBelgeMailTarihSaat\r\n    from faturamas as m with (nolock)\r\n    left join Genel_Cari_Kart as car with (nolock) on car.cartip=m.cartip \r\n    and car.kod=m.carkod   \r\n    Where m.sil=0 and m.Firmano=@Firmano \r\n    and isnull(m.EBelgeTipId,0)>0 and m.gctip=2 /* Sadece Satis  */\r\n    /*and car.Efatura=1 */\r\n    and m.tarih>=@bastar and m.tarih <=@bittar\r\n    and m.FatRap_id in (select * from CsvToSTR(@fatRapin) )\r\n    order by m.fatid\r\n  \r\n   \r\n  /*Iade icin BelgeNo ve Tarih */\r\n   update @TB_LOGO_FATURA set \r\n   IadeFatNo1=dt.BelgeNo1,\r\n   IadeFatTarih1=dt.Tarih1,\r\n   IadeFatNo2=dt.BelgeNo2,\r\n   IadeFatTarih2=dt.Tarih2,\r\n   IadeFatNo3=dt.BelgeNo3,\r\n   IadeFatTarih3=dt.Tarih3,\r\n   IadeFatNo4=dt.BelgeNo4,\r\n   IadeFatTarih4=dt.Tarih4,\r\n   IadeFatNo5=dt.BelgeNo5,\r\n   IadeFatTarih5=dt.Tarih5\r\n   \r\n   from @TB_LOGO_FATURA as t join (\r\n   select FatId,\r\n       max(case when seqnum = 1 then BelgeNo end) as BelgeNo1,\r\n       max(case when seqnum = 1 then Tarih end) as Tarih1,\r\n       max(case when seqnum = 2 then BelgeNo end) as BelgeNo2,\r\n       max(case when seqnum = 2 then Tarih end) as Tarih2,\r\n       max(case when seqnum = 3 then BelgeNo end) as BelgeNo3,\r\n       max(case when seqnum = 3 then Tarih end) as Tarih3,\r\n       max(case when seqnum = 4 then BelgeNo end) as BelgeNo4,\r\n       max(case when seqnum = 4 then Tarih end) as Tarih4,\r\n       max(case when seqnum = 5 then BelgeNo end) as BelgeNo5,\r\n       max(case when seqnum = 5 then Tarih end) as Tarih5\r\n    from (select t.*,\r\n             row_number() over (partition by FatId order by FatId) as seqnum\r\n      from FaturaIadeDetay as t where Sil=0\r\n      and FatId in (Select fat_id from @TB_LOGO_FATURA)\r\n     ) t group by FatId ) dt on dt.FatId=t.fat_id\r\n  \r\n     \r\n\r\n return\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "Udf_EIrsaliye_Hrk",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.Udf_EIrsaliye_Hrk",
    "definition": "CREATE FUNCTION [dbo].[Udf_EIrsaliye_Hrk]\r\n(@Firmano   int,\r\n@fatRapin  varchar(8000),\r\n@Bastar DATETIME,\r\n@Bittar DATETIME)\r\nRETURNS\r\n  @TB_LOGO_FATURA TABLE (\r\n  ir_id                 int,\r\n  irRap_id\t\t\t\t int,\r\n  fat_tarih              datetime,\r\n  fat_saat               varchar(10),            \r\n  stk_kod\t\t\t\t varchar(30),\r\n  Stk_Ad\t\t\t\t varchar(150),\r\n  stk_muhonkod\t\t\t varchar(30),\r\n  stk_muhkod\t\t\t varchar(30),\r\n  stk_muhkdvkod\t\t\t varchar(30),\r\n  stk_brim\t\t\t\t varchar(5),\r\n  stk_brmfiy\t\t\t float,\r\n  stk_brmfiykdvli    \t float,\r\n  stk_isktolubrmfiykdvsiz float,\r\n  stk_miktar\t\t\t float,\r\n  stk_iskyuz\t\t\t float,\r\n  stk_isktop\t\t\t float,\t\t\t\t\t\r\n  stk_kdvyuz   \t\t\t float,\r\n  stk_kdvtop     \t     float,\r\n  stk_aratop             float,\r\n  stk_isktolutop         float,\r\n  stk_olustarsaat        datetime\r\n  )\r\nAS\r\nBEGIN\r\n\r\n  insert into @TB_LOGO_FATURA\r\n  (ir_id,irRap_id,fat_tarih,\r\n  fat_saat,stk_kod,Stk_Ad,\r\n  stk_muhonkod,stk_muhkdvkod,stk_brim,\r\n  stk_brmfiy,stk_brmfiykdvli,\r\n  stk_miktar,stk_isktolubrmfiykdvsiz,\r\n  stk_iskyuz,stk_isktop,stk_kdvyuz,stk_kdvtop,\r\n  stk_aratop,stk_isktolutop,stk_olustarsaat)\r\n\r\n  select m.irid,m.irsrap_id,\r\n    m.tarih,m.saat,\r\n    h.stkod,sk.ad,sk.muhonkod,\r\n    h.kdvyuz,sk.brim,\r\n    h.brmfiy,(h.brmfiy*(1+h.kdvyuz)),\r\n    (h.mik*carpan),\r\n    (h.brmfiy-h.genisktut),\r\n    0 Top_isk_Yuz,\r\n    0 Top_isk_Tut,\r\n    (h.kdvyuz*100),\r\n    h.kdvtut*(h.mik*h.carpan),\r\n    (h.mik*carpan)*h.brmfiy,\r\n    ((h.mik*carpan)*h.brmfiy)-(h.genisktut*h.mik*carpan),\r\n    \r\n   stk_olustarsaat=m.olustarsaat\r\n  from irsaliyehrk as h \r\n  inner join irsaliyemas as m \r\n  on h.irid=m.irid and h.sil=0 and m.sil=0\r\n  left join Genel_Cari_Kart as car on car.cartip=m.cartip \r\n  and car.kod=m.carkod    \r\n  left join gelgidlistok as sk on sk.tip=h.stktip and sk.kod=h.stkod\r\n  Where  m.Firmano=@Firmano \r\n  and isnull(m.EBelgeTipId,0)>0 and m.gctip=2 /* Sadece Satis */\r\n  /*and car.Efatura=1 */\r\n  and m.tarih>=@bastar and m.tarih <=@bittar\r\n  and m.irsrap_id in (select * from CsvToSTR(@fatRapin) )\r\n   order by m.fatid\r\n   \r\n\r\n return\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "Udf_EIrsaliye_Mas",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.Udf_EIrsaliye_Mas",
    "definition": "CREATE FUNCTION [dbo].[Udf_EIrsaliye_Mas]\r\n(@Firmano   int,\r\n@fatRapin  varchar(8000),\r\n@Bastar DATETIME,\r\n@Bittar DATETIME)\r\nRETURNS\r\n  @TB_LOGO_FATURA TABLE (\r\n  ir_id                 int,\r\n  irRap_id\t\t\t\t int,\r\n  hrk_tipno\t\t\t\t int,\r\n  hrk_tipad\t\t\t\t varchar(50),\r\n  tarih                  datetime,\r\n  saat                   varchar(10),\r\n  SevkTarih              datetime,\r\n  SevkSaat               varchar(10),\r\n  EFaturaTip\t\t\t int,\r\n  EBelgeTipId  \t\t\t int,\r\n  EBelgeEntegrasyonId    int,\r\n  Car_Kod\t\t\t\t varchar(30),\r\n  Car_VergiKNo\t\t\t varchar(30),\r\n  Car_VergiDairesi\t     varchar(150),\r\n  Car_TicSicilNo         varchar(50),\r\n  Car_Ad\t\t\t\t varchar(150),\r\n  Car_Soyad\t\t\t\t varchar(150),\r\n  Car_unvan\t\t\t\t varchar(150),  \r\n  Car_Il                 varchar(50),\r\n  Car_Ilce               varchar(100),\r\n  Car_Adres\t\t\t\t varchar(150),\r\n  Car_Vergiposta         varchar(100),\r\n  Car_Tel                varchar(50),\r\n  Car_Fax                varchar(50),\r\n  Car_Mail               varchar(100),\r\n  Car_WebAdres           varchar(100),\r\n  Car_AdresPostaKod      Varchar(30),\r\n  Belgeno\t\t\t     Varchar(30),\r\n  Aciklama\t\t\t\t varchar(200),\r\n  TasiyiciId             int,\r\n  TasiyiciUnvan          varchar(200),\r\n  TasiyiciAd\t\t\t varchar(100),\r\n  TasiyiciSoyAd\t\t\t varchar(100),\r\n  TasiyiciVergiKNo       varchar(20),\r\n  TasiyiciIl             varchar(50),\r\n  TasiyiciIlce           varchar(100),\r\n  TasiyiciAdres \t\t varchar(150),\r\n  TasiyiciAdresPostaKod\t varchar(50),\r\n  \r\n  TeslimYerId             int,\r\n  TeslimYerIl             varchar(50),\r\n  TeslimYerIlce           varchar(100),\r\n  TeslimYerAdres \t\t varchar(150),\r\n  TeslimYerAdresPostaKod\t varchar(50),\r\n  \r\n  \r\n  Plaka                  Varchar(50),\r\n  SoforId                int,\r\n  SoforAd                 Varchar(50),\r\n  SoforSoyAd             Varchar(50),\r\n  SoforTCKN              Varchar(20),\r\n  fat_aratop\t\t\t float,\r\n  fat_iskonto\t\t\t float,\r\n  fat_isk_yuz            float,\r\n  fat_iskontotop\t\t float,\t\t\t\t\t\r\n  fat_kdvtop\t\t\t float,\r\n  fat_geneltop\t\t\t float,\r\n  fat_olustarsaat        datetime,\r\n  EBelgeEntegrasyon      bit,\r\n  EFatura_Tip\t\t\t int,\r\n  Efatura_Id\t\t\t varchar(100),\r\n  EFaturaTipAd\t\t\t\t varchar(30),\r\n  EBelgeTipAd\t\t\t\t varchar(30),\r\n  EBelgeGibSeriNo           varchar(30),\r\n  EBelgeMailTarihSaat       Datetime\r\n  \r\n  )\r\nAS\r\nBEGIN\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n  insert into @TB_LOGO_FATURA\r\n  (ir_id,irRap_id,\r\n  hrk_tipno,hrk_tipad,\r\n  tarih,saat,SevkTarih,SevkSaat,\r\n  EfaturaTip,EFaturaTipAd,\r\n  EBelgeTipId,EBelgeTipAd,\r\n  EBelgeEntegrasyonId,\r\n  car_kod,car_VergiKNo,\r\n  Car_VergiDairesi,Car_AdresPostaKod,Car_TicSicilNo,\r\n  Car_Ad,Car_Soyad,car_unvan,\r\n  Car_Il,Car_Ilce,Car_Adres,Car_VergiPosta,\r\n  Car_Tel,Car_Fax,Car_Mail,Car_WebAdres,\r\n  belgeno,Aciklama,\r\n  Plaka,TasiyiciId,SoforId,\r\n  TeslimYerId,TeslimYerIl,\r\n  TeslimYerIlce,TeslimYerAdres,\r\n  TeslimYerAdresPostaKod,\r\n  fat_aratop,\r\n  fat_iskonto,\r\n  fat_isk_yuz,\r\n  fat_iskontotop,\r\n  fat_kdvtop,\r\n  fat_geneltop,\r\n  fat_olustarsaat,\r\n  EBelgeEntegrasyon,EFatura_Tip,EFatura_Id,\r\n  EBelgeGibSeriNo,EBelgeMailTarihSaat)\r\n\r\n   select m.irid,m.irsrap_id,\r\n   m.gctip,\r\n   case\r\n    when m.gctip=2  then  'SATIS IRSALIYESI'\r\n    when m.gctip=1  then   'ALIS IRSALIYESI' end,\r\n    m.tarih,m.saat,m.sevktar,isnull(SevkSaat,'00:00:00'),\r\n    car.EFaturaTip,\r\n    case \r\n    When isnull(car.EFaturaTip,0)=0 then 'YOK' \r\n    When isnull(car.EFaturaTip,0)=1 then 'TICARI'\r\n    When isnull(car.EFaturaTip,0)=2 then 'TEMEL' end,\r\n    isnull(m.EBelgeTipId,0),\r\n    case \r\n    When isnull(m.EBelgeTipId,0)=0 then 'YOK' \r\n    When isnull(m.EBelgeTipId,0)=3 then 'E-IRSALIYE' end,\r\n    isnull(m.EBelgeEntegrasyonId,0),\r\n  \r\n    m.carkod,case when isnull(car.VergiKNo,0)='' then car.tcno else car.VergiKNo end,\r\n    car.vergidaire,car.AdresPostaKod,car.TicSicilNo,\r\n    Car.Ad,Car.Soyad,\r\n    case when Rtrim(Car.fatunvan)<>'' then Car.fatunvan else \r\n    car.Unvan end ,car.evil,car.evilce,\r\n    car.adres+' '+car.adres2,car.vergiEposta,\r\n    car.tel,car.fax,car.mail,car.webadres,\r\n    fat_serino=m.irseri+cast(m.irno as varchar), /* Varchar(30) */\r\n    m.ack,\r\n    m.Plaka,m.EBelgeTasiyiciFirmaId,m.EBelgeSoforId,\r\n    isnull(m.EBelgeTeslimYerId,0),car.evil,car.evilce,\r\n    car.adres+' '+car.adres2,car.AdresPostaKod,   \r\n    fat_aratop=m.genel_top-m.genel_kdv_top,\r\n    fat_iskonto=0,\r\n    fat_isk_yuz= 0,\r\n    fat_iskontotop=0,    \r\n    fat_kdvtop=m.genel_kdv_top,/*kdv genel tutar */\r\n    fat_geneltop=m.genel_top,\r\n    fat_olustarsaat=m.olustarsaat,\r\n    isnull(m.EBelgeEntegrasyon,0),\r\n    ISNULL(m.EBelgeTipId,0),\r\n    m.EBelgeId,\r\n    m.EBelgeGibSeriNo,m.EBelgeMailTarihSaat\r\n    from irsaliyemas as m with (nolock)\r\n    left join Genel_Cari_Kart as car with (nolock) on car.cartip=m.cartip \r\n    and car.kod=m.carkod   \r\n    Where m.sil=0 and m.Firmano=@Firmano \r\n    and isnull(m.EBelgeTipId,0)>0 and m.gctip=2 /* Sadece Satis  */\r\n    /*and car.Efatura=1 */\r\n    and m.tarih>=@bastar and m.tarih <=@bittar\r\n    and m.irsrap_id in (select * from CsvToSTR(@fatRapin) )\r\n    order by m.fatid\r\n    \r\n    \r\n    \r\n   update @TB_LOGO_FATURA set \r\n   TasiyiciUnvan=dt.Unvan,\r\n   TasiyiciAd=dt.Ad,TasiyiciSoyAd=dt.SoyAd,\r\n   TasiyiciVergiKNo=dt.VergiKimlikNo,\r\n   TasiyiciIl=dt.AdresIl,TasiyiciIlce=dt.AdresIlce,\r\n   TasiyiciAdres=dt.Adres,TasiyiciAdresPostaKod=dt.AdresPostaKod from @TB_LOGO_FATURA as t \r\n   join (Select id,Unvan,Ad,SoyAd,VergiKimlikNo,Adres,AdresIl,AdresIlce,AdresPostaKod\r\n    From TasiyiciFirmaKart \r\n   as k with (nolock) Where Sil=0  ) dt on\r\n   dt.id=t.TasiyiciId\r\n   \r\n   \r\n   update @TB_LOGO_FATURA set \r\n   TeslimYerIl=dt.AdresIl,TeslimYerIlce=dt.AdresIlce,\r\n   TeslimYerAdres=dt.Adres,TeslimYerAdresPostaKod=dt.AdresPostaKod from @TB_LOGO_FATURA as t \r\n   join (Select id,Adres,AdresIl,AdresIlce,AdresPostaKod\r\n    From TeslimYerKart \r\n   as k with (nolock) Where Sil=0  ) dt on\r\n   dt.id=t.TeslimYerId\r\n  \r\n  \r\n   update @TB_LOGO_FATURA set \r\n   SoforAd=dt.Ad,SoforSoyAd=dt.SoyAd,\r\n   SoforTCKN=dt.TcNo from @TB_LOGO_FATURA as t \r\n   join (Select id,Ad,SoyAd,TcNo From SoforKart \r\n   as k with (nolock) Where Sil=0  ) dt on\r\n   dt.id=t.SoforId\r\n  \r\n   \r\n\r\n return\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_FATURA_ADET_TUTAR",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_FATURA_ADET_TUTAR",
    "definition": "CREATE FUNCTION [dbo].[UDF_FATURA_ADET_TUTAR]\r\n(@Firmano\t\tint,\r\n@FATIN          VARCHAR(4000),\r\n@CARTIPIN        VARCHAR(300),\r\n@CARIN           VARCHAR(8000),\r\n@TARTIP          INT,\r\n@BASTAR          DATETIME,\r\n@BITTAR          DATETIME,\r\n@FAT_ADET\t\t INT,\r\n@FAT_TUTAR\t\t FLOAT)\r\nRETURNS\r\n  @TB_FATURA_RAP TABLE (\r\n  FirmaNo\t\t\t\t   int,\r\n  CARI_TIP                 VARCHAR(30) COLLATE Turkish_CI_AS,\r\n  CARI_KOD                 VARCHAR(30) COLLATE Turkish_CI_AS,\r\n  CARI_UNVAN               VARCHAR(150) COLLATE Turkish_CI_AS,\r\n  CARI_VERGINO\t\t\t   VARCHAR(30) COLLATE Turkish_CI_AS,\r\n  CARI_VERGIDAIRE\t\t   VARCHAR(100) COLLATE Turkish_CI_AS,\r\n  CARI_TCNO\t\t\t\t   VARCHAR(30) COLLATE Turkish_CI_AS,\r\n  FAT_ADET                 INT,\r\n  KDVSIZ_TOPLAM            FLOAT,\r\n  KDV_TOPLAM               FLOAT,\r\n  ISKONTO_TOPLAM           FLOAT,\r\n  ISKONTOLU_TOPLAM         FLOAT,\r\n  YUV_TOPLAM               FLOAT,\r\n  GENEL_TOPLAM             FLOAT\r\n  )\r\nAS\r\nBEGIN\r\n\r\n    if @TARTIP=0 and @Firmano=0   /*işlem tarihine göre */\r\n    insert into @TB_FATURA_RAP\r\n    (FirmaNo,CARI_TIP,CARI_KOD,CARI_UNVAN,\r\n    CARI_VERGINO,CARI_VERGIDAIRE,CARI_TCNO,FAT_ADET,\r\n    KDVSIZ_TOPLAM,KDV_TOPLAM,ISKONTO_TOPLAM,\r\n    ISKONTOLU_TOPLAM,YUV_TOPLAM,GENEL_TOPLAM)\r\n    select max(m.firmano),car.tip,car.kod,car.ad,\r\n    car.vergino,car.vergidaire,car.tcno,\r\n    count(m.id),\r\n    sum(m.fattop),sum(m.genel_kdv_top),sum(m.genel_isk_top),\r\n    sum(m.genel_net_top),sum(m.yuvtop),sum(genel_top) from faturamas as m with (nolock)\r\n    inner join Genel_Kart as car with (nolock) on m.carkod=car.kod and m.cartip=car.cartp\r\n    where m.sil=0 and m.fatrap_id in (select * from CsvToSTR(@FATIN) )\r\n    and m.tarih>=@BASTAR and m.tarih<=@BITTAR\r\n    and m.cartip in (select * from CsvToSTR(@CARTIPIN))\r\n    group by car.tip,car.kod,car.ad,car.vergino,car.vergidaire,car.tcno\r\n    having count(m.id)>@FAT_ADET and sum(m.genel_net_top)>@FAT_TUTAR\r\n  \r\n    \r\n    if @TARTIP=0 and @Firmano>0   /*işlem tarihine göre */\r\n    insert into @TB_FATURA_RAP\r\n    (FirmaNo,CARI_TIP,CARI_KOD,CARI_UNVAN,\r\n    CARI_VERGINO,CARI_VERGIDAIRE,CARI_TCNO,FAT_ADET,\r\n    KDVSIZ_TOPLAM,KDV_TOPLAM,ISKONTO_TOPLAM,\r\n    ISKONTOLU_TOPLAM,YUV_TOPLAM,GENEL_TOPLAM)\r\n    select max(m.firmano),car.tip,car.kod,car.ad,\r\n    car.vergino,car.vergidaire,car.tcno,\r\n    count(m.id),\r\n    sum(m.fattop),sum(m.genel_kdv_top),sum(m.genel_isk_top),\r\n    sum(m.genel_net_top),sum(m.yuvtop),sum(genel_top) from faturamas as m with (nolock)\r\n    inner join Genel_Kart as car with (nolock) on m.carkod=car.kod and m.cartip=car.cartp\r\n    where m.firmano in (@Firmano,0)\r\n    and m.sil=0 \r\n    and m.fatrap_id in (select * from CsvToSTR(@FATIN) )\r\n    and m.tarih>=@BASTAR and m.tarih<=@BITTAR\r\n    and m.cartip in (select * from CsvToSTR(@CARTIPIN))\r\n    group by car.tip,car.kod,car.ad,car.vergino,car.vergidaire,car.tcno\r\n    having count(m.id)>@FAT_ADET and sum(m.genel_net_top)>@FAT_TUTAR\r\n    \r\n   \r\n    \r\n    \r\n    \r\n    \r\n    if @TARTIP=1 and @firmano=0 /*vade tarihine göre */\r\n    insert into @TB_FATURA_RAP\r\n    (FirmaNo,CARI_TIP,CARI_KOD,CARI_UNVAN,\r\n    CARI_VERGINO,CARI_VERGIDAIRE,CARI_TCNO,FAT_ADET,\r\n    KDVSIZ_TOPLAM,KDV_TOPLAM,ISKONTO_TOPLAM,\r\n    ISKONTOLU_TOPLAM,YUV_TOPLAM,GENEL_TOPLAM)\r\n    select max(m.firmano),car.tip,car.kod,car.ad,\r\n    car.vergino,car.vergidaire,car.tcno,count(m.id),\r\n    sum(m.fattop),sum(m.genel_kdv_top),sum(m.genel_isk_top),\r\n    sum(m.genel_net_top),sum(m.yuvtop),sum(genel_top) from faturamas as m with (nolock)\r\n    inner join Genel_Kart as car with (nolock) on m.carkod=car.kod and m.cartip=car.cartp\r\n    where m.sil=0 and m.fatrap_id in (select * from CsvToSTR(@FATIN) )\r\n    and m.vadtar>=@BASTAR and m.vadtar<=@BITTAR\r\n    and m.cartip in (select * from CsvToSTR(@CARTIPIN))\r\n    group by car.tip,car.kod,car.ad,car.vergino,car.vergidaire,car.tcno\r\n    having count(m.id)>@FAT_ADET and sum(m.genel_net_top)>@FAT_TUTAR\r\n  \r\n    \r\n    if @TARTIP=1 and @firmano>0 /*vade tarihine göre */\r\n    insert into @TB_FATURA_RAP\r\n    (FirmaNo,CARI_TIP,CARI_KOD,CARI_UNVAN,\r\n    CARI_VERGINO,CARI_VERGIDAIRE,CARI_TCNO,FAT_ADET,\r\n    KDVSIZ_TOPLAM,KDV_TOPLAM,ISKONTO_TOPLAM,\r\n    ISKONTOLU_TOPLAM,YUV_TOPLAM,GENEL_TOPLAM)\r\n    select max(m.firmano),car.tip,car.kod,car.ad,\r\n    car.vergino,car.vergidaire,car.tcno,count(m.id),\r\n    sum(m.fattop),sum(m.genel_kdv_top),sum(m.genel_isk_top),\r\n    sum(m.genel_net_top),sum(m.yuvtop),sum(genel_top) from faturamas as m with (nolock)\r\n    inner join Genel_Kart as car with (nolock) on m.carkod=car.kod and m.cartip=car.cartp\r\n    where m.firmano in (@Firmano,0)\r\n    and m.sil=0 \r\n    and m.fatrap_id in (select * from CsvToSTR(@FATIN) )\r\n    and m.vadtar>=@BASTAR and m.vadtar<=@BITTAR\r\n    and m.cartip in (select * from CsvToSTR(@CARTIPIN))\r\n    group by car.tip,car.kod,car.ad,car.vergino,car.vergidaire,car.tcno\r\n    having count(m.id)>@FAT_ADET and sum(m.genel_net_top)>@FAT_TUTAR\r\n    \r\n    \r\n    \r\n       \r\n    if (select count(*) from CsvToSTR(@FATIN) \r\n     where STRValue='0' )>0\r\n      begin\r\n      \r\n      if @firmano=0 \r\n      insert into @TB_FATURA_RAP\r\n      (FirmaNo,CARI_TIP,CARI_KOD,CARI_UNVAN,\r\n      CARI_VERGINO,CARI_VERGIDAIRE,CARI_TCNO,FAT_ADET,\r\n      KDVSIZ_TOPLAM,KDV_TOPLAM,ISKONTO_TOPLAM,\r\n      ISKONTOLU_TOPLAM,YUV_TOPLAM,GENEL_TOPLAM)\r\n       select max(m.firmano),CAR.tip,car.kod,car.ad,\r\n       car.vergino,car.vergidaire,car.tcno,\r\n       count(m.id),sum(m.genel_top-m.genel_kdv_top),\r\n       sum(m.genel_kdv_top),0,\r\n       sum(m.genel_top-m.genel_kdv_top),0,\r\n       sum(m.genel_top)\r\n        from zrapormas as m with (nolock)\r\n        inner join Genel_Kart as car with (nolock) on m.carkod=car.kod and\r\n        m.cartip=car.cartp\r\n        inner join yazarkasakart as yk with (nolock) on yk.kod=m.ykkod\r\n        where m.sil=0  and m.tarih>=@BASTAR and m.tarih<=@BITTAR\r\n        and m.cartip in (select * from CsvToSTR(@CARTIPIN))\r\n        group by car.tip,car.kod,car.ad,car.vergino,car.vergidaire,car.tcno\r\n        having count(m.id)>@FAT_ADET and \r\n        sum(m.genel_top-m.genel_kdv_top)>@FAT_TUTAR \r\n        \r\n        \r\n        \r\n        \r\n       if @firmano>0 \r\n       insert into @TB_FATURA_RAP\r\n       (FirmaNo,CARI_TIP,CARI_KOD,CARI_UNVAN,\r\n       CARI_VERGINO,CARI_VERGIDAIRE,CARI_TCNO,FAT_ADET,\r\n       KDVSIZ_TOPLAM,KDV_TOPLAM,ISKONTO_TOPLAM,\r\n       ISKONTOLU_TOPLAM,YUV_TOPLAM,GENEL_TOPLAM)\r\n       select max(m.firmano),CAR.tip,car.kod,car.ad,\r\n       car.vergino,car.vergidaire,car.tcno,\r\n       count(m.id),sum(m.genel_top-m.genel_kdv_top),\r\n       sum(m.genel_kdv_top),0,\r\n       sum(m.genel_top-m.genel_kdv_top),0,\r\n       sum(m.genel_top)\r\n        from zrapormas as m with (nolock)\r\n        inner join Genel_Kart as car  with (nolock) on m.carkod=car.kod and\r\n        m.cartip=car.cartp\r\n        inner join yazarkasakart as yk with (nolock) on yk.kod=m.ykkod\r\n        where m.firmano in (@Firmano,0)\r\n        and m.sil=0  and m.tarih>=@BASTAR and m.tarih<=@BITTAR\r\n        and m.cartip in (select * from CsvToSTR(@CARTIPIN))\r\n        group by car.tip,car.kod,car.ad,car.vergino,car.vergidaire,car.tcno\r\n        having count(m.id)>@FAT_ADET and \r\n        sum(m.genel_top-m.genel_kdv_top)>@FAT_TUTAR \r\n        \r\n        \r\n   \r\n     end\r\n    \r\n    \r\n    \r\n    \r\n  \r\n    \r\n    \r\n     if @CARIN<>'' \r\n      delete from  @TB_FATURA_RAP\r\n      where CARI_KOD not in (select * from CsvToSTR(@CARIN)) \r\n\r\n    \r\n   RETURN\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_FATURA_PERIYOT_STOK_RAP",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_FATURA_PERIYOT_STOK_RAP",
    "definition": "CREATE FUNCTION [dbo].[UDF_FATURA_PERIYOT_STOK_RAP]\r\n(@FirmaNo\t\tint,\r\n@PERIYOTTIP     INT,\r\n@STKTIPIN        VARCHAR(100),\r\n@FATTIPIN        VARCHAR(500),\r\n@CARTIPIN        VARCHAR(300),\r\n@CARIN           VARCHAR(8000),\r\n@TARTIP          INT,\r\n@BASTAR          DATETIME,\r\n@BITTAR          DATETIME,\r\n@ORT_BRM\t\t INT)\r\nRETURNS\r\n  @TB_FATURA_RAP TABLE (\r\n  FirmaNo\t\t\t\t  int,\r\n  FAT_ID                  INT,\r\n  YIL\t\t\t\t\t  INT,\r\n  AY\t\t\t\t\t  INT,\r\n  GUN\t\t\t\t\t  INT,\r\n  HAFTA\t\t\t\t\t  INT,\r\n  PERIYOT_AD\t\t\t  VARCHAR(30) COLLATE Turkish_CI_AS,\r\n  PERIYOT_TIP\t\t\t  VARCHAR(30) COLLATE Turkish_CI_AS,\r\n  ISLEMTARIHI             DATETIME,\r\n  VADETARIHI              DATETIME,\r\n  STOK_TIP                INT,\r\n  STOK_KOD                VARCHAR(30) COLLATE Turkish_CI_AS,\r\n  STOK_AD                 VARCHAR(150) COLLATE Turkish_CI_AS,\r\n  STOK_BIRIM              VARCHAR(30) COLLATE Turkish_CI_AS,\r\n  KDV                     FLOAT,\r\n  MIKTAR                  FLOAT,\r\n  BRIMFIYAT               FLOAT,\r\n  TUTAR                   FLOAT,\r\n  KDVLIBRIMFIYAT          FLOAT,\r\n  KDVTUTAR\t\t\t\t  FLOAT,\t\r\n  KDVLITUTAR              FLOAT)\r\nAS\r\nBEGIN\r\n\r\n\r\n  DECLARE  @TB_FATURA_RAP_HRK TABLE (\r\n  FirmaNo\t\t\t\t  int,\r\n  FAT_ID                  INT,\r\n  ZRAPID\t\t\t\t  INT,\r\n  YIL\t\t\t\t\t  INT,\r\n  AY\t\t\t\t\t  INT,\r\n  GUN\t\t\t\t\t  INT,\r\n  HAFTA\t\t\t\t\t  INT,\r\n  PERIYOT_NO\t\t\t  VARCHAR(30) COLLATE Turkish_CI_AS,\r\n  CARI_KOD                VARCHAR(30) COLLATE Turkish_CI_AS,\r\n  CARI_UNVAN              VARCHAR(150) COLLATE Turkish_CI_AS,\r\n  FAT_SERINO              VARCHAR(30) COLLATE Turkish_CI_AS,\r\n  FAT_AD                  VARCHAR(50) COLLATE Turkish_CI_AS,\r\n  ISLEMTARIHI             DATETIME,\r\n  VADETARIHI              DATETIME,\r\n  KDVTOPLAM               FLOAT,\r\n  ISKTOPLAM               FLOAT,\r\n  STOK_TIP                INT,\r\n  STOK_KOD                VARCHAR(30) COLLATE Turkish_CI_AS,\r\n  STOK_AD                 VARCHAR(150) COLLATE Turkish_CI_AS,\r\n  STOK_BIRIM              VARCHAR(30) COLLATE Turkish_CI_AS,\r\n  KDV                     FLOAT,\r\n  MIKTAR                  FLOAT,\r\n  BRIMFIYAT               FLOAT,\r\n  TUTAR                   FLOAT,\r\n  KDVTUTAR\t\t\t\t  FLOAT,\r\n  KDVLITUTAR              FLOAT)\r\n\r\n\r\n\r\n\r\n\r\n    \r\n      \r\n      \r\n      \r\n      \r\n      \r\n     if (@TARTIP=0)   /*işlem tarihine göre */\r\n     insert into @TB_FATURA_RAP_HRK\r\n     (FirmaNo,FAT_ID,ZRAPID,YIL,AY,GUN,HAFTA,\r\n      CARI_KOD,CARI_UNVAN,FAT_SERINO,FAT_AD,ISLEMTARIHI,VADETARIHI,\r\n      STOK_TIP,STOK_KOD,STOK_AD,STOK_BIRIM,\r\n      KDV,MIKTAR,\r\n      BRIMFIYAT,TUTAR,KDVLITUTAR)\r\n      select m.firmano,m.fatid,0,\r\n      year(m.tarih),month(m.tarih),DAY(m.tarih),\r\n      datepart(wk,m.tarih),\r\n      car.kod,car.ad,(fatseri+fatno) FATSERINO,m.fatad,m.tarih,m.vadtar,\r\n      case when st.tip='akykt' then 1 \r\n      when st.tip='markt' then 2\r\n      else 3 end,\r\n      st.kod,st.ad,h.brim,h.kdvyuz*100,(mik),\r\n      ( (h.brmfiy+h.otvbrim)-(h.satisktut+h.genisktut)),\r\n      ( ((h.brmfiy+h.otvbrim)-(h.satisktut+h.genisktut)) *mik),\r\n      ( ((h.brmfiy+h.otvbrim)-(h.satisktut+h.genisktut)) *mik) *(1+KDVYUZ)\r\n      from faturamas as m  inner join faturahrk as h  on h.fatid=m.fatid and m.sil=0 and h.sil=0\r\n      inner join Genel_Kart as car on m.carkod=car.kod and m.cartip=car.cartp\r\n      inner join gelgidlistok as st on h.stkod=st.kod and st.tip=h.stktip\r\n      where m.fatrap_id in (select * from CsvToSTR(@FATTIPIN) )\r\n      and m.tarih>=@BASTAR and m.tarih<=@BITTAR\r\n      and m.cartip in (select * from CsvToSTR(@CARTIPIN))\r\n      order by st.kod\r\n      \r\n      \r\n       \r\n      \r\n      \r\n     if (@TARTIP=1)   /*vade tarihine göre */\r\n     insert into @TB_FATURA_RAP_HRK\r\n     (FirmaNo,FAT_ID,ZRAPID,YIL,AY,GUN,HAFTA,\r\n      CARI_KOD,CARI_UNVAN,FAT_SERINO,FAT_AD,ISLEMTARIHI,VADETARIHI,\r\n      STOK_TIP,STOK_KOD,STOK_AD,STOK_BIRIM,\r\n      KDV,MIKTAR,BRIMFIYAT,TUTAR,KDVLITUTAR)\r\n      select m.firmano,m.fatid,0,year(m.tarih),month(m.tarih),DAY(m.tarih),\r\n      datepart(wk,m.tarih),car.kod,car.ad,(fatseri+fatno) FATSERINO,m.fatad,m.tarih,m.vadtar,\r\n      case when st.tip='akykt' then 1 \r\n      when st.tip='markt' then 2\r\n      else 3 end,\r\n      st.kod,st.ad,h.brim,h.kdvyuz*100,(mik),\r\n      ( (h.brmfiy+h.otvbrim)-(h.satisktut+h.genisktut)),\r\n      ( ((h.brmfiy+h.otvbrim)-(h.satisktut+h.genisktut)) *mik),\r\n      ( ((h.brmfiy+h.otvbrim)-(h.satisktut+h.genisktut)) *mik) *(1+KDVYUZ)\r\n      from faturamas as m  inner join  faturahrk as h  on h.fatid=m.fatid and m.sil=0 and h.sil=0\r\n      inner join Genel_Kart as car on m.carkod=car.kod and m.cartip=car.cartp\r\n      inner join gelgidlistok as st on h.stkod=st.kod and st.tip=h.stktip\r\n      where m.fatrap_id in (select * from CsvToSTR(@FATTIPIN) )\r\n      and m.vadtar>=@BASTAR and m.vadtar<=@BITTAR\r\n      and m.cartip in (select * from CsvToSTR(@CARTIPIN))\r\n      order by st.kod\r\n      \r\n      \r\n      \r\n    if (select count(*) from CsvToSTR(@FATTIPIN) \r\n     where STRValue='0' )>0\r\n      begin\r\n     insert into @TB_FATURA_RAP_HRK\r\n     (FirmaNo,FAT_ID,ZRAPID,YIL,AY,GUN,HAFTA,\r\n      CARI_KOD,CARI_UNVAN,FAT_SERINO,FAT_AD,ISLEMTARIHI,VADETARIHI,\r\n      STOK_TIP,STOK_KOD,STOK_AD,STOK_BIRIM,\r\n      KDV,MIKTAR,\r\n      BRIMFIYAT,TUTAR,KDVLITUTAR)\r\n      select m.firmano,m.zrapid,m.zrapid,\r\n       year(m.tarih),month(m.tarih),DAY(m.tarih),\r\n       datepart(wk,m.tarih),car.kod,car.ad,\r\n       yk.ad+' / '+(zseri+zserino),\r\n       'Z RAPOR',m.tarih,m.tarih,\r\n       case when h.tip='akykt' then 1 \r\n       when h.tip='markt' then 2\r\n       else 3 end,h.kod,'','',\r\n       h.kdvyuz*100,h.miktar,\r\n       h.brmfiy/(1+h.kdvyuz),\r\n       (h.miktar*h.brmfiy)/(1+h.kdvyuz),\r\n       (h.miktar*h.brmfiy)\r\n        from zrapormas as m\r\n       inner join zraporhrk as h \r\n       on m.zrapid=h.zrapid and h.sil=0\r\n     inner join Genel_Kart as car on m.carkod=car.kod and\r\n      m.cartip=car.cartp\r\n     inner join yazarkasakart as yk on yk.kod=m.ykkod\r\n     where m.sil=0  and m.tarih>=@BASTAR and m.tarih<=@BITTAR\r\n     and m.cartip in (select * from CsvToSTR(@CARTIPIN))\r\n     order by m.tarih \r\n     \r\n     \r\n     if @Firmano>0\r\n      delete from @TB_FATURA_RAP_HRK where firmano not in (@Firmano,0)\r\n     \r\n     \r\n     \r\n     \r\n     update  @TB_FATURA_RAP_HRK\r\n     SET STOK_AD=DT.AD FROM @TB_FATURA_RAP_HRK as t\r\n     join (select tip_id,kod,ad from stokkart )dt\r\n     on dt.kod=t.STOK_KOD and t.STOK_TIP=dt.tip_id\r\n     and t.ZRAPID>0\r\n     \r\n     \r\n     update  @TB_FATURA_RAP_HRK\r\n     SET STOK_AD=DT.AD FROM @TB_FATURA_RAP_HRK as t\r\n     join (select id,ad from grup )dt\r\n     on dt.id=t.STOK_KOD and t.STOK_TIP=2\r\n     and t.ZRAPID>0\r\n     \r\n     \r\n     \r\n     \r\n     \r\n     \r\n     \r\n     end\r\n      \r\n      \r\n      \r\n      \r\n      \r\n\r\n     if @CARIN<>'' \r\n      delete from  @TB_FATURA_RAP_HRK\r\n      where CARI_KOD not in (select * from CsvToSTR(@CARIN)) \r\n      \r\n    \r\n     IF (@PERIYOTTIP=0) and (@ORT_BRM=0)\r\n     insert into @TB_FATURA_RAP\r\n     (PERIYOT_AD,PERIYOT_TIP,\r\n      ISLEMTARIHI,\r\n      STOK_TIP,STOK_KOD,STOK_AD,STOK_BIRIM,KDV,\r\n      MIKTAR,BRIMFIYAT,TUTAR,KDVTUTAR,KDVLIBRIMFIYAT,KDVLITUTAR)\r\n      SELECT convert(varchar,ISLEMTARIHI,104),'GÜNLÜK',\r\n      ISLEMTARIHI,\r\n      STOK_TIP,STOK_KOD,STOK_AD,STOK_BIRIM,KDV,\r\n      SUM(MIKTAR),\r\n      BRIMFIYAT,\r\n      SUM(TUTAR),\r\n      SUM(KDVLITUTAR)-SUM(TUTAR),\r\n      SUM(KDVLITUTAR)/SUM(MIKTAR),\r\n      SUM(KDVLITUTAR) FROM @TB_FATURA_RAP_HRK\r\n      where STOK_TIP IN (SELECT * FROM CsvToInt(@STKTIPIN))\r\n      GROUP BY ISLEMTARIHI,\r\n      STOK_TIP,STOK_KOD,STOK_AD,BRIMFIYAT,\r\n      STOK_BIRIM,KDV \r\n    \r\n      \r\n      \r\n     IF (@PERIYOTTIP=0) and (@ORT_BRM=1)\r\n     insert into @TB_FATURA_RAP\r\n     (PERIYOT_AD,PERIYOT_TIP,\r\n      ISLEMTARIHI,\r\n      STOK_TIP,STOK_KOD,STOK_AD,STOK_BIRIM,KDV,\r\n      MIKTAR,BRIMFIYAT,TUTAR,KDVTUTAR,KDVLIBRIMFIYAT,KDVLITUTAR)\r\n      SELECT convert(varchar,ISLEMTARIHI,104),'GÜNLÜK',\r\n      ISLEMTARIHI,\r\n      STOK_TIP,STOK_KOD,STOK_AD,STOK_BIRIM,KDV,\r\n      SUM(MIKTAR),\r\n      SUM(TUTAR)/SUM(MIKTAR),\r\n      SUM(TUTAR),\r\n      SUM(KDVLITUTAR)-SUM(TUTAR),\r\n      SUM(KDVLITUTAR)/SUM(MIKTAR),\r\n      SUM(KDVLITUTAR) FROM @TB_FATURA_RAP_HRK\r\n      where STOK_TIP IN (SELECT * FROM CsvToInt(@STKTIPIN))\r\n      GROUP BY ISLEMTARIHI,\r\n      STOK_TIP,STOK_KOD,STOK_AD,STOK_BIRIM,KDV   \r\n      \r\n      \r\n     IF (@PERIYOTTIP=1) and (@ORT_BRM=0)\r\n     insert into @TB_FATURA_RAP\r\n     (PERIYOT_AD,PERIYOT_TIP,\r\n      ISLEMTARIHI,\r\n      STOK_TIP,STOK_KOD,STOK_AD,STOK_BIRIM,KDV,\r\n      MIKTAR,BRIMFIYAT,TUTAR,\r\n      KDVTUTAR,KDVLIBRIMFIYAT,KDVLITUTAR)\r\n      SELECT \r\n      cast(YIL AS VARCHAR)+'-'+\r\n      CAST(case when hafta=53 then 1 else hafta-1 end as varchar)\r\n      ,'HAFTALIK',NULL,\r\n      STOK_TIP,STOK_KOD,STOK_AD,STOK_BIRIM,KDV,\r\n      SUM(MIKTAR),\r\n      BRIMFIYAT,\r\n      SUM(TUTAR),\r\n      SUM(KDVLITUTAR)-SUM(TUTAR),\r\n      SUM(KDVLITUTAR)/SUM(MIKTAR),\r\n      SUM(KDVLITUTAR) FROM @TB_FATURA_RAP_HRK\r\n      where STOK_TIP IN (SELECT * FROM CsvToInt(@STKTIPIN))\r\n      GROUP BY YIL,HAFTA,\r\n      STOK_TIP,STOK_KOD,STOK_AD,BRIMFIYAT,STOK_BIRIM,KDV \r\n \r\n   \r\n      \r\n      \r\n     IF (@PERIYOTTIP=1) and (@ORT_BRM=1)\r\n     insert into @TB_FATURA_RAP\r\n     (PERIYOT_AD,PERIYOT_TIP,\r\n      ISLEMTARIHI,\r\n      STOK_TIP,STOK_KOD,STOK_AD,STOK_BIRIM,KDV,\r\n      MIKTAR,BRIMFIYAT,TUTAR,\r\n      KDVTUTAR,KDVLIBRIMFIYAT,KDVLITUTAR)\r\n      SELECT \r\n      cast(YIL AS VARCHAR)+'-'+\r\n      CAST(case when hafta=53 then 1 else hafta-1 end as varchar)\r\n      ,'HAFTALIK',NULL,\r\n      STOK_TIP,STOK_KOD,STOK_AD,STOK_BIRIM,KDV,\r\n      SUM(MIKTAR),\r\n      SUM(TUTAR)/SUM(MIKTAR),\r\n      SUM(TUTAR),\r\n      SUM(KDVLITUTAR)-SUM(TUTAR),\r\n      SUM(KDVLITUTAR)/SUM(MIKTAR),\r\n      SUM(KDVLITUTAR) FROM @TB_FATURA_RAP_HRK\r\n      where STOK_TIP IN (SELECT * FROM CsvToInt(@STKTIPIN))\r\n      GROUP BY YIL,HAFTA,\r\n      STOK_TIP,STOK_KOD,STOK_AD,STOK_BIRIM,KDV \r\n      \r\n      \r\n      \r\n      IF (@PERIYOTTIP=2) and (@ORT_BRM=0)\r\n     insert into @TB_FATURA_RAP\r\n     (PERIYOT_AD,PERIYOT_TIP,\r\n      ISLEMTARIHI,\r\n      STOK_TIP,STOK_KOD,STOK_AD,STOK_BIRIM,KDV,\r\n      MIKTAR,BRIMFIYAT,TUTAR,\r\n      KDVTUTAR,KDVLIBRIMFIYAT,KDVLITUTAR)\r\n      SELECT \r\n      cast(YIL AS VARCHAR)+'-'+\r\n      CAST(ay as varchar),'AYLIK',NULL,\r\n      STOK_TIP,STOK_KOD,STOK_AD,STOK_BIRIM,KDV,\r\n      SUM(MIKTAR),\r\n      BRIMFIYAT,\r\n      SUM(TUTAR),\r\n      SUM(KDVLITUTAR)-SUM(TUTAR),\r\n      SUM(KDVLITUTAR)/SUM(MIKTAR),\r\n      SUM(KDVLITUTAR) FROM @TB_FATURA_RAP_HRK\r\n      where STOK_TIP IN (SELECT * FROM CsvToInt(@STKTIPIN))\r\n      GROUP BY YIL,AY,\r\n      STOK_TIP,STOK_KOD,STOK_AD,BRIMFIYAT,STOK_BIRIM,KDV  \r\n      \r\n      \r\n      \r\n      \r\n      \r\n       \r\n     IF (@PERIYOTTIP=2) and (@ORT_BRM=1)\r\n     insert into @TB_FATURA_RAP\r\n     (PERIYOT_AD,PERIYOT_TIP,\r\n      ISLEMTARIHI,\r\n      STOK_TIP,STOK_KOD,STOK_AD,STOK_BIRIM,KDV,\r\n      MIKTAR,BRIMFIYAT,TUTAR,\r\n      KDVTUTAR,KDVLIBRIMFIYAT,KDVLITUTAR)\r\n      SELECT \r\n      cast(YIL AS VARCHAR)+'-'+\r\n      CAST(ay as varchar),'AYLIK',NULL,\r\n      STOK_TIP,STOK_KOD,STOK_AD,STOK_BIRIM,KDV,\r\n      SUM(MIKTAR),\r\n      SUM(TUTAR)/SUM(MIKTAR),\r\n      SUM(TUTAR),\r\n      SUM(KDVLITUTAR)-SUM(TUTAR),\r\n      SUM(KDVLITUTAR)/SUM(MIKTAR),\r\n      SUM(KDVLITUTAR) FROM @TB_FATURA_RAP_HRK\r\n      where STOK_TIP IN (SELECT * FROM CsvToInt(@STKTIPIN))\r\n      GROUP BY YIL,AY,\r\n      STOK_TIP,STOK_KOD,STOK_AD,STOK_BIRIM,KDV  \r\n      \r\n      \r\n     IF @PERIYOTTIP=3\r\n      begin\r\n      \r\n      update @TB_FATURA_RAP_HRK\r\n      set PERIYOT_NO=\r\n      CASE \r\n      WHEN (GUN>=1 AND GUN<=7) THEN '1..7'\r\n      WHEN (GUN>=8 AND GUN<=14) THEN '8..14'\r\n      WHEN (GUN>=15 AND GUN<=21) THEN '15..21'\r\n      WHEN (GUN>=22 AND GUN<=28) THEN '22..28'\r\n      WHEN (GUN>=29 ) THEN '29..SON GÜN' END\r\n      \r\n      \r\n      \r\n      if (@ORT_BRM=0)\r\n      insert into @TB_FATURA_RAP\r\n      (PERIYOT_AD,PERIYOT_TIP,\r\n      ISLEMTARIHI,\r\n      STOK_TIP,STOK_KOD,STOK_AD,STOK_BIRIM,KDV,\r\n      MIKTAR,BRIMFIYAT,TUTAR,\r\n      KDVTUTAR,KDVLIBRIMFIYAT,KDVLITUTAR)\r\n      SELECT \r\n      cast(YIL AS VARCHAR)+'-'+CAST(ay as varchar)+\r\n      '-'+PERIYOT_NO,'SEÇİMLİ',NULL,\r\n      STOK_TIP,STOK_KOD,STOK_AD,STOK_BIRIM,KDV,\r\n      SUM(MIKTAR),\r\n      BRIMFIYAT,\r\n      SUM(TUTAR),\r\n      SUM(KDVLITUTAR)-SUM(TUTAR),\r\n      SUM(KDVLITUTAR)/SUM(MIKTAR),\r\n      SUM(KDVLITUTAR) FROM @TB_FATURA_RAP_HRK\r\n      where STOK_TIP IN (SELECT * FROM CsvToInt(@STKTIPIN))\r\n      GROUP BY YIL,AY,PERIYOT_NO,\r\n      STOK_TIP,STOK_KOD,STOK_AD,BRIMFIYAT,STOK_BIRIM,KDV \r\n      \r\n      \r\n      \r\n      \r\n      if (@ORT_BRM=1)\r\n      insert into @TB_FATURA_RAP\r\n      (PERIYOT_AD,PERIYOT_TIP,\r\n      ISLEMTARIHI,\r\n      STOK_TIP,STOK_KOD,STOK_AD,STOK_BIRIM,KDV,\r\n      MIKTAR,BRIMFIYAT,TUTAR,\r\n      KDVTUTAR,KDVLIBRIMFIYAT,KDVLITUTAR)\r\n      SELECT \r\n      cast(YIL AS VARCHAR)+'-'+CAST(ay as varchar)+\r\n      '-'+PERIYOT_NO,'SEÇİMLİ',NULL,\r\n      STOK_TIP,STOK_KOD,STOK_AD,STOK_BIRIM,KDV,\r\n      SUM(MIKTAR),\r\n      SUM(TUTAR)/SUM(MIKTAR),\r\n      SUM(TUTAR),\r\n      SUM(KDVLITUTAR)-SUM(TUTAR),\r\n      SUM(KDVLITUTAR)/SUM(MIKTAR),\r\n      SUM(KDVLITUTAR) FROM @TB_FATURA_RAP_HRK\r\n      where STOK_TIP IN (SELECT * FROM CsvToInt(@STKTIPIN))\r\n      GROUP BY YIL,AY,PERIYOT_NO,\r\n      STOK_TIP,STOK_KOD,STOK_AD,STOK_BIRIM,KDV   \r\n      \r\n      \r\n            \r\n         \r\n      \r\n      \r\n      end\r\n      \r\n      \r\n\r\n\r\n\r\n   RETURN\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_FATURA_RAP",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_FATURA_RAP",
    "definition": "CREATE FUNCTION UDF_FATURA_RAP\r\n(@Firmano\t\tint,\r\n@FATIN          VARCHAR(4000),\r\n@CARTIPIN        VARCHAR(300),\r\n@CARIN           VARCHAR(8000),\r\n@TARTIP          INT,\r\n@BASTAR          DATETIME,\r\n@BITTAR          DATETIME)\r\nRETURNS\r\n  @TB_FATURA_RAP TABLE (\r\n  FirmaNo\t\t\t\t  int,\r\n  FirmaUNVAN              VARCHAR(150) COLLATE Turkish_CI_AS,\r\n  FAT_ID                  VARCHAR(30) COLLATE Turkish_CI_AS,\r\n  FATRAP_ID\t\t\t\t  INT,\r\n  CARI_KOD                VARCHAR(30) COLLATE Turkish_CI_AS,\r\n  CARI_UNVAN              VARCHAR(150) COLLATE Turkish_CI_AS,\r\n  FAT_SERINO              VARCHAR(30) COLLATE Turkish_CI_AS,\r\n  FAT_AD                  VARCHAR(50) COLLATE Turkish_CI_AS,\r\n  ISLEMTARIHI             DATETIME,\r\n  VADETARIHI              DATETIME,\r\n  GIDERTOPLAM             FLOAT,\r\n  ARATOPLAM               FLOAT,\r\n  KDVTOPLAM               FLOAT,\r\n  ISKTOPLAM               FLOAT,\r\n  ISKYUZDE\t\t\t\t  FLOAT,\t\r\n  TOPLAMTUTAR             FLOAT,\r\n  ODEMETOPLAM             FLOAT,\r\n  SIL                     BIT,\r\n  TY                      TINYINT,\r\n  BG                      BIGINT,\r\n  DC                      DECIMAL(12,5))\r\nAS\r\nBEGIN\r\n\r\n   if @TARTIP=-1\r\n    begin\r\n    insert into @TB_FATURA_RAP\r\n    (FirmaNo,FAT_ID,FATRAP_ID,CARI_KOD,CARI_UNVAN,FAT_SERINO,FAT_AD,ISLEMTARIHI,VADETARIHI,\r\n     GIDERTOPLAM,ARATOPLAM,KDVTOPLAM,ISKYUZDE,ISKTOPLAM,TOPLAMTUTAR,ODEMETOPLAM)\r\n     select 0,0,0,'','','','',null,NULL,0,0,0,0,0,0,0\r\n      Return\r\n    end \r\n    \r\n\r\n    if @TARTIP=0 /*işlem tarihine göre */\r\n    insert into @TB_FATURA_RAP\r\n    (firmano,FAT_ID,FATRAP_ID,CARI_KOD,CARI_UNVAN,FAT_SERINO,FAT_AD,ISLEMTARIHI,VADETARIHI,\r\n    GIDERTOPLAM,ARATOPLAM,KDVTOPLAM,ISKYUZDE,ISKTOPLAM,TOPLAMTUTAR,ODEMETOPLAM)\r\n    select m.firmano,'F'+CAST(M.fatid AS varchar),m.fatrap_id,\r\n    car.kod,car.ad,(fatseri+fatno),m.fatad,m.tarih,m.vadtar,\r\n    m.gidertop,((m.fattop)-(m.satisktop+m.genisktop)),m.kdvtop,\r\n    case when (m.fattop)>0 then \r\n    ((m.genel_isk_top)*100)/(m.fattop) else 0 end,\r\n    (m.genel_isk_top),\r\n    (((m.fattop)-(m.genel_isk_top))+(m.kdvtop+m.giderkdvtop+m.gidertop+m.yuvtop)),\r\n    m.odemetop from faturamas as m WITH (NOLOCK)\r\n    inner join Genel_Kart as car on m.carkod=car.kod and m.cartip=car.cartp\r\n    where m.sil=0 and m.fatrap_id in (select * from CsvToSTR(@FATIN) )\r\n    and m.tarih>=@BASTAR and m.tarih<=@BITTAR\r\n    and m.cartip in (select * from CsvToSTR(@CARTIPIN))\r\n    order by m.tarih\r\n    \r\n    \r\n    if @TARTIP=1 /*vade tarihine göre */\r\n    insert into @TB_FATURA_RAP\r\n    (FirmaNo,FAT_ID,FATRAP_ID,CARI_KOD,CARI_UNVAN,FAT_SERINO,FAT_AD,ISLEMTARIHI,VADETARIHI,\r\n    GIDERTOPLAM,ARATOPLAM,KDVTOPLAM,ISKYUZDE,ISKTOPLAM,TOPLAMTUTAR,ODEMETOPLAM)\r\n    select m.firmano,'F'+CAST(M.fatid AS varchar),m.fatrap_id,\r\n    car.kod,car.ad,(fatseri+fatno),m.fatad,m.tarih,m.vadtar,\r\n    m.gidertop,((m.fattop)-(m.satisktop+m.genisktop)),m.kdvtop,\r\n    case when (m.fattop)>0 then \r\n    ((m.genel_isk_top)*100)/(m.fattop) else 0 end,\r\n    (m.genel_isk_top),\r\n    (((m.fattop)-(m.genel_isk_top))+(m.kdvtop+m.giderkdvtop+m.gidertop+m.yuvtop)),\r\n    m.odemetop from faturamas as m WITH (NOLOCK)\r\n    inner join Genel_Kart as car on m.carkod=car.kod and m.cartip=car.cartp\r\n    where m.sil=0 and m.fatrap_id in (select * from CsvToSTR(@FATIN) )\r\n    and m.vadtar>=@BASTAR and m.vadtar<=@BITTAR\r\n    and m.cartip in (select * from CsvToSTR(@CARTIPIN))\r\n    order by m.vadtar\r\n    \r\n\r\n    if (select count(*) from CsvToSTR(@FATIN) \r\n    where STRValue='0' )>0\r\n     insert into @TB_FATURA_RAP\r\n     (FirmaNo,FAT_ID,CARI_KOD,CARI_UNVAN,FAT_SERINO,FAT_AD,ISLEMTARIHI,VADETARIHI,\r\n     GIDERTOPLAM,ARATOPLAM,KDVTOPLAM,ISKYUZDE,ISKTOPLAM,TOPLAMTUTAR,ODEMETOPLAM)\r\n     select m.firmano,'Z'+CAST(m.zrapid AS varchar),car.kod,car.ad,\r\n     yk.ad+' / '+\r\n     (zseri+zserino),\r\n     'Z RAPOR',m.tarih,m.tarih,\r\n     0,m.genel_ara_top,m.genel_kdv_top,/*m.kdvtop, */\r\n     0,0,(m.genel_top),\r\n     0 from zrapormas as m WITH (NOLOCK)\r\n     inner join Genel_Kart as car on m.carkod=car.kod and m.cartip=car.cartp\r\n     inner join yazarkasakart as yk on yk.kod=m.ykkod\r\n     where m.sil=0  and m.tarih>=@BASTAR and m.tarih<=@BITTAR\r\n     and m.cartip in (select * from CsvToSTR(@CARTIPIN))\r\n     order by m.tarih \r\n    \r\n     if @Firmano>0\r\n      delete from @TB_FATURA_RAP where firmano not in (@Firmano,0) \r\n    \r\n    \r\n     if @CARIN<>'' \r\n      delete from  @TB_FATURA_RAP\r\n      where CARI_KOD not in (select * from CsvToSTR(@CARIN)) \r\n      \r\n  \r\n      \r\n     update @TB_FATURA_RAP set FirmaUNVAN=dt.ad from @TB_FATURA_RAP as t \r\n     join (select id,ad from firma ) dt on dt.id=t.Firmano  \r\n      \r\n      \r\n      \r\n\r\n    \r\n   RETURN\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_FATURA_STOK_GRP_HRK",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_FATURA_STOK_GRP_HRK",
    "definition": "CREATE FUNCTION [dbo].UDF_FATURA_STOK_GRP_HRK \r\n(@firmano    int,\r\n@Tartip          INT,\r\n@bastar      datetime,\r\n@bittar      datetime)\r\nRETURNS\r\n  @TB_FATURA_RAP TABLE (\r\n  id\t\t\t\t\t  bigint  IDENTITY(1, 1) NOT NULL,\r\n  firmano\t\t\t\t  int,\r\n  sil\t\t\t\t\t  int,\r\n  fatid\t                  bigint,\r\n  fattur_id\t\t\t\t  int,\r\n  fatrap_id\t\t\t\t  int,\r\n  hrkid\t\t\t\t\t  bigint,\r\n  cartip                  VARCHAR(30) COLLATE Turkish_CI_AS,\r\n  carkod                  VARCHAR(30) COLLATE Turkish_CI_AS,\r\n  carunvan                VARCHAR(150) COLLATE Turkish_CI_AS,\r\n  Per_id\t\t\t\t  int,\t\r\n  fatserino               VARCHAR(30) COLLATE Turkish_CI_AS,\r\n  Fatad                   VARCHAR(50) COLLATE Turkish_CI_AS,\r\n  ACK\t\t\t\t\t  VARCHAR(200) COLLATE Turkish_CI_AS,\r\n  tarih\t\t\t          DATETIME,\r\n  saat                    VARCHAR(10) COLLATE Turkish_CI_AS,\r\n  vadetarih\t              DATETIME,\r\n  grp1\t\t\t\t\t  int,\r\n  grp_ad\t\t\t\t  VARCHAR(100) COLLATE Turkish_CI_AS,\r\n  miktar   \t\t          FLOAT,\r\n  brm_fiyat               FLOAT,\r\n  KDV                     FLOAT,\r\n  TUTAR_KDVSIZ            FLOAT,\r\n  ISKYUZDE\t\t\t\t  FLOAT,\t\r\n  TUTAR_ISK\t\t\t\t  FLOAT,\r\n  TUTAR_KDV     \t      FLOAT,\r\n  TUTAR_ISKKDVSIZ\t\t  FLOAT,\r\n  TUTAR_KDVLI             FLOAT)\r\nAS\r\nBEGIN\r\n  \r\n\r\n  declare @TB_FATURA_HRK TABLE (\r\n  id\t\t\t\t\t  bigint IDENTITY(1, 1) NOT NULL,\r\n  firmano\t\t\t\t  int,\r\n  sil\t\t\t\t\t  int,\r\n  fatid\t                  bigint,\r\n  fattur_id\t\t\t\t  int,\r\n  fatrap_id\t\t\t\t  int,\r\n  hrkid\t\t\t\t\t  bigint,\r\n  cartip                  VARCHAR(30) COLLATE Turkish_CI_AS,\r\n  carkod                 VARCHAR(30) COLLATE Turkish_CI_AS,\r\n  carunvan               VARCHAR(150) COLLATE Turkish_CI_AS,\r\n  fatserino               VARCHAR(30) COLLATE Turkish_CI_AS,\r\n  Per_id\t\t\t\t  int,\t\r\n  Fatad                   VARCHAR(50) COLLATE Turkish_CI_AS,\r\n  ACK\t\t\t\t\t  VARCHAR(200) COLLATE Turkish_CI_AS,\r\n  tarih\t\t\t          DATETIME,\r\n  saat                    VARCHAR(10) COLLATE Turkish_CI_AS,\r\n  vadetarih\t              DATETIME,\r\n  stktip\t\t\t\t  VARCHAR(30) COLLATE Turkish_CI_AS,\r\n  stk_kod\t\t\t\t  VARCHAR(30) COLLATE Turkish_CI_AS,\r\n  stk_ad\t\t\t\t  VARCHAR(100) COLLATE Turkish_CI_AS,\r\n  grp1\t\t\t\t\t  int,\r\n  grp_ad\t\t\t\t  VARCHAR(100) COLLATE Turkish_CI_AS,\r\n  miktar   \t\t          FLOAT,\r\n  brm_fiyat               FLOAT,\r\n  KDV                     FLOAT,\r\n  TUTAR_KDVSIZ            FLOAT,\r\n  ISKYUZDE\t\t\t\t  FLOAT,\t\r\n  TUTAR_ISK\t\t\t\t  FLOAT,\r\n  TUTAR_KDV     \t      FLOAT,\r\n  TUTAR_ISKKDVSIZ\t\t  FLOAT,\r\n  TUTAR_KDVLI             FLOAT,\r\n  YUVARLAMA\t\t\t\t  FLOAT)\r\n\r\n\r\n  \r\n  if @Tartip=1\r\n   insert into @TB_FATURA_HRK\r\n    (fatid,fatrap_id,fattur_id,hrkid,firmano,sil,\r\n    cartip,carkod,carunvan,\r\n     fatserino,Fatad,ACK,\r\n     tarih,saat,vadetarih,\r\n     stktip,stk_kod,stk_ad,miktar,brm_fiyat,KDV,TUTAR_KDVSIZ,ISKYUZDE,\r\n     TUTAR_ISK,TUTAR_KDV,TUTAR_ISKKDVSIZ,TUTAR_KDVLI,\r\n     YUVARLAMA)\r\n     select M.fatid,m.fatrap_id,m.fattur_id,h.id,m.firmano,m.sil,\r\n     m.cartip,m.carkod,'',(fatseri+fatno),m.fatad,m.ack,\r\n     m.tarih,m.saat,m.vadtar,\r\n     h.stktip,h.stkod,'',h.mik,h.brmfiy,h.kdvyuz*100,\r\n     h.brmfiy*( case when h.carpan=0 then 1*h.mik else h.mik*h.carpan end),\r\n     h.satiskyuz,(h.genisktut+h.satisktut)*\r\n     ( case when h.carpan=0 then 1*h.mik else h.mik*h.carpan end),\r\n     0,\r\n     (((h.brmfiy+h.otvbrim)-(h.satisktut+h.genisktut))\r\n     * ( case when h.carpan=0 then 1*h.mik else h.mik*h.carpan end)),\r\n     (((h.brmfiy+h.otvbrim)-(h.satisktut+h.genisktut))\r\n     * ( case when h.carpan=0 then 1*h.mik else h.mik*h.carpan end))\r\n     *(1+h.kdvyuz),m.yuvtop\r\n     from faturamas as m WITH (NOLOCK)\r\n     inner join faturahrklistesi as h WITH (NOLOCK)\r\n     on m.fatid=h.fatid and m.sil=0 and h.sil=0\r\n     where m.tarih>=@bastar and  m.tarih<=@bittar\r\n     \r\n     \r\n     \r\n   if @Tartip=0\r\n   insert into @TB_FATURA_HRK\r\n    (fatid,fatrap_id,fattur_id,hrkid,firmano,sil,cartip,carkod,carunvan,\r\n     fatserino,Fatad,ACK,\r\n     tarih,saat,vadetarih,\r\n     stktip,stk_kod,stk_ad,miktar,brm_fiyat,KDV,TUTAR_KDVSIZ,ISKYUZDE,\r\n     TUTAR_ISK,TUTAR_KDV,TUTAR_ISKKDVSIZ,TUTAR_KDVLI,\r\n     YUVARLAMA)\r\n     select M.fatid,m.fatrap_id,m.fattur_id,h.id,m.firmano,m.sil,\r\n     m.cartip,m.carkod,'',(fatseri+fatno),m.fatad,m.ack,\r\n     m.tarih,m.saat,m.vadtar,\r\n     h.stktip,h.stkod,'',h.mik,h.brmfiy,h.kdvyuz*100,\r\n     h.brmfiy*( case when h.carpan=0 then 1*h.mik else h.mik*h.carpan end),\r\n     h.satiskyuz,(h.genisktut+h.satisktut)*\r\n     ( case when h.carpan=0 then 1*h.mik else h.mik*h.carpan end),\r\n     0,\r\n     (((h.brmfiy+h.otvbrim)-(h.satisktut+h.genisktut))\r\n     * ( case when h.carpan=0 then 1*h.mik else h.mik*h.carpan end)),\r\n     (((h.brmfiy+h.otvbrim)-(h.satisktut+h.genisktut))\r\n     * ( case when h.carpan=0 then 1*h.mik else h.mik*h.carpan end))\r\n     *(1+h.kdvyuz),m.yuvtop\r\n     from faturamas as m WITH (NOLOCK)\r\n     inner join faturahrklistesi as h WITH (NOLOCK)\r\n     on m.fatid=h.fatid and m.sil=0 and h.sil=0\r\n        \r\n     \r\n     \r\n     \r\n     \r\n     update @TB_FATURA_HRK set TUTAR_KDV=TUTAR_KDVLI-TUTAR_ISKKDVSIZ\r\n     \r\n     \r\n      if @firmano>0\r\n      delete from @TB_FATURA_HRK where firmano not in (0,@firmano)\r\n     \r\n     \r\n     update @TB_FATURA_HRK set grp1=dt.grp1 from \r\n     @TB_FATURA_HRK as t join \r\n     (select kod,tip,ad,grp1=case when grp3>0 then grp3 \r\n     when grp2>0 then grp2 when grp1>0 then grp1 end  from  gelgidlistok )\r\n     dt on t.stktip=dt.tip and dt.kod=t.stk_kod\r\n     \r\n     \r\n     update @TB_FATURA_HRK set grp_ad=dt.ad from \r\n     @TB_FATURA_HRK as t join \r\n     (select id,ad,grp1 from  grup )\r\n     dt on t.grp1=dt.id \r\n     \r\n     update @TB_FATURA_HRK set carunvan=dt.ad,Per_id=dt.per_id from \r\n     @TB_FATURA_HRK as t join \r\n     (select cartp,kod,ad,per_id from  Genel_Kart )\r\n     dt on t.cartip=dt.cartp and dt.kod=t.carkod\r\n     \r\n     \r\n     \r\n     insert into @TB_FATURA_RAP\r\n     (firmano,sil,fatid,fatrap_id,fattur_id,\r\n     cartip,carkod,carunvan,per_id,\r\n     fatserino,Fatad,ack,tarih,saat,vadetarih,\r\n     grp1,grp_ad,miktar,brm_fiyat,kdv,TUTAR_KDVSIZ,\r\n     ISKYUZDE,TUTAR_ISK,TUTAR_KDV,TUTAR_ISKKDVSIZ,\r\n     TUTAR_KDVLI)      \r\n     select firmano,sil,fatid,fatrap_id,fattur_id,\r\n     cartip,carkod,carunvan,per_id,\r\n     fatserino,Fatad,ack,tarih,saat,vadetarih,\r\n     grp1,grp_ad,\r\n     sum(miktar),\r\n     sum(brm_fiyat*miktar)/sum(miktar),\r\n     max(kdv),\r\n     sum(TUTAR_KDVSIZ),\r\n     sum(ISKYUZDE),sum(TUTAR_ISK),sum(TUTAR_KDV),\r\n     sum(TUTAR_ISKKDVSIZ),sum(TUTAR_KDVLI)\r\n     from @TB_FATURA_HRK\r\n     group by firmano,sil,fatid,fatrap_id,fattur_id,\r\n     cartip,carkod,carunvan,per_id,\r\n     fatserino,Fatad,ack,tarih,saat,vadetarih,\r\n     grp1,grp_ad  \r\n  \r\n  \r\n  \r\n        \r\n     \r\n     insert into @TB_FATURA_RAP\r\n     (firmano,sil,fatid,fatrap_id,fattur_id,\r\n     cartip,carkod,carunvan,per_id,\r\n     fatserino,Fatad,ack,tarih,saat,vadetarih,\r\n     grp1,grp_ad,miktar,brm_fiyat,kdv,TUTAR_KDVSIZ,\r\n     ISKYUZDE,TUTAR_ISK,TUTAR_KDV,TUTAR_ISKKDVSIZ,\r\n     TUTAR_KDVLI)      \r\n     select firmano,sil,fatid,fatrap_id,fattur_id,\r\n     cartip,carkod,carunvan,per_id,\r\n     fatserino,Fatad,ack,tarih,saat,vadetarih,\r\n     0,'YUVARLAMA',1,0,0,0,\r\n     0,0,0,0,max(YUVARLAMA)\r\n     from @TB_FATURA_HRK\r\n     group by firmano,sil,fatid,fatrap_id,fattur_id,\r\n     cartip,carkod,carunvan,per_id,\r\n     fatserino,Fatad,ack,tarih,saat,\r\n     vadetarih\r\n     having max(YUVARLAMA)<>0\r\n  \r\n\r\n  \r\n  RETURN\r\n  \r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_FATURA_STOK_PER_HRK",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_FATURA_STOK_PER_HRK",
    "definition": "CREATE FUNCTION [dbo].[UDF_FATURA_STOK_PER_HRK] \r\n(@firmano    int,\r\n@Tartip          INT,\r\n@bastar      datetime,\r\n@bittar      datetime,\r\n@YetkiId      int )\r\nRETURNS\r\n  @TB_FATURA_RAP TABLE (\r\n  id\t\t\t\t\t  bigint  IDENTITY(1, 1) NOT NULL,\r\n  firmano\t\t\t\t  int,\r\n  per_kod                  VARCHAR(30) COLLATE Turkish_CI_AS,\r\n  per_unvan                VARCHAR(150) COLLATE Turkish_CI_AS,\r\n  Per_id\t\t\t\t  int,\t\r\n  Stk_tip                 VARCHAR(30) COLLATE Turkish_CI_AS,\r\n  Stk_Kod                 VARCHAR(30) COLLATE Turkish_CI_AS,\r\n  Stk_Ad                  VARCHAR(150) COLLATE Turkish_CI_AS,\r\n  Adet\t\t\t\t\t  int,\r\n  miktar   \t\t          FLOAT,\r\n  TUTAR_KDVSIZ            FLOAT,\r\n  TUTAR_KDV     \t      FLOAT,\r\n  TUTAR_KDVLI             FLOAT)\r\nAS\r\nBEGIN\r\n  \r\n\r\n  declare @TB_FATURA_HRK TABLE (\r\n  id\t\t\t\t\t  bigint IDENTITY(1, 1) NOT NULL,\r\n  Firmano\t\t\t\t  int,\r\n  per_kod                  VARCHAR(30) COLLATE Turkish_CI_AS,\r\n  per_unvan                VARCHAR(150) COLLATE Turkish_CI_AS,\r\n  Per_id\t\t\t\t  int,\t\r\n  Stk_tip                 VARCHAR(30) COLLATE Turkish_CI_AS,\r\n  Stk_Kod                 VARCHAR(30) COLLATE Turkish_CI_AS,\r\n  Stk_Ad                  VARCHAR(150) COLLATE Turkish_CI_AS,\r\n  Adet\t\t\t\t\t  int,\r\n  miktar   \t\t          FLOAT,\r\n  TUTAR_KDVSIZ            FLOAT,\r\n  TUTAR_KDV     \t      FLOAT,\r\n  TUTAR_KDVLI             FLOAT)\r\n\r\n\r\n  \r\n\r\n\r\n  if @Tartip=1\r\n    insert into @TB_FATURA_HRK\r\n    (Per_id,per_kod,per_unvan,\r\n     Stk_tip,Stk_Kod,Stk_Ad,Adet,miktar,\r\n     TUTAR_KDV,TUTAR_KDVSIZ,TUTAR_KDVLI)\r\n     select m.Per_id,'','',\r\n     h.stktip,h.stkod,'',1,h.mik,\r\n     0,\r\n     (((h.brmfiy+h.otvbrim)-(h.satisktut+h.genisktut))\r\n     * ( case when h.carpan=0 then 1*h.mik else h.mik*h.carpan end)),/*TUTAR_ISKKDVSIZ */\r\n     (((h.brmfiy+h.otvbrim)-(h.satisktut+h.genisktut))\r\n     * ( case when h.carpan=0 then 1*h.mik else h.mik*h.carpan end))\r\n     *(1+h.kdvyuz)/*TUTAR_KDVLI */\r\n     from faturamas as m WITH (NOLOCK)\r\n     inner join faturahrklistesi as h WITH (NOLOCK)\r\n     on m.fatid=h.fatid and m.sil=0 and h.sil=0 and Per_id>0\r\n     where m.tarih>=@bastar and  m.tarih<=@bittar\r\n     and m.fatrap_id not in (select rap_id from YetkiKont WITH (NOLOCK) where Yetkiid=@YetkiId and Bolumid=3 ) \r\n     \r\n     \r\n     \r\n   if @Tartip=0\r\n   insert into @TB_FATURA_HRK\r\n   (Per_id,per_kod,per_unvan,\r\n     Stk_tip,Stk_Kod,Stk_Ad,Adet,miktar,\r\n     TUTAR_KDV,TUTAR_KDVSIZ,TUTAR_KDVLI)\r\n     select m.Per_id,'','',\r\n     h.stktip,h.stkod,'',1,h.mik,\r\n     0,\r\n     (((h.brmfiy+h.otvbrim)-(h.satisktut+h.genisktut))\r\n     * ( case when h.carpan=0 then 1*h.mik else h.mik*h.carpan end)),/*TUTAR_ISKKDVSIZ */\r\n     (((h.brmfiy+h.otvbrim)-(h.satisktut+h.genisktut))\r\n     * ( case when h.carpan=0 then 1*h.mik else h.mik*h.carpan end))\r\n     *(1+h.kdvyuz)/*TUTAR_KDVLI */\r\n     from faturamas as m WITH (NOLOCK)\r\n     inner join faturahrklistesi as h WITH (NOLOCK)\r\n     on m.fatid=h.fatid and m.sil=0 and h.sil=0 and Per_id>0\r\n     and m.fatrap_id not in (select rap_id from YetkiKont WITH (NOLOCK) where Yetkiid=@YetkiId and Bolumid=3 ) \r\n         \r\n         \r\n     \r\n     update @TB_FATURA_HRK set TUTAR_KDV=TUTAR_KDVLI-TUTAR_KDVSIZ\r\n     \r\n     \r\n     if @firmano>0\r\n      delete from @TB_FATURA_HRK where firmano not in (0,@firmano)\r\n    \r\n   \r\n       update @TB_FATURA_HRK set Stk_ad=dt.ad,Stk_Kod=dt.Kod from \r\n     @TB_FATURA_HRK as t join \r\n     (select tip,kod,ad from stokkart )\r\n     dt on  dt.tip=t.Stk_tip and dt.Kod=T.Stk_Kod\r\n   \r\n     \r\n     \r\n        \r\n     update @TB_FATURA_HRK set per_unvan=dt.unvan,Per_Kod=dt.Kod from \r\n     @TB_FATURA_HRK as t join \r\n     (select id,kod,ad+' '+soyad unvan from PerKart )  dt on dt.id=t.per_id\r\n     \r\n     \r\n     \r\n     insert into @TB_FATURA_RAP\r\n     (firmano,Per_id,per_kod,per_unvan,\r\n     Stk_tip,Stk_Kod,Stk_Ad,Adet,miktar,\r\n      TUTAR_KDV,TUTAR_KDVSIZ,TUTAR_KDVLI)      \r\n     select firmano,Per_id,per_kod,per_unvan,\r\n     Stk_tip,Stk_Kod,Stk_Ad,\r\n     sum(Adet),\r\n     sum(miktar),\r\n     sum(TUTAR_KDV),\r\n     sum(TUTAR_KDVSIZ),sum(TUTAR_KDVLI)\r\n     from @TB_FATURA_HRK\r\n     group by firmano,Per_id,per_kod,per_unvan,\r\n     Stk_tip,Stk_Kod,Stk_Ad\r\n\r\n  \r\n  RETURN\r\n  \r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_FATURAHRK_RAP",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_FATURAHRK_RAP",
    "definition": "CREATE FUNCTION [dbo].UDF_FATURAHRK_RAP\r\n(@FATIN          VARCHAR(8000))\r\nRETURNS\r\n  @TB_FATURA_RAP TABLE (\r\n  FAT_ID                  VARCHAR(30) COLLATE Turkish_CI_AS,\r\n  STOK_TIP                VARCHAR(30) COLLATE Turkish_CI_AS,\r\n  STOK_KOD                VARCHAR(30) COLLATE Turkish_CI_AS,\r\n  STOK_AD                 VARCHAR(150) COLLATE Turkish_CI_AS,\r\n  STOK_BIRIM              VARCHAR(30) COLLATE Turkish_CI_AS,\r\n  MIKTAR                  FLOAT,\r\n  BRIMFIYAT               FLOAT,\r\n  KDVLIBRIMFIYAT          FLOAT,\r\n  TUTAR                   FLOAT,\r\n  KDVLITUTAR              FLOAT)\r\nAS\r\nBEGIN\r\n\r\n\r\n    insert into @TB_FATURA_RAP\r\n    (FAT_ID,STOK_TIP,STOK_KOD,STOK_AD,STOK_BIRIM,MIKTAR,\r\n    BRIMFIYAT,KDVLIBRIMFIYAT,TUTAR,KDVLITUTAR)\r\n    select 'F'+CAST(h.fatid AS varchar),st.tip,st.kod,st.ad,h.brim,\r\n    (mik*carpan),\r\n    round( ( (h.brmfiy+h.otvbrim)-(h.satisktut+h.genisktut)),2),\r\n    ROUND( ( (h.brmfiy+h.otvbrim)-(h.satisktut+h.genisktut))*(1+h.kdvyuz),2),\r\n    ((h.brmfiy+h.otvbrim)-(h.satisktut+h.genisktut))*h.mik,\r\n    (( (h.brmfiy+h.otvbrim)-(h.satisktut+h.genisktut))* (1+h.kdvyuz))*h.mik\r\n    from faturahrklistesi h WITH (NOLOCK)\r\n    inner join gelgidlistok as st WITH (NOLOCK) on \r\n    h.stkod=st.kod and st.tip=h.stktip and h.sil=0\r\n    where 'F'+CAST(h.fatid AS varchar) \r\n    in (select * from CsvToStr(@FATIN))\r\n    \r\n       \r\n    insert into @TB_FATURA_RAP\r\n    (FAT_ID,STOK_TIP,STOK_KOD,STOK_AD,STOK_BIRIM,MIKTAR,\r\n    BRIMFIYAT,KDVLIBRIMFIYAT,TUTAR,KDVLITUTAR)\r\n    select 'Z'+CAST(h.zrapid AS varchar),st.tip,st.kod,st.ad,'-',\r\n    (miktar),\r\n    round(brmfiy/(1+h.kdvyuz),2),\r\n    round(brmfiy,2),\r\n    ((brmfiy/(1+h.kdvyuz))*miktar),\r\n    brmfiy*miktar\r\n    from zraporhrk h WITH (NOLOCK)\r\n    inner join Zrapor_UrunKart_Listesi as st WITH (NOLOCK)\r\n    on h.kod=st.kod and st.tip=h.tip and h.sil=0\r\n    where 'Z'+CAST(h.zrapid AS varchar) \r\n    in (select * from CsvToStr(@FATIN))\r\n    \r\n\r\n   RETURN\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_FATURASTOK_RAP",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_FATURASTOK_RAP",
    "definition": "CREATE FUNCTION [dbo].UDF_FATURASTOK_RAP\r\n(@FATIN          VARCHAR(4000),\r\n@CARTIPIN        VARCHAR(300),\r\n@CARIN           VARCHAR(8000),\r\n@TARTIP          INT,\r\n@BASTAR          DATETIME,\r\n@BITTAR          DATETIME,\r\n@AKSTKIN \t\t VARCHAR(8000),\r\n@MARSTKGRPIN  \t VARCHAR(8000),\r\n@GELSTKIN  \t\t VARCHAR(8000)\r\n)\r\nRETURNS\r\n  @TB_FATURA_RAP TABLE (\r\n  FAT_ID                  INT,\r\n  CARI_KOD                VARCHAR(30) COLLATE Turkish_CI_AS,\r\n  CARI_UNVAN              VARCHAR(150) COLLATE Turkish_CI_AS,\r\n  FAT_SERINO              VARCHAR(30) COLLATE Turkish_CI_AS,\r\n  FAT_AD                  VARCHAR(50) COLLATE Turkish_CI_AS,\r\n  ISLEMTARIHI             DATETIME,\r\n  VADETARIHI              DATETIME,\r\n  STOK_TIP                VARCHAR(30) COLLATE Turkish_CI_AS,\r\n  STOK_KOD                VARCHAR(30) COLLATE Turkish_CI_AS,\r\n  STOK_GRPID              INT,\r\n  STOK_AD                 VARCHAR(150) COLLATE Turkish_CI_AS,\r\n  STOK_BIRIM              VARCHAR(30) COLLATE Turkish_CI_AS,\r\n  KDV                     FLOAT,\r\n  MIKTAR                  FLOAT,\r\n  BRIMFIYAT               FLOAT,\r\n  KDVLIBRIMFIYAT          FLOAT,\r\n  TUTAR                   FLOAT,\r\n  KDVLITUTAR              FLOAT,\r\n  KDVTUTAR\t\t\t\t  FLOAT)\r\nAS\r\nBEGIN\r\n\r\n\r\n     if @TARTIP=0 /*işlem tarihine göre */\r\n     insert into @TB_FATURA_RAP\r\n     (FAT_ID,CARI_KOD,CARI_UNVAN,FAT_SERINO,FAT_AD,ISLEMTARIHI,VADETARIHI,\r\n      STOK_TIP,STOK_KOD,STOK_AD,STOK_BIRIM,KDV,MIKTAR,BRIMFIYAT,KDVLIBRIMFIYAT,\r\n      TUTAR,KDVLITUTAR)\r\n      select m.fatid,car.kod,car.ad,(fatseri+fatno) FATSERINO,m.fatad,\r\n      m.tarih,m.vadtar,\r\n      st.tip,st.kod,st.ad,h.brim,h.kdvyuz*100,(mik),\r\n      ( (h.brmfiy+h.otvbrim)-(h.satisktut+h.genisktut)),\r\n      ( (h.brmfiy+h.otvbrim)-(h.satisktut+h.genisktut))*(1+h.kdvyuz),\r\n      ((h.brmfiy+h.otvbrim)-(h.satisktut+h.genisktut))*h.mik,\r\n      (( (h.brmfiy+h.otvbrim)-(h.satisktut+h.genisktut))* (1+h.kdvyuz))*h.mik\r\n      from faturamas as m WITH (NOLOCK) \r\n      inner join  faturahrklistesi as h WITH (NOLOCK)  \r\n      on h.fatid=m.fatid and m.sil=0 and h.sil=0\r\n      inner join Genel_Kart as car \r\n      on m.carkod=car.kod and m.cartip=car.cartp\r\n      inner join gelgidlistok as st WITH (NOLOCK)\r\n      on h.stkod=st.kod and st.tip=h.stktip\r\n      where m.fattip_id in (select * from CsvToSTR(@FATIN) )\r\n      and m.tarih>=@BASTAR and m.tarih<=@BITTAR\r\n      and m.cartip in (select * from CsvToSTR(@CARTIPIN))\r\n      /* and ( (@CARIN<>'' and m.carkod in (select * from CsvToSTR(@CARIN)) ) */\r\n     /* or (@CARIN='' and m.carkod like '%') ) */\r\n      order by st.kod\r\n      \r\n      \r\n      \r\n     if @TARTIP=1 /*işlem tarihine göre */\r\n     insert into @TB_FATURA_RAP\r\n     (FAT_ID,CARI_KOD,CARI_UNVAN,FAT_SERINO,FAT_AD,ISLEMTARIHI,VADETARIHI,\r\n      STOK_TIP,STOK_KOD,STOK_AD,STOK_BIRIM,KDV,MIKTAR,BRIMFIYAT,TUTAR,KDVLITUTAR)\r\n      select m.fatid,car.kod,car.ad,(fatseri+fatno) FATSERINO,m.fatad,m.tarih,m.vadtar,\r\n      st.tip,st.kod,st.ad,h.brim,h.kdvyuz*100,(mik),(brmfiy),((brmfiy*mik)+otvtut),\r\n      (((brmfiy*mik)+otvtut)*(1+KDVYUZ) )\r\n      from faturamas as m  WITH (NOLOCK)\r\n      inner join  faturahrk as h WITH (NOLOCK)\r\n       on h.fatid=m.fatid and m.sil=0 and h.sil=0\r\n      inner join Genel_Kart as car on m.carkod=car.kod and m.cartip=car.cartp\r\n      inner join gelgidlistok as st WITH (NOLOCK) on h.stkod=st.kod and st.tip=h.stktip\r\n      where m.fattip_id in (select * from CsvToSTR(@FATIN) )\r\n      and m.vadtar>=@BASTAR and m.vadtar<=@BITTAR\r\n      and m.cartip in (select * from CsvToSTR(@CARTIPIN))\r\n      order by st.kod\r\n      \r\n      \r\n      \r\n      update @TB_FATURA_RAP set STOK_GRPID=\r\n      case when k.grp3>0 then k.grp3\r\n      when k.grp2>0 then k.grp2\r\n      when k.grp1>0 then k.grp1 end\r\n      from @TB_FATURA_RAP as t inner join stokkart as k\r\n      on k.kod=t.STOK_KOD and t.STOK_TIP='markt'\r\n      and t.STOK_TIP ='markt'\r\n      \r\n      \r\n      \r\n       delete from @TB_FATURA_RAP\r\n  \t\twhere STOK_TIP='akykt' and  STOK_KOD not in (select * from CsvToSTR(@AKSTKIN))\r\n\r\n       delete from @TB_FATURA_RAP\r\n  \t\twhere STOK_TIP='gelgid' and STOK_KOD not in (select * from CsvToSTR(@GELSTKIN))\r\n  \r\n \t   delete from @TB_FATURA_RAP\r\n  \t    where STOK_TIP='markt' and STOK_GRPID not in (select * from CsvToSTR(@MARSTKGRPIN))\r\n  \r\n          \r\n\r\n     if @CARIN<>'' \r\n      delete from  @TB_FATURA_RAP\r\n      where CARI_KOD not in (select * from CsvToSTR(@CARIN)) \r\n      \r\n      \r\n      UPDATE @TB_FATURA_RAP set \r\n      KDVTUTAR=KDVLITUTAR-TUTAR\r\n\r\n\r\n\r\n   RETURN\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_GELGID_AYLIK",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_GELGID_AYLIK",
    "definition": "CREATE FUNCTION [dbo].UDF_GELGID_AYLIK (@CARI_TIP VARCHAR(20),\r\n@CARI_KOD VARCHAR(20),\r\n@TARIH1 DATETIME, @TARIH2 DATETIME)\r\nRETURNS\r\n  @TB_CARI_EKSTRE TABLE (\r\n    CARI_TIP    VARCHAR(20)  COLLATE Turkish_CI_AS,\r\n    CARI_KOD    VARCHAR(20)   COLLATE Turkish_CI_AS,\r\n    CARI_UNVAN  VARCHAR(50)  COLLATE Turkish_CI_AS,\r\n    AY           INT,\r\n    AYISIM       VARCHAR(20)  COLLATE Turkish_CI_AS,\r\n    CARIBORC         FLOAT,\r\n    CARIALACAK        FLOAT,\r\n    CARIBAKIYE        FLOAT,\r\n    BAKIYE     FLOAT )\r\nAS\r\nBEGIN\r\n  DECLARE @EKSTRE_TEMP TABLE (\r\n    CARI_TIP    VARCHAR(20)  COLLATE Turkish_CI_AS,\r\n    CARI_KOD    VARCHAR(20)  COLLATE Turkish_CI_AS,\r\n    CARI_UNVAN  VARCHAR(50)  COLLATE Turkish_CI_AS,\r\n     AY           INT,\r\n     AYISIM       VARCHAR(20)  COLLATE Turkish_CI_AS,\r\n     CARIBORC         FLOAT,\r\n     CARIALACAK        FLOAT,\r\n     CARIBAKIYE        FLOAT,\r\n     BAKIYE     FLOAT )\r\n\r\n  DECLARE @HRK_CARI_TIP    VARCHAR(20)\r\n  DECLARE @HRK_CARI_CARTIP VARCHAR(20)\r\n  DECLARE @HRK_CARI_KOD    VARCHAR(20)\r\n  DECLARE @HRK_CARI_UNVAN  VARCHAR(50)\r\n  DECLARE @HRK_AY           INT\r\n  DECLARE @HRK_AYISIM       VARCHAR(20)\r\n  DECLARE @HRK_BORC          FLOAT\r\n  DECLARE @HRK_ALACAK        FLOAT\r\n  DECLARE @HRK_CARIBAKIYE        FLOAT\r\n  DECLARE @HRK_GENELTOP      FLOAT\r\n  \r\n      DECLARE CRS_HRK CURSOR FAST_FORWARD FOR\r\n      SELECT\r\n      vc.tip,carkod,(vc.ad),MONTH(h.tarih),\r\n      isnull(sum(h.borc),0),\r\n      isnull(sum(h.alacak),0)\r\n      FROM carihrk as h inner join Genel_Kart as vc\r\n      on vc.cartp=h.cartip and vc.kod=h.carkod and h.cartip=@CARI_TIP\r\n      where  h.sil=0 AND tarih >= @TARIH1 and tarih <= @TARIH2\r\n      group by h.cartip,vc.tip,h.carkod,vc.ad,MONTH(h.tarih)\r\n      order by MONTH(h.tarih)\r\n\r\n  OPEN CRS_HRK\r\n\r\n  FETCH NEXT FROM CRS_HRK INTO\r\n   @HRK_CARI_CARTIP,@HRK_CARI_KOD,@HRK_CARI_UNVAN,@HRK_AY,@HRK_BORC,@HRK_ALACAK\r\n\r\n  WHILE @@FETCH_STATUS = 0\r\n  BEGIN\r\n\r\n    SET @HRK_GENELTOP=@HRK_BORC-@HRK_ALACAK\r\n    SET @HRK_CARIBAKIYE=@HRK_BORC-@HRK_ALACAK;\r\n    \r\n    \r\n    \r\n    \r\n        set @HRK_AYISIM=\r\n        (select\r\n          CASE @HRK_AY\r\n           WHEN 1 THEN 'OCAK'\r\n           WHEN 2 THEN 'ŞUBAT'\r\n           WHEN 3 THEN 'MART'\r\n           WHEN 4 THEN 'NİSAN'\r\n           WHEN 5 THEN 'MAYIS'\r\n           WHEN 6 THEN 'HAZİRAN'\r\n           WHEN 7 THEN 'TEMMUZ'\r\n           WHEN 8 THEN 'AĞUSTOS'\r\n           WHEN 9 THEN 'EYLÜL'\r\n           WHEN 10 THEN 'EKİM'\r\n           WHEN 11 THEN 'KASIM'\r\n           WHEN 12 THEN 'ARALIK'\r\n          END)\r\n    \r\n    \r\n\r\n    INSERT @EKSTRE_TEMP\r\n      SELECT\r\n       @HRK_CARI_TIP,@HRK_CARI_KOD,@HRK_CARI_UNVAN,@HRK_AY,@HRK_AYISIM,@HRK_BORC,@HRK_ALACAK,\r\n       @HRK_CARIBAKIYE,@HRK_GENELTOP\r\n       \r\n    FETCH NEXT FROM CRS_HRK INTO\r\n    @HRK_CARI_CARTIP,@HRK_CARI_KOD,@HRK_CARI_UNVAN,@HRK_AY,@HRK_BORC,@HRK_ALACAK\r\n  END\r\n\r\n  CLOSE CRS_HRK\r\n  DEALLOCATE CRS_HRK\r\n\r\n  /*---------------------------------------------------------------------------- */\r\n\r\n  INSERT @TB_CARI_EKSTRE\r\n    SELECT * FROM @EKSTRE_TEMP ORDER BY AY\r\n\r\n  RETURN\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_GELGID_BAKIYE",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_GELGID_BAKIYE",
    "definition": "CREATE FUNCTION [dbo].UDF_GELGID_BAKIYE \r\n(@CARI_TIP VARCHAR(20),\r\n@CARI_KOD VARCHAR(20),\r\n@TARIH1 DATETIME, @TARIH2 DATETIME)\r\nRETURNS\r\n  @TB_CARI_EKSTRE TABLE (\r\n    CARI_TIP        VARCHAR(20)  COLLATE Turkish_CI_AS,\r\n    CARI_KOD        VARCHAR(20)  COLLATE Turkish_CI_AS,\r\n    CARI_UNVAN      VARCHAR(150)  COLLATE Turkish_CI_AS,\r\n    CARI_GRPAD      VARCHAR(50)  COLLATE Turkish_CI_AS,\r\n    BORC            FLOAT,\r\n    ALACAK          FLOAT,\r\n    GENELTOPLAM     FLOAT )\r\nAS\r\nBEGIN\r\n  DECLARE @EKSTRE_TEMP TABLE (\r\n    CARI_TIP        VARCHAR(20)  COLLATE Turkish_CI_AS,\r\n    CARI_KOD        VARCHAR(20)  COLLATE Turkish_CI_AS,\r\n    CARI_UNVAN      VARCHAR(150)  COLLATE Turkish_CI_AS,\r\n    CARI_GRPAD      VARCHAR(50)  COLLATE Turkish_CI_AS,\r\n    BORC            FLOAT,\r\n    ALACAK          FLOAT,\r\n    GENELTOPLAM     FLOAT )\r\n\r\n  DECLARE @HRK_CARI_TIP         VARCHAR(20)\r\n  DECLARE @HRK_CARI_KOD    \t\tVARCHAR(20)\r\n  DECLARE @HRK_CARI_UNVAN  \t\tVARCHAR(150)\r\n  DECLARE @HRK_CARI_GRUPAD\t\tVARCHAR(150)\r\n  DECLARE @HRK_BORC         \tFLOAT\r\n  DECLARE @HRK_ALACAK         \tFLOAT\r\n  DECLARE @HRK_GENELTOP        \tFLOAT\r\n\r\n\r\n      DECLARE CRS_HRK CURSOR FAST_FORWARD FOR\r\n      SELECT\r\n      @CARI_TIP,vc.kod,(vc.ad),\r\n      vc.grup,\r\n      isnull(sum(h.borc),0),\r\n      isnull(sum(h.alacak),0)\r\n      FROM carihrk as h inner join Gel_Gid_Kart_Listesi as vc\r\n      on vc.kod=h.carkod and h.cartip=@CARI_TIP\r\n      where  h.sil=0 AND tarih >= @TARIH1 and tarih <= @TARIH2\r\n      group by vc.grup,vc.kod,vc.ad\r\n\r\n\r\n  \r\n  OPEN CRS_HRK\r\n\r\n  FETCH NEXT FROM CRS_HRK INTO\r\n   @HRK_CARI_TIP,@HRK_CARI_KOD,@HRK_CARI_UNVAN,\r\n   @HRK_CARI_GRUPAD,@HRK_BORC,@HRK_ALACAK\r\n\r\n  WHILE @@FETCH_STATUS = 0\r\n  BEGIN\r\n    SET @HRK_GENELTOP=@HRK_BORC-@HRK_ALACAK\r\n\r\n    INSERT @EKSTRE_TEMP\r\n      SELECT\r\n       @HRK_CARI_TIP,@HRK_CARI_KOD,@HRK_CARI_UNVAN,\r\n       @HRK_CARI_GRUPAD,@HRK_BORC,@HRK_ALACAK,@HRK_GENELTOP\r\n       \r\n    FETCH NEXT FROM CRS_HRK INTO\r\n    @HRK_CARI_TIP,@HRK_CARI_KOD,@HRK_CARI_UNVAN,\r\n    @HRK_CARI_GRUPAD,@HRK_BORC,@HRK_ALACAK\r\n  END\r\n\r\n  CLOSE CRS_HRK\r\n  DEALLOCATE CRS_HRK\r\n\r\n  /*---------------------------------------------------------------------------- */\r\n\r\n  INSERT @TB_CARI_EKSTRE\r\n    SELECT * FROM @EKSTRE_TEMP\r\n\r\n  RETURN\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_GENEL_AKARYAKIT_SATIS",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_GENEL_AKARYAKIT_SATIS",
    "definition": "CREATE FUNCTION [dbo].UDF_GENEL_AKARYAKIT_SATIS (\r\n@FIRMANO  INT,\r\n@TARIH1 DATETIME,\r\n@TARIH2 DATETIME)\r\nRETURNS\r\n  @TB_AKARYAKIT_SATIS TABLE (\r\n    STOK_KOD    VARCHAR(20)  COLLATE Turkish_CI_AS,\r\n    STOK_AD     VARCHAR(50)  COLLATE Turkish_CI_AS,\r\n    DONEMBASMIKTAR      FLOAT,\r\n    DONEMBASTUTAR       FLOAT,\r\n    ALISMIKTAR          FLOAT,\r\n    ALISTUTAR           FLOAT,\r\n    SATISMIKTAR         FLOAT,\r\n    SATISTUTAR          FLOAT,\r\n    DONEMSONMIKTAR      FLOAT,\r\n    DONEMSONTUTAR       FLOAT)\r\nAS\r\nBEGIN\r\n\r\n\r\n\r\n IF @FIRMANO>0\r\n  INSERT @TB_AKARYAKIT_SATIS (STOK_KOD,STOK_AD,\r\n  ALISMIKTAR,ALISTUTAR,\r\n  SATISMIKTAR,SATISTUTAR,\r\n  DONEMSONMIKTAR,DONEMSONTUTAR)\r\n  select st.kod,st.ad,\r\n  isnull(sum(h.giren),0),\r\n  isnull(sum(h.giren*h.brmfiykdvli),0),\r\n  isnull(sum(h.cikan),0),\r\n  isnull(sum(h.cikan*h.brmfiykdvli),0),\r\n  isnull(sum(h.giren-h.cikan),0),\r\n  isnull(sum((h.giren-h.cikan)*h.brmfiykdvli),0)\r\n  FROM  stokkart as st with (nolock)\r\n  inner join stkhrk as h with (nolock) \r\n  on st.kod=h.stkod and h.stktip=st.tip\r\n  and h.sil=0 and st.sil=0 and h.firmano=@FIRMANO\r\n  and h.tarih>=@TARIH1 and h.tarih<=@TARIH2\r\n  where st.tip='akykt'\r\n  group by st.kod,st.ad\r\n  ELSE\r\n  INSERT @TB_AKARYAKIT_SATIS (STOK_KOD,STOK_AD,\r\n  ALISMIKTAR,ALISTUTAR,\r\n  SATISMIKTAR,SATISTUTAR,\r\n  DONEMSONMIKTAR,DONEMSONTUTAR)\r\n  select st.kod,st.ad,\r\n  isnull(sum(h.giren),0),\r\n  isnull(sum(h.giren*h.brmfiykdvli),0),\r\n  isnull(sum(h.cikan),0),\r\n  isnull(sum(h.cikan*h.brmfiykdvli),0),\r\n  isnull(sum(h.giren-h.cikan),0),\r\n  isnull(sum((h.giren-h.cikan)*h.brmfiykdvli),0)\r\n  FROM  stokkart as st with (nolock)\r\n  inner join stkhrk as h with (nolock) \r\n  on st.kod=h.stkod and h.stktip=st.tip\r\n  and h.sil=0 and st.sil=0\r\n  and h.tarih>=@TARIH1 and h.tarih<=@TARIH2\r\n  where st.tip='akykt'\r\n  group by st.kod,st.ad\r\n\r\n\r\n  IF @FIRMANO>0\r\n   update @TB_AKARYAKIT_SATIS set\r\n   DONEMBASMIKTAR=DT.DONBASMIK,\r\n   DONEMBASTUTAR=DT.DONBASTUT*DT.DONBASMIK,\r\n   DONEMSONMIKTAR=DT.DONBASMIK+(ALISMIKTAR-SATISMIKTAR),\r\n   DONEMSONTUTAR=(DT.DONBASMIK+(ALISMIKTAR-SATISMIKTAR))*DT.DONBASTUT\r\n   FROM @TB_AKARYAKIT_SATIS\r\n   t join (\r\n   select h.stkod,\r\n   isnull(sum(h.giren-h.cikan),0) as DONBASMIK,\r\n   isnull(case when sum(h.giren)>0 then\r\n   (sum(h.giren*h.brmfiykdvli)/sum(h.giren)) else 0 end,0) as DONBASTUT\r\n   from stkhrk as h with (nolock)\r\n   where h.firmano=@FIRMANO and h.stktip='akykt' and h.sil=0 and H.tarih<@TARIH1\r\n   group by h.stkod ) dt on dt.stkod=t.STOK_KOD\r\n   else\r\n   update @TB_AKARYAKIT_SATIS set\r\n   DONEMBASMIKTAR=DT.DONBASMIK,\r\n   DONEMBASTUTAR=DT.DONBASTUT*DT.DONBASMIK,\r\n   DONEMSONMIKTAR=DT.DONBASMIK+(ALISMIKTAR-SATISMIKTAR),\r\n   DONEMSONTUTAR=(DT.DONBASMIK+(ALISMIKTAR-SATISMIKTAR))*DT.DONBASTUT\r\n   FROM @TB_AKARYAKIT_SATIS\r\n   t join (\r\n   select h.stkod,\r\n   isnull(sum(h.giren-h.cikan),0) as DONBASMIK,\r\n   isnull(case when sum(h.giren)>0 then\r\n   (sum(h.giren*h.brmfiykdvli)/sum(h.giren)) else 0 end,0) as DONBASTUT\r\n   from stkhrk as h with (nolock)\r\n   where h.stktip='akykt' and h.sil=0 and H.tarih<@TARIH1\r\n   group by h.stkod ) dt on dt.stkod=t.STOK_KOD \r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n  RETURN\r\n\r\nend"
  },
  {
    "schema": "dbo",
    "name": "UDF_GENEL_BANKAKART",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_GENEL_BANKAKART",
    "definition": "CREATE FUNCTION [dbo].UDF_GENEL_BANKAKART (\r\n@FIRMANO  INT,\r\n@TARIH1 DATETIME,\r\n@TARIH2 DATETIME)\r\nRETURNS\r\n  @TB_GENEL_BANKAKART TABLE (\r\n    KOD               VARCHAR(20)  COLLATE Turkish_CI_AS,\r\n    AD                VARCHAR(150)  COLLATE Turkish_CI_AS,\r\n    BORC              FLOAT,\r\n    ALACAK            FLOAT,\r\n    BAKIYE            FLOAT)\r\nAS\r\nBEGIN\r\n\r\n\r\n  IF @FIRMANO>0\r\n  INSERT @TB_GENEL_BANKAKART (KOD,AD,\r\n  BORC,ALACAK,BAKIYE)\r\n  select k.kod,k.ad,\r\n  isnull(sum(h.borc),0),\r\n  isnull(sum(h.alacak),0),\r\n  isnull(sum(h.borc-h.alacak),0)\r\n  FROM bankakart as k with (nolock)\r\n  inner join bankahrk as h with (nolock) on k.kod=h.bankod\r\n  and h.tarih>=@TARIH1 and h.tarih<=@TARIH2 and h.sil=0\r\n  and k.sil=0 and h.firmano=@FIRMANO\r\n  group by k.kod,k.ad\r\n  else\r\n  INSERT @TB_GENEL_BANKAKART (KOD,AD,\r\n  BORC,ALACAK,BAKIYE)\r\n  select k.kod,k.ad,\r\n  isnull(sum(h.borc),0),\r\n  isnull(sum(h.alacak),0),\r\n  isnull(sum(h.borc-h.alacak),0)\r\n  FROM bankakart as k with (nolock)\r\n  inner join bankahrk as h with (nolock) on k.kod=h.bankod\r\n  and h.tarih>=@TARIH1 and h.tarih<=@TARIH2 and h.sil=0\r\n  and k.sil=0\r\n  group by k.kod,k.ad\r\n  \r\n  \r\n  \r\n\r\n  RETURN\r\n\r\nend"
  },
  {
    "schema": "dbo",
    "name": "UDF_GENEL_CARBAKIYE",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_GENEL_CARBAKIYE",
    "definition": "CREATE FUNCTION [dbo].UDF_GENEL_CARBAKIYE (\r\n@FIRMANO     INT,\r\n@TARIH1 DATETIME,\r\n@TARIH2 DATETIME)\r\nRETURNS\r\n  @TB_GENEL_CARIKARTBAKIYE TABLE (\r\n    KOD               VARCHAR(20)  COLLATE Turkish_CI_AS,\r\n    AD                VARCHAR(150)  COLLATE Turkish_CI_AS,\r\n    BAKIYE            FLOAT)\r\nAS\r\nBEGIN\r\n\r\n    DECLARE @TB_GENEL_CARIKARTTEMP TABLE (\r\n    KOD               VARCHAR(20)  COLLATE Turkish_CI_AS,\r\n    AD                VARCHAR(150)  COLLATE Turkish_CI_AS,\r\n    BAKIYE            FLOAT)\r\n\r\n  /*--tum veresiye fişleri geliyor aktarılmıs ve aktarılmamıslar */\r\n  if @FIRMANO>0 \r\n  INSERT @TB_GENEL_CARIKARTTEMP (KOD,AD,BAKIYE)\r\n  select k.kod,k.unvan,isnull(sum(v.toptut),0)\r\n  FROM carikart as k with (nolock)\r\n  inner join veresimas as v with (nolock) on \r\n  k.kod=v.carkod and v.cartip='carikart'\r\n  and v.tarih>=@TARIH1 and v.tarih<=@TARIH2 \r\n  and v.sil=0 and k.sil=0 and v.firmano=@FIRMANO\r\n  group by k.kod,k.unvan\r\n  else\r\n  INSERT @TB_GENEL_CARIKARTTEMP (KOD,AD,BAKIYE)\r\n  select k.kod,k.unvan,isnull(sum(v.toptut),0)\r\n  FROM carikart as k with (nolock)\r\n  inner join veresimas as v with (nolock) on k.kod=v.carkod and v.cartip='carikart'\r\n  and v.tarih>=@TARIH1 and v.tarih<=@TARIH2 and v.sil=0 and k.sil=0\r\n  group by k.kod,k.unvan\r\n  \r\n  \r\n  \r\n  if @FIRMANO>0  \r\n  INSERT @TB_GENEL_CARIKARTTEMP (KOD,AD,BAKIYE)\r\n  select k.kod,k.unvan,\r\n  isnull(sum(h.borc),0)\r\n  FROM carikart as k with (nolock)\r\n  inner join carihrk as h with (nolock) on \r\n  k.kod=h.carkod and h.cartip='carikart'\r\n  and h.tarih>=@TARIH1 and h.tarih<=@TARIH2 \r\n  and h.sil=0 and k.sil=0 and h.firmano=@FIRMANO\r\n  and h.borc>0\r\n  and ( (h.islmtip='ODE' and h.islmhrk='NAK')\r\n  or (h.islmtip='CEK' and h.islmhrk='KSN')\r\n  or (h.islmtip='ODE' and h.islmhrk='IKK')\r\n  or (h.islmtip='CEK' and h.islmhrk='CIR')\r\n  )\r\n  group by k.kod,k.unvan\r\n  else\r\n  INSERT @TB_GENEL_CARIKARTTEMP (KOD,AD,BAKIYE)\r\n  select k.kod,k.unvan,\r\n  isnull(sum(h.borc),0)\r\n  FROM carikart as k with (nolock)\r\n  inner join carihrk as h with (nolock) on \r\n  k.kod=h.carkod and h.cartip='carikart'\r\n  and h.tarih>=@TARIH1 and h.tarih<=@TARIH2 \r\n  and h.sil=0 and k.sil=0 \r\n  and h.borc>0\r\n  and ( (h.islmtip='ODE' and h.islmhrk='NAK')\r\n  or (h.islmtip='CEK' and h.islmhrk='KSN')\r\n  or (h.islmtip='ODE' and h.islmhrk='IKK')\r\n  or (h.islmtip='CEK' and h.islmhrk='CIR')\r\n  )\r\n  group by k.kod,k.unvan\r\n\r\n\r\n  /*--cari kartların işletmeden tahsilatları */\r\n  if @FIRMANO>0  \r\n  INSERT @TB_GENEL_CARIKARTTEMP (KOD,AD,BAKIYE)\r\n  select k.kod,k.unvan,\r\n  isnull(sum(-1*h.alacak),0)\r\n  FROM carikart as k with (nolock)\r\n  inner join carihrk as h with (nolock) on \r\n  k.kod=h.carkod and h.cartip='carikart'\r\n  and h.tarih>=@TARIH1 and h.tarih<=@TARIH2 \r\n  and h.sil=0 and k.sil=0 and h.firmano=@FIRMANO\r\n  and h.alacak>0\r\n  and\r\n  ( (h.islmtip='TAH' and h.islmhrk='NAK')\r\n  or (h.islmtip='CEK' and h.islmhrk='POR')\r\n  or (h.islmtip='TAH' and h.islmhrk='POS')\r\n  )\r\n  group by k.kod,k.unvan\r\n  else\r\n   INSERT @TB_GENEL_CARIKARTTEMP (KOD,AD,BAKIYE)\r\n  select k.kod,k.unvan,\r\n  isnull(sum(-1*h.alacak),0)\r\n  FROM carikart as k with (nolock)\r\n  inner join carihrk as h with (nolock) on k.kod=h.carkod and h.cartip='carikart'\r\n  and h.tarih>=@TARIH1 and h.tarih<=@TARIH2 and h.sil=0 and k.sil=0\r\n  and h.alacak>0\r\n  and\r\n  ( (h.islmtip='TAH' and h.islmhrk='NAK')\r\n  or (h.islmtip='CEK' and h.islmhrk='POR')\r\n  or (h.islmtip='TAH' and h.islmhrk='POS')\r\n  )\r\n  group by k.kod,k.unvan  \r\n  \r\n  \r\n  \r\n\r\n  INSERT @TB_GENEL_CARIKARTBAKIYE (KOD,AD,BAKIYE)\r\n  select KOD,AD,isnull(sum(BAKIYE),0) from\r\n  @TB_GENEL_CARIKARTTEMP group by KOD,AD\r\n\r\n\r\n\r\n\r\n\r\n  RETURN\r\n\r\nend"
  },
  {
    "schema": "dbo",
    "name": "UDF_GENEL_CARIKART_FISBAKIYE",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_GENEL_CARIKART_FISBAKIYE",
    "definition": "CREATE FUNCTION [dbo].UDF_GENEL_CARIKART_FISBAKIYE(\r\n@FIRMANO  INT,\r\n@TARIH1 DATETIME,\r\n@TARIH2 DATETIME)\r\nRETURNS\r\n  @TB_GENEL_CARIKART TABLE (\r\n    KOD               VARCHAR(20)  COLLATE Turkish_CI_AS,\r\n    AD                VARCHAR(150)  COLLATE Turkish_CI_AS,\r\n    BAKIYE            FLOAT)\r\nAS\r\nBEGIN\r\n  /*--tum veresiye fişleri geliyor aktarılmıs ve aktarılmamıslar */\r\n  \r\n  if @FIRMANO>0\r\n  INSERT @TB_GENEL_CARIKART (KOD,AD,\r\n  BAKIYE)\r\n  select k.kod,k.unvan,\r\n  isnull(sum(v.toptut),0)\r\n  FROM carikart as k with (nolock)\r\n  inner join veresimas as v with (nolock) on \r\n  k.kod=v.carkod and v.cartip='carikart' and v.firmano=@FIRMANO\r\n  and v.tarih>=@TARIH1 and v.tarih<=@TARIH2 and v.sil=0 and k.sil=0\r\n  group by k.kod,k.unvan\r\n  else\r\n  INSERT @TB_GENEL_CARIKART (KOD,AD,\r\n  BAKIYE)\r\n  select k.kod,k.unvan,\r\n  isnull(sum(v.toptut),0)\r\n  FROM carikart as k with (nolock)\r\n  inner join veresimas as v with (nolock) on \r\n  k.kod=v.carkod and v.cartip='carikart' \r\n  and v.tarih>=@TARIH1 and v.tarih<=@TARIH2 and v.sil=0 and k.sil=0\r\n  group by k.kod,k.unvan \r\n\r\n\r\n  RETURN\r\n\r\nend"
  },
  {
    "schema": "dbo",
    "name": "UDF_GENEL_CARIKART_ODETAHBAKIYE",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_GENEL_CARIKART_ODETAHBAKIYE",
    "definition": "CREATE FUNCTION [dbo].UDF_GENEL_CARIKART_ODETAHBAKIYE (\r\n@FIRMANO  INT,\r\n@TIP    VARCHAR(20),\r\n@TARIH1 DATETIME,\r\n@TARIH2 DATETIME)\r\nRETURNS\r\n  @TB_GENEL_CARIKART TABLE (\r\n    KOD               VARCHAR(20)  COLLATE Turkish_CI_AS,\r\n    AD                VARCHAR(150)  COLLATE Turkish_CI_AS,\r\n    BAKIYE            FLOAT)\r\nAS\r\nBEGIN\r\n  /*--işletmenin odemeleri */\r\n  IF @TIP='ODE'\r\n  begin\r\n  if @FIRMANO>0 \r\n  INSERT @TB_GENEL_CARIKART (KOD,AD,BAKIYE)\r\n  select k.kod,k.unvan,\r\n  isnull(sum(h.borc),0)\r\n  FROM carikart as k with (nolock)\r\n  inner join carihrk as h with (nolock) on k.kod=h.carkod and h.cartip='carikart'\r\n  and h.tarih>=@TARIH1 and h.tarih<=@TARIH2 and h.sil=0 and k.sil=0\r\n  and h.borc>0 and h.firmano=@FIRMANO\r\n  and ( (h.islmtip='ODE' and h.islmhrk='NAK')\r\n  or (h.islmtip='CEK' and h.islmhrk='KSN')\r\n  or (h.islmtip='ODE' and h.islmhrk='IKK')\r\n  or (h.islmtip='CEK' and h.islmhrk='CIR')\r\n  )\r\n  group by k.kod,k.unvan\r\n  else\r\n  INSERT @TB_GENEL_CARIKART (KOD,AD,BAKIYE)\r\n  select k.kod,k.unvan,\r\n  isnull(sum(h.borc),0)\r\n  FROM carikart as k with (nolock)\r\n  inner join carihrk as h with (nolock) on k.kod=h.carkod and h.cartip='carikart'\r\n  and h.tarih>=@TARIH1 and h.tarih<=@TARIH2 and h.sil=0 and k.sil=0\r\n  and h.borc>0 \r\n  and ( (h.islmtip='ODE' and h.islmhrk='NAK')\r\n  or (h.islmtip='CEK' and h.islmhrk='KSN')\r\n  or (h.islmtip='ODE' and h.islmhrk='IKK')\r\n  or (h.islmtip='CEK' and h.islmhrk='CIR')\r\n  )\r\n  group by k.kod,k.unvan\r\n  \r\n  end\r\n  \r\n  \r\n  /*--cari kartların işletmeden tahsilatları */\r\n  IF @TIP='TAH'\r\n  begin\r\n  if @FIRMANO>0 \r\n  INSERT @TB_GENEL_CARIKART (KOD,AD,BAKIYE)\r\n  select k.kod,k.unvan,\r\n  isnull(sum(h.alacak),0)\r\n  FROM carikart as k with (nolock)\r\n  inner join carihrk as h with (nolock) on k.kod=h.carkod and h.cartip='carikart'\r\n  and h.tarih>=@TARIH1 and h.tarih<=@TARIH2 and h.sil=0 and k.sil=0\r\n  and h.alacak>0 and h.firmano=@FIRMANO\r\n  and\r\n  ( (h.islmtip='TAH' and h.islmhrk='NAK')\r\n  or (h.islmtip='CEK' and h.islmhrk='POR')\r\n  or (h.islmtip='TAH' and h.islmhrk='POS')\r\n  )\r\n  group by k.kod,k.unvan\r\n  else\r\n  INSERT @TB_GENEL_CARIKART (KOD,AD,BAKIYE)\r\n  select k.kod,k.unvan,\r\n  isnull(sum(h.alacak),0)\r\n  FROM carikart as k with (nolock)\r\n  inner join carihrk as h with (nolock) on k.kod=h.carkod and h.cartip='carikart'\r\n  and h.tarih>=@TARIH1 and h.tarih<=@TARIH2 and h.sil=0 and k.sil=0\r\n and h.alacak>0\r\n  and\r\n  ( (h.islmtip='TAH' and h.islmhrk='NAK')\r\n  or (h.islmtip='CEK' and h.islmhrk='POR')\r\n  or (h.islmtip='TAH' and h.islmhrk='POS')\r\n  )\r\n  group by k.kod,k.unvan\r\n  \r\n  end\r\n  \r\n  \r\n\r\n\r\n\r\n  RETURN\r\n\r\nend"
  },
  {
    "schema": "dbo",
    "name": "UDF_GENEL_CEKKART",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_GENEL_CEKKART",
    "definition": "CREATE FUNCTION [dbo].UDF_GENEL_CEKKART (\r\n@FIRMANO   INT,\r\n@TARIH1 DATETIME,\r\n@TARIH2 DATETIME)\r\nRETURNS\r\n  @TB_GENEL_CEKKART TABLE (\r\n    DRM_AD            VARCHAR(30)  COLLATE Turkish_CI_AS,\r\n    CARI_KOD          VARCHAR(20)  COLLATE Turkish_CI_AS,\r\n    CARI_AD           VARCHAR(150)  COLLATE Turkish_CI_AS,\r\n    BANKA             VARCHAR(150)  COLLATE Turkish_CI_AS,\r\n    ISLEMTAR          DATETIME,\r\n    VADETAR           DATETIME,\r\n    TUTAR             FLOAT)\r\nAS\r\nBEGIN\r\n\r\n  IF @FIRMANO>0\r\n  INSERT @TB_GENEL_CEKKART (DRM_AD,CARI_KOD,CARI_AD,\r\n  BANKA,ISLEMTAR,VADETAR,TUTAR)\r\n  select\r\n  k.islmhrkad,vc.kod,vc.ad,\r\n  k.banka,k.tarih,k.vadetar,\r\n  isnull(sum(k.giren),0)\r\n  FROM cekkart as k with (nolock)\r\n  inner join Genel_Kart as vc with (nolock) on k.carkod=vc.kod and\r\n  k.cartip=vc.cartp and k.firmano=@FIRMANO\r\n  and k.tarih>=@TARIH1 and k.tarih<=@TARIH2 and k.sil=0\r\n  and k.islmhrk='ALN'\r\n  group by k.islmhrkad,vc.kod,vc.ad,k.banka,k.tarih,k.vadetar,k.id\r\n  else\r\n  INSERT @TB_GENEL_CEKKART (DRM_AD,CARI_KOD,CARI_AD,\r\n  BANKA,ISLEMTAR,VADETAR,TUTAR)\r\n  select\r\n  k.islmhrkad,vc.kod,vc.ad,\r\n  k.banka,k.tarih,k.vadetar,\r\n  isnull(sum(k.giren),0)\r\n  FROM cekkart as k with (nolock)\r\n  inner join Genel_Kart as vc with (nolock) on k.carkod=vc.kod and\r\n  k.cartip=vc.cartp\r\n  and k.tarih>=@TARIH1 and k.tarih<=@TARIH2 and k.sil=0\r\n  and k.islmhrk='ALN'\r\n  group by k.islmhrkad,vc.kod,vc.ad,k.banka,k.tarih,k.vadetar,k.id \r\n\r\n  IF @FIRMANO>0\r\n  INSERT @TB_GENEL_CEKKART (DRM_AD,CARI_KOD,CARI_AD,\r\n  BANKA,ISLEMTAR,VADETAR,TUTAR)\r\n  select\r\n  k.islmhrkad,vc.kod,vc.ad,\r\n  k.banka,k.tarih,k.vadetar,\r\n  isnull(sum(k.cikan),0)\r\n  FROM cekkart as k with (nolock)\r\n  inner join Genel_Kart as vc with (nolock) on k.vercarkod=vc.kod and\r\n  k.vercartip=vc.cartp and k.firmano=@FIRMANO\r\n  and k.tarih>=@TARIH1 and k.tarih<=@TARIH2 and k.sil=0\r\n  and k.islmhrk='KSN'\r\n  group by k.islmhrkad,vc.kod,vc.ad,k.banka,k.tarih,k.vadetar,k.id\r\n  else\r\n  INSERT @TB_GENEL_CEKKART (DRM_AD,CARI_KOD,CARI_AD,\r\n  BANKA,ISLEMTAR,VADETAR,TUTAR)\r\n  select\r\n  k.islmhrkad,vc.kod,vc.ad,\r\n  k.banka,k.tarih,k.vadetar,\r\n  isnull(sum(k.cikan),0)\r\n  FROM cekkart as k with (nolock)\r\n  inner join Genel_Kart as vc with (nolock) on k.vercarkod=vc.kod and\r\n  k.vercartip=vc.cartp\r\n  and k.tarih>=@TARIH1 and k.tarih<=@TARIH2 and k.sil=0\r\n  and k.islmhrk='KSN'\r\n  group by k.islmhrkad,vc.kod,vc.ad,k.banka,k.tarih,k.vadetar,k.id\r\n  \r\n\r\n IF @FIRMANO>0\r\n  INSERT @TB_GENEL_CEKKART (DRM_AD,CARI_KOD,CARI_AD,\r\n  BANKA,ISLEMTAR,VADETAR,TUTAR)\r\n  select\r\n  k.drmad,vc.kod,vc.ad,\r\n  k.banka,k.tarih,k.vadetar,\r\n  isnull(sum(k.cikan),0)\r\n  FROM cekkart as k with (nolock)\r\n  inner join Genel_Kart as vc with (nolock) on k.vercarkod=vc.kod and\r\n  k.vercartip=vc.cartp and k.firmano=@FIRMANO\r\n  and k.tarih>=@TARIH1 and k.tarih<=@TARIH2 and k.sil=0\r\n  and k.drm in ('ODE')\r\n  group by k.drmad,vc.kod,vc.ad,k.banka,k.tarih,k.vadetar,k.id\r\n  else\r\n  INSERT @TB_GENEL_CEKKART (DRM_AD,CARI_KOD,CARI_AD,\r\n  BANKA,ISLEMTAR,VADETAR,TUTAR)\r\n  select\r\n  k.drmad,vc.kod,vc.ad,\r\n  k.banka,k.tarih,k.vadetar,\r\n  isnull(sum(k.cikan),0)\r\n  FROM cekkart as k with (nolock)\r\n  inner join Genel_Kart as vc with (nolock) on k.vercarkod=vc.kod and\r\n  k.vercartip=vc.cartp\r\n  and k.tarih>=@TARIH1 and k.tarih<=@TARIH2 and k.sil=0\r\n  and k.drm in ('ODE')\r\n  group by k.drmad,vc.kod,vc.ad,k.banka,k.tarih,k.vadetar,k.id\r\n\r\n  \r\n RETURN\r\n\r\nend"
  },
  {
    "schema": "dbo",
    "name": "UDF_GENEL_GIDER_GELIR",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_GENEL_GIDER_GELIR",
    "definition": "CREATE FUNCTION [dbo].UDF_GENEL_GIDER_GELIR (\r\n@FIRMANO   INT,\r\n@TIP   VARCHAR(10),\r\n@TARIH1 DATETIME,\r\n@TARIH2 DATETIME)\r\nRETURNS\r\n  @TB_GENEL_GIDER_GELIR TABLE (\r\n    GRUP_AD\t\t\t  VARCHAR(70)  COLLATE Turkish_CI_AS,\t\r\n    KOD               VARCHAR(30)  COLLATE Turkish_CI_AS,\r\n    AD                VARCHAR(150)  COLLATE Turkish_CI_AS,\r\n    BAKIYE            FLOAT)\r\nAS\r\nBEGIN\r\n\r\n  IF @TIP='GIDER'\r\n  Begin\r\n  IF @FIRMANO>0\r\n  INSERT @TB_GENEL_GIDER_GELIR (GRUP_AD,KOD,AD,BAKIYE)\r\n  select g.ad,k.kod,k.ad,\r\n  isnull(sum(h.borc),0)\r\n  FROM carihrk as h with (nolock) \r\n  inner join gelgidkart as k with (nolock) \r\n  on k.kod=h.carkod and h.cartip='gelgidkart'\r\n  and k.sil=0 and h.tarih>=@TARIH1 and h.tarih<=@TARIH2 and h.sil=0\r\n  and h.borc>0 and h.firmano=@FIRMANO\r\n  left join grup g with (nolock) on g.id=\r\n  case when (k.grp3>0) then k.grp3 \r\n  when k.grp2>0 then k.grp2\r\n  when k.grp1>0 then k.grp1 end\r\n  group by \r\n  g.ad,k.kod,k.ad\r\n  else\r\n  INSERT @TB_GENEL_GIDER_GELIR (GRUP_AD,KOD,AD,BAKIYE)\r\n  select g.ad,k.kod,k.ad,\r\n  isnull(sum(h.borc),0)\r\n  FROM carihrk as h with (nolock) \r\n  inner join gelgidkart as k with (nolock) \r\n  on k.kod=h.carkod and h.cartip='gelgidkart'\r\n  and k.sil=0 and h.tarih>=@TARIH1 and h.tarih<=@TARIH2 and h.sil=0\r\n  and h.borc>0 \r\n  left join grup g with (nolock) on g.id=\r\n  case when (k.grp3>0) then k.grp3 \r\n  when k.grp2>0 then k.grp2\r\n  when k.grp1>0 then k.grp1 end\r\n  group by \r\n  g.ad,k.kod,k.ad\r\n  \r\n  end\r\n  \r\n  IF @TIP='GELIR'\r\n  begin\r\n  IF @FIRMANO>0\r\n  INSERT @TB_GENEL_GIDER_GELIR (GRUP_AD,KOD,AD,BAKIYE)\r\n  select g.ad,k.kod,k.ad,\r\n  isnull(sum(h.alacak),0)\r\n  FROM gelgidkart as k with (nolock)\r\n  inner join carihrk as h with (nolock) on k.kod=h.carkod and h.cartip='gelgidkart'\r\n  and h.sil=0 and k.sil=0 and h.tarih>=@TARIH1 and h.tarih<=@TARIH2\r\n  and h.alacak>0 and h.firmano=@FIRMANO\r\n  left join grup g with (nolock) on g.id=\r\n  case when (k.grp3>0) then k.grp3 \r\n  when k.grp2>0 then k.grp2\r\n  when k.grp1>0 then k.grp1 end\r\n  group by  g.ad,k.kod,k.ad\r\n  else\r\n  INSERT @TB_GENEL_GIDER_GELIR (GRUP_AD,KOD,AD,BAKIYE)\r\n  select g.ad,k.kod,k.ad,\r\n  isnull(sum(h.alacak),0)\r\n  FROM gelgidkart as k with (nolock)\r\n  inner join carihrk as h with (nolock) on k.kod=h.carkod and h.cartip='gelgidkart'\r\n  and h.sil=0 and k.sil=0 and h.tarih>=@TARIH1 and h.tarih<=@TARIH2\r\n  and h.alacak>0\r\n  left join grup g with (nolock) on g.id=\r\n  case when (k.grp3>0) then k.grp3 \r\n  when k.grp2>0 then k.grp2\r\n  when k.grp1>0 then k.grp1 end\r\n  group by  g.ad,k.kod,k.ad\r\n  \r\n  \r\n  end\r\n\r\n  RETURN\r\n\r\nend"
  },
  {
    "schema": "dbo",
    "name": "UDF_GENEL_HRK",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_GENEL_HRK",
    "definition": "CREATE FUNCTION [dbo].UDF_GENEL_HRK (\r\n@firmano     int,\r\n@BASTAR DATETIME,\r\n@BITTAR DATETIME,\r\n@SILIN VARCHAR(20))\r\nRETURNS\r\n@TB_GENEL_HRK TABLE (\r\n    id          FLOAT,\r\n    Firmano     int,\r\n    Firma_ad    VARCHAR(150) COLLATE Turkish_CI_AS,\r\n    Tarih       Datetime,\r\n    Saat        varchar(10)  COLLATE Turkish_CI_AS,\r\n    VadeTar     Datetime,\r\n    Giren       FLOAT,\r\n    Cikan       FLOAT,\r\n    Ytlgiren    FLOAT,\r\n    Ytlcikan    FLOAT,\r\n    Kur         FLOAT,\r\n    Parabrm     varchar(20)  COLLATE Turkish_CI_AS,\r\n    Grpad      VARCHAR(100)   COLLATE Turkish_CI_AS,\r\n    Grptip     VARCHAR(20)   COLLATE Turkish_CI_AS,\r\n    Hrkidad     VARCHAR(30)  COLLATE Turkish_CI_AS,\r\n    Hrkid       FLOAT,\r\n    Masterid    FLOAT,\r\n    Varno       FLOAT,\r\n    Varok       INT,\r\n    Sil         INT,\r\n    Yerad       VARCHAR(50)  COLLATE Turkish_CI_AS,\r\n    Yertip      VARCHAR(30)  COLLATE Turkish_CI_AS,\r\n    Perkod      VARCHAR(30)  COLLATE Turkish_CI_AS,\r\n    Perad       VARCHAR(100) COLLATE Turkish_CI_AS,\r\n    Adaid       int,\r\n    AdaAd       VARCHAR(50)  COLLATE Turkish_CI_AS,\r\n    tipkod      varchar(20)  COLLATE Turkish_CI_AS,\r\n    tipad       varchar(50)  COLLATE Turkish_CI_AS,\r\n    hrkkod      varchar(20)  COLLATE Turkish_CI_AS,\r\n    hrkad      varchar(50)   COLLATE Turkish_CI_AS,\r\n    BelNo       varchar(50)  COLLATE Turkish_CI_AS,\r\n    Kod         varchar(50)  COLLATE Turkish_CI_AS,\r\n    CarKod      varchar(50)  COLLATE Turkish_CI_AS,\r\n    CarTip      varchar(20)  COLLATE Turkish_CI_AS,\r\n    Cartur      varchar(30)  COLLATE Turkish_CI_AS,\r\n    Unvan       varchar(150) COLLATE Turkish_CI_AS,\r\n    Kasakod     varchar(50)  COLLATE Turkish_CI_AS,\r\n    KasaAd      varchar(100)  COLLATE Turkish_CI_AS,\r\n    Bankakod     varchar(50) COLLATE Turkish_CI_AS,\r\n    BankaAd      varchar(150) COLLATE Turkish_CI_AS,\r\n    Ack          varchar(200) COLLATE Turkish_CI_AS,\r\n    Olustarsaat  Datetime,\r\n    Olususer     varchar(100)  COLLATE Turkish_CI_AS,\r\n    Degtarsaat    Datetime,\r\n    Deguser       varchar(100)  COLLATE Turkish_CI_AS,\r\n    Entegre_aktar  Datetime,\r\n    Entegre_tip    varchar(10) COLLATE Turkish_CI_AS,\r\n    Remote_id      float,\r\n    devir\t\t   bit )\r\nAS\r\nBEGIN\r\n\r\n  DECLARE @Firma_TEMP TABLE (\r\n   Firmano      int)\r\n\r\n  if @firmano=0\r\n    Insert @Firma_TEMP select id from firma union all select  0 as id\r\n \r\n\r\n if @firmano>0\r\n    Insert @Firma_TEMP Values (@firmano)\r\n\r\n\r\n DECLARE @SIL_TEMP TABLE (\r\n sil      int)\r\n\r\ndeclare @separator char(1)\r\n set @separator = ','\r\n\r\n declare @separator_position int\r\n declare @array_value varchar(1000)\r\n\r\n IF (LEN(RTRIM(@SILIN)) > 0)\r\n BEGIN\r\n  set @SILIN = @SILIN + ','\r\n END\r\n\r\n while patindex('%,%' , @SILIN) <> 0\r\n begin\r\n\r\n   select @separator_position =  patindex('%,%' , @SILIN)\r\n   select @array_value = left(@SILIN, @separator_position - 1)\r\n\r\n  Insert @SIL_TEMP\r\n  Values (@array_value)\r\n\r\n   select @SILIN = stuff(@SILIN, 1, @separator_position, '')\r\n end\r\n\r\n\r\n\r\n/*- kasa hrk */\r\n  insert into @TB_GENEL_HRK (id,Firmano,\r\n  Tarih,Saat,VadeTar,Giren,Cikan,Kur,Parabrm,\r\n  Grpad,Grptip,Hrkidad,Hrkid,Masterid,Varno,Varok,\r\n  Sil,Yerad,Yertip,Perkod,\r\n  Perad,Adaid,AdaAd,tipkod,tipad,hrkkod,hrkad,\r\n  BelNo,Ack,Kod,CarKod,CarTip,Kasakod,KasaAd,Bankakod,\r\n  BankaAd,Olustarsaat,Olususer,Degtarsaat,DegUser,\r\n  Entegre_aktar,Entegre_tip,\r\n  Remote_id,devir)\r\n  \r\n  SELECT h.id,h.firmano,h.tarih,h.saat,h.vadetar,h.giren,h.cikan,\r\n  h.kur,h.parabrm,'KASA İŞLEMLERİ','kasahrk',\r\n  ('kashrkid') as hrkidad,h.kashrkid as hrkid,h.masterid,h.varno,h.varok,\r\n  h.sil,h.yerad,h.yertip,\r\n  h.perkod,'',h.adaid,'',h.islmtip,h.islmtipad,h.islmhrk,h.islmhrkad,\r\n  h.belno,h.ack,h.kaskod,h.carkod,h.cartip,\r\n  h.kaskod,'',\r\n  ('') as bankod,('') as bankad,\r\n  h.olustarsaat,h.olususer,H.degtarsaat,H.deguser,\r\n  Entegre_aktar,Entegre_tip,\r\n  h.remote_id,h.devir\r\n  from kasahrk as h\r\n  where h.masterid=0\r\n  and h.firmano in (select * from @Firma_TEMP)\r\n  and h.sil in (select * from @SIL_TEMP)\r\n  and h.tarih>=@BASTAR and h.tarih<=@BITTAR\r\n\r\n\r\n/* pos hrk */\r\n\r\n  insert into @TB_GENEL_HRK (id,Firmano,Tarih,Saat,VadeTar,Giren,Cikan,Kur,Parabrm,\r\n  Grpad,Grptip,Hrkidad,Hrkid,Masterid,Varno,Varok,Sil,Yerad,Yertip,Perkod,\r\n  Perad,Adaid,AdaAd,tipkod,tipad,hrkkod,hrkad,BelNo,Ack,Kod,\r\n  CarKod,CarTip,Kasakod,KasaAd,Bankakod,\r\n  Bankaad,Olustarsaat,Olususer,Degtarsaat,DegUser,\r\n  Remote_id,devir)\r\n\r\n  SELECT h.id,h.firmano,h.tarih,h.saat,h.vadetar,h.giren,h.cikan,h.kur,h.parabrm,\r\n  'POS İŞLEMLERİ','poshrk',('poshrkid'),h.poshrkid,\r\n  h.masterid,h.varno,h.varok,h.sil,h.yerad,h.yertip,\r\n  h.perkod,'',h.adaid,'',\r\n  h.islmtip,h.islmtipad,h.islmhrk,h.islmhrkad,\r\n  h.belno,h.ack,\r\n  h.poskod,\r\n  h.carkod,h.cartip,\r\n  ('') as kaskod,('') as kasad,\r\n  h.bankod,'',\r\n  h.olustarsaat,h.olususer,H.degtarsaat,H.deguser,\r\n  h.remote_id,h.devir\r\n  from poshrk as h\r\n  where h.masterid=0\r\n  and h.firmano in (select * from @Firma_TEMP)\r\n  and h.sil in (select * from @SIL_TEMP)\r\n  and h.tarih>=@BASTAR and h.tarih<=@BITTAR\r\n\r\n\r\n /*--cekkart */\r\n  insert into @TB_GENEL_HRK (id,firmano,Tarih,Saat,VadeTar,Giren,Cikan,Kur,Parabrm,\r\n  Grpad,Grptip,Hrkidad,Hrkid,Masterid,Varno,Varok,Sil,Yerad,Yertip,Perkod,\r\n  Perad,Adaid,AdaAd,tipkod,tipad,hrkkod,hrkad,BelNo,Ack,Kod,\r\n  CarKod,CarTip,Kasakod,KasaAd,Bankakod,\r\n  BankaAd,Olustarsaat,Olususer,Degtarsaat,DegUser,\r\n  Remote_id,devir)\r\n\r\n  select h.id,h.firmano,h.tarih,h.saat,h.vadetar,h.giren,h.cikan,h.kur,h.parabrm,\r\n  'ÇEK-SENET','cekkart','cekid',h.cekid,h.masterid,h.varno,h.varok,h.sil,\r\n  h.yerad,h.yertip,h.perkod,'',h.adaid,'',\r\n  h.islmtip,h.islmtipad,h.islmhrk,h.islmhrkad,ceksenno,ack,\r\n  h.refno,\r\n  case when h.islmhrk='ALN' then h.carkod\r\n  when islmhrk='KSN' then   h.vercarkod end,\r\n  case when h.islmhrk='ALN' then h.cartip\r\n  when islmhrk='KSN' then   h.vercartip end,\r\n  ('') as kaskod,('') as kasad,\r\n  ('') as bankod,(banka),\r\n  h.olustarsaat,h.olususer,H.degtarsaat,H.deguser,\r\n  h.remote_id,h.devir\r\n\r\n  from cekkart as h\r\n  where\r\n  h.firmano in (select * from @Firma_TEMP)\r\n  and h.sil in (select * from @SIL_TEMP)\r\n  and h.tarih>=@BASTAR and h.tarih<=@BITTAR\r\n  \r\n /*- banka hrk */\r\n  insert into @TB_GENEL_HRK (id,firmano,Tarih,Saat,VadeTar,Giren,Cikan,Kur,Parabrm,\r\n  Grpad,Grptip,Hrkidad,Hrkid,Masterid,Varno,Varok,Sil,Yerad,Yertip,Perkod,\r\n  Perad,Adaid,AdaAd,tipkod,tipad,hrkkod,hrkad,BelNo,Ack,Kod,\r\n  CarKod,CarTip,Kasakod,KasaAd,Bankakod,\r\n  BankaAd,Olustarsaat,Olususer,Degtarsaat,DegUser,\r\n  Entegre_aktar,Entegre_tip,\r\n  Remote_id,devir)\r\n  select h.id,h.firmano,h.tarih,h.saat,h.vadetar,h.borc,h.alacak,h.kur,h.parabrm,\r\n  'BANKA İŞLEMLERİ','bankahrk',('bankhrkid'),h.bankhrkid,h.masterid,\r\n  h.varno,h.varok,h.sil,h.yerad,h.yertip,\r\n  h.perkod,'',h.adaid,'',\r\n  h.islmtip,h.islmtipad,h.islmhrk,h.islmhrkad,\r\n  h.belno,h.ack,\r\n  h.bankod,h.carkod,h.cartip,h.kaskod,'',\r\n  h.bankod,'',\r\n  h.olustarsaat,h.olususer,h.degtarsaat,h.deguser,\r\n  Entegre_aktar,Entegre_tip,\r\n  h.Remote_id,h.devir\r\n  from bankahrk as h\r\n  where h.masterid=0\r\n  and h.firmano in (select * from @Firma_TEMP)\r\n  and h.sil in (select * from @SIL_TEMP)\r\n  and h.tarih>=@BASTAR and h.tarih<=@BITTAR\r\n  \r\n\r\n /*- cari hrk */\r\n  insert into @TB_GENEL_HRK (id,firmano,Tarih,Saat,VadeTar,Giren,Cikan,Kur,Parabrm,\r\n  Grpad,Grptip,Hrkidad,Hrkid,Masterid,Varno,Varok,Sil,Yerad,Yertip,Perkod,\r\n  Perad,Adaid,AdaAd,tipkod,tipad,hrkkod,hrkad,BelNo,Ack,Kod,\r\n  CarKod,CarTip,Kasakod,KasaAd,Bankakod,\r\n  BankaAd,Olustarsaat,Olususer,DegtarSaat,DegUser,\r\n  Entegre_aktar,Entegre_tip,\r\n  Remote_id,devir)\r\n  select h.id,h.firmano,h.tarih,h.saat,h.vadetar,h.borc,h.alacak,h.kur,h.parabrm,\r\n  'CARİ İŞLEMLER','carihrk',('carhrkid'),h.carhrkid,h.masterid,\r\n  h.varno,h.varok,h.sil,h.yerad,h.yertip,h.perkod,'',h.adaid,'',\r\n  h.islmtip,h.islmtipad,h.islmhrk,h.islmhrkad,\r\n  h.belno,h.ack,\r\n  h.carkod,h.carkod,h.cartip,'','',\r\n  '','',\r\n  h.olustarsaat,h.olususer,h.degtarsaat,h.deguser,\r\n  Entegre_aktar,Entegre_tip,\r\n  h.Remote_id,h.devir\r\n  from carihrk as h\r\n  where h.masterid=0 \r\n  and h.firmano in (select * from @Firma_TEMP)\r\n  and h.islmtip='MAH'\r\n  and h.sil in (select * from @SIL_TEMP)\r\n  and h.tarih>=@BASTAR and h.tarih<=@BITTAR\r\n  \r\n\r\n/*isletme k.k hrk */\r\n  insert into @TB_GENEL_HRK (id,firmano,Tarih,Saat,VadeTar,Giren,Cikan,Kur,Parabrm,\r\n  Grpad,Grptip,Hrkidad,Hrkid,Masterid,Varno,Varok,Sil,Yerad,Yertip,Perkod,\r\n  Perad,Adaid,AdaAd,tipkod,tipad,hrkkod,hrkad,BelNo,Ack,Kod,\r\n  CarKod,CarTip,Kasakod,KasaAd,Bankakod,\r\n  BankaAd,Olustarsaat,Olususer,DegtarSaat,DegUser,\r\n  Remote_id,devir)\r\n\r\n  select h.id,h.firmano,h.tarih,h.saat,h.vadetar,h.borc,h.alacak,h.kur,h.parabrm,\r\n  'İŞLETME KART İŞLEMLERİ','istkhrk',('istkhrkid'),h.istkhrkid,h.masterid,\r\n  h.varno,h.varok,h.sil,h.yerad,h.yertip,h.perkod,'',h.adaid,'',\r\n  h.islmtip,h.islmtipad,h.islmhrk,h.islmhrkad,\r\n  h.belno,h.ack,h.istkkod,h.carkod,h.cartip,\r\n  (''),('') ,(''),(''),\r\n  h.olustarsaat,h.olususer,h.degtarsaat,h.deguser,\r\n  h.remote_id,h.devir\r\n  from istkhrk as h\r\n  where h.masterid=0\r\n  and h.firmano in (select * from @Firma_TEMP)\r\n  and h.sil in (select * from @SIL_TEMP)\r\n  and h.tarih>=@BASTAR and h.tarih<=@BITTAR\r\n\r\n /*cari unvan */\r\n  update @TB_GENEL_HRK set Cartur=dt.tip,Unvan=dt.ad from @TB_GENEL_HRK as t\r\n  join (select kod,ad,cartp,tip from Genel_Kart ) dt\r\n  on dt.kod=t.CarKod and dt.cartp=t.cartip\r\n  \r\n/* kasa ad */\r\n  update @TB_GENEL_HRK set Kasaad=dt.ad from @TB_GENEL_HRK as t\r\n  join (select kod,ad from Kasakart as k ) dt\r\n  on dt.kod=t.kasakod\r\n  \r\n/* banka ad */\r\n  update @TB_GENEL_HRK set Bankaad=dt.ad from @TB_GENEL_HRK as t\r\n  join (select kod,ad from bankakart as k ) dt\r\n  on dt.kod=t.Bankakod\r\n  \r\n \r\n /* personel unvan */\r\n  update @TB_GENEL_HRK set perad=dt.ad from @TB_GENEL_HRK as t\r\n  join (select kod,(k.ad+' '+k.soyad) ad from Perkart as k ) dt\r\n  on dt.kod=t.perkod\r\n \r\n\r\n /* ada ad */\r\n  update @TB_GENEL_HRK set Adaad=dt.ad from @TB_GENEL_HRK as t\r\n  join (select id,ad from grup as k where k.tabload='sayackart') dt\r\n  on dt.id=t.adaid\r\n\r\n\r\n  update @TB_GENEL_HRK  set Ytlgiren=giren*kur,ytlcikan=cikan*kur\r\n\r\n  \r\n  \r\n  RETURN\r\n\r\n\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_GENEL_ISTKKART",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_GENEL_ISTKKART",
    "definition": "CREATE FUNCTION [dbo].UDF_GENEL_ISTKKART (\r\n@TARIH1 DATETIME,\r\n@TARIH2 DATETIME)\r\nRETURNS\r\n  @TB_GENEL_ISTKKART TABLE (\r\n    KOD               VARCHAR(20)  COLLATE Turkish_CI_AS,\r\n    AD                VARCHAR(50)  COLLATE Turkish_CI_AS,\r\n    BORC              FLOAT,\r\n    ALACAK            FLOAT,\r\n    BAKIYE            FLOAT)\r\nAS\r\nBEGIN\r\n  INSERT @TB_GENEL_ISTKKART (KOD,AD,\r\n  BORC,ALACAK,BAKIYE)\r\n  select k.kod,k.ad,\r\n  isnull(sum(h.borc),0),\r\n  isnull(sum(h.alacak),0),\r\n  isnull(sum(h.borc-h.alacak),0)\r\n  FROM istkart as k\r\n  inner join istkhrk as h on k.kod=h.istkkod\r\n  and h.tarih>=@TARIH1 and h.tarih<=@TARIH2 and h.sil=0\r\n  and k.sil=0\r\n  group by k.kod,k.ad\r\n\r\n  RETURN\r\n\r\nend"
  },
  {
    "schema": "dbo",
    "name": "UDF_GENEL_KASAKART",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_GENEL_KASAKART",
    "definition": "CREATE FUNCTION [dbo].UDF_GENEL_KASAKART (\r\n@FIRMANO   INT,\r\n@TARIH1 DATETIME,\r\n@TARIH2 DATETIME)\r\nRETURNS\r\n  @TB_GENEL_KASAKART TABLE (\r\n    KOD               VARCHAR(20)  COLLATE Turkish_CI_AS,\r\n    AD                VARCHAR(50)  COLLATE Turkish_CI_AS,\r\n    DEVIR             FLOAT,\r\n    BORC              FLOAT,\r\n    ALACAK            FLOAT,\r\n    BAKIYE            FLOAT)\r\nAS\r\nBEGIN\r\n\r\n  IF @FIRMANO>0\r\n  INSERT @TB_GENEL_KASAKART (KOD,AD,\r\n  DEVIR,BORC,ALACAK,BAKIYE)\r\n  select k.kod,k.ad,\r\n  isnull((select sum(sh.giren-sh.cikan) from kasahrk as sh with (nolock)\r\n  where sh.kaskod=k.kod and sh.tarih<@TARIH1 and sh.sil=0 and sh.firmano=@FIRMANO\r\n  and ((sh.varno>0 and sh.varok=1) or (sh.varno=0)) ),0),\r\n  isnull(sum(h.cikan),0),\r\n  isnull(sum(h.giren),0),\r\n  0\r\n  /*isnull(sum(h.giren-h.cikan),0) */\r\n  FROM kasakart as k with (nolock)\r\n  inner join kasahrk as h with (nolock) on k.kod=h.kaskod\r\n  and k.sil=0 and h.tarih >=@TARIH1 and h.tarih<=@TARIH2 and h.sil=0\r\n  and h.firmano=@FIRMANO and  ((h.varno>0 and h.varok=1) or (h.varno=0))\r\n  group by k.kod,k.ad\r\n  else\r\n  INSERT @TB_GENEL_KASAKART (KOD,AD,\r\n  DEVIR,BORC,ALACAK,BAKIYE)\r\n  select k.kod,k.ad,\r\n  isnull((select sum(sh.giren-sh.cikan) from kasahrk as sh with (nolock)\r\n  where sh.kaskod=k.kod and sh.tarih<@TARIH1 and sh.sil=0\r\n  and ((sh.varno>0 and sh.varok=1) or (sh.varno=0)) ),0),\r\n  isnull(sum(h.cikan),0),\r\n  isnull(sum(h.giren),0),\r\n  0\r\n  /*isnull(sum(h.giren-h.cikan),0) */\r\n  FROM kasakart as k with (nolock)\r\n  inner join kasahrk as h with (nolock) on k.kod=h.kaskod\r\n  and k.sil=0 and h.tarih >=@TARIH1 and h.tarih<=@TARIH2 and h.sil=0\r\n  and  ((h.varno>0 and h.varok=1) or (h.varno=0))\r\n  group by k.kod,k.ad\r\n  \r\n  \r\n  \r\n  update @TB_GENEL_KASAKART set BAKIYE=DEVIR+ALACAK-BORC\r\n  \r\n  \r\n\r\n  RETURN\r\n\r\nend"
  },
  {
    "schema": "dbo",
    "name": "UDF_GENEL_PERKART",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_GENEL_PERKART",
    "definition": "CREATE FUNCTION [dbo].UDF_GENEL_PERKART (\r\n@TARIH1 DATETIME,\r\n@TARIH2 DATETIME)\r\nRETURNS\r\n  @TB_GENEL_PERKART TABLE (\r\n    KOD               VARCHAR(20)  COLLATE Turkish_CI_AS,\r\n    AD                VARCHAR(150)  COLLATE Turkish_CI_AS,\r\n    BORC              FLOAT,\r\n    ALACAK            FLOAT,\r\n    BAKIYE            FLOAT)\r\nAS\r\nBEGIN\r\n  INSERT @TB_GENEL_PERKART (KOD,AD,\r\n  BORC,ALACAK,BAKIYE)\r\n  select k.kod,k.ad+' '+k.soyad,\r\n  isnull(sum(h.borc),0),\r\n  isnull(sum(h.alacak),0),\r\n  isnull(sum(h.borc-h.alacak),0)\r\n  FROM perkart as k\r\n  inner join carihrk as h on k.kod=h.carkod and h.cartip='perkart'\r\n  and h.sil=0 and k.sil=0 and h.tarih>=@TARIH1 and h.tarih<=@TARIH2\r\n  group by k.kod,k.ad+' '+k.soyad\r\n\r\n  RETURN\r\n\r\nend"
  },
  {
    "schema": "dbo",
    "name": "UDF_GENEL_POSKART",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_GENEL_POSKART",
    "definition": "CREATE FUNCTION [dbo].UDF_GENEL_POSKART (\r\n@FIRMANO   INT,\r\n@TARIH1 DATETIME,\r\n@TARIH2 DATETIME)\r\nRETURNS\r\n  @TB_GENEL_POSKART TABLE (\r\n    KOD               VARCHAR(50)  COLLATE Turkish_CI_AS,\r\n    AD                VARCHAR(150)  COLLATE Turkish_CI_AS,\r\n    BEKLEYEN          FLOAT)\r\nAS\r\nBEGIN\r\n\r\n  IF @FIRMANO>0\r\n  INSERT @TB_GENEL_POSKART (KOD,AD,\r\n  BEKLEYEN)\r\n  select k.kod,k.ad,\r\n  isnull(sum(h.giren),0)\r\n  FROM poskart as k with (nolock)\r\n  inner join poshrk as h with (nolock) \r\n  on k.kod=h.poskod and h.firmano=@FIRMANO\r\n  and k.sil=0 and h.tarih>=@TARIH1 and h.tarih<=@TARIH2 and h.sil=0\r\n  group by k.kod,k.ad\r\n  else\r\n  INSERT @TB_GENEL_POSKART (KOD,AD,\r\n  BEKLEYEN)\r\n  select k.kod,k.ad,\r\n  isnull(sum(h.giren),0)\r\n  FROM poskart as k with (nolock)\r\n  inner join poshrk as h with (nolock) \r\n  on k.kod=h.poskod\r\n  and k.sil=0 and h.tarih>=@TARIH1 and h.tarih<=@TARIH2 and h.sil=0\r\n  group by k.kod,k.ad\r\n\r\n  RETURN\r\n\r\nend"
  },
  {
    "schema": "dbo",
    "name": "UDF_GETIR_BELGENO",
    "type": "SQL_SCALAR_FUNCTION",
    "full_name": "dbo.UDF_GETIR_BELGENO",
    "definition": "CREATE FUNCTION [dbo].UDF_GETIR_BELGENO (@TIP varchar(40),@SERI varchar(10))\r\nRETURNS VARCHAR(25) AS\r\nBEGIN\r\n\r\n  RETURN(\r\n    SELECT\r\n      seri + RIGHT('00000000000000000000' + CAST(numara + 1 AS VARCHAR(15)),uzunluk)\r\n    FROM  NUMARATOR WHERE tip = @TIP and seri=@SERI\r\n  )\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_GETIR_FISNO",
    "type": "SQL_SCALAR_FUNCTION",
    "full_name": "dbo.UDF_GETIR_FISNO",
    "definition": "CREATE FUNCTION [dbo].UDF_GETIR_FISNO (@TIP varchar(40))\r\nRETURNS VARCHAR(25) AS\r\nBEGIN\r\n\r\n  RETURN(\r\n    SELECT\r\n      seri + RIGHT('00000000000000000000' + CAST(numara + 1 AS VARCHAR(15)),uzunluk)\r\n    FROM  NUMARATOR\r\n    WHERE tip = @TIP\r\n  )\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_GUNLUK_BANKA",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_GUNLUK_BANKA",
    "definition": "CREATE FUNCTION [dbo].[UDF_GUNLUK_BANKA] \r\n(@FIRMA_NO       \tINT,\r\n @id\t\t\t   \tINT,\r\n @TARIH\t\t\t\tDATETIME)\r\nRETURNS\r\n\r\n  @TABLE_MIZAN TABLE (\r\n   ID\t\t\t\t\tint,\r\n   GRPNO\t\t\t\tint,\r\n   TIP_ACK\t\t\t\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n   EVRAK_ACK\t\t\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n   KART_KOD\t\t\t\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n   ACK\t\t\t\t\tVARCHAR(150) COLLATE Turkish_CI_AS,\r\n   ACK1\t\t\t\t\tVARCHAR(150) COLLATE Turkish_CI_AS,\r\n   BELGENO\t\t\t\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n   BORC\t\t\t\t    float,\r\n   ALACAK\t\t\t\tfloat)\r\n\r\nAS\r\nBEGIN\r\n\r\n\r\n  declare @grp1id \t \tint\r\n  declare @grp2id \t\tint\r\n\r\n  declare @KOD      \tvarchar(100)\r\n  declare @GRP_AD   \tvarchar(100)\r\n  declare @ACK1   \t    varchar(100)\r\n  declare @GRP_ID  \t\tfloat\r\n  declare @GRP_SR  \t\tint\r\n  \r\n  declare @BORC  \t\tfloat\r\n  declare @ALACAK  \t\tfloat\r\n  declare @BAKIYE  \t\tfloat\r\n\r\n  declare @ABAKIYE  \tfloat\r\n  declare @BBAKIYE  \tfloat  \r\n  \r\n  \r\n \r\n   \r\n\r\n       declare mas_cur CURSOR FAST_FORWARD  FOR \r\n       select id,sr,ad from grup with (nolock) where tabload='bankakart' and sil=0 \r\n         open mas_cur\r\n          fetch next from  mas_cur into @GRP_ID,@GRP_SR,@GRP_AD\r\n           while @@FETCH_STATUS=0\r\n            begin \r\n \r\n           if @FIRMA_NO>0 \r\n            declare gec_cur CURSOR FAST_FORWARD  FOR \r\n            select h.bankod,K.hesno,sum(h.borc),\r\n            sum(h.alacak) from\r\n            bankahrk as h with (NOLOCK)\r\n            inner join bankakart as k with (NOLOCK) on k.kod=h.bankod\r\n            and k.grp1=@GRP_ID and k.sil=0 and k.drm='Aktif'\r\n            where h.firmano=@FIRMA_NO  and  h.sil=0 and h.tarih<=@TARIH \r\n            group by h.bankod,K.hesno \r\n           else\r\n            declare gec_cur CURSOR FAST_FORWARD  FOR \r\n            select h.bankod,K.hesno,sum(h.borc),\r\n            sum(h.alacak) from\r\n            bankahrk as h with (NOLOCK)\r\n            inner join bankakart as k with (NOLOCK) on k.kod=h.bankod\r\n            and k.grp1=@GRP_ID and k.sil=0 and k.drm='Aktif'\r\n            where h.sil=0\r\n            and h.tarih<=@TARIH \r\n            group by h.bankod,K.hesno  \r\n            \r\n            \r\n            \r\n            \r\n             open gec_cur\r\n           fetch next from  gec_cur into @KOD,@ACK1,@BORC,@ALACAK\r\n           while @@FETCH_STATUS=0\r\n            begin\r\n            \r\n            set @BORC=ROUND(@BORC,2)\r\n            set @ALACAK=ROUND(@ALACAK,2)\r\n            \r\n            set @BBAKIYE=0\r\n            set @ABAKIYE=0\r\n            \r\n            SET @BAKIYE=@BORC-@ALACAK \r\n             \r\n             if @BAKIYE>0\r\n              set @BBAKIYE=@BAKIYE\r\n              \r\n             if @BAKIYE<0\r\n              set @ABAKIYE=-1*@BAKIYE\r\n                \r\n            \r\n            insert into @TABLE_MIZAN (ID,TIP_ACK,EVRAK_ACK,\r\n            KART_KOD,ACK,ACK1,BORC,ALACAK)\r\n              VALUES (@id,'BANKALAR',@KOD,@KOD,@KOD,@ACK1,\r\n              @BBAKIYE,@ABAKIYE)\r\n\r\n            set @id=@id+1  \r\n\r\n             FETCH next from  gec_cur into @KOD,@ACK1,@BORC,@ALACAK\r\n           end\r\n         close gec_cur\r\n         deallocate gec_cur\r\n         \r\n         \r\n          update @TABLE_MIZAN set ACK=dt.ad from @TABLE_MIZAN as t join\r\n          (select kod,ad from bankakart with (nolock) ) dt \r\n          on t.KART_KOD=dt.kod \r\n    \r\n       \r\n          FETCH next from  mas_cur into @GRP_ID,@GRP_SR,@GRP_AD\r\n         end\r\n        Close mas_cur\r\n        deallocate mas_cur      \r\n         \r\n         \r\n   \r\n    \r\n\r\n\r\nRETURN\r\n\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_GUNLUK_BORDRO_AKARYAKIT_SATIS",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_GUNLUK_BORDRO_AKARYAKIT_SATIS",
    "definition": "CREATE FUNCTION [dbo].[UDF_GUNLUK_BORDRO_AKARYAKIT_SATIS] (\r\n@FIRMANO INT,\r\n@TARIH1 DATETIME,\r\n@TARIH2 DATETIME)\r\nRETURNS\r\n  @TB_AKARYAKIT_SATIS TABLE (\r\n    STOK_KOD    VARCHAR(20)  COLLATE Turkish_CI_AS,\r\n    STOK_AD     VARCHAR(50)  COLLATE Turkish_CI_AS,\r\n    SATISMIKTAR         FLOAT,\r\n    BIRIMFIYAT\t\t\tFLOAT,\r\n    KDVYUZDE\t\t\tFLOAT,\r\n    SATISTUTAR          FLOAT,\r\n    KDVTUTAR            FLOAT)\r\nAS\r\nBEGIN\r\n\r\n  INSERT @TB_AKARYAKIT_SATIS (STOK_KOD,STOK_AD,\r\n  SATISMIKTAR,BIRIMFIYAT,KDVYUZDE,SATISTUTAR,KDVTUTAR)\r\n  select st.kod,st.ad,\r\n  isnull(sum(h.cikan),0),\r\n  isnull(sum((h.cikan*h.brmfiykdvli)/h.cikan),0),\r\n  max(h.kdvyuz*100),\r\n  isnull(sum(h.cikan*h.brmfiykdvli),0),\r\n  0 \r\n  FROM  stokkart as st with (nolock)\r\n  inner join stkhrk as h with (nolock) on st.kod=h.stkod and h.stktip=st.tip\r\n  and h.sil=0 and st.sil=0 and h.firmano=@FIRMANO\r\n  and h.tarih>=@TARIH1 and h.tarih<=@TARIH2\r\n  where st.tip='akykt' and h.cikan>0 and h.islmtip='POMSAYSAT'\r\n  group by st.kod,st.ad\r\n\r\n\r\n\r\n   update @TB_AKARYAKIT_SATIS set\r\n   KDVTUTAR=SATISTUTAR-(SATISTUTAR/(1+ case when KDVYUZDE>0 then KDVYUZDE/100 else 0 end ) )\r\n\r\n\r\n  RETURN\r\n\r\nend"
  },
  {
    "schema": "dbo",
    "name": "UDF_GUNLUK_BORDRO_NAKIT",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_GUNLUK_BORDRO_NAKIT",
    "definition": "CREATE FUNCTION [dbo].[UDF_GUNLUK_BORDRO_NAKIT] \r\n(@FIRMANO INT,\r\n@TARIH1 DATETIME,\r\n@TARIH2 DATETIME)\r\nRETURNS\r\n  @TB_GENEL_BORDRO TABLE (\r\n    FIS_NO              VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    CARITIP             VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    CARIKOD             VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    VERGINO             VARCHAR(50) COLLATE Turkish_CI_AS, \r\n    CARIUNVAN           VARCHAR(200) COLLATE Turkish_CI_AS,\r\n    TUTAR\t\t\t    FLOAT)\r\nAS\r\nBEGIN\r\n \r\n \r\n   insert into @TB_GENEL_BORDRO (FIS_NO,CARITIP,CARIKOD,CARIUNVAN,TUTAR) \r\n   SELECT k.belno,K.cartip,K.carkod,'',K.giren\r\n   From kasahrk as k with (nolock)  where k.tarih>=@TARIH1 and k.tarih<=@TARIH2 and k.Sil=0 \r\n   and ISNULL(cartip,'')='carikart'  and k.firmano=@FIRMANO AND K.giren>0\r\n   \r\n\r\n    UPDATE @TB_GENEL_BORDRO SET \r\n    CARIUNVAN=dt.Unvan,\r\n    VERGINO=dt.VergiKNo\r\n    from @TB_GENEL_BORDRO as t join \r\n    (Select cartip,kod,unvan,VergiKNo from Genel_Cari_Kart ) dt on \r\n    dt.kod=t.CARIKOD and dt.cartip=t.CARITIP\r\n\r\n\r\n\r\n  RETURN\r\n\r\nend"
  },
  {
    "schema": "dbo",
    "name": "UDF_GUNLUK_BORDRO_PERAKENDE_FATURA",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_GUNLUK_BORDRO_PERAKENDE_FATURA",
    "definition": "CREATE FUNCTION [dbo].[UDF_GUNLUK_BORDRO_PERAKENDE_FATURA] \r\n(@FIRMANO INT,\r\n@TARIH1 DATETIME,\r\n@TARIH2 DATETIME)\r\nRETURNS\r\n  @TB_GENEL_BORDRO TABLE (\r\n    FIS_NO              VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    CARITIP             VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    CARIKOD\t\t\t\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n    CARIUNVAN \t\t\tVARCHAR(200) COLLATE Turkish_CI_AS,\r\n    VERGINO\t\t\t\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n    TUTARKDVSIZ\t\t\tFLOAT,\r\n    KDVTUTAR        \tFLOAT,\r\n    TUTARKDVLI        \tFLOAT)\r\nAS\r\nBEGIN\r\n \r\n   \r\n   insert into @TB_GENEL_BORDRO (FIS_NO,CARITIP,CARIKOD,CARIUNVAN,VERGINO,TUTARKDVSIZ,KDVTUTAR,TUTARKDVLI) \r\n   SELECT v.fatseri+''+v.fatno,cartip,carkod,'','',\r\n   v.genel_net_top ,v.genel_kdv_top,v.genel_top\r\n   From faturamas as v with (nolock) where v.tarih>=@TARIH1 and v.tarih<=@TARIH2 and v.Sil=0 \r\n   and v.firmano=@FIRMANO and v.fattip='FATPERSAT'\r\n\r\n    UPDATE @TB_GENEL_BORDRO SET \r\n    CARIUNVAN=dt.Unvan,\r\n    VERGINO=dt.VergiKNo\r\n    from @TB_GENEL_BORDRO as t join \r\n    (Select cartip,kod,unvan,VergiKNo from Genel_Cari_Kart ) dt on \r\n    dt.kod=t.CARIKOD and t.CARITIP=dt.cartip\r\n\r\n\r\n\r\n  RETURN\r\n\r\nend"
  },
  {
    "schema": "dbo",
    "name": "UDF_GUNLUK_BORDRO_POS",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_GUNLUK_BORDRO_POS",
    "definition": "CREATE FUNCTION [dbo].[UDF_GUNLUK_BORDRO_POS] \r\n(@FIRMANO INT,\r\n@TARIH1 DATETIME,\r\n@TARIH2 DATETIME)\r\nRETURNS\r\n  @TB_GENEL_BORDRO TABLE (\r\n    FIS_NO              VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    POSKOD\t\t\t    VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    POSUNVAN\t\t\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n    CARITIP             VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    CARIKOD             VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    VERGINO             VARCHAR(50) COLLATE Turkish_CI_AS, \r\n    CARIUNVAN           VARCHAR(200) COLLATE Turkish_CI_AS,\r\n    TUTAR\t\t\t    FLOAT)\r\nAS\r\nBEGIN\r\n \r\n \r\n   insert into @TB_GENEL_BORDRO (FIS_NO,POSKOD,CARITIP,CARIKOD,CARIUNVAN,TUTAR) \r\n   SELECT k.belno,K.poskod,K.cartip,K.carkod,'',K.giren\r\n   From poshrk as k with (nolock)  where k.tarih>=@TARIH1 and k.tarih<=@TARIH2 and k.Sil=0 \r\n   and ISNULL(cartip,'')<>''  and k.firmano=@FIRMANO \r\n   \r\n   \r\n   \r\n    UPDATE @TB_GENEL_BORDRO SET \r\n    POSUNVAN=dt.AD\r\n    from @TB_GENEL_BORDRO as t join \r\n    (Select kod,ad from poskart ) dt on \r\n    dt.kod=t.POSKOD\r\n   \r\n\r\n    UPDATE @TB_GENEL_BORDRO SET \r\n    CARIUNVAN=dt.Unvan,\r\n    VERGINO=dt.VergiKNo\r\n    from @TB_GENEL_BORDRO as t join \r\n    (Select cartip,kod,unvan,VergiKNo from Genel_Cari_Kart ) dt on \r\n    dt.kod=t.CARIKOD\r\n\r\n\r\n\r\n  RETURN\r\n\r\nend"
  },
  {
    "schema": "dbo",
    "name": "UDF_GUNLUK_BORDRO_VERESIYE",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_GUNLUK_BORDRO_VERESIYE",
    "definition": "CREATE FUNCTION [dbo].[UDF_GUNLUK_BORDRO_VERESIYE] \r\n(@FIRMANO INT,\r\n@TARIH1 DATETIME,\r\n@TARIH2 DATETIME,\r\n@Tip    int)\r\nRETURNS\r\n  @TB_GENEL_BORDRO TABLE (\r\n    FIS_NO              VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    CARITIP             VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    CARIKOD\t\t\t\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n    CARIUNVAN \t\t\tVARCHAR(200) COLLATE Turkish_CI_AS,\r\n    VERGINO\t\t\t\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n    TUTARKDVSIZ\t\t\tFLOAT,\r\n    KDVTUTAR        \tFLOAT,\r\n    TUTARKDVLI        \tFLOAT)\r\nAS\r\nBEGIN\r\n \r\n\r\n    DECLARE @TEMP TABLE (\r\n    VER_ID\t\t\t\tINT,\r\n    CARTIP              VARCHAR(30)  COLLATE Turkish_CI_AS,\r\n    CARKOD     \t\t    VARCHAR(50)  COLLATE Turkish_CI_AS,\r\n    STKTIP  \t\t    VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    STKKOD     \t\t    VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    TARIH       \t\tDATETIME,\r\n    SIL\t\t\t\t\tBIT DEFAULT 0)\r\n\r\n\r\n   insert @TEMP (VER_ID,CARTIP,CARKOD,STKTIP,STKKOD,TARIH)\r\n   Select h.Verid,v.cartip,v.carkod,h.Stktip,h.Stkod,v.tarih \r\n   from Veresihrk as h with (nolock) \r\n   inner join veresimas as v with (nolock) on \r\n   v.verid=h.verid and  v.sil=0 and h.sil=0\r\n   where v.tarih>=@TARIH1 and v.tarih<=@TARIH2 \r\n   and v.firmano=@FIRMANO \r\n\r\n\r\n   update @TEMP SET SIL=1 FROM @TEMP AS T \r\n   JOIN (SELECT VER_ID FROM @TEMP AS  T \r\n   INNER JOIN Cari_Fat_Urun_Iskonto as I on I.Car_Kod=T.CARKOD \r\n   and I.Stk_Kod=T.STKKOD AND T.STKTIP=I.StkTip ) DT ON \r\n   DT.VER_ID=T.VER_ID\r\n\r\n\r\n\r\n   if @Tip=1\r\n     insert into @TB_GENEL_BORDRO (FIS_NO,CARITIP,CARIKOD,CARIUNVAN,VERGINO,TUTARKDVSIZ,KDVTUTAR,TUTARKDVLI) \r\n     SELECT v.seri+''+v.no,cartip,carkod,'','',\r\n     Genel_KdvliToplam-Genel_KdvToplam,Genel_KdvToplam,Genel_KdvliToplam\r\n     From veresimas as v with (nolock)  \r\n     where v.tarih>=@TARIH1 and v.tarih<=@TARIH2 and v.Sil=0 and isnull(v.hrk_stk_pro,0)=0\r\n     and v.firmano=@FIRMANO and v.verid in (Select VER_ID FROM @TEMP WHERE SIL=0 GROUP BY VER_ID)\r\n    \r\n   \r\n   \r\n    \r\n   if @Tip=2\r\n     insert into @TB_GENEL_BORDRO (FIS_NO,CARITIP,CARIKOD,CARIUNVAN,VERGINO,TUTARKDVSIZ,KDVTUTAR,TUTARKDVLI) \r\n     SELECT v.seri+''+v.no,cartip,carkod,'','',\r\n     Genel_KdvliToplam-Genel_KdvToplam,Genel_KdvToplam,Genel_KdvliToplam\r\n     From veresimas as v with (nolock)  \r\n     where v.tarih>=@TARIH1 and v.tarih<=@TARIH2 and v.Sil=0 and isnull(v.hrk_stk_pro,0)=1\r\n     and v.firmano=@FIRMANO and v.verid in (Select VER_ID FROM @TEMP WHERE SIL=0 GROUP BY VER_ID)\r\n    \r\n   \r\n   \r\n   \r\n   \r\n\r\n    UPDATE @TB_GENEL_BORDRO SET \r\n    CARIUNVAN=dt.Unvan,\r\n    VERGINO=dt.VergiKNo\r\n    from @TB_GENEL_BORDRO as t join \r\n    (Select cartip,kod,unvan,VergiKNo from Genel_Cari_Kart ) dt on \r\n    dt.kod=t.CARIKOD\r\n\r\n\r\n\r\n  RETURN\r\n\r\nend"
  },
  {
    "schema": "dbo",
    "name": "UDF_GUNLUK_BORDRO_VERESIYE_DONUSUM",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_GUNLUK_BORDRO_VERESIYE_DONUSUM",
    "definition": "create FUNCTION [dbo].[UDF_GUNLUK_BORDRO_VERESIYE_DONUSUM] \r\n(@FIRMANO INT,\r\n@TARIH1 DATETIME,\r\n@TARIH2 DATETIME)\r\nRETURNS\r\n  @TB_GENEL_BORDRO TABLE (\r\n    VER_ID\t\t\t\tINT,\r\n    FIS_NO              VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    CARITIP             VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    CARIKOD\t\t\t\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n    CARIUNVAN \t\t\tVARCHAR(200) COLLATE Turkish_CI_AS,\r\n    VERGINO\t\t\t\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n    TUTARKDVSIZ\t\t\tFLOAT,\r\n    KDVTUTAR        \tFLOAT,\r\n    TUTARKDVLI        \tFLOAT,\r\n    SIL                 BIT)\r\nAS\r\nBEGIN\r\n   \r\n    DECLARE @TEMP TABLE (\r\n    VER_ID\t\t\t\tINT,\r\n    CARTIP              VARCHAR(30)  COLLATE Turkish_CI_AS,\r\n    CARKOD     \t\t    VARCHAR(50)  COLLATE Turkish_CI_AS,\r\n    STKTIP  \t\t    VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    STKKOD     \t\t    VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    TARIH       \t\tDATETIME,\r\n    SIL\t\t\t\t\tBIT DEFAULT 1)\r\n    \r\n   \r\n\r\n\r\n   insert @TEMP (VER_ID,CARTIP,CARKOD,STKTIP,STKKOD,TARIH)\r\n   Select h.Verid,v.cartip,v.carkod,h.Stktip,h.Stkod,v.tarih \r\n   from Veresihrk as h with (nolock) \r\n   inner join veresimas as v with (nolock) on \r\n   v.verid=h.verid and  v.sil=0 and h.sil=0\r\n   where v.tarih>=@TARIH1 and v.tarih<=@TARIH2 \r\n   and v.firmano=@FIRMANO \r\n  \r\n   \r\n   update @TEMP SET SIL=0 FROM @TEMP AS T \r\n   JOIN (SELECT VER_ID FROM @TEMP AS  T \r\n   INNER JOIN Cari_Fat_Urun_Iskonto as I on I.Car_Kod=T.CARKOD \r\n   and I.Stk_Kod=T.STKKOD AND T.STKTIP=I.StkTip ) DT ON \r\n   DT.VER_ID=T.VER_ID\r\n     \r\n   \r\n   insert into @TB_GENEL_BORDRO (VER_ID,FIS_NO,CARITIP,CARIKOD,CARIUNVAN,VERGINO,TUTARKDVSIZ,KDVTUTAR,TUTARKDVLI) \r\n   SELECT v.verid,v.seri+''+v.no,cartip,carkod,'','',\r\n   Genel_KdvliToplam-Genel_KdvToplam,Genel_KdvToplam,Genel_KdvliToplam\r\n   From veresimas as v with (nolock)  where v.verid in (Select VER_ID FROM @TEMP WHERE SIL=0 GROUP BY VER_ID)\r\n   \r\n   \r\n   \r\n   \r\n \r\n\r\n    UPDATE @TB_GENEL_BORDRO SET \r\n    CARIUNVAN=dt.Unvan,\r\n    VERGINO=dt.VergiKNo\r\n    from @TB_GENEL_BORDRO as t join \r\n    (Select cartip,kod,unvan,VergiKNo from Genel_Cari_Kart ) dt on \r\n    dt.kod=t.CARIKOD\r\n\r\n\r\n\r\n  RETURN\r\n\r\nend"
  },
  {
    "schema": "dbo",
    "name": "UDF_GUNLUK_BORDRO_VERESIYE_FATURA",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_GUNLUK_BORDRO_VERESIYE_FATURA",
    "definition": "CREATE FUNCTION [dbo].[UDF_GUNLUK_BORDRO_VERESIYE_FATURA] \r\n(@FIRMANO INT,\r\n@TARIH1 DATETIME,\r\n@TARIH2 DATETIME)\r\nRETURNS\r\n  @TB_GENEL_BORDRO TABLE (\r\n    FIS_NO              VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    CARITIP             VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    CARIKOD\t\t\t\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n    CARIUNVAN \t\t\tVARCHAR(200) COLLATE Turkish_CI_AS,\r\n    VERGINO\t\t\t\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n    TUTARKDVSIZ\t\t\tFLOAT,\r\n    KDVTUTAR        \tFLOAT,\r\n    TUTARKDVLI        \tFLOAT)\r\nAS\r\nBEGIN\r\n \r\n   \r\n   insert into @TB_GENEL_BORDRO (FIS_NO,CARITIP,CARIKOD,CARIUNVAN,VERGINO,TUTARKDVSIZ,KDVTUTAR,TUTARKDVLI) \r\n   SELECT v.fatseri+''+v.fatno,cartip,carkod,'','',\r\n   v.genel_net_top ,v.genel_kdv_top,v.genel_top\r\n   From faturamas as v with (nolock) where v.tarih>=@TARIH1 and v.tarih<=@TARIH2 and v.Sil=0 \r\n   and v.firmano=@FIRMANO and v.fattip='FATVERSAT'\r\n\r\n    UPDATE @TB_GENEL_BORDRO SET \r\n    CARIUNVAN=dt.Unvan,\r\n    VERGINO=dt.VergiKNo\r\n    from @TB_GENEL_BORDRO as t join \r\n    (Select cartip,kod,unvan,VergiKNo from Genel_Cari_Kart ) dt on \r\n    dt.kod=t.CARIKOD\r\n\r\n\r\n\r\n  RETURN\r\n\r\nend"
  },
  {
    "schema": "dbo",
    "name": "UDF_GUNLUK_BORDRO_ZRAPOR",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_GUNLUK_BORDRO_ZRAPOR",
    "definition": "CREATE FUNCTION [dbo].[UDF_GUNLUK_BORDRO_ZRAPOR] \r\n(@FIRMANO INT,\r\n@TARIH1 DATETIME,\r\n@TARIH2 DATETIME)\r\nRETURNS\r\n  @TB_GENEL_BORDRO TABLE (\r\n    FIS_NO              VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    ACK       \t\t\tVARCHAR(100) COLLATE Turkish_CI_AS,\r\n    TUTARKDVSIZ\t\t\tFLOAT,\r\n    KDVTUTAR        \tFLOAT,\r\n    TUTARKDVLI        \tFLOAT)\r\nAS\r\nBEGIN\r\n \r\n \r\n   insert into @TB_GENEL_BORDRO (FIS_NO,ACK,TUTARKDVSIZ,KDVTUTAR,TUTARKDVLI) \r\n   SELECT z.zseri+''+z.zserino,ykkod,Genel_Ara_Top,Genel_Kdv_Top,Genel_Top\r\n   From Zrapormas as z with (nolock)  where z.tarih>=@TARIH1 and z.tarih<=@TARIH2 and z.Sil=0 \r\n   and z.firmano=@FIRMANO \r\n   \r\n\r\n    UPDATE @TB_GENEL_BORDRO SET ACK=dt.ad from @TB_GENEL_BORDRO as t join \r\n    (Select kod,ad from yazarkasakart ) dt on dt.kod=t.ack\r\n\r\n\r\n\r\n  RETURN\r\n\r\nend"
  },
  {
    "schema": "dbo",
    "name": "UDF_GUNLUK_CEK_SENET",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_GUNLUK_CEK_SENET",
    "definition": "CREATE FUNCTION [dbo].UDF_GUNLUK_CEK_SENET (\r\n@FIRMA_NO       INT,\r\n@id\t\t\t   \tINT,\r\n@TARIH\t\t\tDATETIME,\r\n@TIP\t\t\tINT)\r\nRETURNS\r\n   @TABLE_MIZAN TABLE (\r\n   ID\t\t\t\t\tint,\r\n   GRPNO\t\t\t\tint,\r\n   TIP_ACK\t\t\t\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n   EVRAK_ACK\t\t\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n   KART_KOD\t\t\t\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n   ACK\t\t\t\t\tVARCHAR(150) COLLATE Turkish_CI_AS,\r\n   ACK1\t\t\t\t\tVARCHAR(150) COLLATE Turkish_CI_AS,\r\n   BELGENO\t\t\t\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n   BORC\t\t\t\t    float,\r\n   ALACAK\t\t\t\tfloat)\r\n\r\nAS\r\nBEGIN\r\n   \r\n  declare @grp1id \t \tint\r\n  declare @grp2id \t\tint\r\n\r\n  DECLARE @masid \t\tint\t\r\n  declare @KOD      \tvarchar(100)\r\n  declare @CARTIP      \tvarchar(30)\r\n    \r\n  declare @GRP_KOD   \tvarchar(50)\r\n  declare @BelgeNo   \tvarchar(50)\r\n  declare @ACK1   \t    varchar(50)\r\n  declare @GRP_AD   \tvarchar(100)\r\n  declare @GRP_ID  \t\tfloat\r\n  declare @GRP_SR  \t\tint\r\n  \r\n  declare @BORC  \t\tfloat\r\n  declare @ALACAK  \t\tfloat\r\n  declare @BAKIYE  \t\tfloat\r\n\r\n  declare @ABAKIYE  \tfloat\r\n  declare @BBAKIYE  \tfloat  \r\n  \r\n  \r\n     if @TIP=1  \r\n     begin\r\n      if @FIRMA_NO>0   \r\n      declare mas_cur CURSOR FAST_FORWARD  FOR \r\n        select cekid,\r\n        case \r\n        when islmhrk='ALN' THEN cartip \r\n        when islmhrk='KSN' THEN vercartip\r\n        END,\r\n        case \r\n        when islmhrk='ALN' THEN carkod \r\n        when islmhrk='KSN' THEN vercarkod \r\n        END,\r\n        m.giren,m.cikan,m.ceksenno,M.banka\r\n        from cekkart as m with (nolock)  \r\n        where m.sil=0 and m.firmano=@FIRMA_NO\r\n        and m.vadetar = @TARIH \r\n        and m.sonuc=1 and m.drm not in ('PID','CIR')\r\n      else\r\n        declare mas_cur CURSOR FAST_FORWARD  FOR \r\n        select cekid,\r\n        case \r\n        when islmhrk='ALN' THEN cartip \r\n        when islmhrk='KSN' THEN vercartip\r\n        END,\r\n        case \r\n        when islmhrk='ALN' THEN carkod \r\n        when islmhrk='KSN' THEN vercarkod \r\n        END,\r\n        m.giren,m.cikan,m.ceksenno,M.banka\r\n        from cekkart as m with (nolock) where \r\n        m.sil=0 \r\n        and m.vadetar = @TARIH \r\n        and m.sonuc=1 and m.drm not in ('PID','CIR')\r\n     end   \r\n        \r\n        \r\n       if @TIP=0\r\n       begin\r\n       if @FIRMA_NO>0  \r\n        declare mas_cur CURSOR FAST_FORWARD  FOR \r\n        select cekid,\r\n        case \r\n        when islmhrk='ALN' THEN cartip \r\n        when islmhrk='KSN' THEN vercartip\r\n        END,\r\n        case \r\n        when islmhrk='ALN' THEN carkod \r\n        when islmhrk='KSN' THEN vercarkod \r\n        END,\r\n        m.giren,m.cikan,m.ceksenno,M.banka\r\n        from cekkart as m with (nolock) \r\n        where m.sil=0 and m.firmano=@FIRMA_NO\r\n        and m.vadetar <= @TARIH\r\n         and m.sonuc=0 and m.drm not in ('PID','CIR')\r\n       else\r\n        declare mas_cur CURSOR FAST_FORWARD  FOR \r\n        select cekid,\r\n        case \r\n        when islmhrk='ALN' THEN cartip \r\n        when islmhrk='KSN' THEN vercartip\r\n        END,\r\n        case \r\n        when islmhrk='ALN' THEN carkod \r\n        when islmhrk='KSN' THEN vercarkod \r\n        END,\r\n        m.giren,m.cikan,m.ceksenno,M.banka\r\n        from cekkart as m with (nolock) where \r\n        m.sil=0 and m.vadetar <= @TARIH\r\n         and m.sonuc=0 and m.drm not in ('PID','CIR') \r\n         \r\n         \r\n         \r\n       end \r\n        \r\n        \r\n         open mas_cur\r\n          fetch next from  mas_cur into \r\n          @masid,@CARTIP,@KOD,@BORC,@ALACAK,@BelgeNo,@ACK1\r\n           while @@FETCH_STATUS=0\r\n            begin \r\n      \r\n      \r\n            set @BORC=ROUND(@BORC,2)\r\n            set @ALACAK=ROUND(@ALACAK,2)\r\n            \r\n            set @BBAKIYE=0\r\n            set @ABAKIYE=0\r\n            \r\n            SET @BAKIYE=@BORC-@ALACAK \r\n             \r\n             if @BAKIYE>0\r\n              set @BBAKIYE=@BAKIYE\r\n              \r\n             if @BAKIYE<0\r\n              set @ABAKIYE=-1*@BAKIYE\r\n                \r\n            \r\n              insert into @TABLE_MIZAN (ID,\r\n              TIP_ACK,EVRAK_ACK,KART_KOD,ACK,ACK1,\r\n              BELGENO,BORC,ALACAK)\r\n              VALUES (@id,\r\n              'ÇEKLER',@GRP_AD,@CARTIP,@KOD,@ACK1,\r\n              @BelgeNo,@BORC,@ALACAK)\r\n\r\n            set @id=@id+1  \r\n\r\n                    \r\n               \r\n       \r\n         fetch next from  mas_cur into \r\n          @masid,@CARTIP,@KOD,@BORC,@ALACAK,@BelgeNo,@ACK1\r\n         end\r\n        Close mas_cur\r\n        deallocate mas_cur   \r\n   \r\n    \r\n        update @TABLE_MIZAN set ACK=dt.ad+' / '+t.BELGENO \r\n        from @TABLE_MIZAN as t join\r\n        (select cartp,kod,ad from Genel_Kart ) dt \r\n        on t.KART_KOD=dt.cartp and t.ACK=dt.kod\r\n      \r\n    \r\n\r\n\r\nRETURN\r\n\r\n\r\n\r\n\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_GUNLUK_KASA",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_GUNLUK_KASA",
    "definition": "CREATE FUNCTION [dbo].[UDF_GUNLUK_KASA] \r\n(@FIRMA_NO       \tINT,\r\n @id\t\t\t   \tINT,\r\n @TARIH\t\t\t\tDATETIME)\r\nRETURNS\r\n\r\n  @TABLE_MIZAN TABLE (\r\n   ID\t\t\t\t\tint,\r\n   GRPNO\t\t\t\tint,\r\n   TIP_ACK\t\t\t\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n   EVRAK_ACK\t\t\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n   KART_KOD\t\t\t\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n   ACK\t\t\t\t\tVARCHAR(150) COLLATE Turkish_CI_AS,\r\n   ACK1\t\t\t\t\tVARCHAR(150) COLLATE Turkish_CI_AS,   \r\n   BELGENO\t\t\t\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n   BORC\t\t\t\t    float,\r\n   ALACAK\t\t\t\tfloat)\r\n\r\n\r\nAS\r\nBEGIN\r\n\r\n\r\n  declare @grp1id \t \tint\r\n  declare @grp2id \t\tint\r\n\r\n  declare @KOD      \tvarchar(100)\r\n  declare @GRP_AD   \tvarchar(100)\r\n  declare @EVK_AD   \tvarchar(100)\r\n  declare @GRP_ID  \t\tfloat\r\n  declare @GRP_SR  \t\tint\r\n  \r\n  declare @BORC  \t\tfloat\r\n  declare @ALACAK  \t\tfloat\r\n  declare @BAKIYE  \t\tfloat\r\n\r\n  declare @ABAKIYE  \tfloat\r\n  declare @BBAKIYE  \tfloat  \r\n  \r\n  \r\n \r\n      set @grp1id=@id\r\n    \r\n      declare mas_cur CURSOR FAST_FORWARD  FOR \r\n       select parabrm from kasakart with (nolock) where sil=0 group by parabrm\r\n         open mas_cur\r\n          fetch next from  mas_cur into @GRP_AD\r\n           while @@FETCH_STATUS=0\r\n            begin \r\n      \r\n          if @FIRMA_NO>0 \r\n            declare gec_cur CURSOR FAST_FORWARD  FOR \r\n            select h.kaskod,sum(h.giren*h.KUR),\r\n            sum(h.cikan*h.KUR) from\r\n            kasahrk as h with (nolock) \r\n            inner join kasakart as k with (nolock) on k.kod=h.kaskod\r\n            and k.parabrm=@GRP_AD and k.sil=0\r\n            where h.firmano=@FIRMA_NO and h.sil=0 and h.tarih<@TARIH \r\n            group by h.kaskod \r\n           else\r\n            declare gec_cur CURSOR FAST_FORWARD  FOR \r\n            select h.kaskod,sum(h.giren*h.KUR),\r\n            sum(h.cikan*h.KUR) from\r\n            kasahrk as h with (nolock) \r\n            inner join kasakart as k with (nolock) on k.kod=h.kaskod\r\n            and k.parabrm=@GRP_AD and k.sil=0\r\n            where h.sil=0\r\n            and h.tarih<@TARIH \r\n            group by h.kaskod \r\n            \r\n            \r\n            \r\n            \r\n            \r\n            /*\r\n             finas gosterme ve tek teslimat pasif se\r\n            \r\n            select sum(giren),sum(cikan) from kasahrk where tarih='2010-05-17'\r\n            and ((varno>0 and islmhrk='TES') or varno=0   ) and sil=0\r\n            \r\n            \r\n            */\r\n            \r\n            \r\n             open gec_cur\r\n          fetch next from  gec_cur into @KOD,\r\n          @BORC,@ALACAK\r\n           while @@FETCH_STATUS=0\r\n            begin\r\n            \r\n            set @BORC=ROUND(@BORC,2)\r\n            set @ALACAK=ROUND(@ALACAK,2)\r\n            \r\n            set @BBAKIYE=0\r\n            set @ABAKIYE=0\r\n            \r\n            SET @BAKIYE=@BORC-@ALACAK \r\n            \r\n           if @FIRMA_NO>0 \r\n             select @BAKIYE=@BAKIYE+sum(h.giren*h.KUR)\r\n            from kasahrk as h with (nolock) \r\n            where h.firmano=@FIRMA_NO and h.kaskod=@KOD \r\n            and h.tarih=@TARIH  and h.sil=0\r\n            group by h.kaskod \r\n           else \r\n            select @BAKIYE=@BAKIYE+sum(h.giren*h.KUR)\r\n            from kasahrk as h with (nolock) \r\n            where h.kaskod=@KOD\r\n            and h.tarih=@TARIH and h.sil=0 \r\n            group by h.kaskod \r\n            \r\n             \r\n             if @BAKIYE>0\r\n              set @BBAKIYE=@BAKIYE\r\n              \r\n             if @BAKIYE<0\r\n              set @ABAKIYE=-1*@BAKIYE\r\n            \r\n    \r\n            \r\n             insert into @TABLE_MIZAN (ID,TIP_ACK,EVRAK_ACK,KART_KOD,ACK,ACK1,\r\n             BORC,ALACAK)\r\n              VALUES (@id,'KASALAR',@EVK_AD,@KOD,@KOD,'-',@BBAKIYE,@ABAKIYE)\r\n\r\n             set @id=@id+1  \r\n\r\n             FETCH next from  gec_cur into @KOD,@BORC,@ALACAK\r\n           end\r\n         close gec_cur\r\n         deallocate gec_cur\r\n         \r\n           \r\n   \r\n       \r\n          FETCH next from  mas_cur into @GRP_AD\r\n         end\r\n        Close mas_cur\r\n        deallocate mas_cur      \r\n         \r\n        \r\n        \r\n        update @TABLE_MIZAN set ACK=dt.ad from @TABLE_MIZAN as t join\r\n         (select kod,ad as ad from kasakart with (nolock)  ) dt \r\n         on t.KART_KOD=dt.kod \r\n        \r\n        \r\n        \r\n         \r\n           \r\n    \r\n\r\n\r\nRETURN\r\n\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_GUNLUK_KASA_HRK",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_GUNLUK_KASA_HRK",
    "definition": "CREATE FUNCTION [dbo].[UDF_GUNLUK_KASA_HRK] \r\n(@FIRMA_NO       \tINT,\r\n @id\t\t\t   \tINT,\r\n @TARIH\t\t\t\tDATETIME)\r\nRETURNS\r\n\r\n  @TABLE_MIZAN TABLE (\r\n   ID\t\t\t\t\tint,\r\n   GRPNO\t\t\t\tint,\r\n   TIP_ACK\t\t\t\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n   EVRAK_ACK\t\t\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n   KART_KOD\t\t\t\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n   ACK\t\t\t\t\tVARCHAR(150) COLLATE Turkish_CI_AS,\r\n   ACK1\t\t\t\t\tVARCHAR(150) COLLATE Turkish_CI_AS,   \r\n   BELGENO\t\t\t\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n   BORC\t\t\t\t    float,\r\n   ALACAK\t\t\t\tfloat)\r\n\r\n\r\nAS\r\nBEGIN\r\n\r\n\r\n  declare @grp1id \t \tint\r\n  declare @grp2id \t\tint\r\n\r\n  declare @KOD      \tvarchar(100)\r\n  declare @GRP_AD   \tvarchar(100)\r\n  declare @EVK_AD   \tvarchar(100)\r\n  declare @GRP_ID  \t\tfloat\r\n  declare @GRP_SR  \t\tint\r\n  \r\n  declare @BORC  \t\tfloat\r\n  declare @ALACAK  \t\tfloat\r\n  declare @BAKIYE  \t\tfloat\r\n\r\n  declare @ABAKIYE  \tfloat\r\n  declare @BBAKIYE  \tfloat  \r\n  \r\n  \r\n \r\n      set @grp1id=@id\r\n    \r\n     if @FIRMA_NO>0\r\n      declare mas_cur CURSOR FAST_FORWARD  FOR \r\n       select parabrm from kasakart with (nolock) where firmano=@FIRMA_NO \r\n       and sil=0 group by parabrm\r\n     else\r\n       declare mas_cur CURSOR FAST_FORWARD  FOR \r\n        select parabrm from kasakart with (nolock) where sil=0 group by parabrm\r\n         \r\n         \r\n         \r\n         open mas_cur\r\n          fetch next from  mas_cur into @GRP_AD\r\n           while @@FETCH_STATUS=0\r\n            begin \r\n      \r\n           if @FIRMA_NO>0 \r\n            declare gec_cur CURSOR FAST_FORWARD  FOR \r\n            select h.kaskod,(h.giren*h.KUR),\r\n            (h.cikan*h.KUR),ack from\r\n            kasahrk as h with (nolock) \r\n            inner join kasakart as k with (nolock) on k.kod=h.kaskod\r\n            and k.parabrm=@GRP_AD and k.sil=0\r\n            where h.sil=0 and h.firmano=@FIRMA_NO\r\n            and h.tarih=@TARIH \r\n           else\r\n            declare gec_cur CURSOR FAST_FORWARD  FOR \r\n            select h.kaskod,(h.giren*h.KUR),\r\n            (h.cikan*h.KUR),ack from\r\n            kasahrk as h with (nolock) \r\n            inner join kasakart as k with (nolock) on k.kod=h.kaskod\r\n            and k.parabrm=@GRP_AD and k.sil=0\r\n            where h.sil=0\r\n            and h.tarih=@TARIH  \r\n             \r\n            \r\n            /*\r\n             finas gosterme ve tek teslimat pasif se\r\n            \r\n            select sum(giren),sum(cikan) from kasahrk where tarih='2010-05-17'\r\n            and ((varno>0 and islmhrk='TES') or varno=0   ) and sil=0\r\n            \r\n            \r\n            */\r\n            \r\n            \r\n             open gec_cur\r\n          fetch next from  gec_cur into @KOD,\r\n          @BORC,@ALACAK,@EVK_AD\r\n           while @@FETCH_STATUS=0\r\n            begin\r\n            \r\n            set @BORC=ROUND(@BORC,2)\r\n            set @ALACAK=ROUND(@ALACAK,2)\r\n            \r\n                  \r\n             insert into @TABLE_MIZAN (ID,TIP_ACK,EVRAK_ACK,KART_KOD,ACK,ACK1,\r\n             BORC,ALACAK)\r\n              VALUES (@id,'KASALAR',@EVK_AD,@KOD,@KOD,@EVK_AD,@BORC,@ALACAK)\r\n\r\n             set @id=@id+1  \r\n\r\n             FETCH next from  gec_cur into @KOD,@BORC,@ALACAK,@EVK_AD\r\n           end\r\n         close gec_cur\r\n         deallocate gec_cur\r\n         \r\n           \r\n   \r\n       \r\n          FETCH next from  mas_cur into @GRP_AD\r\n         end\r\n        Close mas_cur\r\n        deallocate mas_cur      \r\n         \r\n        \r\n        \r\n        update @TABLE_MIZAN set ACK=dt.ad from @TABLE_MIZAN as t join\r\n         (select kod,ad as ad from kasakart with (nolock) ) dt \r\n         on t.KART_KOD=dt.kod \r\n        \r\n        \r\n        \r\n         \r\n           \r\n    \r\n\r\n\r\nRETURN\r\n\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_GUNLUK_KASA_ODEME",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_GUNLUK_KASA_ODEME",
    "definition": "CREATE FUNCTION [dbo].[UDF_GUNLUK_KASA_ODEME] (\r\n@FIRMA_NO       INT,\r\n@id\t\t\t   \tINT,\r\n@TARIH\t\t\tDATETIME,\r\n@TIP\t\t\tINT,\r\n@FATGC\t\t\tINT)\r\nRETURNS\r\n   @TABLE_MIZAN TABLE (\r\n   ID\t\t\t\t\tint,\r\n   GRPNO\t\t\t\tint,\r\n   TIP_ACK\t\t\t\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n   EVRAK_ACK\t\t\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n   KART_KOD\t\t\t\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n   ACK\t\t\t\t\tVARCHAR(150) COLLATE Turkish_CI_AS,\r\n   ACK1\t\t\t\t\tVARCHAR(150) COLLATE Turkish_CI_AS,\r\n   BELGENO\t\t\t\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n   BORC\t\t\t\t    float,\r\n   ALACAK\t\t\t\tfloat)\r\n\r\nAS\r\nBEGIN\r\n   \r\n  declare @grp1id \t \tint\r\n  declare @grp2id \t\tint\r\n\r\n  DECLARE @masid \t\tint\t\r\n  declare @KOD      \tvarchar(100)\r\n  declare @CARTIP      \tvarchar(30)\r\n\r\n  declare @CARTIPAD      \tvarchar(50)\r\n    \r\n  declare @GRP_KOD   \tvarchar(50)\r\n  declare @BelgeNo   \tvarchar(50)\r\n  declare @ACK1   \t    varchar(50)\r\n  declare @GRP_AD   \tvarchar(100)\r\n  declare @GRP_ID  \t\tfloat\r\n  declare @GRP_SR  \t\tint\r\n  \r\n  declare @BORC  \t\tfloat\r\n  declare @ALACAK  \t\tfloat\r\n  declare @BAKIYE  \t\tfloat\r\n\r\n  declare @ABAKIYE  \tfloat\r\n  declare @BBAKIYE  \tfloat  \r\n  \r\n  \r\n      IF @TIP=1\r\n      begin\r\n      if @FIRMA_NO>0\r\n      declare mas_cur CURSOR FAST_FORWARD  FOR \r\n        select h.fatid,\r\n        h.cartip,h.carkod,\r\n        case when h.gctip=2 THEN \r\n        h.genel_top ELSE 0 END,\r\n        case when h.gctip=1 THEN \r\n        h.genel_top else 0 END,\r\n        h.fatseri+cast(h.fatno as varchar),h.ack\r\n        from faturamas as h with (nolock) where  \r\n        h.sil=0 and h.firmano=@FIRMA_NO\r\n        and h.vadtar= @TARIH \r\n        and h.cartip in ('carikart','perkart')\r\n        and h.gctip=@FATGC and (h.odeme>0)\r\n       else\r\n        declare mas_cur CURSOR FAST_FORWARD  FOR \r\n        select h.fatid,\r\n        h.cartip,h.carkod,\r\n        case when h.gctip=2 THEN \r\n        h.genel_top ELSE 0 END,\r\n        case when h.gctip=1 THEN \r\n        h.genel_top else 0 END,\r\n        h.fatseri+cast(h.fatno as varchar),h.ack\r\n        from faturamas as h with (nolock) where  \r\n        h.sil=0 \r\n        and h.vadtar= @TARIH \r\n        and h.cartip in ('carikart','perkart')\r\n        and h.gctip=@FATGC and (h.odeme>0) \r\n        \r\n        \r\n        \r\n      end  \r\n        \r\n               \r\n        \r\n       IF @TIP=0\r\n       begin\r\n        if @FIRMA_NO>0\r\n        declare mas_cur CURSOR FAST_FORWARD  FOR \r\n        select h.fatid,\r\n        h.cartip,h.carkod,\r\n        case when h.gctip=2 THEN \r\n        h.genel_top ELSE 0 END,\r\n        case when h.gctip=1 THEN \r\n        h.genel_top else 0 END,\r\n        h.fatseri+cast(h.fatno as varchar),h.ack\r\n        from faturamas as h with (nolock)  where  \r\n        h.sil=0 and h.firmano=@FIRMA_NO \r\n        and h.vadtar <= @TARIH \r\n        and h.cartip in ('carikart','perkart')\r\n        and h.gctip=@FATGC\r\n        and (h.odeme=0 or h.odeme is null ) \r\n        union all\r\n         select id,'perkart',kod,0,maas,\r\n         kod,'MAAS TAHAKKUK' \r\n         from perkart as k with (nolock) where k.firmano=@FIRMA_NO \r\n         and  k.drm='Aktif' and sil=0 and maasgun=DAY(@TARIH) \r\n       else\r\n        declare mas_cur CURSOR FAST_FORWARD  FOR \r\n        select h.fatid,\r\n        h.cartip,h.carkod,\r\n        case when h.gctip=2 THEN \r\n        h.genel_top ELSE 0 END,\r\n        case when h.gctip=1 THEN \r\n        h.genel_top else 0 END,\r\n        h.fatseri+cast(h.fatno as varchar),h.ack\r\n        from faturamas as h with (nolock)  where  \r\n        h.sil=0 \r\n        and h.vadtar <= @TARIH \r\n        and h.cartip in ('carikart','perkart')\r\n        and h.gctip=@FATGC\r\n        and (h.odeme=0 or h.odeme is null ) \r\n        union all\r\n         select id,'perkart',kod,0,maas,\r\n         kod,'MAAS TAHAKKUK' \r\n         from perkart as k with (nolock) where k.drm='Aktif'\r\n         and sil=0 and maasgun=DAY(@TARIH)   \r\n         \r\n       end \r\n                \r\n         open mas_cur\r\n          fetch next from  mas_cur into \r\n          @masid,@CARTIP,@KOD,@BORC,@ALACAK,@BelgeNo,@ACK1\r\n           while @@FETCH_STATUS=0\r\n            begin \r\n      \r\n      \r\n            set @BORC=ROUND(@BORC,2)\r\n            set @ALACAK=ROUND(@ALACAK,2)\r\n            \r\n            set @BBAKIYE=0\r\n            set @ABAKIYE=0\r\n            \r\n            SET @BAKIYE=@BORC-@ALACAK \r\n             \r\n             if @BAKIYE>0\r\n              set @BBAKIYE=@BAKIYE\r\n              \r\n             if @BAKIYE<0\r\n              set @ABAKIYE=-1*@BAKIYE\r\n              \r\n              \r\n              if @ACK1='' \r\n               set @ACK1=@BelgeNo\r\n              \r\n              if @CARTIP='carikart'\r\n               set @CARTIPAD='CARI KARTLAR'\r\n               \r\n              if @CARTIP='perkart'\r\n               set @CARTIPAD='PERSONEL KARTLAR'\r\n               \r\n              \r\n              \r\n                \r\n            \r\n              insert into @TABLE_MIZAN (ID,\r\n              TIP_ACK,EVRAK_ACK,KART_KOD,ACK,ACK1,\r\n              BELGENO,BORC,ALACAK)\r\n              VALUES (@id,\r\n              @CARTIPAD,@GRP_AD,@CARTIP,@KOD,@ACK1,\r\n              @BelgeNo,@BORC,@ALACAK)\r\n\r\n            set @id=@id+1  \r\n\r\n                    \r\n               \r\n       \r\n         fetch next from  mas_cur into \r\n          @masid,@CARTIP,@KOD,@BORC,@ALACAK,@BelgeNo,@ACK1\r\n         end\r\n        Close mas_cur\r\n        deallocate mas_cur   \r\n   \r\n    \r\n        update @TABLE_MIZAN set ACK=dt.ad\r\n        from @TABLE_MIZAN as t join\r\n        (select cartp,kod,ad from Genel_Kart ) dt \r\n        on t.KART_KOD=dt.cartp and t.ACK=dt.kod\r\n      \r\n    \r\n\r\n\r\nRETURN\r\n\r\n\r\n\r\n\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_GUNLUK_KREDIKART",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_GUNLUK_KREDIKART",
    "definition": "CREATE  FUNCTION [dbo].[UDF_GUNLUK_KREDIKART] (\r\n@FIRMA_NO       INT,\r\n@id\t\t\t   \tINT,\r\n@TARIH\t\t\tDATETIME)\r\nRETURNS\r\n   @TABLE_MIZAN TABLE (\r\n   ID\t\t\t\t\tint,\r\n   GRPNO\t\t\t\tint,\r\n   TIP_ACK\t\t\t\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n   EVRAK_ACK\t\t\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n   KART_KOD\t\t\t\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n   ACK\t\t\t\t\tVARCHAR(150) COLLATE Turkish_CI_AS,\r\n   ACK1\t\t\t\t\tVARCHAR(150) COLLATE Turkish_CI_AS,\r\n   BELGENO\t\t\t\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n   BORC\t\t\t\t    float,\r\n   ALACAK\t\t\t\tfloat)\r\n\r\nAS\r\nBEGIN\r\n   \r\n  declare @grp1id \t \tint\r\n  declare @grp2id \t\tint\r\n\r\n  DECLARE @masid \t\tint\t\r\n  declare @KOD      \tvarchar(100)\r\n  declare @CARTIP      \tvarchar(30)\r\n    \r\n  declare @GRP_KOD   \tvarchar(50)\r\n  declare @BelgeNo   \tvarchar(50)\r\n  declare @ACK1   \t    varchar(50)\r\n  declare @GRP_AD   \tvarchar(100)\r\n  declare @GRP_ID  \t\tfloat\r\n  declare @GRP_SR  \t\tint\r\n  \r\n  declare @BORC  \t\tfloat\r\n  declare @ALACAK  \t\tfloat\r\n  declare @BAKIYE  \t\tfloat\r\n\r\n  declare @ABAKIYE  \tfloat\r\n  declare @BBAKIYE  \tfloat  \r\n  \r\n  \r\n    if @FIRMA_NO>0\r\n      declare mas_cur CURSOR FAST_FORWARD  FOR \r\n        select h.istkhrkid,\r\n        'istkart',h.istkkod,\r\n        h.borc,h.alacak,\r\n        h.belno,h.istkkod\r\n        from istkhrk as h with (nolock)  where  \r\n        h.sil=0 and h.firmano=@FIRMA_NO\r\n        and h.vadetar = @TARIH \r\n        and h.alacak>0\r\n     else\r\n       declare mas_cur CURSOR FAST_FORWARD  FOR \r\n        select h.istkhrkid,\r\n        'istkart',h.istkkod,\r\n        h.borc,h.alacak,\r\n        h.belno,h.istkkod\r\n        from istkhrk as h with (nolock)  where  \r\n        h.sil=0 \r\n        and h.vadetar = @TARIH \r\n        and h.alacak>0   \r\n                \r\n         open mas_cur\r\n          fetch next from  mas_cur into \r\n          @masid,@CARTIP,@KOD,@BORC,@ALACAK,@BelgeNo,@ACK1\r\n           while @@FETCH_STATUS=0\r\n            begin \r\n      \r\n      \r\n            set @BORC=ROUND(@BORC,2)\r\n            set @ALACAK=ROUND(@ALACAK,2)\r\n            \r\n            set @BBAKIYE=0\r\n            set @ABAKIYE=0\r\n            \r\n            SET @BAKIYE=@BORC-@ALACAK \r\n             \r\n             if @BAKIYE>0\r\n              set @BBAKIYE=@BAKIYE\r\n              \r\n             if @BAKIYE<0\r\n              set @ABAKIYE=-1*@BAKIYE\r\n                \r\n            \r\n              insert into @TABLE_MIZAN (ID,\r\n              TIP_ACK,EVRAK_ACK,KART_KOD,ACK,ACK1,\r\n              BELGENO,BORC,ALACAK)\r\n              VALUES (@id,\r\n              'KREDİ KARTI',@GRP_AD,@CARTIP,@KOD,@ACK1,\r\n              @BelgeNo,@BORC,@ALACAK)\r\n\r\n            set @id=@id+1  \r\n\r\n                    \r\n               \r\n       \r\n         fetch next from  mas_cur into \r\n          @masid,@CARTIP,@KOD,@BORC,@ALACAK,@BelgeNo,@ACK1\r\n         end\r\n        Close mas_cur\r\n        deallocate mas_cur   \r\n   \r\n    \r\n        update @TABLE_MIZAN set ACK=dt.ad\r\n        from @TABLE_MIZAN as t join\r\n        (select cartp,kod,ad from Genel_Kart ) dt \r\n        on t.KART_KOD=dt.cartp and t.ACK=dt.kod\r\n      \r\n    \r\n\r\n\r\nRETURN\r\n\r\n\r\n\r\n\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_GUNLUK_POM_VAR_OZET",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_GUNLUK_POM_VAR_OZET",
    "definition": "CREATE FUNCTION [dbo].[UDF_GUNLUK_POM_VAR_OZET]\r\n(@FIRMANO     INT,\r\n@VARIN\t\t  VARCHAR(4000))\r\nRETURNS\r\n    @TB_VAR_LITRE_ARAC TABLE (\r\n    TARIH\t\t      \tdatetime,\r\n    STOK_TIP\t\t\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n    STOK_KOD\t\t\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n    STOK_AD\t\t\t\tVARCHAR(100) COLLATE Turkish_CI_AS,\r\n    SATIS_LT\t\t\tFLOAT,\r\n    ARAC_SAYI\t\t\tFLOAT,\r\n    VERESIYE_LT\t\t\tFLOAT,\r\n    VERESIYE_TUT\t\tFLOAT,\r\n    SATIS_TUT     \t\tFLOAT)\r\nAS\r\nBEGIN\r\n   \r\n   if @FIRMANO>0\r\n   INSERT @TB_VAR_LITRE_ARAC (TARIH,STOK_TIP,STOK_KOD,STOK_AD,\r\n   SATIS_LT,ARAC_SAYI,VERESIYE_LT,VERESIYE_TUT,SATIS_TUT)\r\n   select MAX(ot.tarih),'akykt',ot.stkod,'',\r\n   round( sum(ot.miktar),3),count(ot.miktar),\r\n   sum(case when sattip='Veresiye' then ot.miktar else 0 end),\r\n   sum(case when sattip='Veresiye' then ot.tutar else 0 end),\r\n   sum(ot.tutar)   \r\n   FROM  otomasoku as ot with (nolock) \r\n   where ot.firmano=@FIRMANO and ot.varno in (select * from CsvToInt(@VARIN))\r\n   group by ot.stkod\r\n   else\r\n   INSERT @TB_VAR_LITRE_ARAC (TARIH,STOK_TIP,STOK_KOD,STOK_AD,\r\n   SATIS_LT,ARAC_SAYI,VERESIYE_LT,VERESIYE_TUT,SATIS_TUT)\r\n   select MAX(ot.tarih),'akykt',ot.stkod,'',\r\n   round( sum(ot.miktar),3),count(ot.miktar),\r\n   sum(case when sattip='Veresiye' then ot.miktar else 0 end),\r\n   sum(case when sattip='Veresiye' then ot.tutar else 0 end),\r\n   sum(ot.tutar)   \r\n   FROM  otomasoku as ot with (nolock) \r\n   where ot.varno in (select * from CsvToInt(@VARIN))\r\n   group by ot.stkod\r\n   \r\n     \r\n   \r\n   \r\n   update @TB_VAR_LITRE_ARAC set STOK_AD=dt.ad\r\n   from @TB_VAR_LITRE_ARAC as t join\r\n   (select tip,kod,ad from stokkart with (nolock)  ) dt \r\n   on t.STOK_TIP=dt.tip and t.STOK_KOD=dt.kod\r\n   \r\n   \r\n   \r\n   return\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_ISTK_HRK",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_ISTK_HRK",
    "definition": "CREATE FUNCTION [dbo].UDF_ISTK_HRK(\r\n@firmano\t\tint,\r\n@HRK_KRITER     VARCHAR(4000),\r\n@ISTK_KOD VARCHAR(30),\r\n@TARIH1 DATETIME,\r\n@TARIH2 DATETIME,\r\n@SAAT1 VARCHAR(8),\r\n@SAAT2 VARCHAR(8),\r\n@ORDER VARCHAR(20),\r\n@DEVIR INT)\r\nRETURNS\r\n  @TB_ISTK_EKSTRE TABLE (\r\n    Firmano     int,\r\n    CARI_KOD    VARCHAR(30)  COLLATE Turkish_CI_AS,\r\n    CARI_UNVAN  VARCHAR(150)  COLLATE Turkish_CI_AS,\r\n    TARIH       DATETIME,\r\n    SAAT        VARCHAR(8)   COLLATE Turkish_CI_AS,\r\n    BELGENO     VARCHAR(50)  COLLATE Turkish_CI_AS,\r\n    ACIKLAMA    VARCHAR(100) COLLATE Turkish_CI_AS,\r\n    ISLTIPAD    VARCHAR(50)  COLLATE Turkish_CI_AS,\r\n    ISLHRKAD    VARCHAR(50)   COLLATE Turkish_CI_AS,\r\n    YERAD       VARCHAR(50)   COLLATE Turkish_CI_AS,\r\n    YERTIP      VARCHAR(30)   COLLATE Turkish_CI_AS,\r\n    KULAD       VARCHAR(70)   COLLATE Turkish_CI_AS,\r\n    ISLTIP      VARCHAR(30)  COLLATE Turkish_CI_AS,\r\n    ISLHRK      VARCHAR(30)  COLLATE Turkish_CI_AS,\r\n    KRS_TIP     VARCHAR(30)  COLLATE Turkish_CI_AS,\r\n    KRS_KOD     VARCHAR(50)  COLLATE Turkish_CI_AS,\r\n    KRS_UNVAN   VARCHAR(150)  COLLATE Turkish_CI_AS,\r\n    VADETAR     DATETIME,\r\n    VARNO       FLOAT,\r\n    VAROK       INT,\r\n    RAPID\t\tINT,\r\n    HRKID       FLOAT,\r\n    MASID       FLOAT,\r\n    BORC        DECIMAL(18,8),\r\n    ALACAK      DECIMAL(18,8),\r\n    BAKIYE      DECIMAL(18,8),\r\n    FAT_ID      INT,\r\n    FIS_ID      INT,\r\n    IRS_ID      INT,\r\n    MARSAT_ID\tINT,\r\n    SAYIM_ID    INT,\r\n    REMOTE_ID\tINT,\r\n    KASAHRK_ID  INT,\r\n    POSHRK_ID   INT,\r\n    BANKAHRK_ID INT,\r\n    CEK_ID\t\tINT,\r\n    ISTHRK_ID   INT    \r\n    )\r\nAS\r\nBEGIN\r\n \r\n \r\n  DECLARE @ONDA_HANE       INT\r\n  DECLARE @KUM_BAKIYE      DECIMAL(18,8)\r\n  DECLARE @HRK_POS_KOD    VARCHAR(30)\r\n  DECLARE @HRK_POS_UNVAN  VARCHAR(150) \r\n\r\n\r\n  select @ONDA_HANE=para_ondalik  from sistemtanim\r\n\r\n  SET @KUM_BAKIYE = 0\r\n\r\n  select @HRK_POS_UNVAN=ist.ad from istkart as ist\r\n  where kod=@ISTK_KOD\r\n\r\n\r\n\r\n\r\n  /* Devir atanıyor */\r\n  IF @DEVIR=1\r\n   BEGIN\r\n  IF @ORDER='tarih'\r\n  begin\r\n  INSERT @TB_ISTK_EKSTRE\r\n  (Firmano,CARI_KOD,CARI_UNVAN,TARIH,SAAT,BELGENO,\r\n  ACIKLAMA,ISLTIPAD,ISLHRKAD,YERAD,YERTIP,\r\n  KULAD,ISLTIP,ISLHRK,\r\n  KRS_TIP,KRS_KOD,KRS_UNVAN,\r\n  VADETAR,VARNO,VAROK,\r\n  RAPID,HRKID,MASID,BORC,ALACAK,BAKIYE,\r\n  FAT_ID,FIS_ID,IRS_ID,MARSAT_ID,SAYIM_ID,\r\n  REMOTE_ID,KASAHRK_ID,POSHRK_ID,\r\n  BANKAHRK_ID,CEK_ID,ISTHRK_ID)\r\n    SELECT\r\n      @firmano,\r\n      @ISTK_KOD, /* ISTK_KOD */\r\n      @HRK_POS_UNVAN, /* carı_UNVAN */\r\n      max(tarih),\r\n      @SAAT1,\r\n      'DEVİR', /* BELGE NO */\r\n      CONVERT(VARCHAR(10), max(tarih), 104) +' DEVİR BAKİYESİ', /* AÇIKLAMA */\r\n      '-','-','-','-','-','-','-',\r\n      '-','-','-',\r\n      max(vadetar),0,0,0,0,0,\r\n      ISNULL(SUM(round(borc,@ONDA_HANE)),0), /* BORC */\r\n      ISNULL(SUM(round(alacak,@ONDA_HANE)),0), /* ALACAK */\r\n      ISNULL(SUM(ROUND( (borc-alacak),@ONDA_HANE)),0) ,/* BAKIYE */\r\n       0,0,0,\r\n       0,0,0,\r\n       0,0,0,\r\n       0,0\r\n    FROM istkhrk\r\n    WHERE istkkod=@ISTK_KOD and sil=0\r\n     AND tarih < @TARIH1\r\n    end\r\n\r\n     IF @ORDER='vadetar'\r\n     begin\r\n     INSERT @TB_ISTK_EKSTRE\r\n     (Firmano,CARI_KOD,CARI_UNVAN,TARIH,SAAT,BELGENO,\r\n     ACIKLAMA,ISLTIPAD,ISLHRKAD,YERAD,YERTIP,\r\n     KULAD,ISLTIP,ISLHRK,\r\n     KRS_TIP,KRS_KOD,KRS_UNVAN,\r\n     VADETAR,VARNO,VAROK,\r\n     RAPID,HRKID,MASID,BORC,ALACAK,BAKIYE,\r\n     FAT_ID,FIS_ID,IRS_ID,MARSAT_ID,SAYIM_ID,\r\n     REMOTE_ID,KASAHRK_ID,POSHRK_ID,\r\n     BANKAHRK_ID,CEK_ID,ISTHRK_ID)\r\n     SELECT\r\n      @firmano,\r\n      @ISTK_KOD, /* ISTK_KOD */\r\n      @HRK_POS_UNVAN, /* carı_UNVAN */\r\n      max(tarih),\r\n      @SAAT1,\r\n      'DEVİR', /* BELGE NO */\r\n      CONVERT(VARCHAR(10), max(tarih), 104) +' DEVİR BAKİYESİ', /* AÇIKLAMA */\r\n      '-','-','-','-','-','-','-',\r\n      '-','-','-',\r\n      max(vadetar),0,0,0,0,0,\r\n      ISNULL(SUM(round(borc,@ONDA_HANE)),0), /* BORC */\r\n      ISNULL(SUM(round(alacak,@ONDA_HANE)),0), /* ALACAK */\r\n      ISNULL(SUM(ROUND( (borc-alacak),@ONDA_HANE)),0), /* BAKIYE */\r\n       0,0,0,\r\n       0,0,0,\r\n       0,0,0,\r\n       0,0\r\n    FROM istkhrk\r\n    WHERE istkkod=@ISTK_KOD and sil=0\r\n     AND vadetar < @TARIH1\r\n    end\r\n\r\n      SELECT @KUM_BAKIYE = isnull(BAKIYE,0) FROM @TB_ISTK_EKSTRE\r\n     if @KUM_BAKIYE=0\r\n     delete from @TB_ISTK_EKSTRE\r\n   END\r\n  /* Hareketler işleniyor */\r\n  /*---------------------------------------------------------------------------- */\r\n  \r\n   IF @ORDER='tarih'\r\n    begin\r\n    INSERT @TB_ISTK_EKSTRE\r\n    (Firmano,CARI_KOD,CARI_UNVAN,TARIH,SAAT,BELGENO,\r\n     ACIKLAMA,ISLTIPAD,ISLHRKAD,YERAD,YERTIP,\r\n     KULAD,ISLTIP,ISLHRK,\r\n     KRS_TIP,KRS_KOD,KRS_UNVAN,\r\n     VADETAR,VARNO,VAROK,\r\n     RAPID,HRKID,MASID,BORC,ALACAK,BAKIYE,\r\n     FAT_ID,FIS_ID,IRS_ID,MARSAT_ID,SAYIM_ID,\r\n     REMOTE_ID,KASAHRK_ID,POSHRK_ID,\r\n     BANKAHRK_ID,CEK_ID,ISTHRK_ID)\r\n    SELECT\r\n       @firmano,\r\n       @ISTK_KOD,@HRK_POS_UNVAN,\r\n       tarih,saat,belno,\r\n       ack, /* AÇIKLAMA, */\r\n       islmtipad,islmhrkad,yerad,yertip,\r\n       olususer,islmtip,islmhrk,\r\n       cartip,carkod,'',\r\n       vadetar,varno,varok,belrap_id,\r\n       istkhrkid,masterid,\r\n       round(borc,@ONDA_HANE),\r\n       round(alacak,@ONDA_HANE),\r\n       round((borc-alacak),@ONDA_HANE) AS BAKIYE,\r\n       0,0,0,\r\n       0,0,0,\r\n       0,0,0,\r\n       0,0\r\n    FROM istkhrk\r\n    WHERE istkkod=@ISTK_KOD and sil=0\r\n     and islmtip+'_'+islmhrk not in \r\n     (select * FROM CsvToSTR(@HRK_KRITER))\r\n     AND tarih >= @TARIH1 AND tarih <= @TARIH2\r\n     ORDER BY tarih,saat\r\n   end\r\n  \r\n  \r\n    IF @ORDER='vadetar'\r\n    begin\r\n    INSERT @TB_ISTK_EKSTRE\r\n    (Firmano,CARI_KOD,CARI_UNVAN,TARIH,SAAT,BELGENO,\r\n     ACIKLAMA,ISLTIPAD,ISLHRKAD,YERAD,YERTIP,\r\n     KULAD,ISLTIP,ISLHRK,\r\n     KRS_TIP,KRS_KOD,KRS_UNVAN,\r\n     VADETAR,VARNO,VAROK,\r\n     RAPID,HRKID,MASID,BORC,ALACAK,BAKIYE,\r\n     FAT_ID,FIS_ID,IRS_ID,MARSAT_ID,SAYIM_ID,\r\n     REMOTE_ID,KASAHRK_ID,POSHRK_ID,\r\n     BANKAHRK_ID,CEK_ID,ISTHRK_ID)\r\n    SELECT\r\n       @firmano,\r\n       @ISTK_KOD,@HRK_POS_UNVAN,\r\n       tarih,saat,belno,\r\n       ack, /* AÇIKLAMA, */\r\n       islmtipad,islmhrkad,yerad,yertip,\r\n       olususer,islmtip,islmhrk,\r\n       cartip,carkod,'',\r\n       vadetar,varno,varok,belrap_id,\r\n       istkhrkid,masterid,\r\n       round(borc,@ONDA_HANE),\r\n       round(alacak,@ONDA_HANE),\r\n       round((borc-alacak),@ONDA_HANE) AS BAKIYE,\r\n       0,0,0,\r\n       0,0,0,\r\n       0,0,0,\r\n       0,0\r\n    FROM istkhrk\r\n    WHERE istkkod=@ISTK_KOD and sil=0\r\n     and islmtip+'_'+islmhrk not in \r\n     (select * FROM CsvToSTR(@HRK_KRITER))\r\n     and vadetar >= @TARIH1 AND vadetar <= @TARIH2\r\n     ORDER BY vadetar,saat\r\n   end\r\n\r\n   update @TB_ISTK_EKSTRE set KRS_UNVAN=dt.AD\r\n   FROM @TB_ISTK_EKSTRE AS T join\r\n   (select cartp,kod,ad from genel_kart) dt\r\n   on dt.cartp=t.KRS_TIP and dt.kod=t.KRS_KOD\r\n   \r\n    \r\n   update @TB_ISTK_EKSTRE set KRS_KOD='-',KRS_UNVAN='-'\r\n   WHERE (KRS_KOD is null)\r\n\r\n\r\n  RETURN\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_KART_HRK_SAY",
    "type": "SQL_SCALAR_FUNCTION",
    "full_name": "dbo.UDF_KART_HRK_SAY",
    "definition": "CREATE FUNCTION [dbo].UDF_KART_HRK_SAY (\r\n@CARTIP\t\tVARCHAR(30),\r\n@CARKOD\t\tVARCHAR(30)\r\n)\r\n  RETURNS float\r\nAS\r\nBEGIN\r\n  declare @sonuc   float  \r\n  \r\n  set  @sonuc=0\r\n  \r\n  \r\n  select @sonuc=count(id) from carihrk \r\n   where cartip=@CARTIP and carkod=@CARKOD \r\n  \r\n\r\n\r\n  RETURN @sonuc\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_KART_KOD_VER",
    "type": "SQL_SCALAR_FUNCTION",
    "full_name": "dbo.UDF_KART_KOD_VER",
    "definition": "CREATE FUNCTION UDF_KART_KOD_VER \r\n(@firmano      \tint,\r\n@tabload  \t\tvarchar(50),\r\n@grp_index \t\tint,\r\n@grp_id \t\tint)\r\nRETURNS VARCHAR(50) AS\r\nBEGIN\r\n  \r\n declare @DEGER \t\t\tvarchar(50)\r\n declare @SERI \t\t\t\tvarchar(50)\r\n DECLARE @NUMARA \t\t\tvarchar(50)/*FLOAT */\r\n DECLARE @I \t\t\t\tINT\r\n DECLARE @UZUNLUK     \t\tINT\r\n\r\n SET @SERI = ''\r\n\r\n\r\n/*---cari kart */\r\n if @tabload='carikart' and @grp_index=0 \r\n   select @DEGER=max(kod) from carikart\r\n   \r\n if @tabload='carikart' and @grp_index>0\r\n   begin\r\n   \r\n   /*\r\n   if @grp_index=1\r\n    select @DEGER=max(kod) from carikart where grp1=@grp_id\r\n   if @grp_index=2\r\n    select @DEGER=max(kod) from carikart where grp2=@grp_id\r\n   if @grp_index=3\r\n    select @DEGER=max(kod) from carikart where grp3=@grp_id\r\n    */\r\n    \r\n   if @grp_index=1\r\n    select @DEGER=count(id) from carikart where grp1=@grp_id\r\n   if @grp_index=2\r\n    select @DEGER=count(id) from carikart where grp2=@grp_id\r\n   if @grp_index=3\r\n    select @DEGER=count(id) from carikart where grp3=@grp_id\r\n    \r\n    select @SERI=ISNULL(kod,'') from grup where id=@grp_id\r\n    \r\n     /* print(@DEGER) */\r\n    \r\n     set @UZUNLUK=4\r\n     if LEN(@DEGER)>4\r\n      set @UZUNLUK=5\r\n\r\n    \r\n    if @SERI=''\r\n     begin\r\n      select @DEGER=dbo.UDF_GETIR_FISNO ('carikart') \r\n      RETURN @DEGER\r\n     end\r\n     \r\n     \r\n     RETURN  @SERI+RIGHT('00000000000000000000' + CAST(@DEGER + 1 AS VARCHAR(15)),@UZUNLUK)\r\n  \r\n  end\r\n   \r\n  \r\n  \r\n/*---personel kart   */\r\n  if @tabload='perkart' and @grp_index=0 \r\n   select @DEGER=max(kod) from perkart\r\n   \r\n if @tabload='perkart' and @grp_index>0\r\n   begin\r\n   if @grp_index=1\r\n    select @DEGER=max(kod) from perkart where grp1=@grp_id\r\n   if @grp_index=2\r\n    select @DEGER=max(kod) from perkart where grp2=@grp_id\r\n   if @grp_index=3\r\n    select @DEGER=max(kod) from perkart where grp3=@grp_id\r\n  end  \r\n  \r\n/*--banka kart   */\r\n  if @tabload='bankakart' and @grp_index=0 \r\n   select @DEGER=max(kod) from bankakart\r\n   \r\n if @tabload='bankakart' and @grp_index>0\r\n   begin\r\n   if @grp_index=1\r\n    select @DEGER=max(kod) from bankakart where grp1=@grp_id\r\n   if @grp_index=2\r\n    select @DEGER=max(kod) from bankakart where grp2=@grp_id\r\n   if @grp_index=3\r\n    select @DEGER=max(kod) from bankakart where grp3=@grp_id\r\n  end \r\n  \r\n  \r\n /*--gelir gider kart   */\r\n  if @tabload='gelgidkart' and @grp_index=0 \r\n   select @DEGER=max(kod) from gelgidkart\r\n   \r\n if @tabload='gelgidkart' and @grp_index>0\r\n   begin\r\n   if @grp_index=1\r\n    select @DEGER=max(kod) from gelgidkart where grp1=@grp_id\r\n   if @grp_index=2\r\n    select @DEGER=max(kod) from gelgidkart where grp2=@grp_id\r\n   if @grp_index=3\r\n    select @DEGER=max(kod) from gelgidkart where grp3=@grp_id\r\n  end  \r\n  \r\n \r\n  /*--perakendekart kart   */\r\n  if @tabload='perakendekart' and @grp_index=0 \r\n   select @DEGER=max(kod) from perakendekart\r\n  \r\n  if @tabload='perakendekart' and @grp_index>0\r\n   begin\r\n   if @grp_index=1\r\n    select @DEGER=max(kod) from perakendekart where grp1=@grp_id\r\n   if @grp_index=2\r\n    select @DEGER=max(kod) from perakendekart where grp2=@grp_id\r\n   if @grp_index=3\r\n    select @DEGER=max(kod) from perakendekart where grp3=@grp_id\r\n  end  \r\n  \r\n  \r\n  /*--sayackart kart   */\r\n  if @tabload='sayackart' and @grp_index=0 \r\n   select @DEGER=max(kod) from sayackart\r\n  \r\n  if @tabload='sayackart' and @grp_index>0\r\n   begin\r\n   if @grp_index=1\r\n    select @DEGER=max(kod) from sayackart where grp1=@grp_id\r\n   if @grp_index=2\r\n    select @DEGER=max(kod) from sayackart where grp2=@grp_id\r\n   if @grp_index=3\r\n    select @DEGER=max(kod) from sayackart where grp3=@grp_id\r\n  end \r\n  \r\n  /*-market stok kartları */\r\n  \r\n   if @tabload='stok_mr' and @grp_index=0 \r\n   select @DEGER=max(kod) from stokkart where tip='markt'\r\n  \r\n  if @tabload='stok_mr' and @grp_index>0\r\n   begin\r\n   if @grp_index=1\r\n    select @DEGER=max(kod) from stokkart where tip='markt' and grp1=@grp_id\r\n   if @grp_index=2\r\n    select @DEGER=max(kod) from stokkart where tip='markt' and grp2=@grp_id\r\n   if @grp_index=3\r\n    select @DEGER=max(kod) from stokkart where tip='markt' and grp3=@grp_id\r\n  end \r\n  \r\n  \r\n   /*-akaryakit stok kartları */\r\n  \r\n   if @tabload='stok_ak' and @grp_index=0 \r\n   select @DEGER=max(kod) from stokkart where tip='akykt'\r\n  \r\n\r\n   if @tabload='stok_ak' and @grp_index>0\r\n   begin\r\n   if @grp_index=1\r\n    select @DEGER=max(kod) from stokkart where tip='akykt' and grp1=@grp_id\r\n   if @grp_index=2\r\n    select @DEGER=max(kod) from stokkart where tip='akykt' and grp2=@grp_id\r\n   if @grp_index=3\r\n    select @DEGER=max(kod) from stokkart where tip='akykt' and grp3=@grp_id\r\n  end \r\n  \r\n  \r\n  \r\n  /*-depo kart */\r\n   if @tabload='depo_kart' and @grp_index=0  /*- 0 tank,1 market  */\r\n   select @DEGER=max(kod) from Depo_Kart_Listesi where tip='akykt'\r\n   \r\n   if @tabload='depo_kart' and @grp_index=1  /*- 0 tank,1 market  */\r\n   select @DEGER=max(kod) from Depo_Kart_Listesi where tip='markt'\r\n   \r\n   \r\n /*-pos kart  */\r\n   if @tabload='poskart' and @grp_index=0 \r\n   select @DEGER=max(kod) from poskart \r\n  \r\n  \r\n  /*istkart */\r\n   if @tabload='istkart' and @grp_index=0 \r\n   select @DEGER=max(kod) from istkart \r\n  \r\n \r\n  \r\n  SET @I    = 1\r\n  set @NUMARA=null \r\n \r\n WHILE @I <= LEN(@DEGER)\r\n  BEGIN\r\n    IF ( (SELECT ISNUMERIC(SUBSTRING(@DEGER,@I,1))) = 0 )\r\n    BEGIN\r\n      SET @SERI = @SERI + ( SELECT SUBSTRING(@DEGER,@I,1) )\r\n    END\r\n    ELSE\r\n    BEGIN\r\n  /*    PRINT RIGHT(@DEGER,LEN(@DEGER) - @I + 1) */\r\n      IF ISNUMERIC(RIGHT(@DEGER,LEN(@DEGER) - @I + 1))=1\r\n      AND RIGHT(@DEGER,LEN(@DEGER) -@I + 1)>'0'\r\n      BEGIN\r\n      SET @UZUNLUK=LEN(@DEGER) - @I + 1\r\n      SELECT @NUMARA = CAST(RIGHT(@DEGER,LEN(@DEGER) - @I + 1) AS FLOAT)\r\n      BREAK\r\n      END\r\n    END\r\n \r\n   SET @I = @I + 1\r\n  END\r\n \r\n if @NUMARA is NULL\r\n set @DEGER=@SERI\r\n if not (@NUMARA is NULL)\r\n  set @DEGER=@SERI+@NUMARA\r\n  \r\n  if (@NUMARA is NULL) and @SERI=''\r\n   set @DEGER=''\r\n  \r\n RETURN @DEGER\r\n  /*RETURN @NUMARA */\r\n  /*RETURN @SERI */\r\n  /*RETURN @UZUNLUK */\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_KASA_AYLIK",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_KASA_AYLIK",
    "definition": "CREATE FUNCTION [dbo].UDF_KASA_AYLIK (\r\n@firmano\t\t\tint,\r\n@KASA_BRM           VARCHAR(20),\r\n@KASA_KOD           VARCHAR(20),\r\n@TARIH1             DATETIME,\r\n@TARIH2             DATETIME)\r\nRETURNS\r\n  @TB_CARI_EKSTRE TABLE (\r\n    Firmano   int,\r\n    Firma_Ad    VARCHAR(150) COLLATE Turkish_CI_AS,\r\n    KASA_BRM    VARCHAR(20)  COLLATE Turkish_CI_AS,\r\n    KASA_KOD    VARCHAR(20)  COLLATE Turkish_CI_AS,\r\n    KASA_AD     VARCHAR(50)  COLLATE Turkish_CI_AS,\r\n    AY           INT,\r\n    AYISIM       VARCHAR(20)  COLLATE Turkish_CI_AS,\r\n    GIREN        FLOAT,\r\n    CIKAN        FLOAT,\r\n    BAKIYE      FLOAT )\r\nAS\r\nBEGIN\r\n  DECLARE @EKSTRE_TEMP TABLE (\r\n    Firmano   int,\r\n    Firma_Ad   VARCHAR(150) COLLATE Turkish_CI_AS,\r\n    KASA_BRM    VARCHAR(20)  COLLATE Turkish_CI_AS,\r\n    KASA_KOD    VARCHAR(20)  COLLATE Turkish_CI_AS,\r\n    KASA_AD     VARCHAR(50)  COLLATE Turkish_CI_AS,\r\n    AY           INT,\r\n    AYISIM       VARCHAR(20)  COLLATE Turkish_CI_AS,\r\n    GIREN        FLOAT,\r\n    CIKAN        FLOAT,\r\n    BAKIYE      FLOAT)\r\n\r\n  DECLARE @HRK_FIRMA_ID    INT\r\n  DECLARE @HRK_KASA_BRM    VARCHAR(20)\r\n  DECLARE @HRK_KASA_KOD    VARCHAR(20)\r\n  DECLARE @HRK_KASA_AD     VARCHAR(50)\r\n  DECLARE @HRK_AY          INT\r\n  DECLARE @HRK_AYISIM      VARCHAR(20)\r\n  DECLARE @HRK_GIREN          FLOAT\r\n  DECLARE @HRK_CIKAN          FLOAT\r\n  DECLARE @HRK_BAKIYE        FLOAT\r\n  \r\n  \r\n   if @firmano=0\r\n     DECLARE CRS_HRK CURSOR FAST_FORWARD FOR\r\n     SELECT @firmano,k.parabrm,k.kod,k.ad,MONTH(h.tarih),\r\n     isnull(sum(h.giren),0),\r\n     isnull(sum(h.cikan),0)\r\n     FROM kasahrk as h inner join kasakart as k on\r\n     k.kod=h.kaskod and k.sil=0\r\n     where  h.tarih >= @TARIH1 and h.tarih <= @TARIH2 and h.sil=0\r\n     group by k.parabrm,k.kod,k.ad,MONTH(h.tarih)\r\n     order by MONTH(h.tarih)\r\n     \r\n   if @firmano>0\r\n     DECLARE CRS_HRK CURSOR FAST_FORWARD FOR\r\n     SELECT h.firmano,k.parabrm,k.kod,k.ad,MONTH(h.tarih),\r\n     isnull(sum(h.giren),0),\r\n     isnull(sum(h.cikan),0)\r\n     FROM kasahrk as h inner join kasakart as k on\r\n     k.kod=h.kaskod and k.sil=0 \r\n     where h.firmano=@firmano\r\n     and h.tarih >= @TARIH1 and h.tarih <= @TARIH2 and h.sil=0\r\n     group by h.firmano,k.parabrm,k.kod,k.ad,MONTH(h.tarih)\r\n     order by MONTH(h.tarih)\r\n\r\n     \r\n     \r\n     \r\n\r\n  OPEN CRS_HRK\r\n\r\n  FETCH NEXT FROM CRS_HRK INTO\r\n   @HRK_FIRMA_ID,@HRK_KASA_BRM,@HRK_KASA_KOD,@HRK_KASA_AD,@HRK_AY,@HRK_GIREN,@HRK_CIKAN\r\n\r\n  WHILE @@FETCH_STATUS = 0\r\n  BEGIN\r\n\r\n    SET @HRK_BAKIYE=@HRK_GIREN-@HRK_CIKAN\r\n\r\n        set @HRK_AYISIM=\r\n        (select\r\n          CASE @HRK_AY\r\n           WHEN 1 THEN 'OCAK'\r\n           WHEN 2 THEN 'ŞUBAT'\r\n           WHEN 3 THEN 'MART'\r\n           WHEN 4 THEN 'NİSAN'\r\n           WHEN 5 THEN 'MAYIS'\r\n           WHEN 6 THEN 'HAZİRAN'\r\n           WHEN 7 THEN 'TEMMUZ'\r\n           WHEN 8 THEN 'AĞUSTOS'\r\n           WHEN 9 THEN 'EYLÜL'\r\n           WHEN 10 THEN 'EKİM'\r\n           WHEN 11 THEN 'KASIM'\r\n           WHEN 12 THEN 'ARALIK'\r\n          END)\r\n    \r\n\r\n    INSERT @EKSTRE_TEMP\r\n      SELECT\r\n       @HRK_FIRMA_ID,'',@HRK_KASA_BRM,@HRK_KASA_KOD,@HRK_KASA_AD,@HRK_AY,@HRK_AYISIM,@HRK_GIREN,@HRK_CIKAN,\r\n       @HRK_BAKIYE\r\n       \r\n    FETCH NEXT FROM CRS_HRK INTO\r\n    @HRK_FIRMA_ID,@HRK_KASA_BRM,@HRK_KASA_KOD,@HRK_KASA_AD,@HRK_AY,@HRK_GIREN,@HRK_CIKAN\r\n  END\r\n\r\n  CLOSE CRS_HRK\r\n  DEALLOCATE CRS_HRK\r\n\r\n  /*---------------------------------------------------------------------------- */\r\n\r\n\r\n  update @TB_CARI_EKSTRE set firma_ad=dt.ad\r\n  from @TB_CARI_EKSTRE as t join\r\n  (select id,ad from Firma) dt on dt.id=t.firmano\r\n\r\n\r\n\r\n  INSERT @TB_CARI_EKSTRE\r\n    SELECT * FROM @EKSTRE_TEMP ORDER BY AY\r\n\r\n  RETURN\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_KASA_BAKIYE",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_KASA_BAKIYE",
    "definition": "CREATE FUNCTION [dbo].UDF_KASA_BAKIYE (\r\n@FIRMANO\t\t    int,\r\n@KASA_KOD \t\t\tVARCHAR(20),\r\n@TARIH1 \t\t\tDATETIME,\r\n@TARIH2 \t\t\tDATETIME,\r\n@silin \t\t\t\tvarchar(10))\r\nRETURNS\r\n  @TB_KASA_EKSTRE TABLE (\r\n    Firmano       int,\r\n    Firma_Ad       VARCHAR(150) COLLATE Turkish_CI_AS,\r\n    KASA_BRM       VARCHAR(20)  COLLATE Turkish_CI_AS,\r\n    KASA_KOD       VARCHAR(20)  COLLATE Turkish_CI_AS,\r\n    KASA_AD        VARCHAR(50)  COLLATE Turkish_CI_AS,\r\n    KASA_TARIH     DATETIME,\r\n    KASA_ISLEM     VARCHAR(30)  COLLATE Turkish_CI_AS,\r\n    KASA_BELGENO   VARCHAR(20)  COLLATE Turkish_CI_AS,\r\n    KASA_ACIKLAMA  VARCHAR(100) COLLATE Turkish_CI_AS,\r\n    KASA_UNVAN     VARCHAR(150)  COLLATE Turkish_CI_AS,\r\n    GIREN          FLOAT,\r\n    CIKAN          FLOAT,\r\n    BAKIYE         FLOAT,\r\n    KUR\t\t\t   FLOAT,\r\n    KUR_GIREN\t   FLOAT,\r\n    KUR_CIKAN\t   FLOAT,\r\n    KUR_BAKIYE     FLOAT  )\r\nAS\r\nBEGIN\r\n  DECLARE @EKSTRE_TEMP TABLE (\r\n    Firmano       int,\r\n    Firma_Ad       VARCHAR(150) COLLATE Turkish_CI_AS,\r\n    KASA_BRM       VARCHAR(20)  COLLATE Turkish_CI_AS,\r\n    KASA_KOD       VARCHAR(20)  COLLATE Turkish_CI_AS,\r\n    KASA_AD        VARCHAR(50)  COLLATE Turkish_CI_AS,\r\n    KASA_TARIH     DATETIME,\r\n    KASA_ISLEM     VARCHAR(30)   COLLATE Turkish_CI_AS,\r\n    KASA_BELGENO   VARCHAR(20)  COLLATE Turkish_CI_AS,\r\n    KASA_ACIKLAMA  VARCHAR(100) COLLATE Turkish_CI_AS,\r\n    KASA_UNVAN     VARCHAR(150)  COLLATE Turkish_CI_AS,\r\n    GIREN          FLOAT,\r\n    CIKAN          FLOAT,\r\n    BAKIYE         FLOAT,\r\n    KUR\t\t\t   FLOAT,\r\n    KUR_GIREN\t   FLOAT,\r\n    KUR_CIKAN\t   FLOAT,\r\n    KUR_BAKIYE     FLOAT )\r\n\r\n  DECLARE @HRK_FIRMANO          INT\r\n  DECLARE @HRK_KASA_BRM    \t\tVARCHAR(20)\r\n  DECLARE @HRK_KASA_KOD    \t\tVARCHAR(20)\r\n  DECLARE @HRK_KASA_AD     \t\tVARCHAR(50)\r\n  DECLARE @HRK_TARIH       \t\tDATETIME\r\n  DECLARE @HRK_KASA_ISLEM  \t\tVARCHAR(30)\r\n  DECLARE @HRK_KASA_BELGENO\t \tVARCHAR(20)\r\n  DECLARE @HRK_KASA_ACIKLAMA \tVARCHAR(100)\r\n  DECLARE @HRK_KASA_UNVAN    \tVARCHAR(150)\r\n  DECLARE @HRK_GIREN          \tFLOAT\r\n  DECLARE @HRK_CIKAN          \tFLOAT\r\n  DECLARE @HRK_BAKIYE         \tFLOAT\r\n  DECLARE @HRK_GENELTOP        \tFLOAT\r\n  \r\n  DECLARE @HRK_PARABRM     VARCHAR(30)\r\n \r\n  DECLARE @ONDA_HANE           \tINT \r\n  \r\n  DECLARE @HRK_KUR         FLOAT\r\n  \r\n DECLARE @SIS_PARABRM     VARCHAR(30)\r\n  \r\n  \r\n  SELECT @ONDA_HANE=para_ondalik from sistemtanim\r\n\r\n  SELECT @SIS_PARABRM=sistem_parabrm from sistemtanim\r\n\r\n\r\n  SELECT @HRK_PARABRM=PARABRM from KASAKART WHERE KOD=@KASA_KOD\r\n  \r\n \r\n \r\n \r\n  /*devir atanıyorrrrr..... */\r\n  /*\r\n  SELECT @HRK_GIREN=isnull(sum(round(giren,@ONDA_HANE)),0),\r\n  @HRK_CIKAN=isnull(sum(round(cikan,@ONDA_HANE)),0),\r\n  @HRK_GENELTOP=isnull(sum(giren-cikan),0) from kasahrk as h\r\n  where h.kaskod=@KASA_KOD\r\n  and h.sil=0\r\n  --and ((h.varno>0 and h.varok=1) or (h.varno=0))\r\n  and h.tarih < @TARIH1\r\n  */\r\n  \r\n  set  @TARIH1=@TARIH1-1\r\n \r\n  SELECT @HRK_GIREN=isnull(sum(round(GIREN,@ONDA_HANE)),0),\r\n  @HRK_CIKAN=isnull(sum(round(CIKAN,@ONDA_HANE)),0),\r\n  @HRK_GENELTOP=isnull(sum(GIREN-CIKAN),0) \r\n  FROM UDF_KASA_TAR_SONDURUM (@FIRMANO,@KASA_KOD,0,@TARIH1)\r\n  \r\n  \r\n  set @HRK_KUR=dbo.UDF_CAPRAZ_KUR \r\n   (@TARIH1,@HRK_PARABRM,@SIS_PARABRM)\r\n  \r\n  \r\n  \r\n   set @TARIH1=@TARIH1+1 \r\n  \r\n  \r\n  \r\n  \r\n  INSERT @EKSTRE_TEMP\r\n   SELECT @FIRMANO,'',k.parabrm,k.kod,k.ad,\r\n   @TARIH1,'DEVİR','','DÜNDEN DEVİR','',\r\n   @HRK_GIREN,@HRK_CIKAN,@HRK_GENELTOP,\r\n   @HRK_KUR,\r\n   @HRK_GIREN*@HRK_KUR,@HRK_CIKAN*@HRK_KUR,@HRK_GENELTOP*@HRK_KUR\r\n   FROM kasakart as k where k.KOD=@KASA_KOD\r\n  \r\n  \r\n    DECLARE KASA_HRK CURSOR FAST_FORWARD FOR\r\n    select k.Firmano,k.parabrm,k.kaskod,k.kasaad,k.tarih,k.islmhrkad,k.belno,k.ack,\r\n    k.unvan,k.giren,k.cikan\r\n    from UDF_KASA_GENEL_HRK (@FIRMANO,@KASA_KOD,@TARIH1,@TARIH2,@silin) as k\r\n    order by k.tarih,k.saat\r\n    OPEN KASA_HRK\r\n\r\n  FETCH NEXT FROM KASA_HRK INTO\r\n   @FIRMANO,@HRK_KASA_BRM,@HRK_KASA_KOD,@HRK_KASA_AD,@HRK_TARIH,@HRK_KASA_ISLEM,@HRK_KASA_BELGENO,\r\n   @HRK_KASA_ACIKLAMA,@HRK_KASA_UNVAN,@HRK_GIREN,@HRK_CIKAN\r\n\r\n  WHILE @@FETCH_STATUS = 0\r\n  BEGIN\r\n  \r\n   set @HRK_KUR=dbo.UDF_CAPRAZ_KUR \r\n   (@HRK_TARIH,@HRK_KASA_BRM,@SIS_PARABRM)\r\n  \r\n  \r\n  \r\n    SET @HRK_GENELTOP=@HRK_GENELTOP+@HRK_GIREN-@HRK_CIKAN\r\n\r\n    INSERT @EKSTRE_TEMP\r\n      SELECT\r\n       @FIRMANO,'',@HRK_KASA_BRM,@HRK_KASA_KOD,@HRK_KASA_AD,@HRK_TARIH,@HRK_KASA_ISLEM,@HRK_KASA_BELGENO,\r\n       @HRK_KASA_ACIKLAMA,@HRK_KASA_UNVAN,@HRK_GIREN,@HRK_CIKAN,@HRK_GENELTOP,\r\n       @HRK_KUR,@HRK_GIREN*@HRK_KUR,@HRK_CIKAN*@HRK_KUR,@HRK_GENELTOP*@HRK_KUR\r\n       \r\n    FETCH NEXT FROM KASA_HRK INTO\r\n    @FIRMANO,@HRK_KASA_BRM,@HRK_KASA_KOD,@HRK_KASA_AD,@HRK_TARIH,@HRK_KASA_ISLEM,@HRK_KASA_BELGENO,\r\n   @HRK_KASA_ACIKLAMA,@HRK_KASA_UNVAN,@HRK_GIREN,@HRK_CIKAN\r\n  END\r\n\r\n  CLOSE KASA_HRK\r\n  DEALLOCATE KASA_HRK\r\n\r\n  /*---------------------------------------------------------------------------- */\r\n\r\n      update @TB_KASA_EKSTRE set firma_ad=dt.ad\r\n      from @TB_KASA_EKSTRE as t join\r\n      (select id,ad from Firma) dt on dt.id=t.firmano\r\n\r\n\r\n\r\n  INSERT @TB_KASA_EKSTRE\r\n    SELECT * FROM @EKSTRE_TEMP \r\n\r\n  RETURN\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_KASA_GENEL_HRK",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_KASA_GENEL_HRK",
    "definition": "CREATE FUNCTION [dbo].UDF_KASA_GENEL_HRK (\r\n@firmano\t\t  int,\r\n@KOD              VARCHAR(20),\r\n@TARIH1           DATETIME,\r\n@TARIH2           DATETIME,\r\n@silin            varchar(10))\r\nRETURNS\r\n   @TB_KASA_GENEL_HRK TABLE(\r\n   id             int,\r\n   Firmano        int,\r\n   Firma_Ad       VARCHAR(150) COLLATE Turkish_CI_AS,\r\n   kashrkid       int,\r\n   fisfattip      varchar(5) COLLATE Turkish_CI_AS NULL,\r\n   fisfatid       int,\r\n   tarih          datetime,\r\n   saat           varchar(8) COLLATE Turkish_CI_AS NULL,\r\n   kaskod         varchar(20) COLLATE Turkish_CI_AS NULL,\r\n   kasaad         varchar(50) COLLATE Turkish_CI_AS NULL,\r\n   gctip          varchar(1) COLLATE Turkish_CI_AS NULL,\r\n   varok          int,\r\n   sil            int,\r\n   varno          int,\r\n   masterid       int,\r\n   islmtip        varchar(20) COLLATE Turkish_CI_AS NULL,\r\n   islmtipad      varchar(50) COLLATE Turkish_CI_AS NULL,\r\n   islmhrk        varchar(20) COLLATE Turkish_CI_AS NULL,\r\n   islmhrkad      varchar(50) COLLATE Turkish_CI_AS NULL,\r\n   yertip         varchar(20) COLLATE Turkish_CI_AS NULL,\r\n   yerad          varchar(50) COLLATE Turkish_CI_AS NULL,\r\n   olususer       varchar(50) COLLATE Turkish_CI_AS NULL,\r\n   olustarsaat    datetime,\r\n   belno          varchar(20) COLLATE Turkish_CI_AS NULL,\r\n   ack            varchar(100) COLLATE Turkish_CI_AS NULL,\r\n   giren          float,\r\n   cikan          float,\r\n   kur\t\t\t  float,\r\n   remote_id\t  float,\t\r\n   parabrm        varchar(10) COLLATE Turkish_CI_AS NULL,\r\n   unvan          varchar(150) COLLATE Turkish_CI_AS NULL,\r\n   cartip         varchar(30) COLLATE Turkish_CI_AS NULL,\r\n   carkod         varchar(30) COLLATE Turkish_CI_AS NULL,\r\n   RG             int,\r\n   devir\t\t  bit,\r\n   DegUser\t\t  varchar(150) COLLATE Turkish_CI_AS NULL,\r\n   DegTarSaat    datetime  )\r\nAS\r\nBEGIN\r\n\r\n  DECLARE @ONDA_HANE       INT\r\n  DECLARE @VAR_TES_TEK     INT\r\n  DECLARE @KAS_FIN_GOS     INT\r\n\r\n  select @ONDA_HANE=para_ondalik,@VAR_TES_TEK=t.var_tes_tek,\r\n  @KAS_FIN_GOS=t.kas_fin_var from sistemtanim as t\r\n\r\n\r\n  if @firmano=0\r\n      insert into @TB_KASA_GENEL_HRK \r\n      (id,Firmano,kashrkid,fisfattip,fisfatid,\r\n      tarih,saat,kaskod,gctip,varok,\r\n      sil,varno,masterid,islmtip,islmtipad,islmhrk,islmhrkad,yertip,yerad,\r\n      belno,ack,olususer,olustarsaat,giren,cikan,kur,\r\n      remote_id,parabrm,unvan,cartip,carkod,rg,devir,\r\n      DegUser,DegTarSaat)\r\n      select h.id,h.firmano,h.kashrkid,h.fisfattip,h.fisfatid,\r\n      h.tarih,h.saat,h.kaskod,h.gctip,h.varok,\r\n      h.sil,h.varno,h.masterid,h.islmtip,h.islmtipad,h.islmhrk,\r\n      h.islmhrkad,h.yertip,h.yerad,h.belno,h.ack,h.olususer,h.olustarsaat,\r\n      round(h.giren,@ONDA_HANE),\r\n      round(h.cikan,@ONDA_HANE),h.kur,h.remote_id,\r\n      h.parabrm,'',\r\n      case\r\n      when h.islmhrk='TES' then 'perkart'\r\n      when h.islmtip='VIR' then 'kasakart'\r\n      when h.islmhrk='ELT' then  cek.cartip\r\n      else h.cartip end,\r\n      case\r\n      when h.islmhrk='TES' then  h.perkod\r\n      when h.islmtip='VIR' then  h.kaskod\r\n      when h.islmhrk='ELT' then  cek.carkod\r\n      else h.carkod end,h.rg,h.devir,\r\n      h.deguser,h.degtarsaat\r\n      from kasahrk as h with (NOLOCK) \r\n      left join cekkart as cek with (NOLOCK) on cek.refno=h.karsiheskod\r\n      where h.kaskod=@KOD\r\n      and h.tarih>=@TARIH1 and h.tarih<=@TARIH2\r\n      and h.varno=0 and h.sil in (select * from dbo.CsvToSTR(@silin))\r\n\r\n\r\n\r\n    if @firmano>0\r\n    insert into @TB_KASA_GENEL_HRK (id,Firmano,kashrkid,fisfattip,fisfatid,\r\n      tarih,saat,kaskod,gctip,varok,\r\n      sil,varno,masterid,islmtip,islmtipad,islmhrk,islmhrkad,yertip,yerad,\r\n      belno,ack,olususer,olustarsaat,giren,cikan,kur,\r\n      remote_id,parabrm,unvan,cartip,carkod,rg,devir,\r\n      DegUser,DegTarSaat)\r\n      select h.id,h.firmano,h.kashrkid,h.fisfattip,h.fisfatid,\r\n      h.tarih,h.saat,h.kaskod,h.gctip,h.varok,\r\n      h.sil,h.varno,h.masterid,h.islmtip,h.islmtipad,h.islmhrk,\r\n      h.islmhrkad,h.yertip,h.yerad,h.belno,h.ack,h.olususer,h.olustarsaat,\r\n      round(h.giren,@ONDA_HANE),\r\n      round(h.cikan,@ONDA_HANE),h.kur,\r\n      h.remote_id,\r\n      h.parabrm,'',\r\n      case\r\n      when h.islmhrk='TES' then 'perkart'\r\n      when h.islmtip='VIR' then 'kasakart'\r\n      when h.islmhrk='ELT' then  cek.cartip\r\n      else h.cartip end,\r\n      case\r\n      when h.islmhrk='TES' then  h.perkod\r\n      when h.islmtip='VIR' then  h.kaskod\r\n      when h.islmhrk='ELT' then  cek.carkod\r\n      else h.carkod end,h.rg,h.devir,\r\n      h.deguser,h.degtarsaat\r\n      from kasahrk as h WITH (NOLOCK, INDEX = kasahrk_index2)\r\n      left join cekkart as cek with (NOLOCK) on cek.refno=h.karsiheskod\r\n      where (h.firmano=@firmano or h.firmano=0) and h.kaskod=@KOD\r\n      and h.tarih>=@TARIH1 and h.tarih<=@TARIH2\r\n      and h.varno=0 and h.sil in (select * from dbo.CsvToSTR(@silin))\r\n      \r\n\r\n\r\n\r\n  \r\n  /* vardiya finans işlmelerini goster */\r\n    if @KAS_FIN_GOS=1\r\n     begin\r\n\r\n         if @firmano=0\r\n          insert into @TB_KASA_GENEL_HRK \r\n          (id,Firmano,kashrkid,fisfattip,fisfatid,\r\n          tarih,saat,kaskod,gctip,varok,\r\n          sil,varno,masterid,islmtip,islmtipad,islmhrk,islmhrkad,yertip,yerad,\r\n          belno,ack,olususer,olustarsaat,giren,cikan,kur,\r\n          remote_id,parabrm,unvan,cartip,carkod,rg,devir,\r\n          DegUser,DegTarSaat)\r\n          select h.id,h.firmano,h.kashrkid,h.fisfattip,h.fisfatid,\r\n          h.tarih,h.saat,h.kaskod,h.gctip,h.varok,\r\n          h.sil,h.varno,h.masterid,h.islmtip,h.islmtipad,h.islmhrk,\r\n          h.islmhrkad,h.yertip,h.yerad,h.belno,h.ack,h.olususer,\r\n          h.olustarsaat,\r\n          round(h.giren,@ONDA_HANE),\r\n          round(h.cikan,@ONDA_HANE),h.kur,\r\n          h.remote_id,\r\n          h.parabrm,'',\r\n          case\r\n          when h.islmhrk='TES' then 'perkart'\r\n          when h.islmtip='VIR' then 'kasakart'\r\n          when h.islmhrk='ELT' then  cek.cartip\r\n          else h.cartip end,\r\n          case\r\n          when h.islmhrk='TES' then  h.perkod\r\n          when h.islmtip='VIR' then  h.kaskod\r\n          when h.islmhrk='ELT' then  cek.carkod\r\n          else h.carkod end,h.rg,h.devir,\r\n          h.deguser,h.degtarsaat\r\n          from kasahrk as h with (NOLOCK)\r\n          left join cekkart as cek with (NOLOCK) on cek.refno=h.karsiheskod\r\n          where h.kaskod=@KOD  and h.tarih>=@TARIH1 and h.tarih<=@TARIH2\r\n          and h.varno>0 and h.sil\r\n          in (select * from dbo.CsvToSTR(@silin)) and h.islmhrk<>'TES'\r\n          \r\n          \r\n          if @firmano>0\r\n          insert into @TB_KASA_GENEL_HRK (id,Firmano,kashrkid,fisfattip,fisfatid,\r\n          tarih,saat,kaskod,gctip,varok,\r\n          sil,varno,masterid,islmtip,islmtipad,islmhrk,islmhrkad,yertip,yerad,\r\n          belno,ack,olususer,olustarsaat,giren,cikan,kur,\r\n          remote_id,parabrm,unvan,cartip,carkod,rg,devir,\r\n          DegUser,DegTarSaat)\r\n          select h.id,h.firmano,h.kashrkid,h.fisfattip,h.fisfatid,\r\n          h.tarih,h.saat,h.kaskod,h.gctip,h.varok,\r\n          h.sil,h.varno,h.masterid,h.islmtip,h.islmtipad,h.islmhrk,\r\n          h.islmhrkad,h.yertip,h.yerad,h.belno,h.ack,h.olususer,h.olustarsaat,\r\n          round(h.giren,@ONDA_HANE),\r\n          round(h.cikan,@ONDA_HANE),h.kur,\r\n          h.remote_id,\r\n          h.parabrm,'',\r\n          case\r\n          when h.islmhrk='TES' then 'perkart'\r\n          when h.islmtip='VIR' then 'kasakart'\r\n          when h.islmhrk='ELT' then  cek.cartip\r\n          else h.cartip end,\r\n          case\r\n          when h.islmhrk='TES' then  h.perkod\r\n          when h.islmtip='VIR' then  h.kaskod\r\n          when h.islmhrk='ELT' then  cek.carkod\r\n          else h.carkod end,h.rg,h.devir,\r\n          h.deguser,h.degtarsaat\r\n          from kasahrk as h with (NOLOCK)\r\n          left join cekkart as cek with (NOLOCK) on cek.refno=h.karsiheskod\r\n          where (h.firmano=@firmano or h.firmano=0) and h.kaskod=@KOD\r\n          and h.tarih>=@TARIH1 and h.tarih<=@TARIH2\r\n          and h.varno>0 and h.sil\r\n          in (select * from dbo.CsvToSTR(@silin)) and h.islmhrk<>'TES'\r\n          \r\n          \r\n       end\r\n          \r\n\r\n  \r\n  /*tesimat tek satır değilse */\r\n    if @VAR_TES_TEK=0\r\n     begin\r\n     \r\n      if @firmano=0\r\n          insert into @TB_KASA_GENEL_HRK (id,Firmano,\r\n          kashrkid,fisfattip,fisfatid,\r\n          tarih,saat,kaskod,gctip,varok,\r\n          sil,varno,masterid,islmtip,islmtipad,islmhrk,\r\n          islmhrkad,yertip,yerad,\r\n          belno,ack,olususer,olustarsaat,giren,cikan,kur,\r\n          remote_id,parabrm,unvan,cartip,carkod,rg,h.devir,\r\n          DegUser,DegTarSaat)\r\n          select h.id,h.firmano,h.kashrkid,h.fisfattip,h.fisfatid,\r\n          h.tarih,h.saat,h.kaskod,h.gctip,h.varok,\r\n          h.sil,h.varno,h.masterid,h.islmtip,h.islmtipad,h.islmhrk,\r\n          h.islmhrkad,h.yertip,h.yerad,h.belno,h.ack,h.olususer,h.olustarsaat,\r\n          round(h.giren,@ONDA_HANE),\r\n          round(h.cikan,@ONDA_HANE),h.kur,\r\n          h.remote_id,\r\n          h.parabrm,'',\r\n          'perkart',h.perkod,h.rg,h.devir,\r\n          h.deguser,h.degtarsaat\r\n          from kasahrk as h with (NOLOCK)\r\n          where kaskod=@KOD and tarih>=@TARIH1 and tarih<=@TARIH2\r\n          and varno>0 and h.sil in (select * from dbo.CsvToSTR(@silin))\r\n          and h.islmhrk='TES' \r\n\r\n\r\n       if @firmano>0\r\n          insert into @TB_KASA_GENEL_HRK (id,Firmano,\r\n          kashrkid,fisfattip,fisfatid,\r\n          tarih,saat,kaskod,gctip,varok,\r\n          sil,varno,masterid,islmtip,islmtipad,islmhrk,islmhrkad,yertip,yerad,\r\n          belno,ack,olususer,olustarsaat,giren,cikan,kur,\r\n          remote_id,parabrm,unvan,cartip,carkod,rg,devir,\r\n          DegUser,DegTarSaat)\r\n          select h.id,h.firmano,h.kashrkid,h.fisfattip,h.fisfatid,\r\n          h.tarih,h.saat,h.kaskod,h.gctip,h.varok,\r\n          h.sil,h.varno,h.masterid,h.islmtip,h.islmtipad,h.islmhrk,\r\n          h.islmhrkad,h.yertip,h.yerad,h.belno,h.ack,h.olususer,h.olustarsaat,\r\n          round(h.giren,@ONDA_HANE),\r\n          round(h.cikan,@ONDA_HANE),h.kur,\r\n          h.remote_id,\r\n          h.parabrm,'',\r\n          'perkart',h.perkod,h.rg,h.devir,\r\n          h.deguser,h.degtarsaat\r\n          from kasahrk as h with (NOLOCK)\r\n          where (h.firmano=@firmano or h.firmano=0) and\r\n          h.kaskod=@KOD and tarih>=@TARIH1 and tarih<=@TARIH2\r\n          and varno>0 and h.sil in (select * from dbo.CsvToSTR(@silin))\r\n          and h.islmhrk='TES'\r\n\r\n      end\r\n          \r\n\r\n /*teslimat tek satır ise */\r\n  if @VAR_TES_TEK=1\r\n   begin\r\n       if @firmano=0\r\n          insert into @TB_KASA_GENEL_HRK (id,Firmano,\r\n          kashrkid,fisfattip,fisfatid,\r\n          tarih,saat,kaskod,gctip,varok,\r\n          sil,varno,masterid,islmtip,islmtipad,islmhrk,\r\n          islmhrkad,yertip,yerad,\r\n          belno,ack,olususer,olustarsaat,giren,cikan,kur,\r\n          remote_id,parabrm,unvan,cartip,carkod,rg,devir,\r\n          DegUser,DegTarSaat)\r\n          select max(h.id),h.firmano,max(h.kashrkid),\r\n          '-',0,max(h.tarih),max(h.saat),\r\n          h.kaskod,h.gctip,h.varok,\r\n          h.sil,h.varno,max(h.masterid),\r\n          h.islmtip,h.islmtipad,h.islmhrk,\r\n          h.islmhrkad,h.yertip,h.yerad,\r\n          CAST(varno as varchar),\r\n          '(TEK SATIR) VARDIYA TESLIMAT' as ack,\r\n          max(h.olususer),max(h.olustarsaat),\r\n          sum(round(h.giren,@ONDA_HANE)),\r\n          sum(round(h.cikan,@ONDA_HANE)),avg(h.kur),\r\n          max(h.remote_id),\r\n          h.parabrm,'',\r\n          'perkart','diger',1,1,\r\n          max(h.deguser),max(h.degtarsaat)\r\n          from kasahrk as h with (NOLOCK)\r\n          where h.kaskod=@KOD and tarih>=@TARIH1 and tarih<=@TARIH2\r\n          and varno>0 and h.sil=0 and h.islmhrk='TES' \r\n          GROUP BY h.firmano,h.kaskod,h.gctip,h.varok,\r\n          h.sil,h.varno,h.islmtip,h.islmtipad,h.islmhrk,\r\n          h.islmhrkad,h.yertip,h.yerad,h.parabrm\r\n          \r\n          if @firmano>0\r\n          insert into @TB_KASA_GENEL_HRK (id,Firmano,\r\n          kashrkid,fisfattip,fisfatid,\r\n          tarih,saat,kaskod,gctip,varok,\r\n          sil,varno,masterid,islmtip,islmtipad,\r\n          islmhrk,islmhrkad,yertip,yerad,\r\n          belno,ack,olususer,olustarsaat,giren,cikan,kur,\r\n          remote_id,parabrm,unvan,cartip,carkod,rg,devir,\r\n          DegUser,DegTarSaat)\r\n          select max(h.id),h.firmano,max(h.kashrkid),\r\n          '-',0,max(h.tarih),max(h.saat),\r\n          h.kaskod,h.gctip,h.varok,\r\n          h.sil,h.varno,max(h.masterid),\r\n          h.islmtip,h.islmtipad,h.islmhrk,\r\n          h.islmhrkad,h.yertip,h.yerad,\r\n          CAST(varno as varchar),\r\n          '(TEK SATIR) VARDIYA TESLIMAT' as ack,\r\n          max(h.olususer),max(h.olustarsaat),\r\n          sum(round(h.giren,@ONDA_HANE)),\r\n          sum(round(h.cikan,@ONDA_HANE)),avg(h.kur),\r\n          max(h.remote_id),\r\n          h.parabrm,'',\r\n          'perkart','diger',1,1,\r\n          max(h.deguser),max(h.degtarsaat)\r\n          from kasahrk as h with (NOLOCK)\r\n          where (h.firmano=@firmano or h.firmano=0) and\r\n          h.kaskod=@KOD and tarih>=@TARIH1 and tarih<=@TARIH2\r\n          and varno>0 and h.sil=0 and h.islmhrk='TES' \r\n          GROUP BY h.firmano,h.kaskod,h.gctip,h.varok,\r\n          h.sil,h.varno,h.islmtip,h.islmtipad,h.islmhrk,\r\n          h.islmhrkad,h.yertip,h.yerad,h.parabrm\r\n          \r\n          \r\n   end\r\n\r\n      update @TB_KASA_GENEL_HRK set kasaad=dt.ad\r\n      from @TB_KASA_GENEL_HRK as t join\r\n      (select kod,ad from kasakart with (NOLOCK)\r\n      where sil=0 and kod=@KOD) dt\r\n      on t.kaskod=dt.kod\r\n\r\n      update @TB_KASA_GENEL_HRK set unvan=dt.ad\r\n      from @TB_KASA_GENEL_HRK as t join\r\n      (select cartp,kod,ad from Genel_Kart with (NOLOCK) )\r\n      dt on t.carkod=dt.kod and t.cartip=dt.cartp\r\n      \r\n      \r\n      update @TB_KASA_GENEL_HRK set firma_ad=dt.ad\r\n      from @TB_KASA_GENEL_HRK as t join\r\n      (select id,ad from Firma) dt on dt.id=t.firmano\r\n  \r\n\r\n\r\n RETURN\r\n\r\n END"
  },
  {
    "schema": "dbo",
    "name": "UDF_KASA_GUNLUK",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_KASA_GUNLUK",
    "definition": "CREATE FUNCTION [dbo].UDF_KASA_GUNLUK (\r\n@FIRMANO\t\t\tint,\r\n@KOD \t\t\t\tVARCHAR(20),\r\n@TARIH1 \t\t\tDATETIME,\r\n@TARIH2\t\t\t\tDATETIME)\r\nRETURNS\r\n  @TB_KASA_GUNLUK TABLE (\r\n    Firmano     int,\r\n    Firma_Ad    VARCHAR(150) COLLATE Turkish_CI_AS,\r\n    TARIH       DATETIME,\r\n    KASA_KOD    VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    KASA_AD     VARCHAR(70) COLLATE Turkish_CI_AS,\r\n    DEVREDEN    FLOAT,\r\n    GIREN       FLOAT,\r\n    CIKAN       FLOAT,\r\n    BAKIYE      FLOAT,\r\n    KUR\t\t\tFLOAT,\r\n    KUR_GIREN\tFLOAT,\r\n    KUR_CIKAN\tFLOAT,\r\n    KUR_BAKIYE  FLOAT)\r\nAS\r\nBEGIN\r\n  DECLARE @EKSTRE_TEMP TABLE (\r\n    Firmano    int,\r\n    Firma_Ad    VARCHAR(150) COLLATE Turkish_CI_AS,\r\n    TARIH       DATETIME,\r\n    KASA_KOD    VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    KASA_AD     VARCHAR(70) COLLATE Turkish_CI_AS,\r\n    DEVREDEN    FLOAT,\r\n    GIREN       FLOAT,\r\n    CIKAN       FLOAT,\r\n    BAKIYE      FLOAT,\r\n    KUR\t\t\tFLOAT,\r\n    KUR_GIREN\tFLOAT,\r\n    KUR_CIKAN\tFLOAT,\r\n    KUR_BAKIYE  FLOAT)\r\n\r\n  DECLARE @HRK_FIRMANO          INT\r\n  DECLARE @HRK_TAR         DATETIME\r\n  DECLARE @HRK_KASA_KOD    VARCHAR(30)\r\n  DECLARE @HRK_PARABRM     VARCHAR(30)\r\n  DECLARE @SIS_PARABRM     VARCHAR(30)\r\n  DECLARE @HRK_KASA_AD     VARCHAR(70)\r\n  DECLARE @HRK_DEVREDEN    FLOAT\r\n  DECLARE @HRK_GIREN       FLOAT\r\n  DECLARE @HRK_CIKAN       FLOAT\r\n  DECLARE @HRK_BAKIYE      FLOAT\r\n  \r\n  DECLARE @HRK_KUR         FLOAT\r\n\r\n/*---------------------------------------------------------------------------- */\r\n\r\n SELECT @SIS_PARABRM=sistem_parabrm from sistemtanim\r\n\r\n\r\n if @KOD<>''\r\n DECLARE M_HRK CURSOR FAST_FORWARD FOR\r\n SELECT KOD,AD,PARABRM FROM kasakart WHERE sil=0 AND KOD=@KOD\r\n \r\n\r\n if @KOD='' and (@FIRMANO=0)\r\n DECLARE M_HRK CURSOR FAST_FORWARD FOR\r\n SELECT KOD,AD,PARABRM FROM kasakart WHERE sil=0 \r\n\r\n\r\n if @KOD='' and (@FIRMANO>0)\r\n DECLARE M_HRK CURSOR FAST_FORWARD FOR\r\n SELECT KOD,AD,PARABRM FROM kasakart WHERE sil=0 \r\n and (firmano=@FIRMANO or firmano=0)\r\n\r\n\r\n  OPEN M_HRK\r\n\r\n   FETCH NEXT FROM M_HRK INTO\r\n    @HRK_KASA_KOD,@HRK_KASA_AD,@HRK_PARABRM\r\n\r\n   WHILE @@FETCH_STATUS = 0\r\n   BEGIN\r\n    \r\n /*---------------------------------------------------------------------------- */\r\n  if @FIRMANO=0\r\n   DECLARE CRS_HRK CURSOR FAST_FORWARD FOR\r\n    SELECT\r\n      h.tarih\r\n      FROM kasahrk as h where h.kaskod=@HRK_KASA_KOD\r\n      and h.tarih >= @TARIH1 and h.tarih <= @TARIH2\r\n      and h.sil=0\r\n      group by h.tarih  order by h.tarih\r\n      \r\n  \r\n    if @FIRMANO>0\r\n   DECLARE CRS_HRK CURSOR FAST_FORWARD FOR\r\n    SELECT\r\n      h.tarih\r\n      FROM kasahrk as h where (h.firmano=@FIRMANO or h.firmano=0) \r\n      and h.kaskod=@HRK_KASA_KOD\r\n      and h.tarih >= @TARIH1 and h.tarih <= @TARIH2\r\n      and h.sil=0\r\n      group by h.tarih  order by h.tarih\r\n  \r\n  \r\n      \r\n      \r\n\r\n   OPEN CRS_HRK\r\n\r\n   FETCH NEXT FROM CRS_HRK INTO\r\n   @HRK_TAR\r\n\r\n   WHILE @@FETCH_STATUS = 0\r\n   BEGIN\r\n   \r\n   \r\n   set @HRK_KUR=1\r\n\r\n    if @HRK_PARABRM<>@SIS_PARABRM\r\n    set @HRK_KUR=dbo.UDF_CAPRAZ_KUR (@HRK_TAR,@HRK_PARABRM,@SIS_PARABRM)\r\n\r\n\r\n    INSERT @EKSTRE_TEMP\r\n     SELECT @FIRMANO,'',@HRK_TAR,@HRK_KASA_KOD,@HRK_KASA_AD,\r\n     DEVREDEN,GIREN,CIKAN,(DEVREDEN+GIREN-CIKAN),\r\n     @HRK_KUR,GIREN*@HRK_KUR,CIKAN*@HRK_KUR,\r\n     (DEVREDEN+GIREN-CIKAN)*@HRK_KUR\r\n     \r\n    FROM UDF_KASA_TAR_SONDURUM (@FIRMANO,@HRK_KASA_KOD,@HRK_TAR,@HRK_TAR)\r\n\r\n\r\n    FETCH NEXT FROM CRS_HRK INTO\r\n    @HRK_TAR\r\n  END\r\n\r\n  CLOSE CRS_HRK\r\n  DEALLOCATE CRS_HRK\r\n /*---------------------------------------------------------------------------- */\r\n \r\n\r\n\r\n   FETCH NEXT FROM M_HRK INTO\r\n   @HRK_KASA_KOD,@HRK_KASA_AD,@HRK_PARABRM\r\n   END\r\n\r\n   CLOSE M_HRK\r\n   DEALLOCATE M_HRK\r\n \r\n \r\n  update @EKSTRE_TEMP set firma_ad=dt.ad \r\n  from @EKSTRE_TEMP as t join \r\n  (select id,ad from Firma) dt on dt.id=t.firmano\r\n \r\n \r\n\r\n  INSERT @TB_KASA_GUNLUK\r\n    SELECT * FROM @EKSTRE_TEMP\r\n\r\n  RETURN\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_KASA_HRK_LISTE",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_KASA_HRK_LISTE",
    "definition": "CREATE FUNCTION   [dbo].UDF_KASA_HRK_LISTE (\r\n@firmano\t\t\tint,\r\n@KOD                VARCHAR(20),\r\n@TARIH1             DATETIME,\r\n@TARIH2             DATETIME,\r\n@silin              varchar(10),\r\n@Rgin\t\t\t\tvarchar(10),\r\n@devir              tinyint)\r\nRETURNS\r\n   @TB_KASA_HRK_LISTE TABLE(\r\n   id             int,\r\n   Firmano        int,\r\n   Firma_Ad       VARCHAR(150) COLLATE Turkish_CI_AS,\r\n   kashrkid       int,\r\n   fisfattip      varchar(5) COLLATE Turkish_CI_AS NULL,\r\n   fisfatid       int,\r\n   TARIH          datetime,\r\n   SAAT           varchar(8) COLLATE Turkish_CI_AS NULL,\r\n   KASKOD         varchar(20) COLLATE Turkish_CI_AS NULL,\r\n   GCTIP          varchar(1) COLLATE Turkish_CI_AS NULL,\r\n   VAROK          int,\r\n   SIL            int,\r\n   VARNO          int,\r\n   MASTERID       int,\r\n   ISLMTIP        varchar(20) COLLATE Turkish_CI_AS NULL,\r\n   ISLMTIPAD      varchar(50) COLLATE Turkish_CI_AS NULL,\r\n   ISLMHRK        varchar(20) COLLATE Turkish_CI_AS NULL,\r\n   ISLMHRKAD      varchar(50) COLLATE Turkish_CI_AS NULL,\r\n   YERTIP         varchar(20) COLLATE Turkish_CI_AS NULL,\r\n   YERAD          varchar(50) COLLATE Turkish_CI_AS NULL,\r\n   KULAD          varchar(50) COLLATE Turkish_CI_AS NULL,\r\n   BELGENO        varchar(20) COLLATE Turkish_CI_AS NULL,\r\n   ACIKLAMA       varchar(100) COLLATE Turkish_CI_AS NULL,\r\n   GIREN          float,\r\n   CIKAN          float,\r\n   BAKIYE         Float,\r\n   KUR\t\t\t  FLOAT,\r\n   KUR_GIREN\t  FLOAT,\r\n   KUR_CIKAN\t  FLOAT,\r\n   KUR_BAKIYE     FLOAT,\r\n   REMOTE_ID      FLOAT,\r\n   DOVIZBRM       varchar(10) COLLATE Turkish_CI_AS NULL,\r\n   CARKOD \t\t  varchar(30) COLLATE Turkish_CI_AS NULL,\r\n   UNVAN          varchar(150) COLLATE Turkish_CI_AS NULL,\r\n   RG             INT,\r\n   devir\t\t  bit,\r\n   OLUSUSER\t\t  varchar(150) COLLATE Turkish_CI_AS NULL,\r\n   OLUSTARSAAT    datetime,\r\n   DEGUSER\t\t  varchar(150) COLLATE Turkish_CI_AS NULL,\r\n   DEGTARSAAT    datetime  \r\n   )\r\nAS\r\nBEGIN\r\n  DECLARE @BAK_BAKIYE FLOAT\r\n  DECLARE @BAK_GIREN  FLOAT\r\n  DECLARE @BAK_CIKAN  FLOAT\r\n  DECLARE @BAK_TAR    DATETIME\r\n\r\n  DECLARE @HRK_ID          INT\r\n  DECLARE @HRK_FIRMANO     int\r\n  DECLARE @HRK_KSID        INT\r\n  DECLARE @HRK_FISFATTIP   VARCHAR(5)\r\n  DECLARE @HRK_FISFATID    INT    \r\n  DECLARE @HRK_TARIH       DATETIME\r\n  DECLARE @HRK_SAAT        VARCHAR(8)\r\n  DECLARE @HRK_KASKOD      VARCHAR(30)\r\n  DECLARE @HRK_GCTIP       VARCHAR(1)\r\n  DECLARE @HRK_ISLTIP      VARCHAR(10)\r\n  DECLARE @HRK_ISLHRK      VARCHAR(10)\r\n  DECLARE @HRK_ISLTIPAD    VARCHAR(30)\r\n  DECLARE @HRK_ISLHRKAD    VARCHAR(30)\r\n  DECLARE @HRK_YERAD       VARCHAR(30)\r\n  DECLARE @HRK_YERTIP      VARCHAR(20)\r\n  DECLARE @HRK_KULAD       VARCHAR(50)\r\n  DECLARE @HRK_BELNO       VARCHAR(20)\r\n  DECLARE @HRK_ACK         VARCHAR(100)\r\n  DECLARE @HRK_DVZ         VARCHAR(10)\r\n  DECLARE @HRK_CARKOD      VARCHAR(30)\r\n  DECLARE @HRK_UNVAN       VARCHAR(150)\r\n  DECLARE @HRK_VAROK       INT\r\n  DECLARE @HRK_SIL         INT\r\n  DECLARE @HRK_VARNO       FLOAT\r\n  DECLARE @HRK_HRKID       FLOAT\r\n  DECLARE @HRK_MASID       FLOAT\r\n  DECLARE @HRK_GIREN       FLOAT\r\n  DECLARE @HRK_CIKAN       FLOAT\r\n  DECLARE @HRK_BAKIYE      FLOAT\r\n  DECLARE @HRK_KUR         FLOAT\r\n  DECLARE @HRK_KUR_GIREN   FLOAT\r\n  DECLARE @HRK_KUR_CIKAN   FLOAT\r\n  DECLARE @HRK_KUR_BAKIYE  FLOAT\r\n  \r\n  DECLARE @HRK_REMOTE_ID   FLOAT\r\n  \r\n  DECLARE @ONDA_HANE       INT\r\n  DECLARE @SIS_PARABRM     VARCHAR(30)\r\n  \r\n  DECLARE @HRK_PARABRM\t\tVARCHAR(30)\r\n  \r\n  DECLARE @HRK_OLUSUSER\t\tVARCHAR(100)\r\n  DECLARE @HRK_OLUSTARIH       DATETIME\r\n  DECLARE @HRK_DEGUSER\t\tVARCHAR(100)\r\n  DECLARE @HRK_DEGTARIH       DATETIME\r\n  \r\n\r\n  SELECT @ONDA_HANE=Para_ondalik from sistemtanim\r\n\r\n\r\n   \r\n\r\n\r\n  if @devir=1\r\n   begin\r\n    SET @BAK_TAR=DATEADD(day,-1,@TARIH1)\r\n    SELECT @BAK_BAKIYE=(GIREN-CIKAN),\r\n    @BAK_GIREN=GIREN,\r\n    @BAK_CIKAN=CIKAN\r\n    FROM UDF_KASA_TAR_SONDURUM (@firmano,@KOD,'2000-01-01',@BAK_TAR)\r\n\r\n    SELECT @SIS_PARABRM=sistem_parabrm from sistemtanim\r\n\r\n    SELECT @HRK_PARABRM=parabrm from kasakart where kod=@KOD\r\n    \r\n     set @HRK_KUR=1\r\n\r\n    if @HRK_PARABRM<>@SIS_PARABRM\r\n    set @HRK_KUR=dbo.UDF_CAPRAZ_KUR (@BAK_TAR,@HRK_PARABRM,@SIS_PARABRM)\r\n\r\n\r\n    INSERT INTO @TB_KASA_HRK_LISTE\r\n    (id,Firmano,kashrkid,fisfattip,fisfatid,\r\n    TARIH,SAAT,KASKOD,GCTIP,VAROK,SIL,VARNO,MASTERID,ISLMTIP,ISLMTIPAD,\r\n    ISLMHRK,ISLMHRKAD,YERTIP,YERAD,BELGENO,ACIKLAMA,GIREN,CIKAN,BAKIYE,\r\n    KUR,KUR_GIREN,KUR_CIKAN,KUR_BAKIYE,\r\n    REMOTE_ID,DOVIZBRM,UNVAN,RG,devir)\r\n    SELECT 0,@firmano,0,'-',0,@BAK_TAR,'00:00:00',@KOD,'',0,0,0,0,'','','','',\r\n    'DEVIR','DEVIR','DEVIR','DEVIR',@BAK_GIREN,@BAK_CIKAN,@BAK_BAKIYE,\r\n    @HRK_KUR,round(@BAK_GIREN*@HRK_KUR,@ONDA_HANE),\r\n    round(@BAK_CIKAN*@HRK_KUR,@ONDA_HANE),round(@BAK_BAKIYE*@HRK_KUR,@ONDA_HANE),\r\n    0,\r\n    k.parabrm,k.ad,1,1\r\n     FROM kasakart AS k where k.kod=@KOD\r\n   end\r\n    /*and ( (varno>0 and varok=1 and islmhrk='TES') or (varno=0)) */\r\n\r\n  /*DECLARE CRS_KASA_HRK CURSOR FAST_FORWARD FOR */\r\n  \r\n  INSERT INTO @TB_KASA_HRK_LISTE\r\n  (id,Firmano,kashrkid,fisfattip,fisfatid,\r\n  TARIH,SAAT,KASKOD,GCTIP,VAROK,SIL,VARNO,MASTERID,ISLMTIP,ISLMTIPAD,\r\n  ISLMHRK,ISLMHRKAD,YERTIP,YERAD,BELGENO,ACIKLAMA,KULAD,\r\n  OLUSUSER,OLUSTARSAAT,DEGUSER,DEGTARSAAT,\r\n  GIREN,CIKAN,BAKIYE,\r\n  KUR,KUR_GIREN,KUR_CIKAN,KUR_BAKIYE,\r\n  REMOTE_ID,\r\n  DOVIZBRM,UNVAN,CARKOD,RG,devir)\r\n   select h.id,h.Firmano,h.kashrkid,h.fisfattip,h.fisfatid,h.tarih,h.saat,h.kaskod,h.gctip,h.varok,\r\n    h.sil,h.varno,h.masterid,h.islmtip,h.islmtipad,h.islmhrk,\r\n    h.islmhrkad,h.yertip,h.yerad,h.belno,h.ack,H.olususer,\r\n    h.olususer,h.olustarsaat,h.DegUser,h.DegTarSaat,\r\n    round(h.giren,@ONDA_HANE),\r\n    round(h.cikan,@ONDA_HANE),0,\r\n    H.kur,round(h.giren*H.kur,@ONDA_HANE),\r\n    round(h.cikan*H.kur,@ONDA_HANE),0,\r\n    h.remote_id,\r\n    h.parabrm,unvan,carkod,H.RG,h.devir\r\n    from UDF_KASA_GENEL_HRK \r\n    (@firmano,@KOD,@TARIH1,@TARIH2,@silin) as h order by h.tarih,h.saat\r\n \r\n /*\r\n    OPEN CRS_KASA_HRK\r\n\r\n    FETCH NEXT FROM CRS_KASA_HRK INTO\r\n    @HRK_ID,@HRK_FIRMANO,@HRK_KSID,@HRK_FISFATTIP,@HRK_FISFATID,\r\n    @HRK_TARIH,@HRK_SAAT,@HRK_KASKOD,@HRK_GCTIP,@HRK_VAROK,\r\n    @HRK_SIL,@HRK_VARNO,@HRK_MASID,@HRK_ISLTIP,@HRK_ISLTIPAD,@HRK_ISLHRK,\r\n    @HRK_ISLHRKAD,@HRK_YERTIP,@HRK_YERAD,@HRK_BELNO,@HRK_ACK,@HRK_KULAD,\r\n    @HRK_GIREN,@HRK_CIKAN,@HRK_REMOTE_ID,\r\n    @HRK_DVZ,@HRK_UNVAN,@HRK_CARKOD\r\n\r\n      WHILE @@FETCH_STATUS = 0\r\n      BEGIN\r\n       SET @BAK_BAKIYE =@BAK_BAKIYE+@HRK_GIREN-@HRK_CIKAN\r\n\r\n       INSERT INTO @TB_KASA_HRK_LISTE\r\n       (id,Firmano,kashrkid,fisfattip,fisfatid,\r\n       TARIH,SAAT,KASKOD,GCTIP,VAROK,SIL,VARNO,MASTERID,ISLMTIP,ISLMTIPAD,\r\n       ISLMHRK,ISLMHRKAD,YERTIP,YERAD,BELGENO,ACIKLAMA,KULAD,\r\n       GIREN,CIKAN,BAKIYE,REMOTE_ID,\r\n       DOVIZBRM,UNVAN,CARKOD)\r\n       values\r\n       (@HRK_ID,@HRK_FIRMANO,@HRK_KSID,@HRK_FISFATTIP,@HRK_FISFATID,\r\n       @HRK_TARIH,@HRK_SAAT,@HRK_KASKOD,@HRK_GCTIP,@HRK_VAROK,\r\n       @HRK_SIL,@HRK_VARNO,@HRK_MASID,@HRK_ISLTIP,@HRK_ISLTIPAD,@HRK_ISLHRK,\r\n       @HRK_ISLHRKAD,@HRK_YERTIP,@HRK_YERAD,@HRK_BELNO,@HRK_ACK,@HRK_KULAD,\r\n       @HRK_GIREN,@HRK_CIKAN,@BAK_BAKIYE,\r\n       @HRK_REMOTE_ID,@HRK_DVZ,@HRK_UNVAN,@HRK_CARKOD)\r\n\r\n\r\n       FETCH NEXT FROM CRS_KASA_HRK INTO\r\n       @HRK_ID,@HRK_FIRMANO,@HRK_KSID,@HRK_FISFATTIP,@HRK_FISFATID,\r\n       @HRK_TARIH,@HRK_SAAT,@HRK_KASKOD,@HRK_GCTIP,@HRK_VAROK,\r\n       @HRK_SIL,@HRK_VARNO,@HRK_MASID,@HRK_ISLTIP,@HRK_ISLTIPAD,@HRK_ISLHRK,\r\n       @HRK_ISLHRKAD,@HRK_YERTIP,@HRK_YERAD,@HRK_BELNO,@HRK_ACK,@HRK_KULAD,\r\n       @HRK_GIREN,@HRK_CIKAN,\r\n       @HRK_REMOTE_ID,@HRK_DVZ,@HRK_UNVAN,@HRK_CARKOD\r\n      END\r\n\r\n     CLOSE CRS_KASA_HRK\r\n     DEALLOCATE CRS_KASA_HRK\r\n    */ \r\n     \r\n     update @TB_KASA_HRK_LISTE set firma_ad=dt.ad\r\n      from @TB_KASA_HRK_LISTE as t join\r\n      (select id,ad from Firma) dt on dt.id=t.firmano\r\n     \r\n     \r\n\r\n\r\nRETURN\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_KASA_SON_BAKIYE",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_KASA_SON_BAKIYE",
    "definition": "CREATE FUNCTION [dbo].[UDF_KASA_SON_BAKIYE] ()\r\nRETURNS\r\n    @TB_KASA_EKSTRE TABLE (\r\n    kod  VARCHAR(20)  COLLATE Turkish_CI_AS,\r\n    ad   VARCHAR(50)  COLLATE Turkish_CI_AS,\r\n    top_bakiye   FLOAT,\r\n    parabrm      VARCHAR(20)  COLLATE Turkish_CI_AS)\r\nAS\r\nBEGIN\r\n  \r\n \r\n  DECLARE @KAS_FIN_GOS        \tINT \r\n  DECLARE  @kod  VARCHAR(20)  \r\n  DECLARE  @ad   VARCHAR(50)  \r\n  DECLARE  @parabrm      VARCHAR(20) \r\n  declare @Bakiye      float\r\n  \r\n\r\n  SELECT @KAS_FIN_GOS=kas_fin_var from sistemtanim\r\n\r\n \r\n  /*devir atanıyorrrrr..... */\r\n  \r\n  \r\n    DECLARE KASA_HRK CURSOR FAST_FORWARD FOR\r\n    select k.kod,k.ad,k.parabrm\r\n    from kasakart as k  with (nolock) where k.Sil=0\r\n    OPEN KASA_HRK\r\n    \r\n  FETCH NEXT FROM KASA_HRK INTO  @kod,@ad,@parabrm\r\n  WHILE @@FETCH_STATUS = 0\r\n  BEGIN\r\n  \r\n  \r\n     set @Bakiye=0\r\n  \r\n     if @KAS_FIN_GOS=0\r\n       select @Bakiye=isnull(sum(round(giren-cikan,2)),0)\r\n       from kasahrk as h WITH (NOLOCK, INDEX = kasahrk_index3)\r\n       where h.kaskod=@KOD and h.sil=0 and tarih < DATEADD(day,1,GETDATE())\r\n       and ((varno>0  and islmhrk='TES') or (varno=0))\r\n\r\n       if @KAS_FIN_GOS=1\r\n       select @Bakiye=isnull(sum(round(giren-cikan,2)),0)\r\n       from kasahrk as h WITH (NOLOCK, INDEX = kasahrk_index3)\r\n       where h.kaskod=@KOD and h.sil=0 and tarih < DATEADD(day,1,GETDATE())\r\n      \r\n\r\n\r\n\r\n    INSERT @TB_KASA_EKSTRE (kod,ad,parabrm,top_bakiye)\r\n      values (@kod,@ad,@parabrm,@Bakiye) \r\n    FETCH NEXT FROM KASA_HRK INTO  @kod,@ad,@parabrm\r\n  END\r\n\r\n  CLOSE KASA_HRK\r\n  DEALLOCATE KASA_HRK\r\n\r\n   \r\n\r\n\r\n  RETURN\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_KASA_TAR_SONDURUM",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_KASA_TAR_SONDURUM",
    "definition": "CREATE FUNCTION [dbo].UDF_KASA_TAR_SONDURUM \r\n(@firmano        int,\r\n@KOD \t\t\tVARCHAR(20),\r\n@TARIH1 \t\tDATETIME,\r\n@TARIH2 \t\tDATETIME)\r\nRETURNS\r\n  @TB_KASA_SONDURUM TABLE (\r\n    Firma_id     int,\r\n    DEVREDEN     FLOAT,\r\n    GIREN        FLOAT,\r\n    CIKAN        FLOAT)\r\nBEGIN\r\nDECLARE @DEVREDEN FLOAT\r\nDECLARE @GIREN FLOAT\r\nDECLARE @CIKAN FLOAT\r\n \r\n  DECLARE @ONDA_HANE       INT\r\n  DECLARE @VAR_TES_TEK     INT\r\n  DECLARE @KAS_FIN_GOS     INT\r\n\r\n   select @ONDA_HANE=para_ondalik,@VAR_TES_TEK=t.var_tes_tek,\r\n   @KAS_FIN_GOS=t.kas_fin_var from sistemtanim as t\r\n\r\n   set @DEVREDEN=0\r\n   set @GIREN=0\r\n   set @CIKAN=0\r\n   \r\n   /*finans işlemlerini gosterme */\r\n   if @firmano=0\r\n   select @DEVREDEN=isnull(sum(round(giren-cikan,@ONDA_HANE)),0)\r\n   from kasahrk as h WITH (NOLOCK, INDEX = kasahrk_index3)\r\n   where h.kaskod=@KOD and h.sil=0 and tarih < @TARIH1\r\n   and ((varno>0  and islmhrk='TES') or (varno=0))\r\n\r\n   if @firmano>0\r\n   select @DEVREDEN=isnull(sum(round(giren-cikan,@ONDA_HANE)),0) from \r\n   kasahrk as h WITH (NOLOCK, INDEX = kasahrk_index3)\r\n   where  (h.firmano=@firmano or h.firmano=0) \r\n   and h.kaskod=@KOD and h.sil=0 and tarih < @TARIH1\r\n   and ((varno>0  and islmhrk='TES') or (varno=0))\r\n\r\n\r\n   \r\n   /*finans işlemlerini goster */\r\n   if @KAS_FIN_GOS=1\r\n    begin\r\n     \r\n    if @firmano=0\r\n     select @DEVREDEN=@DEVREDEN+\r\n     isnull(sum(round(giren-cikan,@ONDA_HANE)),0) from kasahrk as h\r\n     WITH (NOLOCK, INDEX = kasahrk_index3)\r\n     where h.kaskod=@KOD and h.sil=0 and tarih < @TARIH1\r\n     and h.varno>0 and islmhrk<>'TES'\r\n     \r\n     \r\n    if @firmano>0\r\n     select @DEVREDEN=@DEVREDEN+\r\n     isnull(sum(round(giren-cikan,@ONDA_HANE)),0) from kasahrk as h\r\n     WITH (NOLOCK, INDEX = kasahrk_index3)\r\n     where  (h.firmano=@firmano or h.firmano=0) \r\n     and h.kaskod=@KOD and h.sil=0 and tarih < @TARIH1\r\n     and h.varno>0 and islmhrk<>'TES'\r\n     \r\n     end  \r\n   /*and ((varno>0 and varok=1 and islmhrk='TES') or (varno=0)) */\r\n   \r\n    if @firmano=0\r\n    SELECT @GIREN=isnull(sum(h.giren),0),\r\n    @CIKAN=isnull(sum(round(h.cikan,@ONDA_HANE)),0)\r\n    FROM kasahrk as h WITH (NOLOCK, INDEX = kasahrk_index3)\r\n    where h.kaskod=@KOD\r\n    and h.sil=0 AND tarih >= @TARIH1 and tarih <= @TARIH2\r\n    and ((varno>0 and islmhrk='TES') or (varno=0))\r\n    \r\n    if @firmano>0\r\n    SELECT @GIREN=isnull(sum(h.giren),0),\r\n    @CIKAN=isnull(sum(round(h.cikan,@ONDA_HANE)),0)\r\n    FROM kasahrk as h \r\n    WITH (NOLOCK, INDEX = kasahrk_index3)\r\n    where \r\n    (h.firmano=@firmano or h.firmano=0) \r\n    and h.kaskod=@KOD\r\n    and h.sil=0 AND tarih >= @TARIH1 and tarih <= @TARIH2\r\n    and ((varno>0 and islmhrk='TES') or (varno=0))  \r\n    \r\n    \r\n    \r\n    \r\n    if @KAS_FIN_GOS=1\r\n     begin\r\n      \r\n      if @firmano=0\r\n      SELECT @GIREN=@GIREN+\r\n      isnull(sum(h.giren),0),\r\n      @CIKAN=@CIKAN+isnull(sum(round(h.cikan,@ONDA_HANE)),0)\r\n      FROM kasahrk as h WITH (NOLOCK, INDEX = kasahrk_index3)\r\n      where h.kaskod=@KOD\r\n      and h.sil=0 AND tarih >= @TARIH1 and tarih <= @TARIH2\r\n      and varno>0 and islmhrk<>'TES'\r\n      \r\n      \r\n      if @firmano>0\r\n      SELECT @GIREN=@GIREN+\r\n      isnull(sum(h.giren),0),\r\n      @CIKAN=@CIKAN+isnull(sum(round(h.cikan,@ONDA_HANE)),0)\r\n      FROM kasahrk as h WITH (NOLOCK, INDEX = kasahrk_index3)\r\n      where  (h.firmano=@firmano or h.firmano=0) and h.kaskod=@KOD\r\n      and h.sil=0 AND tarih >= @TARIH1 and tarih <= @TARIH2\r\n      and varno>0 and islmhrk<>'TES'\r\n      \r\n      \r\n      \r\n   end \r\n    \r\n    \r\n   /* and ((varno>0 and varok=1 and islmhrk='TES') or (varno=0)) */\r\n\r\n    \r\n   INSERT @TB_KASA_SONDURUM (Firma_id,DEVREDEN,GIREN,CIKAN)\r\n   VALUES (@Firmano,@DEVREDEN,@GIREN,@CIKAN)\r\n\r\n  RETURN\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_KDV_GRUP_DRUM_RAPORU",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_KDV_GRUP_DRUM_RAPORU",
    "definition": "CREATE FUNCTION [dbo].[UDF_KDV_GRUP_DRUM_RAPORU] (\r\n@firmano int,\t\r\n@BASTAR DATETIME,\r\n@BITTAR DATETIME,\r\n@FATTIPIN VARCHAR(2000),\r\n@ZTIPIN VARCHAR(100),\r\n@DEVIR INT)\r\nRETURNS\r\n  @TB_KDV_DURUM_EKSTRE TABLE (\r\n    TIP            VARCHAR(1)  COLLATE Turkish_CI_AS,\r\n    TIP_AD         VARCHAR(10)  COLLATE Turkish_CI_AS,  \r\n    KDV_ORAN       FLOAT,\r\n    MATRAH         FLOAT,\r\n    KDV_TUTAR      FLOAT,\r\n    IADE_MATRAH    FLOAT,\r\n    IADE_KDV_TUTAR FLOAT ,\r\n    TOPLAM_MATRAH    FLOAT,\r\n    TOPLAM_KDV_TUTAR FLOAT  )\r\nBEGIN\r\n\r\n  DECLARE @EKSTRE_TEMP TABLE (\r\n  FirmaNo\t\t  int,\r\n  TIP            VARCHAR(1)  COLLATE Turkish_CI_AS,\r\n  TUR            INT,\r\n  TARIH          DATETIME,\r\n  KDV_ORAN       FLOAT,\r\n  MATRAH         FLOAT,\r\n  KDV_TUTAR      FLOAT)\r\n\r\n\r\n\r\n  insert into @EKSTRE_TEMP (FirmaNo,TARIH,TIP,TUR,MATRAH,KDV_TUTAR,KDV_ORAN)\r\n  SELECT m.firmano,m.tarih,t.gc,T.tur_id,\r\n  ((h.brmfiy-(h.satisktut+h.genisktut))*mik),h.kdvtut*mik,h.kdvyuz\r\n  from faturahrklistesi as h WITH (NOLOCK)\r\n  inner join faturamas as m WITH (NOLOCK) on m.fatid=h.fatid\r\n  and h.sil=0 and m.sil=0 /*and h.satirtip='S' */\r\n  inner join fattip as t WITH (NOLOCK) on \r\n  t.kod=m.fattip and t.tip='FAT' \r\n  inner join raporlar as r WITH (NOLOCK) on t.kod=r.rapkod\r\n  and m.fatrap_id=r.id   \r\n  where m.fatrap_id in (select * from CsvToSTR(@FATTIPIN))\r\n  AND m.tarih >=@BASTAR and m.tarih <=@BITTAR\r\n  \r\n  \r\n  if @ZTIPIN<>''\r\n  insert into @EKSTRE_TEMP (FirmaNo,TARIH,TIP,TUR,MATRAH,KDV_TUTAR,KDV_ORAN)\r\n  SELECT m.firmano,m.tarih,'C',4,((h.brmfiy*h.miktar)/(1+h.kdvyuz)),\r\n  (h.brmfiy*h.miktar)-((h.brmfiy*h.miktar)/(1+h.kdvyuz)),\r\n  h.kdvyuz\r\n  from zraporhrk as h WITH (NOLOCK)\r\n  inner join zrapormas as m WITH (NOLOCK) on m.zrapid=h.zrapid\r\n  and h.sil=0 and m.sil=0 and m.tarih >=@BASTAR and m.tarih <=@BITTAR\r\n  where m.zraptip in (select * from CsvToSTR(@ZTIPIN))\r\n\r\n\r\n   \r\n   if @firmano=0\r\n   begin\r\n   \r\n     insert into @TB_KDV_DURUM_EKSTRE (TIP,MATRAH,KDV_TUTAR,\r\n     KDV_ORAN,IADE_MATRAH,IADE_KDV_TUTAR)\r\n     select TIP,0,0,(KDV_ORAN*100),0,0     \r\n     from @EKSTRE_TEMP\r\n     group by TIP,KDV_ORAN\r\n   \r\n   \r\n     update @TB_KDV_DURUM_EKSTRE set \r\n     MATRAH=dt.matrah,\r\n     KDV_TUTAR=dt.kdv_tutar\r\n     from @TB_KDV_DURUM_EKSTRE as t join (\r\n     select isnull(SUM(MATRAH),0) matrah,\r\n     isnull(SUM(KDV_TUTAR),0) kdv_tutar,(KDV_ORAN*100) kdv from \r\n     @EKSTRE_TEMP where TIP='G' and TUR=1  group by TIP,KDV_ORAN ) dt on \r\n     dt.kdv=t.KDV_ORAN and t.TIP='G' \r\n     \r\n     \r\n     update @TB_KDV_DURUM_EKSTRE set \r\n     IADE_MATRAH=dt.matrah,\r\n     IADE_KDV_TUTAR=dt.kdv_tutar\r\n     from @TB_KDV_DURUM_EKSTRE as t join (\r\n     select isnull(SUM(MATRAH),0) matrah,\r\n     isnull(SUM(KDV_TUTAR),0) kdv_tutar,(KDV_ORAN*100) kdv from \r\n     @EKSTRE_TEMP where TIP='G' and TUR=3  group by TIP,KDV_ORAN ) dt on \r\n     dt.kdv=t.KDV_ORAN and t.TIP='G' \r\n     \r\n     \r\n     \r\n     update @TB_KDV_DURUM_EKSTRE set \r\n     MATRAH=dt.matrah,\r\n     KDV_TUTAR=dt.kdv_tutar\r\n     from @TB_KDV_DURUM_EKSTRE as t join (\r\n     select isnull(SUM(MATRAH),0) matrah,\r\n     isnull(SUM(KDV_TUTAR),0) kdv_tutar,(KDV_ORAN*100) kdv from \r\n     @EKSTRE_TEMP where TIP='C' and TUR in (2,4)  group by TIP,KDV_ORAN ) dt on \r\n     dt.kdv=t.KDV_ORAN and t.TIP='C'      \r\n \r\n        \r\n     \r\n     \r\n     update @TB_KDV_DURUM_EKSTRE set \r\n     IADE_MATRAH=dt.matrah,\r\n     IADE_KDV_TUTAR=dt.kdv_tutar\r\n     from @TB_KDV_DURUM_EKSTRE as t join (\r\n     select isnull(SUM(MATRAH),0) matrah,\r\n     isnull(SUM(KDV_TUTAR),0) kdv_tutar,(KDV_ORAN*100) kdv from \r\n     @EKSTRE_TEMP where TIP='C' and TUR=3  group by TIP,KDV_ORAN ) dt on \r\n     dt.kdv=t.KDV_ORAN and t.TIP='C' \r\n     \r\n     \r\n     \r\n   end  \r\n     \r\n\r\n   if @firmano>0\r\n   begin\r\n   \r\n     insert into @TB_KDV_DURUM_EKSTRE (TIP,MATRAH,KDV_TUTAR,\r\n     KDV_ORAN,IADE_MATRAH,IADE_KDV_TUTAR)\r\n     select TIP,0,0,(KDV_ORAN*100),0,0     \r\n     from @EKSTRE_TEMP\r\n     where Firmano in (@firmano,0)\r\n     group by TIP,KDV_ORAN\r\n     \r\n     \r\n     update @TB_KDV_DURUM_EKSTRE set \r\n     MATRAH=dt.matrah,\r\n     KDV_TUTAR=dt.kdv_tutar\r\n     from @TB_KDV_DURUM_EKSTRE as t join (\r\n     select isnull(SUM(MATRAH),0) matrah,\r\n     isnull(SUM(KDV_TUTAR),0) kdv_tutar,(KDV_ORAN*100) kdv from \r\n     @EKSTRE_TEMP where Firmano in (@firmano,0) and \r\n     TIP='G' and TUR=1  group by TIP,KDV_ORAN ) dt on \r\n     dt.kdv=t.KDV_ORAN and t.TIP='G' \r\n     \r\n     \r\n     \r\n     \r\n     update @TB_KDV_DURUM_EKSTRE set \r\n     IADE_MATRAH=dt.matrah,\r\n     IADE_KDV_TUTAR=dt.kdv_tutar\r\n     from @TB_KDV_DURUM_EKSTRE as t join (\r\n     select isnull(SUM(MATRAH),0) matrah,\r\n     isnull(SUM(KDV_TUTAR),0) kdv_tutar,(KDV_ORAN*100) kdv from \r\n     @EKSTRE_TEMP where Firmano in (@firmano,0) and \r\n     TIP='G' and TUR=3  group by TIP,KDV_ORAN ) dt on \r\n     dt.kdv=t.KDV_ORAN and t.TIP='G' \r\n     \r\n\r\n\r\n     update @TB_KDV_DURUM_EKSTRE set \r\n     MATRAH=dt.matrah,\r\n     KDV_TUTAR=dt.kdv_tutar\r\n     from @TB_KDV_DURUM_EKSTRE as t join (\r\n     select isnull(SUM(MATRAH),0) matrah,\r\n     isnull(SUM(KDV_TUTAR),0) kdv_tutar,(KDV_ORAN*100) kdv from \r\n     @EKSTRE_TEMP where Firmano in (@firmano,0) and \r\n     TIP='C' and TUR in (2,4)  group by TIP,KDV_ORAN ) dt on \r\n     dt.kdv=t.KDV_ORAN and t.TIP='C' \r\n     \r\n     \r\n     \r\n     update @TB_KDV_DURUM_EKSTRE set \r\n     IADE_MATRAH=dt.matrah,\r\n     IADE_KDV_TUTAR=dt.kdv_tutar\r\n     from @TB_KDV_DURUM_EKSTRE as t join (\r\n     select isnull(SUM(MATRAH),0) matrah,\r\n     isnull(SUM(KDV_TUTAR),0) kdv_tutar,(KDV_ORAN*100) kdv from \r\n     @EKSTRE_TEMP where Firmano in (@firmano,0) and \r\n     TIP='C' and TUR=3  group by TIP,KDV_ORAN ) dt on \r\n     dt.kdv=t.KDV_ORAN and t.TIP='C' \r\n   \r\n   \r\n   \r\n  \r\n   \r\n \r\n    end\r\n \r\n \r\n  update @TB_KDV_DURUM_EKSTRE\r\n   set \r\n   TOPLAM_MATRAH=MATRAH+IADE_MATRAH,\r\n   TOPLAM_KDV_TUTAR=KDV_TUTAR+IADE_KDV_TUTAR,\r\n   TIP_AD=CASE WHEN TIP='G' THEN 'ALIŞ' ELSE 'SATIŞ' END\r\n   \r\n \r\n \r\n  \r\n RETURN\r\n  \r\nEND"
  },
  {
    "schema": "dbo",
    "name": "Udf_KdvMuhKodu",
    "type": "SQL_SCALAR_FUNCTION",
    "full_name": "dbo.Udf_KdvMuhKodu",
    "definition": "CREATE FUNCTION  [dbo].[Udf_KdvMuhKodu](@tip tinyint,@kdv float)\r\nRETURNS varchar(20)\r\nAS\r\nBEGIN\r\ndeclare @val varchar(20)\r\nselect @val=(case\r\n when @tip=1 then\r\n (select top 1 isnull(deger,'') from entegre_muh_hes_kod where tip='als_kdv' and kdv_oran=@kdv)\r\n when @tip=2 then\r\n (select top 1 isnull(deger,'') from entegre_muh_hes_kod where tip='sat_kdv' and kdv_oran=@kdv)\r\n when @tip=3 then\r\n (select top 1 isnull(deger,'') from entegre_muh_hes_kod where tip='alsia_kdv' and kdv_oran=@kdv)\r\n when @tip=4 then\r\n (select top 1 isnull(deger,'') from entegre_muh_hes_kod where tip='satia_kdv' and kdv_oran=@kdv) end)\r\n return isnull(@val,'')\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_KUR_GIRIS",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_KUR_GIRIS",
    "definition": "CREATE FUNCTION [dbo].UDF_KUR_GIRIS\r\n(@tarih         datetime\r\n)\r\nRETURNS\r\n   @TB_KUR_GRS TABLE (\r\n    TARIH                DATETIME,\r\n    KOD                  VARCHAR(10) COLLATE Turkish_CI_AS,\r\n    AD                   VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    DOV_ALIS             FLOAT,\r\n    DOV_SATIS            FLOAT,\r\n    EFK_ALIS             FLOAT,\r\n    EFK_SATIS            FLOAT)\r\nAS\r\nBEGIN\r\n\r\n   insert into @TB_KUR_GRS (TARIH,KOD,AD,DOV_ALIS,DOV_SATIS,EFK_ALIS,EFK_SATIS)\r\n   select @tarih,k.kod,k.ad,\r\n   isnull(h.dov_alis,0),isnull(h.dov_alis,0),\r\n   isnull(h.efk_alis,0),isnull(h.efk_satis,0) from parabrm as k\r\n   left join para_kur as h on h.kod=k.kod and h.tarih=@tarih\r\n\r\n\r\n\r\n RETURN\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "Udf_Logo_Banka_Hrk",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.Udf_Logo_Banka_Hrk",
    "definition": "CREATE FUNCTION [dbo].[Udf_Logo_Banka_Hrk]\r\n(@Firmano\t\tint,\r\n@Islidin  varchar(8000),\r\n@Bastar DATETIME,\r\n@Bittar DATETIME)\r\nRETURNS\r\n  @TB_LOGO_BANKA TABLE (\r\n  id\t\t\t\t\t int,\r\n  hrk_id                 int,\r\n  Aktar\t\t\t\t\t int,\t\r\n  Petro_Evrak_Tip        varchar(30),\r\n  hrk_ba\t\t\t\t varchar(5) COLLATE Turkish_CI_AS,\t\r\n  hrk_tipno\t\t\t\t int,\r\n  hrk_tip\t\t\t\t varchar(30) COLLATE Turkish_CI_AS,\r\n  hrk_tipad\t\t\t\t varchar(50) COLLATE Turkish_CI_AS,\r\n  hrk_ack\t\t\t\t varchar(200) COLLATE Turkish_CI_AS,\r\n  tarih                  datetime,\r\n  saat                   varchar(10) COLLATE Turkish_CI_AS,\r\n  bnk_kod\t\t\t\tvarchar(30) COLLATE Turkish_CI_AS,\r\n  bnk_muhonkod\t\t\t varchar(30) COLLATE Turkish_CI_AS,\r\n  bnk_muhkod\t\t\tvarchar(30) COLLATE Turkish_CI_AS,\r\n  bnk_unvan\t\t\t    varchar(150) COLLATE Turkish_CI_AS,\r\n  car_tip\t\t\t\t varchar(20) COLLATE Turkish_CI_AS,\r\n  car_kod\t\t\t\t varchar(30) COLLATE Turkish_CI_AS,\r\n  car_muhonkod\t\t\t varchar(30) COLLATE Turkish_CI_AS,\r\n  car_muhkod\t\t\t varchar(30) COLLATE Turkish_CI_AS,\r\n  car_unvan\t\t\t\t varchar(150) COLLATE Turkish_CI_AS,\r\n  belgeno\t\t\t     Varchar(20) COLLATE Turkish_CI_AS,\r\n  gid_muhonkod\t\t\t Varchar(30) COLLATE Turkish_CI_AS,\r\n  gid_muhkod             Varchar(30) COLLATE Turkish_CI_AS,\r\n  gider_tut              float,\r\n  geneltop\t\t\t     float,\r\n  giren\t\t\t\t\t float,\r\n  cikan\t\t\t\t\t float,\r\n  olustarsaat            datetime\r\n  )\r\nAS\r\nBEGIN\r\n\r\n/*\r\n  16777216\t        318767104\r\n  49\t65536\t      3211264\r\n  28\t256\t             7168\r\n  */\r\n\r\n\r\n\r\n/* BNK_B-C  GİDEN HAVALE / EFT */\r\n/* BNK_C-B GELEN HAVALE / EFT */\r\n/* VIR_VRG     VİRMAN GİRİŞ */\r\n/* VIR_VRC     VİRMAN ÇIKIŞ */\r\n\r\n  declare @Muh_PosCarMuhKod  varchar(50)\r\n  declare @Muh_PosGidMuhKod  varchar(50)\r\n  declare @Muh_PosCarOnKod  varchar(50)\r\n  declare @Muh_PosGidOnKod  varchar(50)\r\n  \r\n  \r\n  declare @Muh_BankGidOnKod  varchar(50)\r\n  declare @Muh_BankGidMuhKod  varchar(50)\r\n  \r\n  \r\n  /*select @Muh_PosCarKod=Muh_PosCarKod, */\r\n   /* @Muh_PosGidKod=Muh_PosGidKod from sistemtanim */\r\n  \r\n  \r\n   select @Muh_PosCarMuhKod=Entegre_PosCarMuhKod,\r\n    @Muh_PosCarOnKod=Entegre_PosCarOnMuhKod,\r\n    @Muh_PosGidMuhKod=Entegre_PosGidMuhKod,\r\n    @Muh_PosGidOnKod=Entegre_PosGidOnMuhKod, \r\n    @Muh_BankGidOnKod=Entegre_BankGidOnMuhKod, \r\n    @Muh_BankGidMuhKod=Entegre_BankGidMuhKod \r\n    \r\n    from Firma Where id=@Firmano\r\n   \r\n\r\n  if (select count(*) from CsvToInt(@Islidin) \r\n    where IntValue='28')>0\r\n     set @Islidin=@Islidin+',29,30'\r\n\r\n if @Firmano=0\r\n  insert into @TB_LOGO_BANKA\r\n  (id,hrk_id,Aktar,Petro_Evrak_Tip,hrk_ba,\r\n  hrk_tip,hrk_tipno,hrk_tipad,hrk_ack,\r\n  tarih,saat,\r\n  bnk_kod,bnk_muhonkod,bnk_muhkod,bnk_unvan,\r\n  car_tip,car_kod,car_muhonkod,car_muhkod,car_unvan,\r\n  gid_muhonkod,gid_muhkod,\r\n  belgeno,gider_tut,\r\n  geneltop,olustarsaat)\r\n\r\n  select m.id,m.bankhrkid,\r\n  case when (m.islmtip+'_'+m.islmhrk='VIR_VRG') then 0\r\n  else 1 end,\r\n  'bnk',\r\n  hrk_ba=case when borc>0 then 'B' else 'A' end,\r\n  hrk_tip=(m.islmtip+'_'+m.islmhrk),\r\n   hrk_tipno=case\r\n     when (m.islmtip+'_'+m.islmhrk='BNK_C-B') then 3\r\n     when (m.islmtip+'_'+m.islmhrk='BNK_B-C') then 4\r\n     when (m.islmtip+'_'+m.islmhrk='VIR_VRC') then 2\r\n     when (m.islmtip+'_'+m.islmhrk='VIR_VRG') then 2\r\n     \r\n     when (m.islmtip+'_'+m.islmhrk='BNK_SLO') then 3\r\n     when (m.islmtip+'_'+m.islmhrk='BNK_BKK') then 4\r\n     when (m.islmtip+'_'+m.islmhrk='BNK_EKK') then 4\r\n     else 1 end,\r\n     case\r\n     when (m.islmtip+'_'+m.islmhrk='BNK_C-B') then 'GELEN HAVALE / EFT'\r\n     when (m.islmtip+'_'+m.islmhrk='BNK_B-C') then 'GİDEN HAVALE / EFT'\r\n     when (m.islmtip+'_'+m.islmhrk='VIR_VRC') then 'VİRMAN ÇIKIŞ'\r\n     when (m.islmtip+'_'+m.islmhrk='VIR_VRG') then 'VİRMAN GİRİŞ' \r\n     when (m.islmtip+'_'+m.islmhrk='BNK_SLO') then 'POS AKTARIM'\r\n     when (m.islmtip+'_'+m.islmhrk='BNK_BKK') then 'POS KOMİSYON'\r\n     when (m.islmtip+'_'+m.islmhrk='BNK_EKK') then 'POS EK KOMİSYON'\r\n     end,\r\n    m.ack,   \r\n    m.tarih,m.saat,\r\n    m.bankod,car.muhonkod,car.muhkod,car.ad,\r\n    case \r\n    when (m.islmtip+'_'+m.islmhrk='BNK_SLO') then '-'  /*carikart */\r\n    when (m.islmtip+'_'+m.islmhrk='BNK_BKK') then '-' /*gelgidkart */\r\n    when (m.islmtip+'_'+m.islmhrk='BNK_EKK') then '-'\r\n    else m.cartip end,\r\n    case \r\n    when (m.islmtip+'_'+m.islmhrk='BNK_SLO') then @Muh_PosCarMuhKod\r\n    when (m.islmtip+'_'+m.islmhrk='BNK_BKK') then @Muh_PosGidMuhKod\r\n    when (m.islmtip+'_'+m.islmhrk='BNK_EKK') then @Muh_PosGidMuhKod\r\n    else m.carkod end,\r\n    case\r\n    when (m.islmtip+'_'+m.islmhrk='BNK_SLO') then @Muh_PosCarOnKod\r\n    when (m.islmtip+'_'+m.islmhrk='BNK_BKK') then @Muh_PosGidOnKod\r\n    when (m.islmtip+'_'+m.islmhrk='BNK_EKK') then @Muh_PosGidOnKod\r\n    else '' end,\r\n    case\r\n    when (m.islmtip+'_'+m.islmhrk='BNK_SLO') then @Muh_PosCarMuhKod\r\n    when (m.islmtip+'_'+m.islmhrk='BNK_BKK') then @Muh_PosGidMuhKod\r\n    when (m.islmtip+'_'+m.islmhrk='BNK_EKK') then @Muh_PosGidMuhKod\r\n    else '' end,    \r\n    '',\r\n  belgeno=m.belno,\r\n  @Muh_BankGidOnKod,@Muh_BankGidMuhKod, \r\n  gider_tut=isnull(gidtutar,0),\r\n  geneltop=abs(m.borc-m.alacak),\r\n  olustarsaat=m.olustarsaat\r\n  from bankahrk as m \r\n  inner join islemhrktip as isl on\r\n  (isl.tip+'_'+isl.hrk)=(m.islmtip+'_'+m.islmhrk)\r\n  left join Genel_Kart as car on \r\n  car.cartp='bankakart'\r\n  and car.kod=m.bankod \r\n  Where sil=0\r\n  and m.tarih>=@bastar and m.tarih <=@bittar\r\n  and isl.id in (select * from CsvToInt(@Islidin) )\r\n  order by m.id\r\n  \r\n  \r\n  if @Firmano>0\r\n  insert into @TB_LOGO_BANKA\r\n  (id,hrk_id,Aktar,Petro_Evrak_Tip,hrk_ba,\r\n  hrk_tip,hrk_tipno,hrk_tipad,hrk_ack,\r\n  tarih,saat,\r\n  bnk_kod,bnk_muhonkod,bnk_muhkod,bnk_unvan,\r\n  car_tip,car_kod,car_muhonkod,car_muhkod,car_unvan,\r\n  belgeno,\r\n  gid_muhonkod,gid_muhkod,gider_tut,\r\n  geneltop,olustarsaat)\r\n\r\n  select m.id,m.bankhrkid,\r\n  case when (m.islmtip+'_'+m.islmhrk='VIR_VRG') then 0\r\n  else 1 end,\r\n  'bnk',\r\n  hrk_ba=case when borc>0 then 'B' else 'A' end,\r\n  hrk_tip=(m.islmtip+'_'+m.islmhrk),\r\n   hrk_tipno=case\r\n     when (m.islmtip+'_'+m.islmhrk='BNK_C-B') then 3\r\n     when (m.islmtip+'_'+m.islmhrk='BNK_B-C') then 4\r\n     when (m.islmtip+'_'+m.islmhrk='VIR_VRC') then 2\r\n     when (m.islmtip+'_'+m.islmhrk='VIR_VRG') then 2\r\n     \r\n     when (m.islmtip+'_'+m.islmhrk='BNK_SLO') then 3\r\n     when (m.islmtip+'_'+m.islmhrk='BNK_BKK') then 4\r\n     when (m.islmtip+'_'+m.islmhrk='BNK_EKK') then 4\r\n     \r\n     else 1 end,\r\n     case\r\n     when (m.islmtip+'_'+m.islmhrk='BNK_C-B') then 'GELEN HAVALE / EFT'\r\n     when (m.islmtip+'_'+m.islmhrk='BNK_B-C') then 'GİDEN HAVALE / EFT'\r\n     when (m.islmtip+'_'+m.islmhrk='VIR_VRC') then 'VİRMAN ÇIKIŞ'\r\n     when (m.islmtip+'_'+m.islmhrk='VIR_VRG') then 'VİRMAN GİRİŞ' \r\n     when (m.islmtip+'_'+m.islmhrk='BNK_SLO') then 'POS AKTARIM'\r\n     when (m.islmtip+'_'+m.islmhrk='BNK_BKK') then 'POS KOMİSYON'\r\n     when (m.islmtip+'_'+m.islmhrk='BNK_EKK') then 'POS EK KOMİSYON'\r\n     end,\r\n    m.ack,   \r\n    m.tarih,m.saat,\r\n    m.bankod,car.muhonkod,car.muhkod,car.ad,\r\n    case \r\n    when (m.islmtip+'_'+m.islmhrk='BNK_SLO') then '-'  /*carikart */\r\n    when (m.islmtip+'_'+m.islmhrk='BNK_BKK') then '-' /*gelgidkart */\r\n    when (m.islmtip+'_'+m.islmhrk='BNK_EKK') then '-'\r\n    else m.cartip end,\r\n    case \r\n    when (m.islmtip+'_'+m.islmhrk='BNK_SLO') then @Muh_PosCarMuhKod\r\n    when (m.islmtip+'_'+m.islmhrk='BNK_BKK') then @Muh_PosGidMuhKod\r\n    when (m.islmtip+'_'+m.islmhrk='BNK_EKK') then @Muh_PosGidMuhKod\r\n    else m.carkod end,\r\n    case\r\n    when (m.islmtip+'_'+m.islmhrk='BNK_SLO') then @Muh_PosCarOnKod\r\n    when (m.islmtip+'_'+m.islmhrk='BNK_BKK') then @Muh_PosGidOnKod\r\n    when (m.islmtip+'_'+m.islmhrk='BNK_EKK') then @Muh_PosGidOnKod\r\n    else '' end,\r\n    case\r\n    when (m.islmtip+'_'+m.islmhrk='BNK_SLO') then @Muh_PosCarMuhKod\r\n    when (m.islmtip+'_'+m.islmhrk='BNK_BKK') then @Muh_PosGidMuhKod\r\n    when (m.islmtip+'_'+m.islmhrk='BNK_EKK') then @Muh_PosGidMuhKod\r\n    else '' end,\r\n    '',\r\n    belgeno=m.belno, \r\n     @Muh_BankGidOnKod,@Muh_BankGidMuhKod,   \r\n     gider_tut=isnull(gidtutar,0),\r\n    geneltop=abs(m.borc-m.alacak),\r\n    olustarsaat=m.olustarsaat\r\n    from bankahrk as m \r\n    inner join islemhrktip as isl on\r\n    (isl.tip+'_'+isl.hrk)=(m.islmtip+'_'+m.islmhrk)\r\n    left join Genel_Kart as car on \r\n    car.cartp='bankakart'\r\n    and car.kod=m.bankod \r\n    Where sil=0 and m.firmano in (0,@Firmano)\r\n    and m.tarih>=@bastar and m.tarih <=@bittar\r\n    and isl.id in (select * from CsvToInt(@Islidin) )\r\n    order by m.id\r\n  \r\n  \r\n  \r\n  \r\n  \r\n   update @TB_LOGO_BANKA set\r\n   giren=case when hrk_BA='B' then \r\n   geneltop else 0 end,\r\n   cikan=case when hrk_BA='A' then \r\n   geneltop else 0 end\r\n   \r\n   \r\n   update @TB_LOGO_BANKA set\r\n   car_muhonkod=car.muhonkod,\r\n   car_muhkod=car.muhkod,\r\n   car_unvan=car.ad\r\n   from @TB_LOGO_BANKA as t\r\n   inner join Genel_Kart as car on \r\n   car.cartp=t.car_tip and \r\n   car.kod=t.car_kod \r\n   \r\n\r\n   \r\n\r\n return\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "Udf_Logo_Cek_Hrk",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.Udf_Logo_Cek_Hrk",
    "definition": "CREATE FUNCTION [dbo].[Udf_Logo_Cek_Hrk]\r\n(@Firmano   int,\r\n@Islidin  varchar(8000),\r\n@Bastar DATETIME,\r\n@Bittar DATETIME)\r\nRETURNS\r\n  @TB_LOGO_CEK TABLE (\r\n  id\t\t\t\t\t int,\r\n  firmano                int,\r\n  islmhrk_id             int,\r\n  hrk_id                 int,\r\n  Aktar\t\t\t\t\t int,\t\r\n  Petro_Evrak_Tip        varchar(30),\r\n  hrk_ba\t\t\t\t varchar(5),\t\r\n  hrk_tipno\t\t\t\t int,\r\n  hrk_tip\t\t\t\t varchar(30),\r\n  hrk_tipad\t\t\t\t varchar(50),\r\n  hrk_ack\t\t\t\t varchar(200),\r\n  tarih                  datetime,\r\n  saat                   varchar(10),\r\n  vadetarih              datetime,\r\n  car_tip\t\t\t\t varchar(20),  \r\n  car_kod\t\t\t\tvarchar(30),\r\n  car_muhonkod\t\t\t varchar(30),\r\n  car_muhkod\t\t\tvarchar(30),\r\n  car_unvan\t\t\t    varchar(150),\r\n  vcar_tip\t\t\t\t varchar(20),\r\n  vcar_kod\t\t\t\t varchar(30),\r\n  vcar_muhonkod\t\t\t varchar(30),\r\n  vcar_muhkod\t\t\t varchar(30),\r\n  vcar_unvan\t\t\t varchar(150),\r\n  Banka_kod\t\t\t\t varchar(30),\r\n  Banka_muhonkod\t\t varchar(30),\r\n  Banka_Unvan\t\t     varchar(150),\r\n  belgeno\t\t\t     Varchar(20),\r\n  gider_tut              float,\r\n  geneltop\t\t\t     float,\r\n  giren\t\t\t\t\t float,\r\n  cikan\t\t\t\t\t float,\r\n  olustarsaat            datetime\r\n  )\r\nAS\r\nBEGIN\r\n\r\n\r\n\r\n\r\n if @Firmano=0 \r\n  insert into @TB_LOGO_CEK\r\n  (id,firmano,islmhrk_id,hrk_id,Aktar,Petro_Evrak_Tip,hrk_ba,\r\n  hrk_tip,hrk_tipno,hrk_tipad,hrk_ack,\r\n  tarih,saat,vadetarih,\r\n  car_tip,car_kod,car_muhonkod,car_muhkod,car_unvan,\r\n  vcar_tip,vcar_kod,vcar_muhonkod,vcar_muhkod,vcar_unvan,\r\n  banka_kod,Banka_muhonkod,Banka_Unvan,\r\n  belgeno,gider_tut,geneltop,olustarsaat)\r\n\r\n   select m.id,m.firmano,isl.id,m.cekid,\r\n  case \r\n  /*when (m.islmtip+'_'+m.drm='CEK_POR') then 1 */\r\n  /*when (m.islmtip+'_'+m.drm='CEK_KSN') then 1  else 0 end, */\r\n  when (m.islmhrk='ALN') then 1\r\n  when (m.islmhrk='KSN') then 1  else 0 end,\r\n  'cek',\r\n  hrk_ba=case when giren>0 then 'B' else 'A' end,\r\n  hrk_tip=(m.islmtip+'_'+m.islmhrk),\r\n   hrk_tipno=case\r\n    /* when (m.islmtip+'_'+m.drm='CEK_POR') then 1 */\r\n    /* when (m.islmtip+'_'+m.drm='CEK_KSN') then 3 */\r\n     /* else 1 end, */\r\n     when (m.islmhrk='ALN') then 1\r\n     when (m.islmhrk='KSN') then 3  else 1 end,  \r\n    case\r\n    /* when (m.islmtip+'_'+m.drm='CEK_POR') then 'CPOR' */\r\n    /* when (m.islmtip+'_'+m.drm='CEK_KSN') then 'CKSN' */\r\n    \r\n     when (m.islmhrk='ALN') then 'CPOR'\r\n     when (m.islmhrk='KSN') then 'CKSN'\r\n    end,\r\n    m.ack,   \r\n    m.tarih,m.saat,m.vadetar,\r\n    m.cartip,m.carkod,car.muhonkod,car.muhkod,car.ad,\r\n    m.vercartip,m.vercarkod,vcar.muhonkod,vcar.muhkod,vcar.ad,\r\n    m.bankod,b.muhonkod,b.ad,\r\n   belgeno=m.ceksenno, /* Varchar(15) */\r\n   gider_tut=0,\r\n   geneltop=abs(m.giren-m.cikan),\r\n   olustarsaat=m.olustarsaat\r\n   from cekkart as m \r\n   inner join islemhrktip as isl on\r\n   (isl.tip+'_'+isl.hrk)=(m.islmtip+'_'+m.islmhrk)\r\n   left join Genel_Kart as car on car.cartp=m.cartip\r\n   and car.kod=m.carkod \r\n   left join Genel_Kart as vcar on vcar.cartp=m.vercartip\r\n   and vcar.kod=m.vercarkod \r\n   left join Genel_Kart as b on b.cartp='bankakart'\r\n   and b.kod=m.bankod\r\n   Where sil=0 and m.varno=0\r\n   and m.tarih>=@bastar and m.tarih <=@bittar\r\n  /* and m.drm in ('POR','KSN') */\r\n  /*  and isnull(m.Entegre,0)=0  */\r\n   order by m.id\r\n  \r\n\r\n  if @Firmano>0 \r\n  insert into @TB_LOGO_CEK\r\n  (id,firmano,islmhrk_id,hrk_id,Aktar,Petro_Evrak_Tip,hrk_ba,\r\n  hrk_tip,hrk_tipno,hrk_tipad,hrk_ack,\r\n  tarih,saat,vadetarih,\r\n  car_tip,car_kod,car_muhonkod,car_muhkod,car_unvan,\r\n  vcar_tip,vcar_kod,vcar_muhonkod,vcar_muhkod,vcar_unvan,\r\n  banka_kod,Banka_muhonkod,Banka_Unvan,\r\n  belgeno,gider_tut,\r\n  geneltop,olustarsaat)\r\n\r\n  select m.id,m.firmano,isl.id,m.cekid,\r\n  case \r\n  /*when (m.islmtip+'_'+m.drm='CEK_POR') then 1 */\r\n  /*when (m.islmtip+'_'+m.drm='CEK_KSN') then 1  else 0 end, */\r\n  when (m.islmhrk='ALN') then 1\r\n  when (m.islmhrk='KSN') then 1  else 0 end,\r\n  'cek',\r\n  hrk_ba=case when giren>0 then 'B' else 'A' end,\r\n  hrk_tip=(m.islmtip+'_'+m.islmhrk),\r\n   hrk_tipno=case\r\n    /* when (m.islmtip+'_'+m.drm='CEK_POR') then 1 */\r\n    /* when (m.islmtip+'_'+m.drm='CEK_KSN') then 3 */\r\n     /* else 1 end, */\r\n     when (m.islmhrk='ALN') then 1\r\n     when (m.islmhrk='KSN') then 3  else 1 end,  \r\n    case\r\n    /* when (m.islmtip+'_'+m.drm='CEK_POR') then 'CPOR' */\r\n    /* when (m.islmtip+'_'+m.drm='CEK_KSN') then 'CKSN' */\r\n    \r\n     when (m.islmhrk='ALN') then 'CPOR'\r\n     when (m.islmhrk='KSN') then 'CKSN'\r\n    end,\r\n    m.ack,   \r\n    m.tarih,m.saat,m.vadetar,\r\n    m.cartip,m.carkod,car.muhonkod,car.muhkod,car.ad,\r\n    m.vercartip,m.vercarkod,vcar.muhonkod,vcar.muhkod,vcar.ad,\r\n    m.bankod,b.muhonkod,b.ad,\r\n   belgeno=m.ceksenno, /* Varchar(15) */\r\n   gider_tut=0,\r\n   geneltop=abs( m.giren-m.cikan),\r\n   olustarsaat=m.olustarsaat\r\n   from cekkart as m \r\n   inner join islemhrktip as isl on\r\n   (isl.tip+'_'+isl.hrk)=(m.islmtip+'_'+m.islmhrk)\r\n   left join Genel_Kart as car on car.cartp=m.cartip\r\n   and car.kod=m.carkod \r\n   left join Genel_Kart as vcar on vcar.cartp=m.vercartip\r\n   and vcar.kod=m.vercarkod \r\n   left join Genel_Kart as b on b.cartp='bankakart'\r\n   and b.kod=m.bankod \r\n   \r\n   Where sil=0 and m.varno=0 and m.firmano in (0,@Firmano)\r\n   and m.tarih>=@bastar and m.tarih <=@bittar\r\n  /* and m.drm in ('POR','KSN') */\r\n   \r\n   \r\n   /* and isnull(m.Entegre,0)=0  */\r\n   order by m.id\r\n\r\n\r\n  \r\n   if @Islidin<>''\r\n    delete from @TB_LOGO_CEK Where islmhrk_id not in (select * from CsvToInt(@Islidin) )\r\n  \r\n  \r\n   update @TB_LOGO_CEK set\r\n    car_unvan=vcar_unvan \r\n    where hrk_tipno=3 \r\n   \r\n  \r\n   update @TB_LOGO_CEK set\r\n   giren=case when hrk_BA='A' then \r\n   geneltop else 0 end,\r\n   cikan=case when hrk_BA='B' then \r\n   geneltop else 0 end\r\n   \r\n   \r\n  \r\n\r\n\r\n return\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "Udf_Logo_Fatura_Firma_Hrk",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.Udf_Logo_Fatura_Firma_Hrk",
    "definition": "CREATE FUNCTION [dbo].[Udf_Logo_Fatura_Firma_Hrk]\r\n(@Firmano   int,\r\n@fatRapin  varchar(8000),\r\n@Bastar DATETIME,\r\n@Bittar DATETIME)\r\nRETURNS\r\n  @TB_LOGO_FATURA TABLE (\r\n  fat_id                 int,\r\n  FatRap_id\t\t\t\t int,\r\n  Petro_Evrak_Tip        varchar(30),\r\n  hrk_tipno\t\t\t\t int,\r\n  fat_tarih              datetime,\r\n  fat_saat               varchar(10),\r\n  stk_logo_tip           int,                \r\n  stk_kod\t\t\t\t varchar(30),\r\n  stk_muhonkod\t\t\t varchar(30),\r\n  stk_muhkod\t\t\t varchar(30),\r\n  stk_muhkdvkod\t\t\t varchar(30), \r\n  stk_brim\t\t\t\t varchar(5),\r\n  stk_brmfiy\t\t\t float,\r\n  stk_brmfiykdvli    \t float,\r\n  stk_miktar\t\t\t float,\r\n  stk_isktop\t\t\t float,\t\t\t\t\t\r\n  stk_kdv     \t\t\t float,\r\n  stk_kdvtop     \t     float,\r\n  stk_aratop             float,\r\n  stk_isktolutop         float,\r\n  stk_olustarsaat        datetime\r\n  )\r\nAS\r\nBEGIN\r\n\r\n  insert into @TB_LOGO_FATURA\r\n  (fat_id,FatRap_id,Petro_Evrak_Tip,hrk_tipno,fat_tarih,\r\n  fat_saat,stk_logo_tip,stk_kod,stk_muhonkod,\r\n  stk_muhkod,stk_muhkdvkod,stk_brim,\r\n  stk_brmfiy,stk_brmfiykdvli,\r\n  stk_miktar,stk_isktop,stk_kdv,stk_kdvtop,\r\n  stk_aratop,stk_isktolutop,\r\n  stk_olustarsaat)\r\n\r\n  select m.fatid,m.fatrap_id,m.fattip,\r\n  cha_tip=case\r\n     when (m.gctip=2) and (m.fattip='FATVERSAT')  then 7\r\n     when (m.gctip=2) and (m.fattip<>'FATVERSAT') then 8\r\n     when m.gctip=1 then 1\r\n     when m.fattip='FATIADALS' then  8\r\n     when m.fattip='FATIADSAT' then  1 end, /*0 borc ,1 alacak */\r\n    m.tarih,m.saat,\r\n    case \r\n    when h.stktip='akykt' then  0\r\n    when h.stktip='markt' then  0\r\n    when h.stktip='gelgid' then 4 \r\n    end,\r\n    h.stkod,sk.muhonkod,\r\n    case\r\n     when (m.gctip=1) then   sk.muhgrskod\r\n     when (m.gctip=2) then  sk.muhckskod\r\n     when m.fattip='FATIADALS' then  sk.muhckskod\r\n     when m.fattip='FATIADSAT' then  sk.muhgrskod end,\r\n     case\r\n     when (m.gctip=1)  then dbo.Udf_KdvMuhKodu(1,sk.sat1kdv)\r\n     when (m.gctip=2) then dbo.Udf_KdvMuhKodu(2,sk.sat1kdv)\r\n     when m.fattip='FATIADALS' then dbo.Udf_KdvMuhKodu(3,sk.sat1kdv)\r\n     when m.fattip='FATIADSAT' then dbo.Udf_KdvMuhKodu(4,sk.sat1kdv)\r\n     end,\r\n    h.brim,\r\n    h.brmfiy,\r\n    (h.brmfiy*(1+h.kdvyuz)),\r\n    (h.mik*carpan),\r\n    h.genisktut,\r\n    (h.kdvyuz*100),\r\n    h.kdvtut*h.mik,(h.mik*carpan)*h.brmfiy,\r\n    ((h.mik*carpan)*h.brmfiy)-h.genisktut,\r\n   stk_olustarsaat=m.olustarsaat\r\n  from faturahrk as h \r\n  inner join faturamas as m \r\n  on h.fatid=m.fatid and h.sil=0 and m.sil=0 and m.firmano=@Firmano\r\n  and isnull(m.Entegre,0)=0 \r\n  left join gelgidlistok as sk on sk.tip=h.stktip and sk.kod=h.stkod\r\n  Where m.tarih>=@bastar and m.tarih <=@bittar\r\n  and m.FatTip_id in (select * from CsvToSTR(@fatRapin) )\r\n   order by m.fatid\r\n   \r\n   \r\n   \r\n \r\n   \r\n   \r\n\r\n return\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "Udf_Logo_Fatura_Firma_Mas",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.Udf_Logo_Fatura_Firma_Mas",
    "definition": "CREATE FUNCTION [dbo].[Udf_Logo_Fatura_Firma_Mas]\r\n(@Firmano int,\r\n@fatRapin  varchar(8000),\r\n@Bastar DATETIME,\r\n@Bittar DATETIME)\r\nRETURNS\r\n  @TB_LOGO_FATURA TABLE (\r\n  fat_id                 int,\r\n  FatRap_id\t\t\t\t int,\r\n  Petro_Evrak_Tip        varchar(30),\r\n  hrk_tipno\t\t\t\t int,\r\n  hrk_tip\t\t\t\t varchar(5),\r\n  hrk_tipad\t\t\t\t varchar(50),\r\n  hrk_ack\t\t\t\t varchar(200),\r\n  tarih                  datetime,\r\n  saat                   varchar(10),\r\n  car_kod\t\t\t\t varchar(30),\r\n  car_muhonkod\t\t\t varchar(30),\r\n  car_muhkod\t\t\t varchar(30),\r\n  car_unvan\t\t\t\t varchar(150),\r\n  belgeno\t\t\t     Varchar(20),\r\n  fat_gider              float,\r\n  fat_iskonto\t\t\t float,\r\n  fat_isk_yuz            float,\t\t\t\t\t\r\n  fat_kdvtop\t\t\t float,\r\n  fat_aratop\t\t\t float,\r\n  fat_geneltop\t\t\t float,\r\n  giren\t\t\t\t\t float,\r\n  cikan\t\t\t\t\t float,\r\n  fat_olustarsaat        datetime\r\n  )\r\nAS\r\nBEGIN\r\n\r\n/*\r\n  16777216\t        318767104\r\n  49\t65536\t      3211264\r\n  28\t256\t             7168\r\n  */\r\n\r\n\r\n   \r\n\r\n\r\n\r\n  insert into @TB_LOGO_FATURA\r\n  (fat_id,FatRap_id,Petro_Evrak_Tip,\r\n  hrk_tip,hrk_tipno,hrk_tipad,hrk_ack,\r\n  tarih,saat,car_kod,car_muhonkod,car_muhkod,car_unvan,\r\n  belgeno,fat_gider,\r\n  fat_aratop,\r\n  fat_iskonto,fat_isk_yuz,fat_kdvtop,\r\n  fat_geneltop,\r\n  fat_olustarsaat)\r\n\r\n  select m.fatid,m.fatrap_id,\r\n  m.fattip,\r\n  hrk_tip='fat',\r\n  hrk_tipno=case\r\n     when (m.gctip=2) and (m.fattip='FATVERSAT')  then 7\r\n     when (m.gctip=2) and (m.fattip<>'FATVERSAT') then 8\r\n     when m.gctip=1 then 1\r\n     when m.fattip='FATIADALS' then  8\r\n     when m.fattip='FATIADSAT' then  1 end, /*0 borc ,1 alacak */\r\n     case\r\n     when m.gctip=2 then  'SATIŞ FATURASI'\r\n     when m.gctip=1 then  'ALIŞ FATURASI'\r\n     when m.fattip='FATIADALS' then  'ALIŞDAN YADE FATURASI'\r\n     when m.fattip='FATIADSAT' then  'SATIŞDAN YADE FATURASI' end,\r\n     \r\n   \r\n     m.ack,   \r\n    m.tarih,m.saat,\r\n    m.carkod,car.muhonkod,car.muhkod,\r\n    car.ad,\r\n  fat_serino=m.fatseri+cast(m.fatno as varchar), /* Varchar(15) */\r\n  fat_gider=m.gidertop,\r\n  fat_aratop=m.genel_ara_top,\r\n  fat_iskonto=(m.genel_isk_top),\r\n  fat_isk_yuz=(m.genel_isk_top*100)/m.fattop,\r\n  fat_kdvtop=m.genel_kdv_top,/*kdv genel tutar */\r\n  fat_geneltop=m.genel_top,\r\n  fat_olustarsaat=m.olustarsaat\r\n  from faturamas as m \r\n  left join Genel_Kart as car on car.cartp=m.cartip \r\n  and car.kod=m.carkod   \r\n  Where sil=0 and m.firmano=@firmano and isnull(m.Entegre,0)=0 \r\n  and m.tarih>=@bastar and m.tarih <=@bittar\r\n  and m.FatTip_id in (select * from CsvToSTR(@fatRapin) )\r\n  order by m.fatid\r\n  \r\n  update @TB_LOGO_FATURA set\r\n  /*fat_aratop=fat_aratop,--fat_geneltop-fat_kdvtop,  */\r\n  giren=case when hrk_tipno=1 then \r\n  fat_geneltop else 0 end,\r\n  cikan=case \r\n  when (hrk_tipno=7) or (hrk_tipno=8) then \r\n  fat_geneltop else 0 end\r\n\r\n  \r\n  update @TB_LOGO_FATURA set\r\n  /*fat_aratop=fat_aratop,--fat_geneltop-fat_kdvtop,  */\r\n  giren=case when hrk_tipno=1 then \r\n  fat_geneltop else 0 end,\r\n  cikan=case \r\n  when (hrk_tipno=7) or (hrk_tipno=8) then \r\n  fat_geneltop else 0 end  \r\n  \r\n  \r\n\r\n  \r\n\r\n\r\n\r\n  \r\n\r\n return\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "Udf_Logo_Fatura_Hrk",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.Udf_Logo_Fatura_Hrk",
    "definition": "CREATE FUNCTION [dbo].[Udf_Logo_Fatura_Hrk]\r\n(@Firmano\t\tint,\r\n@fatRapin  varchar(8000),\r\n@Bastar DATETIME,\r\n@Bittar DATETIME,\r\n@AkaryakitBrm   Varchar(20),\r\n@MarketBrm   Varchar(20),\r\n@MasrafBrm   Varchar(20))\r\nRETURNS\r\n  @TB_LOGO_FATURA TABLE (\r\n  Firmano\t\t\t\t int,\r\n  fat_id                 int,\r\n  FatRap_id\t\t\t\t int,\r\n  Petro_Evrak_Tip        varchar(30),\r\n  hrk_tipno\t\t\t\t int,\r\n  fat_tarih              datetime,\r\n  fat_saat               varchar(10),\r\n  stk_logo_tip           int,                \r\n  stk_kod\t\t\t\t varchar(50),\r\n  stk_muhonkod\t\t\t varchar(50),\r\n  stk_muhkod\t\t\t varchar(50),\r\n  stk_muhkdvkod\t\t\t varchar(50), \r\n  stk_brim\t\t\t\t varchar(5),\r\n  stk_tip\t\t\t\t varchar(10),\r\n  stk_brmfiy\t\t\t float,\r\n  stk_brmfiykdvli    \t float,\r\n  stk_miktar\t\t\t float,\r\n  stk_isktop\t\t\t float,\t\t\t\t\t\r\n  stk_kdv     \t\t\t float,\r\n  stk_kdvtop     \t     float,\r\n  stk_aratop             float,\r\n  stk_isktolutop         float,\r\n  stk_olustarsaat        datetime\r\n  )\r\nAS\r\nBEGIN\r\n\r\n declare @MarketKdv0OnMuhKod varchar(50)\r\n declare @MarketKdv1OnMuhKod varchar(50)\r\n declare @MarketKdv8OnMuhKod varchar(50)\r\n declare @MarketKdv18OnMuhKod varchar(50)\r\n \r\n  \r\n \r\n select @MarketKdv0OnMuhKod=EntegreMarketKdv0OnMuhKod,\r\n @MarketKdv1OnMuhKod=EntegreMarketKdv1OnMuhKod,\r\n @MarketKdv8OnMuhKod=EntegreMarketKdv8OnMuhKod,\r\n @MarketKdv18OnMuhKod=EntegreMarketKdv18OnMuhKod\r\n from firma where id=@Firmano\r\n \r\n\r\n\r\n  insert into @TB_LOGO_FATURA\r\n  (Firmano,fat_id,FatRap_id,Petro_Evrak_Tip,hrk_tipno,fat_tarih,\r\n  fat_saat,stk_logo_tip,stk_kod,stk_muhonkod,\r\n  stk_muhkod,stk_muhkdvkod,stk_brim,stk_tip,\r\n  stk_brmfiy,stk_brmfiykdvli,\r\n  stk_miktar,stk_isktop,stk_kdv,stk_kdvtop,\r\n  stk_aratop,stk_isktolutop,stk_olustarsaat)\r\n\r\n  select m.firmano,m.fatid,m.fatrap_id,m.fattip,\r\n  cha_tip=case\r\n     when (m.gctip=2) and (m.fattip='FATVERSAT')  then 7\r\n     when (m.gctip=2) and (m.fattip<>'FATVERSAT') then 8\r\n     when m.gctip=1 then 1\r\n     when m.fattip='FATIADALS' then  8\r\n     when m.fattip='FATIADSAT' then  1 end, /*0 borc ,1 alacak */\r\n    m.tarih,m.saat,\r\n    case \r\n    when h.stktip='akykt' then  0\r\n    when h.stktip='markt' then  0\r\n    when h.stktip='gelgid' then 4 \r\n    end,\r\n    h.stkod,\r\n    sk.muhonkod,\r\n    case\r\n     when (m.gctip=1) then  sk.muhgrskod\r\n     when (m.gctip=2) then  sk.muhckskod\r\n     when m.fattip='FATIADALS' then  sk.muhckskod\r\n     when m.fattip='FATIADSAT' then  sk.muhgrskod end,\r\n     case\r\n     when (m.gctip=1)  then dbo.Udf_KdvMuhKodu(1,sk.sat1kdv)\r\n     when (m.gctip=2) then dbo.Udf_KdvMuhKodu(2,sk.sat1kdv)\r\n     when m.fattip='FATIADALS' then dbo.Udf_KdvMuhKodu(3,sk.sat1kdv)\r\n     when m.fattip='FATIADSAT' then dbo.Udf_KdvMuhKodu(4,sk.sat1kdv)\r\n     end,\r\n    case \r\n    when h.stktip='akykt' then  @AkaryakitBrm\r\n    when h.stktip='markt' then  @MarketBrm\r\n    when h.stktip='gelgid' then @MasrafBrm\r\n    end,\r\n    h.stktip,    \r\n    \r\n    h.brmfiy,\r\n    (h.brmfiy*(1+h.kdvyuz)),\r\n    (h.mik*carpan),\r\n    h.genisktut,\r\n    (h.kdvyuz*100),\r\n    h.kdvtut*h.mik,(h.mik*carpan)*h.brmfiy,\r\n    ((h.mik*carpan)*h.brmfiy)-h.genisktut,\r\n   stk_olustarsaat=m.olustarsaat\r\n  from faturahrk as h \r\n  inner join faturamas as m \r\n  on h.fatid=m.fatid and h.sil=0 and m.sil=0\r\n  left join gelgidlistok as sk on sk.tip=h.stktip and sk.kod=h.stkod\r\n  Where m.tarih>=@bastar and m.tarih <=@bittar\r\n  and m.fatRap_id in (select * from CsvToSTR(@fatRapin) )\r\n   order by m.fatid\r\n   \r\n   \r\n   \r\n  /*İRSALİYE  */\r\n   \r\n  insert into @TB_LOGO_FATURA\r\n  (firmano,fat_id,FatRap_id,Petro_Evrak_Tip,\r\n  hrk_tipno,fat_tarih,\r\n  fat_saat,stk_logo_tip,\r\n  stk_kod,stk_muhonkod,\r\n  stk_muhkod,stk_muhkdvkod,\r\n  stk_brim,stk_tip,\r\n  stk_brmfiy,stk_brmfiykdvli,\r\n  stk_miktar,stk_isktop,\r\n  stk_kdv,stk_kdvtop,\r\n  stk_aratop,\r\n  stk_isktolutop,\r\n  stk_olustarsaat)\r\n\r\n  select m.Firmano,m.verid,m.fisrap_id,m.fistip,\r\n  cha_tip=case\r\n     when (m.fistip='FISVERSAT')  then 7\r\n     when (m.fistip='FISALCSAT') then 1 end,\r\n     /*0 borc ,1 alacak */\r\n    m.tarih,m.saat,\r\n    case \r\n    when h.stktip='akykt' then  0\r\n    when h.stktip='markt' then  0\r\n    when h.stktip='gelgid' then 4 \r\n    end, h.stkod,\r\n    sk.muhonkod,\r\n    case\r\n     when m.fistip='FISVERSAT' then  sk.muhckskod\r\n     when m.fistip='FISALCSAT' then  sk.muhgrskod end,\r\n     \r\n    case\r\n     when m.fistip='FISALCSAT' then   dbo.Udf_KdvMuhKodu(1,sk.sat1kdv) \r\n     when m.fistip='FISVERSAT' then   dbo.Udf_KdvMuhKodu(2,sk.sat1kdv) \r\n     end,\r\n    case \r\n     when h.stktip='akykt' then  @AkaryakitBrm\r\n    when h.stktip='markt' then  @MarketBrm\r\n    when h.stktip='gelgid' then @MasrafBrm\r\n    end,\r\n    h.stktip,    \r\n    h.brmfiy/(1+h.kdvyuz),\r\n    h.brmfiy,\r\n    (h.mik),\r\n    ((h.brmfiy)-(h.brmfiy*(1+h.iskyuz)))*h.mik, /*isktut */\r\n    (h.kdvyuz*100),\r\n    ((h.brmfiy*h.mik)*(h.kdvyuz*100))/( (1+h.kdvyuz)*100),\r\n    (h.mik)*(h.brmfiy/(1+h.kdvyuz)),\r\n    \r\n    (h.mik*h.brmfiy)-\r\n    (((h.brmfiy)-(h.brmfiy*(1+h.iskyuz)))*h.mik),\r\n    \r\n   stk_olustarsaat=m.olustarsaat\r\n  from veresihrk as h \r\n  inner join veresimas as m \r\n  on h.verid=m.verid and h.sil=0 and m.sil=0\r\n  left join gelgidlistok as sk on sk.tip=h.stktip and sk.kod=h.stkod\r\n  Where m.tarih>=@bastar and m.tarih <=@bittar\r\n  and m.fisRap_id in (select * from CsvToSTR(@fatRapin) )\r\n   order by m.fatid\r\n      \r\n   \r\n   \r\n   /*pomvardiya */\r\n \r\n\r\nif (select COUNT(*) from CsvToSTR(@fatRapin) where STRValue=0)>0\r\n begin\r\n  insert into @TB_LOGO_FATURA\r\n  (firmano,fat_id,FatRap_id,Petro_Evrak_Tip,\r\n  hrk_tipno,fat_tarih,\r\n  fat_saat,stk_logo_tip,\r\n  stk_kod,stk_muhonkod,\r\n  stk_muhkod,stk_muhkdvkod,\r\n  stk_brim,stk_tip,\r\n  stk_brmfiy,\r\n  stk_brmfiykdvli,\r\n  stk_miktar,\r\n  stk_isktop,\r\n  stk_kdv,\r\n  stk_kdvtop,\r\n  stk_aratop,\r\n  stk_isktolutop,\r\n  stk_olustarsaat)\r\n\r\n  select h.FIRMANO,h.varno,0,'pomvardimas',\r\n  cha_tip=8,\r\n    h.TARIH,h.SAAT,\r\n    case \r\n    when h.STOK_TIP='akykt' then  0\r\n    when h.STOK_TIP='markt' then  0\r\n    when h.STOK_TIP='gelgid' then 4 \r\n    end,\r\n    SK.kod,\r\n    sk.muhonkod,\r\n    sk.muhckskod,\r\n    dbo.Udf_KdvMuhKodu(2,sk.sat1kdv),\r\n    \r\n   case \r\n    when h.STOK_TIP='akykt' then  @AkaryakitBrm\r\n    when h.STOK_TIP='markt' then  @MarketBrm\r\n    when h.STOK_TIP='gelgid' then @MasrafBrm\r\n    end,  \r\n    h.STOK_TIP,  \r\n    h.STOK_BRMKDVSIZ,\r\n    h.STOK_BRMKDVLI,\r\n    (h.STOK_MIKTAR),\r\n    0, /*isktut */\r\n    (h.STOK_KDVYUZ*100),\r\n    (h.STOK_TUTARKDVLI-h.STOK_TUTARKDVSIZ),\r\n    (h.STOK_TUTARKDVSIZ),\r\n    (h.STOK_TUTARKDVLI),\r\n    stk_olustarsaat=h.olustarsaat\r\n    from UDF_PomVarNakitStokHrk (0,'pomvardimas',@Bastar,@Bittar) as h\r\n     left join gelgidlistok as sk on sk.tip=h.STOK_TIP and sk.kod=h.STOK_KOD\r\n     order by h.varno\r\n  end \r\n   \r\n  \r\n  if isnull(@MarketKdv0OnMuhKod,'')!=''\r\n   begin  \r\n    update  @TB_LOGO_FATURA set \r\n    stk_muhonkod=\r\n    case \r\n    when stk_kdv=0 then\r\n    @MarketKdv0OnMuhKod    \r\n    when stk_kdv=1  then\r\n    @MarketKdv1OnMuhKod    \r\n    when stk_kdv=8  then\r\n    @MarketKdv8OnMuhKod    \r\n    when stk_kdv=18 then\r\n    @MarketKdv18OnMuhKod\r\n    end    \r\n    where stk_tip='markt'\r\n  end \r\n   \r\n   \r\n\r\n return\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "Udf_Logo_Fatura_Mas",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.Udf_Logo_Fatura_Mas",
    "definition": "CREATE FUNCTION [dbo].[Udf_Logo_Fatura_Mas]\r\n(@Firmano\t\tint,\r\n@fatRapin  varchar(8000),\r\n@Bastar DATETIME,\r\n@Bittar DATETIME)\r\nRETURNS\r\n  @TB_LOGO_FATURA TABLE (\r\n  Firmano\t\t\t\t int,\r\n  fat_id                 int,\r\n  FatRap_id\t\t\t\t int,\r\n  Petro_Evrak_Tip        varchar(30),\r\n  hrk_tipno\t\t\t\t int,\r\n  hrk_tip\t\t\t\t varchar(10),\r\n  hrk_tipad\t\t\t\t varchar(50),\r\n  hrk_ack\t\t\t\t varchar(200),\r\n  tarih                  datetime,\r\n  saat                   varchar(10),\r\n  car_kod\t\t\t\t varchar(30),\r\n  car_muhonkod\t\t\t varchar(30),\r\n  car_muhkod\t\t\t varchar(30),\r\n  car_unvan\t\t\t\t varchar(150),\r\n  belgeno\t\t\t     Varchar(30),\r\n  fat_gider              float,\r\n  fat_iskonto\t\t\t float,\r\n  fat_isk_yuz            float,\t\t\t\t\t\r\n  fat_kdvtop\t\t\t float,\r\n  fat_aratop\t\t\t float,\r\n  fat_geneltop\t\t\t float,\r\n  giren\t\t\t\t\t float,\r\n  cikan\t\t\t\t\t float,\r\n  fat_olustarsaat        datetime,\r\n  plaka                  varchar(50)\r\n  )\r\nAS\r\nBEGIN\r\n\r\n/*\r\n  16777216\t        318767104\r\n  49\t65536\t      3211264\r\n  28\t256\t             7168\r\n  */\r\n\r\n  if @Firmano=0\r\n  insert into @TB_LOGO_FATURA\r\n  (Firmano,\r\n  fat_id,FatRap_id,Petro_Evrak_Tip,\r\n  hrk_tip,hrk_tipno,hrk_tipad,hrk_ack,\r\n  tarih,saat,car_kod,car_muhonkod,car_muhkod,\r\n  car_unvan,\r\n  belgeno,fat_gider,\r\n  fat_aratop,\r\n  fat_iskonto,fat_isk_yuz,fat_kdvtop,\r\n  fat_geneltop,\r\n  fat_olustarsaat,plaka)\r\n\r\n  select m.firmano,m.fatid,m.fatrap_id,\r\n  m.fattip,\r\n  hrk_tip='fat',\r\n  hrk_tipno=case\r\n     when (m.gctip=2) and (m.fattip='FATVERSAT')  then 7\r\n     when (m.gctip=2) and (m.fattip<>'FATVERSAT') then 8\r\n     when m.gctip=1 then 1\r\n     when m.fattip='FATIADALS' then  8\r\n     when m.fattip='FATIADSAT' then  1 end, /*0 borc ,1 alacak */\r\n     case\r\n     when m.gctip=2 then  'SATIŞ FATURASI'\r\n     when m.gctip=1 then   'ALIŞ FATURASI'\r\n     when m.fattip='FATIADALS' then  'ALIŞDAN İADE FATURASI'\r\n     when m.fattip='FATIADSAT' then  'SATIŞDAN İADE FATURASI' end,\r\n     m.ack,   \r\n    m.tarih,m.saat,\r\n    m.carkod,car.muhonkod,car.muhkod,\r\n    car.ad,\r\n  fat_serino=m.fatseri+cast(m.fatno as varchar), /* Varchar(15) */\r\n  fat_gider=m.gidertop,\r\n  fat_aratop=m.genel_ara_top,\r\n  fat_iskonto=(m.genel_isk_top),\r\n  fat_isk_yuz=(m.genel_isk_top*100)/m.fattop,\r\n  fat_kdvtop=m.genel_kdv_top,/*kdv genel tutar */\r\n  fat_geneltop=m.genel_top,\r\n  fat_olustarsaat=m.olustarsaat,\r\n  '' plaka\r\n  from faturamas as m \r\n  left join Genel_Kart as car on car.cartp=m.cartip \r\n  and car.kod=m.carkod   \r\n  Where sil=0\r\n  and m.tarih>=@bastar and m.tarih <=@bittar\r\n  and m.FatRap_id in (select * from CsvToSTR(@fatRapin) )\r\n  order by m.fatid\r\n  \r\n  if @Firmano>0\r\n   insert into @TB_LOGO_FATURA\r\n  (Firmano,\r\n  fat_id,FatRap_id,Petro_Evrak_Tip,\r\n  hrk_tip,hrk_tipno,hrk_tipad,hrk_ack,\r\n  tarih,saat,car_kod,car_muhonkod,car_muhkod,\r\n  car_unvan,\r\n  belgeno,fat_gider,\r\n  fat_aratop,\r\n  fat_iskonto,fat_isk_yuz,fat_kdvtop,\r\n  fat_geneltop,\r\n  fat_olustarsaat,\r\n  plaka)\r\n  select m.firmano,m.fatid,m.fatrap_id,\r\n  m.fattip,\r\n  hrk_tip='fat',\r\n  hrk_tipno=case\r\n     when (m.gctip=2) and (m.fattip='FATVERSAT')  then 7\r\n     when (m.gctip=2) and (m.fattip<>'FATVERSAT') then 8\r\n     when m.gctip=1 then 1\r\n     when m.fattip='FATIADALS' then  8\r\n     when m.fattip='FATIADSAT' then  1 end, /*0 borc ,1 alacak */\r\n     case\r\n     when m.gctip=2 then  'SATIŞ FATURASI'\r\n     when m.gctip=1 then   'ALIŞ FATURASI'\r\n     when m.fattip='FATIADALS' then  'ALIŞDAN İADE FATURASI'\r\n     when m.fattip='FATIADSAT' then  'SATIŞDAN İADE FATURASI' end,\r\n     m.ack,   \r\n    m.tarih,m.saat,\r\n    m.carkod,car.muhonkod,car.muhkod,\r\n    car.ad,\r\n  fat_serino=m.fatseri+cast(m.fatno as varchar), /* Varchar(15) */\r\n  fat_gider=m.gidertop,\r\n  fat_aratop=m.genel_ara_top,\r\n  fat_iskonto=(m.genel_isk_top),\r\n  fat_isk_yuz=(m.genel_isk_top*100)/m.fattop,\r\n  fat_kdvtop=m.genel_kdv_top,/*kdv genel tutar */\r\n  fat_geneltop=m.genel_top,\r\n  fat_olustarsaat=m.olustarsaat,\r\n  '' plaka\r\n  from faturamas as m \r\n  left join Genel_Kart as car on car.cartp=m.cartip \r\n  and car.kod=m.carkod   \r\n  Where sil=0 and m.firmano in (0,@Firmano)\r\n  and m.tarih>=@bastar and m.tarih <=@bittar\r\n  and m.FatRap_id in (select * from CsvToSTR(@fatRapin) )\r\n  order by m.fatid\r\n  \r\n\r\n  \r\n  update @TB_LOGO_FATURA set\r\n  /*fat_aratop=fat_aratop,--fat_geneltop-fat_kdvtop,  */\r\n  giren=case when hrk_tipno=1 then \r\n  fat_geneltop else 0 end,\r\n  cikan=case \r\n  when (hrk_tipno=7) or (hrk_tipno=8) then \r\n  fat_geneltop else 0 end\r\n\r\n  \r\n  \r\n  \r\n /*-irsaliye  */\r\n if @Firmano=0 \r\n  insert into @TB_LOGO_FATURA\r\n  (Firmano,fat_id,FatRap_id,Petro_Evrak_Tip,\r\n  hrk_tip,hrk_tipno,hrk_tipad,hrk_ack,\r\n  tarih,saat,car_kod,car_muhonkod,car_muhkod,car_unvan,\r\n  belgeno,fat_gider,\r\n  fat_aratop,\r\n  fat_iskonto,fat_isk_yuz,fat_kdvtop,\r\n  fat_geneltop,\r\n  fat_olustarsaat,plaka)\r\n  select m.firmano,m.verid,m.fisrap_id,\r\n  m.fistip,\r\n  hrk_tip='fis',\r\n  hrk_tipno=case\r\n     when (m.fistip='FISVERSAT')  then 7\r\n     when (m.fistip='FISALCSAT') then 1 end,\r\n     /*0 borc ,1 alacak */\r\n    case\r\n     when m.fistip='FISVERSAT' then  'VERESİYE FİŞİ'\r\n     when m.fistip='FISALCSAT' then  'ALACAK FİŞİ' end,\r\n     m.ack,   \r\n    m.tarih,m.saat,\r\n    m.carkod,car.muhonkod,car.muhkod,\r\n    car.ad,\r\n  fat_serino=m.seri+cast(m.no as varchar), /* Varchar(15) */\r\n  fat_gider=0,\r\n  fat_aratop=( select sum(((h.brmfiy*h.mik)/(1+h.kdvyuz))) from veresihrk as h\r\n   where verid=m.verid and h.sil=0),\r\n  fat_iskonto=\r\n  ( select sum( ( (h.brmfiy*h.mik)/(1+h.kdvyuz))*h.iskyuz) from veresihrk as h\r\n   where verid=m.verid and h.sil=0),\r\n  fat_isk_yuz=0,/*(m.genel_isk_top*100)/m.fattop, */\r\n  fat_kdvtop=( select \r\n   sum( ( ((h.brmfiy/(1+h.kdvyuz))*(1-h.iskyuz))*(h.kdvyuz) ) *h.mik )\r\n  from veresihrk as h\r\n   where verid=m.verid and h.sil=0),/*kdv genel tutar */\r\n  fat_geneltop=m.toptut-m.isktop,\r\n  fat_olustarsaat=m.olustarsaat,\r\n  plaka=m.plaka\r\n  from veresimas as m \r\n  left join Genel_Kart as car on car.cartp=m.cartip \r\n  and car.kod=m.carkod   \r\n  Where sil=0\r\n  and m.tarih>=@bastar and m.tarih <=@bittar\r\n  and m.fisRap_id in (select * from CsvToSTR(@fatRapin) )\r\n  order by m.fatid\r\n   \r\n  \r\n  if @Firmano>0 \r\n  insert into @TB_LOGO_FATURA\r\n  (Firmano,fat_id,FatRap_id,Petro_Evrak_Tip,\r\n  hrk_tip,hrk_tipno,hrk_tipad,hrk_ack,\r\n  tarih,saat,car_kod,car_muhonkod,car_muhkod,car_unvan,\r\n  belgeno,fat_gider,\r\n  fat_aratop,\r\n  fat_iskonto,fat_isk_yuz,fat_kdvtop,\r\n  fat_geneltop,\r\n  fat_olustarsaat,plaka)\r\n  select m.firmano,m.verid,m.fisrap_id,\r\n  m.fistip,\r\n  hrk_tip='fis',\r\n  hrk_tipno=case\r\n     when (m.fistip='FISVERSAT')  then 7\r\n     when (m.fistip='FISALCSAT') then 1 end,\r\n     /*0 borc ,1 alacak */\r\n    case\r\n     when m.fistip='FISVERSAT' then  'VERESİYE FİŞİ'\r\n     when m.fistip='FISALCSAT' then  'ALACAK FİŞİ' end,\r\n     m.ack,   \r\n    m.tarih,m.saat,\r\n    m.carkod,car.muhonkod,car.muhkod,\r\n    car.ad,\r\n  fat_serino=m.seri+cast(m.no as varchar), /* Varchar(15) */\r\n  fat_gider=0,\r\n  fat_aratop=( select sum(((h.brmfiy*h.mik)/(1+h.kdvyuz))) from veresihrk as h\r\n   where verid=m.verid and h.sil=0),\r\n  fat_iskonto=\r\n  ( select sum( ( (h.brmfiy*h.mik)/(1+h.kdvyuz))*h.iskyuz) from veresihrk as h\r\n   where verid=m.verid and h.sil=0),\r\n  fat_isk_yuz=0,/*(m.genel_isk_top*100)/m.fattop, */\r\n  fat_kdvtop=( select \r\n   sum( ( ((h.brmfiy/(1+h.kdvyuz))*(1-h.iskyuz))*(h.kdvyuz) ) *h.mik ) \r\n  from veresihrk as h\r\n   where verid=m.verid and h.sil=0),/*kdv genel tutar */\r\n  fat_geneltop=m.toptut-m.isktop,\r\n  fat_olustarsaat=m.olustarsaat,\r\n  m.plaka\r\n  from veresimas as m \r\n  left join Genel_Kart as car on car.cartp=m.cartip \r\n  and car.kod=m.carkod   \r\n  Where sil=0 and m.firmano in (0,@Firmano)\r\n  and m.tarih>=@bastar and m.tarih <=@bittar\r\n  and m.fisRap_id in (select * from CsvToSTR(@fatRapin) )\r\n  order by m.fatid\r\n  \r\n  \r\n  \r\n  \r\n  update @TB_LOGO_FATURA set \r\n  fat_geneltop=(fat_aratop-fat_iskonto+fat_kdvtop)\r\n  where Petro_Evrak_Tip='FISVERSAT' \r\n  \r\n  update @TB_LOGO_FATURA set \r\n  fat_isk_yuz=(fat_iskonto*100)/fat_aratop\r\n  where Petro_Evrak_Tip='FISVERSAT' \r\n  \r\n  \r\n \r\n  \r\n  \r\n  \r\n  \r\n  /*- pomvardiya fatura */\r\n  \r\n  if (select COUNT(*) from CsvToSTR(@fatRapin) where STRValue=0)>0\r\n    begin\r\n   \r\n      if @Firmano=0 \r\n      insert into @TB_LOGO_FATURA\r\n      (Firmano,\r\n      fat_id,FatRap_id,Petro_Evrak_Tip,\r\n      hrk_tip,hrk_tipno,hrk_tipad,hrk_ack,\r\n      tarih,saat,car_kod,car_muhonkod,car_muhkod,car_unvan,\r\n      belgeno,fat_gider,\r\n      fat_aratop,\r\n      fat_iskonto,fat_isk_yuz,fat_kdvtop,\r\n      fat_geneltop,\r\n      fat_olustarsaat,\r\n      plaka)\r\n      \r\n      select m.FIRMANO,m.varno,0,\r\n      fistip='pomvardimas',\r\n      hrk_tip='var',\r\n      hrk_tipno=8,\r\n        'POMPACI VARDIYA',\r\n         m.ack,   \r\n         m.TARIH,m.SAAT,\r\n         car.kod,car.muhonkod,car.muhkod,\r\n         car.ad,\r\n       fat_serino='PA'+cast(m.SERINO as varchar)+'.'+cast(dbo.sifirat(m.varno,5) as varchar) ,  /* Varchar(15) */\r\n       fat_gider=0,\r\n       fat_aratop=SUM(STOK_TUTARKDVSIZ),\r\n       fat_iskonto=0,\r\n       fat_isk_yuz=0,\r\n       fat_kdvtop=SUM(STOK_TUTARKDVLI-STOK_TUTARKDVSIZ),/*kdv genel tutar */\r\n      fat_geneltop=SUM(STOK_TUTARKDVLI),\r\n      fat_olustarsaat=MAX(m.olustarsaat),\r\n      '' plaka\r\n      \r\n      from UDF_PomVarNakitStokhrk (0,'pomvardimas',@Bastar,@Bittar)  as m \r\n      left join Genel_Kart as car on car.cartp='carikart' \r\n      and car.kod=m.CARKOD \r\n      group by m.FIRMANO,m.varno,m.SERINO,m.TARIH,m.SAAT,m.CARKOD,m.ACK,\r\n      car.kod,car.muhonkod,car.muhkod,car.ad\r\n      \r\n      \r\n      if @Firmano>0 \r\n      insert into @TB_LOGO_FATURA\r\n      (Firmano,\r\n      fat_id,FatRap_id,Petro_Evrak_Tip,\r\n      hrk_tip,hrk_tipno,hrk_tipad,hrk_ack,\r\n      tarih,saat,car_kod,car_muhonkod,car_muhkod,car_unvan,\r\n      belgeno,fat_gider,\r\n      fat_aratop,\r\n      fat_iskonto,fat_isk_yuz,fat_kdvtop,\r\n      fat_geneltop,\r\n      fat_olustarsaat,plaka)\r\n      \r\n      select m.FIRMANO,m.varno,0,\r\n      fistip='pomvardimas',\r\n      hrk_tip='var',\r\n      hrk_tipno=8,\r\n      'POMPACI VARDIYA',\r\n      m.ack,   \r\n      m.TARIH,m.SAAT,\r\n      car.kod,car.muhonkod,car.muhkod,\r\n      car.ad,\r\n       fat_serino='PA'+cast(m.SERINO as varchar)+'.'+cast(dbo.sifirat(m.varno,5) as varchar) ,  /* Varchar(15) */\r\n       fat_gider=0,\r\n       fat_aratop=SUM(STOK_TUTARKDVSIZ),\r\n       fat_iskonto=0,\r\n       fat_isk_yuz=0,\r\n       fat_kdvtop=SUM(STOK_TUTARKDVLI-STOK_TUTARKDVSIZ),/*kdv genel tutar */\r\n      fat_geneltop=SUM(STOK_TUTARKDVLI),\r\n      fat_olustarsaat=MAX(m.olustarsaat),\r\n       '' plaka\r\n      from UDF_PomVarNakitStokhrk (@Firmano,'pomvardimas',@Bastar,@Bittar)  as m \r\n      left join Genel_Kart as car on car.cartp='carikart' \r\n      and car.kod=m.CARKOD \r\n      group by m.FIRMANO,m.varno,m.SERINO,m.TARIH,m.SAAT,m.CARKOD,m.ACK,\r\n      car.kod,car.muhonkod,car.muhkod,car.ad\r\n      \r\n      \r\n       \r\n   end \r\n   \r\n     \r\n  \r\n  update @TB_LOGO_FATURA set\r\n  /*fat_aratop=fat_aratop,--fat_geneltop-fat_kdvtop,  */\r\n  giren=case when hrk_tipno=1 then \r\n  fat_geneltop else 0 end,\r\n  cikan=case \r\n  when (hrk_tipno=7) or (hrk_tipno=8) then \r\n  fat_geneltop else 0 end  \r\n  \r\n  \r\n\r\n  \r\n\r\n\r\n\r\n  \r\n\r\n return\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "Udf_Logo_Kasa_Hrk",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.Udf_Logo_Kasa_Hrk",
    "definition": "CREATE FUNCTION [dbo].[Udf_Logo_Kasa_Hrk]\r\n(@Firmano   int,\r\n@Islidin  varchar(8000),\r\n@Bastar DATETIME,\r\n@Bittar DATETIME)\r\nRETURNS\r\n  @TB_LOGO_KASA TABLE (\r\n  id\t\t\t\t\t int,\r\n  firmano                int,\r\n  islmhrk_id             int,\r\n  hrk_id                 int,\r\n  Aktar\t\t\t\t\t int,\t\r\n  Petro_Evrak_Tip        varchar(30),\r\n  hrk_ba\t\t\t\t varchar(5),\t\r\n  hrk_tipno\t\t\t\t int,\r\n  hrk_tip\t\t\t\t varchar(30),\r\n  hrk_tipad\t\t\t\t varchar(50),\r\n  hrk_ack\t\t\t\t varchar(200),\r\n  tarih                  datetime,\r\n  saat                   varchar(10),\r\n  kasa_kod\t\t\t\tvarchar(30),\r\n  kasa_muhonkod\t\t\t varchar(30),\r\n  kasa_muhkod\t\t\tvarchar(30),\r\n  kasa_unvan\t\t\t    varchar(150),\r\n  zcar_tip\t\t\t\t varchar(20),\r\n  zcar_kod\t\t\t\t varchar(30),\r\n  zcar_muhonkod\t\t\t varchar(30),\r\n  zcar_muhkod\t\t\t varchar(30),\r\n  zcar_unvan\t\t\t\t varchar(150),\r\n  belgeno\t\t\t     Varchar(20),\r\n  gider_tut              float,\r\n  geneltop\t\t\t     float,\r\n  giren\t\t\t\t\t float,\r\n  cikan\t\t\t\t\t float,\r\n  olustarsaat            datetime\r\n  )\r\nAS\r\nBEGIN\r\n\r\n if @Firmano=0 \r\n  insert into @TB_LOGO_KASA\r\n  (id,firmano,islmhrk_id,hrk_id,Aktar,Petro_Evrak_Tip,hrk_ba,\r\n  hrk_tip,hrk_tipno,hrk_tipad,hrk_ack,\r\n  tarih,saat,\r\n  kasa_kod,kasa_muhonkod,kasa_muhkod,kasa_unvan,\r\n  zcar_tip,zcar_kod,zcar_muhonkod,zcar_muhkod,zcar_unvan,\r\n  belgeno,gider_tut,\r\n  geneltop,olustarsaat)\r\n\r\n  select m.id,m.firmano,isl.id,m.kashrkid,\r\n  case \r\n  when (m.islmtip+'_'+m.islmhrk='VIR_VRC') then 0\r\n  else 1 end,\r\n  'kas',\r\n  hrk_ba=case when giren>0 then 'B' else 'A' end,\r\n  hrk_tip=(m.islmtip+'_'+m.islmhrk),\r\n   hrk_tipno=case\r\n     when (m.islmtip+'_'+m.islmhrk='BNK_YTN') then 21\r\n     when (m.islmtip+'_'+m.islmhrk='BNK_CKN') then 22\r\n     when (m.islmtip+'_'+m.islmhrk='TAH_NAK') then 11\r\n     when (m.islmtip+'_'+m.islmhrk='ODE_NAK') then 12\r\n     else\r\n     1\r\n     end,\r\n     case\r\n     when (m.islmtip+'_'+m.islmhrk='BNK_YTN') then 'BYTN'\r\n     when (m.islmtip+'_'+m.islmhrk='BNK_CKN') then 'BCKN'\r\n     when (m.islmtip+'_'+m.islmhrk='TAH_NAK') then 'TNAK'\r\n     when (m.islmtip+'_'+m.islmhrk='ODE_NAK') then 'ONAK'\r\n     else 'KASA' \r\n    end,\r\n    m.ack,   \r\n    m.tarih,m.saat,\r\n    m.kaskod,car.muhonkod,car.muhkod,car.ad,\r\n    m.cartip,m.carkod,'','','',\r\n   belgeno=m.belno, /* Varchar(15) */\r\n   gider_tut=0,\r\n   geneltop=abs( m.giren-m.cikan),\r\n   olustarsaat=m.olustarsaat\r\n   from kasahrk as m \r\n   inner join islemhrktip as isl on\r\n   (isl.tip+'_'+isl.hrk)=(m.islmtip+'_'+m.islmhrk)\r\n   left join Genel_Kart as car on car.cartp='kasakart'\r\n   and car.kod=m.kaskod \r\n   Where sil=0 and m.varno=0\r\n   and m.tarih>=@bastar and m.tarih <=@bittar\r\n    and isnull(m.Entegre,0)=0 \r\n   order by m.id\r\n  \r\n\r\n  if @Firmano>0 \r\n  insert into @TB_LOGO_KASA\r\n  (id,firmano,islmhrk_id,hrk_id,Aktar,Petro_Evrak_Tip,hrk_ba,\r\n  hrk_tip,hrk_tipno,hrk_tipad,hrk_ack,\r\n  tarih,saat,\r\n  kasa_kod,kasa_muhonkod,kasa_muhkod,kasa_unvan,\r\n  zcar_tip,zcar_kod,zcar_muhonkod,zcar_muhkod,zcar_unvan,\r\n  belgeno,gider_tut,\r\n  geneltop,olustarsaat)\r\n\r\n  select m.id,m.firmano,isl.id,m.kashrkid,\r\n  case \r\n  when (m.islmtip+'_'+m.islmhrk='VIR_VRC') then 0\r\n  else 1 end,\r\n  'kas',\r\n  hrk_ba=case when giren>0 then 'B' else 'A' end,\r\n  hrk_tip=(m.islmtip+'_'+m.islmhrk),\r\n   hrk_tipno=case\r\n     when (m.islmtip+'_'+m.islmhrk='BNK_YTN') then 21\r\n     when (m.islmtip+'_'+m.islmhrk='BNK_CKN') then 22\r\n     when (m.islmtip+'_'+m.islmhrk='TAH_NAK') then 11\r\n     when (m.islmtip+'_'+m.islmhrk='ODE_NAK') then 12\r\n     else\r\n     1\r\n     end,\r\n     case\r\n     when (m.islmtip+'_'+m.islmhrk='BNK_YTN') then 'BYTN'\r\n     when (m.islmtip+'_'+m.islmhrk='BNK_CKN') then 'BCKN'\r\n     when (m.islmtip+'_'+m.islmhrk='TAH_NAK') then 'TNAK'\r\n     when (m.islmtip+'_'+m.islmhrk='ODE_NAK') then 'ONAK'\r\n     else 'KASA' \r\n    end,\r\n    m.ack,   \r\n    m.tarih,m.saat,\r\n    m.kaskod,car.muhonkod,car.muhkod,car.ad,\r\n    m.cartip,m.carkod,'','','',\r\n   belgeno=m.belno, /* Varchar(15) */\r\n   gider_tut=0,\r\n   geneltop=abs( m.giren-m.cikan),\r\n   olustarsaat=m.olustarsaat\r\n   from kasahrk as m \r\n   inner join islemhrktip as isl on\r\n   (isl.tip+'_'+isl.hrk)=(m.islmtip+'_'+m.islmhrk)\r\n   left join Genel_Kart as car on car.cartp='kasakart'\r\n   and car.kod=m.kaskod \r\n   Where sil=0 and m.varno=0 and m.firmano in (0,@Firmano)\r\n   and m.tarih>=@bastar and m.tarih <=@bittar\r\n    and isnull(m.Entegre,0)=0 \r\n   order by m.id\r\n\r\n\r\n  \r\n   if @Islidin<>''\r\n    delete from @TB_LOGO_KASA Where islmhrk_id not in (select * from CsvToInt(@Islidin) )\r\n  \r\n  \r\n  \r\n   update @TB_LOGO_KASA set\r\n   giren=case when hrk_BA='A' then \r\n   geneltop else 0 end,\r\n   cikan=case when hrk_BA='B' then \r\n   geneltop else 0 end\r\n   \r\n   \r\n   update @TB_LOGO_KASA set\r\n   zcar_muhonkod=car.muhonkod,\r\n   zcar_muhkod=car.muhkod,\r\n   zcar_unvan=car.ad\r\n   from @TB_LOGO_KASA as t\r\n   inner join Genel_Kart as car on \r\n   car.cartp=t.zcar_tip and \r\n   car.kod=t.zcar_kod \r\n   \r\n  \r\n  \r\n\r\n\r\n return\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "Udf_Logo_Pos_Hrk",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.Udf_Logo_Pos_Hrk",
    "definition": "CREATE FUNCTION [dbo].[Udf_Logo_Pos_Hrk]\r\n(@Firmano  int,\r\n@Bastar DATETIME,\r\n@Bittar DATETIME)\r\nRETURNS\r\n  @TB_LOGO_POS TABLE (\r\n  id\t\t\t\t\t int,\r\n  hrk_id                 int,\r\n  hrk_ba\t\t\t\t varchar(5) COLLATE Turkish_CI_AS,\t\r\n  hrk_tipno\t\t\t\t int,\r\n  hrk_tipad\t\t\t\t varchar(50) COLLATE Turkish_CI_AS,\r\n  hrk_ack\t\t\t\t varchar(200) COLLATE Turkish_CI_AS,\r\n  tarih                  datetime,\r\n  saat                   varchar(10) COLLATE Turkish_CI_AS,\r\n  pos_kod\t\t\t\tvarchar(30) COLLATE Turkish_CI_AS,\r\n  pos_muhonkod\t\t\t varchar(30) COLLATE Turkish_CI_AS,\r\n  pos_muhkod\t\t\tvarchar(30) COLLATE Turkish_CI_AS,\r\n  pos_unvan\t\t\t    varchar(150) COLLATE Turkish_CI_AS,\r\n  zcar_tip\t\t\t\t varchar(30) COLLATE Turkish_CI_AS,\r\n  zcar_kod\t\t\t\t varchar(30) COLLATE Turkish_CI_AS,\r\n  zcar_muhonkod\t\t\t varchar(30) COLLATE Turkish_CI_AS,\r\n  zcar_muhkod\t\t\t varchar(30) COLLATE Turkish_CI_AS,\r\n  zcar_unvan\t\t\t\t varchar(150) COLLATE Turkish_CI_AS,\r\n  belgeno\t\t\t     Varchar(20) COLLATE Turkish_CI_AS,\r\n  geneltop\t\t\t     float,\r\n  olustarsaat            datetime\r\n  )\r\nAS\r\nBEGIN\r\n\r\n\r\n  if @Firmano=0\r\n  insert into @TB_LOGO_POS\r\n  (id,hrk_id,hrk_ba,hrk_tipno,hrk_tipad,hrk_ack,\r\n  tarih,saat,\r\n  pos_kod,pos_muhonkod,pos_muhkod,pos_unvan,\r\n  zcar_tip,zcar_kod,zcar_muhonkod,zcar_muhkod,zcar_unvan,\r\n  belgeno,geneltop,olustarsaat)\r\n\r\n  select m.id,m.poshrkid,\r\n    hrk_ba='B',\r\n    hrk_tipno=70,'POS',m.ack,   \r\n    m.tarih,m.saat,\r\n    m.poskod,car.muhonkod,car.muhkod,car.ad,\r\n    m.cartip,m.carkod,'','','',\r\n    belgeno=m.belno, \r\n    geneltop=abs(m.giren-m.cikan),\r\n    olustarsaat=m.olustarsaat\r\n  from poshrk as m WITH(NOLOCK)\r\n  inner join Genel_Kart as car on car.cartp='poskart'\r\n  and car.kod=m.poskod and m.sil=0 \r\n  Where sil=0 and m.varno=0\r\n  and tarih>=@bastar and tarih <=@bittar\r\n  and isnull(m.Entegre,0)=0  \r\n  order by m.id\r\n  \r\n  \r\n  \r\n  if @Firmano>0\r\n  insert into @TB_LOGO_POS\r\n  (id,hrk_id,hrk_ba,hrk_tipno,hrk_tipad,hrk_ack,\r\n  tarih,saat,\r\n  pos_kod,pos_muhonkod,pos_muhkod,pos_unvan,\r\n  zcar_tip,zcar_kod,zcar_muhonkod,zcar_muhkod,zcar_unvan,\r\n  belgeno,geneltop,olustarsaat)\r\n\r\n  select m.id,m.poshrkid,\r\n    hrk_ba='B',\r\n    hrk_tipno=70,'POS',m.ack,   \r\n    m.tarih,m.saat,\r\n    m.poskod,car.muhonkod,car.muhkod,car.ad,\r\n    m.cartip,m.carkod,'','','',\r\n    belgeno=m.belno, \r\n    geneltop=abs(m.giren-m.cikan),\r\n    olustarsaat=m.olustarsaat\r\n  from poshrk as m WITH(NOLOCK)\r\n  inner join Genel_Kart as car on car.cartp='poskart'\r\n  and car.kod=m.poskod and m.sil=0 and m.firmano in (0,@Firmano)\r\n  Where sil=0 and m.varno=0 \r\n  and tarih>=@bastar and tarih <=@bittar\r\n  and isnull(m.Entegre,0)=0  \r\n  order by m.id\r\n  \r\n  \r\n  update @TB_LOGO_POS set\r\n   zcar_muhonkod=car.muhonkod,\r\n   zcar_muhkod=car.muhkod,\r\n   zcar_unvan=car.ad\r\n   from @TB_LOGO_POS as t\r\n   inner join Genel_Kart as car on \r\n   car.cartp=t.zcar_tip and \r\n   car.kod=t.zcar_kod \r\n  \r\n  \r\n  \r\n  \r\n\r\n return\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "Udf_Logo_Vardiya_Hrk",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.Udf_Logo_Vardiya_Hrk",
    "definition": "CREATE FUNCTION [dbo].[Udf_Logo_Vardiya_Hrk]\r\n(@Firmano int,\r\n@Tip    varchar(20),\r\n@Bastar DATETIME,\r\n@Bittar DATETIME,\r\n@AkaryakitBrm   Varchar(20),\r\n@MarketBrm   Varchar(20),\r\n@MasrafBrm   Varchar(20))\r\nRETURNS\r\n  @TB_LOGO_FATURA TABLE (\r\n  fat_id                 int,\r\n  FatRap_id\t\t\t\t int,\r\n  Petro_Evrak_Tip        varchar(30),\r\n  hrk_tipno\t\t\t\t int,\r\n  fat_tarih              datetime,\r\n  fat_saat               varchar(10),\r\n  stk_logo_tip           int,                \r\n  stk_kod\t\t\t\t varchar(30),\r\n  stk_muhonkod\t\t\t varchar(30),\r\n  stk_muhkod\t\t\t varchar(30),\r\n  stk_muhkdvkod\t\t\t varchar(30), \r\n  stk_brim\t\t\t\t varchar(5),\r\n  stk_brmfiy\t\t\t float,\r\n  stk_brmfiykdvli    \t float,\r\n  stk_miktar\t\t\t float,\r\n  stk_isktop\t\t\t float,\t\t\t\t\t\r\n  stk_kdv     \t\t\t float,\r\n  stk_kdvtop     \t     float,\r\n  stk_aratop             float,\r\n  stk_isktolutop         float,\r\n  stk_olustarsaat        datetime\r\n  )\r\nAS\r\nBEGIN\r\n\r\n   insert into @TB_LOGO_FATURA\r\n  (fat_id,FatRap_id,Petro_Evrak_Tip,\r\n  hrk_tipno,fat_tarih,\r\n  fat_saat,stk_logo_tip,\r\n  stk_kod,stk_muhonkod,\r\n  stk_muhkod,stk_muhkdvkod,\r\n  stk_brim,\r\n  stk_brmfiy,\r\n  stk_brmfiykdvli,\r\n  stk_miktar,\r\n  stk_isktop,\r\n  stk_kdv,\r\n  stk_kdvtop,\r\n  stk_aratop,\r\n  stk_isktolutop,\r\n  stk_olustarsaat)\r\n\r\n\r\n    select h.varno,0,@Tip,/*'pomvardimas', */\r\n    cha_tip=8,\r\n    max(h.TARIH),max(h.SAAT),\r\n    case \r\n    when h.STOK_TIP='akykt' then  0\r\n    when h.STOK_TIP='markt' then  0\r\n    when h.STOK_TIP='gelgid' then 4 \r\n    end,\r\n    SK.kod,\r\n    sk.muhonkod,\r\n    sk.muhckskod,\r\n    dbo.Udf_KdvMuhKodu(2,sk.sat1kdv),\r\n    case when h.STOK_TIP='akykt' then  @AkaryakitBrm\r\n    when h.STOK_TIP='markt' then  @MarketBrm\r\n    when h.STOK_TIP='gelgid' then @MasrafBrm\r\n    end,    \r\n    sum(h.STOK_TUTARKDVSIZ)/sum(h.STOK_MIKTAR),/*h.STOK_BRMKDVSIZ, */\r\n    sum(h.STOK_TUTARKDVLI)/sum(h.STOK_MIKTAR),/*h.STOK_BRMKDVLI, */\r\n    sum(h.STOK_MIKTAR),\r\n    0, /*isktut */\r\n    max(h.STOK_KDVYUZ*100),\r\n    sum(h.STOK_TUTARKDVLI-h.STOK_TUTARKDVSIZ),\r\n    sum(h.STOK_TUTARKDVSIZ),\r\n    sum(h.STOK_TUTARKDVLI),\r\n    stk_olustarsaat=max(h.olustarsaat)\r\n    from UDF_PomVarNakitStokHrk (@Firmano,@Tip,@Bastar,@Bittar) as h /*'pomvardimas' */\r\n     left join gelgidlistok as sk on sk.tip=h.STOK_TIP and sk.kod=h.STOK_KOD\r\n     group by  h.varno,sk.kod,sk.muhonkod,sk.muhckskod,h.STOK_TIP,sk.sat1kdv,h.STOK_BRIM\r\n    \r\n    \r\n   \r\n   \r\n   \r\n\r\n return\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "Udf_Logo_Vardiya_Kasa",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.Udf_Logo_Vardiya_Kasa",
    "definition": "CREATE FUNCTION [dbo].[Udf_Logo_Vardiya_Kasa]\r\n(@Firmano  int,\r\n@Bastar DATETIME,\r\n@Bittar DATETIME)\r\nRETURNS\r\n  @TB_LOGO_BANKA TABLE (\r\n  id\t\t\t\t\t int,\r\n  hrk_id                 int,\r\n  hrk_ba\t\t\t\t varchar(5) COLLATE Turkish_CI_AS,\t\r\n  hrk_tipno\t\t\t\t int,\r\n  hrk_tipad\t\t\t\t varchar(50) COLLATE Turkish_CI_AS,\r\n  hrk_ack\t\t\t\t varchar(200) COLLATE Turkish_CI_AS,\r\n  tarih                  datetime,\r\n  saat                   varchar(10) COLLATE Turkish_CI_AS,\r\n  kasa_kod\t\t\t\tvarchar(30) COLLATE Turkish_CI_AS,\r\n  kasa_muhonkod\t\t\t varchar(30) COLLATE Turkish_CI_AS,\r\n  kasa_muhkod\t\t\tvarchar(30) COLLATE Turkish_CI_AS,\r\n  kasa_unvan\t\t\t    varchar(150) COLLATE Turkish_CI_AS,\r\n  zcar_tip\t\t\t\t varchar(30) COLLATE Turkish_CI_AS,\r\n  zcar_kod\t\t\t\t varchar(30) COLLATE Turkish_CI_AS,\r\n  zcar_muhonkod\t\t\t varchar(30) COLLATE Turkish_CI_AS,\r\n  zcar_muhkod\t\t\t varchar(30) COLLATE Turkish_CI_AS,\r\n  zcar_unvan\t\t\t\t varchar(150) COLLATE Turkish_CI_AS,\r\n  belgeno\t\t\t     Varchar(20) COLLATE Turkish_CI_AS,\r\n  geneltop\t\t\t     float,\r\n  olustarsaat            datetime\r\n  )\r\nAS\r\nBEGIN\r\n\r\n\r\n declare @CAR_KOD  varchar(50)\r\n\r\n if @firmano=0  \r\n  SELECT @CAR_KOD=zrap_carkod FROM sistemtanim\r\n\r\n\r\n if @firmano>0  \r\n  SELECT @CAR_KOD=Entegre_ZraporOnMuhKod FROM Firma where id=@firmano\r\n\r\n  insert into @TB_LOGO_BANKA\r\n  (id,hrk_id,hrk_ba,hrk_tipno,hrk_tipad,hrk_ack,\r\n  tarih,saat,\r\n  kasa_kod,kasa_muhonkod,kasa_muhkod,kasa_unvan,\r\n  zcar_tip,zcar_kod,zcar_muhonkod,zcar_muhkod,zcar_unvan,\r\n  belgeno,geneltop,olustarsaat)\r\n\r\n   select m.id,m.kashrkid,\r\n    hrk_ba=case when m.giren>0 then 'B' else 'A' end,\r\n    hrk_tipno=11,'KASA',m.ack,   \r\n    m.tarih,m.saat,\r\n    m.kaskod,car.muhonkod,car.muhkod,car.ad,\r\n    'carikart',@CAR_KOD,@CAR_KOD,@CAR_KOD,@CAR_KOD,\r\n    belgeno=m.belno, \r\n    geneltop=abs(m.giren-m.cikan),\r\n    olustarsaat=m.olustarsaat\r\n  from kasahrk as m WITH(NOLOCK)\r\n  inner join Genel_Kart as car on car.cartp='kasakart'\r\n  and car.kod=m.kaskod and m.sil=0 and m.firmano=@Firmano\r\n  Where sil=0 and m.varno in\r\n  (select varno from pomvardimas WITH(NOLOCK) where sil=0 and varok=1 and  \r\n  tarih>=@bastar and tarih <=@bittar ) and m.giren>0\r\n  and m.yertip='pomvardimas' and isnull(m.Entegre,0)=0  \r\n  order by m.id\r\n  \r\n\r\n return\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "Udf_Logo_Vardiya_Kasa_Hrk",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.Udf_Logo_Vardiya_Kasa_Hrk",
    "definition": "CREATE FUNCTION [dbo].[Udf_Logo_Vardiya_Kasa_Hrk]\r\n(@Firmano   int,\r\n@Tip  int,\r\n@Bastar DATETIME,\r\n@Bittar DATETIME)\r\nRETURNS\r\n  @TB_LOGO_KASA TABLE (\r\n  id\t\t\t\t\t int,\r\n  firmano                int,\r\n  islmhrk_id             int,\r\n  hrk_id                 int,\r\n  Aktar\t\t\t\t\t int,\t\r\n  Petro_Evrak_Tip        varchar(30),\r\n  hrk_ba\t\t\t\t varchar(5),\t\r\n  hrk_tipno\t\t\t\t int,\r\n  hrk_tip\t\t\t\t varchar(30),\r\n  hrk_tipad\t\t\t\t varchar(50),\r\n  hrk_ack\t\t\t\t varchar(200),\r\n  tarih                  datetime,\r\n  saat                   varchar(10),\r\n  kasa_kod\t\t\t\tvarchar(30),\r\n  kasa_muhonkod\t\t\t varchar(30),\r\n  kasa_muhkod\t\t\tvarchar(30),\r\n  kasa_unvan\t\t\t    varchar(150),\r\n  zcar_tip\t\t\t\t varchar(20),\r\n  zcar_kod\t\t\t\t varchar(30),\r\n  zcar_muhonkod\t\t\t varchar(30),\r\n  zcar_muhkod\t\t\t varchar(30),\r\n  zcar_unvan\t\t\t\t varchar(150),\r\n  belgeno\t\t\t     Varchar(20),\r\n  gider_tut              float,\r\n  geneltop\t\t\t     float,\r\n  giren\t\t\t\t\t float,\r\n  cikan\t\t\t\t\t float,\r\n  olustarsaat            datetime\r\n  )\r\nAS\r\nBEGIN\r\n\r\n  declare @CAR_KOD varchar(30)\r\n  if @firmano=0  \r\n   SELECT @CAR_KOD=zrap_carkod FROM sistemtanim\r\n\r\n\r\n if @firmano>0  \r\n  SELECT @CAR_KOD=Entegre_ZraporOnMuhKod FROM Firma where id=@firmano\r\n\r\n\r\n if @Firmano=0 and @Tip=1\r\n  insert into @TB_LOGO_KASA\r\n  (id,firmano,islmhrk_id,hrk_id,Aktar,Petro_Evrak_Tip,hrk_ba,\r\n  hrk_tip,hrk_tipno,hrk_tipad,hrk_ack,\r\n  tarih,saat,\r\n  kasa_kod,kasa_muhonkod,kasa_muhkod,kasa_unvan,\r\n  zcar_tip,zcar_kod,zcar_muhonkod,zcar_muhkod,zcar_unvan,\r\n  belgeno,gider_tut,\r\n  geneltop,olustarsaat)\r\n\r\n  select m.id,m.firmano,isl.id,m.kashrkid,\r\n  case \r\n  when (m.islmtip+'_'+m.islmhrk='VIR_VRC') then 0\r\n  else 1 end,\r\n  'kas',\r\n  hrk_ba=case when giren>0 then 'A' else 'B' end,\r\n  hrk_tip=(m.islmtip+'_'+m.islmhrk),\r\n   hrk_tipno=case\r\n     when (m.islmtip+'_'+m.islmhrk='TAH_TES') then 11\r\n     else\r\n     1\r\n     end,\r\n     case\r\n     when (m.islmtip+'_'+m.islmhrk='TAH_NAK') then 'TTES'\r\n     else 'KASA' \r\n    end,\r\n    m.ack,   \r\n    m.tarih,m.saat,\r\n    m.kaskod,car.muhonkod,car.muhkod,car.ad,\r\n    'carikart',@CAR_KOD,@CAR_KOD,@CAR_KOD,@CAR_KOD,\r\n    belgeno='P'+cast(m.Firmano as varchar)+''+cast(m.varno as varchar), /* Varchar(15) */\r\n   gider_tut=0,\r\n   geneltop=abs(m.giren-m.cikan),\r\n   olustarsaat=m.olustarsaat\r\n   from kasahrk as m with (nolock)\r\n   inner join islemhrktip as isl on\r\n   (isl.tip+'_'+isl.hrk)=(m.islmtip+'_'+m.islmhrk) and\r\n   (m.islmtip+'_'+m.islmhrk)='TAH_TES'\r\n   left join Genel_Kart as car on car.cartp='kasakart'\r\n   and car.kod=m.kaskod  \r\n   Where sil=0 and m.varno>0 and m.varok=1\r\n   and m.tarih>=@bastar and m.tarih <=@bittar\r\n    and isnull(m.Entegre,0)=0  and m.yertip='pomvardimas'\r\n   order by m.id\r\n   \r\n   \r\n  if @Firmano=0 and @Tip=2\r\n  insert into @TB_LOGO_KASA\r\n  (id,firmano,islmhrk_id,hrk_id,Aktar,Petro_Evrak_Tip,hrk_ba,\r\n  hrk_tip,hrk_tipno,hrk_tipad,hrk_ack,\r\n  tarih,saat,\r\n  kasa_kod,kasa_muhonkod,kasa_muhkod,kasa_unvan,\r\n  zcar_tip,zcar_kod,zcar_muhonkod,zcar_muhkod,zcar_unvan,\r\n  belgeno,gider_tut,\r\n  geneltop,olustarsaat)\r\n\r\n  select m.id,m.firmano,isl.id,m.kashrkid,\r\n  case \r\n  when (m.islmtip+'_'+m.islmhrk='VIR_VRC') then 0\r\n  else 1 end,\r\n  'kas',\r\n  hrk_ba=case when giren>0 then 'A' else 'B' end,\r\n  hrk_tip=(m.islmtip+'_'+m.islmhrk),\r\n   hrk_tipno=case\r\n     when (m.islmtip+'_'+m.islmhrk='TAH_TES') then 11\r\n     else\r\n     1\r\n     end,\r\n     case\r\n     when (m.islmtip+'_'+m.islmhrk='TAH_NAK') then 'TTES'\r\n     else 'KASA' \r\n    end,\r\n    m.ack,   \r\n    m.tarih,m.saat,\r\n    m.kaskod,car.muhonkod,car.muhkod,car.ad,\r\n    'carikart',@CAR_KOD,@CAR_KOD,@CAR_KOD,@CAR_KOD,\r\n   belgeno='M'+cast(m.Firmano as varchar)+''+cast(m.varno as varchar), /* Varchar(15) */\r\n   gider_tut=0,\r\n   geneltop=abs(m.giren-m.cikan),\r\n   olustarsaat=m.olustarsaat\r\n   from kasahrk as m with (nolock)\r\n   inner join islemhrktip as isl on\r\n   (isl.tip+'_'+isl.hrk)=(m.islmtip+'_'+m.islmhrk) and\r\n   (m.islmtip+'_'+m.islmhrk)='TAH_TES'\r\n   left join Genel_Kart as car on car.cartp='kasakart'\r\n   and car.kod=m.kaskod \r\n   Where sil=0 and m.varno>0 and m.varok=1\r\n   and m.tarih>=@bastar and m.tarih <=@bittar\r\n    and isnull(m.Entegre,0)=0 and m.yertip='marvardimas'\r\n   order by m.id\r\n    \r\n   \r\n  \r\n\r\n  if @Firmano>0 and @Tip=1\r\n  insert into @TB_LOGO_KASA\r\n  (id,firmano,islmhrk_id,hrk_id,Aktar,Petro_Evrak_Tip,hrk_ba,\r\n  hrk_tip,hrk_tipno,hrk_tipad,hrk_ack,\r\n  tarih,saat,\r\n  kasa_kod,kasa_muhonkod,kasa_muhkod,kasa_unvan,\r\n  zcar_tip,zcar_kod,zcar_muhonkod,zcar_muhkod,zcar_unvan,\r\n  belgeno,gider_tut,\r\n  geneltop,olustarsaat)\r\n\r\n  select m.id,m.firmano,isl.id,m.kashrkid,\r\n  case \r\n  when (m.islmtip+'_'+m.islmhrk='VIR_VRC') then 0\r\n  else 1 end,\r\n  'kas',\r\n  hrk_ba=case when giren>0 then 'B' else 'A' end,\r\n  hrk_tip=(m.islmtip+'_'+m.islmhrk),\r\n   hrk_tipno=case\r\n     when (m.islmtip+'_'+m.islmhrk='TAH_TES') then 11\r\n     else\r\n     1\r\n     end,\r\n     case\r\n     when (m.islmtip+'_'+m.islmhrk='TAH_TES') then 'TTES'\r\n     else 'KASA' \r\n    end,\r\n    m.ack,   \r\n    m.tarih,m.saat,\r\n    m.kaskod,car.muhonkod,car.muhkod,car.ad,\r\n    'carikart',@CAR_KOD,@CAR_KOD,@CAR_KOD,@CAR_KOD,\r\n   belgeno='P'+cast(m.Firmano as varchar)+''+cast(m.varno as varchar), /* Varchar(15) */\r\n   gider_tut=0,\r\n   geneltop=abs( m.giren-m.cikan),\r\n   olustarsaat=m.olustarsaat\r\n   from kasahrk as m with (nolock)\r\n   inner join islemhrktip as isl on\r\n   (isl.tip+'_'+isl.hrk)=(m.islmtip+'_'+m.islmhrk) and\r\n   (m.islmtip+'_'+m.islmhrk)='TAH_TES'\r\n   left join Genel_Kart as car on car.cartp='kasakart'\r\n   and car.kod=m.kaskod \r\n   Where sil=0 and m.varno>0 and m.varok=1 and m.firmano in (0,@Firmano)\r\n   and m.tarih>=@bastar and m.tarih <=@bittar\r\n    and isnull(m.Entegre,0)=0 and m.yertip='pomvardimas'\r\n   order by m.id\r\n\r\n  if @Firmano>0 and @Tip=2\r\n  insert into @TB_LOGO_KASA\r\n  (id,firmano,islmhrk_id,hrk_id,Aktar,Petro_Evrak_Tip,hrk_ba,\r\n  hrk_tip,hrk_tipno,hrk_tipad,hrk_ack,\r\n  tarih,saat,\r\n  kasa_kod,kasa_muhonkod,kasa_muhkod,kasa_unvan,\r\n  zcar_tip,zcar_kod,zcar_muhonkod,zcar_muhkod,zcar_unvan,\r\n  belgeno,gider_tut,\r\n  geneltop,olustarsaat)\r\n\r\n  select m.id,m.firmano,isl.id,m.kashrkid,\r\n  case \r\n  when (m.islmtip+'_'+m.islmhrk='VIR_VRC') then 0\r\n  else 1 end,\r\n  'kas',\r\n  hrk_ba=case when giren>0 then 'B' else 'A' end,\r\n  hrk_tip=(m.islmtip+'_'+m.islmhrk),\r\n   hrk_tipno=case\r\n     when (m.islmtip+'_'+m.islmhrk='TAH_TES') then 11\r\n     else\r\n     1\r\n     end,\r\n     case\r\n     when (m.islmtip+'_'+m.islmhrk='TAH_TES') then 'TTES'\r\n     else 'KASA' \r\n    end,\r\n    m.ack,   \r\n    m.tarih,m.saat,\r\n    m.kaskod,car.muhonkod,car.muhkod,car.ad,\r\n    'carikart',@CAR_KOD,@CAR_KOD,@CAR_KOD,@CAR_KOD,\r\n   belgeno='M'+cast(m.Firmano as varchar)+''+cast(m.varno as varchar), /* Varchar(15) */\r\n   gider_tut=0,\r\n   geneltop=abs( m.giren-m.cikan),\r\n   olustarsaat=m.olustarsaat\r\n   from kasahrk as m with (nolock)\r\n   inner join islemhrktip as isl on\r\n   (isl.tip+'_'+isl.hrk)=(m.islmtip+'_'+m.islmhrk) and\r\n   (m.islmtip+'_'+m.islmhrk)='TAH_TES'\r\n   left join Genel_Kart as car on car.cartp='kasakart'\r\n   and car.kod=m.kaskod \r\n   Where sil=0 and m.varno>0 and m.varok=1 and m.firmano in (0,@Firmano)\r\n   and m.tarih>=@bastar and m.tarih <=@bittar\r\n    and isnull(m.Entegre,0)=0 and m.yertip='marvardimas'\r\n   order by m.id\r\n  \r\n  /* if @Islidin<>'' */\r\n  /*  delete from @TB_LOGO_KASA Where islmhrk_id not in (select * from CsvToInt(@Islidin) ) */\r\n  \r\n  \r\n  \r\n   update @TB_LOGO_KASA set\r\n   giren=case when hrk_BA='A' then \r\n   geneltop else 0 end,\r\n   cikan=case when hrk_BA='B' then \r\n   geneltop else 0 end\r\n   \r\n   /*\r\n   update @TB_LOGO_KASA set\r\n   zcar_muhonkod=car.muhonkod,\r\n   zcar_muhkod=car.muhkod,\r\n   zcar_unvan=car.ad\r\n   from @TB_LOGO_KASA as t\r\n   inner join Genel_Kart as car on \r\n   car.cartp=t.zcar_tip and \r\n   car.kod=t.zcar_kod \r\n   */\r\n  \r\n  \r\n\r\n\r\n return\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "Udf_Logo_Vardiya_Mas",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.Udf_Logo_Vardiya_Mas",
    "definition": "CREATE FUNCTION [dbo].[Udf_Logo_Vardiya_Mas]\r\n(@Firmano int,\r\n@Tip   varchar(20),\r\n@Bastar DATETIME,\r\n@Bittar DATETIME)\r\nRETURNS\r\n  @TB_LOGO_FATURA TABLE (\r\n  fat_id                 int,\r\n  FatRap_id\t\t\t\t int,\r\n  Petro_Evrak_Tip        varchar(30),\r\n  hrk_tipno\t\t\t\t int,\r\n  hrk_tip\t\t\t\t varchar(10),\r\n  hrk_tipad\t\t\t\t varchar(50),\r\n  hrk_ack\t\t\t\t varchar(200),\r\n  tarih                  datetime,\r\n  saat                   varchar(10),\r\n  car_kod\t\t\t\t varchar(30),\r\n  car_muhonkod\t\t\t varchar(30),\r\n  car_muhkod\t\t\t varchar(30),\r\n  car_unvan\t\t\t\t varchar(150),\r\n  belgeno\t\t\t     Varchar(20),\r\n  fat_gider              float,\r\n  fat_iskonto\t\t\t float,\r\n  fat_isk_yuz            float,\t\t\t\t\t\r\n  fat_kdvtop\t\t\t float,\r\n  fat_aratop\t\t\t float,\r\n  fat_geneltop\t\t\t float,\r\n  giren\t\t\t\t\t float,\r\n  cikan\t\t\t\t\t float,\r\n  fat_olustarsaat        datetime\r\n  )\r\nAS\r\nBEGIN\r\n\r\n/*\r\n  16777216\t        318767104\r\n  49\t65536\t      3211264\r\n  28\t256\t             7168\r\n  */\r\n\r\n  \r\n  \r\n  /*- pomvardiya fatura */\r\n  \r\n   \r\n      insert into @TB_LOGO_FATURA\r\n      (fat_id,FatRap_id,Petro_Evrak_Tip,\r\n      hrk_tip,hrk_tipno,hrk_tipad,hrk_ack,\r\n      tarih,saat,car_kod,car_muhonkod,car_muhkod,car_unvan,\r\n      belgeno,fat_gider,\r\n      fat_aratop,\r\n      fat_iskonto,fat_isk_yuz,fat_kdvtop,\r\n      fat_geneltop,\r\n      fat_olustarsaat)\r\n  \r\n      select MAX(m.varno),0,fistip=@Tip,/*'pomvardimas', */\r\n      hrk_tip='var',hrk_tipno=7,\r\n      case when @Tip='pomvardimas' then 'POMPACI VARDIYA' else 'MARKET VARDIYA' end,\r\n         '',MAX(m.TARIH),MAX(m.SAAT),\r\n         CARKOD,CARKOD,CARKOD,CARKOD,\r\n      fat_serino=case when @Tip='pomvardimas' then  'P'\r\n      else 'M' end\r\n      +cast(@Firmano as varchar)+''+\r\n       CONVERT(VARCHAR(8), m.varno),   /* Varchar(15) */\r\n      fat_gider=0,\r\n       fat_aratop=SUM(STOK_TUTARKDVSIZ),\r\n       fat_iskonto=0,\r\n       fat_isk_yuz=0,\r\n       fat_kdvtop=SUM(STOK_TUTARKDVLI-STOK_TUTARKDVSIZ),/*kdv genel tutar */\r\n      fat_geneltop=SUM(STOK_TUTARKDVLI),\r\n      fat_olustarsaat=MAX(m.olustarsaat)\r\n      from UDF_PomVarNakitStokhrk (@Firmano,@Tip,@Bastar,@Bittar)  as m \r\n       group by m.varno,m.CARKOD /* m.varno,m.SERINO,m.TARIH,m.SAAT, */\r\n\r\n      \r\n  \r\n  update @TB_LOGO_FATURA set\r\n  /*fat_aratop=fat_aratop,--fat_geneltop-fat_kdvtop,  */\r\n  giren=case when hrk_tipno=1 then \r\n  fat_geneltop else 0 end,\r\n  cikan=case \r\n  when (hrk_tipno=7) or (hrk_tipno=8) then \r\n  fat_geneltop else 0 end  \r\n  \r\n  \r\n\r\n  \r\n\r\n\r\n\r\n  \r\n\r\n return\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "Udf_Logo_Vardiya_Pos",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.Udf_Logo_Vardiya_Pos",
    "definition": "CREATE FUNCTION [dbo].[Udf_Logo_Vardiya_Pos]\r\n(@Firmano  int,\r\n@Bastar DATETIME,\r\n@Bittar DATETIME)\r\nRETURNS\r\n  @TB_LOGO_BANKA TABLE (\r\n  id\t\t\t\t\t int,\r\n  hrk_id                 int,\r\n  hrk_ba\t\t\t\t varchar(5) COLLATE Turkish_CI_AS,\t\r\n  hrk_tipno\t\t\t\t int,\r\n  hrk_tipad\t\t\t\t varchar(50) COLLATE Turkish_CI_AS,\r\n  hrk_ack\t\t\t\t varchar(200) COLLATE Turkish_CI_AS,\r\n  tarih                  datetime,\r\n  saat                   varchar(10) COLLATE Turkish_CI_AS,\r\n  pos_kod\t\t\t\tvarchar(30) COLLATE Turkish_CI_AS,\r\n  pos_muhonkod\t\t\t varchar(30) COLLATE Turkish_CI_AS,\r\n  pos_muhkod\t\t\tvarchar(30) COLLATE Turkish_CI_AS,\r\n  pos_unvan\t\t\t    varchar(150) COLLATE Turkish_CI_AS,\r\n  zcar_kod\t\t\t\t varchar(30) COLLATE Turkish_CI_AS,\r\n  zcar_muhonkod\t\t\t varchar(30) COLLATE Turkish_CI_AS,\r\n  zcar_muhkod\t\t\t varchar(30) COLLATE Turkish_CI_AS,\r\n  zcar_unvan\t\t\t\t varchar(150) COLLATE Turkish_CI_AS,\r\n  belgeno\t\t\t     Varchar(20) COLLATE Turkish_CI_AS,\r\n  geneltop\t\t\t     float,\r\n  olustarsaat            datetime\r\n  )\r\nAS\r\nBEGIN\r\n\r\n\r\n declare @CAR_KOD  varchar(50)\r\n\r\n if @firmano=0  \r\n  SELECT @CAR_KOD=zrap_carkod FROM sistemtanim\r\n\r\n\r\n if @firmano>0  \r\n  SELECT @CAR_KOD=Entegre_ZraporOnMuhKod FROM Firma where id=@firmano\r\n\r\n  insert into @TB_LOGO_BANKA\r\n  (id,hrk_id,hrk_ba,hrk_tipno,hrk_tipad,hrk_ack,\r\n  tarih,saat,\r\n  pos_kod,pos_muhonkod,pos_muhkod,pos_unvan,\r\n  zcar_kod,zcar_muhonkod,zcar_muhkod,zcar_unvan,\r\n  belgeno,geneltop,olustarsaat)\r\n\r\n  select m.id,m.poshrkid,\r\n    hrk_ba='B',\r\n    hrk_tipno=70,'POS',m.ack,   \r\n    m.tarih,m.saat,\r\n    m.poskod,car.muhonkod,car.muhkod,car.ad,\r\n    @CAR_KOD,@CAR_KOD,@CAR_KOD,@CAR_KOD,\r\n    belgeno=m.belno, \r\n    geneltop=abs(m.giren-m.cikan),\r\n    olustarsaat=m.olustarsaat\r\n  from poshrk as m WITH(NOLOCK)\r\n  inner join Genel_Kart as car on car.cartp='poskart'\r\n  and car.kod=m.poskod and m.sil=0 and m.firmano=@Firmano\r\n  Where sil=0 and m.varno in\r\n  (select varno from pomvardimas WITH(NOLOCK) where sil=0 and varok=1 and  \r\n  tarih>=@bastar and tarih <=@bittar )\r\n  and m.yertip='pomvardimas' and isnull(m.Entegre,0)=0  \r\n  order by m.id\r\n  \r\n  \r\n  \r\n  \r\n\r\n return\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "Udf_Logo_Vardiya_Pos_Hrk",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.Udf_Logo_Vardiya_Pos_Hrk",
    "definition": "CREATE FUNCTION [dbo].[Udf_Logo_Vardiya_Pos_Hrk]\r\n(@Firmano   int,\r\n@Tip  int,\r\n@Bastar DATETIME,\r\n@Bittar DATETIME)\r\nRETURNS\r\n  @TB_LOGO_KASA TABLE (\r\n  id\t\t\t\t\t int,\r\n  firmano                int,\r\n  islmhrk_id             int,\r\n  hrk_id                 int,\r\n  Aktar\t\t\t\t\t int,\t\r\n  Petro_Evrak_Tip        varchar(30),\r\n  hrk_ba\t\t\t\t varchar(5),\t\r\n  hrk_tipno\t\t\t\t int,\r\n  hrk_tip\t\t\t\t varchar(30),\r\n  hrk_tipad\t\t\t\t varchar(50),\r\n  hrk_ack\t\t\t\t varchar(200),\r\n  tarih                  datetime,\r\n  saat                   varchar(10),\r\n  bnk_kod\t\t\t\tvarchar(30) COLLATE Turkish_CI_AS,\r\n  bnk_muhonkod\t\t\t varchar(30) COLLATE Turkish_CI_AS,\r\n  bnk_muhkod\t\t\tvarchar(30) COLLATE Turkish_CI_AS,\r\n  bnk_unvan\t\t\t    varchar(150) COLLATE Turkish_CI_AS,\r\n  car_tip\t\t\t\t varchar(20),\r\n  car_kod\t\t\t\t varchar(30),\r\n  car_muhonkod\t\t\t varchar(30),\r\n  car_muhkod\t\t\t varchar(30),\r\n  car_unvan\t\t\t\t varchar(150),\r\n  belgeno\t\t\t     Varchar(20),\r\n  gider_tut              float,\r\n  geneltop\t\t\t     float,\r\n  giren\t\t\t\t\t float,\r\n  cikan\t\t\t\t\t float,\r\n  olustarsaat            datetime\r\n  )\r\nAS\r\nBEGIN\r\n\r\n  declare @CAR_KOD varchar(30)\r\n  if @firmano=0  \r\n   SELECT @CAR_KOD=zrap_carkod FROM sistemtanim\r\n\r\n\r\n if @firmano>0  \r\n  SELECT @CAR_KOD=Entegre_ZraporOnMuhKod FROM Firma where id=@firmano\r\n\r\n\r\n if @Firmano=0 and @Tip=1\r\n  insert into @TB_LOGO_KASA\r\n  (id,firmano,islmhrk_id,hrk_id,Aktar,Petro_Evrak_Tip,hrk_ba,\r\n  hrk_tip,hrk_tipno,hrk_tipad,hrk_ack,\r\n  tarih,saat,\r\n  bnk_kod,bnk_muhonkod,bnk_muhkod,bnk_unvan,\r\n  car_tip,car_kod,car_muhonkod,car_muhkod,car_unvan,\r\n  belgeno,gider_tut,\r\n  geneltop,olustarsaat)\r\n\r\n  select m.id,m.firmano,isl.id,m.varno,\r\n  case \r\n  when (m.islmtip+'_'+m.islmhrk='VIR_VRC') then 0\r\n  else 1 end,\r\n  'kas',\r\n  hrk_ba=case when giren>0 then 'A' else 'B' end,\r\n  hrk_tip=(m.islmtip+'_'+m.islmhrk),\r\n   hrk_tipno=3,\r\n     case\r\n     when (m.islmtip+'_'+m.islmhrk='TAH_POS') then 'TPOS'\r\n     else 'KASA' \r\n    end,\r\n    m.ack,   \r\n    m.tarih,m.saat,\r\n    m.poskod,car.muhonkod,car.muhkod,car.ad,\r\n    'carikart',@CAR_KOD,@CAR_KOD,@CAR_KOD,@CAR_KOD,\r\n    belgeno='P'+cast(m.Firmano as varchar)+''+cast(m.varno as varchar), /* Varchar(15) */\r\n   gider_tut=0,\r\n   geneltop=abs(m.giren-m.cikan),\r\n   olustarsaat=m.olustarsaat\r\n   from poshrk as m with (nolock)\r\n   inner join islemhrktip as isl on\r\n   (isl.tip+'_'+isl.hrk)=(m.islmtip+'_'+m.islmhrk) and\r\n   (m.islmtip+'_'+m.islmhrk)='TAH_POS'\r\n   left join Genel_Kart as car on car.cartp='poskart'\r\n   and car.kod=m.poskod  \r\n   Where sil=0 and m.varno>0 and m.varok=1\r\n   and m.tarih>=@bastar and m.tarih <=@bittar\r\n    and isnull(m.Entegre,0)=0  and m.yertip='pomvardimas'\r\n   order by m.id\r\n   \r\n   \r\n  if @Firmano=0 and @Tip=2\r\n  insert into @TB_LOGO_KASA\r\n  (id,firmano,islmhrk_id,hrk_id,Aktar,Petro_Evrak_Tip,hrk_ba,\r\n  hrk_tip,hrk_tipno,hrk_tipad,hrk_ack,\r\n  tarih,saat,\r\n  bnk_kod,bnk_muhonkod,bnk_muhkod,bnk_unvan,\r\n  car_tip,car_kod,car_muhonkod,car_muhkod,car_unvan,\r\n  belgeno,gider_tut,\r\n  geneltop,olustarsaat)\r\n\r\n  select m.id,m.firmano,isl.id,m.varno,\r\n  case \r\n  when (m.islmtip+'_'+m.islmhrk='VIR_VRC') then 0\r\n  else 1 end,\r\n  'kas',\r\n  hrk_ba=case when giren>0 then 'A' else 'B' end,\r\n  hrk_tip=(m.islmtip+'_'+m.islmhrk),\r\n   hrk_tipno=3,\r\n     case\r\n     when (m.islmtip+'_'+m.islmhrk='TAH_POS') then 'TPOS'\r\n     else 'KASA' \r\n    end,\r\n    m.ack,   \r\n    m.tarih,m.saat,\r\n    m.poskod,car.muhonkod,car.muhkod,car.ad,\r\n    'carikart',@CAR_KOD,@CAR_KOD,@CAR_KOD,@CAR_KOD,\r\n    belgeno='M'+cast(m.Firmano as varchar)+''+cast(m.varno as varchar), /* Varchar(15) */\r\n    gider_tut=0,\r\n    geneltop=abs(m.giren-m.cikan),\r\n    olustarsaat=m.olustarsaat\r\n    from poshrk as m with (nolock)\r\n   inner join islemhrktip as isl on\r\n   (isl.tip+'_'+isl.hrk)=(m.islmtip+'_'+m.islmhrk) and\r\n   (m.islmtip+'_'+m.islmhrk)='TAH_POS'\r\n   left join Genel_Kart as car on car.cartp='poskart'   and car.kod=m.poskod\r\n   Where sil=0 and m.varno>0 and m.varok=1\r\n   and m.tarih>=@bastar and m.tarih <=@bittar\r\n    and isnull(m.Entegre,0)=0 and m.yertip='marvardimas'\r\n   order by m.id\r\n    \r\n   \r\n  \r\n\r\n  if @Firmano>0 and @Tip=1\r\n  insert into @TB_LOGO_KASA\r\n  (id,firmano,islmhrk_id,hrk_id,Aktar,Petro_Evrak_Tip,hrk_ba,\r\n  hrk_tip,hrk_tipno,hrk_tipad,hrk_ack,\r\n  tarih,saat,\r\n  bnk_kod,bnk_muhonkod,bnk_muhkod,bnk_unvan,\r\n  car_tip,car_kod,car_muhonkod,car_muhkod,car_unvan,\r\n  belgeno,gider_tut,\r\n  geneltop,olustarsaat)\r\n\r\n  select m.id,m.firmano,isl.id,m.varno,\r\n  case \r\n  when (m.islmtip+'_'+m.islmhrk='VIR_VRC') then 0\r\n  else 1 end,\r\n  'kas',\r\n  hrk_ba=case when giren>0 then 'B' else 'A' end,\r\n  hrk_tip=(m.islmtip+'_'+m.islmhrk),\r\n   hrk_tipno=3,\r\n     case\r\n     when (m.islmtip+'_'+m.islmhrk='TAH_POS') then 'TPOS'\r\n     else 'KASA' \r\n    end,\r\n    m.ack,   \r\n    m.tarih,m.saat,\r\n    m.poskod,car.muhonkod,car.muhkod,car.ad,\r\n    'carikart',@CAR_KOD,@CAR_KOD,@CAR_KOD,@CAR_KOD,\r\n   belgeno='P'+cast(m.Firmano as varchar)+''+cast(m.varno as varchar), /* Varchar(15) */\r\n   gider_tut=0,\r\n   geneltop=abs( m.giren-m.cikan),\r\n   olustarsaat=m.olustarsaat\r\n   from poshrk as m with (nolock)\r\n   inner join islemhrktip as isl on\r\n   (isl.tip+'_'+isl.hrk)=(m.islmtip+'_'+m.islmhrk) and\r\n   (m.islmtip+'_'+m.islmhrk)='TAH_POS'\r\n   left join Genel_Kart as car on car.cartp='poskart'\r\n   and car.kod=m.poskod \r\n   Where sil=0 and m.varno>0 and m.varok=1 and m.firmano in (0,@Firmano)\r\n   and m.tarih>=@bastar and m.tarih <=@bittar\r\n    and isnull(m.Entegre,0)=0 and m.yertip='pomvardimas'\r\n   order by m.id\r\n\r\n  if @Firmano>0 and @Tip=2\r\n  insert into @TB_LOGO_KASA\r\n  (id,firmano,islmhrk_id,hrk_id,Aktar,Petro_Evrak_Tip,hrk_ba,\r\n  hrk_tip,hrk_tipno,hrk_tipad,hrk_ack,\r\n  tarih,saat,\r\n  bnk_kod,bnk_muhonkod,bnk_muhkod,bnk_unvan,\r\n  car_tip,car_kod,car_muhonkod,car_muhkod,car_unvan,\r\n  belgeno,gider_tut,\r\n  geneltop,olustarsaat)\r\n\r\n  select m.id,m.firmano,isl.id,m.varno,\r\n  case \r\n  when (m.islmtip+'_'+m.islmhrk='VIR_VRC') then 0\r\n  else 1 end,\r\n  'kas',\r\n  hrk_ba=case when giren>0 then 'B' else 'A' end,\r\n  hrk_tip=(m.islmtip+'_'+m.islmhrk),\r\n   hrk_tipno=3,\r\n     case\r\n     when (m.islmtip+'_'+m.islmhrk='TAH_POS') then 'TPOS'\r\n     else 'KASA' \r\n    end,\r\n    m.ack,   \r\n    m.tarih,m.saat,\r\n    m.poskod,car.muhonkod,car.muhkod,car.ad,\r\n    'carikart',@CAR_KOD,@CAR_KOD,@CAR_KOD,@CAR_KOD,\r\n   belgeno='M'+cast(m.Firmano as varchar)+''+cast(m.varno as varchar), /* Varchar(15) */\r\n   gider_tut=0,\r\n   geneltop=abs( m.giren-m.cikan),\r\n   olustarsaat=m.olustarsaat\r\n   from poshrk as m with (nolock)\r\n   inner join islemhrktip as isl on\r\n   (isl.tip+'_'+isl.hrk)=(m.islmtip+'_'+m.islmhrk) and\r\n   (m.islmtip+'_'+m.islmhrk)='TAH_POS'\r\n   left join Genel_Kart as car on car.cartp='poskart'\r\n   and car.kod=m.poskod \r\n   Where sil=0 and m.varno>0 and m.varok=1 and m.firmano in (0,@Firmano)\r\n   and m.tarih>=@bastar and m.tarih <=@bittar\r\n    and isnull(m.Entegre,0)=0 and m.yertip='marvardimas'\r\n   order by m.id\r\n  \r\n  /* if @Islidin<>'' */\r\n  /*  delete from @TB_LOGO_KASA Where islmhrk_id not in (select * from CsvToInt(@Islidin) ) */\r\n  \r\n  \r\n  \r\n   update @TB_LOGO_KASA set\r\n   giren=case when hrk_BA='A' then \r\n   geneltop else 0 end,\r\n   cikan=case when hrk_BA='B' then \r\n   geneltop else 0 end\r\n   \r\n   /*\r\n   update @TB_LOGO_KASA set\r\n   zcar_muhonkod=car.muhonkod,\r\n   zcar_muhkod=car.muhkod,\r\n   zcar_unvan=car.ad\r\n   from @TB_LOGO_KASA as t\r\n   inner join Genel_Kart as car on \r\n   car.cartp=t.zcar_tip and \r\n   car.kod=t.zcar_kod \r\n   */\r\n  \r\n  \r\n\r\n\r\n return\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "Udf_Logo_Vardiya_Pos_Mas",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.Udf_Logo_Vardiya_Pos_Mas",
    "definition": "CREATE FUNCTION [dbo].[Udf_Logo_Vardiya_Pos_Mas]\r\n(@Firmano   int,\r\n@Tip  int,\r\n@Bastar DATETIME,\r\n@Bittar DATETIME)\r\nRETURNS\r\n  @TB_LOGO_KASA TABLE (\r\n  id\t\t\t\t\t int,\r\n  firmano                int,\r\n  islmhrk_id             int,\r\n  hrk_id                 int,\r\n  Aktar\t\t\t\t\t int,\t\r\n  Petro_Evrak_Tip        varchar(30),\r\n  hrk_ba\t\t\t\t varchar(5),\t\r\n  hrk_tipno\t\t\t\t int,\r\n  hrk_tip\t\t\t\t varchar(30),\r\n  hrk_tipad\t\t\t\t varchar(50),\r\n  hrk_ack\t\t\t\t varchar(200),\r\n  tarih                  datetime,\r\n  saat                   varchar(10),\r\n  bnk_kod\t\t\t\tvarchar(30) COLLATE Turkish_CI_AS,\r\n  bnk_muhonkod\t\t\t varchar(30) COLLATE Turkish_CI_AS,\r\n  bnk_muhkod\t\t\tvarchar(30) COLLATE Turkish_CI_AS,\r\n  bnk_unvan\t\t\t    varchar(150) COLLATE Turkish_CI_AS,\r\n  car_tip\t\t\t\t varchar(20),\r\n  car_kod\t\t\t\t varchar(30),\r\n  car_muhonkod\t\t\t varchar(30),\r\n  car_muhkod\t\t\t varchar(30),\r\n  car_unvan\t\t\t\t varchar(150),\r\n  belgeno\t\t\t     Varchar(20),\r\n  gider_tut              float,\r\n  geneltop\t\t\t     float,\r\n  giren\t\t\t\t\t float,\r\n  cikan\t\t\t\t\t float,\r\n  olustarsaat            datetime\r\n  )\r\nAS\r\nBEGIN\r\n\r\n  declare @CAR_KOD varchar(30)\r\n  if @firmano=0  \r\n   SELECT @CAR_KOD=zrap_carkod FROM sistemtanim\r\n\r\n\r\n if @firmano>0  \r\n  SELECT @CAR_KOD=Entegre_ZraporOnMuhKod FROM Firma where id=@firmano\r\n\r\n\r\n if @Firmano=0 and @Tip=1\r\n  insert into @TB_LOGO_KASA\r\n  (id,firmano,islmhrk_id,hrk_id,Aktar,Petro_Evrak_Tip,hrk_ba,\r\n  hrk_tip,hrk_tipno,hrk_tipad,hrk_ack,\r\n  tarih,saat,\r\n  bnk_kod,bnk_muhonkod,bnk_muhkod,bnk_unvan,\r\n  car_tip,car_kod,car_muhonkod,car_muhkod,car_unvan,\r\n  belgeno,gider_tut,\r\n  geneltop,olustarsaat)\r\n\r\n  select p.varno,p.firmano,p.varno,p.varno,\r\n  1,'kas',\r\n  hrk_ba='B' ,\r\n  hrk_tip='TAH_POS',\r\n    hrk_tipno=3,'TPOS',\r\n    p.varad,   \r\n    p.tarih,p.saat,\r\n   /* m.bankod,car.muhonkod,car.muhkod,car.ad, */\r\n   '','','','',\r\n    'carikart',@CAR_KOD,@CAR_KOD,@CAR_KOD,@CAR_KOD,\r\n    belgeno='P'+cast(p.Firmano as varchar)+''+cast(p.varno as varchar), /* Varchar(15) */\r\n   gider_tut=0,\r\n   geneltop=abs(sum(m.giren-m.cikan)),\r\n   olustarsaat=p.olustarsaat\r\n   from poshrk as m with (nolock)\r\n   inner join pomvardimas as p with (nolock) on p.varno=m.varno\r\n   and (m.islmtip+'_'+m.islmhrk)='TAH_POS'\r\n   Where m.sil=0 and m.varno>0 and m.varok=1\r\n   and p.tarih>=@bastar and p.tarih <=@bittar\r\n   and isnull(m.Entegre,0)=0  and m.yertip='pomvardimas'\r\n   group by p.varno,p.firmano,p.varad,p.tarih,p.saat,p.olustarsaat\r\n   order by p.varno\r\n   \r\n   \r\n  if @Firmano=0 and @Tip=2\r\n  insert into @TB_LOGO_KASA\r\n  (id,firmano,islmhrk_id,hrk_id,Aktar,Petro_Evrak_Tip,hrk_ba,\r\n  hrk_tip,hrk_tipno,hrk_tipad,hrk_ack,\r\n  tarih,saat,\r\n  bnk_kod,bnk_muhonkod,bnk_muhkod,bnk_unvan,\r\n  car_tip,car_kod,car_muhonkod,car_muhkod,car_unvan,\r\n  belgeno,gider_tut,\r\n  geneltop,olustarsaat)\r\n\r\n  select p.varno,p.firmano,p.varno,p.varno,\r\n  1,'kas',\r\n  hrk_ba='B',\r\n  hrk_tip='TAH_POS',\r\n    hrk_tipno=3,'TPOS',\r\n    p.varad,   \r\n    p.tarih,p.saat,\r\n   '','','','',\r\n   /* m.bankod,car.muhonkod,car.muhkod,car.ad, */\r\n    'carikart',@CAR_KOD,@CAR_KOD,@CAR_KOD,@CAR_KOD,\r\n    belgeno='M'+cast(p.Firmano as varchar)+''+cast(p.varno as varchar), /* Varchar(15) */\r\n   gider_tut=0,\r\n   geneltop=abs(sum(m.giren-m.cikan)),\r\n   olustarsaat=p.olustarsaat\r\n   from poshrk as m with (nolock)\r\n   inner join marvardimas as p with (nolock) on p.varno=m.varno\r\n   and  (m.islmtip+'_'+m.islmhrk)='TAH_POS'\r\n  /*  left join Genel_Kart as car on car.cartp='bankakart'   and car.kod=m.bankod */\r\n   Where m.sil=0 and m.varno>0 and m.varok=1\r\n   and p.tarih>=@bastar and p.tarih <=@bittar\r\n    and isnull(m.Entegre,0)=0 and m.yertip='marvardimas'\r\n     group by p.varno,p.firmano,p.varad,p.tarih,p.saat,p.olustarsaat\r\n   order by p.varno\r\n    \r\n\r\n  if @Firmano>0 and @Tip=1\r\n  insert into @TB_LOGO_KASA\r\n  (id,firmano,islmhrk_id,hrk_id,Aktar,Petro_Evrak_Tip,hrk_ba,\r\n  hrk_tip,hrk_tipno,hrk_tipad,hrk_ack,\r\n  tarih,saat,\r\n  bnk_kod,bnk_muhonkod,bnk_muhkod,bnk_unvan,\r\n  car_tip,car_kod,car_muhonkod,car_muhkod,car_unvan,\r\n  belgeno,gider_tut,\r\n  geneltop,olustarsaat)\r\n\r\n  select p.varno,p.firmano,p.varno,p.varno,\r\n  1,'kas',\r\n  hrk_ba='B',\r\n  hrk_tip='TAH_POS',\r\n   hrk_tipno=3,'TPOS',\r\n    p.varad,   \r\n    p.tarih,p.saat,\r\n    '','','','',\r\n   /* m.bankod,car.muhonkod,car.muhkod,car.ad, */\r\n    'carikart',@CAR_KOD,@CAR_KOD,@CAR_KOD,@CAR_KOD,\r\n   belgeno='P'+cast(p.Firmano as varchar)+''+cast(p.varno as varchar), /* Varchar(15) */\r\n   gider_tut=0,\r\n   geneltop=abs(sum( m.giren-m.cikan)),\r\n   olustarsaat=p.olustarsaat\r\n   from poshrk as m with (nolock)\r\n   inner join pomvardimas as p with (nolock) on p.varno=m.varno \r\n   inner join islemhrktip as isl on \r\n   (isl.tip+'_'+isl.hrk)=(m.islmtip+'_'+m.islmhrk) and  (m.islmtip+'_'+m.islmhrk)='TAH_POS'\r\n   Where m.sil=0 and m.varno>0 and m.varok=1 and m.firmano in (0,@Firmano)\r\n   and m.tarih>=@bastar and m.tarih <=@bittar\r\n    and isnull(m.Entegre,0)=0 and m.yertip='pomvardimas'\r\n   group by p.varno,p.firmano,p.varad,p.tarih,p.saat,p.olustarsaat\r\n   order by p.varno\r\n\r\n\r\n\r\n\r\n\r\n  if @Firmano>0 and @Tip=2\r\n  insert into @TB_LOGO_KASA\r\n  (id,firmano,islmhrk_id,hrk_id,Aktar,Petro_Evrak_Tip,hrk_ba,\r\n  hrk_tip,hrk_tipno,hrk_tipad,hrk_ack,\r\n  tarih,saat,\r\n  bnk_kod,bnk_muhonkod,bnk_muhkod,bnk_unvan,\r\n  car_tip,car_kod,car_muhonkod,car_muhkod,car_unvan,\r\n  belgeno,gider_tut,\r\n  geneltop,olustarsaat)\r\n\r\n  select p.varno,p.firmano,p.varno,p.varno,\r\n  1,'kas',\r\n  hrk_ba= 'B',\r\n  hrk_tip='TAH_POS',\r\n   hrk_tipno=3, 'TPOS',\r\n    p.varad,   \r\n    p.tarih,p.saat,\r\n    '','','','',\r\n   /*  m.bankod,car.muhonkod,car.muhkod,car.ad, */\r\n    'carikart',@CAR_KOD,@CAR_KOD,@CAR_KOD,@CAR_KOD,\r\n   belgeno='M'+cast(p.Firmano as varchar)+''+cast(p.varno as varchar), /* Varchar(15) */\r\n   gider_tut=0,\r\n   geneltop=abs (sum( m.giren-m.cikan)),\r\n   olustarsaat=p.olustarsaat\r\n   from poshrk as m with (nolock)\r\n   inner join marvardimas as p  with (nolock) on p.varno=m.varno \r\n    and  (m.islmtip+'_'+m.islmhrk)='TAH_POS'\r\n /*  left join Genel_Kart as car on car.cartp='bankakart'   and car.kod=m.bankod  */\r\n   Where m.sil=0 and m.varno>0 and m.varok=1 and m.firmano in (0,@Firmano)\r\n   and m.tarih>=@bastar and m.tarih <=@bittar\r\n    and isnull(m.Entegre,0)=0 and m.yertip='marvardimas'\r\n   group by p.varno,p.firmano,p.varad,p.tarih,p.saat,p.olustarsaat\r\n   order by p.varno\r\n  \r\n  /* if @Islidin<>'' */\r\n  /*  delete from @TB_LOGO_KASA Where islmhrk_id not in (select * from CsvToInt(@Islidin) ) */\r\n  \r\n  \r\n  \r\n   update @TB_LOGO_KASA set\r\n   giren=case when hrk_BA='A' then \r\n   geneltop else 0 end,\r\n   cikan=case when hrk_BA='B' then \r\n   geneltop else 0 end\r\n  \r\n  \r\n  \r\n\r\n\r\n return\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "Udf_Logo_Vardiya_Veresiye",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.Udf_Logo_Vardiya_Veresiye",
    "definition": "CREATE FUNCTION [dbo].[Udf_Logo_Vardiya_Veresiye]\r\n(@Firmano  int,\r\n@Bastar DATETIME,\r\n@Bittar DATETIME)\r\nRETURNS\r\n  @TB_LOGO_BANKA TABLE (\r\n  id\t\t\t\t\t int,\r\n  hrk_id                 int,\r\n  hrk_ba\t\t\t\t varchar(5) COLLATE Turkish_CI_AS,\t\r\n  hrk_tipno\t\t\t\t int,\r\n  hrk_tipad\t\t\t\t varchar(50) COLLATE Turkish_CI_AS,\r\n  hrk_ack\t\t\t\t varchar(200) COLLATE Turkish_CI_AS,\r\n  tarih                  datetime,\r\n  saat                   varchar(10) COLLATE Turkish_CI_AS,\r\n  Acar_kod\t\t\t varchar(30) COLLATE Turkish_CI_AS,\r\n  Acar_muhonkod\t     varchar(30) COLLATE Turkish_CI_AS,\r\n  Acar_muhkod\t\t\t varchar(30) COLLATE Turkish_CI_AS,\r\n  Acar_unvan\t\t\t varchar(150) COLLATE Turkish_CI_AS,\r\n  Bcar_kod\t\t\t\t varchar(30) COLLATE Turkish_CI_AS,\r\n  Bcar_muhonkod\t\t\t varchar(30) COLLATE Turkish_CI_AS,\r\n  Bcar_muhkod\t\t\t varchar(30) COLLATE Turkish_CI_AS,\r\n  Bcar_unvan\t\t\t\t varchar(150) COLLATE Turkish_CI_AS,\r\n  belgeno\t\t\t     Varchar(20) COLLATE Turkish_CI_AS,\r\n  geneltop\t\t\t     float,\r\n  olustarsaat            datetime\r\n  )\r\nAS\r\nBEGIN\r\n\r\n\r\n declare @CAR_KOD  varchar(50)\r\n\r\n if @firmano=0  \r\n  SELECT @CAR_KOD=zrap_carkod FROM sistemtanim\r\n\r\n\r\n if @firmano>0  \r\n  SELECT @CAR_KOD=Entegre_ZraporOnMuhKod FROM Firma where id=@firmano\r\n\r\n  insert into @TB_LOGO_BANKA\r\n  (id,hrk_id,hrk_ba,hrk_tipno,hrk_tipad,hrk_ack,\r\n  tarih,saat,\r\n  Acar_kod,Acar_muhonkod,Acar_muhkod,Acar_unvan,\r\n  Bcar_kod,Bcar_muhonkod,Bcar_muhkod,Bcar_unvan,\r\n  belgeno,geneltop,olustarsaat)\r\n\r\n  select m.id,m.verid,\r\n    hrk_ba='B',\r\n    hrk_tipno=5,'VER',m.ack,   /*VİRMAN */\r\n    m.tarih,m.saat,\r\n    @CAR_KOD,@CAR_KOD,@CAR_KOD,@CAR_KOD,\r\n    m.carkod,car.muhonkod,car.muhkod,car.ad,\r\n    belgeno=m.seri+cast(m.no as varchar), \r\n    geneltop=(toptut-isktop),\r\n    olustarsaat=m.olustarsaat\r\n    from veresimas as m WITH(NOLOCK)\r\n    inner join Genel_Kart as car on car.cartp='carikart'\r\n    and car.kod=m.carkod and m.sil=0 \r\n    and m.fistip='FISVERSAT'\r\n    and m.firmano=@Firmano\r\n    Where sil=0 and m.varno in\r\n    (select varno from pomvardimas WITH(NOLOCK) where sil=0 and varok=1 and  \r\n    tarih>=@bastar and tarih <=@bittar )\r\n    and m.yertip='pomvardimas' and isnull(m.Entegre,0)=0  \r\n    order by m.id\r\n  \r\n   \r\n  \r\n\r\n return\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "Udf_Logo_Zrapor_Hrk",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.Udf_Logo_Zrapor_Hrk",
    "definition": "CREATE FUNCTION [dbo].[Udf_Logo_Zrapor_Hrk]\r\n(@Firmano int,\r\n@Bastar DATETIME,\r\n@Bittar DATETIME,\r\n@AkaryakitBrm   Varchar(20),\r\n@MarketBrm   Varchar(20),\r\n@MasrafBrm   Varchar(20))\r\nRETURNS\r\n  @TB_LOGO_FATURA TABLE (\r\n  fat_id                 int,\r\n  FatRap_id\t\t\t\t int,\r\n  Petro_Evrak_Tip        varchar(30),\r\n  hrk_tipno\t\t\t\t int,\r\n  stk_logo_tip           int,                \r\n  stk_kod\t\t\t\t varchar(30),\r\n  stk_muhonkod\t\t\t varchar(30),\r\n  stk_muhkod\t\t\t varchar(30),\r\n  stk_muhkdvkod\t\t\t varchar(30), \r\n  stk_brim\t\t\t\t varchar(5),\r\n  stk_brmfiy\t\t\t float,\r\n  stk_brmfiykdvli    \t float,\r\n  stk_miktar\t\t\t float,\r\n  stk_isktop\t\t\t float,\t\t\t\t\t\r\n  stk_kdv     \t\t\t float,\r\n  stk_kdvtop     \t     float,\r\n  stk_aratop             float,\r\n  stk_isktolutop         float,\r\n  stk_olustarsaat        datetime\r\n  )\r\nAS\r\nBEGIN\r\n\r\n   insert into @TB_LOGO_FATURA\r\n  (fat_id,FatRap_id,Petro_Evrak_Tip,\r\n  hrk_tipno,stk_logo_tip,\r\n  stk_kod,stk_muhonkod,\r\n  stk_muhkod,stk_muhkdvkod,\r\n  stk_brim,\r\n  stk_brmfiy,\r\n  stk_brmfiykdvli,\r\n  stk_miktar,\r\n  stk_isktop,\r\n  stk_kdv,\r\n  stk_kdvtop,\r\n  stk_aratop,\r\n  stk_isktolutop,\r\n  stk_olustarsaat)\r\n\r\n  select h.zrapid,0,'ZRAPOR',\r\n    cha_tip=8,\r\n    case \r\n    when h.tip='akykt' then  0\r\n    when h.tip='markt' then  0\r\n    when h.tip='gelgid' then 4 \r\n    end,\r\n    SK.kod,\r\n    sk.muhonkod,\r\n    sk.muhckskod,\r\n    dbo.Udf_KdvMuhKodu(2,sk.kdv),\r\n    case\r\n    when h.tip='akykt' then  @AkaryakitBrm\r\n    when h.tip='markt' then  @MarketBrm\r\n    when h.tip='gelgid' then @MasrafBrm\r\n    end,\r\n    (h.brmfiy/(1+h.kdvyuz)), /*BRMKDVSIZ, */\r\n    h.brmfiy,/*h.STOK_BRMKDVLI, */\r\n    h.miktar,/*miktar */\r\n    0,/*isktop */\r\n    h.kdvyuz*100,\r\n    (h.brmfiy-(h.brmfiy/(1+h.kdvyuz)))*h.miktar,/*kdvtop */\r\n    (h.brmfiy/(1+h.kdvyuz))*h.miktar,/*kdvsiztop */\r\n    h.brmfiy*h.miktar,/*kdvtoplam */\r\n    stk_olustarsaat=h.olustarsaat\r\n    from zrapormas as m \r\n    inner join  zraporhrk h on h.zrapid=m.zrapid and m.sil=0 and h.sil=0\r\n    inner join Zrapor_UrunKart_Listesi as sk on sk.tip=h.tip and sk.kod=h.kod \r\n    where m.firmano=@Firmano and m.tarih>=@Bastar and  m.tarih<=@Bittar\r\n    and isnull(m.Entegre,0)=0\r\n    \r\n\r\n    \r\n  \r\n  \r\n   \r\n   \r\n\r\n return\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "Udf_Logo_ZRapor_Mas",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.Udf_Logo_ZRapor_Mas",
    "definition": "CREATE FUNCTION [dbo].[Udf_Logo_ZRapor_Mas]\r\n(@Firmano int,@Bastar DATETIME,@Bittar DATETIME)\r\nRETURNS\r\n  @TB_LOGO_FATURA TABLE (\r\n  fat_id                 int,\r\n  FatRap_id\t\t\t\t int,\r\n  Petro_Evrak_Tip        varchar(30),\r\n  hrk_tipno\t\t\t\t int,\r\n  hrk_tip\t\t\t\t varchar(10),\r\n  hrk_tipad\t\t\t\t varchar(50),\r\n  hrk_ack\t\t\t\t varchar(200),\r\n  tarih                  datetime,\r\n  saat                   varchar(10),\r\n  car_kod\t\t\t\t varchar(30),\r\n  car_muhonkod\t\t\t varchar(30),\r\n  car_muhkod\t\t\t varchar(30),\r\n  car_unvan\t\t\t\t varchar(150),\r\n  belgeno\t\t\t     Varchar(20),\r\n  fat_gider              float,\r\n  fat_iskonto\t\t\t float,\r\n  fat_isk_yuz            float,\t\t\t\t\t\r\n  fat_kdvtop\t\t\t float,\r\n  fat_aratop\t\t\t float,\r\n  fat_geneltop\t\t\t float,\r\n  giren\t\t\t\t\t float,\r\n  cikan\t\t\t\t\t float,\r\n  fat_olustarsaat        datetime,\r\n  Entegre\t\t\t\t bit default 0\r\n  )\r\nAS\r\nBEGIN\r\n\r\n\r\n  DECLARE @CAR_KOD             VARCHAR(30) \r\n\r\n   if @firmano=0  \r\n    SELECT @CAR_KOD=zrap_carkod FROM sistemtanim\r\n\r\n\r\n   if @firmano>0  \r\n    SELECT @CAR_KOD=Entegre_ZraporOnMuhKod FROM Firma where id=@firmano\r\n\r\n\r\n \r\n   \r\n      insert into @TB_LOGO_FATURA\r\n      (fat_id,FatRap_id,Petro_Evrak_Tip,\r\n      hrk_tip,hrk_tipno,hrk_tipad,hrk_ack,\r\n      tarih,saat,car_kod,car_muhonkod,car_muhkod,car_unvan,\r\n      belgeno,fat_gider,\r\n      fat_aratop,\r\n      fat_iskonto,fat_isk_yuz,fat_kdvtop,\r\n      fat_geneltop,\r\n      fat_olustarsaat,Entegre)\r\n  \r\n      select m.zrapid,0,fistip='ZRAPOR',\r\n      hrk_tip='var',hrk_tipno=8,'Z RAPORLARI',\r\n      '',m.tarih,m.saat,\r\n      @CAR_KOD,@CAR_KOD,@CAR_KOD,@CAR_KOD,\r\n      fat_serino=M.zseri+cast(M.zserino as varchar),\r\n      fat_gider=0,\r\n       fat_aratop=m.Genel_Ara_Top,\r\n       fat_iskonto=0,\r\n       fat_isk_yuz=0,\r\n       fat_kdvtop=M.Genel_Kdv_Top,\r\n      fat_geneltop=M.Genel_Top,\r\n      fat_olustarsaat=m.olustarsaat,\r\n      Entegre=M.Entegre\r\n      from zrapormas as m where m.firmano=@Firmano\r\n      and m.tarih>=@Bastar and  m.tarih<=@Bittar\r\n      and m.sil=0 and isnull(m.Entegre,0)=0\r\n     \r\n  \r\n      update @TB_LOGO_FATURA set\r\n      giren=case when hrk_tipno=1 then \r\n      fat_geneltop else 0 end,\r\n      cikan=case \r\n      when (hrk_tipno=7) or (hrk_tipno=8) then \r\n      fat_geneltop else 0 end  \r\n  \r\n \r\n\r\n return\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "Udf_Luca_ZraporId_Muh",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.Udf_Luca_ZraporId_Muh",
    "definition": "CREATE FUNCTION [dbo].[Udf_Luca_ZraporId_Muh]\r\n(@Firmano int,\r\n@MasId   int,\r\n@KasaMuhKod  varchar(30),\r\n@VeresiyeMuhKod  varchar(30),\r\n@Kdv1MuhKod    varchar(30),  \r\n@Kdv8MuhKod    varchar(30), \r\n@Kdv18MuhKod    varchar(30)\r\n)\r\nRETURNS\r\n  @TB_LOGO_FATURA TABLE (\r\n  TipId\t\t\t\t\t int default 0,\r\n  ZrapId                 int,\r\n  SatirTip               varchar(20),\r\n  SatirKod               varchar(30),\r\n  FisNo  \t\t\t\t varchar(30),\r\n  FisTarih               datetime,\r\n  HesapKodu \t\t\t varchar(30),\r\n  EvrakNo                varchar(30),                \r\n  EvrakTarih             datetime,\r\n  Aciklama\t\t\t     varchar(100),\r\n  Borc\t\t\t         float,\r\n  Alacak    \t\t\t float,\r\n  Miktar                 float default 0\r\n)\r\nAS\r\nBEGIN\r\n\r\n\r\n/*\r\nFiş No\tFiş Tarihi\tHesap Kodu  \tEvrak No\t  Evrak Tarihi\tAçıklama\tBorç\tAlacak\t    Miktar\r\n\t     1.1.2019\t600.11.01.005\t181         \t1.1.2019\tZ RAPORU\t0\t\t610,2881\t128,5\r\n\t     1.1.2019\t600.11.01.003\t181\t\t\t\t1.1.2019\tZ RAPORU\t0\t\t3594,797\t742,95\r\n\t     1.1.2019\t600.11.01.002\t181\t\t\t\t1.1.2019\tZ RAPORU\t0\t\t754,2712\t150,6   \r\n\t     1.1.2019\t391.11.01.001\t181\t\t\t\t1.1.2019\tZ RAPORU\t0\t\t892,6841\t0      --hesaplanan kdv\r\n\t\t 1.1.2019\t108-01( Ykb\t    181\t\t\t\t1.1.2019\tZ RAPORU\t1000\t0\t               --pos\r\n\t     1.1.2019\t108-02 (Akbank\t181\t\t\t\t1.1.2019\tZ RAPORU\t852,04\t0\t               --pos\r\n\t     1.1.2019\t120-01 (Z carisi)181\t\t\t1.1.2019\tZ RAPORU\t3000\t0\t               --veresiye\r\n\t     1.1.2019\t100 Kasa\t\t 181\t\t\t1.1.2019\tZ RAPORU\t1000\t0\t               --kasa\r\n*/\r\n\r\n   Declare @FisTarih           Datetime\r\n   Declare @EvrakNo            varchar(30)\r\n   Declare @Aciklama           varchar(100)\r\n   \r\n   declare   @ZCariMuh         varchar(30)\r\n   \r\n   select top 1 @ZCariMuh=c.muhkod from zrapormas as z with (nolock)\r\n   inner join carikart as c on z.carkod=c.kod where z.sil=0 and z.MasId=@MasId\r\n   \r\n\r\n  declare @ZrapId int\r\n  declare pom_var CURSOR FAST_FORWARD  FOR \r\n  select zrapid from zrapormas as m with (nolock) where MasId=@MasId and sil=0\r\n   open pom_var\r\n  fetch next from  pom_var into @ZrapId\r\n  while @@FETCH_STATUS=0\r\n   begin\r\n\r\n\r\n  /*Stok Hrkleri */\r\n   insert into @TB_LOGO_FATURA\r\n  (ZrapId,SatirTip,SatirKod,\r\n  FisNo,FisTarih,HesapKodu,EvrakNo,EvrakTarih,Aciklama,\r\n   Borc,Alacak,Miktar)\r\n\r\n  /* Stok Hrkleri */\r\n    select @ZrapId,\r\n    'Stok','Stok '+sk.kod,\r\n    '',m.tarih,\r\n    sk.muhckskod,\r\n   /* sk.muhckskod, */\r\n    m.zseri+''+cast(m.zserino as varchar),\r\n    m.tarih,m.ack,\r\n   /* dbo.Udf_KdvMuhKodu(2,sk.kdv), */\r\n    0,\r\n    /*(h.brmfiy/(1+h.kdvyuz))*h.miktar,--kdvsiztop */\r\n    /*(h.brmfiy/(1+h.kdvyuz)), --BRMKDVSIZ, */\r\n   /* (h.brmfiy-(h.brmfiy/(1+h.kdvyuz)))*h.miktar,--kdvtop */\r\n    (h.brmfiy/(1+h.kdvyuz))*h.miktar,\r\n    h.miktar/*miktar */\r\n  \r\n\r\n    from zrapormas as m with (nolock)\r\n    inner join  zraporhrk h with (nolock) on h.zrapid=m.zrapid and m.sil=0 and h.sil=0\r\n    inner join Zrapor_UrunKart_Listesi as sk with (nolock) on sk.tip=h.tip and sk.kod=h.kod \r\n    where  m.zrapid=@ZrapId  /*m.firmano=@Firmano and */\r\n    /*and isnull(m.Entegre,0)=0 */\r\n    \r\n  /* Hesaplanan Kdv  */\r\n /*  Declare @KdvliToplamTutar float */\r\n  /* Declare @KdvsizToplamToplam float */\r\n   \r\n   \r\n    Select top 1 \r\n    /*@KdvliToplamTutar=sum(h.brmfiy*h.miktar), */\r\n    /*@KdvsizToplamToplam=sum((h.brmfiy/(1+h.kdvyuz))*h.miktar), */\r\n    @EvrakNo=m.zseri+''+cast(m.zserino as varchar),\r\n    @FisTarih=m.tarih,\r\n    @Aciklama=m.ack\r\n    from zrapormas as m with (nolock)\r\n    inner join  zraporhrk h with (nolock) on h.zrapid=m.zrapid and m.sil=0 and h.sil=0\r\n    inner join Zrapor_UrunKart_Listesi as sk with (nolock) on sk.tip=h.tip and sk.kod=h.kod \r\n    where  m.zrapid=@ZrapId  /*m.firmano=@Firmano and */\r\n    /*and isnull(m.Entegre,0)=0 */\r\n   /* group by m.zseri+''+cast(m.zserino as varchar),m.tarih,m.ack */\r\n   \r\n    \r\n    insert into @TB_LOGO_FATURA\r\n    (ZrapId,SatirTip,SatirKod,FisNo,FisTarih,HesapKodu,EvrakNo,EvrakTarih,Aciklama,\r\n     Borc,Alacak)\r\n    Select @ZrapId,'Hes.Kdv','Kdv '+cast(h.kdvyuz*100 as varchar),\r\n    '' FisNo,m.tarih,\r\n    case \r\n    when h.kdvyuz=0.01 then @Kdv1MuhKod \r\n    when h.kdvyuz=0.10 then @Kdv8MuhKod \r\n    when h.kdvyuz=0.20 then @Kdv18MuhKod end,\r\n     m.zseri+''+cast(m.zserino as varchar),\r\n     m.tarih,m.ack,\r\n     0,\r\n    sum((h.brmfiy-(h.brmfiy/(1+h.kdvyuz)))*h.miktar)/*kdvtop */\r\n    from zrapormas as m with (nolock)\r\n    inner join  zraporhrk h with (nolock) on h.zrapid=m.zrapid and m.sil=0 and h.sil=0\r\n    inner join Zrapor_UrunKart_Listesi as sk with (nolock) on sk.tip=h.tip and sk.kod=h.kod \r\n    where  m.zrapid=@ZrapId /*and isnull(m.Entegre,0)=0 */\r\n    and h.kdvyuz>0\r\n    group by h.kdvyuz,m.masId,m.tarih,\r\n    m.zseri,m.zserino,m.ack\r\n  \r\n  \r\n  \r\n    /*Z cari kapatma */\r\n    insert into @TB_LOGO_FATURA\r\n    (TipId,ZrapId,SatirTip,SatirKod,\r\n    FisNo,FisTarih,HesapKodu,EvrakNo,EvrakTarih,Aciklama,\r\n    Borc,Alacak,Miktar)\r\n    select 1,@MasId,'Zcari','ZCariMuhKod',\r\n    '',@FisTarih,@ZCariMuh,@EvrakNo,@FisTarih,@Aciklama,\r\n    case when sum(Borc-Alacak)<0 then abs(sum(Borc-Alacak)) else 0 end,\r\n    case when sum(Borc-Alacak)>0 then sum(Borc-Alacak) else 0 end,0 from @TB_LOGO_FATURA\r\n    where ZrapId=@ZrapId\r\n\r\n  \r\n  \r\n     FETCH next from  pom_var into @ZrapId\r\n  end\r\n close Pom_Var\r\n deallocate pom_var\r\n \r\n  \r\n  \r\n   declare @VardiyaTip  int\r\n   select top 1 @VardiyaTip=m.VarTip From ZraporVardiya as m with (nolock)\r\n   inner join zrapormas as z with (nolock) on z.zrapid=m.zrapid \r\n   and m.sil=0 and z.sil=0 and z.MasId=@MasId\r\n   \r\n   \r\n   \r\n   /*pos  */\r\n   if @VardiyaTip=1\r\n    begin\r\n    \r\n      insert into @TB_LOGO_FATURA\r\n      (TipId,ZrapId,SatirTip,SatirKod,\r\n      FisNo,FisTarih,HesapKodu,EvrakNo,EvrakTarih,Aciklama,\r\n      Borc,Alacak)\r\n      Select 2,@MasId,'Pos Cari','Pos '+k.kod,\r\n      '',@FisTarih,k.muhkod,@MasId,@FisTarih,@Aciklama,\r\n      sum(giren),0\r\n      from poshrk as h with (nolock) \r\n      inner join poskart as k with (nolock)  on  k.kod=h.poskod\r\n      where h.sil=0 and h.yertip='pomvardimas' \r\n      and h.varno in (\r\n      select m.varno From ZraporVardiya as m with (nolock)\r\n      inner join zrapormas as z with (nolock) on z.zrapid=m.zrapid \r\n      and m.sil=0 and z.sil=0 and z.MasId=@MasId )\r\n      group by k.muhkod,k.kod\r\n      \r\n      \r\n      insert into @TB_LOGO_FATURA\r\n      (TipId,ZrapId,SatirTip,SatirKod,\r\n      FisNo,FisTarih,HesapKodu,EvrakNo,EvrakTarih,Aciklama,\r\n      Borc,Alacak)\r\n      Select 2,@MasId,'Veresiye',h.carkod,\r\n      '',@FisTarih,c.muhkod,@MasId,@FisTarih,@Aciklama,\r\n      sum(h.toptut),0\r\n      from veresimas as h with (nolock) \r\n      inner join carikart as c on h.carkod=c.kod\r\n      where h.sil=0 and h.yertip='pomvardimas' \r\n      and h.varno in (\r\n      select m.varno From ZraporVardiya as m with (nolock)\r\n      inner join zrapormas as z with (nolock) on z.zrapid=m.zrapid \r\n      and m.sil=0 and z.sil=0 and z.MasId=@MasId )\r\n      group by h.carkod,c.muhkod\r\n      \r\n    \r\n    end\r\n   \r\n   \r\n   \r\n   /*pos  */\r\n   if @VardiyaTip=2\r\n    begin\r\n    \r\n      insert into @TB_LOGO_FATURA\r\n      (TipId,ZrapId,SatirTip,SatirKod,\r\n      FisNo,FisTarih,HesapKodu,EvrakNo,EvrakTarih,Aciklama,\r\n      Borc,Alacak)\r\n      Select 2,@MasId,'Pos Cari','Pos '+k.kod,\r\n      '',@FisTarih,k.muhkod,@MasId,@FisTarih,@Aciklama,\r\n      sum(giren),0\r\n      from poshrk as h with (nolock) \r\n      inner join poskart as k with (nolock)  on  k.kod=h.poskod\r\n      where h.sil=0 and h.yertip='marvardimas' \r\n      and h.varno in (\r\n      select m.varno From ZraporVardiya as m with (nolock)\r\n      inner join zrapormas as z with (nolock) on z.zrapid=m.zrapid \r\n      and m.sil=0 and z.sil=0 and z.MasId=@MasId )\r\n      group by k.muhkod,k.kod\r\n      \r\n      \r\n      insert into @TB_LOGO_FATURA\r\n      (TipId,ZrapId,SatirTip,SatirKod,\r\n      FisNo,FisTarih,HesapKodu,EvrakNo,EvrakTarih,Aciklama,\r\n      Borc,Alacak)\r\n      Select 2,@MasId,'Veresiye',h.carkod,\r\n      '',@FisTarih,c.muhkod,@MasId,@FisTarih,@Aciklama,\r\n      sum(h.toptut),0\r\n      from veresimas as h with (nolock)\r\n      inner join carikart as c on h.carkod=c.kod \r\n      where h.sil=0 and h.yertip='marvardimas' \r\n      and h.varno in (\r\n      select m.varno From ZraporVardiya as m with (nolock)\r\n      inner join zrapormas as z with (nolock) on z.zrapid=m.zrapid \r\n      and m.sil=0 and z.sil=0 and z.MasId=@MasId )\r\n      group by h.carkod,c.muhkod\r\n    \r\n    end\r\n   \r\n   \r\n     insert into @TB_LOGO_FATURA\r\n    (ZrapId,SatirTip,SatirKod,\r\n    FisNo,FisTarih,HesapKodu,EvrakNo,EvrakTarih,Aciklama,\r\n    Borc,Alacak,Miktar)\r\n    select @MasId,'Kasa','KasaMuhKod',\r\n    '',@FisTarih,@KasaMuhKod,@MasId,@FisTarih,@Aciklama,\r\n    case when sum(Borc-Alacak)<0 then abs(sum(Borc-Alacak)) else 0 end,\r\n    case when sum(Borc-Alacak)>0 then sum(Borc-Alacak) else 0 end,0 from @TB_LOGO_FATURA\r\n    where TipId in (0,2)\r\n    /*group by ZrapId */\r\n    \r\n    \r\n     \r\n   \r\n   /*Z cari kapatma */\r\n    insert into @TB_LOGO_FATURA\r\n    (TipId,ZrapId,SatirTip,SatirKod,\r\n    FisNo,FisTarih,HesapKodu,EvrakNo,EvrakTarih,Aciklama,\r\n    Borc,Alacak,Miktar)\r\n    select 3,@MasId,'Zcari','ZCariKod',\r\n    '',@FisTarih,@ZCariMuh,@MasId,@FisTarih,@Aciklama,\r\n    case when sum(Borc-Alacak)<0 then abs(sum(Borc-Alacak)) else 0 end,\r\n    case when sum(Borc-Alacak)>0 then sum(Borc-Alacak) else 0 end,0 from @TB_LOGO_FATURA\r\n    where TipId=1\r\n\r\n return\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_MARKET_ZRAPOR_HAZIRLA",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_MARKET_ZRAPOR_HAZIRLA",
    "definition": "CREATE FUNCTION dbo.[UDF_MARKET_ZRAPOR_HAZIRLA] \r\n(@VarNoIn varchar(500))\r\nRETURNS\r\n   \r\n   @TABLE_SAYAC_ZRAPOR TABLE (\r\n   Id\t\t\t\t\t    int IDENTITY(1, 1), \r\n   Firmano                  int,  \r\n   ZTip  \t\t\t\t\tVARCHAR(20) COLLATE Turkish_CI_AS,\r\n   CariKod\t\t\t\t\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n   Tarih\t\t\t\t\tdatetime,\r\n   ZSeri\t\t\t\t\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n   ZNo\t\t    \t\t\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n   YKKod     \t\t\t\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n   YkAd\t                    Varchar(50) COLLATE Turkish_CI_AS,\r\n   StokGrpId                int, \r\n   StokKod\t\t\t\t\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n   KdvYuzde\t\t\t\t\tFloat,\r\n   Fiyat\t\t\t\t\tFloat,\r\n   Miktar\t\t\t\t\tFloat,\r\n   Tutar\t\t\t\t\tFloat\r\n   )\r\n   \r\nAS\r\nBEGIN\r\n  \r\n    DECLARE @EKSTRE_TEMP TABLE (\r\n    StokGrpId                    int, \r\n    StokTip\t      Varchar(10) COLLATE Turkish_CI_AS,\r\n    StokKod\t      Varchar(30) COLLATE Turkish_CI_AS,\r\n    YkKod\t      Varchar(30) COLLATE Turkish_CI_AS,\t\t\r\n    YkAd\t      Varchar(50) COLLATE Turkish_CI_AS,\r\n    KdvYuzde\t  Float,\r\n    Fiyat         Float,\r\n    Miktar \t\t  Float,\r\n    Tutar         Float)\r\n\r\n    Declare @Tarih  Datetime\r\n    Declare @FirmaNo  int\r\n    declare @CariKod\t      Varchar(50)\r\n    \r\n    \r\n   \r\n\r\n    Select @FirmaNo=Max(Firmano),\r\n    @Tarih=MAX(Tarih) From MarVardimas with (nolock) \r\n    Where varno in (select * from CsvToInt(@VarNoIn))\r\n\r\n    select @CariKod=ZraporCariKod From Firma Where id=@FirmaNo\r\n\r\n    insert into @EKSTRE_TEMP \r\n    (StokTip,StokKod,KdvYuzde,Fiyat,Miktar,Tutar)\r\n    SELECT h.stktip,h.stkod,h.kdvyuz,\r\n    sum(( case when m.islmtip='satis' then h.mik else -1*h.mik end)*h.brmfiy)\r\n    /sum( case when m.islmtip='satis' then h.mik else -1*h.mik end),\r\n    \r\n    sum(case when m.islmtip='satis' then h.mik else -1*h.mik end),\r\n    sum((case when m.islmtip='satis' then h.mik else -1*h.mik end)*h.brmfiy)\r\n    FROM  marsatmas AS m  with (nolock)\r\n    inner join marsathrk as h with (nolock)\r\n    on m.marsatid=h.marsatid and  m.sil=0 and  h.sil=0\r\n    where m.varno in (select * from CsvToInt(@VarNoIn))\r\n    group by h.stktip,h.stkod,h.kdvyuz\r\n    having abs(sum(case when m.islmtip='satis' then h.mik else -1*h.mik end))>0\r\n       \r\n    \r\n    \r\n    update @EKSTRE_TEMP set StokGrpId=dt.GrpId,\r\n    KdvYuzde=dt.kdv/100,\r\n    YKKod=dt.YKKod from @EKSTRE_TEMP as t\r\n    join (select k.Tip,k.Kod,g.kdv,\r\n    case when K.grp3>0 then K.grp3 \r\n    when K.grp2>0 and K.grp3=0 then K.Grp2 \r\n    when K.grp1>0 and K.grp2=0 then K.Grp1 end GrpId,\r\n    G.ykkod from stokkart as k with (nolock) \r\n    inner join grup as g on g.id=k.grp1 where k.sil=0 and g.sil=0 ) dt \r\n    on dt.Tip=t.StokTip and dt.Kod=t.StokKod\r\n    \r\n    update @EKSTRE_TEMP set YkAd=dt.Ad from @EKSTRE_TEMP as t\r\n    join (select Kod,Ad from yazarkasakart as c \r\n    where c.sil=0) dt on dt.Kod=t.YKKod\r\n  \r\n    \r\n    \r\n  \r\n  insert into @TABLE_SAYAC_ZRAPOR \r\n  (Firmano,CariKod,Tarih,YKKod,YkAd,StokKod,KdvYuzde,Fiyat,Miktar,Tutar) \r\n  Select @FirmaNo,@CariKod,@Tarih,YKKod,YkAd,\r\n  cast(StokGrpId as varchar(20)),KdvYuzde,\r\n  round(case When Sum(Miktar)>0 then Sum(Tutar)/Sum(Miktar) else 0 end,8) Fiyat,\r\n  Sum(Miktar),\r\n  Sum(Tutar) From @EKSTRE_TEMP\r\n  Group by YKKod,YkAd,StokGrpId,KdvYuzde\r\n  \r\n  \r\n  update @TABLE_SAYAC_ZRAPOR set Miktar=-1,Fiyat=ABS(Tutar)\r\n  Where Tutar<0 and Miktar=0\r\n  \r\n  \r\n  \r\n  \r\n  \r\n    update @TABLE_SAYAC_ZRAPOR set ZSeri=dt.zseri,ZNo= cast( isnull(Dt.zserino,0) as int)+1 \r\n    from @TABLE_SAYAC_ZRAPOR as t\r\n    join (select ykkod,zseri,zserino from zrapormas as c with (nolock)  where \r\n    id in (Select max(id) id  From zrapormas as z with (nolock) \r\n    Where z.sil=0 and z.firmano=@FirmaNo group by ykkod )\r\n    ) dt on dt.ykkod=t.YKKod \r\n  \r\n\r\n\r\n  return\r\n\r\n\r\n\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_MIZAN_AKARYAKIT",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_MIZAN_AKARYAKIT",
    "definition": "CREATE FUNCTION [dbo].[UDF_MIZAN_AKARYAKIT] \r\n(\r\n@FIRMA_NO       \tINT,\r\n@id  \t\t\t\tINT,\r\n@BAS_TAR        \tDATETIME,\r\n@BIT_TAR  \t    \tDATETIME,\r\n@AK_FIYAT      \t\tTINYINT,\r\n@SIF_BAK3_GSTME \tTINYINT)\r\nRETURNS\r\n\r\n  @TABLE_MIZAN TABLE (\r\n   ID\t\t\t\t\tint,\r\n   PARENTID\t\t\t\tint,\t\r\n   GRPNO\t\t\t\tint,\r\n   KART_KOD\t\t\t\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n   ACK\t\t\t\t\tVARCHAR(100) COLLATE Turkish_CI_AS,\r\n   BORC\t\t\t\t    float,\r\n   ALACAK\t\t\t\tfloat,\r\n   BAKIYE_BORC\t\t\tfloat,\r\n   BAKIYE_ALACAK\t\tfloat)\r\n\r\nAS\r\nBEGIN\r\n\r\n\r\n\r\n  declare @grp1id int\r\n  declare @grp2id int\r\n\r\n  declare @KOD      varchar(100)\r\n  declare @GRP_AD   varchar(100)\r\n  declare @GRP_ID  \tfloat\r\n  declare @GRP_SR  \tint\r\n  \r\n  declare @BORC  \tfloat\r\n  declare @ALACAK  \tfloat\r\n  declare @BAKIYE  \tfloat\r\n  \r\n  \r\n  declare @GIREN  \t\tfloat\r\n  declare @CIKAN  \t\tfloat\r\n  declare @BRMFIY  \t\tfloat\r\n\r\n  declare @ABAKIYE  \tfloat\r\n  declare @BBAKIYE  \tfloat  \r\n\r\n\r\n  declare @GEC_BRMFIY  \tfloat\r\n\r\n      set @grp1id=@id\r\n    \r\n       insert into @TABLE_MIZAN (ID,PARENTID,ACK,BORC,ALACAK,BAKIYE_BORC,BAKIYE_ALACAK)\r\n       VALUES (@grp1id,0,'AKARYAKIT STOK KARTLARI',0,0,0,0)\r\n       \r\n       \r\n      \r\n      declare mas_cur CURSOR FAST_FORWARD  FOR \r\n       select id,sr,ad from grup where tabload='akytgrp' and sil=0 and sr=0\r\n         open mas_cur\r\n          fetch next from  mas_cur into @GRP_ID,@GRP_SR,@GRP_AD\r\n           while @@FETCH_STATUS=0\r\n            begin \r\n       \r\n       \r\n              set @id=@id+1 \r\n      \r\n              set @grp2id=@id\r\n     \r\n              insert into @TABLE_MIZAN (ID,PARENTID,ACK,BORC,\r\n              ALACAK,BAKIYE_BORC,BAKIYE_ALACAK)\r\n               VALUES (@id,@grp1id,@GRP_AD,0,0,0,0)\r\n   \r\n                 set @id=@id+1 \r\n       \r\n             IF (@FIRMA_NO=0)\r\n              declare gec_cur CURSOR FAST_FORWARD  FOR \r\n              select h.stkod,\r\n              sum(h.giren*h.brmfiykdvli),\r\n              sum(h.cikan*h.brmfiykdvli),\r\n              sum(h.giren),\r\n              sum(h.cikan)       \r\n              from\r\n              stkhrk as h \r\n              inner join stokkart as k on h.stktip=k.tip and h.stkod=k.kod\r\n              where h.stktip='akykt' and h. sil=0 and k.grp1=@GRP_ID\r\n              and h.tarih>=@BAS_TAR \r\n              and h.tarih<=@BIT_TAR \r\n              group by h.stkod\r\n              \r\n              \r\n              IF (@FIRMA_NO>0)\r\n              declare gec_cur CURSOR FAST_FORWARD  FOR \r\n              select h.stkod,\r\n              sum(h.giren*h.brmfiykdvli),\r\n              sum(h.cikan*h.brmfiykdvli),\r\n              sum(h.giren),\r\n              sum(h.cikan)       \r\n              from\r\n              stkhrk as h \r\n              inner join stokkart as k on h.stktip=k.tip and h.stkod=k.kod\r\n              where h.stktip='akykt' and h. sil=0 and k.grp1=@GRP_ID\r\n              and h.firmano in (0,@FIRMA_NO)\r\n              and h.tarih>=@BAS_TAR \r\n              and h.tarih<=@BIT_TAR \r\n              group by h.stkod \r\n              \r\n              \r\n              \r\n              \r\n               \r\n               open gec_cur\r\n                fetch next from  gec_cur into @KOD,@BORC,@ALACAK,@GIREN,@CIKAN\r\n                 while @@FETCH_STATUS=0\r\n                  begin\r\n            \r\n            \r\n               if @AK_FIYAT=1\r\n                begin \r\n                  SET @BRMFIY=DBO.UDF_Stok_Fiyat('akykt',2,@KOD,'Dahil',1)\r\n                  SET @BORC=@GIREN*@BRMFIY\r\n                  SET @ALACAK=@CIKAN*@BRMFIY\r\n                end\r\n \r\n                if @AK_FIYAT=2\r\n                begin \r\n                  SET @BRMFIY=DBO.UDF_Stok_Fiyat('akykt',2,@KOD,'Dahil',2)\r\n                  SET @BORC=@GIREN*@BRMFIY\r\n                  SET @ALACAK=@CIKAN*@BRMFIY\r\n                end           \r\n                    \r\n                if @AK_FIYAT=3\r\n                begin \r\n                  SET @BRMFIY=DBO.UDF_Stok_Fiyat('akykt',2,@KOD,'Dahil',3)\r\n                  SET @BORC=@GIREN*@BRMFIY\r\n                  SET @ALACAK=@CIKAN*@BRMFIY\r\n                end  \r\n                    \r\n                    \r\n                if @AK_FIYAT=4\r\n                begin \r\n                  SET @BRMFIY=DBO.UDF_Stok_Fiyat('akykt',2,@KOD,'Dahil',4)\r\n                  SET @BORC=@GIREN*@BRMFIY\r\n                  SET @ALACAK=@CIKAN*@BRMFIY\r\n                end \r\n            \r\n              if @AK_FIYAT=5\r\n                begin \r\n                  SET @BRMFIY=DBO.UDF_Stok_Fiyat('akykt',2,@KOD,'Hariç',1)\r\n                  SET @BORC=@GIREN*@BRMFIY\r\n                  SET @ALACAK=@CIKAN*@BRMFIY\r\n                end \r\n            \r\n             if @AK_FIYAT=6\r\n                begin \r\n                  SET @BRMFIY=DBO.UDF_Stok_Fiyat('akykt',2,@KOD,'Hariç',2)\r\n                  SET @BORC=@GIREN*@BRMFIY\r\n                  SET @ALACAK=@CIKAN*@BRMFIY\r\n               end \r\n               \r\n             if @AK_FIYAT=7\r\n                begin \r\n                  SET @BRMFIY=DBO.UDF_Stok_Fiyat('akykt',2,@KOD,'Hariç',3)\r\n                  SET @BORC=@GIREN*@BRMFIY\r\n                  SET @ALACAK=@CIKAN*@BRMFIY\r\n                end    \r\n               \r\n             if @AK_FIYAT=8\r\n                begin \r\n                  SET @BRMFIY=DBO.UDF_Stok_Fiyat('akykt',2,@KOD,'Hariç',4)\r\n                  SET @BORC=@GIREN*@BRMFIY\r\n                  SET @ALACAK=@CIKAN*@BRMFIY\r\n                end    \r\n             \r\n              if @AK_FIYAT=9\r\n                begin \r\n                  SET @BRMFIY=DBO.UDF_Stok_Fiyat('akykt',1,@KOD,'Dahil',4)\r\n                  SET @BORC=@GIREN*@BRMFIY\r\n                  SET @ALACAK=@CIKAN*@BRMFIY\r\n                end   \r\n          \r\n          \r\n                if @AK_FIYAT=10\r\n                begin \r\n                  SET @BRMFIY=DBO.UDF_Stok_Fiyat('akykt',1,@KOD,'Hariç',4)\r\n                  SET @BORC=@GIREN*@BRMFIY\r\n                  SET @ALACAK=@CIKAN*@BRMFIY\r\n                end  \r\n                \r\n                \r\n               SET @GEC_BRMFIY=0\r\n                \r\n               if @AK_FIYAT=11 /*alis fiyatı son tarihteki kdv dahil */\r\n                begin \r\n                 \r\n                 IF (@FIRMA_NO=0) \r\n                  SELECT TOP 1 @GEC_BRMFIY=h.brmfiykdvli \r\n                     from stkhrk as h\r\n                    where stktip='akykt' and stkod=@KOD\r\n                    and h.tarih<=@BIT_TAR and h.sil=0 and h.giren>0\r\n                    order by h.tarih desc,h.saat desc \r\n                    \r\n                    \r\n                   IF (@FIRMA_NO>0) \r\n                  SELECT TOP 1 @GEC_BRMFIY=h.brmfiykdvli \r\n                     from stkhrk as h\r\n                    where stktip='akykt' and stkod=@KOD and h.firmano in (0,@FIRMA_NO)\r\n                    and h.tarih<=@BIT_TAR and h.sil=0 and h.giren>0\r\n                    order by h.tarih desc,h.saat desc   \r\n              \r\n                  \r\n                  SET @BORC=@GIREN*@GEC_BRMFIY\r\n                  SET @ALACAK=@CIKAN*@GEC_BRMFIY\r\n                end  \r\n                \r\n                \r\n                \r\n                if @AK_FIYAT=12 /*alis fiyatı son tarihteki kdv haric */\r\n                begin \r\n                  \r\n                  IF (@FIRMA_NO=0)\r\n                    SELECT TOP 1 @GEC_BRMFIY=(h.brmfiykdvli/(1+(h.kdvyuz))) \r\n                     from stkhrk as h\r\n                    where stktip='akykt' and stkod=@KOD\r\n                    and h.tarih<=@BIT_TAR and h.sil=0 and h.giren>0\r\n                    order by h.tarih desc,h.saat desc \r\n                    \r\n                  IF (@FIRMA_NO>0)\r\n                    SELECT TOP 1 @GEC_BRMFIY=(h.brmfiykdvli/(1+(h.kdvyuz))) \r\n                     from stkhrk as h\r\n                    where stktip='akykt' and stkod=@KOD and h.firmano in (0,@FIRMA_NO)\r\n                    and h.tarih<=@BIT_TAR and h.sil=0 and h.giren>0\r\n                    order by h.tarih desc,h.saat desc    \r\n                    \r\n                    \r\n\r\n                  SET @BORC=@GIREN*@GEC_BRMFIY\r\n                  SET @ALACAK=@CIKAN*@GEC_BRMFIY\r\n                end   \r\n                \r\n                \r\n                \r\n                if @AK_FIYAT=13 /*satis fiyatı son tarihteki kdv dahil */\r\n                begin \r\n                 \r\n                IF (@FIRMA_NO=0) \r\n                  SELECT TOP 1 @GEC_BRMFIY=h.brmfiykdvli \r\n                     from stkhrk as h\r\n                    where stktip='akykt' and stkod=@KOD\r\n                    and h.tarih<=@BIT_TAR and h.sil=0 and h.cikan>0\r\n                    order by h.tarih desc,h.saat desc \r\n                \r\n                 IF (@FIRMA_NO>0)\r\n                  SELECT TOP 1 @GEC_BRMFIY=h.brmfiykdvli \r\n                     from stkhrk as h\r\n                    where stktip='akykt' and stkod=@KOD and h.firmano in (0,@FIRMA_NO)\r\n                    and h.tarih<=@BIT_TAR and h.sil=0 and h.cikan>0\r\n                    order by h.tarih desc,h.saat desc \r\n                  \r\n                  SET @BORC=@GIREN*@GEC_BRMFIY\r\n                  SET @ALACAK=@CIKAN*@GEC_BRMFIY\r\n                end  \r\n                \r\n                \r\n                \r\n                if @AK_FIYAT=14 /*satis fiyatı son tarihteki kdv haric */\r\n                begin \r\n                 \r\n                 IF (@FIRMA_NO=0)  \r\n                  SELECT TOP 1 @GEC_BRMFIY=(h.brmfiykdvli/(1+(h.kdvyuz))) \r\n                     from stkhrk as h\r\n                    where stktip='akykt' and stkod=@KOD\r\n                    and h.tarih<=@BIT_TAR and h.sil=0 and h.cikan>0\r\n                    order by h.tarih desc,h.saat desc \r\n                    \r\n                 IF (@FIRMA_NO>0)   \r\n                   SELECT TOP 1 @GEC_BRMFIY=(h.brmfiykdvli/(1+(h.kdvyuz))) \r\n                     from stkhrk as h\r\n                    where stktip='akykt' and stkod=@KOD and h.firmano in (0,@FIRMA_NO)\r\n                    and h.tarih<=@BIT_TAR and h.sil=0 and h.cikan>0\r\n                    order by h.tarih desc,h.saat desc  \r\n                    \r\n\r\n                  SET @BORC=@GIREN*@GEC_BRMFIY\r\n                  SET @ALACAK=@CIKAN*@GEC_BRMFIY\r\n                end   \r\n                \r\n \r\n            \r\n            set @BORC=ROUND(@BORC,2)\r\n            set @ALACAK=ROUND(@ALACAK,2)\r\n            \r\n            set @BBAKIYE=0\r\n            set @ABAKIYE=0\r\n            \r\n            SET @BAKIYE=@BORC-@ALACAK \r\n             \r\n             if @BAKIYE>0\r\n              set @BBAKIYE=@BAKIYE\r\n              \r\n             if @BAKIYE<0\r\n              set @ABAKIYE=-1*@BAKIYE\r\n                \r\n            \r\n              if (@SIF_BAK3_GSTME=0) OR (@SIF_BAK3_GSTME=1 AND (@BAKIYE <>0) )\r\n              insert into @TABLE_MIZAN (ID,PARENTID,KART_KOD,ACK,BORC,ALACAK,BAKIYE_BORC,BAKIYE_ALACAK)\r\n              VALUES (@id,@grp2id,@KOD,@KOD,@BORC,@ALACAK,@BBAKIYE,@ABAKIYE)\r\n\r\n           set @id=@id+1  \r\n\r\n             FETCH next from  gec_cur into @KOD,@BORC,@ALACAK,@GIREN,@CIKAN\r\n           end\r\n         close gec_cur\r\n         deallocate gec_cur\r\n         \r\n         \r\n         \r\n              update @TABLE_MIZAN set \r\n               BORC=isnull(dt.BORC,0),ALACAK=isnull(dt.ALACAK,0),\r\n               BAKIYE_BORC=isnull(dt.BBORC,0),BAKIYE_ALACAK=isnull(dt.BALACAK,0)\r\n                from @TABLE_MIZAN as t\r\n               join (select sum(borc) as borc,sum(alacak) as alacak,\r\n               case when  sum(borc-alacak)>0 then sum(borc-alacak) else 0 end bborc,\r\n               case when sum(borc-alacak)<0 then -1*sum(borc-alacak) else 0 end balacak\r\n               from @TABLE_MIZAN where PARENTID=@grp2id ) dt \r\n               on t.ID=@grp2id     \r\n                 \r\n                 \r\n              FETCH next from  mas_cur into @GRP_ID,@GRP_SR,@GRP_AD\r\n             end\r\n            Close mas_cur\r\n            deallocate mas_cur   \r\n         \r\n\r\n         \r\n        update @TABLE_MIZAN set ACK=dt.ad from @TABLE_MIZAN as t join\r\n        (select kod,ad from stokkart where tip='akykt') dt \r\n        on t.KART_KOD=dt.kod\r\n         \r\n       \r\n        /* \r\n         update @TABLE_MIZAN set \r\n         BORC=isnull(dt.BORC,0),ALACAK=isnull(dt.ALACAK,0),\r\n         BAKIYE_BORC=ISNULL(dt.BBORC,0),BAKIYE_ALACAK=isnull(dt.BALACAK,0)\r\n          from @TABLE_MIZAN as t\r\n         join (select sum(borc) as borc,sum(alacak) as alacak,\r\n         case when  sum(borc-alacak)>0 then sum(borc-alacak) else 0 end bborc,\r\n         case when sum(borc-alacak)<0 then -1*sum(borc-alacak) else 0 end balacak\r\n         from @TABLE_MIZAN where PARENTID=@grp2id ) dt \r\n         on t.ID=@grp2id\r\n        */ \r\n         \r\n         update @TABLE_MIZAN set \r\n         BORC=isnull(dt.BORC,0),ALACAK=isnull(dt.ALACAK,0),\r\n         BAKIYE_BORC=ISNULL(dt.BBORC,0),BAKIYE_ALACAK=isnull(dt.BALACAK,0)\r\n          from @TABLE_MIZAN as t\r\n         join (select sum(borc) as borc,sum(alacak) as alacak,\r\n         case when  sum(borc-alacak)>0 then sum(borc-alacak) else 0 end bborc,\r\n         case when sum(borc-alacak)<0 then -1*sum(borc-alacak) else 0 end balacak\r\n         from @TABLE_MIZAN where PARENTID=@grp1id ) dt \r\n         on t.ID=@grp1id        \r\n    \r\n RETURN\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_MIZAN_BANKA",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_MIZAN_BANKA",
    "definition": "CREATE FUNCTION [dbo].[UDF_MIZAN_BANKA] \r\n(@FIRMA_NO       \tINT,\r\n @id\t\t\t   \tINT,\r\n @BAS_TAR          \tDATETIME,\r\n @BIT_TAR          \tDATETIME,\r\n @SIF_BAK3_GSTME \tTINYINT)\r\nRETURNS\r\n\r\n  @TABLE_MIZAN TABLE (\r\n   ID\t\t\t\t\tint,\r\n   PARENTID\t\t\t\tint,\t\r\n   GRPNO\t\t\t\tint,\r\n   KART_KOD\t\t\t\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n   ACK\t\t\t\t\tVARCHAR(100) COLLATE Turkish_CI_AS,\r\n   BORC\t\t\t\t    float,\r\n   ALACAK\t\t\t\tfloat,\r\n   BAKIYE_BORC\t\t\tfloat,\r\n   BAKIYE_ALACAK\t\tfloat)\r\n\r\nAS\r\nBEGIN\r\n\r\n\r\n  declare @grp1id \t \tint\r\n  declare @grp2id \t\tint\r\n\r\n  declare @KOD      \tvarchar(100)\r\n  declare @GRP_AD   \tvarchar(100)\r\n  declare @GRP_ID  \t\tfloat\r\n  declare @GRP_SR  \t\tint\r\n  \r\n  declare @BORC  \t\tfloat\r\n  declare @ALACAK  \t\tfloat\r\n  declare @BAKIYE  \t\tfloat\r\n\r\n  declare @ABAKIYE  \tfloat\r\n  declare @BBAKIYE  \tfloat  \r\n  \r\n  \r\n \r\n      set @grp1id=@id\r\n    \r\n       insert into @TABLE_MIZAN (ID,PARENTID,ACK,BORC,ALACAK,BAKIYE_BORC,BAKIYE_ALACAK)\r\n       VALUES (@grp1id,0,'BANKA KARTLARI',0,0,0,0)\r\n\r\n       declare mas_cur CURSOR FAST_FORWARD  FOR \r\n       select id,sr,ad from grup where tabload='bankakart' and sil=0 \r\n         open mas_cur\r\n          fetch next from  mas_cur into @GRP_ID,@GRP_SR,@GRP_AD\r\n           while @@FETCH_STATUS=0\r\n            begin \r\n      \r\n   \r\n             set @id=@id+1 \r\n      \r\n              set @grp2id=@id\r\n     \r\n              insert into @TABLE_MIZAN (ID,PARENTID,ACK,BORC,\r\n              ALACAK,BAKIYE_BORC,BAKIYE_ALACAK)\r\n               VALUES (@id,@grp1id,@GRP_AD,0,0,0,0)\r\n   \r\n               set @id=@id+1     \r\n\r\n           IF (@FIRMA_NO=0)\r\n           declare gec_cur CURSOR FAST_FORWARD  FOR \r\n            select h.bankod,sum(h.borc),\r\n            sum(h.alacak) from\r\n            bankahrk as h \r\n            inner join bankakart as k on k.kod=h.bankod\r\n            and k.grp1=@GRP_ID and k.sil=0\r\n            where h.sil=0\r\n            and h.tarih>=@BAS_TAR \r\n            and h.tarih<=@BIT_TAR \r\n            group by h.bankod \r\n            \r\n            \r\n           IF (@FIRMA_NO>0)\r\n           declare gec_cur CURSOR FAST_FORWARD  FOR \r\n            select h.bankod,sum(h.borc),\r\n            sum(h.alacak) from\r\n            bankahrk as h \r\n            inner join bankakart as k on k.kod=h.bankod\r\n            and h.firmano in (0,@FIRMA_NO)\r\n            and k.grp1=@GRP_ID and k.sil=0\r\n            where h.sil=0\r\n            and h.tarih>=@BAS_TAR \r\n            and h.tarih<=@BIT_TAR \r\n            group by h.bankod  \r\n            \r\n            \r\n             open gec_cur\r\n          fetch next from  gec_cur into @KOD,@BORC,@ALACAK\r\n           while @@FETCH_STATUS=0\r\n            begin\r\n            \r\n            set @BORC=ROUND(@BORC,2)\r\n            set @ALACAK=ROUND(@ALACAK,2)\r\n            \r\n            set @BBAKIYE=0\r\n            set @ABAKIYE=0\r\n            \r\n            SET @BAKIYE=@BORC-@ALACAK \r\n             \r\n             if @BAKIYE>0\r\n              set @BBAKIYE=@BAKIYE\r\n              \r\n             if @BAKIYE<0\r\n              set @ABAKIYE=-1*@BAKIYE\r\n                \r\n            \r\n             if (@SIF_BAK3_GSTME=0) OR (@SIF_BAK3_GSTME=1 AND (@BAKIYE <>0) )   \r\n              insert into @TABLE_MIZAN (ID,PARENTID,KART_KOD,ACK,BORC,ALACAK,BAKIYE_BORC,BAKIYE_ALACAK)\r\n              VALUES (@id,@grp2id,@KOD,@KOD,@BORC,@ALACAK,@BBAKIYE,@ABAKIYE)\r\n\r\n            set @id=@id+1  \r\n\r\n             FETCH next from  gec_cur into @KOD,@BORC,@ALACAK\r\n           end\r\n         close gec_cur\r\n         deallocate gec_cur\r\n         \r\n         \r\n          update @TABLE_MIZAN set ACK=dt.ad from @TABLE_MIZAN as t join\r\n          (select kod,ad from bankakart ) dt \r\n          on t.KART_KOD=dt.kod \r\n         \r\n         \r\n         \r\n         \r\n           \r\n           update @TABLE_MIZAN set \r\n           BORC=isnull(dt.BORC,0),ALACAK=isnull(dt.ALACAK,0),\r\n           BAKIYE_BORC=ISNULL(dt.BBORC,0),BAKIYE_ALACAK=isnull(dt.BALACAK,0)\r\n            from @TABLE_MIZAN as t\r\n           join (select sum(borc) as borc,sum(alacak) as alacak,\r\n           case when  sum(borc-alacak)>0 then sum(borc-alacak) else 0 end bborc,\r\n           case when sum(borc-alacak)<0 then -1*sum(borc-alacak) else 0 end balacak\r\n           from @TABLE_MIZAN where PARENTID=@grp2id ) dt \r\n           on t.ID=@grp2id\r\n       \r\n       \r\n          FETCH next from  mas_cur into @GRP_ID,@GRP_SR,@GRP_AD\r\n         end\r\n        Close mas_cur\r\n        deallocate mas_cur      \r\n         \r\n         \r\n         update @TABLE_MIZAN set \r\n         BORC=isnull(dt.BORC,0),ALACAK=isnull(dt.ALACAK,0),\r\n         BAKIYE_BORC=ISNULL(dt.BBORC,0),BAKIYE_ALACAK=isnull(dt.BALACAK,0)\r\n          from @TABLE_MIZAN as t\r\n         join (select sum(borc) as borc,sum(alacak) as alacak,\r\n         case when  sum(borc-alacak)>0 then sum(borc-alacak) else 0 end bborc,\r\n         case when sum(borc-alacak)<0 then -1*sum(borc-alacak) else 0 end balacak\r\n         from @TABLE_MIZAN where PARENTID=@grp1id ) dt \r\n         on t.ID=@grp1id        \r\n    \r\n\r\n\r\nRETURN\r\n\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_MIZAN_CARIKART",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_MIZAN_CARIKART",
    "definition": "CREATE FUNCTION [dbo].[UDF_MIZAN_CARIKART] \r\n(@FIRMA_NO       \tINT,\r\n @id\t\t\t   \tINT,\r\n @BAS_TAR          \tDATETIME,\r\n @BIT_TAR          \tDATETIME,\r\n @SIF_BAK3_GSTME \tTINYINT)\r\nRETURNS\r\n\r\n  @TABLE_MIZAN TABLE (\r\n   ID\t\t\t\t\tint,\r\n   PARENTID\t\t\t\tint,\t\r\n   GRPNO\t\t\t\tint,\r\n   KART_KOD\t\t\t\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n   ACK\t\t\t\t\tVARCHAR(100) COLLATE Turkish_CI_AS,\r\n   BORC\t\t\t\t    float,\r\n   ALACAK\t\t\t\tfloat,\r\n   BAKIYE_BORC\t\t\tfloat,\r\n   BAKIYE_ALACAK\t\tfloat)\r\n\r\nAS\r\nBEGIN\r\n\r\n\r\n  declare @grp1id \t \tint\r\n  declare @grp2id \t\tint\r\n\r\n  declare @KOD      \tvarchar(100)\r\n  declare @GRP_AD   \tvarchar(100)\r\n  declare @GRP_ID  \t\tfloat\r\n  declare @GRP_SR  \t\tint\r\n  \r\n  declare @BORC  \t\tfloat\r\n  declare @ALACAK  \t\tfloat\r\n  declare @BAKIYE  \t\tfloat\r\n\r\n  declare @ABAKIYE  \tfloat\r\n  declare @BBAKIYE  \tfloat  \r\n  \r\n  \r\n \r\n      set @grp1id=@id\r\n    \r\n       insert into @TABLE_MIZAN (ID,PARENTID,ACK,BORC,ALACAK,BAKIYE_BORC,BAKIYE_ALACAK)\r\n       VALUES (@grp1id,0,'MÜŞTERİ SATICI KARTLARI',0,0,0,0)\r\n\r\n       declare mas_cur CURSOR FAST_FORWARD  FOR \r\n       select id,sr,ad from grup where tabload='carikart' and sil=0 \r\n         open mas_cur\r\n          fetch next from  mas_cur into @GRP_ID,@GRP_SR,@GRP_AD\r\n           while @@FETCH_STATUS=0\r\n            begin \r\n      \r\n   \r\n             set @id=@id+1 \r\n      \r\n              set @grp2id=@id\r\n     \r\n              insert into @TABLE_MIZAN (ID,PARENTID,ACK,BORC,\r\n              ALACAK,BAKIYE_BORC,BAKIYE_ALACAK)\r\n               VALUES (@id,@grp1id,@GRP_AD,0,0,0,0)\r\n   \r\n               set @id=@id+1     \r\n\r\n          IF (@FIRMA_NO=0)\r\n           declare gec_cur CURSOR FAST_FORWARD  FOR \r\n            select h.carkod,sum(h.borc),\r\n            sum(h.alacak) from\r\n            carihrk as h \r\n            inner join carikart as k on k.kod=h.carkod\r\n            and h.cartip='carikart'\r\n            and k.grp1=@GRP_ID and k.sil=0\r\n            where h.sil=0\r\n            and h.tarih>=@BAS_TAR \r\n            and h.tarih<=@BIT_TAR \r\n            group by h.carkod \r\n            \r\n          IF (@FIRMA_NO>0)\r\n           declare gec_cur CURSOR FAST_FORWARD  FOR \r\n            select h.carkod,sum(h.borc),\r\n            sum(h.alacak) from\r\n            carihrk as h \r\n            inner join carikart as k on k.kod=h.carkod\r\n            and h.firmano in (0,@FIRMA_NO)\r\n            and h.cartip='carikart'\r\n            and k.grp1=@GRP_ID and k.sil=0\r\n            where h.sil=0\r\n            and h.tarih>=@BAS_TAR \r\n            and h.tarih<=@BIT_TAR \r\n            group by h.carkod  \r\n            \r\n            \r\n            \r\n             open gec_cur\r\n          fetch next from  gec_cur into @KOD,@BORC,@ALACAK\r\n           while @@FETCH_STATUS=0\r\n            begin\r\n            \r\n            set @BORC=ROUND(@BORC,2)\r\n            set @ALACAK=ROUND(@ALACAK,2)\r\n            \r\n            set @BBAKIYE=0\r\n            set @ABAKIYE=0\r\n            \r\n            SET @BAKIYE=@BORC-@ALACAK \r\n             \r\n             if @BAKIYE>0\r\n              set @BBAKIYE=@BAKIYE\r\n              \r\n             if @BAKIYE<0\r\n              set @ABAKIYE=-1*@BAKIYE\r\n                \r\n            \r\n              if (@SIF_BAK3_GSTME=0) OR (@SIF_BAK3_GSTME=1 AND (@BAKIYE <>0) )\r\n              insert into @TABLE_MIZAN (ID,PARENTID,KART_KOD,ACK,BORC,ALACAK,BAKIYE_BORC,BAKIYE_ALACAK)\r\n              VALUES (@id,@grp2id,@KOD,@KOD,@BORC,@ALACAK,@BBAKIYE,@ABAKIYE)\r\n\r\n            set @id=@id+1  \r\n\r\n             FETCH next from  gec_cur into @KOD,@BORC,@ALACAK\r\n           end\r\n         close gec_cur\r\n         deallocate gec_cur\r\n         \r\n           \r\n           update @TABLE_MIZAN set \r\n           BORC=isnull(dt.BORC,0),ALACAK=isnull(dt.ALACAK,0),\r\n           BAKIYE_BORC=ISNULL(dt.BBORC,0),BAKIYE_ALACAK=isnull(dt.BALACAK,0)\r\n            from @TABLE_MIZAN as t\r\n           join (select sum(borc) as borc,sum(alacak) as alacak,\r\n           case when  sum(borc-alacak)>0 then sum(borc-alacak) else 0 end bborc,\r\n           case when sum(borc-alacak)<0 then -1*sum(borc-alacak) else 0 end balacak\r\n           from @TABLE_MIZAN where PARENTID=@grp2id ) dt \r\n           on t.ID=@grp2id\r\n       \r\n       \r\n          FETCH next from  mas_cur into @GRP_ID,@GRP_SR,@GRP_AD\r\n         end\r\n        Close mas_cur\r\n        deallocate mas_cur      \r\n         \r\n        \r\n         update @TABLE_MIZAN set ACK=dt.ad from @TABLE_MIZAN as t join\r\n         (select kod,\r\n         case when len(unvan)>80 then \r\n         SUBSTRING(unvan,1,80) else unvan end \r\n         as ad from carikart ) dt \r\n         on t.KART_KOD=dt.kod \r\n        \r\n        \r\n        \r\n         \r\n         update @TABLE_MIZAN set \r\n         BORC=isnull(dt.BORC,0),ALACAK=isnull(dt.ALACAK,0),\r\n         BAKIYE_BORC=ISNULL(dt.BBORC,0),BAKIYE_ALACAK=isnull(dt.BALACAK,0)\r\n          from @TABLE_MIZAN as t\r\n         join (select sum(borc) as borc,sum(alacak) as alacak,\r\n         case when  sum(borc-alacak)>0 then sum(borc-alacak) else 0 end bborc,\r\n         case when sum(borc-alacak)<0 then -1*sum(borc-alacak) else 0 end balacak\r\n         from @TABLE_MIZAN where PARENTID=@grp1id ) dt \r\n         on t.ID=@grp1id        \r\n    \r\n\r\n\r\nRETURN\r\n\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_MIZAN_CEK_SENET",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_MIZAN_CEK_SENET",
    "definition": "CREATE  FUNCTION [dbo].[UDF_MIZAN_CEK_SENET] \r\n(@FIRMA_NO       \tINT,\r\n @id\t\t\t   \tINT,\r\n @BAS_TAR          \tDATETIME,\r\n @BIT_TAR          \tDATETIME,\r\n @AY_CARGRP      \tTINYINT,\r\n @SIF_BAK3_GSTME \tTINYINT)\r\nRETURNS\r\n\r\n  @TABLE_MIZAN TABLE (\r\n   ID\t\t\t\t\tint,\r\n   PARENTID\t\t\t\tint,\t\r\n   GRPNO\t\t\t\tint,\r\n   KART_KOD\t\t\t\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n   ACK\t\t\t\t\tVARCHAR(150) COLLATE Turkish_CI_AS,\r\n   BELGENO\t\t\t\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n   BORC\t\t\t\t    float,\r\n   ALACAK\t\t\t\tfloat,\r\n   BAKIYE_BORC\t\t\tfloat,\r\n   BAKIYE_ALACAK\t\tfloat)\r\n\r\nAS\r\nBEGIN\r\n\r\n\r\n  declare @grp1id \t \tint\r\n  declare @grp2id \t\tint\r\n\r\n  declare @KOD_TIP    \tvarchar(100)\r\n  declare @KOD      \tvarchar(100)\r\n  declare @GRP_KOD   \tvarchar(50)\r\n  declare @BelgeNo   \tvarchar(50)\r\n  declare @GRP_AD   \tvarchar(100)\r\n  declare @GRP_ID  \t\tfloat\r\n  declare @GRP_SR  \t\tint\r\n  \r\n  declare @BORC  \t\tfloat\r\n  declare @ALACAK  \t\tfloat\r\n  declare @BAKIYE  \t\tfloat\r\n\r\n  declare @ABAKIYE  \tfloat\r\n  declare @BBAKIYE  \tfloat  \r\n  \r\n  \r\n \r\n      set @grp1id=@id\r\n    \r\n       insert into @TABLE_MIZAN (ID,PARENTID,ACK,BORC,ALACAK,BAKIYE_BORC,BAKIYE_ALACAK)\r\n       VALUES (@grp1id,0,'ÇEKLER',0,0,0,0)\r\n\r\n       declare mas_cur CURSOR FAST_FORWARD  FOR \r\n        select id,kod,ad from cektip where kod in ('POR','TAK','KSN')\r\n         open mas_cur\r\n          fetch next from  mas_cur into @GRP_ID,@GRP_KOD,@GRP_AD\r\n           while @@FETCH_STATUS=0\r\n            begin \r\n      \r\n             set @id=@id+1 \r\n      \r\n              set @grp2id=@id\r\n     \r\n              insert into @TABLE_MIZAN (ID,PARENTID,ACK,BORC,\r\n              ALACAK,BAKIYE_BORC,BAKIYE_ALACAK)\r\n               VALUES (@id,@grp1id,@GRP_AD,0,0,0,0)\r\n   \r\n               set @id=@id+1     \r\n\r\n     \r\n\r\n\r\n\r\n           if @AY_CARGRP=1 \r\n            begin\r\n   \r\n            /*if (@GRP_KOD='POR') OR (@GRP_KOD='TAK') */\r\n            IF (@FIRMA_NO=0)\r\n            declare gec_cur CURSOR FAST_FORWARD  FOR \r\n            SELECT Car_Tip,car_kod,BelgeNo,sum(borc),sum(alacak) from \r\n            Cek_Son_Drm (0,@GRP_KOD,@BAS_TAR,@BIT_TAR) as h\r\n            group by h.Car_Tip,h.car_kod,BelgeNo\r\n            \r\n            \r\n            IF (@FIRMA_NO>0)\r\n            declare gec_cur CURSOR FAST_FORWARD  FOR \r\n            SELECT Car_Tip,car_kod,BelgeNo,sum(borc),sum(alacak) from \r\n            Cek_Son_Drm (@FIRMA_NO,@GRP_KOD,@BAS_TAR,@BIT_TAR) as h\r\n            group by h.Car_Tip,h.car_kod,BelgeNo\r\n             \r\n              \r\n           end\r\n  \r\n           if @AY_CARGRP=0\r\n            begin\r\n\r\n            IF (@FIRMA_NO=0)\r\n            declare gec_cur CURSOR FAST_FORWARD  FOR \r\n            SELECT Car_Tip,car_kod,BelgeNo,borc,alacak from \r\n            Cek_Son_Drm (0,@GRP_KOD,@BAS_TAR,@BIT_TAR) as h\r\n             order by h.Car_Tip,car_kod\r\n             \r\n            IF (@FIRMA_NO>0)\r\n            declare gec_cur CURSOR FAST_FORWARD  FOR \r\n            SELECT Car_Tip,car_kod,BelgeNo,borc,alacak from \r\n            Cek_Son_Drm (@FIRMA_NO,@GRP_KOD,@BAS_TAR,@BIT_TAR) as h\r\n             order by h.Car_Tip,car_kod \r\n             \r\n             \r\n           end\r\n           \r\n                      \r\n             \r\n             open gec_cur\r\n          fetch next from  gec_cur into @KOD_TIP,@KOD,@BelgeNo,\r\n          @BORC,@ALACAK\r\n           while @@FETCH_STATUS=0\r\n            begin\r\n            \r\n            \r\n            set @BORC=ROUND(@BORC,2)\r\n            set @ALACAK=ROUND(@ALACAK,2)\r\n            \r\n            set @BBAKIYE=0\r\n            set @ABAKIYE=0\r\n            \r\n            SET @BAKIYE=@BORC-@ALACAK \r\n             \r\n             if @BAKIYE>0\r\n              set @BBAKIYE=@BAKIYE\r\n              \r\n             if @BAKIYE<0\r\n              set @ABAKIYE=-1*@BAKIYE\r\n                \r\n            \r\n             if (@SIF_BAK3_GSTME=0) OR (@SIF_BAK3_GSTME=1 AND (@BAKIYE <>0) ) \r\n              insert into @TABLE_MIZAN (ID,PARENTID,KART_KOD,ACK,\r\n              BELGENO,BORC,ALACAK,BAKIYE_BORC,BAKIYE_ALACAK)\r\n              VALUES (@id,@grp2id,@KOD_TIP,@KOD,@BelgeNo,\r\n              @BORC,@ALACAK,@BBAKIYE,@ABAKIYE)\r\n\r\n            set @id=@id+1  \r\n\r\n             FETCH next from  gec_cur into @KOD_TIP,@KOD,@BelgeNo,\r\n             @BORC,@ALACAK\r\n           end\r\n         close gec_cur\r\n         deallocate gec_cur\r\n         \r\n           update @TABLE_MIZAN set \r\n           BORC=isnull(dt.BORC,0),ALACAK=isnull(dt.ALACAK,0),\r\n           BAKIYE_BORC=ISNULL(dt.BBORC,0),BAKIYE_ALACAK=isnull(dt.BALACAK,0)\r\n            from @TABLE_MIZAN as t\r\n           join (select sum(borc) as borc,sum(alacak) as alacak,\r\n           case when  sum(borc-alacak)>0 then sum(borc-alacak) else 0 end bborc,\r\n           case when sum(borc-alacak)<0 then -1*sum(borc-alacak) else 0 end balacak\r\n           from @TABLE_MIZAN where PARENTID=@grp2id ) dt \r\n           on t.ID=@grp2id\r\n       \r\n       \r\n          FETCH next from  mas_cur into @GRP_ID,@GRP_KOD,@GRP_AD\r\n         end\r\n        Close mas_cur\r\n        deallocate mas_cur   \r\n   \r\n   \r\n        update @TABLE_MIZAN set ACK=dt.ad+' / '+t.BELGENO from @TABLE_MIZAN as t join\r\n        (select cartp,kod,ad from Genel_Kart ) dt \r\n        on t.KART_KOD=dt.cartp and t.ACK=dt.kod\r\n        \r\n         update @TABLE_MIZAN set \r\n         BORC=isnull(dt.BORC,0),ALACAK=isnull(dt.ALACAK,0),\r\n         BAKIYE_BORC=ISNULL(dt.BBORC,0),BAKIYE_ALACAK=isnull(dt.BALACAK,0)\r\n          from @TABLE_MIZAN as t\r\n         join (select sum(borc) as borc,sum(alacak) as alacak,\r\n         case when  sum(borc-alacak)>0 then sum(borc-alacak) else 0 end bborc,\r\n         case when sum(borc-alacak)<0 then -1*sum(borc-alacak) else 0 end balacak\r\n         from @TABLE_MIZAN where PARENTID=@grp1id ) dt \r\n         on t.ID=@grp1id        \r\n    \r\n\r\n\r\nRETURN\r\n\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_MIZAN_GELIR_GIDER",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_MIZAN_GELIR_GIDER",
    "definition": "CREATE FUNCTION [dbo].[UDF_MIZAN_GELIR_GIDER] \r\n(@FIRMA_NO       \tINT,\r\n @GEL_GID_TIP\t\tINT,\r\n @id\t\t\t   \tINT,\r\n @GEL_GID_ID        INT,\r\n @BAS_TAR          \tDATETIME,\r\n @BIT_TAR          \tDATETIME,\r\n @ALT_GRP_HES       TINYINT,\r\n @HRK_TIP       \tTINYINT,\r\n @SIF_BAK3_GSTME \tTINYINT)\r\nRETURNS\r\n\r\n  @TABLE_MIZAN TABLE (\r\n   ID\t\t\t\t\tint,\r\n   PARENTID\t\t\t\tint,\t\r\n   GRPNO\t\t\t\tint,\r\n   KART_KOD\t\t\t\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n   ACK\t\t\t\t\tVARCHAR(100) COLLATE Turkish_CI_AS,\r\n   BORC\t\t\t\t    float,\r\n   ALACAK\t\t\t\tfloat,\r\n   BAKIYE_BORC\t\t\tfloat,\r\n   BAKIYE_ALACAK\t\tfloat)\r\n\r\nAS\r\nBEGIN\r\n\r\n\r\n  declare @grp1id \t \tint\r\n  declare @grp2id \t\tint\r\n\r\n  declare @KOD      \tvarchar(100)\r\n  declare @GRP_AD   \tvarchar(100)\r\n  declare @GRP_ID  \t\tfloat\r\n  declare @GRP_SR  \t\tint\r\n  \r\n  declare @BORC  \t\tfloat\r\n  declare @ALACAK  \t\tfloat\r\n  declare @BAKIYE  \t\tfloat\r\n\r\n  declare @ABAKIYE  \tfloat\r\n  declare @BBAKIYE  \tfloat  \r\n  \r\n  DECLARE @KONT\t\t\tint\r\n  \r\n \r\n      set @grp1id=@id\r\n    \r\n       IF @GEL_GID_TIP=1\r\n       insert into @TABLE_MIZAN (ID,PARENTID,ACK,BORC,ALACAK,BAKIYE_BORC,BAKIYE_ALACAK)\r\n       VALUES (@grp1id,0,'GELIR KARTLARI',0,0,0,0)\r\n\r\n       IF @GEL_GID_TIP=2\r\n       insert into @TABLE_MIZAN (ID,PARENTID,ACK,BORC,ALACAK,BAKIYE_BORC,BAKIYE_ALACAK)\r\n       VALUES (@grp1id,0,'GİDER KARTLARI',0,0,0,0)\r\n\r\n\r\n      if @ALT_GRP_HES=0\r\n       declare mas_cur CURSOR FAST_FORWARD  FOR \r\n        select id,grp1,ad from grup where id=@GEL_GID_ID and sil=0 \r\n        \r\n      if @ALT_GRP_HES=1\r\n       declare mas_cur CURSOR FAST_FORWARD  FOR \r\n        select case when grp1=0 then id else grp1 end,\r\n        case when grp1>0 then id else grp1 end,ad from grup where sil=0 and ((id=@GEL_GID_ID) or (grp1=@GEL_GID_ID)) \r\n        \r\n        open mas_cur\r\n          fetch next from  mas_cur into @GRP_ID,@GRP_SR,@GRP_AD\r\n           while @@FETCH_STATUS=0\r\n            begin \r\n      \r\n   \r\n             set @id=@id+1 \r\n      \r\n              set @grp2id=@id\r\n     \r\n              insert into @TABLE_MIZAN (ID,PARENTID,ACK,BORC,\r\n              ALACAK,BAKIYE_BORC,BAKIYE_ALACAK)\r\n               VALUES (@id,@grp1id,@GRP_AD,0,0,0,0)\r\n   \r\n               set @id=@id+1     \r\n\r\n          IF (@FIRMA_NO=0)\r\n           declare gec_cur CURSOR FAST_FORWARD  FOR \r\n            select h.carkod,sum(h.borc),\r\n            sum(h.alacak) from\r\n            carihrk as h \r\n            inner join gelgidkart as k on k.kod=h.carkod\r\n            and h.cartip='gelgidkart'\r\n            and k.grp1=@GRP_ID and k.grp2=@GRP_SR and k.sil=0\r\n            where h.sil=0 \r\n            and h.tarih>=@BAS_TAR \r\n            and h.tarih<=@BIT_TAR \r\n            group by h.carkod \r\n            \r\n            \r\n           IF (@FIRMA_NO>0)\r\n           declare gec_cur CURSOR FAST_FORWARD  FOR \r\n            select h.carkod,sum(h.borc),\r\n            sum(h.alacak) from\r\n            carihrk as h \r\n            inner join gelgidkart as k on k.kod=h.carkod\r\n            and h.cartip='gelgidkart'\r\n            and k.grp1=@GRP_ID and k.grp2=@GRP_SR and k.sil=0\r\n            where h.sil=0 \r\n            and h.firmano in (0,@FIRMA_NO)\r\n            and h.tarih>=@BAS_TAR \r\n            and h.tarih<=@BIT_TAR \r\n            group by h.carkod    \r\n            \r\n            \r\n             open gec_cur\r\n          fetch next from  gec_cur into @KOD,@BORC,@ALACAK\r\n           while @@FETCH_STATUS=0\r\n            begin\r\n            \r\n            set @BORC=ROUND(@BORC,2)\r\n            set @ALACAK=ROUND(@ALACAK,2)\r\n            \r\n            set @BBAKIYE=0\r\n            set @ABAKIYE=0\r\n            \r\n            SET @BAKIYE=@BORC-@ALACAK \r\n             \r\n             if @BAKIYE>0\r\n              set @BBAKIYE=@BAKIYE\r\n              \r\n             if @BAKIYE<0\r\n              set @ABAKIYE=-1*@BAKIYE\r\n              \r\n              \r\n             SET @KONT=0\r\n              \r\n             if @GEL_GID_TIP=1\r\n              begin              \r\n               if  (@HRK_TIP=0) OR ((@HRK_TIP=1) AND (@BORC>0))\r\n               SET @KONT=1\r\n              end \r\n                 \r\n              if @GEL_GID_TIP=2\r\n              begin              \r\n               if  (@HRK_TIP=0) OR ((@HRK_TIP=1) AND (@ALACAK>0))\r\n               SET @KONT=1\r\n              end           \r\n             \r\n             \r\n              if @KONT=1\r\n               begin\r\n                if (@SIF_BAK3_GSTME=0) OR (@SIF_BAK3_GSTME=1 AND (@BAKIYE <> 0) )\r\n                insert into @TABLE_MIZAN (ID,PARENTID,KART_KOD,ACK,BORC,ALACAK,BAKIYE_BORC,BAKIYE_ALACAK)\r\n                VALUES (@id,@grp2id,@KOD,@KOD,@BORC,@ALACAK,@BBAKIYE,@ABAKIYE)\r\n               end \r\n             \r\n\r\n            set @id=@id+1  \r\n\r\n             FETCH next from  gec_cur into @KOD,@BORC,@ALACAK\r\n           end\r\n         close gec_cur\r\n         deallocate gec_cur\r\n         \r\n           \r\n           update @TABLE_MIZAN set \r\n           BORC=isnull(dt.BORC,0),ALACAK=isnull(dt.ALACAK,0),\r\n           BAKIYE_BORC=ISNULL(dt.BBORC,0),BAKIYE_ALACAK=isnull(dt.BALACAK,0)\r\n            from @TABLE_MIZAN as t\r\n           join (select sum(borc) as borc,sum(alacak) as alacak,\r\n           case when  sum(borc-alacak)>0 then sum(borc-alacak) else 0 end bborc,\r\n           case when sum(borc-alacak)<0 then -1*sum(borc-alacak) else 0 end balacak\r\n           from @TABLE_MIZAN where PARENTID=@grp2id ) dt \r\n           on t.ID=@grp2id\r\n       \r\n       \r\n          FETCH next from  mas_cur into @GRP_ID,@GRP_SR,@GRP_AD\r\n         end\r\n        Close mas_cur\r\n        deallocate mas_cur \r\n        \r\n        \r\n        \r\n         update @TABLE_MIZAN set ACK=dt.ad from @TABLE_MIZAN as t join\r\n         (select kod,ad as ad from gelgidkart ) dt \r\n         on t.KART_KOD=dt.kod \r\n             \r\n         \r\n         \r\n         update @TABLE_MIZAN set \r\n         BORC=isnull(dt.BORC,0),ALACAK=isnull(dt.ALACAK,0),\r\n         BAKIYE_BORC=ISNULL(dt.BBORC,0),BAKIYE_ALACAK=isnull(dt.BALACAK,0)\r\n          from @TABLE_MIZAN as t\r\n         join (select sum(borc) as borc,sum(alacak) as alacak,\r\n         case when  sum(borc-alacak)>0 then sum(borc-alacak) else 0 end bborc,\r\n         case when sum(borc-alacak)<0 then -1*sum(borc-alacak) else 0 end balacak\r\n         from @TABLE_MIZAN where PARENTID=@grp1id ) dt \r\n         on t.ID=@grp1id        \r\n    \r\n\r\n\r\nRETURN\r\n\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_MIZAN_IRSALIYE",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_MIZAN_IRSALIYE",
    "definition": "CREATE FUNCTION [dbo].[UDF_MIZAN_IRSALIYE] \r\n(@FIRMA_NO       \tINT,\r\n @id\t\t\t   \tINT,\r\n @BAS_TAR          \tDATETIME,\r\n @BIT_TAR          \tDATETIME,\r\n @SIF_BAK3_GSTME \tTINYINT)\r\nRETURNS\r\n\r\n  @TABLE_MIZAN TABLE (\r\n   ID\t\t\t\t\tint,\r\n   PARENTID\t\t\t\tint,\t\r\n   GRPNO\t\t\t\tint,\r\n   KART_KOD\t\t\t\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n   ACK\t\t\t\t\tVARCHAR(100) COLLATE Turkish_CI_AS,\r\n   BORC\t\t\t\t    float,\r\n   ALACAK\t\t\t\tfloat,\r\n   BAKIYE_BORC\t\t\tfloat,\r\n   BAKIYE_ALACAK\t\tfloat)\r\n\r\nAS\r\nBEGIN\r\n\r\n\r\n  declare @grp1id \t \tint\r\n  declare @grp2id \t\tint\r\n\r\n  declare @KOD_TIP    \tvarchar(100)\r\n  declare @KOD      \tvarchar(100)\r\n  declare @GRP_KOD   \tvarchar(50)  \r\n  declare @GRP_AD   \tvarchar(100)\r\n  declare @GRP_ID  \t\tfloat\r\n  declare @GRP_SR  \t\tint\r\n  \r\n  declare @BORC  \t\tfloat\r\n  declare @ALACAK  \t\tfloat\r\n  declare @BAKIYE  \t\tfloat\r\n\r\n  declare @ABAKIYE  \tfloat\r\n  declare @BBAKIYE  \tfloat  \r\n  \r\n  \r\n \r\n      set @grp1id=@id\r\n    \r\n       insert into @TABLE_MIZAN (ID,PARENTID,ACK,BORC,ALACAK,BAKIYE_BORC,BAKIYE_ALACAK)\r\n       VALUES (@grp1id,0,'IRSALIYELER',0,0,0,0)\r\n\r\n       declare mas_cur CURSOR FAST_FORWARD  FOR \r\n       select id,kod,ad from fattip where tip='IRS' \r\n         open mas_cur\r\n          fetch next from  mas_cur into @GRP_ID,@GRP_KOD,@GRP_AD\r\n           while @@FETCH_STATUS=0\r\n            begin \r\n      \r\n   \r\n             set @id=@id+1 \r\n      \r\n              set @grp2id=@id\r\n     \r\n              insert into @TABLE_MIZAN (ID,PARENTID,ACK,BORC,\r\n              ALACAK,BAKIYE_BORC,BAKIYE_ALACAK)\r\n               VALUES (@id,@grp1id,@GRP_AD,0,0,0,0)\r\n   \r\n               set @id=@id+1     \r\n\r\n          \r\n           IF (@FIRMA_NO=0)\r\n           declare gec_cur CURSOR FAST_FORWARD  FOR \r\n            select h.cartip,h.carkod,\r\n            sum(case when h.gctip=2 then \r\n            h.genel_top else 0 end),\r\n            sum(case when h.gctip=1 then \r\n            h.genel_top else 0 end)\r\n            from irsaliyemas as h\r\n            where h.irtip=@GRP_KOD and h.sil=0\r\n            and h.aktip in ('BK','BL')\r\n            and h.tarih>=@BAS_TAR \r\n            and h.tarih<=@BIT_TAR \r\n            group by h.cartip,h.carkod \r\n            \r\n            \r\n          IF (@FIRMA_NO>0)\r\n           declare gec_cur CURSOR FAST_FORWARD  FOR \r\n            select h.cartip,h.carkod,\r\n            sum(case when h.gctip=2 then \r\n            h.genel_top else 0 end),\r\n            sum(case when h.gctip=1 then \r\n            h.genel_top else 0 end)\r\n            from irsaliyemas as h\r\n            where h.irtip=@GRP_KOD \r\n            and h.firmano in (0,@FIRMA_NO)\r\n            and h.sil=0\r\n            and h.aktip in ('BK','BL')\r\n            and h.tarih>=@BAS_TAR \r\n            and h.tarih<=@BIT_TAR \r\n            group by h.cartip,h.carkod  \r\n            \r\n            \r\n            \r\n             open gec_cur\r\n          fetch next from  gec_cur into @KOD_TIP,@KOD,@BORC,@ALACAK\r\n           while @@FETCH_STATUS=0\r\n            begin\r\n            \r\n            set @BORC=ROUND(@BORC,2)\r\n            set @ALACAK=ROUND(@ALACAK,2)\r\n            \r\n            set @BBAKIYE=0\r\n            set @ABAKIYE=0\r\n            \r\n            SET @BAKIYE=@BORC-@ALACAK \r\n             \r\n             if @BAKIYE>0\r\n              set @BBAKIYE=@BAKIYE\r\n              \r\n             if @BAKIYE<0\r\n              set @ABAKIYE=-1*@BAKIYE\r\n                \r\n            \r\n             if (@SIF_BAK3_GSTME=0) OR (@SIF_BAK3_GSTME=1 AND (@BAKIYE <>0) ) \r\n              insert into @TABLE_MIZAN (ID,PARENTID,KART_KOD,ACK,BORC,ALACAK,BAKIYE_BORC,BAKIYE_ALACAK)\r\n              VALUES (@id,@grp2id,@KOD_TIP,@KOD,@BORC,@ALACAK,@BBAKIYE,@ABAKIYE)\r\n\r\n            set @id=@id+1  \r\n\r\n             FETCH next from  gec_cur into @KOD_TIP,@KOD,@BORC,@ALACAK\r\n           end\r\n         close gec_cur\r\n         deallocate gec_cur\r\n         \r\n           \r\n           update @TABLE_MIZAN set \r\n           BORC=isnull(dt.BORC,0),ALACAK=isnull(dt.ALACAK,0),\r\n           BAKIYE_BORC=ISNULL(dt.BBORC,0),BAKIYE_ALACAK=isnull(dt.BALACAK,0)\r\n            from @TABLE_MIZAN as t\r\n           join (select sum(borc) as borc,sum(alacak) as alacak,\r\n           case when  sum(borc-alacak)>0 then sum(borc-alacak) else 0 end bborc,\r\n           case when sum(borc-alacak)<0 then -1*sum(borc-alacak) else 0 end balacak\r\n           from @TABLE_MIZAN where PARENTID=@grp2id ) dt \r\n           on t.ID=@grp2id\r\n       \r\n       \r\n          FETCH next from  mas_cur into @GRP_ID,@GRP_KOD,@GRP_AD\r\n         end\r\n        Close mas_cur\r\n        deallocate mas_cur      \r\n         \r\n        \r\n        update @TABLE_MIZAN set ACK=dt.ad from @TABLE_MIZAN as t join\r\n        (select cartp,kod,ad from Genel_Kart ) dt \r\n        on t.KART_KOD=dt.cartp and t.ACK=dt.kod\r\n        \r\n        \r\n        \r\n         \r\n         update @TABLE_MIZAN set \r\n         BORC=isnull(dt.BORC,0),ALACAK=isnull(dt.ALACAK,0),\r\n         BAKIYE_BORC=ISNULL(dt.BBORC,0),BAKIYE_ALACAK=isnull(dt.BALACAK,0)\r\n          from @TABLE_MIZAN as t\r\n         join (select sum(borc) as borc,sum(alacak) as alacak,\r\n         case when  sum(borc-alacak)>0 then sum(borc-alacak) else 0 end bborc,\r\n         case when sum(borc-alacak)<0 then -1*sum(borc-alacak) else 0 end balacak\r\n         from @TABLE_MIZAN where PARENTID=@grp1id ) dt \r\n         on t.ID=@grp1id        \r\n    \r\n\r\n\r\nRETURN\r\n\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_MIZAN_ISTKREDIKART",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_MIZAN_ISTKREDIKART",
    "definition": "CREATE FUNCTION [dbo].[UDF_MIZAN_ISTKREDIKART] \r\n(@FIRMA_NO       \tINT,\r\n @id\t\t\t   \tINT,\r\n @BAS_TAR          \tDATETIME,\r\n @BIT_TAR          \tDATETIME,\r\n @SIF_BAK3_GSTME \tTINYINT)\r\nRETURNS\r\n\r\n  @TABLE_MIZAN TABLE (\r\n   ID\t\t\t\t\tint,\r\n   PARENTID\t\t\t\tint,\t\r\n   GRPNO\t\t\t\tint,\r\n   KART_KOD\t\t\t\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n   ACK\t\t\t\t\tVARCHAR(100) COLLATE Turkish_CI_AS,\r\n   BORC\t\t\t\t    float,\r\n   ALACAK\t\t\t\tfloat,\r\n   BAKIYE_BORC\t\t\tfloat,\r\n   BAKIYE_ALACAK\t\tfloat)\r\n\r\nAS\r\nBEGIN\r\n\r\n\r\n  declare @grp1id \t \tint\r\n  declare @grp2id \t\tint\r\n\r\n  declare @KOD      \tvarchar(100)\r\n  declare @GRP_AD   \tvarchar(100)\r\n  declare @GRP_ID  \t\tfloat\r\n  declare @GRP_SR  \t\tint\r\n  \r\n  declare @BORC  \t\tfloat\r\n  declare @ALACAK  \t\tfloat\r\n  declare @BAKIYE  \t\tfloat\r\n\r\n  declare @ABAKIYE  \tfloat\r\n  declare @BBAKIYE  \tfloat  \r\n  \r\n  \r\n \r\n      set @grp1id=@id\r\n    \r\n       insert into @TABLE_MIZAN (ID,PARENTID,ACK,BORC,ALACAK,BAKIYE_BORC,BAKIYE_ALACAK)\r\n       VALUES (@grp1id,0,'İŞLETME KREDİ KARTLARI',0,0,0,0)\r\n\r\n         set @id=@id+1 \r\n      \r\n          set @grp2id=@id\r\n     \r\n              insert into @TABLE_MIZAN (ID,PARENTID,ACK,BORC,\r\n              ALACAK,BAKIYE_BORC,BAKIYE_ALACAK)\r\n               VALUES (@id,@grp1id,'GRUP TANIMI YOK',0,0,0,0)\r\n   \r\n            set @id=@id+1     \r\n\r\n\r\n          IF (@FIRMA_NO=0)\r\n           declare gec_cur CURSOR FAST_FORWARD  FOR \r\n            select h.istkkod,sum(h.borc),\r\n            sum(h.alacak) from\r\n            istkhrk as h \r\n            where h.sil=0\r\n            and h.tarih>=@BAS_TAR \r\n            and h.tarih<=@BIT_TAR \r\n            group by h.istkkod \r\n            \r\n          IF (@FIRMA_NO>0)\r\n           declare gec_cur CURSOR FAST_FORWARD  FOR \r\n            select h.istkkod,sum(h.borc),\r\n            sum(h.alacak) from\r\n            istkhrk as h \r\n            where h.sil=0\r\n            and h.firmano in (0,@FIRMA_NO)\r\n            and h.tarih>=@BAS_TAR \r\n            and h.tarih<=@BIT_TAR \r\n            group by h.istkkod   \r\n            \r\n            \r\n            \r\n            \r\n             open gec_cur\r\n          fetch next from  gec_cur into @KOD,@BORC,@ALACAK\r\n           while @@FETCH_STATUS=0\r\n            begin\r\n            \r\n            set @BORC=ROUND(@BORC,2)\r\n            set @ALACAK=ROUND(@ALACAK,2)\r\n            \r\n            set @BBAKIYE=0\r\n            set @ABAKIYE=0\r\n            \r\n            SET @BAKIYE=@BORC-@ALACAK \r\n             \r\n             if @BAKIYE>0\r\n              set @BBAKIYE=@BAKIYE\r\n              \r\n             if @BAKIYE<0\r\n              set @ABAKIYE=-1*@BAKIYE\r\n                \r\n            \r\n              if (@SIF_BAK3_GSTME=0) OR (@SIF_BAK3_GSTME=1 AND (@BAKIYE <>0) ) \r\n              insert into @TABLE_MIZAN (ID,PARENTID,KART_KOD,ACK,BORC,ALACAK,BAKIYE_BORC,BAKIYE_ALACAK)\r\n              VALUES (@id,@grp2id,@KOD,@KOD,@BORC,@ALACAK,@BBAKIYE,@ABAKIYE)\r\n\r\n            set @id=@id+1  \r\n\r\n             FETCH next from  gec_cur into @KOD,@BORC,@ALACAK\r\n           end\r\n         close gec_cur\r\n         deallocate gec_cur\r\n         \r\n           \r\n\r\n         update @TABLE_MIZAN set ACK=dt.ad from @TABLE_MIZAN as t join\r\n         (select kod,ad from istkart ) dt \r\n         on t.KART_KOD=dt.kod \r\n         \r\n         \r\n         \r\n           update @TABLE_MIZAN set \r\n           BORC=isnull(dt.BORC,0),ALACAK=isnull(dt.ALACAK,0),\r\n           BAKIYE_BORC=ISNULL(dt.BBORC,0),BAKIYE_ALACAK=isnull(dt.BALACAK,0)\r\n            from @TABLE_MIZAN as t\r\n           join (select sum(borc) as borc,sum(alacak) as alacak,\r\n           case when  sum(borc-alacak)>0 then sum(borc-alacak) else 0 end bborc,\r\n           case when sum(borc-alacak)<0 then -1*sum(borc-alacak) else 0 end balacak\r\n           from @TABLE_MIZAN where PARENTID=@grp2id ) dt \r\n           on t.ID=@grp2id\r\n       \r\n         \r\n         update @TABLE_MIZAN set \r\n         BORC=isnull(dt.BORC,0),ALACAK=isnull(dt.ALACAK,0),\r\n         BAKIYE_BORC=ISNULL(dt.BBORC,0),BAKIYE_ALACAK=isnull(dt.BALACAK,0)\r\n          from @TABLE_MIZAN as t\r\n         join (select sum(borc) as borc,sum(alacak) as alacak,\r\n         case when  sum(borc-alacak)>0 then sum(borc-alacak) else 0 end bborc,\r\n         case when sum(borc-alacak)<0 then -1*sum(borc-alacak) else 0 end balacak\r\n         from @TABLE_MIZAN where PARENTID=@grp1id ) dt \r\n         on t.ID=@grp1id        \r\n    \r\n\r\n\r\nRETURN\r\n\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_MIZAN_KASA",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_MIZAN_KASA",
    "definition": "CREATE FUNCTION UDF_MIZAN_KASA \r\n(@FIRMA_NO       \tINT,\r\n @id\t\t\t   \tINT,\r\n @BAS_TAR          \tDATETIME,\r\n @BIT_TAR          \tDATETIME,\r\n @SIF_BAK3_GSTME \tTINYINT)\r\nRETURNS\r\n\r\n  @TABLE_MIZAN TABLE (\r\n   ID\t\t\t\t\tint,\r\n   PARENTID\t\t\t\tint,\t\r\n   GRPNO\t\t\t\tint,\r\n   KART_KOD\t\t\t\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n   ACK\t\t\t\t\tVARCHAR(100) COLLATE Turkish_CI_AS,\r\n   BORC\t\t\t\t    float,\r\n   ALACAK\t\t\t\tfloat,\r\n   BAKIYE_BORC\t\t\tfloat,\r\n   BAKIYE_ALACAK\t\tfloat)\r\n\r\nAS\r\nBEGIN\r\n\r\n\r\n  declare @grp1id \t \tint\r\n  declare @grp2id \t\tint\r\n\r\n  declare @KOD      \tvarchar(100)\r\n  declare @GRP_AD   \tvarchar(100)\r\n  declare @GRP_ID  \t\tfloat\r\n  declare @GRP_SR  \t\tint\r\n  \r\n  declare @BORC  \t\tfloat\r\n  declare @ALACAK  \t\tfloat\r\n  declare @BAKIYE  \t\tfloat\r\n\r\n  declare @ABAKIYE  \tfloat\r\n  declare @BBAKIYE  \tfloat  \r\n \r\n   DECLARE @VAR_TES_TEK     INT \r\n  DECLARE @KAS_FIN_GOS     INT\r\n  \r\n   select @VAR_TES_TEK=t.var_tes_tek,\r\n    @KAS_FIN_GOS=t.kas_fin_var from sistemtanim as t\r\n \r\n      set @grp1id=@id\r\n    \r\n       insert into @TABLE_MIZAN (ID,PARENTID,ACK,BORC,ALACAK,BAKIYE_BORC,BAKIYE_ALACAK)\r\n       VALUES (@grp1id,0,'KASA KARTLARI',0,0,0,0)\r\n\r\n       declare mas_cur CURSOR FAST_FORWARD  FOR \r\n       select parabrm from kasakart with(nolock) where sil=0 group by parabrm\r\n         open mas_cur\r\n          fetch next from  mas_cur into @GRP_AD\r\n           while @@FETCH_STATUS=0\r\n            begin \r\n      \r\n   \r\n             set @id=@id+1 \r\n      \r\n              set @grp2id=@id\r\n     \r\n              insert into @TABLE_MIZAN (ID,PARENTID,ACK,BORC,\r\n              ALACAK,BAKIYE_BORC,BAKIYE_ALACAK)\r\n               VALUES (@id,@grp1id,@GRP_AD,0,0,0,0)\r\n   \r\n               set @id=@id+1     \r\n          \r\n          \r\n         /*if @VAR_TES_TEK=0    */\r\n           IF (@FIRMA_NO=0)  \r\n            declare gec_cur CURSOR FAST_FORWARD  FOR \r\n            select h.kaskod,sum(h.giren*h.KUR),\r\n            sum(h.cikan*h.KUR) from\r\n            kasahrk as h with(nolock) \r\n            inner join kasakart as k with(nolock) on k.kod=h.kaskod\r\n            and k.parabrm=@GRP_AD and k.sil=0\r\n            where h.sil=0 \r\n            and ( h.varno=0 or (varno>0 and h.islmhrk='TES') )\r\n            and h.tarih>=@BAS_TAR \r\n            and h.tarih<=@BIT_TAR \r\n            group by h.kaskod \r\n            \r\n            \r\n            IF (@FIRMA_NO>0)  \r\n            declare gec_cur CURSOR FAST_FORWARD  FOR \r\n            select h.kaskod,sum(h.giren*h.KUR),\r\n            sum(h.cikan*h.KUR) from\r\n            kasahrk as h with(nolock)\r\n            inner join kasakart as k with(nolock) on k.kod=h.kaskod\r\n            and h.firmano in (0,@FIRMA_NO)\r\n            and k.parabrm=@GRP_AD and k.sil=0 \r\n            where h.sil=0  \r\n            and ( h.varno=0 or (varno>0 and h.islmhrk='TES') )\r\n            and h.tarih>=@BAS_TAR \r\n            and h.tarih<=@BIT_TAR \r\n            group by h.kaskod \r\n            \r\n           \r\n          \r\n             \r\n            \r\n            \r\n            /*\r\n             finas gosterme ve tek teslimat pasif se\r\n            \r\n            select sum(giren),sum(cikan) from kasahrk where tarih='2010-05-17'\r\n            and ((varno>0 and islmhrk='TES') or varno=0   ) and sil=0\r\n            \r\n            \r\n            */\r\n            \r\n            \r\n             open gec_cur\r\n          fetch next from  gec_cur into @KOD,@BORC,@ALACAK\r\n           while @@FETCH_STATUS=0\r\n            begin\r\n            \r\n            set @BORC=ROUND(@BORC,2)\r\n            set @ALACAK=ROUND(@ALACAK,2)\r\n            \r\n            set @BBAKIYE=0\r\n            set @ABAKIYE=0\r\n            \r\n            SET @BAKIYE=@BORC-@ALACAK \r\n             \r\n             if @BAKIYE>0\r\n              set @BBAKIYE=@BAKIYE\r\n              \r\n             if @BAKIYE<0\r\n              set @ABAKIYE=-1*@BAKIYE\r\n                \r\n            \r\n              if (@SIF_BAK3_GSTME=0) OR (@SIF_BAK3_GSTME=1 AND (@BAKIYE <>0) )\r\n              insert into @TABLE_MIZAN (ID,PARENTID,KART_KOD,ACK,BORC,ALACAK,BAKIYE_BORC,BAKIYE_ALACAK)\r\n              VALUES (@id,@grp2id,@KOD,@KOD,@BORC,@ALACAK,@BBAKIYE,@ABAKIYE)\r\n\r\n            set @id=@id+1  \r\n\r\n             FETCH next from  gec_cur into @KOD,@BORC,@ALACAK\r\n           end\r\n         close gec_cur\r\n         deallocate gec_cur\r\n         \r\n           \r\n           update @TABLE_MIZAN set \r\n           BORC=isnull(dt.BORC,0),ALACAK=isnull(dt.ALACAK,0),\r\n           BAKIYE_BORC=ISNULL(dt.BBORC,0),BAKIYE_ALACAK=isnull(dt.BALACAK,0)\r\n            from @TABLE_MIZAN as t\r\n           join (select sum(borc) as borc,sum(alacak) as alacak,\r\n           case when  sum(borc-alacak)>0 then sum(borc-alacak) else 0 end bborc,\r\n           case when sum(borc-alacak)<0 then -1*sum(borc-alacak) else 0 end balacak\r\n           from @TABLE_MIZAN where PARENTID=@grp2id ) dt \r\n           on t.ID=@grp2id\r\n       \r\n       \r\n          FETCH next from  mas_cur into @GRP_AD\r\n         end\r\n        Close mas_cur\r\n        deallocate mas_cur      \r\n         \r\n        \r\n        \r\n        update @TABLE_MIZAN set ACK=dt.ad from @TABLE_MIZAN as t join\r\n         (select kod,ad as ad from kasakart ) dt \r\n         on t.KART_KOD=dt.kod \r\n        \r\n        \r\n        \r\n         \r\n         update @TABLE_MIZAN set \r\n         BORC=isnull(dt.BORC,0),ALACAK=isnull(dt.ALACAK,0),\r\n         BAKIYE_BORC=ISNULL(dt.BBORC,0),BAKIYE_ALACAK=isnull(dt.BALACAK,0)\r\n          from @TABLE_MIZAN as t\r\n         join (select sum(borc) as borc,sum(alacak) as alacak,\r\n         case when  sum(borc-alacak)>0 then sum(borc-alacak) else 0 end bborc,\r\n         case when sum(borc-alacak)<0 then -1*sum(borc-alacak) else 0 end balacak\r\n         from @TABLE_MIZAN where PARENTID=@grp1id ) dt \r\n         on t.ID=@grp1id        \r\n    \r\n\r\n\r\nRETURN\r\n\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_MIZAN_MARKET",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_MIZAN_MARKET",
    "definition": "CREATE FUNCTION [dbo].UDF_MIZAN_MARKET\r\n(\r\n@FIRMA_NO       \tINT,\r\n@id \t\t\t\tINT,\r\n@BAS_TAR        \tDATETIME,\r\n@BIT_TAR  \t    \tDATETIME,\r\n@MR_FIYAT      \t\tTINYINT,\r\n@SIF_BAK3_GSTME \tTINYINT)\r\nRETURNS\r\n\r\n  @TABLE_MIZAN TABLE (\r\n   ID\t\t\t\t\tint,\r\n   PARENTID\t\t\t\tint,\t\r\n   GRPNO\t\t\t\tint,\r\n   KART_KOD\t\t\t\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n   ACK\t\t\t\t\tVARCHAR(100) COLLATE Turkish_CI_AS,\r\n   BORC\t\t\t\t    float,\r\n   ALACAK\t\t\t\tfloat,\r\n   BAKIYE_BORC\t\t\tfloat,\r\n   BAKIYE_ALACAK\t\tfloat)\r\n\r\nAS\r\nBEGIN\r\n\r\n\r\n\r\n  declare @grp1id \t \tint\r\n  declare @grp2id \t\tint\r\n\r\n  declare @KOD      \tvarchar(100)\r\n  declare @AD      \t    varchar(100)\r\n  declare @GRP_AD   \tvarchar(100)\r\n  declare @GRP_ID  \t\tfloat\r\n  declare @GRP_SR  \t\tint\r\n\r\n\r\n  declare @GIREN  \t\tfloat\r\n  declare @CIKAN  \t\tfloat\r\n  declare @BRMFIY  \t\tfloat\r\n  \r\n  declare @BORC  \t\tfloat\r\n  declare @ALACAK  \t\tfloat\r\n  declare @BAKIYE  \t\tfloat\r\n\r\n  declare @ABAKIYE  \tfloat\r\n  declare @BBAKIYE  \tfloat  \r\n\r\n  declare @GEC_BRMFIY  \tfloat\r\n     \r\n      set @grp1id=@id\r\n    \r\n       insert into @TABLE_MIZAN (ID,PARENTID,ACK,BORC,ALACAK,BAKIYE_BORC,BAKIYE_ALACAK)\r\n       VALUES (@grp1id,0,'MARKET STOK KARTLARI',0,0,0,0)\r\n\r\n       \r\n      declare mas_cur CURSOR FAST_FORWARD  FOR \r\n       select id,sr,ad from grup where tabload='markgrp' and sil=0 and sr=0\r\n         open mas_cur\r\n          fetch next from  mas_cur into @GRP_ID,@GRP_SR,@GRP_AD\r\n           while @@FETCH_STATUS=0\r\n            begin \r\n      \r\n   \r\n             set @id=@id+1 \r\n      \r\n              set @grp2id=@id\r\n     \r\n              insert into @TABLE_MIZAN (ID,PARENTID,ACK,BORC,\r\n              ALACAK,BAKIYE_BORC,BAKIYE_ALACAK)\r\n               VALUES (@id,@grp1id,@GRP_AD,0,0,0,0)\r\n   \r\n                 set @id=@id+1     \r\n                \r\n               IF (@FIRMA_NO=0) \r\n                declare gec_cur CURSOR FAST_FORWARD  FOR \r\n                select h.stkod,K.AD,\r\n                  sum(h.giren*h.brmfiykdvli),\r\n                  sum(h.cikan*h.brmfiykdvli),\r\n                  sum(h.giren),\r\n                  sum(h.cikan)\r\n               from\r\n                stkhrk as h \r\n                inner join stokkart as k on h.stktip=k.tip and h.stkod=k.kod \r\n                where h.stktip='markt' and k.sil=0 \r\n                and h.sil=0 and k.grp1=@GRP_ID\r\n                and h.tarih>=@BAS_TAR \r\n                and h.tarih<=@BIT_TAR \r\n                and k.sil=0\r\n                group by h.stkod,K.AD\r\n                ORDER by k.ad \r\n                \r\n               \r\n               IF (@FIRMA_NO>0) \r\n                declare gec_cur CURSOR FAST_FORWARD  FOR \r\n                select h.stkod,K.AD,\r\n                  sum(h.giren*h.brmfiykdvli),\r\n                  sum(h.cikan*h.brmfiykdvli),\r\n                  sum(h.giren),\r\n                  sum(h.cikan)\r\n               from\r\n                stkhrk as h \r\n                inner join stokkart as k on h.stktip=k.tip and h.stkod=k.kod \r\n                where h.stktip='markt' and k.sil=0 \r\n                and h.sil=0 and k.grp1=@GRP_ID\r\n                and h.firmano in (0,@FIRMA_NO)\r\n                and h.tarih>=@BAS_TAR \r\n                and h.tarih<=@BIT_TAR \r\n                and k.sil=0\r\n                group by h.stkod,K.AD\r\n                ORDER by k.ad \r\n            \r\n                  open gec_cur\r\n                  fetch next from  gec_cur into \r\n                  @KOD,@AD,@BORC,@ALACAK,@GIREN,@CIKAN\r\n                  \r\n                   while @@FETCH_STATUS=0\r\n                    begin\r\n\r\n                   if @MR_FIYAT=1\r\n                    begin \r\n                      SET @BRMFIY=DBO.UDF_Stok_Fiyat('markt',2,@KOD,'Dahil',1)\r\n                      SET @BORC=@GIREN*@BRMFIY\r\n                      SET @ALACAK=@CIKAN*@BRMFIY\r\n                    end\r\n \r\n                    if @MR_FIYAT=2\r\n                    begin \r\n                      SET @BRMFIY=DBO.UDF_Stok_Fiyat('markt',2,@KOD,'Dahil',2)\r\n                      SET @BORC=@GIREN*@BRMFIY\r\n                      SET @ALACAK=@CIKAN*@BRMFIY\r\n                    end           \r\n                    \r\n                    if @MR_FIYAT=3\r\n                    begin \r\n                      SET @BRMFIY=DBO.UDF_Stok_Fiyat('markt',2,@KOD,'Dahil',3)\r\n                      SET @BORC=@GIREN*@BRMFIY\r\n                      SET @ALACAK=@CIKAN*@BRMFIY\r\n                    end  \r\n                    \r\n                    \r\n                    if @MR_FIYAT=4\r\n                    begin \r\n                      SET @BRMFIY=DBO.UDF_Stok_Fiyat('markt',2,@KOD,'Dahil',4)\r\n                      SET @BORC=@GIREN*@BRMFIY\r\n                      SET @ALACAK=@CIKAN*@BRMFIY\r\n                    end  \r\n                    \r\n                    \r\n                    if @MR_FIYAT=5\r\n                    begin \r\n                      SET @BRMFIY=DBO.UDF_Stok_Fiyat('markt',2,@KOD,'Hariç',1)\r\n                      SET @BORC=@GIREN*@BRMFIY\r\n                      SET @ALACAK=@CIKAN*@BRMFIY\r\n                    end \r\n                \r\n                 if @MR_FIYAT=6\r\n                    begin \r\n                      SET @BRMFIY=DBO.UDF_Stok_Fiyat('markt',2,@KOD,'Hariç',2)\r\n                      SET @BORC=@GIREN*@BRMFIY\r\n                      SET @ALACAK=@CIKAN*@BRMFIY\r\n                   end \r\n                   \r\n                 if @MR_FIYAT=7\r\n                    begin \r\n                      SET @BRMFIY=DBO.UDF_Stok_Fiyat('markt',2,@KOD,'Hariç',3)\r\n                      SET @BORC=@GIREN*@BRMFIY\r\n                      SET @ALACAK=@CIKAN*@BRMFIY\r\n                    end    \r\n                   \r\n                 if @MR_FIYAT=8\r\n                    begin \r\n                      SET @BRMFIY=DBO.UDF_Stok_Fiyat('markt',2,@KOD,'Hariç',4)\r\n                      SET @BORC=@GIREN*@BRMFIY\r\n                      SET @ALACAK=@CIKAN*@BRMFIY\r\n                    end    \r\n                 \r\n                  if @MR_FIYAT=9\r\n                    begin \r\n                      SET @BRMFIY=DBO.UDF_Stok_Fiyat('markt',1,@KOD,'Dahil',4)\r\n                      SET @BORC=@GIREN*@BRMFIY\r\n                      SET @ALACAK=@CIKAN*@BRMFIY\r\n                    end   \r\n              \r\n              \r\n                    if @MR_FIYAT=10\r\n                    begin \r\n                      SET @BRMFIY=DBO.UDF_Stok_Fiyat('markt',1,@KOD,'Hariç',4)\r\n                      SET @BORC=@GIREN*@BRMFIY\r\n                      SET @ALACAK=@CIKAN*@BRMFIY\r\n                    end  \r\n                    \r\n                    \r\n                    \r\n                    SET @GEC_BRMFIY=0\r\n                    \r\n                    if @MR_FIYAT=11 /*alis fiyatı son tarihteki kdv dahil */\r\n                    begin \r\n                  \r\n                    IF (@FIRMA_NO=0)  \r\n                      SELECT TOP 1 @GEC_BRMFIY=h.brmfiykdvli \r\n                         from stkhrk as h\r\n                        where stktip='markt' and stkod=@KOD\r\n                        and h.tarih<=@BIT_TAR and h.sil=0 and h.giren>0\r\n                        and h.brmfiykdvli>0 and h.islmtip<>'MARIAD'\r\n                        order by h.tarih desc,h.saat desc \r\n                        \r\n                        \r\n                      IF (@FIRMA_NO>0)       \r\n                        SELECT TOP 1 @GEC_BRMFIY=h.brmfiykdvli \r\n                        from stkhrk as h\r\n                        where stktip='markt' and stkod=@KOD and h.firmano in (0,@FIRMA_NO)\r\n                        and h.tarih<=@BIT_TAR and h.sil=0 and h.giren>0\r\n                        and h.brmfiykdvli>0 and h.islmtip<>'MARIAD'\r\n                        order by h.tarih desc,h.saat desc \r\n                    \r\n                    \r\n                      \r\n                      SET @BORC=@GIREN*@GEC_BRMFIY\r\n                      SET @ALACAK=@CIKAN*@GEC_BRMFIY\r\n                    end  \r\n                    \r\n                    \r\n                    \r\n                    if @MR_FIYAT=12 /*alis fiyatı son tarihteki kdv haric */\r\n                    begin \r\n                      \r\n                    IF (@FIRMA_NO=0)  \r\n                     SELECT TOP 1 @GEC_BRMFIY=(h.brmfiykdvli/(1+(h.kdvyuz))) \r\n                         from stkhrk as h\r\n                        where stktip='markt' and stkod=@KOD\r\n                        and h.tarih<=@BIT_TAR and h.sil=0 and h.giren>0\r\n                        and h.brmfiykdvli>0 and h.islmtip<>'MARIAD'\r\n                        order by h.tarih desc,h.saat desc \r\n                        \r\n                      IF (@FIRMA_NO>0)   \r\n                        SELECT TOP 1 @GEC_BRMFIY=(h.brmfiykdvli/(1+(h.kdvyuz))) \r\n                         from stkhrk as h\r\n                        where stktip='markt' and stkod=@KOD and h.firmano in (0,@FIRMA_NO)\r\n                        and h.tarih<=@BIT_TAR and h.sil=0 and h.giren>0\r\n                        and h.brmfiykdvli>0 and h.islmtip<>'MARIAD'\r\n                        order by h.tarih desc,h.saat desc \r\n                        \r\n\r\n                      SET @BORC=@GIREN*@GEC_BRMFIY\r\n                      SET @ALACAK=@CIKAN*@GEC_BRMFIY\r\n                    end   \r\n                    \r\n                    \r\n                    \r\n                    if @MR_FIYAT=13 /*satis fiyatı son tarihteki kdv dahil */\r\n                    begin \r\n                      \r\n                    IF (@FIRMA_NO=0)\r\n                      SELECT TOP 1 @GEC_BRMFIY=h.brmfiykdvli \r\n                         from stkhrk as h\r\n                        where stktip='markt' and stkod=@KOD\r\n                        and h.tarih<=@BIT_TAR and h.sil=0 and h.cikan>0\r\n                        and h.brmfiykdvli>0\r\n                        order by h.tarih desc,h.saat desc \r\n                    \r\n                    \r\n                     IF (@FIRMA_NO>0)\r\n                       SELECT TOP 1 @GEC_BRMFIY=h.brmfiykdvli \r\n                         from stkhrk as h\r\n                        where stktip='markt' and stkod=@KOD and h.firmano in (0,@FIRMA_NO)\r\n                        and h.tarih<=@BIT_TAR and h.sil=0 and h.cikan>0\r\n                        and h.brmfiykdvli>0\r\n                        order by h.tarih desc,h.saat desc \r\n                    \r\n                      \r\n                      SET @BORC=@GIREN*@GEC_BRMFIY\r\n                      SET @ALACAK=@CIKAN*@GEC_BRMFIY\r\n                    end  \r\n                    \r\n                    \r\n                    \r\n                    if @MR_FIYAT=14 /*satis fiyatı son tarihteki kdv haric */\r\n                    begin \r\n                    \r\n                    IF (@FIRMA_NO=0)  \r\n                      SELECT TOP 1 @GEC_BRMFIY=(h.brmfiykdvli/(1+(h.kdvyuz))) \r\n                         from stkhrk as h\r\n                        where stktip='markt' and stkod=@KOD\r\n                        and h.tarih<=@BIT_TAR and h.sil=0 and h.cikan>0\r\n                        and h.brmfiykdvli>0\r\n                        order by h.tarih desc,h.saat desc \r\n                        \r\n                        IF (@FIRMA_NO>0)  \r\n                         SELECT TOP 1 @GEC_BRMFIY=(h.brmfiykdvli/(1+(h.kdvyuz))) \r\n                         from stkhrk as h\r\n                        where stktip='markt' and stkod=@KOD and h.firmano in (0,@FIRMA_NO)\r\n                        and h.tarih<=@BIT_TAR and h.sil=0 and h.cikan>0\r\n                        and h.brmfiykdvli>0\r\n                        order by h.tarih desc,h.saat desc \r\n                        \r\n\r\n                      SET @BORC=@GIREN*@GEC_BRMFIY\r\n                      SET @ALACAK=@CIKAN*@GEC_BRMFIY\r\n                    end   \r\n                \r\n                    \r\n            \r\n                                    \r\n                    \r\n                    set @BORC=ROUND(@BORC,2)\r\n                    set @ALACAK=ROUND(@ALACAK,2)\r\n                    \r\n                    set @BBAKIYE=0\r\n                    set @ABAKIYE=0\r\n                    \r\n                    SET @BAKIYE=@BORC-@ALACAK \r\n                     \r\n                     if @BAKIYE>0\r\n                      set @BBAKIYE=@BAKIYE\r\n                      \r\n                     if @BAKIYE<0\r\n                      set @ABAKIYE=-1*@BAKIYE\r\n                        \r\n                    \r\n                     if (@SIF_BAK3_GSTME=0) OR (@SIF_BAK3_GSTME=1 AND (@BAKIYE <>0) ) \r\n                      insert into @TABLE_MIZAN (ID,PARENTID,KART_KOD,ACK,\r\n                      BORC,ALACAK,BAKIYE_BORC,BAKIYE_ALACAK)\r\n                      VALUES (@id,@grp2id,@KOD,@KOD,@BORC,@ALACAK,@BBAKIYE,@ABAKIYE)\r\n\r\n                   set @id=@id+1  \r\n\r\n                     FETCH next from  gec_cur into @KOD,@AD,\r\n                     @BORC,@ALACAK,@GIREN,@CIKAN\r\n                   end\r\n                 close gec_cur\r\n                 deallocate gec_cur\r\n                 \r\n                 \r\n                 \r\n                 \r\n                update @TABLE_MIZAN set \r\n               BORC=isnull(dt.BORC,0),ALACAK=isnull(dt.ALACAK,0),\r\n               BAKIYE_BORC=isnull(dt.BBORC,0),BAKIYE_ALACAK=isnull(dt.BALACAK,0)\r\n                from @TABLE_MIZAN as t\r\n               join (select sum(borc) as borc,sum(alacak) as alacak,\r\n               case when  sum(borc-alacak)>0 then sum(borc-alacak) else 0 end bborc,\r\n               case when sum(borc-alacak)<0 then -1*sum(borc-alacak) else 0 end balacak\r\n               from @TABLE_MIZAN where PARENTID=@grp2id ) dt \r\n               on t.ID=@grp2id     \r\n                 \r\n                 \r\n              FETCH next from  mas_cur into @GRP_ID,@GRP_SR,@GRP_AD\r\n             end\r\n            Close mas_cur\r\n            deallocate mas_cur        \r\n           \r\n          \r\n          \r\n            update @TABLE_MIZAN set ACK=dt.ad from @TABLE_MIZAN as t join\r\n            (select kod,ad from stokkart where tip='markt') dt \r\n            on t.KART_KOD=dt.kod\r\n          \r\n          \r\n           \r\n           \r\n           update @TABLE_MIZAN set \r\n           BORC=isnull(dt.BORC,0),ALACAK=isnull(dt.ALACAK,0),\r\n           BAKIYE_BORC=ISNULL(dt.BBORC,0),BAKIYE_ALACAK=isnull(dt.BALACAK,0)\r\n           from @TABLE_MIZAN as t\r\n           join (select sum(borc) as borc,sum(alacak) as alacak,\r\n           case when  sum(borc-alacak)>0 then sum(borc-alacak) else 0 end bborc,\r\n           case when sum(borc-alacak)<0 then -1*sum(borc-alacak) else 0 end balacak\r\n           from @TABLE_MIZAN where PARENTID=@grp1id ) dt \r\n           on t.ID=@grp1id  \r\n           \r\n  \r\n RETURN\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_MIZAN_PERKART",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_MIZAN_PERKART",
    "definition": "CREATE FUNCTION [dbo].[UDF_MIZAN_PERKART] \r\n(@FIRMA_NO       \tINT,\r\n @id\t\t\t   \tINT,\r\n @BAS_TAR          \tDATETIME,\r\n @BIT_TAR          \tDATETIME,\r\n @SIF_BAK3_GSTME \tTINYINT)\r\nRETURNS\r\n\r\n  @TABLE_MIZAN TABLE (\r\n   ID\t\t\t\t\tint,\r\n   PARENTID\t\t\t\tint,\t\r\n   GRPNO\t\t\t\tint,\r\n   KART_KOD\t\t\t\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n   ACK\t\t\t\t\tVARCHAR(150) COLLATE Turkish_CI_AS,\r\n   BORC\t\t\t\t    float,\r\n   ALACAK\t\t\t\tfloat,\r\n   BAKIYE_BORC\t\t\tfloat,\r\n   BAKIYE_ALACAK\t\tfloat)\r\n\r\nAS\r\nBEGIN\r\n\r\n\r\n  declare @grp1id \t \tint\r\n  declare @grp2id \t\tint\r\n\r\n  declare @KOD      \tvarchar(100)\r\n  declare @GRP_AD   \tvarchar(100)\r\n  declare @GRP_ID  \t\tfloat\r\n  declare @GRP_SR  \t\tint\r\n  \r\n  declare @BORC  \t\tfloat\r\n  declare @ALACAK  \t\tfloat\r\n  declare @BAKIYE  \t\tfloat\r\n\r\n  declare @ABAKIYE  \tfloat\r\n  declare @BBAKIYE  \tfloat  \r\n  \r\n  \r\n \r\n      set @grp1id=@id\r\n    \r\n       insert into @TABLE_MIZAN (ID,PARENTID,ACK,BORC,ALACAK,BAKIYE_BORC,BAKIYE_ALACAK)\r\n       VALUES (@grp1id,0,'PERSONEL KARTLARI',0,0,0,0)\r\n\r\n       declare mas_cur CURSOR FAST_FORWARD  FOR \r\n       select id,sr,ad from grup where tabload='perkart' and sil=0 \r\n         open mas_cur\r\n          fetch next from  mas_cur into @GRP_ID,@GRP_SR,@GRP_AD\r\n           while @@FETCH_STATUS=0\r\n            begin \r\n      \r\n   \r\n             set @id=@id+1 \r\n      \r\n              set @grp2id=@id\r\n     \r\n              insert into @TABLE_MIZAN (ID,PARENTID,ACK,BORC,\r\n              ALACAK,BAKIYE_BORC,BAKIYE_ALACAK)\r\n               VALUES (@id,@grp1id,@GRP_AD,0,0,0,0)\r\n   \r\n               set @id=@id+1     \r\n\r\n          \r\n          IF (@FIRMA_NO=0)\r\n           declare gec_cur CURSOR FAST_FORWARD  FOR \r\n            select h.carkod,sum(h.borc),\r\n            sum(h.alacak) from\r\n            carihrk as h \r\n            inner join perkart as k on k.kod=h.carkod\r\n            and h.cartip='perkart'\r\n            and k.grp1=@GRP_ID and k.sil=0\r\n            where h.sil=0\r\n            and h.tarih>=@BAS_TAR \r\n            and h.tarih<=@BIT_TAR \r\n            group by h.carkod \r\n            \r\n            \r\n           IF (@FIRMA_NO>0)\r\n            declare gec_cur CURSOR FAST_FORWARD  FOR \r\n            select h.carkod,sum(h.borc),\r\n            sum(h.alacak) from\r\n            carihrk as h \r\n            inner join perkart as k on k.kod=h.carkod\r\n            and h.firmano in (0,@FIRMA_NO)\r\n            and h.cartip='perkart'\r\n            and k.grp1=@GRP_ID and k.sil=0\r\n            where h.sil=0\r\n            and h.tarih>=@BAS_TAR \r\n            and h.tarih<=@BIT_TAR \r\n            group by h.carkod \r\n            \r\n            \r\n           open gec_cur\r\n          fetch next from  gec_cur into @KOD,@BORC,@ALACAK\r\n           while @@FETCH_STATUS=0\r\n            begin\r\n            \r\n            set @BORC=ROUND(@BORC,2)\r\n            set @ALACAK=ROUND(@ALACAK,2)\r\n            \r\n            set @BBAKIYE=0\r\n            set @ABAKIYE=0\r\n            \r\n            SET @BAKIYE=@BORC-@ALACAK \r\n             \r\n             if @BAKIYE>0\r\n              set @BBAKIYE=@BAKIYE\r\n              \r\n             if @BAKIYE<0\r\n              set @ABAKIYE=-1*@BAKIYE\r\n                \r\n            \r\n              if (@SIF_BAK3_GSTME=0) OR (@SIF_BAK3_GSTME=1 AND (@BAKIYE <>0) )\r\n              insert into @TABLE_MIZAN (ID,PARENTID,KART_KOD,ACK,BORC,ALACAK,BAKIYE_BORC,BAKIYE_ALACAK)\r\n              VALUES (@id,@grp2id,@KOD,@KOD,@BORC,@ALACAK,@BBAKIYE,@ABAKIYE)\r\n\r\n            set @id=@id+1  \r\n\r\n             FETCH next from  gec_cur into @KOD,@BORC,@ALACAK\r\n           end\r\n         close gec_cur\r\n         deallocate gec_cur\r\n         \r\n           \r\n           update @TABLE_MIZAN set \r\n           BORC=isnull(dt.BORC,0),ALACAK=isnull(dt.ALACAK,0),\r\n           BAKIYE_BORC=ISNULL(dt.BBORC,0),BAKIYE_ALACAK=isnull(dt.BALACAK,0)\r\n            from @TABLE_MIZAN as t\r\n           join (select sum(borc) as borc,sum(alacak) as alacak,\r\n           case when  sum(borc-alacak)>0 then sum(borc-alacak) else 0 end bborc,\r\n           case when sum(borc-alacak)<0 then -1*sum(borc-alacak) else 0 end balacak\r\n           from @TABLE_MIZAN where PARENTID=@grp2id ) dt \r\n           on t.ID=@grp2id\r\n       \r\n       \r\n          FETCH next from  mas_cur into @GRP_ID,@GRP_SR,@GRP_AD\r\n         end\r\n        Close mas_cur\r\n        deallocate mas_cur \r\n        \r\n        \r\n        \r\n         update @TABLE_MIZAN set ACK=dt.ad from @TABLE_MIZAN as t join\r\n         (select kod,ad+' '+soyad as ad from perkart ) dt \r\n         on t.KART_KOD=dt.kod \r\n             \r\n         \r\n         \r\n         update @TABLE_MIZAN set \r\n         BORC=isnull(dt.BORC,0),ALACAK=isnull(dt.ALACAK,0),\r\n         BAKIYE_BORC=ISNULL(dt.BBORC,0),BAKIYE_ALACAK=isnull(dt.BALACAK,0)\r\n          from @TABLE_MIZAN as t\r\n         join (select sum(borc) as borc,sum(alacak) as alacak,\r\n         case when  sum(borc-alacak)>0 then sum(borc-alacak) else 0 end bborc,\r\n         case when sum(borc-alacak)<0 then -1*sum(borc-alacak) else 0 end balacak\r\n         from @TABLE_MIZAN where PARENTID=@grp1id ) dt \r\n         on t.ID=@grp1id        \r\n    \r\n\r\n\r\nRETURN\r\n\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_MIZAN_POS_BEKLEYEN",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_MIZAN_POS_BEKLEYEN",
    "definition": "CREATE FUNCTION [dbo].[UDF_MIZAN_POS_BEKLEYEN] \r\n(@FIRMA_NO       \tINT,\r\n @id\t\t\t   \tINT,\r\n @BAS_TAR          \tDATETIME,\r\n @BIT_TAR          \tDATETIME,\r\n @SIF_BAK3_GSTME \tTINYINT)\r\nRETURNS\r\n\r\n  @TABLE_MIZAN TABLE (\r\n   ID\t\t\t\t\tint,\r\n   PARENTID\t\t\t\tint,\t\r\n   GRPNO\t\t\t\tint,\r\n   KART_KOD\t\t\t\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n   ACK\t\t\t\t\tVARCHAR(100) COLLATE Turkish_CI_AS,\r\n   BORC\t\t\t\t    float,\r\n   ALACAK\t\t\t\tfloat,\r\n   BAKIYE_BORC\t\t\tfloat,\r\n   BAKIYE_ALACAK\t\tfloat)\r\n\r\nAS\r\nBEGIN\r\n\r\n\r\n  declare @grp1id \t \tint\r\n  declare @grp2id \t\tint\r\n\r\n  declare @KOD      \tvarchar(100)\r\n  declare @GRP_KOD   \tvarchar(50)\r\n  declare @GRP_AD   \tvarchar(100)\r\n  declare @GRP_ID  \t\tfloat\r\n  declare @GRP_SR  \t\tint\r\n  \r\n  declare @BORC  \t\tfloat\r\n  declare @ALACAK  \t\tfloat\r\n  declare @BAKIYE  \t\tfloat\r\n\r\n  declare @ABAKIYE  \tfloat\r\n  declare @BBAKIYE  \tfloat  \r\n  \r\n  \r\n \r\n      set @grp1id=@id\r\n    \r\n       insert into @TABLE_MIZAN (ID,PARENTID,ACK,BORC,ALACAK,BAKIYE_BORC,BAKIYE_ALACAK)\r\n       VALUES (@grp1id,0,'BEKLEYEN SLIPLER',0,0,0,0)\r\n\r\n       declare mas_cur CURSOR FAST_FORWARD  FOR \r\n       select id,kod,ad from poskart where sil=0 \r\n         open mas_cur\r\n          fetch next from  mas_cur into @GRP_ID,@GRP_KOD,@GRP_AD\r\n           while @@FETCH_STATUS=0\r\n            begin \r\n      \r\n   \r\n             set @id=@id+1 \r\n      \r\n              set @grp2id=@id\r\n     \r\n              insert into @TABLE_MIZAN (ID,PARENTID,KART_KOD,ACK,BORC,\r\n              ALACAK,BAKIYE_BORC,BAKIYE_ALACAK)\r\n               VALUES (@id,@grp1id,@GRP_KOD,@GRP_AD,0,0,0,0)\r\n   \r\n               set @id=@id+1     \r\n\r\n           IF (@FIRMA_NO=0)\r\n           declare gec_cur CURSOR FAST_FORWARD  FOR \r\n            select h.poskod,sum(giren),\r\n            SUM(cikan) from\r\n            poshrk as h \r\n            inner join poskart as k on \r\n            k.kod=h.poskod\r\n            and k.kod=@GRP_KOD and k.sil=0\r\n            where h.sil=0 \r\n            and \r\n            ( (h.aktip in ('BK','BL')\r\n            and h.tarih>=@BAS_TAR\r\n            and h.tarih<=@BIT_TAR)\r\n            OR ( h.aktip in ('AK') \r\n            and h.tarih>=@BAS_TAR\r\n            and h.tarih<=@BIT_TAR\r\n            and h.aktar > @BIT_TAR ))\r\n            \r\n            /*\r\n            h.aktip \r\n            in ('BK','BL')\r\n            and h.tarih>=@BAS_TAR \r\n            and h.tarih<=@BIT_TAR \r\n            */\r\n            group by h.poskod\r\n            \r\n            \r\n           IF (@FIRMA_NO>0)  \r\n            declare gec_cur CURSOR FAST_FORWARD  FOR \r\n            select h.poskod,sum(giren),\r\n            SUM(cikan) from\r\n            poshrk as h \r\n            inner join poskart as k on \r\n            k.kod=h.poskod\r\n            and h.firmano in (0,@FIRMA_NO)\r\n            and k.kod=@GRP_KOD and k.sil=0\r\n            where h.sil=0 \r\n            and \r\n            ( (h.aktip in ('BK','BL')\r\n            and h.tarih>=@BAS_TAR\r\n            and h.tarih<=@BIT_TAR)\r\n            OR ( h.aktip in ('AK') \r\n            and h.tarih>=@BAS_TAR\r\n            and h.tarih<=@BIT_TAR\r\n            and h.aktar > @BIT_TAR ))\r\n            \r\n            /*\r\n            h.aktip \r\n            in ('BK','BL')\r\n            and h.tarih>=@BAS_TAR \r\n            and h.tarih<=@BIT_TAR \r\n            */\r\n            group by h.poskod\r\n            \r\n            \r\n             \r\n             open gec_cur\r\n          fetch next from  gec_cur into @KOD,@BORC,@ALACAK\r\n           while @@FETCH_STATUS=0\r\n            begin\r\n            \r\n            set @BORC=ROUND(@BORC,2)\r\n            set @ALACAK=ROUND(@ALACAK,2)\r\n            \r\n            set @BBAKIYE=0\r\n            set @ABAKIYE=0\r\n            \r\n            SET @BAKIYE=@BORC-@ALACAK \r\n             \r\n             if @BAKIYE>0\r\n              set @BBAKIYE=@BAKIYE\r\n              \r\n             if @BAKIYE<0\r\n              set @ABAKIYE=-1*@BAKIYE\r\n                \r\n            \r\n              if (@SIF_BAK3_GSTME=0) OR (@SIF_BAK3_GSTME=1 AND (@BAKIYE <>0) )\r\n              insert into @TABLE_MIZAN (ID,PARENTID,KART_KOD,ACK,BORC,ALACAK,BAKIYE_BORC,BAKIYE_ALACAK)\r\n              VALUES (@id,@grp2id,@KOD,@GRP_AD+' ('+@KOD+')',@BORC,@ALACAK,@BBAKIYE,@ABAKIYE)\r\n\r\n            set @id=@id+1  \r\n\r\n             FETCH next from  gec_cur into @KOD,@BORC,@ALACAK\r\n           end\r\n         close gec_cur\r\n         deallocate gec_cur\r\n         \r\n           \r\n           update @TABLE_MIZAN set \r\n           BORC=isnull(dt.BORC,0),ALACAK=isnull(dt.ALACAK,0),\r\n           BAKIYE_BORC=ISNULL(dt.BBORC,0),BAKIYE_ALACAK=isnull(dt.BALACAK,0)\r\n            from @TABLE_MIZAN as t\r\n           join (select sum(borc) as borc,sum(alacak) as alacak,\r\n           case when  sum(borc-alacak)>0 then sum(borc-alacak) else 0 end bborc,\r\n           case when sum(borc-alacak)<0 then -1*sum(borc-alacak) else 0 end balacak\r\n           from @TABLE_MIZAN where PARENTID=@grp2id ) dt \r\n           on t.ID=@grp2id\r\n       \r\n       \r\n          FETCH next from  mas_cur into @GRP_ID,@GRP_KOD,@GRP_AD\r\n         end\r\n        Close mas_cur\r\n        deallocate mas_cur      \r\n         \r\n        \r\n         \r\n         update @TABLE_MIZAN set \r\n         BORC=isnull(dt.BORC,0),ALACAK=isnull(dt.ALACAK,0),\r\n         BAKIYE_BORC=ISNULL(dt.BBORC,0),BAKIYE_ALACAK=isnull(dt.BALACAK,0)\r\n          from @TABLE_MIZAN as t\r\n         join (select sum(borc) as borc,sum(alacak) as alacak,\r\n         case when  sum(borc-alacak)>0 then sum(borc-alacak) else 0 end bborc,\r\n         case when sum(borc-alacak)<0 then -1*sum(borc-alacak) else 0 end balacak\r\n         from @TABLE_MIZAN where PARENTID=@grp1id ) dt \r\n         on t.ID=@grp1id        \r\n    \r\n\r\n\r\nRETURN\r\n\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_MIZAN_POS_BEKLEYEN_KOM",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_MIZAN_POS_BEKLEYEN_KOM",
    "definition": "CREATE FUNCTION [dbo].[UDF_MIZAN_POS_BEKLEYEN_KOM] \r\n(@FIRMA_NO       \tINT,\r\n @id\t\t\t   \tINT,\r\n @BAS_TAR          \tDATETIME,\r\n @BIT_TAR          \tDATETIME,\r\n @SIF_BAK3_GSTME \tTINYINT)\r\nRETURNS\r\n\r\n  @TABLE_MIZAN TABLE (\r\n   ID\t\t\t\t\tint,\r\n   PARENTID\t\t\t\tint,\t\r\n   GRPNO\t\t\t\tint,\r\n   KART_KOD\t\t\t\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n   ACK\t\t\t\t\tVARCHAR(100) COLLATE Turkish_CI_AS,\r\n   BORC\t\t\t\t    float,\r\n   ALACAK\t\t\t\tfloat,\r\n   BAKIYE_BORC\t\t\tfloat,\r\n   BAKIYE_ALACAK\t\tfloat)\r\n\r\nAS\r\nBEGIN\r\n\r\n\r\n  declare @grp1id \t \tint\r\n  declare @grp2id \t\tint\r\n\r\n  declare @KOD      \tvarchar(100)\r\n  declare @GRP_KOD   \tvarchar(50)\r\n  declare @GRP_AD   \tvarchar(100)\r\n  declare @GRP_ID  \t\tfloat\r\n  declare @GRP_SR  \t\tint\r\n  \r\n  declare @BORC  \t\tfloat\r\n  declare @ALACAK  \t\tfloat\r\n  declare @BAKIYE  \t\tfloat\r\n\r\n  declare @ABAKIYE  \tfloat\r\n  declare @BBAKIYE  \tfloat  \r\n  \r\n  \r\n \r\n      set @grp1id=@id\r\n    \r\n       insert into @TABLE_MIZAN (ID,PARENTID,ACK,BORC,ALACAK,BAKIYE_BORC,BAKIYE_ALACAK)\r\n       VALUES (@grp1id,0,'SLIPLERIN BANKA KOMISYONU',0,0,0,0)\r\n\r\n       declare mas_cur CURSOR FAST_FORWARD  FOR \r\n       select id,kod,ad from poskart where sil=0 \r\n         open mas_cur\r\n          fetch next from  mas_cur into @GRP_ID,@GRP_KOD,@GRP_AD\r\n           while @@FETCH_STATUS=0\r\n            begin \r\n      \r\n   \r\n             set @id=@id+1 \r\n      \r\n              set @grp2id=@id\r\n     \r\n              insert into @TABLE_MIZAN (ID,PARENTID,KART_KOD,ACK,BORC,\r\n              ALACAK,BAKIYE_BORC,BAKIYE_ALACAK)\r\n               VALUES (@id,@grp1id,@GRP_KOD,@GRP_AD,0,0,0,0)\r\n   \r\n               set @id=@id+1     \r\n\r\n\r\n           IF (@FIRMA_NO=0) \r\n           declare gec_cur CURSOR FAST_FORWARD  FOR \r\n            select h.poskod,0,\r\n            ISNULL(SUM((giren*bankomyuz)+((giren*bankomyuz)*extrakomyuz)+(giren*ekkomyuz)),0)\r\n            from\r\n            poshrk as h \r\n            inner join poskart as k on k.kod=h.poskod\r\n            and k.kod=@GRP_KOD and k.sil=0\r\n            where h.sil=0 and\r\n            ( (h.aktip in ('BK','BL')\r\n            and h.tarih>=@BAS_TAR\r\n            and h.tarih<=@BIT_TAR)\r\n            OR ( h.aktip in ('AK') \r\n            and h.tarih>=@BAS_TAR\r\n            and h.tarih<=@BIT_TAR\r\n            and h.aktar > @BIT_TAR ))\r\n            group by h.poskod \r\n            \r\n            \r\n           IF (@FIRMA_NO>0) \r\n           declare gec_cur CURSOR FAST_FORWARD  FOR \r\n            select h.poskod,0,\r\n            ISNULL(SUM((giren*bankomyuz)+((giren*bankomyuz)*extrakomyuz)+(giren*ekkomyuz)),0)\r\n            from\r\n            poshrk as h \r\n            inner join poskart as k on k.kod=h.poskod\r\n            and h.firmano in (0,@FIRMA_NO)\r\n            and k.kod=@GRP_KOD and k.sil=0\r\n            where h.sil=0 and\r\n            ( (h.aktip in ('BK','BL')\r\n            and h.tarih>=@BAS_TAR\r\n            and h.tarih<=@BIT_TAR)\r\n            OR ( h.aktip in ('AK') \r\n            and h.tarih>=@BAS_TAR\r\n            and h.tarih<=@BIT_TAR\r\n            and h.aktar > @BIT_TAR ))\r\n            group by h.poskod  \r\n            \r\n            \r\n            \r\n             open gec_cur\r\n          fetch next from  gec_cur into @KOD,@BORC,@ALACAK\r\n           while @@FETCH_STATUS=0\r\n            begin\r\n            \r\n            set @BORC=ROUND(@BORC,2)\r\n            set @ALACAK=ROUND(@ALACAK,2)\r\n            \r\n            set @BBAKIYE=0\r\n            set @ABAKIYE=0\r\n            \r\n            SET @BAKIYE=@BORC-@ALACAK \r\n             \r\n             if @BAKIYE>0\r\n              set @BBAKIYE=@BAKIYE\r\n              \r\n             if @BAKIYE<0\r\n              set @ABAKIYE=-1*@BAKIYE\r\n                \r\n            \r\n             if (@SIF_BAK3_GSTME=0) OR (@SIF_BAK3_GSTME=1 AND (@BAKIYE <>0) )\r\n              insert into @TABLE_MIZAN (ID,PARENTID,KART_KOD,ACK,BORC,ALACAK,BAKIYE_BORC,BAKIYE_ALACAK)\r\n              VALUES (@id,@grp2id,@KOD,@GRP_AD+' ('+@KOD+')',@BORC,@ALACAK,@BBAKIYE,@ABAKIYE)\r\n\r\n            set @id=@id+1  \r\n\r\n             FETCH next from  gec_cur into @KOD,@BORC,@ALACAK\r\n           end\r\n         close gec_cur\r\n         deallocate gec_cur\r\n         \r\n           \r\n           update @TABLE_MIZAN set \r\n           BORC=isnull(dt.BORC,0),ALACAK=isnull(dt.ALACAK,0),\r\n           BAKIYE_BORC=ISNULL(dt.BBORC,0),BAKIYE_ALACAK=isnull(dt.BALACAK,0)\r\n            from @TABLE_MIZAN as t\r\n           join (select sum(borc) as borc,sum(alacak) as alacak,\r\n           case when  sum(borc-alacak)>0 then sum(borc-alacak) else 0 end bborc,\r\n           case when sum(borc-alacak)<0 then -1*sum(borc-alacak) else 0 end balacak\r\n           from @TABLE_MIZAN where PARENTID=@grp2id ) dt \r\n           on t.ID=@grp2id\r\n       \r\n       \r\n          FETCH next from  mas_cur into @GRP_ID,@GRP_KOD,@GRP_AD\r\n         end\r\n        Close mas_cur\r\n        deallocate mas_cur      \r\n         \r\n        \r\n         update @TABLE_MIZAN set \r\n         BORC=isnull(dt.BORC,0),ALACAK=isnull(dt.ALACAK,0),\r\n         BAKIYE_BORC=ISNULL(dt.BBORC,0),BAKIYE_ALACAK=isnull(dt.BALACAK,0)\r\n          from @TABLE_MIZAN as t\r\n         join (select sum(borc) as borc,sum(alacak) as alacak,\r\n         case when  sum(borc-alacak)>0 then sum(borc-alacak) else 0 end bborc,\r\n         case when sum(borc-alacak)<0 then -1*sum(borc-alacak) else 0 end balacak\r\n         from @TABLE_MIZAN where PARENTID=@grp1id ) dt \r\n         on t.ID=@grp1id        \r\n    \r\n\r\n\r\nRETURN\r\n\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_MIZAN_VERESIFIS",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_MIZAN_VERESIFIS",
    "definition": "CREATE FUNCTION [dbo].[UDF_MIZAN_VERESIFIS] \r\n(@FIRMA_NO       \tINT,\r\n @id\t\t\t   \tINT,\r\n @BAS_TAR          \tDATETIME,\r\n @BIT_TAR          \tDATETIME,\r\n @SIF_BAK3_GSTME \tTINYINT)\r\nRETURNS\r\n\r\n  @TABLE_MIZAN TABLE (\r\n   ID\t\t\t\t\tint,\r\n   PARENTID\t\t\t\tint,\t\r\n   GRPNO\t\t\t\tint,\r\n   KART_KOD\t\t\t\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n   ACK\t\t\t\t\tVARCHAR(100) COLLATE Turkish_CI_AS,\r\n   BORC\t\t\t\t    float,\r\n   ALACAK\t\t\t\tfloat,\r\n   BAKIYE_BORC\t\t\tfloat,\r\n   BAKIYE_ALACAK\t\tfloat)\r\n\r\nAS\r\nBEGIN\r\n\r\n\r\n  declare @grp1id \t \tint\r\n  declare @grp2id \t\tint\r\n\r\n  declare @KOD_TIP    \tvarchar(100)\r\n  declare @KOD      \tvarchar(100)\r\n  declare @GRP_KOD   \tvarchar(50)  \r\n  declare @GRP_AD   \tvarchar(100)\r\n  declare @GRP_ID  \t\tfloat\r\n  declare @GRP_SR  \t\tint\r\n  \r\n  declare @BORC  \t\tfloat\r\n  declare @ALACAK  \t\tfloat\r\n  declare @BAKIYE  \t\tfloat\r\n\r\n  declare @ABAKIYE  \tfloat\r\n  declare @BBAKIYE  \tfloat  \r\n  \r\n  \r\n \r\n      set @grp1id=@id\r\n    \r\n       insert into @TABLE_MIZAN (ID,PARENTID,ACK,BORC,ALACAK,BAKIYE_BORC,BAKIYE_ALACAK)\r\n       VALUES (@grp1id,0,'VERESİYE FİŞLERİ',0,0,0,0)\r\n\r\n       declare mas_cur CURSOR FAST_FORWARD  FOR \r\n       select id,kod,ad from fattip where tip='FIS' \r\n         open mas_cur\r\n          fetch next from  mas_cur into @GRP_ID,@GRP_KOD,@GRP_AD\r\n           while @@FETCH_STATUS=0\r\n            begin \r\n      \r\n   \r\n             set @id=@id+1 \r\n      \r\n              set @grp2id=@id\r\n     \r\n              insert into @TABLE_MIZAN (ID,PARENTID,ACK,BORC,\r\n              ALACAK,BAKIYE_BORC,BAKIYE_ALACAK)\r\n               VALUES (@id,@grp1id,@GRP_AD,0,0,0,0)\r\n   \r\n               set @id=@id+1     \r\n\r\n         IF (@FIRMA_NO=0) \r\n           declare gec_cur CURSOR FAST_FORWARD  FOR \r\n            select h.cartip,h.carkod,\r\n            sum(case when h.fistip='FISVERSAT' then \r\n            h.toptut else 0 end),\r\n            sum(case when h.fistip='FISALCSAT' then \r\n            h.toptut else 0 end)\r\n            from veresimas as h\r\n            where h.fistip=@GRP_KOD and h.sil=0\r\n            and ( (h.aktip in ('BK','BL')\r\n            and h.tarih>=@BAS_TAR\r\n            and h.tarih<=@BIT_TAR)\r\n            OR ( h.aktip in  ('CH','CT','FT') \r\n            and h.tarih>=@BAS_TAR\r\n            and h.tarih<=@BIT_TAR\r\n            and h.aktar > @BIT_TAR ) )\r\n            and h.verid not in \r\n            (Select fisid from carihrk as ch \r\n            where  ch.tarih>=@BAS_TAR and ch.tarih<=@BIT_TAR \r\n            and ch.fisaktip='CT' \r\n            and ch.cartip=h.cartip and ch.carkod=h.carkod\r\n            and sil=0 )\r\n            group by h.cartip,h.carkod \r\n            \r\n           IF (@FIRMA_NO>0) \r\n           declare gec_cur CURSOR FAST_FORWARD  FOR \r\n            select h.cartip,h.carkod,\r\n            sum(case when h.fistip='FISVERSAT' then \r\n            h.toptut else 0 end),\r\n            sum(case when h.fistip='FISALCSAT' then \r\n            h.toptut else 0 end)\r\n            from veresimas as h\r\n            where h.fistip=@GRP_KOD \r\n            and h.firmano in (0,@FIRMA_NO)\r\n            and h.sil=0\r\n            and ( (h.aktip in ('BK','BL')\r\n            and h.tarih>=@BAS_TAR\r\n            and h.tarih<=@BIT_TAR)\r\n            OR ( h.aktip in  ('CH','CT','FT') \r\n            and h.tarih>=@BAS_TAR\r\n            and h.tarih<=@BIT_TAR\r\n            and h.aktar > @BIT_TAR ) )\r\n            and h.verid not in \r\n            (Select fisid from carihrk as ch \r\n            where  ch.tarih>=@BAS_TAR and ch.tarih<=@BIT_TAR \r\n            and ch.fisaktip='CT' \r\n            and ch.cartip=h.cartip and ch.carkod=h.carkod\r\n            and sil=0 )\r\n            group by h.cartip,h.carkod  \r\n            \r\n            \r\n            \r\n             open gec_cur\r\n          fetch next from  gec_cur into @KOD_TIP,@KOD,@BORC,@ALACAK\r\n           while @@FETCH_STATUS=0\r\n            begin\r\n            \r\n            set @BORC=ROUND(@BORC,2)\r\n            set @ALACAK=ROUND(@ALACAK,2)\r\n            \r\n            set @BBAKIYE=0\r\n            set @ABAKIYE=0\r\n            \r\n            SET @BAKIYE=@BORC-@ALACAK \r\n             \r\n             if @BAKIYE>0\r\n              set @BBAKIYE=@BAKIYE\r\n              \r\n             if @BAKIYE<0\r\n              set @ABAKIYE=-1*@BAKIYE\r\n                \r\n            \r\n             if (@SIF_BAK3_GSTME=0) OR (@SIF_BAK3_GSTME=1 AND (@BAKIYE <>0) ) \r\n              insert into @TABLE_MIZAN (ID,PARENTID,KART_KOD,ACK,BORC,ALACAK,BAKIYE_BORC,BAKIYE_ALACAK)\r\n              VALUES (@id,@grp2id,@KOD_TIP,@KOD,@BORC,@ALACAK,@BBAKIYE,@ABAKIYE)\r\n\r\n            set @id=@id+1  \r\n\r\n             FETCH next from  gec_cur into @KOD_TIP,@KOD,@BORC,@ALACAK\r\n           end\r\n         close gec_cur\r\n         deallocate gec_cur\r\n         \r\n           \r\n           update @TABLE_MIZAN set \r\n           BORC=isnull(dt.BORC,0),ALACAK=isnull(dt.ALACAK,0),\r\n           BAKIYE_BORC=ISNULL(dt.BBORC,0),BAKIYE_ALACAK=isnull(dt.BALACAK,0)\r\n            from @TABLE_MIZAN as t\r\n           join (select sum(borc) as borc,sum(alacak) as alacak,\r\n           case when  sum(borc-alacak)>0 then sum(borc-alacak) else 0 end bborc,\r\n           case when sum(borc-alacak)<0 then -1*sum(borc-alacak) else 0 end balacak\r\n           from @TABLE_MIZAN where PARENTID=@grp2id ) dt \r\n           on t.ID=@grp2id\r\n       \r\n       \r\n          FETCH next from  mas_cur into @GRP_ID,@GRP_KOD,@GRP_AD\r\n         end\r\n        Close mas_cur\r\n        deallocate mas_cur      \r\n         \r\n        \r\n        update @TABLE_MIZAN set ACK=dt.ad from @TABLE_MIZAN as t join\r\n        (select cartp,kod,ad from Genel_Kart ) dt \r\n        on t.KART_KOD=dt.cartp and t.ACK=dt.kod\r\n        \r\n        \r\n        \r\n         \r\n         update @TABLE_MIZAN set \r\n         BORC=isnull(dt.BORC,0),ALACAK=isnull(dt.ALACAK,0),\r\n         BAKIYE_BORC=ISNULL(dt.BBORC,0),BAKIYE_ALACAK=isnull(dt.BALACAK,0)\r\n          from @TABLE_MIZAN as t\r\n         join (select sum(borc) as borc,sum(alacak) as alacak,\r\n         case when  sum(borc-alacak)>0 then sum(borc-alacak) else 0 end bborc,\r\n         case when sum(borc-alacak)<0 then -1*sum(borc-alacak) else 0 end balacak\r\n         from @TABLE_MIZAN where PARENTID=@grp1id ) dt \r\n         on t.ID=@grp1id        \r\n    \r\n\r\n\r\nRETURN\r\n\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "Udf_Mikro_Banka_Hrk",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.Udf_Mikro_Banka_Hrk",
    "definition": "CREATE FUNCTION [dbo].[Udf_Mikro_Banka_Hrk](\r\n@bastar datetime,\r\n@bittar   datetime)\r\nRETURNS\r\n  @TB_MIKRO_FATURA TABLE (\r\n  hrk_id                 int,\r\n  cha_satir_no           int,\r\n  cha_tarihi             datetime,\r\n  cha_tip                int,\r\n  cha_cinsi              int,\r\n  cha_normal_Iade        int,\r\n  cha_evrak_tip          int,\r\n  cha_evrakno_seri       Varchar(20),\r\n  cha_evrakno_sira       int,\r\n  cha_belge_no           Varchar(50),\r\n  cha_belge_tarih        datetime,\r\n  cha_vade               datetime,\r\n  cha_cari_cins          int,\r\n  cha_kod                Varchar(30),\r\n  cha_kasa_hizmet        int,/*0:Carimiz 1:Cari Personelimiz 2:Bankamız 3:Hizmetimiz 4:Kasamız 5:Giderimiz 6:Muhasebe Hesabımız 7:Personelimiz 8:Demirbaşımız 9:İthalat Dosyamız 10:Finansal Sözleşmemiz */\r\n  cha_kasa_hizkod        Varchar(25),\r\n  cha_d_kurtar           datetime,\r\n  cha_d_cins             int,\r\n  cha_d_kur              float,\r\n  cha_grupno             int,\r\n  cha_meblag             float,\r\n  cha_fis_tarih          datetime,\r\n  cha_fis_sirano         Int,\r\n  cha_vergi1             float,\r\n  cha_vergi2             float,\r\n  cha_vergi3             float,\r\n  cha_vergi4             float,\r\n  cha_vergi5             float,\r\n  cha_tpoz               int,\r\n  cha_aciklama           Varchar(100),\r\n  cha_sntck_poz          int,\r\n  cha_reftarihi          datetime,\r\n  cha_aratoplam          float,\r\n  cha_pos_hareketi       int,\r\n  cha_ciro_cari_kodu     Varchar(30)\r\n  )\r\nAS\r\nBEGIN\r\n\r\n/*http://yardim.mye.com.tr/Library/Diger/DBYapisi_V12/Tablolar/cari_hesap_hareketleri.htm */\r\n/* islmhrk B-C  GİDEN HAVALE / EFT */\r\n/*islmhrk C-B  GELEN HAVALE */\r\n/*BANK  YTN   BANKAYA YATAN */\r\n/*BANK  CKN   BANKAYA CEKILEN */\r\n/*bank VRG   VİRMAN GİRİŞ */\r\n/*bank VRC   VİRMAN ÇIKIŞ */\r\n\r\n\r\n  insert into @TB_MIKRO_FATURA\r\n  (hrk_id,cha_satir_no,cha_tarihi,cha_tip,cha_cinsi,cha_normal_Iade,cha_evrak_tip,\r\n  cha_evrakno_seri,cha_evrakno_sira,cha_belge_no,\r\n  cha_belge_tarih,cha_vade,\r\n  cha_cari_cins,cha_kod,\r\n  cha_kasa_hizmet,cha_kasa_hizkod,\r\n  cha_d_kurtar,\r\n  cha_d_cins,cha_d_kur,cha_grupno,cha_meblag,\r\n  cha_fis_tarih,cha_fis_sirano,cha_vergi1,\r\n  cha_vergi2,cha_vergi3,cha_vergi4,cha_vergi5,\r\n  cha_tpoz,cha_aciklama,cha_sntck_poz,cha_reftarihi,\r\n  cha_aratoplam,cha_pos_hareketi,cha_ciro_cari_kodu )\r\n\r\n  select m.id,\r\n  cha_satir_no=m.id,\r\n  m.tarih as cha_tarihi,\r\n  cha_tip=CASE\r\n     when m.islmhrk='B-C' then  0\r\n     when m.islmhrk='C-B' then  1\r\n     when m.islmhrk='YTN' then  0\r\n     when m.islmhrk='CKN' then  1\r\n     when (m.islmhrk='VRC') or (m.islmhrk='VRG')  then  0 /*58 */\r\n     end,\r\n     /*0 borc ,1 alacak--cariye gore */\r\n    cha_cinsi= case\r\n    when (m.islmhrk='VRC') or (m.islmhrk='VRG')  then\r\n    5\r\n    else\r\n    0 end,/*0:Nakit 1:Müşteri Çeki 2:Müşteri Senedi 3:Firma Çeki 4:Firma Senedi 5:Dekont */\r\n    cha_normal_Iade=0, /*0:Normal 1:İade */\r\n  cha_evrak_tip= case\r\n     when m.islmhrk='B-C' then  35\r\n     when m.islmhrk='C-B' then  34\r\n     when m.islmhrk='YTN' then  8\r\n     when m.islmhrk='CKN' then  7\r\n     when (m.islmhrk='VRC') or (m.islmhrk='VRG')  then  33 /*58 */\r\n     end, /*34:Gelen Havale , 35:giden havale 8 yatan 7 çekilen */\r\n     /*58 banka virman 33 genel amaclı virman */\r\n  cha_evrakno_seri='BNK',  /*Varchar(4) */\r\n  cha_evrakno_sira=m.bankhrkid,  /*integer */\r\n  cha_belge_no=m.belno, /* Varchar(15) */\r\n  cha_belge_tarih=m.tarih,\r\n  cha_vade=m.tarih,\r\n  cha_cari_cins=case\r\n   when (m.islmhrk='B-C') and (m.cartip='carikart') then  0\r\n   when (m.islmhrk='B-C') and (m.cartip='perkart') then  1\r\n   when (m.islmhrk='C-B') and (m.cartip='carikart') then 0\r\n   when (m.islmhrk='C-B') and (m.cartip='perkart') then  1\r\n   when m.islmhrk='YTN' then  2\r\n   when m.islmhrk='CKN' then  2 \r\n   when (m.islmhrk='VRC') or (m.islmhrk='VRG')  then  2\r\n   end,\r\n   \r\n   /*0:Carimiz 1:Cari Personelimiz 2:Bankamız 3:Hizmetimiz 4:Kasamız 5:Giderimiz 6:Muhasebe Hesabımız 7:Personelimiz 8:Demirbaşımız 9:İthalat Dosyamız 10:Finansal Sözleşmemiz */\r\n  cha_kod=case\r\n   when m.islmhrk='B-C' then  m.carkod\r\n   when m.islmhrk='C-B' then  m.carkod\r\n   when m.islmhrk='YTN' then  m.bankod\r\n   when m.islmhrk='CKN' then  m.bankod\r\n   when (m.islmhrk='VRC') or (m.islmhrk='VRG')  then m.bankod\r\n   end,\r\n  /*Varchar(25) */\r\n  cha_kasa_hizmet=case\r\n   when m.islmhrk='B-C' then  2\r\n   when m.islmhrk='C-B' then  2\r\n   when m.islmhrk='YTN' then  4\r\n   when m.islmhrk='CKN' then  4\r\n   when (m.islmhrk='VRC') or (m.islmhrk='VRG')  then 0\r\n   end,\r\n  /*0:Carimiz 1:Cari Personelimiz 2:Bankamız 3:Hizmetimiz 4:Kasamız 5:Giderimiz 6:Muhasebe Hesabımız 7:Personelimiz 8:Demirbaşımız 9:İthalat Dosyamız 10:Finansal Sözleşmemiz */\r\n  cha_kasa_hizkod=case\r\n   when m.islmhrk='B-C' then  m.bankod\r\n   when m.islmhrk='C-B' then  m.bankod\r\n   when m.islmhrk='YTN' then  m.carkod\r\n   when m.islmhrk='CKN' then  m.carkod\r\n   when (m.islmhrk='VRC') or (m.islmhrk='VRG')  then ''\r\n   end,\r\n   cha_d_kurtar=m.tarih,    /*datetime */\r\n   cha_d_cins=0,     /*0 ytl ... */\r\n   cha_d_kur=1,      /* ytl 1 */\r\n   cha_grupno=0,    /*-**** 0 */\r\n   cha_meblag=abs(borc-alacak),/*kdv genel tutar */\r\n   cha_fis_tarih=m.tarih,   /* */\r\n   cha_fis_sirano=0,/*Integer */\r\n   cha_vergi1=0, /* 0 */\r\n   cha_vergi2=0,\r\n   cha_vergi3=0,\r\n   cha_vergi4=0,\r\n   cha_vergi5=0,\r\n   cha_tpoz=0,          /*0:Açık 1:Kapalı */\r\n   cha_aciklama=m.ack,      /*Varchar(40) */\r\n   cha_sntck_poz=0,     /*0 olucak */\r\n   cha_reftarihi=m.tarih,   /* */\r\n   cha_aratoplam=abs(borc-alacak),/* toplam */\r\n   cha_pos_hareketi=0,  /* Bit pos harektimi */\r\n   cha_ciro_cari_kodu=m.carkod  /*Varchar(25) aynı Ciro Cari Kodu */\r\n   from bankahrk as m Where sil=0\r\n   and m.tarih>=@bastar and m.tarih<=@bittar\r\n   and m.islmhrk\r\n   in ('B-C','C-B','YTN','CKN','VRC','VRG')\r\n   /*('VRC','VRG')-- */\r\n  order by m.id\r\n return\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "Udf_Mikro_Cari_Hrk",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.Udf_Mikro_Cari_Hrk",
    "definition": "CREATE FUNCTION [dbo].[Udf_Mikro_Cari_Hrk]\r\n(@bastar datetime,\r\n@bittar   datetime\r\n)\r\nRETURNS\r\n  @TB_MIKRO_FATURA TABLE (\r\n  hrk_id                 int,\r\n  cha_satir_no           int,\r\n  cha_tarihi             datetime,\r\n  cha_tip                int,\r\n  cha_cinsi              int,\r\n  cha_normal_Iade        int,\r\n  cha_evrak_tip          int,\r\n  cha_evrakno_seri       Varchar(20),\r\n  cha_evrakno_sira       int,\r\n  cha_belge_no           Varchar(50),\r\n  cha_belge_tarih        datetime,\r\n  cha_vade               datetime,\r\n  cha_cari_cins          int,\r\n  cha_kod                Varchar(30),\r\n  cha_kasa_hizmet        int,/*0:Carimiz 1:Cari Personelimiz 2:Bankamız 3:Hizmetimiz 4:Kasamız 5:Giderimiz 6:Muhasebe Hesabımız 7:Personelimiz 8:Demirbaşımız 9:İthalat Dosyamız 10:Finansal Sözleşmemiz */\r\n  cha_kasa_hizkod        Varchar(25),\r\n  cha_d_kurtar           datetime,\r\n  cha_d_cins             int,\r\n  cha_d_kur              float,\r\n  cha_grupno             int,\r\n  cha_meblag             float,\r\n  cha_fis_tarih          datetime,\r\n  cha_fis_sirano         Int,\r\n  cha_vergi1             float,\r\n  cha_vergi2             float,\r\n  cha_vergi3             float,\r\n  cha_vergi4             float,\r\n  cha_vergi5             float,\r\n  cha_tpoz               int,\r\n  cha_aciklama           Varchar(100),\r\n  cha_sntck_poz          int,\r\n  cha_reftarihi          datetime,\r\n  cha_aratoplam          float,\r\n  cha_pos_hareketi       int,\r\n  cha_ciro_cari_kodu     Varchar(30)\r\n  )\r\nAS\r\nBEGIN\r\n\r\n/*http://yardim.mye.com.tr/Library/Diger/DBYapisi_V12/Tablolar/cari_hesap_hareketleri.htm */\r\n/* islmhrk B-C  GİDEN HAVALE / EFT */\r\n/*islmhrk C-B  GELEN HAVALE */\r\n/*BANK  YTN   BANKAYA YATAN */\r\n/*BANK  CKN   BANKAYA CEKILEN */\r\n/*bank VRG   VİRMAN GİRİŞ */\r\n/*bank VRC   VİRMAN ÇIKIŞ */\r\n\r\n\r\n  insert into @TB_MIKRO_FATURA\r\n  (hrk_id,cha_satir_no,cha_tarihi,cha_tip,cha_cinsi,cha_normal_Iade,cha_evrak_tip,\r\n  cha_evrakno_seri,cha_evrakno_sira,cha_belge_no,\r\n  cha_belge_tarih,cha_vade,\r\n  cha_cari_cins,cha_kod,\r\n  cha_kasa_hizmet,cha_kasa_hizkod,\r\n  cha_d_kurtar,\r\n  cha_d_cins,cha_d_kur,cha_grupno,cha_meblag,\r\n  cha_fis_tarih,cha_fis_sirano,cha_vergi1,\r\n  cha_vergi2,cha_vergi3,cha_vergi4,cha_vergi5,\r\n  cha_tpoz,cha_aciklama,cha_sntck_poz,cha_reftarihi,\r\n  cha_aratoplam,cha_pos_hareketi,cha_ciro_cari_kodu )\r\n\r\n  select m.id,\r\n  cha_satir_no=m.id,\r\n  m.tarih as cha_tarihi,\r\n  cha_tip=case when (m.gctip='G' or m.gctip='A' ) then 1\r\n     when (m.gctip='C' or m.gctip='B' ) then  0 end, /*0 borc ,1 alacak--cariye gore */\r\n    cha_cinsi= case\r\n    when (m.islmhrk='GIR') or (m.islmhrk='CIK')  then\r\n    5\r\n    else\r\n    0 end,/*0:Nakit 1:Müşteri Çeki 2:Müşteri Senedi 3:Firma Çeki 4:Firma Senedi 5:Dekont */\r\n    cha_normal_Iade=0, /*0:Normal 1:İade */\r\n  cha_evrak_tip= case\r\n      when (m.islmhrk='GIR') or (m.islmhrk='CIK')  then  33 /*58 */\r\n     end, /*34:Gelen Havale , 35:giden havale 8 yatan 7 çekilen */\r\n     /*57 cari virman 33 genel amaclı virman */\r\n  cha_evrakno_seri='CAR',  /*Varchar(4) */\r\n  cha_evrakno_sira=m.carhrkid,  /*integer */\r\n  cha_belge_no=m.belno, /* Varchar(15) */\r\n  cha_belge_tarih=m.tarih,\r\n  cha_vade=m.tarih,\r\n  cha_cari_cins=case\r\n   when (m.islmtip='MAH') and (m.cartip='carikart') then  0\r\n   when (m.islmtip='MAH') and (m.cartip='perkart') then  1\r\n   when (m.islmhrk='GIR') or (m.islmhrk='CIK')  then  2\r\n   end,\r\n   /*0:Carimiz 1:Cari Personelimiz 2:Bankamız 3:Hizmetimiz 4:Kasamız 5:Giderimiz 6:Muhasebe Hesabımız 7:Personelimiz 8:Demirbaşımız 9:İthalat Dosyamız 10:Finansal Sözleşmemiz */\r\n  cha_kod=case\r\n   when (m.islmhrk='GIR') or (m.islmhrk='CIK')  then m.carkod\r\n   end,\r\n  /*Varchar(25) */\r\n  cha_kasa_hizmet=case\r\n   when (m.islmhrk='GIR') or (m.islmhrk='CIK')  then 0\r\n   end,\r\n  /*0:Carimiz 1:Cari Personelimiz 2:Bankamız 3:Hizmetimiz 4:Kasamız 5:Giderimiz 6:Muhasebe Hesabımız 7:Personelimiz 8:Demirbaşımız 9:İthalat Dosyamız 10:Finansal Sözleşmemiz */\r\n  cha_kasa_hizkod=case\r\n   when (m.islmhrk='GIR') or (m.islmhrk='CIK')   then ''\r\n   end,\r\n   cha_d_kurtar=m.tarih,    /*datetime */\r\n   cha_d_cins=0,     /*0 ytl ... */\r\n   cha_d_kur=1,      /* ytl 1 */\r\n   cha_grupno=0,    /*-**** 0 */\r\n   cha_meblag=abs(borc-alacak),/*kdv genel tutar */\r\n   cha_fis_tarih=m.tarih,   /* */\r\n   cha_fis_sirano=0,/*Integer */\r\n   cha_vergi1=0, /* 0 */\r\n   cha_vergi2=0,\r\n   cha_vergi3=0,\r\n   cha_vergi4=0,\r\n   cha_vergi5=0,\r\n   cha_tpoz=0,          /*0:Açık 1:Kapalı */\r\n   cha_aciklama=m.ack,      /*Varchar(40) */\r\n   cha_sntck_poz=0,     /*0 olucak */\r\n   cha_reftarihi=m.tarih,   /* */\r\n   cha_aratoplam=abs(borc-alacak),/* toplam */\r\n   cha_pos_hareketi=0,  /* Bit pos harektimi */\r\n   cha_ciro_cari_kodu=m.carkod  /*Varchar(25) aynı Ciro Cari Kodu */\r\n   from carihrk as m Where sil=0\r\n   and m.tarih>=@bastar and m.tarih<=@bittar\r\n   and m.islmhrk  in ('GIR','CIK')\r\n   /*('VRC','VRG')-- */\r\n  order by m.id\r\n return\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "Udf_Mikro_Cek_Cari",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.Udf_Mikro_Cek_Cari",
    "definition": "CREATE FUNCTION [dbo].[Udf_Mikro_Cek_Cari](\r\n@bastar datetime,\r\n@bittar datetime)\r\nRETURNS\r\n  @TB_MIKRO_CEK TABLE (\r\n  cek_id                 int,\r\n  hrk_id                 int,\r\n  cek_drm                varchar(5),\r\n  hrk_tarih              DateTime,\r\n  sck_iptal              int,/* */\r\n  sck_tip                Tinyint,\r\n  sck_refno              Varchar(25),/* Senet Çek Referans No */\r\n  sck_ilk_evrak_seri     Varchar(4),\r\n  sck_ilk_evrak_sira_no  int,\r\n  sck_ilk_evrak_satir_no int,\r\n  sck_bankano            Varchar(25),/* Banka No Bkz. BANKALAR */\r\n  sck_borclu             Varchar(30),/* Borçlu Adı */\r\n  sck_vdaire_no          Varchar(40),/* Vergi Daire Numarası */\r\n  sck_hesapno_sehir      Varchar(20),/*hesap no */\r\n  sck_vade               DateTime,/* Vade Tarihi */\r\n  sck_tutar              Float,/* Tutar */\r\n  sck_doviz              Tinyint,/* Döviz Cinsi Bkz. DOVIZ_KURLARI */\r\n  sck_banka_adres1       Varchar(50),/* Banka Adresi */\r\n  sck_sube_adres2        Varchar(50),/* Şube Adresi */\r\n  sck_duzen_tarih        DateTime,/* Düzenlenme Tarihi */\r\n  sck_sahip_cari_cins    Tinyint,/* Senet-Çek Sahibi Cari Cinsi */\r\n  sck_sahip_cari_kodu    Varchar(25),/* Senet-Çek Sahibi Cari Kodu Bkz. CARI_HESAPLAR */\r\n  sck_sahip_cari_grupno  Tinyint,/* Senet-Çek Sahibi Grup No */\r\n  sck_nerede_cari_cins   Tinyint,/* Nerede Cari Cinsi 0:Carimiz 1:Cari Personelimiz 2:Bankamız 3:Hizmetimiz 4:Kasamız 5:Giderimiz 6:Muhasebe Hesabımız 7:Personelimiz 8:Demirbaşımız 9:İthalat Dosyamız 10:Finansal Sözleşmemiz */\r\n  sck_nerede_cari_kodu   Varchar(25),/* Nerede Cari Kodu */\r\n  sck_nerede_cari_grupno Tinyint,/* Nerede Grup No */\r\n  evrak_cari_cins        Tinyint,/* evrak Cari Cinsi 0:Carimiz 1:Cari Personelimiz 2:Bankamız 3:Hizmetimiz 4:Kasamız 5:Giderimiz 6:Muhasebe Hesabımız 7:Personelimiz 8:Demirbaşımız 9:İthalat Dosyamız 10:Finansal Sözleşmemiz */\r\n  evrak_cari_kodu        Varchar(25),/*evrak Cari Kodu */\r\n  evrak_cari_grupno      Tinyint,/*evrak Grup No */\r\n  sck_no                 Varchar(25),/* Senet Çek No */\r\n  sck_doviz_kur          Float,/* Döviz Kuru Bkz. DOVIZ_KURLARI */\r\n  sck_sonpoz             Tinyint,/* Senet Çek Pozisyonu 0:Portföyde 1:Ciro 2:Tahsilde 3:Teminatta 4:İade Edilen 5:Diğer3 6:Ödenmedi Portföyde 7:Ödenmedi İade 8:İcrada 9:Kısmen Ödendi 10:Ödendi */\r\n  sck_masraf1            Float,/* Masraf1 */\r\n  sck_imza               Tinyint\r\n  )\r\n  \r\n  \r\nAS\r\nBEGIN\r\n\r\n/*http://yardim.mye.com.tr/Library/Diger/DBYapisi_V12/Tablolar/odeme_emirleri.htm */\r\n\r\n/*http://yardim.mye.com.tr/Library/Diger/DBYapisi_V12/Tablolar/cari_hesap_hareketleri.htm */\r\n\r\n\r\n  insert into @TB_MIKRO_CEK\r\n  (cek_id,hrk_id,cek_drm,hrk_tarih,sck_iptal,sck_tip,sck_refno,\r\n  sck_ilk_evrak_seri,sck_ilk_evrak_sira_no,\r\n  sck_ilk_evrak_satir_no,\r\n  sck_bankano,sck_borclu,sck_vdaire_no,\r\n  sck_hesapno_sehir,sck_vade,sck_tutar,sck_doviz,\r\n  sck_banka_adres1,sck_sube_adres2,\r\n  sck_duzen_tarih,\r\n  sck_sahip_cari_cins,sck_sahip_cari_kodu,\r\n  sck_sahip_cari_grupno,sck_nerede_cari_cins,\r\n  sck_nerede_cari_kodu,sck_nerede_cari_grupno,\r\n  evrak_cari_cins,evrak_cari_kodu,evrak_cari_grupno,\r\n  sck_no,sck_doviz_kur,\r\n  sck_sonpoz,sck_masraf1,\r\n  sck_imza)\r\n\r\n  select m.cekid,\r\n  hrk_id=h.id,\r\n  cek_drm=h.drm,\r\n  hrk_tarih=h.tarih,\r\n  sck_iptal=case\r\n  when h.drm='PID' then 1\r\n  when m.sil=1 then 1\r\n  else 0 end,\r\n  sck_tip=case\r\n  when (m.islmhrk='ALN') then 0\r\n  when (m.islmhrk='KSN') then 2\r\n  end,\r\n\r\n  /*0:Müşteri Çeki 1:Müşteri Senedi 2:Kendi Çekimiz */\r\n  /*3:Kendi Senedimiz 4:Müşteri Havale Sözü 5:Müşteri Ödeme Sözü */\r\n  /*6:Müşteri Kredi Kartı 7:Kendi Havale Emrimiz 8:Kendi Ödeme Emrimiz 9:Kendi Kredi Kartımız */\r\n  m.refno as sck_refno,\r\n  sck_ilk_evrak_seri='CEK',\r\n  sck_ilk_evrak_sira_no=m.cekid,\r\n  sck_ilk_evrak_satir_no=0,/*m.id, */\r\n  sck_bankano=case\r\n  when m.islmhrk='KSN' then m.bankod\r\n  else '' end,\r\n  sck_borclu=case\r\n  when (m.islmhrk='ALN') and (m.cartip='carikart') then\r\n  (select top 1 substring(unvan,1,30) from carikart where kod=m.carkod and sil=0)\r\n  when (m.islmhrk='ALN') and (m.cartip='perkart') then\r\n  (select top 1 substring(ad+' '+soyad,1,30)  from perkart where kod=m.carkod and sil=0)\r\n  when (m.islmhrk='ALN') and (m.cartip='gelgidkart') then\r\n  (select top 1 substring(ad,1,30) from gelgidkart where kod=m.carkod and sil=0)\r\n  else\r\n  'FIRMA'\r\n  end,\r\n  substring(m.ack,1,50) as sck_vdaire_no,/*aciklama */\r\n  sck_hesapno_sehir=m.hesepno,\r\n  m.vadetar as sck_vade,\r\n  sck_tutar=case\r\n  when m.islmhrk='KSN' then m.cikan\r\n  when m.islmhrk='ALN' then m.giren\r\n  end,\r\n  0 as sck_doviz,\r\n  /*0 as sck_odenen, */\r\n  m.banka as sck_banka_adres1,\r\n  m.banksub as sck_sube_adres2,\r\n  m.tarih as sck_duzen_tarih,\r\n  /*when (m.islmtip='ALN') and (cartip='carikart') then 0 */\r\n  /* 0:Carimiz 1:Cari Personelimiz 2:Bankamız 3:Hizmetimiz 4:Kasamız 5:Giderimiz 6:Muhasebe Hesabımız 7:Personelimiz 8:Demirbaşımız 9:İthalat Dosyamız 10:Finansal Sözleşmemiz */\r\n  sck_sahip_cari_cins=case\r\n  when (m.islmhrk='ALN') and (m.cartip='carikart')  THEN 0 /*cari */\r\n  when (m.islmhrk='ALN') and (m.cartip='perkart') then 1 /*personel */\r\n  when (m.islmhrk='ALN') and (m.cartip='bankakart') then 2 /*banka */\r\n  when (m.islmhrk='ALN') and (m.cartip='kasakart') then 4 /*kasa */\r\n  when (m.islmhrk='ALN') and (m.cartip='gelgidkart') then 5 /* 5:Giderimiz */\r\n\r\n  when (m.islmhrk='KSN') then 2 /* banka */\r\n  end, /*0:Carimiz 1:Cari Personelimiz 2:Bankamız 3:Hizmetimiz 4:Kasamız */\r\n  sck_sahip_cari_kodu=case\r\n  when (m.islmhrk='ALN') then m.carkod\r\n  when (m.islmhrk='KSN') then m.bankod\r\n  end,\r\n\r\n  sck_sahip_cari_grupno=case\r\n  when (m.islmhrk='ALN') then 0\r\n  when (m.islmhrk='KSN') then 2 /* */\r\n  end,\r\n  \r\n  sck_nerede_cari_cins=case\r\n  when (h.drm='POR') then 4 /* kasada */\r\n  when (h.drm='KSN') then 0 /*caride */\r\n  when (h.drm='TAK') then 2 /* bankada */\r\n  when (h.drm='ODE') then 2 /* bankada */\r\n  end,\r\n  \r\n  sck_nerede_cari_kodu=case\r\n  when (h.drm='POR') then 'CEK' /* kasada */\r\n  when (h.drm='KSN') then h.carkod /*musteride */\r\n  when (h.drm='TAK') then h.carkod /*banka */\r\n  when (h.drm='ODE') then h.carkod /*banka */\r\n  \r\n  end,\r\n  0 as sck_nerede_cari_grupno,\r\n\r\n  evrak_cari_cins=case\r\n  /*takasa gonder cek kasasından cıkıyor */\r\n  when (h.drm='TAK') then 4 /* kasada */\r\n  when (h.drm='ODE') then 2 /* banka kesilen cek */\r\n  end,\r\n \r\n  evrak_cari_kodu=case\r\n  when (h.drm='TAK') then 'CEK' /* kasada */\r\n  when (h.drm='ODE') then h.carkod\r\n  end,\r\n  0 as evrak_cari_grupno,\r\n\r\n  sck_no=m.ceksenno,\r\n  kur as sck_doviz_kur,\r\n  sck_sonpoz=case\r\n  when h.drm='POR' THEN 0 /*0:Portföyde */\r\n  when h.drm='KSN' THEN 1\r\n  when h.drm='CIR' THEN 1 /*1:Ciro */\r\n  when h.drm='TAK' THEN 2 /*2:Tahsilde */\r\n  /*when drm='TEM' THEN 3 --3:Teminatta */\r\n  when h.drm='PID' THEN 4 /*4:İade Edilen */\r\n  when h.drm='TAK' THEN 5 /*5:Diğer3 */\r\n  when h.drm='PKR' THEN 6 /*6:Ödenmedi Portföyde */\r\n  when h.drm='PID' THEN 7 /*7:Ödenmedi İade */\r\n  /*when drm='TAK' THEN 8 --8:İcrada */\r\n  /*when drm='TAK' THEN 8 --8:Kısmen Ödendi */\r\n  when h.drm='ODE' THEN 10 /*10:Ödendi kesilen cek odeme kasadan */\r\n  when h.drm='ELT' THEN 10 /*alinan cek elden ödendi elden */\r\n  when h.drm='TKT' THEN 10 /*kesilen cek ödendiii bankadan */\r\n  end,\r\n  sck_masraf1=h.gidtutar,\r\n  sck_imza=case /* sahibi */\r\n  when m.islmhrk='KSN' then 0 /*kendimiz */\r\n  when m.islmhrk='ALN' then 0 /*müsteri */\r\n  end\r\n  from cekkart as m\r\n  inner join cekhrk h on\r\n  h.cekid=m.cekid where\r\n  h.sil=0 and m.sil=0\r\n  and m.tarih>=@bastar and m.tarih<=@bittar\r\n  order by m.cekid,h.id\r\n\r\n/*\r\n  while not (select top 1 count(cek_drm) from @TB_MIKRO_CEK\r\n  sub group by cek_id,cek_drm having count(cek_drm)>1)=0\r\n  begin\r\n  delete from @TB_MIKRO_CEK\r\n  where hrk_id in (select min(hrk_id) from @TB_MIKRO_CEK\r\n  sub group by cek_id,cek_drm having count(cek_drm)>1)\r\n \r\n  end\r\n */\r\n\r\n return\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "Udf_Mikro_Fatura_Cari",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.Udf_Mikro_Fatura_Cari",
    "definition": "CREATE FUNCTION [dbo].[Udf_Mikro_Fatura_Cari]\r\n(@Bastar DATETIME,\r\n@Bittar DATETIME)\r\nRETURNS\r\n  @TB_MIKRO_FATURA TABLE (\r\n  fat_id                 int,\r\n  cha_satir_no\t\t\t int,\r\n  cha_tarihi             datetime,\r\n  cha_tip                int,\r\n  cha_cinsi              int,\r\n  cha_normal_Iade        int,\r\n  cha_evrak_tip          int,\r\n  cha_evrakno_seri       Varchar(20),\r\n  cha_evrakno_sira       int,\r\n  cha_belge_no           Varchar(50),\r\n  cha_belge_tarih        datetime,\r\n  cha_cari_cins          int,\r\n  cha_kod                Varchar(30),\r\n  \r\n  cha_kasa_hizmet\t\t int,\r\n  cha_kasa_hizkod\t\t Varchar(25),\r\n  cha_miktari\t\t\t float,\r\n  \r\n  cha_ft_iskonto1\t\t float,\r\n  \r\n  cha_vergipntr\t\t\t int,\r\n  \r\n  \r\n  cha_d_kurtar           datetime,\r\n  cha_d_cins             int,\r\n  cha_d_kur              float,\r\n  cha_grupno             int,\r\n  cha_meblag             float,\r\n  cha_fis_tarih          datetime,\r\n  cha_fis_sirano         Int,\r\n  cha_vergi1             float,\r\n  cha_vergi2             float,\r\n  cha_vergi3             float,\r\n  cha_vergi4             float,\r\n  cha_vergi5             float,\r\n  cha_tpoz               int,\r\n  cha_aciklama           Varchar(100),\r\n  cha_sntck_poz          int,\r\n  cha_reftarihi          datetime,\r\n  cha_aratoplam          float,\r\n  cha_pos_hareketi       int,\r\n  cha_ciro_cari_kodu     Varchar(30)\r\n  )\r\nAS\r\nBEGIN\r\n\r\n/*http://yardim.mye.com.tr/Library/Diger/DBYapisi_V12/Tablolar/stok_hareketleri.htm */\r\n\r\n   declare @GEC_TEMP table\r\n   (Fatid\t\t\tint,\r\n    Micro_Stktip\tint\r\n   )\r\n   \r\n   \r\n   insert into @GEC_TEMP (Fatid,Micro_Stktip)\r\n   select h.fatid,h.Micro_Stktip from faturamas as m \r\n   inner join faturahrklistesi as h\r\n   on h.fatid=m.fatid and m.sil=0 and h.sil=0\r\n   and m.tarih>=@bastar and m.tarih <=@bittar\r\n   group by h.fatid,h.Micro_Stktip\r\n \r\n  insert into @TB_MIKRO_FATURA\r\n  (fat_id,cha_satir_no,cha_tarihi,cha_tip,cha_cinsi,cha_normal_Iade,cha_evrak_tip,\r\n  cha_evrakno_seri,cha_evrakno_sira,cha_belge_no,\r\n  cha_belge_tarih,cha_cari_cins,cha_kod,cha_d_kurtar,\r\n  cha_d_cins,cha_d_kur,cha_grupno,cha_meblag,\r\n  cha_fis_tarih,cha_fis_sirano,cha_vergi1,\r\n  cha_vergi2,cha_vergi3,cha_vergi4,cha_vergi5,\r\n  cha_tpoz,cha_aciklama,cha_sntck_poz,cha_reftarihi,\r\n  cha_aratoplam,cha_pos_hareketi,cha_ciro_cari_kodu,\r\n  cha_kasa_hizmet,cha_kasa_hizkod,cha_miktari,\r\n  cha_ft_iskonto1,cha_vergipntr )\r\n\r\n  select m.fatid,0,m.tarih as cha_tarihi,\r\n  cha_tip=case\r\n     when m.gctip=2 then  0\r\n     when m.gctip=1 then  1 end, /*0 borc ,1 alacak */\r\n     case  \r\n     when m.fattip_id=3 then  8\r\n     when m.fattip_id=6  then 8\r\n     else 6 end cha_cinsi,\r\n    \r\n    cha_normal_Iade=case\r\n     when (m.fattur_id<>3) then  0\r\n     when (m.fattur_id=3) then 1\r\n     end , /*0:Normal 1:İade */\r\n  cha_evrak_tip= case\r\n     when (m.gctip=1) then  0\r\n     when (m.gctip=2)  then 63 end, /*0:Alış Faturası , 63:Satış Faturası */\r\n  cha_evrakno_seri=m.fatseri,  /*Varchar(4) */\r\n  cha_evrakno_sira=m.fatid, /*m.fatno,  --integer */\r\n  cha_belge_no=m.fatseri+cast(m.fatno as varchar), /* Varchar(15) */\r\n  cha_belge_tarih=m.tarih,\r\n  cha_cari_cins=0,   /*0:Carimiz 1:Cari Personelimiz */\r\n  cha_kod= ck.muhonkod,  /*Varchar(25) */\r\n  cha_d_kurtar=m.tarih,    /*datetime */\r\n  cha_d_cins=1,     /*1 ytl ... */\r\n  cha_d_kur=1,      /* ytl 1 */\r\n  cha_grupno=0,    /*-**** 0 */\r\n  /*cha_meblag=(kdvtop+giderkdvtop),--kdv genel tutar */\r\n  cha_meblag=(genel_top),/*kdv genel tutar */\r\n  cha_fis_tarih=m.tarih,   /* */\r\n  cha_fis_sirano=0,   /*Integer */\r\n  cha_vergi1=0, /* 0 */\r\n  cha_vergi2=\r\n   isnull((select sum(kdvtut*(mik)) from faturahrklistesi as h\r\n    where h.Micro_Stktip=1 and  h.fatid=m.fatid and h.sil=0 and h.kdvyuz=0.01),0),/* %1 olanlar kdv tutarı */\r\n  cha_vergi3=\r\n    isnull((select sum(kdvtut*(mik)) from faturahrklistesi as h\r\n    where h.Micro_Stktip=1 and h.fatid=m.fatid and h.sil=0 and h.kdvyuz=0.08),0),/* %8 olanlar */\r\n  cha_vergi4=\r\n    isnull((select sum(kdvtut*(mik)) from faturahrklistesi as h\r\n    where h.Micro_Stktip=1 and h.sil=0 and h.fatid=m.fatid  and h.kdvyuz=0.18),0),/* %18 olanlar */\r\n  cha_vergi5=\r\n     isnull((select sum(kdvtut*(mik)) from faturahrklistesi as h\r\n    where h.Micro_Stktip=1 and h.sil=0 and h.fatid=m.fatid and h.kdvyuz=0.26),0),/* %26 olanlar */\r\n  cha_tpoz=0,          /*0:Açık 1:Kapalı */\r\n  cha_aciklama=SUBSTRING(m.ack,1,100),      /*Varchar(40) */\r\n  cha_sntck_poz=0,     /*0 olucak */\r\n  cha_reftarihi=m.tarih,   /* */\r\n  cha_aratoplam=((fattop-(satisktop+genisktop))+(gidertop+yuvtop)),/* kdvsiz toplam */\r\n  cha_pos_hareketi=0,  /* Bit pos harektimi */\r\n  cha_ciro_cari_kodu=ck.muhonkod,  /*Varchar(25) aynı Ciro Cari Kodu */\r\n  cha_kasa_hizmet=0,cha_kasa_hizkod='',\r\n  cha_miktari=0,\r\n  cha_ft_iskonto1=\r\n  isnull((select sum(h.Top_isk_Tut) from faturahrklistesi as h\r\n  where h.Micro_Stktip=1 and h.sil=0 and h.fatid=m.fatid),0),\r\n  cha_vergipntr=0\r\n  \r\n  \r\n  from faturamas as m \r\n  inner join Genel_Kart as ck \r\n  on ck.cartp=m.cartip and ck.kod=m.carkod   \r\n  Where sil=0 and len(m.fatseri)<7\r\n  and m.tarih>=@bastar and m.tarih <=@bittar\r\n  and m.fatid in (select fatid from @GEC_TEMP where Micro_Stktip=1 )\r\n  order by m.fatid\r\n  \r\n  /*gelgid */\r\n  \r\n  declare @Gelir_id int\r\n  \r\n  select @Gelir_id=id from grup where \r\n  tabload='gelgidkart' and ad='GELİR'\r\n  \r\n\r\n  \r\n  insert into @TB_MIKRO_FATURA\r\n  (fat_id,cha_satir_no,cha_tarihi,cha_tip,cha_cinsi,cha_normal_Iade,cha_evrak_tip,\r\n  cha_evrakno_seri,cha_evrakno_sira,cha_belge_no,\r\n  cha_belge_tarih,cha_cari_cins,cha_kod,cha_d_kurtar,\r\n  cha_d_cins,cha_d_kur,cha_grupno,cha_meblag,\r\n  cha_fis_tarih,cha_fis_sirano,cha_vergi1,\r\n  cha_vergi2,cha_vergi3,cha_vergi4,cha_vergi5,\r\n  cha_tpoz,cha_aciklama,cha_sntck_poz,cha_reftarihi,\r\n  cha_aratoplam,cha_pos_hareketi,cha_ciro_cari_kodu,\r\n  cha_kasa_hizmet,cha_kasa_hizkod,cha_miktari,cha_ft_iskonto1,\r\n  cha_vergipntr )\r\n\r\n  select m.fatid,fh.id,m.tarih as cha_tarihi,\r\n  cha_tip=case\r\n     when m.gctip=2 then  0\r\n     when m.gctip=1 then  1 end, /*0 borc ,1 alacak */\r\n     8 cha_cinsi,\r\n    \r\n    cha_normal_Iade=case\r\n     when (m.fattur_id<>3) then  0\r\n     when (m.fattur_id=3) then 1\r\n     end , /*0:Normal 1:İade */\r\n  cha_evrak_tip= case\r\n     when (m.gctip=1) then  0\r\n     when (m.gctip=2)  then 63 end, /*0:Alış Faturası , 63:Satış Faturası */\r\n  cha_evrakno_seri=m.fatseri,  /*Varchar(4) */\r\n  cha_evrakno_sira=m.fatid,  /*integer */\r\n  cha_belge_no=m.fatseri+cast(m.fatno as varchar), /* Varchar(15) */\r\n  cha_belge_tarih=m.tarih,\r\n  cha_cari_cins=0,   /*0:Carimiz 1:Cari Personelimiz */\r\n  cha_kod= ck.muhonkod,  /*Varchar(25) */\r\n  cha_d_kurtar=m.tarih,    /*datetime */\r\n  cha_d_cins=1,     /*1 tl ... */\r\n  cha_d_kur=1,      /* tl 1 */\r\n  cha_grupno=0,    /*-**** 0 */\r\n  /*cha_meblag=(kdvtop+giderkdvtop),--kdv genel tutar */\r\n  cha_meblag=\r\n  (((fh.brmfiy-(fh.genisktut+fh.satisktut))+fh.kdvtut)*fh.mik),/*kdv genel tutar */\r\n  cha_fis_tarih=m.tarih,   /* */\r\n  cha_fis_sirano=fh.id,   /*Integer */\r\n  cha_vergi1=0, /* 0 */\r\n  cha_vergi2=\r\n   isnull( case when fh.kdvyuz=0.01 then (kdvtut*(mik)) else 0 END,0),\r\n  cha_vergi3=\r\n    isnull( case when fh.kdvyuz=0.08 then (kdvtut*(mik)) else 0 END,0),\r\n  cha_vergi4=\r\n     isnull( case when fh.kdvyuz=0.18 then (kdvtut*(mik)) else 0 END,0),\r\n   cha_vergi5=\r\n    isnull( case when fh.kdvyuz=0.26 then (kdvtut*(mik)) else 0 END,0),\r\n  cha_tpoz=0,          /*0:Açık 1:Kapalı */\r\n  cha_aciklama=SUBSTRING(m.ack,1,100),      /*Varchar(40) */\r\n  cha_sntck_poz=0,     /*0 olucak */\r\n  cha_reftarihi=m.tarih,   /* */\r\n  cha_aratoplam=(fh.brmfiy*fh.mik),/* kdvsiz toplam */\r\n  cha_pos_hareketi=0,  /* Bit pos harektimi */\r\n  cha_ciro_cari_kodu=ck.muhonkod,  /*Varchar(25) aynı Ciro Cari Kodu */\r\n  cha_kasa_hizmet=case \r\n  when gk.grp1=@Gelir_id THEN 3 \r\n  else 5 end, \r\n  cha_kasa_hizkod=Gk.muhonkod,\r\n  cha_miktari=1,\r\n  cha_ft_iskonto1=fh.Top_isk_Tut,\r\n  cha_vergipntr=\r\n  isnull(case \r\n  when fh.kdvyuz=0.00 then 1 \r\n  when fh.kdvyuz=0.01 then 2 \r\n  when fh.kdvyuz=0.08 then 3 \r\n  when fh.kdvyuz=0.18 then 4\r\n  when fh.kdvyuz=0.26 then 5 \r\n  else 0 END,0)\r\n  \r\n  \r\n  from faturamas as m \r\n  inner join Genel_Kart as ck \r\n  on ck.cartp=m.cartip and ck.kod=m.carkod \r\n  inner join  faturahrklistesi as fh on \r\n  fh.fatid=m.fatid and fh.sil=0 and Micro_Stktip=2\r\n  \r\n  inner join Genel_Kart as Gk \r\n  on Gk.Tip_id=3 and Gk.kod=fh.stkod\r\n  \r\n  Where m.sil=0 and len(m.fatseri)<7\r\n  and m.tarih>=@bastar and m.tarih <=@bittar\r\n  order by m.fatid\r\n  \r\n  \r\n  update @TB_MIKRO_FATURA set cha_satir_no=0\r\n  where cha_satir_no in (select min(cha_satir_no) from \r\n  @TB_MIKRO_FATURA \r\n  group by fat_id Having MIN(cha_satir_no)>0)\r\n  \r\n   \r\n\r\n\r\n return\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "Udf_Mikro_Faturalan_Ver",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.Udf_Mikro_Faturalan_Ver",
    "definition": "CREATE FUNCTION [dbo].[Udf_Mikro_Faturalan_Ver]\r\n(@Bastar DATETIME,\r\n@Bittar DATETIME)\r\nRETURNS\r\n  @TB_MIKRO_FAT_VER TABLE (\r\n  fat_id                   int,\r\n  ver_id                   int\r\n)\r\nAS\r\nBEGIN\r\n\r\n/* http://yardim.mye.com.tr/Library/Diger/DBYapisi_V12/Tablolar/stok_hareketleri.htm */\r\n\r\n  insert into @TB_MIKRO_FAT_VER\r\n  (fat_id,ver_id)\r\n  \r\n    select m.fatid,h.verid \r\n    from faturamas as m\r\n    inner join veresimas as h on\r\n    h.fatid=m.fatid and h.sil=0\r\n    inner join Genel_Cari_Kart as car on\r\n    m.carkod=car.kod and m.cartip=car.cartip\r\n     where m.sil=0\r\n      and m.tarih>=@Bastar and m.tarih<=@Bittar\r\n    order by m.fatid\r\n\r\n\r\n\r\n\r\n RETURN\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "Udf_Mikro_Kasa_Hrk",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.Udf_Mikro_Kasa_Hrk",
    "definition": "CREATE FUNCTION [dbo].[Udf_Mikro_Kasa_Hrk]\r\n(@Bastar DATETIME,\r\n@Bittar DATETIME)\r\nRETURNS\r\n  @TB_MIKRO_FATURA TABLE (\r\n  hrk_id                 int,\r\n  cha_satir_no           int,\r\n  cha_tarihi             datetime,\r\n  cha_tip                int,\r\n  cha_cinsi              int,\r\n  cha_normal_Iade        int,\r\n  cha_evrak_tip          int,\r\n  cha_evrakno_seri       Varchar(20),\r\n  cha_evrakno_sira       int,\r\n  cha_belge_no           Varchar(50),\r\n  cha_belge_tarih        datetime,\r\n  cha_vade               datetime,\r\n  cha_cari_cins          int,\r\n  cha_kod                Varchar(30),\r\n  cha_kasa_hizmet        int,/*0:Carimiz 1:Cari Personelimiz 2:Bankamız 3:Hizmetimiz 4:Kasamız 5:Giderimiz 6:Muhasebe Hesabımız 7:Personelimiz 8:Demirbaşımız 9:İthalat Dosyamız 10:Finansal Sözleşmemiz */\r\n  cha_kasa_hizkod        Varchar(25),\r\n  cha_d_kurtar           datetime,\r\n  cha_d_cins             int,\r\n  cha_d_kur              float,\r\n  cha_grupno             int,\r\n  cha_meblag             float,\r\n  cha_fis_tarih          datetime,\r\n  cha_fis_sirano         Int,\r\n  cha_vergi1             float,\r\n  cha_vergi2             float,\r\n  cha_vergi3             float,\r\n  cha_vergi4             float,\r\n  cha_vergi5             float,\r\n  cha_tpoz               int,\r\n  cha_aciklama           Varchar(100),\r\n  cha_sntck_poz          int,\r\n  cha_reftarihi          datetime,\r\n  cha_aratoplam          float,\r\n  cha_pos_hareketi       int,\r\n  cha_ciro_cari_kodu     Varchar(30)\r\n  )\r\nAS\r\nBEGIN\r\n\r\n/*http://yardim.mye.com.tr/Library/Diger/DBYapisi_V12/Tablolar/cari_hesap_hareketleri.htm */\r\n/* islmtip TAH  TAHSILAT */\r\n/*islmhrk  ODE  ODEME */\r\n\r\n\r\n\r\n  insert into @TB_MIKRO_FATURA\r\n  (hrk_id,cha_satir_no,cha_tarihi,cha_tip,cha_cinsi,cha_normal_Iade,cha_evrak_tip,\r\n  cha_evrakno_seri,cha_evrakno_sira,cha_belge_no,\r\n  cha_belge_tarih,cha_vade,\r\n  cha_cari_cins,cha_kod,\r\n  cha_kasa_hizmet,cha_kasa_hizkod,\r\n  cha_d_kurtar,\r\n  cha_d_cins,cha_d_kur,cha_grupno,cha_meblag,\r\n  cha_fis_tarih,cha_fis_sirano,cha_vergi1,\r\n  cha_vergi2,cha_vergi3,cha_vergi4,cha_vergi5,\r\n  cha_tpoz,cha_aciklama,cha_sntck_poz,cha_reftarihi,\r\n  cha_aratoplam,cha_pos_hareketi,cha_ciro_cari_kodu )\r\n\r\n/*kasa için borc giren ,cikan alacak */\r\n/*tahsilat dekontu borc */\r\n/*tediye dekontu alacak */\r\n\r\n  select m.id,\r\n  m.id,m.tarih as cha_tarihi,\r\n  cha_tip=case\r\n     when (m.gctip='G' or m.gctip='A' ) then 1\r\n     when (m.gctip='C' or m.gctip='B' ) then  0 end, /*0 borc ,1 alacak--cariye gore */\r\n    cha_cinsi=case\r\n    when (m.islmhrk='VRC') or (m.islmhrk='VRG')  then\r\n    5\r\n    else\r\n    0 end,/*0:Nakit 1:Müşteri Çeki 2:Müşteri Senedi 3:Firma Çeki 4:Firma Senedi 5:Dekont */\r\n    cha_normal_Iade=0, /*0:Normal 1:İade */\r\n  cha_evrak_tip= case\r\n      when (m.islmtip='TAH') then  1\r\n     when (m.islmtip='ODE') then  64\r\n     when (m.islmhrk='VRC') or (m.islmhrk='VRG')  then  33 /*58 */\r\n     end,  /*1:tahsilat Faturası , 64:tediye odeme */\r\n  cha_evrakno_seri='KAS',  /*Varchar(4) */\r\n  cha_evrakno_sira=m.kashrkid,  /*integer */\r\n  cha_belge_no=m.belno, /* Varchar(15) */\r\n  cha_belge_tarih=m.tarih,\r\n  cha_vade=m.tarih,\r\n  cha_cari_cins=case\r\n   when (m.islmtip='TAH') and (m.cartip='carikart') then  0\r\n   when (m.islmtip='TAH') and (m.cartip='perkart') then  1\r\n   when (m.islmtip='ODE') and (m.cartip='carikart') then 0\r\n   when (m.islmtip='ODE') and (m.cartip='perkart') then  1\r\n   when m.cartip='bankakart' then  2\r\n   when (m.islmhrk='VRC') or (m.islmhrk='VRG')  then  4\r\n   end,\r\n   /*0:Carimiz 1:Cari Personelimiz 2:Bankamız 3:Hizmetimiz 4:Kasamız 5:Giderimiz 6:Muhasebe Hesabımız 7:Personelimiz 8:Demirbaşımız 9:İthalat Dosyamız 10:Finansal Sözleşmemiz */\r\n  cha_kod=case\r\n   when m.islmtip='TAH' then  m.carkod\r\n   when m.islmtip='ODE' then  m.carkod\r\n   when (m.islmhrk='VRC') or (m.islmhrk='VRG')  then m.kaskod\r\n   end,/*Varchar(25) */\r\n  cha_kasa_hizmet=case\r\n   when m.islmtip='TAH' then  4\r\n   when m.islmtip='ODE' then  4\r\n   when (m.islmhrk='VRC') or (m.islmhrk='VRG')  then 0\r\n   end,\r\n  /*0:Carimiz 1:Cari Personelimiz 2:Bankamız 3:Hizmetimiz 4:Kasamız 5:Giderimiz 6:Muhasebe Hesabımız 7:Personelimiz 8:Demirbaşımız 9:İthalat Dosyamız 10:Finansal Sözleşmemiz */\r\n  cha_kasa_hizkod=case\r\n   when m.islmtip='TAH' then  m.kaskod\r\n   when m.islmtip='ODE' then  m.kaskod\r\n   when (m.islmhrk='VRC') or (m.islmhrk='VRG')  then ''\r\n   end,\r\n  cha_d_kurtar=m.tarih,    /*datetime */\r\n  cha_d_cins=0,     /*0 ytl ... */\r\n  cha_d_kur=1,      /* ytl 1 */\r\n  cha_grupno=0,    /*-**** 0 */\r\n  cha_meblag=abs(giren-cikan),/*kdv genel tutar */\r\n  cha_fis_tarih=m.tarih,   /* */\r\n  cha_fis_sirano=0,   /*Integer */\r\n  cha_vergi1=0, /* 0 */\r\n  cha_vergi2=0,\r\n  cha_vergi3=0,\r\n  cha_vergi4=0,\r\n  cha_vergi5=0,\r\n  cha_tpoz=0,          /*0:Açık 1:Kapalı */\r\n  cha_aciklama=m.ack,      /*Varchar(40) */\r\n  cha_sntck_poz=0,     /*0 olucak */\r\n  cha_reftarihi=m.tarih,   /* */\r\n  cha_aratoplam=abs(giren-cikan),/* toplam */\r\n  cha_pos_hareketi=0,  /* Bit pos harektimi */\r\n  cha_ciro_cari_kodu=m.carkod  /*Varchar(25) aynı Ciro Cari Kodu */\r\n  from kasahrk as m Where sil=0\r\n  and m.tarih>=@bastar and m.tarih <=@bittar\r\n  and m.islmtip in ('TAH','ODE','VIR')\r\n  order by m.id\r\n\r\n\r\n return\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "Udf_Mikro_Stok_Hrk",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.Udf_Mikro_Stok_Hrk",
    "definition": "CREATE FUNCTION [dbo].Udf_Mikro_Stok_Hrk\r\n(@Bastar DATETIME,\r\n@Bittar DATETIME)\r\nRETURNS\r\n  @TB_MIKRO_STOK_HRK TABLE (\r\n  fat_id                   int,\r\n  Kap_Tip\t\t\t\t   Varchar(10),\r\n  sth_tarih                DateTime,\r\n  sth_tip                  Tinyint, /*Hareket Tipi 0:Giriş 1:Çıkış 2:Depo Transfer */\r\n  sth_cins                 Tinyint,/* Hareket Cinsi 0:Toptan 1:Perakende 2:Dış Ticaret 3:Stok Virman 4:Fire 5:Sarf 6:Transfer 7:Üretim 8:Fason 9:Değer Farkı 10:Sayım 11:Stok Açılış 12:İthalat-İhracat 13:Hal 14:Müstahsil 15:Müstahsil Değer Farkı 14:Kabzımal 15:Gider Pusulası */\r\n  sth_normal_iade          Tinyint, /*Normal/Iade? 0:Normal 1:İade */\r\n  sth_evraktip             Tinyint,/* Evrak Tipi 0:Depo Çıkış Fişi 1:Çıkış İrsaliyesi 2:Depo Transfer Fişi */\r\n                           /*3:Giriş Faturası 4:Çıkış Faturası 5:Stoklara İthalat Masraf Yansıtma Dekontu 6:Stok Virman Fişi 7:Üretim Giriş Çıkış Fişi 8:İlave Enflasyon Maliyet Fişi 9:Stoklara İlave Maliyet Yedirme Fişi 10:Antrepolardan Mal Millileştirme Fişi 11:Antrepolar Arası Transfer Fişi 12:Depo Giriş Fişi 13:Giriş İrsaliyesi 14:Fason Giriş Çıkış Fişi 15:Depolar Arası Satış Fişi 16:Stok Gider Pusulası Fişi */\r\n  sth_evrakno_seri         Varchar(6), /*Evrak Seri No */\r\n  sth_evrakno_sira         int, /*Evrak Sıra No */\r\n  sth_satirno              int, /*Hareket Satır No */\r\n  sth_belge_no             Varchar(20), /*Hareket Belge No */\r\n  sth_belge_tarih          DateTime, /*Hareket Belge Tarihi */\r\n  sth_stok_kod             Varchar(25),\r\n  sth_isk_mas1             Tinyint, /*İskonto Masraf Tipi */\r\n  sth_sat_iskmas1          int, /*Satır İskonto Masraf mı? */\r\n  sth_pos_satis            int, /*Pos Satışı mı? */\r\n  sth_cari_cinsi           Tinyint, /*Cari Cinsi */\r\n  sth_cari_kodu            Varchar(25),/* Cari Kodu */\r\n  sth_cari_grup_no         Tinyint, /*Cari Grup No */\r\n  sth_kur_tarihi           DateTime,/* Kur Tarihi */\r\n  sth_stok_doviz_cinsi     Tinyint,/* Stok Döviz Cinsi Bkz. DOVIZ_KURLARI */\r\n  sth_stok_doviz_kuru      Float,/* Stok Döviz Kuru */\r\n  sth_miktar               Float,/* Hareket Miktarı */\r\n  sth_birim_pntr           Tinyint,/*stok birirmi 0 olucak */\r\n  sth_tutar                Float,/* Hareket Tutarı */\r\n  sth_iskonto1             Float,/* 1.İskonto Miktarı */\r\n  sth_masraf1              Float,/* 1.Masraf Miktarı */\r\n  sth_vergi                Float,/* Hareket Vergi Oranı */\r\n  sth_masraf_vergi         Float,/* Masraf Vergi Oranı */\r\n  sth_aciklama             Varchar(50),/* Hareketle ilgili açıklama */\r\n  sth_fis_tarihi           DateTime,/* Fiş Tarihi */\r\n  sth_fis_sirano           int,/* Fiş Sıra No */\r\n  sth_vergi_pntr\t\t   int/*kdv oran id */\r\n\t\t\t\t\r\n)\r\nAS\r\nBEGIN\r\n\r\n/* http://yardim.mye.com.tr/Library/Diger/DBYapisi_V12/Tablolar/stok_hareketleri.htm */\r\n\r\n  insert into @TB_MIKRO_STOK_HRK\r\n  (fat_id,Kap_Tip,sth_tarih,sth_tip,sth_cins,sth_normal_iade,sth_evraktip,\r\n  sth_evrakno_seri,sth_evrakno_sira,sth_satirno,sth_belge_no,\r\n  sth_belge_tarih,sth_stok_kod,sth_isk_mas1,sth_sat_iskmas1,\r\n  sth_pos_satis,sth_cari_cinsi,sth_cari_kodu,sth_cari_grup_no,\r\n  sth_kur_tarihi,sth_stok_doviz_cinsi,sth_stok_doviz_kuru,\r\n  sth_miktar,sth_birim_pntr,sth_tutar,sth_iskonto1,\r\n  sth_masraf1,sth_vergi,sth_masraf_vergi,sth_aciklama,\r\n  sth_fis_tarihi,sth_fis_sirano,sth_vergi_pntr)\r\n  \r\n    select m.fatid,m.kaptip,\r\n    m.tarih as sth_tarih,\r\n    sth_tip=case\r\n     when (m.gctip=2)  then  1\r\n     when (m.gctip=1)  then   0 end, /*0:Giriş 1:Çıkış 2:Depo Transfer */\r\n   0 as sth_cins,/*Cinsi 0:Toptan 1:Perakende */\r\n    sth_normal_iade=case\r\n     when (m.fattur_id=1) or (m.fattur_id=2) then  0\r\n     when (m.fattur_id=3) then 1\r\n     end , /*0:Normal 1:İade */\r\n  sth_evraktip= case\r\n     when (m.gctip=1)  then  3\r\n     when (m.gctip=2)   then 4 end, /*3:Giriş Faturası 4:Çıkış Faturası */\r\n  sth_evrakno_seri=m.fatseri,  /*Varchar(4) */\r\n  sth_evrakno_sira=m.fatid,  /*integer */\r\n  sth_satirno=h.id,\r\n  sth_belge_no=m.fatseri+cast(m.fatno as varchar), /* Varchar(15) */\r\n  sth_belge_tarih=m.tarih,\r\n  sth_stok_kod=s.muhonkod,\r\n  sth_isk_mas1=0,\r\n  sth_sat_iskmas1=0, /*Satır İskonto Masraf mı? */\r\n  sth_pos_satis=0, /*Pos Satışı mı? */\r\n  sth_cari_cinsi=0, /*6 toptan fatura ,7 parakende faturası */\r\n  sth_cari_kodu=car.muhonkod,/* Cari Kodu */\r\n  sth_cari_grup_no=0,/*Cari Grup No */\r\n  sth_kur_tarihi=m.tarih,/* Kur Tarihi */\r\n  sth_stok_doviz_cinsi=0,/* Stok Döviz Cinsi Bkz. DOVIZ_KURLARI */\r\n  sth_stok_doviz_kuru=1,\r\n  sth_miktar=h.mik,/* Hareket Miktarı */\r\n  sth_birim_pntr=0,/*stok birirmi 0 olucak */\r\n  sth_tutar=h.mik*h.brmfiy,  /* Hareket Tutarı */\r\n  sth_iskonto1=(h.Top_isk_Tut),/* 1.İskonto Miktarı */\r\n  sth_masraf1=0,/* 1.Masraf Miktarı */\r\n  sth_vergi=h.kdvtut*h.mik,/* Hareket Vergi tutar */\r\n  sth_masraf_vergi=0,/* Masraf Vergi Oranı */\r\n  sth_aciklama=SUBSTRING(s.ad,1,50),/* Hareketle ilgili açıklama */\r\n  sth_fis_tarihi=m.tarih,/* Fiş Tarihi */\r\n  sth_fis_sirano=0,\r\n  sth_vergi_pntr=\r\n  isnull(case \r\n  when h.kdvyuz=0.00 then 1 \r\n  when h.kdvyuz=0.01 then 2 \r\n  when h.kdvyuz=0.08 then 3 \r\n  when h.kdvyuz=0.18 then 4\r\n  when h.kdvyuz=0.26 then 5 \r\n  else 0 END,0)\r\n  \r\n  \r\n  \r\n\r\n    from faturamas as m\r\n    inner join faturahrk as h on\r\n    h.fatid=m.fatid and h.sil=0\r\n    inner join gelgidlistok as s on\r\n    s.kod=h.stkod and s.tip=h.stktip\r\n    inner join Genel_Cari_Kart as car on\r\n    m.carkod=car.kod and m.cartip=car.cartip\r\n     where m.sil=0 and s.tip_id<>3\r\n     and len(m.fatseri)<7\r\n    and m.tarih>=@Bastar and m.tarih<=@Bittar\r\n    order by m.fatid\r\n\r\n\r\n\r\n\r\n RETURN\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "Udf_Mikro_Vardiya_Fatura_Hrk",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.Udf_Mikro_Vardiya_Fatura_Hrk",
    "definition": "CREATE FUNCTION [dbo].[Udf_Mikro_Vardiya_Fatura_Hrk]\r\n(@Tip Varchar(30),@Bastar DATETIME,\r\n@Bittar DATETIME)\r\nRETURNS\r\n  @TB_MIKRO_STOK_HRK TABLE (\r\n  fat_id                   int,\r\n  sth_tarih                DateTime,\r\n  sth_tip                  Tinyint, /*Hareket Tipi 0:Giriş 1:Çıkış 2:Depo Transfer */\r\n  sth_cins                 Tinyint,/* Hareket Cinsi 0:Toptan 1:Perakende 2:Dış Ticaret 3:Stok Virman 4:Fire 5:Sarf 6:Transfer 7:Üretim 8:Fason 9:Değer Farkı 10:Sayım 11:Stok Açılış 12:İthalat-İhracat 13:Hal 14:Müstahsil 15:Müstahsil Değer Farkı 14:Kabzımal 15:Gider Pusulası */\r\n  sth_normal_iade          Tinyint, /*Normal/Iade? 0:Normal 1:İade */\r\n  sth_evraktip             Tinyint,/* Evrak Tipi 0:Depo Çıkış Fişi 1:Çıkış İrsaliyesi 2:Depo Transfer Fişi */\r\n                           /*3:Giriş Faturası 4:Çıkış Faturası 5:Stoklara İthalat Masraf Yansıtma Dekontu 6:Stok Virman Fişi 7:Üretim Giriş Çıkış Fişi 8:İlave Enflasyon Maliyet Fişi 9:Stoklara İlave Maliyet Yedirme Fişi 10:Antrepolardan Mal Millileştirme Fişi 11:Antrepolar Arası Transfer Fişi 12:Depo Giriş Fişi 13:Giriş İrsaliyesi 14:Fason Giriş Çıkış Fişi 15:Depolar Arası Satış Fişi 16:Stok Gider Pusulası Fişi */\r\n  sth_evrakno_seri         Varchar(4), /*Evrak Seri No */\r\n  sth_evrakno_sira         int, /*Evrak Sıra No */\r\n  sth_satirno              int, /*Hareket Satır No */\r\n  sth_belge_no             Varchar(15), /*Hareket Belge No */\r\n  sth_belge_tarih          DateTime, /*Hareket Belge Tarihi */\r\n  sth_stok_kod             Varchar(25),\r\n  sth_isk_mas1             Tinyint, /*İskonto Masraf Tipi */\r\n  sth_sat_iskmas1          int, /*Satır İskonto Masraf mı? */\r\n  sth_pos_satis            int, /*Pos Satışı mı? */\r\n  sth_cari_cinsi           Tinyint, /*Cari Cinsi */\r\n  sth_cari_kodu            Varchar(25),/* Cari Kodu */\r\n  sth_cari_grup_no         Tinyint, /*Cari Grup No */\r\n  sth_kur_tarihi           DateTime,/* Kur Tarihi */\r\n  sth_stok_doviz_cinsi     Tinyint,/* Stok Döviz Cinsi Bkz. DOVIZ_KURLARI */\r\n  sth_stok_doviz_kuru      Float,/* Stok Döviz Kuru */\r\n  sth_miktar               Float,/* Hareket Miktarı */\r\n  sth_birim_pntr           Tinyint,/*stok birirmi 0 olucak */\r\n  sth_tutar                Float,/* Hareket Tutarı */\r\n  sth_iskonto1             Float,/* 1.İskonto Miktarı */\r\n  sth_masraf1              Float,/* 1.Masraf Miktarı */\r\n  sth_vergi                Float,/* Hareket Vergi Oranı */\r\n  sth_masraf_vergi         Float,/* Masraf Vergi Oranı */\r\n  sth_aciklama             Varchar(50),/* Hareketle ilgili açıklama */\r\n  sth_fis_tarihi           DateTime,/* Fiş Tarihi */\r\n  sth_fis_sirano           int,/* Fiş Sıra No */\r\n  sth_vergi_pntr\t\t   int/*kdv oran id */\r\n)\r\nAS\r\nBEGIN\r\n\r\n/* http://yardim.mye.com.tr/Library/Diger/DBYapisi_V12/Tablolar/stok_hareketleri.htm */\r\n\r\n  insert into @TB_MIKRO_STOK_HRK\r\n  (fat_id,sth_tarih,sth_tip,sth_cins,sth_normal_iade,sth_evraktip,\r\n  sth_evrakno_seri,sth_evrakno_sira,sth_satirno,sth_belge_no,\r\n  sth_belge_tarih,sth_stok_kod,sth_isk_mas1,sth_sat_iskmas1,\r\n  sth_pos_satis,sth_cari_cinsi,sth_cari_kodu,sth_cari_grup_no,\r\n  sth_kur_tarihi,sth_stok_doviz_cinsi,sth_stok_doviz_kuru,\r\n  sth_miktar,sth_birim_pntr,sth_tutar,sth_iskonto1,\r\n  sth_masraf1,sth_vergi,sth_masraf_vergi,sth_aciklama,\r\n  sth_fis_tarihi,sth_fis_sirano,sth_vergi_pntr)\r\n  \r\n   select h.varno,h.TARIH as sth_tarih,\r\n   sth_tip=1, /*0:Giriş 1:Çıkış 2:Depo Transfer */\r\n   1 as sth_cins,/*Cinsi 0:Toptan 1:Perakende */\r\n    sth_normal_iade=0, /*0:Normal 1:İade */\r\n  sth_evraktip=4, /*3:Giriş Faturası 4:Çıkış Faturası */\r\n  sth_evrakno_seri=CASE when @tip='pomvardimas' then 'PVR' else 'MVR' END,  /*Varchar(4) */\r\n  sth_evrakno_sira=h.varno,  /*integer */\r\n  sth_satirno=SK.Tip_id+sk.id,\r\n  sth_belge_no=CASE when @tip='pomvardimas' then 'PVR' else 'MVR' END+\r\n  cast(h.varno as varchar), /* Varchar(15) */\r\n  sth_belge_tarih=h.TARIH,\r\n  sth_stok_kod=sk.muhonkod,\r\n  sth_isk_mas1=0,\r\n  sth_sat_iskmas1=0, /*Satır İskonto Masraf mı? */\r\n  sth_pos_satis=0, /*Pos Satışı mı? */\r\n  sth_cari_cinsi=0, /*6 toptan fatura ,7 parakende faturası */\r\n  sth_cari_kodu=car.muhonkod,/* Cari Kodu */\r\n  sth_cari_grup_no=0,/*Cari Grup No */\r\n  sth_kur_tarihi=h.TARIH,/* Kur Tarihi */\r\n  sth_stok_doviz_cinsi=0,/* Stok Döviz Cinsi Bkz. DOVIZ_KURLARI */\r\n  sth_stok_doviz_kuru=1,\r\n  sth_miktar=h.STOK_MIKTAR,/* Hareket Miktarı */\r\n  sth_birim_pntr=0,/*stok birirmi 0 olucak */\r\n  sth_tutar=h.STOK_TUTARKDVSIZ,  /* Hareket Tutarı */\r\n  sth_iskonto1=0,/* 1.İskonto Miktarı */\r\n  sth_masraf1=0,/* 1.Masraf Miktarı */\r\n  sth_vergi=STOK_TUTARKDVLI-STOK_TUTARKDVSIZ,/* Hareket Vergi tutar */\r\n  sth_masraf_vergi=0,/* Masraf Vergi Oranı */\r\n  sth_aciklama=sk.ad,/* Hareketle ilgili açıklama */\r\n  sth_fis_tarihi=h.TARIH,/* Fiş Tarihi */\r\n  sth_fis_sirano=0,\r\n  sth_vergi_pntr=\r\n  isnull(case \r\n  when h.STOK_KDVYUZ=0.00 then 1 \r\n  when h.STOK_KDVYUZ=0.01 then 2 \r\n  when h.STOK_KDVYUZ=0.08 then 3 \r\n  when h.STOK_KDVYUZ=0.18 then 4\r\n  when h.STOK_KDVYUZ=0.26 then 5 \r\n  else 0 END,0)\r\n  \r\n  \r\n  \r\n\r\n    from UDF_PomVarNakitStokHrk (0,@Tip,@Bastar,@Bittar) as h\r\n    left join gelgidlistok as sk on sk.tip=h.STOK_TIP and sk.kod=h.STOK_KOD\r\n    inner join Genel_Cari_Kart as car on\r\n    h.carkod=car.kod and car.cartip='carikart'\r\n    order by h.varno\r\n\r\n\r\n\r\n\r\n RETURN\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "Udf_Mikro_Vardiya_Fatura_Mas",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.Udf_Mikro_Vardiya_Fatura_Mas",
    "definition": "CREATE FUNCTION [dbo].[Udf_Mikro_Vardiya_Fatura_Mas]\r\n(@Tip Varchar(30),@Bastar DATETIME,@Bittar DATETIME)\r\nRETURNS\r\n  @TB_MIKRO_FATURA TABLE (\r\n  fat_id                 int,\r\n  cha_satir_no\t\t\t int,\r\n  cha_tarihi             datetime,\r\n  cha_tip                int,\r\n  cha_cinsi              int,\r\n  cha_normal_Iade        int,\r\n  cha_evrak_tip          int,\r\n  cha_evrakno_seri       Varchar(20),\r\n  cha_evrakno_sira       int,\r\n  cha_belge_no           Varchar(50),\r\n  cha_belge_tarih        datetime,\r\n  cha_cari_cins          int,\r\n  cha_kod                Varchar(30),\r\n  \r\n  cha_kasa_hizmet\t\t int,\r\n  cha_kasa_hizkod\t\t Varchar(25),\r\n  cha_miktari\t\t\t float,\r\n  \r\n  cha_ft_iskonto1\t\t float,\r\n  \r\n  cha_vergipntr\t\t\t int,\r\n  \r\n  \r\n  cha_d_kurtar           datetime,\r\n  cha_d_cins             int,\r\n  cha_d_kur              float,\r\n  cha_grupno             int,\r\n  cha_meblag             float,\r\n  cha_fis_tarih          datetime,\r\n  cha_fis_sirano         Int,\r\n  cha_vergi1             float,\r\n  cha_vergi2             float,\r\n  cha_vergi3             float,\r\n  cha_vergi4             float,\r\n  cha_vergi5             float,\r\n  cha_tpoz               int,\r\n  cha_aciklama           Varchar(100),\r\n  cha_sntck_poz          int,\r\n  cha_reftarihi          datetime,\r\n  cha_aratoplam          float,\r\n  cha_pos_hareketi       int,\r\n  cha_ciro_cari_kodu     Varchar(30)\r\n  )\r\nAS\r\nBEGIN\r\n\r\n/*http://yardim.mye.com.tr/Library/Diger/DBYapisi_V12/Tablolar/stok_hareketleri.htm */\r\n\r\n   declare @GEC_TEMP table\r\n   (Fatid\t\t\tint,\r\n    Micro_Stktip\tint\r\n   )\r\n   \r\n  insert into @TB_MIKRO_FATURA\r\n  (fat_id,cha_satir_no,cha_tarihi,cha_tip,cha_cinsi,cha_normal_Iade,cha_evrak_tip,\r\n  cha_evrakno_seri,cha_evrakno_sira,cha_belge_no,\r\n  cha_belge_tarih,cha_cari_cins,cha_kod,cha_d_kurtar,\r\n  cha_d_cins,cha_d_kur,cha_grupno,cha_meblag,\r\n  cha_fis_tarih,cha_fis_sirano,cha_vergi1,\r\n  cha_vergi2,cha_vergi3,cha_vergi4,cha_vergi5,\r\n  cha_tpoz,cha_aciklama,cha_sntck_poz,cha_reftarihi,\r\n  cha_aratoplam,cha_pos_hareketi,cha_ciro_cari_kodu,\r\n  cha_kasa_hizmet,cha_kasa_hizkod,cha_miktari,\r\n  cha_ft_iskonto1,cha_vergipntr )\r\n\r\n  select m.varno,0,m.TARIH as cha_tarihi,\r\n  0 as cha_tip,6  cha_cinsi,\r\n  0 cha_normal_Iade, /*0:Normal 1:İade */\r\n  cha_evrak_tip=63, /*0:Alış Faturası , 63:Satış Faturası */\r\n  cha_evrakno_seri=\r\n  CASE when @tip='pomvardimas' then 'PVR' else 'MVR' END,  /*Varchar(4) */\r\n  cha_evrakno_sira=m.varno,  /*integer */\r\n  cha_belge_no=CASE when @tip='pomvardimas' then 'PVR' else 'MVR' END\r\n  +cast(m.varno as varchar), /* Varchar(15) */\r\n  cha_belge_tarih=m.TARIH,\r\n  cha_cari_cins=0,   /*0:Carimiz 1:Cari Personelimiz */\r\n  cha_kod= ck.muhonkod,  /*Varchar(25) */\r\n  cha_d_kurtar=m.TARIH,    /*datetime */\r\n  cha_d_cins=1,     /*1 ytl ... */\r\n  cha_d_kur=1,      /* ytl 1 */\r\n  cha_grupno=0,    /*-**** 0 */\r\n  /*cha_meblag=(kdvtop+giderkdvtop),--kdv genel tutar */\r\n  cha_meblag=sum(STOK_TUTARKDVLI),/*kdv genel tutar */\r\n  cha_fis_tarih=m.TARIH,   /* */\r\n  cha_fis_sirano=0,   /*Integer */\r\n  cha_vergi1=0, /* 0 */\r\n  cha_vergi2=\r\n   isnull((select sum(STOK_TUTARKDVLI-STOK_TUTARKDVSIZ) from UDF_PomVarNakitStokhrk (0,'pomvardimas',@Bastar,@Bittar) as h \r\n    where h.varno=m.varno and h.STOK_KDVYUZ=0.01),0),/* %1 olanlar kdv tutarı */\r\n  cha_vergi3=\r\n    isnull((select sum(STOK_TUTARKDVLI-STOK_TUTARKDVSIZ) from UDF_PomVarNakitStokhrk (0,'pomvardimas',@Bastar,@Bittar) as h\r\n    where h.varno=m.varno and h.STOK_KDVYUZ=0.08),0),/* %8 olanlar */\r\n  cha_vergi4=\r\n    isnull((select sum(STOK_TUTARKDVLI-STOK_TUTARKDVSIZ) from UDF_PomVarNakitStokhrk (0,'pomvardimas',@Bastar,@Bittar) as h\r\n    where  h.varno=m.varno  and h.STOK_KDVYUZ=0.18),0),/* %18 olanlar */\r\n  cha_vergi5=\r\n     isnull((select sum(STOK_TUTARKDVLI-STOK_TUTARKDVSIZ) from UDF_PomVarNakitStokhrk (0,'pomvardimas',@Bastar,@Bittar) as h\r\n    where h.varno=m.varno and h.STOK_KDVYUZ=0.26),0),/* %26 olanlar */\r\n  cha_tpoz=0,          /*0:Açık 1:Kapalı */\r\n  cha_aciklama=SUBSTRING(m.ack,1,100),      /*Varchar(40) */\r\n  cha_sntck_poz=0,     /*0 olucak */\r\n  cha_reftarihi=m.TARIH,   /* */\r\n  cha_aratoplam=sum(m.STOK_TUTARKDVSIZ),/* kdvsiz toplam */\r\n  cha_pos_hareketi=0,  /* Bit pos harektimi */\r\n  cha_ciro_cari_kodu=ck.muhonkod,  /*Varchar(25) aynı Ciro Cari Kodu */\r\n  cha_kasa_hizmet=0,cha_kasa_hizkod='',\r\n  cha_miktari=0,\r\n  cha_ft_iskonto1=0,\r\n  cha_vergipntr=0\r\n   \r\n  from UDF_PomVarNakitStokhrk (0,@Tip,@Bastar,@Bittar)  as m\r\n  left join Genel_Kart as ck on ck.cartp='carikart' \r\n  and ck.kod=m.CARKOD\r\n  group by m.varno,m.SERINO,m.TARIH,m.SAAT,m.CARKOD,m.ACK,\r\n  ck.kod,ck.muhonkod,ck.muhkod,ck.ad     \r\n  order by m.varno\r\n  \r\n  /*gelgid */\r\n  \r\n  declare @Gelir_id int\r\n  \r\n  select @Gelir_id=id from grup where \r\n  tabload='gelgidkart' and ad='GELİR'\r\n  \r\n\r\n  \r\n  update @TB_MIKRO_FATURA set cha_satir_no=0\r\n  where cha_satir_no in (select min(cha_satir_no) from \r\n  @TB_MIKRO_FATURA \r\n  group by fat_id Having MIN(cha_satir_no)>0)\r\n  \r\n  \r\n  \r\n  \r\n  \r\n\r\n\r\n return\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "Udf_Mikro_Vardiya_Virman",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.Udf_Mikro_Vardiya_Virman",
    "definition": "CREATE FUNCTION [dbo].[Udf_Mikro_Vardiya_Virman]\r\n(@Tip Varchar(30),@Bastar DATETIME,@Bittar DATETIME)\r\nRETURNS\r\n  @TB_MIKRO_VIRMAN TABLE (\r\n  fat_id                 int,\r\n  cha_satir_no\t\t\t int,\r\n  cha_tarihi             datetime,\r\n  cha_tip                int,\r\n  cha_cinsi              int,\r\n  cha_normal_Iade        int,\r\n  cha_evrak_tip          int,\r\n  cha_evrakno_seri       Varchar(20),\r\n  cha_evrakno_sira       int,\r\n  cha_belge_no           Varchar(50),\r\n  cha_belge_tarih        datetime,\r\n  cha_cari_cins          int,\r\n  cha_kod                Varchar(30),\r\n  cha_kasa_hizmet\t\t int,\r\n  cha_kasa_hizkod\t\t Varchar(25),\r\n  cha_miktari\t\t\t float,\r\n  cha_ft_iskonto1\t\t float,\r\n  cha_vergipntr\t\t\t int,\r\n  cha_d_kurtar           datetime,\r\n  cha_d_cins             int,\r\n  cha_d_kur              float,\r\n  cha_grupno             int,\r\n  cha_meblag             float,\r\n  cha_fis_tarih          datetime,\r\n  cha_fis_sirano         Int,\r\n  cha_tpoz               int,\r\n  cha_aciklama           Varchar(100),\r\n  cha_sntck_poz          int,\r\n  cha_reftarihi          datetime,\r\n  cha_aratoplam          float,\r\n  cha_pos_hareketi       int,\r\n  cha_ciro_cari_kodu     Varchar(30)\r\n  )\r\nAS\r\nBEGIN\r\n\r\n/*http://yardim.mye.com.tr/Library/Diger/DBYapisi_V12/Tablolar/stok_hareketleri.htm */\r\n\r\n  declare  @TB_MIKRO_TEMP TABLE (\r\n  fat_id                 int,\r\n  cha_satir_no\t\t\t int,\r\n  cha_tarihi             datetime,\r\n  cha_tip                int,\r\n  cha_cinsi              int,\r\n  cha_normal_Iade        int,\r\n  cha_evrak_tip          int,\r\n  cha_evrakno_seri       Varchar(20),\r\n  cha_evrakno_sira       int,\r\n  cha_belge_no           Varchar(50),\r\n  cha_belge_tarih        datetime,\r\n  cha_cari_cins          int,\r\n  cha_kod                Varchar(30),\r\n  cha_kasa_hizmet\t\t int,\r\n  cha_kasa_hizkod\t\t Varchar(25),\r\n  cha_miktari\t\t\t float,\r\n  cha_ft_iskonto1\t\t float,\r\n  cha_vergipntr\t\t\t int,\r\n  cha_d_kurtar           datetime,\r\n  cha_d_cins             int,\r\n  cha_d_kur              float,\r\n  cha_grupno             int,\r\n  cha_meblag             float,\r\n  cha_fis_tarih          datetime,\r\n  cha_fis_sirano         Int,\r\n  cha_tpoz               int,\r\n  cha_aciklama           Varchar(100),\r\n  cha_sntck_poz          int,\r\n  cha_reftarihi          datetime,\r\n  cha_aratoplam          float,\r\n  cha_pos_hareketi       int,\r\n  cha_ciro_cari_kodu     Varchar(30)\r\n  )\r\n\r\n\r\n\r\n\r\n declare @CAR_KOD  varchar(50) \r\n\r\n /*if @firmano=0   */\r\n  SELECT @CAR_KOD=zrap_carkod FROM sistemtanim\r\n\r\n\r\n /*-- kasa hrkleri */\r\n    \r\n  insert into @TB_MIKRO_TEMP\r\n  (fat_id,cha_satir_no,cha_tarihi,cha_tip,cha_cinsi,\r\n  cha_normal_Iade,cha_evrak_tip,\r\n  cha_evrakno_seri,cha_evrakno_sira,cha_belge_no,\r\n  cha_belge_tarih,cha_cari_cins,cha_kod,cha_d_kurtar,\r\n  cha_d_cins,cha_d_kur,cha_grupno,cha_meblag,\r\n  cha_fis_sirano,\r\n  cha_tpoz,cha_aciklama,cha_sntck_poz,cha_reftarihi,\r\n  cha_aratoplam,cha_pos_hareketi,cha_ciro_cari_kodu,\r\n  cha_kasa_hizmet,cha_kasa_hizkod,cha_miktari,\r\n  cha_ft_iskonto1,cha_vergipntr )\r\n\r\n  select m.varno,1,m.tarih as cha_tarihi,\r\n  1 as cha_tip,/*0 borc 1 alacak  */\r\n  5  cha_cinsi,\r\n  0 cha_normal_Iade, /*0:Normal 1:İade */\r\n  cha_evrak_tip=33, /*33:virman  */\r\n  cha_evrakno_seri='PVV',  /*Varchar(4) */\r\n  cha_evrakno_sira=m.varno,  /*integer */\r\n  cha_belge_no='PVV'+cast(m.varno as varchar),\r\n  cha_belge_tarih=m.tarih,\r\n  cha_cari_cins=2,   /*0:Carimiz 1:Cari Personelimiz 2:kasa 4 :banka */\r\n  cha_kod= ck.muhonkod,  /*Varchar(25) */\r\n  cha_d_kurtar=m.tarih,    /*datetime */\r\n  cha_d_cins=1,     /*1 tl ... */\r\n  cha_d_kur=1,      /*  1 */\r\n  cha_grupno=0,    /*-**** 0 */\r\n  cha_meblag=sum(giren),/*kdv genel tutar */\r\n  cha_fis_sirano=0,   /*Integer */\r\n  cha_tpoz=0,          /*0:Açık 1:Kapalı */\r\n  cha_aciklama='',      /*Varchar(40) */\r\n  cha_sntck_poz=0,     /*0 olucak */\r\n  cha_reftarihi=m.tarih,   /* */\r\n  cha_aratoplam=0,\r\n  cha_pos_hareketi=0,  /* Bit pos harektimi */\r\n  cha_ciro_cari_kodu=ck.muhonkod,  /*Varchar(25) aynı Ciro Cari Kodu */\r\n  cha_kasa_hizmet=0,\r\n  cha_kasa_hizkod='',\r\n  cha_miktari=0,\r\n  cha_ft_iskonto1=0,\r\n  cha_vergipntr=0\r\n   \r\n  from kasahrk  as m \r\n  left join Genel_Kart as ck on ck.cartp='kasakart' \r\n  and ck.kod=m.kaskod\r\n  where m.sil=0 and m.varno in \r\n  (select varno from pomvardimas where sil=0 and varok=1\r\n  and m.tarih>=@Bastar and m.tarih<=@Bittar)\r\n  and m.giren>0 \r\n  group by m.varno,m.tarih,m.kaskod,\r\n  ck.kod,ck.muhonkod,ck.muhkod,ck.ad     \r\n  order by m.varno\r\n    \r\n  \r\n  \r\n  \r\n  /*-- pos hrkleri */\r\n    \r\n  insert into @TB_MIKRO_TEMP\r\n  (fat_id,cha_satir_no,cha_tarihi,cha_tip,cha_cinsi,\r\n  cha_normal_Iade,cha_evrak_tip,\r\n  cha_evrakno_seri,cha_evrakno_sira,cha_belge_no,\r\n  cha_belge_tarih,cha_cari_cins,cha_kod,cha_d_kurtar,\r\n  cha_d_cins,cha_d_kur,cha_grupno,cha_meblag,\r\n  cha_fis_sirano,\r\n  cha_tpoz,cha_aciklama,cha_sntck_poz,cha_reftarihi,\r\n  cha_aratoplam,cha_pos_hareketi,cha_ciro_cari_kodu,\r\n  cha_kasa_hizmet,cha_kasa_hizkod,cha_miktari,\r\n  cha_ft_iskonto1,cha_vergipntr )\r\n\r\n  select m.varno,2,m.tarih as cha_tarihi,\r\n  1 as cha_tip,/*0 borc 1 alacak  */\r\n  5  cha_cinsi,\r\n  0 cha_normal_Iade, /*0:Normal 1:İade */\r\n  cha_evrak_tip=33, /*33:virman  */\r\n  cha_evrakno_seri='PVV',  /*Varchar(4) */\r\n  cha_evrakno_sira=m.varno,  /*integer */\r\n  cha_belge_no='PVV'+cast(m.varno as varchar),\r\n  cha_belge_tarih=m.tarih,\r\n  cha_cari_cins=4,   /*0:Carimiz 1:Cari Personelimiz 2:kasa 4 :banka */\r\n  cha_kod= ck.muhonkod,  /*Varchar(25) */\r\n  cha_d_kurtar=m.tarih,    /*datetime */\r\n  cha_d_cins=1,     /*1 tl ... */\r\n  cha_d_kur=1,      /*  1 */\r\n  cha_grupno=0,    /*-**** 0 */\r\n  cha_meblag=sum(giren),/*kdv genel tutar */\r\n  cha_fis_sirano=0,   /*Integer */\r\n  cha_tpoz=0,          /*0:Açık 1:Kapalı */\r\n  cha_aciklama='',      /*Varchar(40) */\r\n  cha_sntck_poz=0,     /*0 olucak */\r\n  cha_reftarihi=m.tarih,   /* */\r\n  cha_aratoplam=0,\r\n  cha_pos_hareketi=0,  /* Bit pos harektimi */\r\n  cha_ciro_cari_kodu=ck.muhonkod,  /*Varchar(25) aynı Ciro Cari Kodu */\r\n  cha_kasa_hizmet=0,\r\n  cha_kasa_hizkod='',\r\n  cha_miktari=0,\r\n  cha_ft_iskonto1=0,\r\n  cha_vergipntr=0\r\n   \r\n  from poshrk  as m \r\n  left join Genel_Kart as ck on ck.cartp='poskart' \r\n  and ck.kod=m.poskod\r\n  where m.sil=0 and m.varno in \r\n  (select varno from pomvardimas where sil=0 and varok=1\r\n  and m.tarih>=@Bastar and m.tarih<=@Bittar)\r\n  and m.giren>0 \r\n    group by m.varno,m.tarih,m.poskod,\r\n  ck.kod,ck.muhonkod,ck.muhkod,ck.ad     \r\n  order by m.varno\r\n  \r\n  \r\n  \r\n  \r\n  \r\n  \r\n  \r\n  \r\n  \r\n  /*-cari hrk  */\r\n  insert into @TB_MIKRO_TEMP\r\n  (fat_id,cha_satir_no,cha_tarihi,cha_tip,cha_cinsi,\r\n  cha_normal_Iade,cha_evrak_tip,\r\n  cha_evrakno_seri,cha_evrakno_sira,cha_belge_no,\r\n  cha_belge_tarih,cha_cari_cins,cha_kod,cha_d_kurtar,\r\n  cha_d_cins,cha_d_kur,cha_grupno,cha_meblag,\r\n  cha_fis_sirano,\r\n  cha_tpoz,cha_aciklama,cha_sntck_poz,cha_reftarihi,\r\n  cha_aratoplam,cha_pos_hareketi,cha_ciro_cari_kodu,\r\n  cha_kasa_hizmet,cha_kasa_hizkod,cha_miktari,\r\n  cha_ft_iskonto1,cha_vergipntr )\r\n  \r\n  select m.fat_id,0,m.cha_tarihi,\r\n  0 as cha_tip,/*0 borc 1 alacak  */\r\n  5  cha_cinsi,\r\n  0 cha_normal_Iade, /*0:Normal 1:İade */\r\n  cha_evrak_tip=33, /*33:virman  */\r\n  cha_evrakno_seri='PVV',  /*Varchar(4) */\r\n  cha_evrakno_sira=m.fat_id,  /*integer */\r\n  cha_belge_no='PVV'+cast(m.fat_id as varchar),\r\n  cha_belge_tarih=m.cha_tarihi,\r\n  cha_cari_cins=0,   /*0:Carimiz 1:Cari Personelimiz 2:kasa 4 :banka */\r\n  cha_kod= ck.muhonkod,  /*Varchar(25) */\r\n  cha_d_kurtar=m.cha_tarihi,    /*datetime */\r\n  cha_d_cins=1,     /*1 tl ... */\r\n  cha_d_kur=1,      /*  1 */\r\n  cha_grupno=0,    /*-**** 0 */\r\n  cha_meblag=sum(cha_meblag),/*kdv genel tutar */\r\n  cha_fis_sirano=0,   /*Integer */\r\n  cha_tpoz=0,          /*0:Açık 1:Kapalı */\r\n  cha_aciklama='',/*SUBSTRING(m.ack,1,100),      --Varchar(40) */\r\n  cha_sntck_poz=0,     /*0 olucak */\r\n  cha_reftarihi=m.cha_tarihi,   /* */\r\n  cha_aratoplam=0,\r\n  cha_pos_hareketi=0,  /* Bit pos harektimi */\r\n  cha_ciro_cari_kodu=ck.muhonkod,  /*Varchar(25) aynı Ciro Cari Kodu */\r\n  cha_kasa_hizmet=0,\r\n  cha_kasa_hizkod='',\r\n  cha_miktari=0,\r\n  cha_ft_iskonto1=0,\r\n  cha_vergipntr=0\r\n  \r\n  from @TB_MIKRO_TEMP  as m \r\n  left join Genel_Kart as ck on ck.cartp='carikart' \r\n  and ck.kod=@CAR_KOD\r\n  group by m.fat_id,m.cha_tarihi,\r\n  ck.kod,ck.muhonkod,ck.muhkod,ck.ad     \r\n  order by m.fat_id \r\n  \r\n  \r\n  insert into @TB_MIKRO_VIRMAN\r\n  (fat_id,cha_satir_no,cha_tarihi,cha_tip,cha_cinsi,\r\n  cha_normal_Iade,cha_evrak_tip,\r\n  cha_evrakno_seri,cha_evrakno_sira,cha_belge_no,\r\n  cha_belge_tarih,cha_cari_cins,cha_kod,cha_d_kurtar,\r\n  cha_d_cins,cha_d_kur,cha_grupno,cha_meblag,\r\n  cha_fis_sirano,\r\n  cha_tpoz,cha_aciklama,cha_sntck_poz,cha_reftarihi,\r\n  cha_aratoplam,cha_pos_hareketi,cha_ciro_cari_kodu,\r\n  cha_kasa_hizmet,cha_kasa_hizkod,cha_miktari,\r\n  cha_ft_iskonto1,cha_vergipntr )\r\n \r\n  select fat_id,cha_satir_no,cha_tarihi,cha_tip,cha_cinsi,\r\n  cha_normal_Iade,cha_evrak_tip,\r\n  cha_evrakno_seri,cha_evrakno_sira,cha_belge_no,\r\n  cha_belge_tarih,cha_cari_cins,cha_kod,cha_d_kurtar,\r\n  cha_d_cins,cha_d_kur,cha_grupno,cha_meblag,\r\n  cha_fis_sirano,\r\n  cha_tpoz,cha_aciklama,cha_sntck_poz,cha_reftarihi,\r\n  cha_aratoplam,cha_pos_hareketi,cha_ciro_cari_kodu,\r\n  cha_kasa_hizmet,cha_kasa_hizkod,cha_miktari,\r\n  cha_ft_iskonto1,cha_vergipntr from @TB_MIKRO_TEMP\r\n  order by cha_satir_no\r\n  \r\n   \r\n  \r\n  \r\n\r\n  \r\n return\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "Udf_Mikro_Veresiye_Hrk",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.Udf_Mikro_Veresiye_Hrk",
    "definition": "CREATE FUNCTION [dbo].Udf_Mikro_Veresiye_Hrk\r\n(@Bastar DATETIME,\r\n@Bittar DATETIME)\r\nRETURNS\r\n  @TB_MIKRO_STOK_HRK TABLE (\r\n  ver_id                   int,\r\n  fat_id                   int,\r\n  sth_tarih                DateTime,\r\n  sth_tip                  Tinyint, /*Hareket Tipi 0:Giriş 1:Çıkış 2:Depo Transfer */\r\n  sth_cins                 Tinyint,/* Hareket Cinsi 0:Toptan 1:Perakende 2:Dış Ticaret 3:Stok Virman 4:Fire 5:Sarf 6:Transfer 7:Üretim 8:Fason 9:Değer Farkı 10:Sayım 11:Stok Açılış 12:İthalat-İhracat 13:Hal 14:Müstahsil 15:Müstahsil Değer Farkı 14:Kabzımal 15:Gider Pusulası */\r\n  sth_normal_iade          Tinyint, /*Normal/Iade? 0:Normal 1:İade */\r\n  sth_evraktip             Tinyint,/* Evrak Tipi 0:Depo Çıkış Fişi 1:Çıkış İrsaliyesi 2:Depo Transfer Fişi */\r\n                           /*3:Giriş Faturası 4:Çıkış Faturası 5:Stoklara İthalat Masraf Yansıtma Dekontu 6:Stok Virman Fişi 7:Üretim Giriş Çıkış Fişi 8:İlave Enflasyon Maliyet Fişi 9:Stoklara İlave Maliyet Yedirme Fişi 10:Antrepolardan Mal Millileştirme Fişi 11:Antrepolar Arası Transfer Fişi 12:Depo Giriş Fişi 13:Giriş İrsaliyesi 14:Fason Giriş Çıkış Fişi 15:Depolar Arası Satış Fişi 16:Stok Gider Pusulası Fişi */\r\n  sth_evrakno_seri         Varchar(4), /*Evrak Seri No */\r\n  sth_evrakno_sira         int, /*Evrak Sıra No */\r\n  sth_satirno              int, /*Hareket Satır No */\r\n  sth_belge_no             Varchar(15), /*Hareket Belge No */\r\n  sth_belge_tarih          DateTime, /*Hareket Belge Tarihi */\r\n  sth_stok_kod             Varchar(25),\r\n  sth_isk_mas1             Tinyint, /*İskonto Masraf Tipi */\r\n  sth_sat_iskmas1          int, /*Satır İskonto Masraf mı? */\r\n  sth_pos_satis            int, /*Pos Satışı mı? */\r\n  sth_cari_cinsi           Tinyint, /*Cari Cinsi */\r\n  sth_cari_kodu            Varchar(25),/* Cari Kodu */\r\n  sth_cari_grup_no         Tinyint, /*Cari Grup No */\r\n  sth_kur_tarihi           DateTime,/* Kur Tarihi */\r\n  sth_stok_doviz_cinsi     Tinyint,/* Stok Döviz Cinsi Bkz. DOVIZ_KURLARI */\r\n  sth_stok_doviz_kuru      Float,/* Stok Döviz Kuru */\r\n  sth_miktar               Float,/* Hareket Miktarı */\r\n  sth_birim_pntr           Tinyint,/*stok birirmi 0 olucak */\r\n  sth_tutar                Float,/* Hareket Tutarı */\r\n  sth_iskonto1             Float,/* 1.İskonto Miktarı */\r\n  sth_masraf1              Float,/* 1.Masraf Miktarı */\r\n  sth_vergi                Float,/* Hareket Vergi Oranı */\r\n  sth_masraf_vergi         Float,/* Masraf Vergi Oranı */\r\n  sth_aciklama             Varchar(50),/* Hareketle ilgili açıklama */\r\n  sth_fis_tarihi           DateTime,/* Fiş Tarihi */\r\n  sth_fis_sirano           int,/* Fiş Sıra No */\r\n  sth_vergi_pntr\t\t   int/*kdv oran id */\r\n)\r\nAS\r\nBEGIN\r\n\r\n/* http://yardim.mye.com.tr/Library/Diger/DBYapisi_V12/Tablolar/stok_hareketleri.htm */\r\n\r\n  insert into @TB_MIKRO_STOK_HRK\r\n  (ver_id,fat_id,sth_tarih,sth_tip,sth_cins,sth_normal_iade,sth_evraktip,\r\n  sth_evrakno_seri,sth_evrakno_sira,sth_satirno,sth_belge_no,\r\n  sth_belge_tarih,sth_stok_kod,sth_isk_mas1,sth_sat_iskmas1,\r\n  sth_pos_satis,sth_cari_cinsi,sth_cari_kodu,sth_cari_grup_no,\r\n  sth_kur_tarihi,sth_stok_doviz_cinsi,sth_stok_doviz_kuru,\r\n  sth_miktar,sth_birim_pntr,sth_tutar,sth_iskonto1,\r\n  sth_masraf1,sth_vergi,sth_masraf_vergi,sth_aciklama,\r\n  sth_fis_tarihi,sth_fis_sirano,sth_vergi_pntr)\r\n  \r\n    select m.verid,m.fatid,m.tarih as sth_tarih,\r\n    sth_tip=case\r\n     when (m.gctip=2)  then  1\r\n     when (m.gctip=1)  then  0 end, /*0:Giriş 1:Çıkış 2:Depo Transfer */\r\n   1 as sth_cins,/*Cinsi 0:Toptan 1:Perakende */\r\n    sth_normal_iade=0 , /*0:Normal 1:İade */\r\n  sth_evraktip=1, /*3:Giriş Faturası 4:Çıkış Faturası */\r\n  sth_evrakno_seri=m.seri,  /*Varchar(4) */\r\n  sth_evrakno_sira=m.no,  /*integer */\r\n  sth_satirno=h.id,\r\n  sth_belge_no=m.seri+cast(m.no as varchar), /* Varchar(15) */\r\n  sth_belge_tarih=m.tarih,\r\n  sth_stok_kod=s.muhonkod,\r\n  sth_isk_mas1=0,\r\n  sth_sat_iskmas1=0, /*Satır İskonto Masraf mı? */\r\n  sth_pos_satis=0, /*Pos Satışı mı? */\r\n  sth_cari_cinsi=0, /*6 toptan fatura ,7 parakende faturası */\r\n  sth_cari_kodu=car.muhonkod,/* Cari Kodu */\r\n  sth_cari_grup_no=0,/*Cari Grup No */\r\n  sth_kur_tarihi=m.tarih,/* Kur Tarihi */\r\n  sth_stok_doviz_cinsi=0,/* Stok Döviz Cinsi Bkz. DOVIZ_KURLARI */\r\n  sth_stok_doviz_kuru=1,\r\n  sth_miktar=h.mik,/* Hareket Miktarı */\r\n  sth_birim_pntr=0,/*stok birirmi 0 olucak */\r\n  sth_tutar=h.mik*(h.brmfiy/(1+h.kdvyuz)),  /* Hareket Tutarı */\r\n  sth_iskonto1=h.mik*h.brmfiy-((brmfiy*(1-(iskyuz/100)))*mik),\r\n /* (h.Top_isk_Tut),-- 1.İskonto Miktarı */\r\n  sth_masraf1=0,/* 1.Masraf Miktarı */\r\n  sth_vergi=( (brmfiy*(1-(iskyuz/100)))-(brmfiy*(1-(iskyuz/100)))/(1+h.kdvyuz)\r\n  )*h.mik,/* Hareket Vergi tutar */\r\n  sth_masraf_vergi=0,/* Masraf Vergi Oranı */\r\n  sth_aciklama=s.ad,/* Hareketle ilgili açıklama */\r\n  sth_fis_tarihi=m.tarih,/* Fiş Tarihi */\r\n  sth_fis_sirano=0,\r\n  sth_vergi_pntr=\r\n  isnull(case \r\n  when h.kdvyuz=0.00 then 1 \r\n  when h.kdvyuz=0.01 then 2 \r\n  when h.kdvyuz=0.08 then 3 \r\n  when h.kdvyuz=0.18 then 4\r\n  when h.kdvyuz=0.26 then 5 \r\n  else 0 END,0)\r\n  \r\n  \r\n  \r\n\r\n    from veresimas as m\r\n    inner join veresihrk as h on\r\n    h.verid=m.verid and h.sil=0\r\n    inner join gelgidlistok as s on\r\n    s.kod=h.stkod and s.tip=h.stktip\r\n    inner join Genel_Cari_Kart as car on\r\n    m.carkod=car.kod and m.cartip=car.cartip\r\n     where m.sil=0 and s.tip_id<>3 and m.gctip=2\r\n     and len(m.seri)<4 and m.aktip in ('BK','BL')\r\n    and m.tarih>=@Bastar and m.tarih<=@Bittar\r\n    order by m.verid\r\n\r\n\r\n\r\n\r\n RETURN\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_OTOMASPDA_HRK",
    "type": "SQL_INLINE_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_OTOMASPDA_HRK",
    "definition": "CREATE FUNCTION dbo.UDF_OTOMASPDA_HRK\r\n(@otomasid int)\r\nRETURNS TABLE AS\r\nRETURN(select hrk.id as id,\r\nhrk.otomasid,\r\nhrk.Sayac_Kod as SAYAC_KOD,hrk.Stok_Kod AS STOK_KOD,\r\ns_tnk.tank_kod as TANK_KOD,Per_Kod AS PERSONEL_KOD,\r\nLitre AS LITRE,Birim_Fiyat as BIRIM_FIYAT,\r\nTutar AS TUTAR,tarih,saat,Kayit_Tar_Saat\r\nfrom otomaspumphrk AS hrk\r\ninner join sayac_tanklistesi as s_tnk on s_tnk.sayac_kod=hrk.Sayac_Kod\r\nwhere hrk.otomasid>@otomasid)"
  },
  {
    "schema": "dbo",
    "name": "UDF_OTOMASTANK_TOP",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_OTOMASTANK_TOP",
    "definition": "CREATE FUNCTION [dbo].UDF_OTOMASTANK_TOP (@TARIH DATETIME)\r\nRETURNS\r\n  @TB_TANK_EKSTRE TABLE (\r\n    TANK_KOD    VARCHAR(20)  COLLATE Turkish_CI_AS,\r\n    TANK_AD     VARCHAR(50)  COLLATE Turkish_CI_AS,\r\n    KAPASITE    FLOAT,\r\n    MEVCUT      FLOAT,\r\n    YUZDE       INT)\r\nAS\r\nBEGIN\r\n  DECLARE @TANK_TEMP TABLE (\r\n    TANK_KOD    VARCHAR(20)  COLLATE Turkish_CI_AS,\r\n    TANK_AD     VARCHAR(50)  COLLATE Turkish_CI_AS,\r\n    KAPASITE    FLOAT,\r\n    MEVCUT      FLOAT,\r\n    YUZDE       INT)\r\n\r\n  DECLARE @HRK_TANK_KOD    VARCHAR(20)\r\n  DECLARE @HRK_TANK_AD     VARCHAR(50)\r\n  DECLARE @HRK_KAPASITE    FLOAT\r\n  DECLARE @HRK_MEVCUT      FLOAT\r\n  DECLARE @HRK_YUZDE       FLOAT\r\n\r\n  DECLARE CRS_HRK CURSOR FAST_FORWARD FOR\r\n    SELECT k.kod,k.ad,k.kapsit,k.alsmik-k.satmik FROM tankkart as k where k.sil=0\r\n    OPEN CRS_HRK\r\n\r\n   FETCH NEXT FROM CRS_HRK INTO\r\n   @HRK_TANK_KOD,@HRK_TANK_AD,@HRK_KAPASITE,@HRK_MEVCUT\r\n   WHILE @@FETCH_STATUS = 0\r\n    BEGIN\r\n\r\n    SET @HRK_MEVCUT=@HRK_MEVCUT+isnull((select sum(litre) from otomasxml as x\r\n    inner JOIN sayackart as s on x.Sayac_Kod=s.kod and s.tankod=@HRK_TANK_KOD),0)\r\n\r\n    SET @HRK_YUZDE=0\r\n    IF @HRK_KAPASITE>0 AND @HRK_MEVCUT>0\r\n    SET @HRK_YUZDE=(@HRK_MEVCUT*100)/@HRK_KAPASITE\r\n\r\n    INSERT @TANK_TEMP\r\n      SELECT\r\n       @HRK_TANK_KOD,@HRK_TANK_AD,@HRK_KAPASITE,@HRK_MEVCUT,@HRK_YUZDE\r\n\r\n    FETCH NEXT FROM CRS_HRK INTO\r\n     @HRK_TANK_KOD,@HRK_TANK_AD,@HRK_KAPASITE,@HRK_MEVCUT\r\n  END\r\n\r\n  CLOSE CRS_HRK\r\n  DEALLOCATE CRS_HRK\r\n\r\n  /*---------------------------------------------------------------------------- */\r\n\r\n  INSERT @TB_TANK_EKSTRE\r\n    SELECT TANK_KOD,TANK_AD,KAPASITE,MEVCUT,YUZDE FROM @TANK_TEMP\r\n\r\n\r\n  RETURN\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_POM_SAYAC_STOK",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_POM_SAYAC_STOK",
    "definition": "CREATE FUNCTION [dbo].UDF_POM_SAYAC_STOK (@firmano int,@varno int)\r\nRETURNS\r\n  @TB_POM_SAYACSTOK TABLE (\r\n  [firmano]         int,\r\n  [varno]           int,\r\n  [kod]             varchar(30) COLLATE Turkish_CI_AS NOT NULL,\r\n  [stktip]          varchar(10) COLLATE Turkish_CI_AS NULL,\r\n  [acmik]           float,\r\n  [satmik]          float,\r\n  [kalan]           float,\r\n  [brimfiy]         float,\r\n  [tutar]           float,\r\n  [testmik]         float,\r\n  [transfermik]     float,\r\n  [kdvyuz]          float)\r\n AS\r\n BEGIN\r\n \r\n declare @kod      varchar(20)\r\n declare @stktip   varchar(10)\r\n declare @kdvyuz   float\r\n declare @brimfiy  float\r\n declare @satismik float\r\n\r\n\r\n /*-- stok son durumları */\r\n  DECLARE @TB_DEP_TARIH TABLE (\r\n    VAR_NO     FLOAT,\r\n    DEP_KOD    VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    STOK_TIP   VARCHAR(10) COLLATE Turkish_CI_AS,\r\n    STOK_KOD   VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    MIKTAR     FLOAT,\r\n    TUTAR      FLOAT)\r\n   INSERT INTO @TB_DEP_TARIH\r\n   SELECT * FROM DBO.DEPO_TARIHLI_STOKIN ('pomvardimas',@varno)\r\n/*--stok son durumları */\r\n\r\n\r\n DECLARE POM_SAYACSTOK CURSOR FAST_FORWARD FOR\r\n SELECT s.stkod,s.stktip,s.kdvyuz,\r\n avg(s.brimfiy),sum(s.satmik+s.testmik+s.transfermik+s.digermik)\r\n FROM pomvardisayac as s\r\n where varno=@varno\r\n group by s.stkod,s.stktip,s.kdvyuz,\r\n s.brimfiy\r\n \r\n OPEN POM_SAYACSTOK\r\n FETCH NEXT FROM POM_SAYACSTOK INTO  @kod,@stktip,@kdvyuz,@brimfiy,@satismik\r\n WHILE @@FETCH_STATUS = 0\r\n BEGIN\r\n \r\n   insert into @TB_POM_SAYACSTOK\r\n   (kod,acmik,satmik,kalan,brimfiy,tutar,stktip,kdvyuz)\r\n   values\r\n   (@kod,0,@satismik,0,@brimfiy,@satismik*@brimfiy,@stktip,@kdvyuz)\r\n\r\n  /*  insert into pomvarditank (varno,kod,acmik,satmik,kalan,brimfiy,tutar,stkod,stktip,kdvyuz) */\r\n  /*  values  (@varno,@tankkod,@stkkalan,0,@tankkalan,@satfiy,@tankkalan*@satfiy,@kod,@stktip,@kdvyuz/100); */\r\n\r\n\r\n FETCH NEXT FROM POM_SAYACSTOK INTO  @kod,@stktip,@kdvyuz,@brimfiy,@satismik\r\n\r\n END\r\n CLOSE POM_SAYACSTOK\r\n DEALLOCATE POM_SAYACSTOK\r\n \r\n RETURN\r\n\r\n\r\n END"
  },
  {
    "schema": "dbo",
    "name": "UDF_POMPACI_ZRAPOR_HAZIRLA",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_POMPACI_ZRAPOR_HAZIRLA",
    "definition": "CREATE FUNCTION dbo.[UDF_POMPACI_ZRAPOR_HAZIRLA] \r\n(@VarNoIn varchar(500))\r\nRETURNS\r\n   \r\n   @TABLE_SAYAC_ZRAPOR TABLE (\r\n   Id\t\t\t\t\t    int IDENTITY(1, 1), \r\n   Firmano                  int,  \r\n   ZTip  \t\t\t\t\tVARCHAR(20) COLLATE Turkish_CI_AS,\r\n   CariKod\t\t\t\t\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n   Tarih\t\t\t\t\tdatetime,\r\n   ZSeri\t\t\t\t\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n   ZNo\t\t    \t\t\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n   YKKod     \t\t\t\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n   YkAd\t                    Varchar(50) COLLATE Turkish_CI_AS,\r\n   StokKod\t\t\t\t\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n   KdvYuzde\t\t\t\t\tFloat,\r\n   Fiyat\t\t\t\t\tFloat,\r\n   Miktar\t\t\t\t\tFloat,\r\n   Tutar\t\t\t\t\tFloat\r\n   )\r\n   \r\nAS\r\nBEGIN\r\n  \r\n    DECLARE @EKSTRE_TEMP TABLE (\r\n    SayacKod      Varchar(30) COLLATE Turkish_CI_AS,\r\n    StokKod\t      Varchar(30) COLLATE Turkish_CI_AS,\r\n    YkKod\t      Varchar(30) COLLATE Turkish_CI_AS,\t\t\r\n    YkAd\t      Varchar(50) COLLATE Turkish_CI_AS,\r\n    KdvYuzde\t  Float,\r\n    Fiyat         Float,\r\n    Miktar \t\t  Float,\r\n    Tutar         Float)\r\n\r\n    Declare @Tarih  Datetime\r\n    Declare @FirmaNo  int\r\n    declare @CariKod\t      Varchar(50)\r\n    \r\n    \r\n\r\n\r\n    Select @FirmaNo=Max(Firmano),@Tarih=MAX(Tarih) From PomVardimas with (nolock) \r\n    Where varno in (select * from CsvToInt(@VarNoIn))\r\n\r\n\r\n    select @CariKod=ZraporCariKod From Firma Where id=@FirmaNo\r\n\r\n\r\n\r\n    insert into @EKSTRE_TEMP \r\n    (SayacKod,StokKod,KdvYuzde,Fiyat,Miktar,Tutar)\r\n    SELECT p.SayacKod,p.stkod,p.kdvyuz,\r\n    case when sum(satmik)>0 \r\n    then sum(P.satmik*p.brimfiy)/sum(p.satmik) else 0 end,\r\n    sum(P.satmik),sum(p.satmik*p.brimfiy)\r\n    FROM  pomvardisayac AS p  with (nolock)\r\n    where p.varno in (select * from CsvToInt(@VarNoIn))\r\n    and satmik>0\r\n    group by P.SayacKod,p.stkod,p.kdvyuz\r\n    \r\n    \r\n    update @EKSTRE_TEMP set YKKod=dt.YKKod from @EKSTRE_TEMP as t\r\n    join (select Kod,ykkod from sayackart as c \r\n    where c.sil=0) dt \r\n    on dt.Kod=t.SayacKod\r\n    \r\n    update @EKSTRE_TEMP set YkAd=dt.Ad from @EKSTRE_TEMP as t\r\n    join (select Kod,Ad from yazarkasakart as c \r\n    where c.sil=0) dt on dt.Kod=t.YKKod\r\n  \r\n    \r\n  \r\n  insert into @TABLE_SAYAC_ZRAPOR \r\n  (Firmano,CariKod,Tarih,YKKod,YkAd,StokKod,KdvYuzde,Fiyat,Miktar,Tutar) \r\n  Select @FirmaNo,@CariKod,@Tarih,YKKod,YkAd,StokKod,KdvYuzde,\r\n  round(case When Sum(Miktar)>0 then Sum(Tutar)/Sum(Miktar) else 0 end,8) Fiyat,\r\n  Sum(Miktar),Sum(Tutar) From @EKSTRE_TEMP\r\n  Group by YKKod,YkAd,StokKod,KdvYuzde\r\n  \r\n\r\n  update @TABLE_SAYAC_ZRAPOR set ZSeri=dt.zseri,ZNo= cast( isnull(Dt.zserino,0) as int)+1 \r\n    from @TABLE_SAYAC_ZRAPOR as t\r\n    join (select ykkod,zseri,zserino from zrapormas as c with (nolock)  where \r\n    id in (Select max(id) id  From zrapormas as z with (nolock) \r\n    Where z.sil=0 and z.firmano=@FirmaNo group by ykkod )\r\n    ) dt on dt.ykkod=t.YKKod \r\n\r\n\r\n\r\n  return\r\n\r\n\r\n\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_PomVarNakitStokHrk",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_PomVarNakitStokHrk",
    "definition": "CREATE FUNCTION [dbo].[UDF_PomVarNakitStokHrk] (\r\n@firmano           int,\r\n@TIPIN\t\t\t   VARCHAR(30),\r\n@BASTARIH          DATETIME,\r\n@BITTARIH          DATETIME)\r\nRETURNS\r\n   @TB_STOK TABLE (\r\n    FIRMANO\t\t\t\t INT,\r\n    VARNO \t\t\t\t INT,\r\n    SERINO\t\t\t\t INT,\r\n    TARIH                DATETIME,\r\n    SAAT             \t VARCHAR(10) COLLATE Turkish_CI_AS,\r\n    CARKOD\t\t\t\t VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    STOK_TIP             VARCHAR(10) COLLATE Turkish_CI_AS,\r\n    STOK_KOD             VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    STOK_BRIM            VARCHAR(10) COLLATE Turkish_CI_AS,\r\n    STOK_KDVYUZ          FLOAT,\r\n    STOK_MIKTAR          FLOAT,\r\n    STOK_BRMKDVLI        FLOAT,\r\n    STOK_BRMKDVSIZ       FLOAT,\r\n    STOK_TUTARKDVLI  \t FLOAT,\r\n    STOK_TUTARKDVSIZ\t FLOAT,\r\n    ACK                  VARCHAR(100) COLLATE Turkish_CI_AS,\r\n    OLUSTARSAAT          DATETIME)\r\nAS\r\nBEGIN\r\n\r\n    DECLARE @FIRMA    \t\t  int\r\n    DECLARE @VARNO \t\t\t\t  int\r\n    DECLARE @SERINO  \t\t\t  int\r\n    DECLARE @TARIH \t\t\t\t  DATETIME\r\n    DECLARE @SAAT\t\t\t\t  VARCHAR(10) \r\n    DECLARE @STOK_TIP             VARCHAR(10) \r\n    DECLARE @STOK_KOD             VARCHAR(30)\r\n    DECLARE @STOK_BRIM            VARCHAR(10) \r\n    DECLARE @STOK_KDVYUZ          FLOAT\r\n    DECLARE @STOK_MIKTAR          FLOAT\r\n    DECLARE @STOK_BRMKDVLI\t\t  FLOAT\r\n    DECLARE @STOK_BRMKDVSIZ\t\t  FLOAT\r\n    DECLARE @STOK_TUTARKDVLI\t  FLOAT\r\n    DECLARE @STOK_TUTARKDVSIZ\t  FLOAT\r\n    DECLARE @ACK                  VARCHAR(100) \r\n    DECLARE @OLUSTARSAAT     \t  DATETIME\r\n\r\n\r\n   DECLARE @CAR_KOD             VARCHAR(30) \r\n   \r\n \r\n if @firmano=0  \r\n  SELECT @CAR_KOD=zrap_carkod FROM sistemtanim\r\n\r\n\r\n if @firmano>0  \r\n  SELECT @CAR_KOD=Entegre_ZraporOnMuhKod FROM Firma where id=@firmano\r\n\r\n\r\n if @TIPIN='pomvardimas'\r\n  begin\r\n  if @firmano=0  \r\n   DECLARE VARDI_STOK CURSOR FAST_FORWARD FOR\r\n    SELECT p.firmano,p.varno,p.kaptar,p.kapsaat,p.varad,p.olustarsaat,\r\n    ps.stktip,ps.stkod,max(ps.kdvyuz),\r\n    sum(ps.satmik),sum(ps.tutar)\r\n    from pomvardimas as p with (nolock)\r\n    inner join pomvardisayac as ps with (nolock)\r\n     on ps.varno=p.varno and p.sil=0 and p.varok=1 /*and p.firmano=@Firmano */\r\n      and p.kaptar>=@BASTARIH and p.kaptar<=@BITTARIH  \r\n      group by p.firmano,p.varno,p.kaptar,p.kapsaat,p.varad,p.olustarsaat,\r\n      ps.stktip,ps.stkod\r\n      order by p.varno\r\n      \r\n      \r\n   if @firmano>0  \r\n   DECLARE VARDI_STOK CURSOR FAST_FORWARD FOR\r\n    SELECT p.firmano,p.varno,p.kaptar,p.kapsaat,p.varad,p.olustarsaat,\r\n    ps.stktip,ps.stkod,max(ps.kdvyuz),\r\n    sum(ps.satmik),sum(ps.tutar)\r\n    from pomvardimas as p with (nolock)\r\n    inner join pomvardisayac as ps with (nolock) \r\n     on ps.varno=p.varno and p.sil=0 and p.varok=1 and p.firmano in (0,@Firmano)\r\n      and p.kaptar>=@BASTARIH and p.kaptar<=@BITTARIH  \r\n      group by p.firmano,p.varno,p.kaptar,p.kapsaat,p.varad,p.olustarsaat,\r\n      ps.stktip,ps.stkod\r\n      order by p.varno \r\n      \r\n      \r\n   end    \r\n   \r\n  \r\n   if @TIPIN='marvardimas'\r\n   begin \r\n   if @firmano=0  \r\n    DECLARE VARDI_STOK CURSOR FAST_FORWARD FOR\r\n    SELECT p.firmano,p.varno,p.kaptar,p.kapsaat,p.varad,p.olustarsaat,\r\n    ps.stktip,ps.stkod,max(ps.kdvyuz),\r\n    sum(case when ps.islmtip='satis' then ps.mik else -1*ps.mik end),\r\n    sum(case when ps.islmtip='satis' then ps.mik else -1*ps.mik end *ps.brmfiy)\r\n    from marvardimas as p with (nolock)\r\n    inner join marsatmas as pm with (nolock)\r\n    on pm.varno=p.varno and pm.sil=0  /*and pm.firmano=@Firmano */\r\n    inner join marsathrk as ps  with (nolock)\r\n     on ps.varno=p.varno and pm.marsatid=ps.marsatid and p.sil=0 and p.varok=1\r\n      and p.kaptar>=@BASTARIH and p.kaptar<=@BITTARIH and pm.sil=0 and ps.sil=0 \r\n      group by p.firmano,p.varno,p.kaptar,p.kapsaat,p.varad,p.olustarsaat,\r\n      ps.stktip,ps.stkod\r\n      having ABS(sum(case when ps.islmtip='satis' then ps.mik else -1*ps.mik end))>0\r\n      order by p.varno\r\n      \r\n    if @firmano>0    \r\n     DECLARE VARDI_STOK CURSOR FAST_FORWARD FOR\r\n     SELECT p.firmano,p.varno,p.kaptar,p.kapsaat,p.varad,p.olustarsaat,\r\n     ps.stktip,ps.stkod,max(ps.kdvyuz),\r\n     sum(case when ps.islmtip='satis' then ps.mik else -1*ps.mik end),\r\n     sum(case when ps.islmtip='satis' then ps.mik else -1*ps.mik end *ps.brmfiy)\r\n     from marvardimas as p with (nolock)\r\n     inner join marsatmas as pm with (nolock)\r\n     on pm.varno=p.varno and pm.sil=0  and pm.firmano in (0,@Firmano)\r\n     inner join marsathrk as ps  with (nolock)\r\n     on ps.varno=p.varno and pm.marsatid=ps.marsatid and p.sil=0 and p.varok=1\r\n      and p.kaptar>=@BASTARIH and p.kaptar<=@BITTARIH  and pm.sil=0 and ps.sil=0 \r\n      group by p.firmano,p.varno,p.kaptar,p.kapsaat,p.varad,p.olustarsaat,\r\n      ps.stktip,ps.stkod\r\n      having ABS(sum(case when ps.islmtip='satis' then ps.mik else -1*ps.mik end))>0\r\n      order by p.varno\r\n      \r\n    end \r\n      \r\n      \r\n      \r\n     OPEN  VARDI_STOK\r\n      FETCH NEXT FROM VARDI_STOK INTO\r\n       @FIRMA,@VARNO,@TARIH,@SAAT,@ACK,@OLUSTARSAAT,\r\n       @STOK_TIP,@STOK_KOD,@STOK_KDVYUZ,\r\n       @STOK_MIKTAR,@STOK_TUTARKDVLI\r\n       WHILE @@FETCH_STATUS = 0\r\n        BEGIN  \r\n\r\n    if  @TIPIN='pomvardimas'\r\n     SET @STOK_BRIM='LİTRE'\r\n     \r\n    if  @TIPIN='marvardimas'\r\n     SET @STOK_BRIM='ADET'\r\n     \r\n     \r\n\r\n     declare @GEC_STOK_MIKTAR      FLOAT\r\n     declare @GEC_STOK_TUTAR       FLOAT\r\n\r\n     set @GEC_STOK_MIKTAR=0\r\n     set @GEC_STOK_TUTAR=0\r\n\r\n     select @GEC_STOK_MIKTAR=sum(h.mik),\r\n     @GEC_STOK_TUTAR=sum(h.mik*h.brmfiy) from veresimas as\r\n      m inner join veresihrk as h with (nolock)\r\n     on m.verid=h.verid and m.sil=h.sil and m.sil=0\r\n     and h.stktip=@STOK_TIP and h.stkod=@STOK_KOD\r\n     and m.yertip='pomvardimas' and m.varno=@VARNO\r\n     group by m.varno,h.stktip,h.stkod\r\n     \r\n     \r\n     set @STOK_MIKTAR=@STOK_MIKTAR-@GEC_STOK_MIKTAR\r\n     set @STOK_TUTARKDVLI=@STOK_TUTARKDVLI-@GEC_STOK_TUTAR\r\n     \r\n     \r\n     SET @STOK_BRMKDVLI=0\r\n     SET @STOK_BRMKDVSIZ=0\r\n     \r\n     \r\n     if @STOK_MIKTAR<>0\r\n      begin\r\n       SET @STOK_BRMKDVLI=@STOK_TUTARKDVLI/@STOK_MIKTAR\r\n       SET @STOK_BRMKDVSIZ=@STOK_BRMKDVLI/(1+@STOK_KDVYUZ) \r\n      end \r\n     \r\n     SET @STOK_TUTARKDVSIZ=@STOK_BRMKDVSIZ*@STOK_MIKTAR \r\n     \r\n     set @SERINO=1\r\n     \r\n     if @TIPIN='pomvardimas' and @firmano=0  \r\n      SELECT @SERINO=count(*)+1 from pomvardimas with (nolock) where \r\n      kapsaat=@TARIH and varno>@VARNO \r\n      \r\n      \r\n     if @TIPIN='pomvardimas' and @firmano>0  \r\n      SELECT @SERINO=count(*)+1 from pomvardimas with (nolock) where \r\n      kapsaat=@TARIH and varno>@VARNO and firmano=@Firmano\r\n\r\n     \r\n     insert into @TB_STOK (FIRMANO,VARNO,SERINO,TARIH,SAAT,ACK,CARKOD,OLUSTARSAAT,\r\n     STOK_TIP,STOK_KOD,STOK_BRIM,STOK_KDVYUZ,STOK_MIKTAR,\r\n     STOK_BRMKDVLI,STOK_BRMKDVSIZ,STOK_TUTARKDVLI,STOK_TUTARKDVSIZ)\r\n     values (@FIRMA,@VARNO,@SERINO,@TARIH,@SAAT,@ACK,@CAR_KOD,@OLUSTARSAAT,\r\n     @STOK_TIP,@STOK_KOD,@STOK_BRIM,@STOK_KDVYUZ,@STOK_MIKTAR,\r\n     @STOK_BRMKDVLI,@STOK_BRMKDVSIZ,\r\n     @STOK_TUTARKDVLI,@STOK_TUTARKDVSIZ) \r\n\r\n\r\n     FETCH NEXT FROM VARDI_STOK INTO\r\n       @FIRMA,@VARNO,@TARIH,@SAAT,@ACK,@OLUSTARSAAT,\r\n       @STOK_TIP,@STOK_KOD,@STOK_KDVYUZ,\r\n       @STOK_MIKTAR,@STOK_TUTARKDVLI\r\n\r\n   END\r\n   \r\n     CLOSE VARDI_STOK\r\n     DEALLOCATE VARDI_STOK \r\n\r\n     delete from @TB_STOK where STOK_MIKTAR=0\r\n\r\n\r\nRETURN\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_PomVarNakitStokMas",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_PomVarNakitStokMas",
    "definition": "CREATE FUNCTION [dbo].UDF_PomVarNakitStokMas (\r\n@firmano           int,\r\n@TIPIN\t\t\t   VARCHAR(30),\r\n@BASTARIH          DATETIME,\r\n@BITTARIH          DATETIME)\r\nRETURNS\r\n   @TB_STOK TABLE (\r\n    VARNO \t\t\t\t INT,\r\n    TARIH                DATETIME,\r\n    SAAT             \t VARCHAR(10) COLLATE Turkish_CI_AS,\r\n    CARKOD\t\t\t\t VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    STOK_TIP             VARCHAR(10) COLLATE Turkish_CI_AS,\r\n    STOK_KOD             VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    STOK_KDVYUZ          FLOAT,\r\n    STOK_MIKTAR          FLOAT,\r\n    STOK_TUTAR  \t\t FLOAT,\r\n    ACK \t\t\t\t VARCHAR(100) COLLATE Turkish_CI_AS,\r\n    OLUSTARSAAT          DATETIME)\r\nAS\r\nBEGIN\r\n\r\n   DECLARE @CAR_KOD             VARCHAR(30) \r\n     \r\n   SELECT @CAR_KOD=zrap_carkod FROM sistemtanim\r\n   \r\n    DECLARE @VARNO \t\t\t\t  int\r\n    DECLARE @TARIH \t\t\t\t  DATETIME\r\n    DECLARE @SAAT\t\t\t\t  VARCHAR(10) \t \r\n    DECLARE @STOK_TIP             VARCHAR(10) \r\n    DECLARE @STOK_KOD             VARCHAR(30)\r\n    DECLARE @STOK_KDVYUZ          FLOAT\r\n    DECLARE @STOK_MIKTAR          FLOAT\r\n    DECLARE @STOK_TUTAR  \t\t  FLOAT\r\n    DECLARE @ACK                  VARCHAR(100) \r\n    DECLARE @OLUSTARSAAT     \t  DATETIME\r\n\r\n\r\n  if @TIPIN='pomvardimas'\r\n   DECLARE VARDI_STOK CURSOR FAST_FORWARD FOR\r\n    SELECT p.varno,p.tarih,p.saat,p.varad,p.olustarsaat,\r\n    ps.stktip,ps.stkod,max(ps.kdvyuz),sum(ps.satmik),sum(ps.tutar)\r\n    from pomvardimas as p \r\n    inner join pomvardisayac as ps \r\n     on ps.varno=p.varno and p.varok=1\r\n      and p.tarih>=@BASTARIH and p.tarih<=@BASTARIH  \r\n      group by p.varno,p.tarih,p.saat,p.varad,p.olustarsaat,\r\n      ps.stktip,ps.stkod\r\n      order by p.varno\r\n      \r\n      \r\n   if @TIPIN='marvardimas'\r\n   DECLARE VARDI_STOK CURSOR FAST_FORWARD FOR\r\n    SELECT p.varno,p.tarih,p.saat,p.varad,p.olustarsaat,\r\n    ps.stktip,ps.stkod,max(ps.kdvyuz),sum(ps.mik),sum(ps.mik-ps.brmfiy)\r\n    from marvardimas as p\r\n    inner join marsatmas as pm\r\n    on pm.varno=p.varno and pm.sil=0 and p.varok=1\r\n    inner join marsathrk as ps \r\n     on ps.varno=p.varno and pm.marsatid=ps.marsatid and p.sil=0 \r\n      and p.tarih>=@BASTARIH and p.tarih<=@BASTARIH  \r\n      group by p.varno,p.tarih,p.saat,p.varad,p.olustarsaat,\r\n      ps.stktip,ps.stkod\r\n      order by p.varno  \r\n      \r\n      \r\n      \r\n      \r\n     OPEN  VARDI_STOK\r\n      FETCH NEXT FROM VARDI_STOK INTO\r\n       @VARNO,@TARIH,@SAAT,@ACK,@OLUSTARSAAT,\r\n       @STOK_TIP,@STOK_KOD,@STOK_KDVYUZ,@STOK_MIKTAR,@STOK_TUTAR\r\n       WHILE @@FETCH_STATUS = 0\r\n        BEGIN  \r\n\r\n     declare @GEC_STOK_MIKTAR      FLOAT\r\n     declare @GEC_STOK_TUTAR       FLOAT\r\n\r\n     set @GEC_STOK_MIKTAR=0\r\n     set @GEC_STOK_TUTAR=0\r\n\r\n     select @GEC_STOK_MIKTAR=sum(h.mik),\r\n     @GEC_STOK_TUTAR=sum(h.mik*h.brmfiy) from veresimas as m \r\n     inner join veresihrk as h \r\n     on m.verid=h.verid and m.sil=h.sil and m.sil=0\r\n     and h.stktip=@STOK_TIP and h.stkod=@STOK_KOD\r\n     and m.yertip='pomvardimas' and m.varno=@VARNO\r\n     group by m.varno,h.stktip,h.stkod\r\n     \r\n  \r\n     \r\n     \r\n     set @STOK_MIKTAR=@STOK_MIKTAR-@GEC_STOK_MIKTAR\r\n     set @STOK_TUTAR=@STOK_TUTAR-@GEC_STOK_TUTAR\r\n\r\n     insert into @TB_STOK (VARNO,TARIH,SAAT,ACK,CARKOD,OLUSTARSAAT,\r\n     STOK_TIP,STOK_KOD,STOK_KDVYUZ,STOK_MIKTAR,STOK_TUTAR)\r\n     values (@VARNO,@TARIH,@SAAT,@ACK,@CAR_KOD,@OLUSTARSAAT,\r\n     @STOK_TIP,@STOK_KOD,@STOK_KDVYUZ,@STOK_MIKTAR,@STOK_TUTAR) \r\n\r\n\r\n     FETCH NEXT FROM VARDI_STOK INTO\r\n       @VARNO,@TARIH,@SAAT,@ACK,@OLUSTARSAAT,\r\n       @STOK_TIP,@STOK_KOD,@STOK_KDVYUZ,@STOK_MIKTAR,@STOK_TUTAR\r\n\r\n   END\r\n   \r\n     CLOSE VARDI_STOK\r\n     DEALLOCATE VARDI_STOK\r\n\r\n\r\nRETURN\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_POS_HRK",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_POS_HRK",
    "definition": "CREATE FUNCTION [dbo].UDF_POS_HRK(\r\n@firmano\t\tint,\r\n@HRK_KRITER     VARCHAR(4000),\r\n@POS_KOD VARCHAR(30),\r\n@TARIH1 DATETIME,\r\n@TARIH2 DATETIME,\r\n@SAAT1 VARCHAR(8),\r\n@SAAT2 VARCHAR(8),\r\n@ORDER VARCHAR(20),\r\n@DEVIR  INT)\r\nRETURNS\r\n  @TB_POS_EKSTRE TABLE (\r\n    Firmano     int,\r\n    CARI_KOD    VARCHAR(30)  COLLATE Turkish_CI_AS,\r\n    CARI_UNVAN  VARCHAR(150)  COLLATE Turkish_CI_AS,\r\n    TARIH       DATETIME,\r\n    SAAT        VARCHAR(8)   COLLATE Turkish_CI_AS,\r\n    BELGENO     VARCHAR(30)  COLLATE Turkish_CI_AS,\r\n    ACIKLAMA    VARCHAR(200)  COLLATE Turkish_CI_AS,\r\n    ISLTIPAD    VARCHAR(50)   COLLATE Turkish_CI_AS,\r\n    ISLHRKAD    VARCHAR(50)   COLLATE Turkish_CI_AS,\r\n    YERAD       VARCHAR(50)   COLLATE Turkish_CI_AS,\r\n    YERTIP      VARCHAR(30)   COLLATE Turkish_CI_AS,\r\n    KULAD       VARCHAR(70)   COLLATE Turkish_CI_AS,\r\n    ISLTIP      VARCHAR(30)   COLLATE Turkish_CI_AS,\r\n    ISLHRK      VARCHAR(30)   COLLATE Turkish_CI_AS,\r\n    KRS_TIP     VARCHAR(30)  COLLATE Turkish_CI_AS,\r\n    KRS_KOD     VARCHAR(50)  COLLATE Turkish_CI_AS,\r\n    KRS_UNVAN   VARCHAR(150)  COLLATE Turkish_CI_AS,\r\n    VADETAR     DATETIME,\r\n    VARNO       FLOAT,\r\n    VAROK\t\tINT,\r\n    RAPID\t\tINT,\r\n    HRKID       FLOAT,\r\n    MASID       FLOAT,\r\n    BORC        DECIMAL(18,8),\r\n    ALACAK      DECIMAL(18,8),\r\n    BAKIYE      DECIMAL(18,8),\r\n    FAT_ID      INT,\r\n    FIS_ID      INT,\r\n    IRS_ID      INT,\r\n    MARSAT_ID\tINT,\r\n    SAYIM_ID    INT,\r\n    REMOTE_ID\tINT,\r\n    KASAHRK_ID  INT,\r\n    POSHRK_ID   INT,\r\n    BANKAHRK_ID INT,\r\n    CEK_ID\t\tINT,\r\n    ISTHRK_ID   INT)\r\nAS\r\nBEGIN\r\n\r\n\r\n  DECLARE @ONDA_HANE       INT\r\n  DECLARE @KUM_BAKIYE      DECIMAL(18,8)\r\n  DECLARE @HRK_POS_KOD    VARCHAR(30)\r\n  DECLARE @HRK_POS_UNVAN  VARCHAR(150)\r\n\r\n\r\n  SET @KUM_BAKIYE = 0\r\n  \r\n  SELECT @ONDA_HANE=para_ondalik FROM sistemtanim\r\n\r\nselect @HRK_POS_UNVAN=poskart.ad from poskart\r\nwhere kod=@POS_KOD\r\n\r\n  /* Devir atanıyor */\r\n  IF @DEVIR=1\r\n   BEGIN\r\n  IF @ORDER='tarih'\r\n  begin\r\n  INSERT @TB_POS_EKSTRE\r\n    SELECT\r\n      @firmano,\r\n      @POS_KOD, /* POS_KOD */\r\n      @HRK_POS_UNVAN, /* carı_UNVAN */\r\n      max(tarih),\r\n      @SAAT1,\r\n      'DEVİR', /* BELGE NO */\r\n      CONVERT(VARCHAR(10), max(tarih), 104) +' DEVİR BAKİYESİ', /* AÇIKLAMA */\r\n      '-','-','-','-','-','-','-',\r\n      '-','-','-',max(vadetar),0,0,0,0,0,\r\n      ISNULL(SUM(round(giren,@ONDA_HANE)),0), /* BORC */\r\n      ISNULL(SUM(round(cikan,@ONDA_HANE)),0), /* ALACAK */\r\n      ISNULL(SUM(ROUND((giren-cikan),@ONDA_HANE)),0), /* BAKIYE */\r\n      0,0,0,\r\n      0,0,0,\r\n      0,0,0,\r\n      0,0      \r\n    FROM poshrk\r\n    WHERE PosIsle=1 and poskod=@POS_KOD and sil=0 and aktip in ('BK')\r\n     AND tarih < @TARIH1\r\n   END\r\n\r\n  IF @ORDER='vadetar'\r\n  begin\r\n  INSERT @TB_POS_EKSTRE\r\n    SELECT\r\n      @firmano,\r\n      @POS_KOD, /* POS_KOD */\r\n      @HRK_POS_UNVAN, /* carı_UNVAN */\r\n      max(tarih),\r\n      @SAAT1,\r\n      'DEVİR', /* BELGE NO */\r\n      CONVERT(VARCHAR(10), max(tarih), 104) +' DEVİR BAKİYESİ', /* AÇIKLAMA */\r\n      '-','-','-','-','-','-','-',\r\n      '-','-','-',max(vadetar),0,0,0,0,0,\r\n      ISNULL(SUM(round(giren,@ONDA_HANE)),0), /* BORC */\r\n      ISNULL(SUM(round(cikan,@ONDA_HANE)),0), /* ALACAK */\r\n      ISNULL(SUM(ROUND((giren-cikan),@ONDA_HANE)),0), /* BAKIYE */\r\n      0,0,0,\r\n      0,0,0,\r\n      0,0,0,\r\n      0,0\r\n    FROM poshrk\r\n    WHERE PosIsle=1 and poskod=@POS_KOD and sil=0 and aktip in ('BK')\r\n     AND (vadetar < @TARIH1)\r\n   END\r\n\r\n\r\n    SELECT @KUM_BAKIYE = isnull(BAKIYE,0) FROM @TB_POS_EKSTRE\r\n     if @KUM_BAKIYE=0\r\n     delete from @TB_POS_EKSTRE\r\n   END\r\n     \r\n     \r\n     \r\n  /* Hareketler işleniyor */\r\n  /*---------------------------------------------------------------------------- */\r\n   IF @ORDER='tarih'\r\n    begin\r\n     INSERT @TB_POS_EKSTRE\r\n     SELECT\r\n       @firmano,\r\n       @POS_KOD,@HRK_POS_UNVAN,\r\n       tarih,saat,belno,\r\n      ack, /* AÇIKLAMA, */\r\n      islmtipad,islmhrkad,yerad,yertip,\r\n      olususer,islmtip,islmhrk,\r\n      Karsi_KartTip,Karsi_KartKod,'',\r\n      vadetar,varno,\r\n      varok,belrap_id,\r\n      poshrkid,masterid,\r\n      round(giren,@ONDA_HANE),\r\n      round(cikan,@ONDA_HANE),\r\n      round(giren-cikan,@ONDA_HANE) AS BAKIYE,\r\n      0,0,0,\r\n      0,0,0,\r\n      0,0,0,\r\n      0,0\r\n    FROM poshrk\r\n    WHERE PosIsle=1 and poskod=@POS_KOD and sil=0 and aktip in ('BK')\r\n    and islmtip+'_'+islmhrk not in \r\n     (select * FROM CsvToSTR(@HRK_KRITER))\r\n     AND tarih >= @TARIH1 AND tarih <= @TARIH2\r\n     ORDER BY tarih,saat\r\n    END\r\n  \r\n     IF @ORDER='vadetar'\r\n    begin\r\n     INSERT @TB_POS_EKSTRE\r\n     SELECT\r\n       @firmano,\r\n       @POS_KOD,@HRK_POS_UNVAN,\r\n       tarih,saat,belno,\r\n      ack, /* AÇIKLAMA, */\r\n      islmtipad,islmhrkad,yerad,yertip,\r\n      olususer,islmtip,islmhrk,\r\n      Karsi_KartTip,Karsi_KartKod,'',\r\n      vadetar,varno,\r\n      varok,belrap_id,\r\n      poshrkid,masterid,\r\n      round(giren,@ONDA_HANE),\r\n      round(cikan,@ONDA_HANE),\r\n      round(giren-cikan,@ONDA_HANE) AS BAKIYE,\r\n      0,0,0,\r\n      0,0,0,\r\n      0,0,0,\r\n      0,0\r\n    FROM poshrk\r\n    WHERE PosIsle=1 and poskod=@POS_KOD and sil=0 and aktip in ('BK')\r\n    and islmtip+'_'+islmhrk not in \r\n     (select * FROM CsvToSTR(@HRK_KRITER))\r\n     and vadetar >= @TARIH1 AND vadetar <= @TARIH2\r\n     ORDER BY vadetar,saat\r\n    END\r\n  \r\n  \r\n   update @TB_POS_EKSTRE set KRS_UNVAN=dt.AD\r\n   FROM @TB_POS_EKSTRE AS T join\r\n   (select cartp,kod,ad from genel_kart) dt\r\n   on dt.cartp=t.KRS_TIP and dt.kod=t.KRS_KOD\r\n   \r\n    \r\n   update @TB_POS_EKSTRE set KRS_KOD='-',KRS_UNVAN='-'\r\n   WHERE (KRS_KOD is null)\r\n\r\n  RETURN\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_PUMPOTOMAS_PER",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_PUMPOTOMAS_PER",
    "definition": "CREATE FUNCTION [dbo].UDF_PUMPOTOMAS_PER (@TARIH1 DATETIME,@TARIH2 DATETIME)\r\nRETURNS\r\n  @TB_PUMP_PER_EKSTRE TABLE (\r\n    PER_KOD      VARCHAR(20)   COLLATE Turkish_CI_AS,\r\n    PER_AD       VARCHAR(50)   COLLATE Turkish_CI_AS,\r\n    DOLUM        INT,\r\n    ST_1         FLOAT,\r\n    ST_2         FLOAT,\r\n    ST_3         FLOAT,\r\n    ST_4         FLOAT,\r\n    ST_5         FLOAT,\r\n    ST_6         FLOAT,\r\n    TUTAR        FLOAT)\r\nAS\r\nBEGIN\r\n  DECLARE @EKSTRE_TEMP TABLE (\r\n    PER_KOD      VARCHAR(20)   COLLATE Turkish_CI_AS,\r\n    PER_AD       VARCHAR(50)   COLLATE Turkish_CI_AS,\r\n    DOLUM        INT,\r\n    ST_1         FLOAT,\r\n    ST_2         FLOAT,\r\n    ST_3         FLOAT,\r\n    ST_4         FLOAT,\r\n    ST_5         FLOAT,\r\n    ST_6         FLOAT,\r\n    TUTAR        FLOAT)\r\n    \r\n  DECLARE @HRK_PER_KOD     VARCHAR(20)\r\n  DECLARE @HRK_PER_AD      VARCHAR(50)\r\n  DECLARE @HRK_DOLUM       INT\r\n  DECLARE @HRK_ST_1        FLOAT\r\n  DECLARE @HRK_ST_2        FLOAT\r\n  DECLARE @HRK_ST_3        FLOAT\r\n  DECLARE @HRK_ST_4        FLOAT\r\n  DECLARE @HRK_ST_5        FLOAT\r\n  DECLARE @HRK_ST_6        FLOAT\r\n  DECLARE @POMP_GRP1       INT\r\n  \r\n\r\n select @POMP_GRP1=grp_perpomid from sistemtanim\r\n\r\n\r\n\r\n   DECLARE CRS_HRK CURSOR FAST_FORWARD FOR\r\n    SELECT K.KOD,k.ad+' '+k.soyad  FROM perkart as k where\r\n    k.grp1=@POMP_GRP1 and k.sil=0\r\n    OPEN CRS_HRK\r\n\r\n   FETCH NEXT FROM CRS_HRK INTO @HRK_PER_KOD,@HRK_PER_AD\r\n   WHILE @@FETCH_STATUS = 0\r\n    BEGIN\r\n\r\n    /* FROM otomasxml as x inner join */\r\n\r\n\r\n  /*  SET @HRK_MEVCUT=@HRK_MEVCUT+isnull((select sum(litre) from otomasxml as x */\r\n   /* inner JOIN sayackart as s on x.Sayac_Kod=s.kod and s.tankod=@HRK_TANK_KOD),0) */\r\n\r\n    INSERT @EKSTRE_TEMP (PER_AD)\r\n      SELECT  @HRK_PER_AD\r\n\r\n    FETCH NEXT FROM CRS_HRK INTO @HRK_PER_KOD,@HRK_PER_AD\r\n  END\r\n\r\n  CLOSE CRS_HRK\r\n  DEALLOCATE CRS_HRK\r\n\r\n  /*---------------------------------------------------------------------------- */\r\n\r\n  INSERT @TB_PUMP_PER_EKSTRE (PER_KOD,PER_AD)\r\n    SELECT PER_KOD,PER_AD FROM @EKSTRE_TEMP\r\n\r\n  RETURN\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_RAPOR_DEGER_TUTAR",
    "type": "SQL_SCALAR_FUNCTION",
    "full_name": "dbo.UDF_RAPOR_DEGER_TUTAR",
    "definition": "CREATE FUNCTION [dbo].UDF_RAPOR_DEGER_TUTAR \r\n(@FIRMA_NO\t\t\tINT,\r\n @RAP_KOD\t\t\tVARCHAR(50),\r\n @ID\t\t\t\tINT,\r\n @KAY_ID\t\t\tINT,\r\n @BAS_TAR\t\t\tDATETIME,\r\n @BIT_TAR\t\t\tDATETIME)\r\n \r\nRETURNS           \tFLOAT\r\nAS\r\nBEGIN\r\n   \r\n\r\n     declare @DEGER     FLOAT\r\n     declare @cartip\tvarchar(30)\r\n     declare @cartip_Id\tvarchar(30)\r\n     declare @DEGER_Tip\tINT\r\n     declare @Hrk_Tip\tvarchar(10)\r\n     \r\n     \r\n     declare @STK_TIP     varchar(10)\r\n     declare @STK_KOD\t  varchar(50)\r\n     \r\n     \r\n     \r\n     declare @DEGER_BA\tFLOAT\r\n     declare @DEGER_MN\tFLOAT\r\n     \r\n     declare @BFIYAT\tFLOAT\r\n     \r\n     \r\n     SET @DEGER=0\r\n     \r\n     set @DEGER_MN=0\r\n     \r\n     if @KAY_ID>0\r\n      BEGIN\r\n        SELECT @DEGER=DEGER FROM Rapor_Deger\r\n        WHERE KAY_Id=@KAY_ID and \r\n        table_name='Rapor_Grup_Kriter' \r\n        and table_Id=@ID\r\n      \r\n        RETURN @DEGER\r\n      END\r\n     \r\n      select @cartip_Id=CarTip_Id,\r\n       @DEGER_Tip=DEGER_Tip,\r\n       @Hrk_Tip=Hrk_Tip\r\n       \r\n       from Rapor_Grup_Kriter\r\n        where rap_kod=@RAP_KOD AND id=@ID\r\n      \r\n       select @cartip=kod from Cari_Tip\r\n        where id=@cartip_Id  \r\n        \r\n    IF @Hrk_Tip='CTK'\r\n     BEGIN\r\n         select @DEGER_BA=isnull(SUM(borc),0) from  \r\n         Cek_Son_Drm (@FIRMA_NO,'TAK',@BAS_TAR,@BIT_TAR)\r\n    \r\n     END   \r\n        \r\n        \r\n    IF @Hrk_Tip='CPR'\r\n     BEGIN\r\n         select @DEGER_BA=isnull(SUM(borc),0) from  \r\n         Cek_Son_Drm (@FIRMA_NO,'POR',@BAS_TAR,@BIT_TAR)\r\n    \r\n     END        \r\n             \r\n     \r\n    IF @Hrk_Tip='BAK'\r\n     BEGIN\r\n     /* CARI HRK      */\r\n      if (@cartip_Id=1) or (@cartip_Id=2)\r\n         or (@cartip_Id=3)\r\n      begin   \r\n       SELECT \r\n        @DEGER_BA=isnull(SUM(h.borc-h.alacak),0)\r\n        FROM  carihrk as h \r\n        where \r\n        h.tarih>=@BAS_TAR and h.tarih<=@BIT_TAR\r\n        and h.sil=0 and h.cartip=@cartip \r\n        and carkod in \r\n        (select kart_kod from Rapor_Hrk_Kriter \r\n        where rap_kod=@RAP_KOD AND grp_Id=@ID)\r\n        \r\n        \r\n        if (@DEGER_Tip=3) \r\n         SELECT \r\n        @DEGER_BA=@DEGER_BA+isnull(SUM(\r\n        CASE WHEN fistip='FISVERSAT' THEN \r\n        (h.toptut-h.isktop) else -1*(h.toptut-h.isktop) end),0)\r\n        FROM  veresimas as h \r\n         where \r\n         h.tarih>=@BAS_TAR and h.tarih<=@BIT_TAR\r\n         and h.sil=0 and h.aktip in ('BK','BL')\r\n         and h.cartip=@cartip \r\n         and carkod in \r\n         (select kart_kod from Rapor_Hrk_Kriter \r\n         where rap_kod=@RAP_KOD AND grp_Id=@ID) \r\n   \r\n        \r\n       end \r\n        \r\n        \r\n      /* BANKA HRK      */\r\n      if (@cartip_Id=4)\r\n       SELECT \r\n        @DEGER_BA=isnull(SUM((h.borc-h.alacak)*h.kur),0)\r\n        FROM  bankahrk as h \r\n        where \r\n        h.tarih>=@BAS_TAR and h.tarih<=@BIT_TAR\r\n        and h.sil=0 and h.bankod in \r\n        (select kart_kod from Rapor_Hrk_Kriter \r\n        where rap_kod=@RAP_KOD AND grp_Id=@ID)     \r\n        \r\n        \r\n        \r\n      /* POS HRK      */\r\n      if (@cartip_Id=5)\r\n       SELECT\r\n        @DEGER_BA=isnull(SUM((h.giren-h.cikan)*h.kur),0)\r\n        FROM  poshrk as h \r\n        where \r\n        h.tarih>=@BAS_TAR and h.tarih<=@BIT_TAR\r\n        and h.sil=0 and aktip in ('BK') and \r\n        h.poskod in \r\n        (select kart_kod from Rapor_Hrk_Kriter \r\n        where rap_kod=@RAP_KOD AND grp_Id=@ID)     \r\n        \r\n     \r\n        \r\n       /* KASA HRK      */\r\n       if (@cartip_Id=8)\r\n        SELECT \r\n        @DEGER_BA=isnull(SUM((h.giren-h.cikan)*h.kur),0) \r\n        FROM  kasahrk as h \r\n        where \r\n        h.tarih>=@BAS_TAR and h.tarih<=@BIT_TAR\r\n        and h.sil=0 and h.kaskod in \r\n        (select kart_kod from Rapor_Hrk_Kriter \r\n        where rap_kod=@RAP_KOD AND grp_Id=@ID)     \r\n    \r\n    END      \r\n    \r\n    \r\n    IF @Hrk_Tip='KHA'\r\n     BEGIN\r\n        \r\n       DECLARE @TB_STKHRK TABLE ( \r\n        STK_TIP\t\t\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n        STK_KOD\t\t\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n  \t\tMIKTAR\t\t\tFLOAT,\r\n        BRMFYT    \t\tFLOAT \r\n        PRIMARY KEY (STK_TIP,STK_KOD))\r\n         \r\n     \r\n     \r\n     \r\n      if (@cartip_Id=10) or (@cartip_Id=11)\r\n      BEGIN\r\n      \r\n        INSERT INTO @TB_STKHRK (STK_TIP,STK_KOD,MIKTAR,BRMFYT)\r\n        SELECT \r\n         H.stktip,H.stkod,\r\n         isnull( SUM(h.giren-h.cikan),0),0    \r\n         FROM  STKHRK as h \r\n        where \r\n        h.tarih>=@BAS_TAR and h.tarih<=@BIT_TAR\r\n        and h.sil=0 and h.stktip=@cartip \r\n        and h.stkod in \r\n        (select kart_kod from Rapor_Hrk_Kriter \r\n        where rap_kod=@RAP_KOD AND grp_Id=@ID)\r\n        group by h.stktip,h.stkod \r\n      \r\n        \r\n   \r\n      \r\n      update @TB_STKHRK set BRMFYT=dt.tut from\r\n      @TB_STKHRK as t JOIN\r\n       (select STK_TIP,STK_KOD,(select Top 1 \r\n                 (Hr.brmfiykdvli)/(1+hr.kdvyuz) as TUT \r\n                 from stkhrk as hr\r\n                 where sil=0 and hr.tarih<=@BIT_TAR and hr.giren>0\r\n                 and hr.stktip=k.STK_TIP and hr.stkod=k.STK_KOD\r\n                 order by hr.tarih desc ) as tut\r\n       from @TB_STKHRK as k ) dt on \r\n       dt.STK_TIP=t.STK_TIP and dt.STK_KOD=t.STK_KOD\r\n      \r\n    \r\n        SELECT \r\n        @DEGER_BA=isnull(SUM(MIKTAR*BRMFYT),0) \r\n        FROM  @TB_STKHRK as h \r\n        \r\n      END       \r\n     \r\n     \r\n     \r\n     \r\n     \r\n     \r\n     END\r\n    \r\n    \r\n    \r\n        \r\n\r\n\r\n     IF @DEGER_Tip=0\r\n      BEGIN\r\n       IF @DEGER_BA>0\r\n         SET @DEGER=@DEGER_BA\r\n      END \r\n       \r\n     IF @DEGER_Tip=1\r\n      BEGIN\r\n       IF (@DEGER_BA)<0 \r\n         SET @DEGER=-1*(@DEGER_BA)\r\n      END \r\n   \r\n     IF @DEGER_Tip=2\r\n       SET @DEGER=@DEGER_MN\r\n       \r\n      IF @DEGER_Tip=3\r\n      BEGIN\r\n        SET @DEGER=(@DEGER_BA)\r\n      END   \r\n         \r\n       \r\n   \r\n     RETURN @DEGER\r\n\r\n\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_SATDAG_NAK_DENGE",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_SATDAG_NAK_DENGE",
    "definition": "CREATE FUNCTION [dbo].[UDF_SATDAG_NAK_DENGE] \r\n(@FIRMA_NO       \tINT,\r\n @id\t\t\t   \tINT,\r\n @GRP_ID\t\t\tINT,\r\n @BAS_TAR          \tDATETIME,\r\n @BIT_TAR          \tDATETIME,\r\n @FARK_TUT\t\t\tFLOAT)\r\nRETURNS\r\n\r\n  @TABLE_SAT_DAG TABLE (\r\n   ID\t\t\t\t\tint,\r\n   PARENTID\t\t\t\tint,\r\n   GRP_ID\t\t\t\tINT,\r\n   ACK\t\t\t\t\tVARCHAR(100) COLLATE Turkish_CI_AS,\r\n   GUN_SAY\t\t\t\tINT,\r\n   GUN_ORT\t\t\t    Float,\r\n   TUTAR\t\t\t\tFloat,\r\n   YUZDE\t\t\t\tFLOAT)\r\nAS\r\nBEGIN\r\n \r\n\r\n     declare @top_tutar    float\r\n     declare @Gun_ORT    float\r\n     declare @gun_say\t   int\r\n     declare @parentid\t   int\r\n     DECLARE @cartip\t\tvarchar(50)\r\n     \r\n     DECLARE @SAG_DENGE     FLOAT\r\n     DECLARE @BNK_BORKUL    FLOAT\r\n     DECLARE @BNK_BORODE    FLOAT\r\n     \r\n\r\n     set @parentid=@id \r\n   \r\n      insert into @TABLE_SAT_DAG \r\n      (ID,PARENTID,GRP_ID,ACK,GUN_SAY,GUN_ORT,TUTAR,YUZDE)\r\n       VALUES (@parentid,0,@GRP_ID,'NAKİT DENGE',0,0,0,100)\r\n     \r\n\r\n \r\n /* NAKİT AKIMI */\r\n      set @id=@id+1\r\n \r\n      insert into @TABLE_SAT_DAG \r\n      (ID,PARENTID,GRP_ID,ACK,GUN_SAY,GUN_ORT,TUTAR,YUZDE)\r\n       VALUES (@id,@parentid,@GRP_ID,'NET NAKIT AKIMI',0,0,@FARK_TUT,0)\r\n\r\n\r\n      \r\n   set @id=@id+1\r\n\r\n\r\n     /* BAŞLANGIÇ NAKIT DENGESI */\r\n\r\n\r\n      insert into @TABLE_SAT_DAG \r\n      (ID,PARENTID,GRP_ID,ACK,GUN_SAY,GUN_ORT,TUTAR,YUZDE)\r\n       VALUES (@id,@parentid,@GRP_ID,'BAŞLANGIÇ NAKIT DENGESI',0,0,0,0)\r\n\r\n\r\n      SELECT \r\n       @gun_say=isnull(DATEDIFF(day,@BAS_TAR,@BIT_TAR)+1,1),\r\n       @top_tutar= isnull(SUM((h.borc-h.alacak)*H.kur),0) \r\n       FROM  \r\n       bankahrk as h\r\n       inner join bankakart as m \r\n       on h.bankod=m.kod and \r\n       m.sil=0 and h.sil=0\r\n       where h.tarih<=@BIT_TAR and m.drm='Aktif'\r\n       \r\n    \r\n   \r\n       SELECT \r\n       @gun_say=isnull(DATEDIFF(day,@BAS_TAR,@BIT_TAR)+1,1),\r\n       @top_tutar=@top_tutar+isnull(SUM((h.giren-h.cikan)*H.kur),0) \r\n       FROM  \r\n       kasahrk as h\r\n       inner join kasakart as m \r\n       on h.kaskod=m.kod and \r\n       m.sil=0 and h.sil=0\r\n       where h.tarih<=@BIT_TAR \r\n   \r\n   \r\n   \r\n      update @TABLE_SAT_DAG set \r\n      GUN_SAY=@gun_say,\r\n      TUTAR=@top_tutar,\r\n      GUN_ORT=@top_tutar/@gun_say\r\n       WHERE Id=@id\r\n       \r\n       \r\n   /* SAĞLANABILEN DENGE       */\r\n\r\n     set @id=@id+1\r\n     \r\n      SET @SAG_DENGE=@FARK_TUT+@top_tutar\r\n      insert into @TABLE_SAT_DAG \r\n      (ID,PARENTID,GRP_ID,ACK,GUN_SAY,GUN_ORT,TUTAR,YUZDE)\r\n       VALUES (@id,@parentid,@GRP_ID,'SAĞLANABILEN DENGE',0,0,\r\n       @SAG_DENGE,0)\r\n      \r\n       \r\n  \r\n  /* BORC KULLANMA */\r\n        \r\n     set @id=@id+1\r\n\r\n     select @cartip=CarTip_Id from Rapor_Grup_Kriter\r\n      where rap_kod='SATIS_DAGILIM' AND id=6\r\n      \r\n      select @cartip=kod from Cari_Tip\r\n      where id=@cartip\r\n\r\n       insert into @TABLE_SAT_DAG \r\n       (ID,PARENTID,GRP_ID,ACK,GUN_SAY,GUN_ORT,TUTAR,YUZDE)\r\n       VALUES (@id,@parentid,@GRP_ID,'BORÇ KULLANMA',0,0,0,0)\r\n       SELECT \r\n        @top_tutar=isnull(SUM(h.borc*h.kur),0) FROM  \r\n        bankahrk as h \r\n        where \r\n        h.tarih>=@BAS_TAR and h.tarih<=@BIT_TAR\r\n        and h.sil=0 and h.bankod in \r\n        (select kart_kod from Rapor_Hrk_Kriter \r\n        where rap_kod='SATIS_DAGILIM' AND grp_Id=6)\r\n        \r\n    \r\n  \r\n     SET @BNK_BORKUL=@top_tutar\r\n  \r\n       update @TABLE_SAT_DAG set \r\n        GUN_SAY=@gun_say,\r\n        TUTAR=@top_tutar,\r\n        GUN_ORT=@top_tutar/@gun_say\r\n       WHERE Id=@id    \r\n       \r\n       \r\n    /* BORC ÖDEME */\r\n        \r\n     set @id=@id+1\r\n\r\n     select @cartip=CarTip_Id from Rapor_Grup_Kriter\r\n      where rap_kod='SATIS_DAGILIM' AND id=7\r\n      \r\n      select @cartip=kod from Cari_Tip\r\n      where id=@cartip\r\n\r\n       insert into @TABLE_SAT_DAG \r\n       (ID,PARENTID,GRP_ID,ACK,GUN_SAY,GUN_ORT,TUTAR,YUZDE)\r\n       VALUES (@id,@parentid,@GRP_ID,'BORÇ ÖDEME',0,0,0,0)\r\n       SELECT \r\n        @top_tutar=isnull(SUM(h.alacak*h.kur),0) FROM  \r\n        bankahrk as h \r\n        where \r\n        h.tarih>=@BAS_TAR and h.tarih<=@BIT_TAR\r\n        and h.sil=0 and h.bankod in \r\n        (select kart_kod from Rapor_Hrk_Kriter \r\n        where rap_kod='SATIS_DAGILIM' AND grp_Id=7)\r\n        \r\n    \r\n  \r\n     SET @BNK_BORODE=@top_tutar\r\n  \r\n       update @TABLE_SAT_DAG set \r\n        GUN_SAY=@gun_say,\r\n        TUTAR=@top_tutar,\r\n        GUN_ORT=@top_tutar/@gun_say\r\n       WHERE Id=@id      \r\n       \r\n       \r\n  \r\n    /*TOPLAM */\r\n   \r\n      select @top_tutar=SUM(TUTAR),\r\n      @gun_say=MAX(GUN_SAY) \r\n      from @TABLE_SAT_DAG \r\n      WHERE GRP_ID=@GRP_ID\r\n  \r\n  \r\n  \r\n      UPDATE @TABLE_SAT_DAG \r\n      SET YUZDE=case when @top_tutar>0 then \r\n      (TUTAR*100)/@top_tutar else 0 end \r\n      WHERE GRP_ID=@GRP_ID\r\n      \r\n    \r\n     set @top_tutar=(@SAG_DENGE+@BNK_BORKUL)-@BNK_BORODE\r\n  \r\n      UPDATE @TABLE_SAT_DAG \r\n      SET GUN_SAY=@gun_say,\r\n      GUN_ORT=case when @top_tutar>0 then \r\n      (@top_tutar/@gun_say) else 0 end,\r\n      TUTAR=@top_tutar,\r\n      YUZDE=100 where PARENTID=0\r\n      \r\n     \r\n       \r\n       \r\n       \r\n       \r\n       \r\n       \r\n   RETURN\r\n\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_SATDAG_NAK_GIRIS",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_SATDAG_NAK_GIRIS",
    "definition": "CREATE FUNCTION [dbo].[UDF_SATDAG_NAK_GIRIS] \r\n(@FIRMA_NO       \tINT,\r\n @id\t\t\t   \tINT,\r\n @GRP_ID\t\t\tINT,\r\n @BAS_TAR          \tDATETIME,\r\n @BIT_TAR          \tDATETIME,\r\n @KDVTIP\t\t\tINT)\r\nRETURNS\r\n\r\n  @TABLE_SAT_DAG TABLE (\r\n   ID\t\t\t\t\tint,\r\n   PARENTID\t\t\t\tint,\r\n   GRP_ID\t\t\t\tINT,\r\n   ACK\t\t\t\t\tVARCHAR(100) COLLATE Turkish_CI_AS,\r\n   GUN_SAY\t\t\t\tINT,\r\n   GUN_ORT\t\t\t    Float,\r\n   TUTAR\t\t\t\tFloat,\r\n   YUZDE\t\t\t\tFLOAT)\r\nAS\r\nBEGIN\r\n \r\n\r\n\r\n   \r\n\r\n     declare @top_tutar    float\r\n     declare @gun_say\t   int\r\n     \r\n     \r\n     \r\n     declare @parentid\t   int\r\n     \r\n\r\n     set @parentid=@id \r\n   \r\n      insert into @TABLE_SAT_DAG \r\n      (ID,PARENTID,GRP_ID,ACK,GUN_SAY,GUN_ORT,TUTAR,YUZDE)\r\n       VALUES (@parentid,0,@GRP_ID,'NAKİT GIRIŞLERI',0,0,0,0)\r\n\r\n  \r\n     set @id=@id+1\r\n\r\n /*- PESIN SATIS  */\r\n \r\n      insert into @TABLE_SAT_DAG \r\n      (ID,PARENTID,GRP_ID,ACK,GUN_SAY,GUN_ORT,TUTAR,YUZDE)\r\n       VALUES (@id,@parentid,@GRP_ID,'PEŞİN SATIŞLAR',0,0,0,0)\r\n\r\n\r\n       SELECT \r\n       @top_tutar=isnull(SUM(h.giren*h.KUR),0) FROM  \r\n       kasahrk as h \r\n       inner join pomvardimas as m \r\n       on h.varno=m.varno and m.sil=0 and h.sil=0\r\n       where m.tarih>=@BAS_TAR and m.tarih<=@BIT_TAR\r\n       and h.yertip='pomvardimas' and h.islmhrk='TES' \r\n       and m.varok=1\r\n       \r\n       \r\n       \r\n       SELECT \r\n       @gun_say=isnull(DATEDIFF(day,@BAS_TAR,@BIT_TAR)+1,1),\r\n       @top_tutar=@top_tutar+isnull(SUM(h.giren*h.KUR),0) FROM  \r\n       kasahrk as h \r\n       inner join marvardimas as m \r\n       on h.varno=m.varno and m.sil=0 and h.sil=0\r\n       where m.tarih>=@BAS_TAR and m.tarih<=@BIT_TAR\r\n       and h.yertip='marvardimas' and h.islmhrk='TES'\r\n        and m.varok=1\r\n       \r\n      update @TABLE_SAT_DAG set \r\n      GUN_SAY=@gun_say,\r\n      TUTAR=@top_tutar,\r\n      GUN_ORT=@top_tutar/@gun_say\r\n        WHERE Id=@id\r\n      \r\n      \r\n      \r\n   /* POS SATIS */\r\n   \r\n   \r\n     set @id=@id+1\r\n \r\n       insert into @TABLE_SAT_DAG \r\n      (ID,PARENTID,GRP_ID,ACK,GUN_SAY,GUN_ORT,TUTAR,YUZDE)\r\n       VALUES (@id,@parentid,@GRP_ID,'K.K (POS) SATIŞLAR',0,0,0,0)\r\n\r\n\r\n       SELECT \r\n       @top_tutar=isnull(SUM(h.giren),0) FROM  \r\n       poshrk as h \r\n       inner join pomvardimas as m \r\n       on h.varno=m.varno and m.sil=0 and h.sil=0\r\n       where m.tarih>=@BAS_TAR and m.tarih<=@BIT_TAR\r\n       and h.yertip='pomvardimas' and m.varok=1\r\n       \r\n       \r\n       \r\n       SELECT \r\n       @gun_say=isnull(DATEDIFF(day,@BAS_TAR,@BIT_TAR)+1,1),\r\n       @top_tutar=@top_tutar+isnull(SUM(h.giren),0) FROM  \r\n       poshrk as h \r\n       inner join marvardimas as m \r\n       on h.varno=m.varno and m.sil=0 and h.sil=0\r\n       where m.tarih>=@BAS_TAR and m.tarih<=@BIT_TAR\r\n       and h.yertip='marvardimas' and m.varok=1\r\n       \r\n       \r\n       \r\n    \r\n      update @TABLE_SAT_DAG set \r\n      GUN_SAY=@gun_say,\r\n      TUTAR=@top_tutar,\r\n      GUN_ORT=@top_tutar/@gun_say\r\n       WHERE Id=@id\r\n      \r\n      \r\n      \r\n      \r\n      \r\n    /* CARI SATIS */\r\n   \r\n   \r\n     set @id=@id+1\r\n \r\n       insert into @TABLE_SAT_DAG \r\n      (ID,PARENTID,GRP_ID,ACK,GUN_SAY,GUN_ORT,TUTAR,YUZDE)\r\n       VALUES (@id,@parentid,@GRP_ID,'CARİ SATIŞLAR',0,0,0,0)\r\n\r\n\r\n       SELECT \r\n       @top_tutar=isnull(SUM(h.toptut-ISNULL(h.isktop,0)),0) FROM  \r\n       veresimas as h \r\n       inner join pomvardimas as m \r\n       on h.varno=m.varno and m.sil=0 and h.sil=0\r\n       where m.tarih>=@BAS_TAR and m.tarih<=@BIT_TAR\r\n       and h.yertip='pomvardimas' and m.varok=1\r\n       and h.ototag=0\r\n       \r\n       \r\n       \r\n       SELECT \r\n       @gun_say=isnull(DATEDIFF(day,@BAS_TAR,@BIT_TAR)+1,1),\r\n       @top_tutar=@top_tutar+isnull(SUM(h.toptut-ISNULL(h.isktop,0)),0) FROM  \r\n       veresimas as h \r\n       inner join marvardimas as m \r\n       on h.varno=m.varno and m.sil=0 and h.sil=0\r\n       where m.tarih>=@BAS_TAR and m.tarih<=@BIT_TAR\r\n       and h.yertip='marvardimas' and m.varok=1\r\n       and h.ototag=0     \r\n       \r\n       \r\n    \r\n      update @TABLE_SAT_DAG set \r\n      GUN_SAY=@gun_say,\r\n      TUTAR=@top_tutar,\r\n      GUN_ORT=@top_tutar/@gun_say\r\n       WHERE Id=@id\r\n         \r\n     \r\n     \r\n     /* TTS SATIS */\r\n   \r\n   \r\n     set @id=@id+1\r\n \r\n       insert into @TABLE_SAT_DAG \r\n      (ID,PARENTID,GRP_ID,ACK,GUN_SAY,GUN_ORT,TUTAR,YUZDE)\r\n       VALUES (@id,@parentid,@GRP_ID,'TTS SATIŞLAR',0,0,0,0)\r\n\r\n\r\n       SELECT \r\n       @top_tutar=isnull(SUM(h.toptut-ISNULL(h.isktop,0)),0) FROM  \r\n       veresimas as h \r\n       inner join pomvardimas as m \r\n       on h.varno=m.varno and m.sil=0 and h.sil=0\r\n       where m.tarih>=@BAS_TAR and m.tarih<=@BIT_TAR\r\n       and h.yertip='pomvardimas' and m.varok=1\r\n       and h.ototag>0\r\n       \r\n    \r\n      update @TABLE_SAT_DAG set \r\n      GUN_SAY=@gun_say,\r\n      TUTAR=@top_tutar,\r\n      GUN_ORT=@top_tutar/@gun_say\r\n       WHERE Id=@id\r\n         \r\n     \r\n    \r\n    \r\n    /*TOPLAM */\r\n   \r\n     set @id=@id+1\r\n  \r\n      select @top_tutar=SUM(TUTAR),\r\n      @gun_say=MAX(GUN_SAY) \r\n      from @TABLE_SAT_DAG \r\n      WHERE GRP_ID=@GRP_ID\r\n  \r\n  \r\n  \r\n      UPDATE @TABLE_SAT_DAG \r\n      SET YUZDE=case when @top_tutar>0 then \r\n      (TUTAR*100)/@top_tutar else 0 end \r\n      WHERE GRP_ID=@GRP_ID\r\n      \r\n    \r\n      UPDATE @TABLE_SAT_DAG \r\n      SET GUN_SAY=@gun_say,\r\n      GUN_ORT=case when @top_tutar>0 then \r\n      (@top_tutar/@gun_say) else 0 end,\r\n      TUTAR=@top_tutar,\r\n      YUZDE=100 where PARENTID=0\r\n  \r\n     \r\n      \r\n      \r\n       \r\n       \r\n   RETURN\r\n\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_SATDAG_NAK_ODEME",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_SATDAG_NAK_ODEME",
    "definition": "CREATE FUNCTION [dbo].[UDF_SATDAG_NAK_ODEME] \r\n(@FIRMA_NO       \tINT,\r\n @id\t\t\t   \tINT,\r\n @GRP_ID\t\t\tINT,\r\n @BAS_TAR          \tDATETIME,\r\n @BIT_TAR          \tDATETIME,\r\n @KDVTIP\t\t\tINT)\r\nRETURNS\r\n\r\n  @TABLE_SAT_DAG TABLE (\r\n   ID\t\t\t\t\tint,\r\n   PARENTID\t\t\t\tint,\r\n   GRP_ID\t\t\t\tINT,\r\n   ACK\t\t\t\t\tVARCHAR(100) COLLATE Turkish_CI_AS,\r\n   GUN_SAY\t\t\t\tINT,\r\n   GUN_ORT\t\t\t    Float,\r\n   TUTAR\t\t\t\tFloat,\r\n   YUZDE\t\t\t\tFLOAT)\r\nAS\r\nBEGIN\r\n \r\n\r\n\r\n   \r\n\r\n     declare @top_tutar    float\r\n     declare @gun_say\t   int\r\n     declare @cartip\t   varchar(50)\r\n     \r\n     \r\n     declare @parentid\t   int\r\n     \r\n\r\n     set @parentid=@id \r\n   \r\n      insert into @TABLE_SAT_DAG \r\n      (ID,PARENTID,GRP_ID,ACK,GUN_SAY,GUN_ORT,TUTAR,YUZDE)\r\n       VALUES (@parentid,0,@GRP_ID,'NAKİT ÇIKIŞLARI',0,0,0,0)\r\n\r\n     set @id=@id+1\r\n  \r\n    /*- FATURA ALIS */\r\n \r\n      insert into @TABLE_SAT_DAG \r\n      (ID,PARENTID,GRP_ID,ACK,GUN_SAY,GUN_ORT,TUTAR,YUZDE)\r\n       VALUES (@id,@parentid,@GRP_ID,'SATIN ALIMLAR (ALIM FATURALARI)',0,0,0,0)\r\n\r\n\r\n       SELECT \r\n       @gun_say=isnull(DATEDIFF(day,@BAS_TAR,@BIT_TAR)+1,1),\r\n       @top_tutar=\r\n       case \r\n       when @KDVTIP=1 then isnull(SUM(h.genel_top),0) \r\n       when @KDVTIP=0 then isnull(SUM(h.genel_net_top),0)\r\n       end      \r\n       FROM  \r\n       faturamas as h \r\n       where h.tarih>=@BAS_TAR and h.tarih<=@BIT_TAR\r\n       and h.sil=0\r\n\r\n       \r\n      update @TABLE_SAT_DAG set \r\n      GUN_SAY=@gun_say,\r\n      TUTAR=@top_tutar,\r\n      GUN_ORT=@top_tutar/@gun_say\r\n        WHERE Id=@id\r\n      \r\n      \r\n     \r\n   /* MAAS VE UCRET */\r\n   \r\n   \r\n     set @id=@id+1\r\n\r\n\r\n\r\n      select @cartip=CarTip_Id from Rapor_Grup_Kriter\r\n      where rap_kod='SATIS_DAGILIM' AND id=1\r\n      \r\n      select @cartip=kod from Cari_Tip\r\n      where id=@cartip\r\n\r\n       insert into @TABLE_SAT_DAG \r\n       (ID,PARENTID,GRP_ID,ACK,GUN_SAY,GUN_ORT,TUTAR,YUZDE)\r\n       VALUES (@id,@parentid,@GRP_ID,'MAAS VE UCRETLER',0,0,0,0)\r\n       SELECT \r\n        @top_tutar=isnull(SUM(h.borc),0) FROM  \r\n        carihrk as h \r\n        where \r\n        h.tarih>=@BAS_TAR and h.tarih<=@BIT_TAR\r\n        and h.sil=0 and h.cartip=@cartip \r\n        and carkod in \r\n        (select kart_kod from Rapor_Hrk_Kriter \r\n        where rap_kod='SATIS_DAGILIM' AND grp_Id=1)\r\n        \r\n    \r\n       update @TABLE_SAT_DAG set \r\n        GUN_SAY=@gun_say,\r\n        TUTAR=@top_tutar,\r\n        GUN_ORT=@top_tutar/@gun_say\r\n       WHERE Id=@id\r\n      \r\n   \r\n   \r\n     /* KIRALAR  */\r\n   \r\n   \r\n     set @id=@id+1\r\n\r\n     select @cartip=CarTip_Id from Rapor_Grup_Kriter\r\n      where rap_kod='SATIS_DAGILIM' AND id=2\r\n      \r\n      select @cartip=kod from Cari_Tip\r\n      where id=@cartip\r\n\r\n       insert into @TABLE_SAT_DAG \r\n       (ID,PARENTID,GRP_ID,ACK,GUN_SAY,GUN_ORT,TUTAR,YUZDE)\r\n       VALUES (@id,@parentid,@GRP_ID,'KIRALAR',0,0,0,0)\r\n       SELECT \r\n        @top_tutar=isnull(SUM(h.borc),0) FROM  \r\n        carihrk as h \r\n        where \r\n        h.tarih>=@BAS_TAR and h.tarih<=@BIT_TAR\r\n        and h.sil=0 and h.cartip=@cartip \r\n        and carkod in \r\n        (select kart_kod from Rapor_Hrk_Kriter \r\n        where rap_kod='SATIS_DAGILIM' AND grp_Id=2)\r\n        \r\n    \r\n       update @TABLE_SAT_DAG set \r\n        GUN_SAY=@gun_say,\r\n        TUTAR=@top_tutar,\r\n        GUN_ORT=@top_tutar/@gun_say\r\n       WHERE Id=@id\r\n   \r\n   \r\n   \r\n      \r\n     /* İŞLETME  */\r\n  \r\n     set @id=@id+1\r\n\r\n     select @cartip=CarTip_Id from Rapor_Grup_Kriter\r\n      where rap_kod='SATIS_DAGILIM' AND id=3\r\n      \r\n      select @cartip=kod from Cari_Tip\r\n      where id=@cartip\r\n\r\n       insert into @TABLE_SAT_DAG \r\n       (ID,PARENTID,GRP_ID,ACK,GUN_SAY,GUN_ORT,TUTAR,YUZDE)\r\n       VALUES (@id,@parentid,@GRP_ID,'IŞLETME GIDERLERI',0,0,0,0)\r\n       SELECT \r\n        @top_tutar=isnull(SUM(h.borc),0) FROM  \r\n        carihrk as h \r\n        where \r\n        h.tarih>=@BAS_TAR and h.tarih<=@BIT_TAR\r\n        and h.sil=0 and h.cartip=@cartip \r\n        and carkod in \r\n        (select kart_kod from Rapor_Hrk_Kriter \r\n        where rap_kod='SATIS_DAGILIM' AND grp_Id=3)\r\n        \r\n    \r\n       update @TABLE_SAT_DAG set \r\n        GUN_SAY=@gun_say,\r\n        TUTAR=@top_tutar,\r\n        GUN_ORT=@top_tutar/@gun_say\r\n       WHERE Id=@id\r\n       \r\n       \r\n       \r\n       \r\n   /* VERGI  */\r\n  \r\n     set @id=@id+1\r\n\r\n     select @cartip=CarTip_Id from Rapor_Grup_Kriter\r\n      where rap_kod='SATIS_DAGILIM' AND id=4\r\n      \r\n      select @cartip=kod from Cari_Tip\r\n      where id=@cartip\r\n\r\n       insert into @TABLE_SAT_DAG \r\n       (ID,PARENTID,GRP_ID,ACK,GUN_SAY,GUN_ORT,TUTAR,YUZDE)\r\n       VALUES (@id,@parentid,@GRP_ID,'VERGI ODEMELERI',0,0,0,0)\r\n       SELECT \r\n        @top_tutar=isnull(SUM(h.borc),0) FROM  \r\n        carihrk as h \r\n        where \r\n        h.tarih>=@BAS_TAR and h.tarih<=@BIT_TAR\r\n        and h.sil=0 and h.cartip=@cartip \r\n        and carkod in \r\n        (select kart_kod from Rapor_Hrk_Kriter \r\n        where rap_kod='SATIS_DAGILIM' AND grp_Id=4)\r\n        \r\n    \r\n       update @TABLE_SAT_DAG set \r\n        GUN_SAY=@gun_say,\r\n        TUTAR=@top_tutar,\r\n        GUN_ORT=@top_tutar/@gun_say\r\n       WHERE Id=@id\r\n      \r\n \r\n\r\n  /* FAIZ  */\r\n  \r\n     set @id=@id+1\r\n\r\n     select @cartip=CarTip_Id from Rapor_Grup_Kriter\r\n      where rap_kod='SATIS_DAGILIM' AND id=5\r\n      \r\n      select @cartip=kod from Cari_Tip\r\n      where id=@cartip\r\n\r\n       insert into @TABLE_SAT_DAG \r\n       (ID,PARENTID,GRP_ID,ACK,GUN_SAY,GUN_ORT,TUTAR,YUZDE)\r\n       VALUES (@id,@parentid,@GRP_ID,'FAIZ GİDERLERİ',0,0,0,0)\r\n       SELECT \r\n        @top_tutar=isnull(SUM(h.borc),0) FROM  \r\n        carihrk as h \r\n        where \r\n        h.tarih>=@BAS_TAR and h.tarih<=@BIT_TAR\r\n        and h.sil=0 and h.cartip=@cartip \r\n        and carkod in \r\n        (select kart_kod from Rapor_Hrk_Kriter \r\n        where rap_kod='SATIS_DAGILIM' AND grp_Id=5)\r\n        \r\n    \r\n       update @TABLE_SAT_DAG set \r\n        GUN_SAY=@gun_say,\r\n        TUTAR=@top_tutar,\r\n        GUN_ORT=@top_tutar/@gun_say\r\n       WHERE Id=@id\r\n      \r\n\r\n\r\n\r\n    \r\n    /*TOPLAM */\r\n   \r\n     set @id=@id+1\r\n  \r\n      select @top_tutar=SUM(TUTAR),\r\n      @gun_say=MAX(GUN_SAY) \r\n      from @TABLE_SAT_DAG \r\n      WHERE GRP_ID=@GRP_ID\r\n  \r\n  \r\n  \r\n      UPDATE @TABLE_SAT_DAG \r\n      SET YUZDE=case when @top_tutar>0 then \r\n      (TUTAR*100)/@top_tutar else 0 end \r\n      WHERE GRP_ID=@GRP_ID\r\n      \r\n          \r\n      UPDATE @TABLE_SAT_DAG \r\n      SET GUN_SAY=@gun_say,\r\n      GUN_ORT=case when @top_tutar>0 then \r\n      (@top_tutar/@gun_say) else 0 end,\r\n      TUTAR=@top_tutar,\r\n      YUZDE=100 where PARENTID=0\r\n       \r\n    \r\n    \r\n      \r\n      \r\n       \r\n       \r\n   RETURN\r\n\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_SATDAG_VARSATIS",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_SATDAG_VARSATIS",
    "definition": "CREATE FUNCTION [dbo].[UDF_SATDAG_VARSATIS] \r\n(@FIRMA_NO       \tINT,\r\n @id\t\t\t   \tINT,\r\n @GRP_ID\t\t\tINT,\r\n @BAS_TAR          \tDATETIME,\r\n @BIT_TAR          \tDATETIME,\r\n @KDVTIP\t\t\tINT)\r\nRETURNS\r\n\r\n  @TABLE_SAT_DAG TABLE (\r\n   ID\t\t\t\t\tint,\r\n   PARENTID\t\t\t\tint,\r\n   GRP_ID\t\t\t\tINT,\r\n   ACK\t\t\t\t\tVARCHAR(100) COLLATE Turkish_CI_AS,\r\n   GUN_SAY\t\t\t\tINT,\r\n   GUN_ORT\t\t\t    Float,\r\n   TUTAR\t\t\t\tFloat,\r\n   YUZDE\t\t\t\tFLOAT)\r\nAS\r\nBEGIN\r\n \r\n\r\n     declare @top_tutar    float\r\n     declare @Gun_ORT    float\r\n     declare @gun_say\t   int\r\n     declare @parentid\t   int\r\n     \r\n\r\n     set @parentid=@id \r\n   \r\n      insert into @TABLE_SAT_DAG \r\n      (ID,PARENTID,GRP_ID,ACK,GUN_SAY,GUN_ORT,TUTAR,YUZDE)\r\n       VALUES (@parentid,0,@GRP_ID,'SATIŞLAR',0,0,0,0)\r\n     \r\n\r\n \r\n /* AKARYAKIT  SATIS */\r\n      set @id=@id+1\r\n \r\n      insert into @TABLE_SAT_DAG \r\n      (ID,PARENTID,GRP_ID,ACK,GUN_SAY,GUN_ORT,TUTAR,YUZDE)\r\n       VALUES (@id,@parentid,@GRP_ID,'AKARYAKIT SATIŞLARI',0,0,0,0)\r\n\r\n\r\n      SELECT \r\n       @gun_say=isnull(DATEDIFF(day,@BAS_TAR,@BIT_TAR)+1,1),\r\n       @top_tutar=isnull(SUM(\r\n       CASE \r\n       WHEN @KDVTIP=1 then h.TUTAR\r\n       WHEN @KDVTIP=0 then (h.TUTAR/(1+h.kdvyuz)) end),0) FROM  \r\n       pomvardisayac as h \r\n       inner join pomvardimas as m \r\n       on h.varno=m.varno and m.sil=0 and h.sil=0\r\n       where m.tarih>=@BAS_TAR and m.tarih<=@BIT_TAR\r\n       and m.varok=1\r\n    \r\n      update @TABLE_SAT_DAG set \r\n      GUN_SAY=@gun_say,\r\n      TUTAR=@top_tutar,\r\n      GUN_ORT=@top_tutar/@gun_say\r\n       WHERE Id=@id\r\n \r\n \r\n \r\n   set @id=@id+1\r\n\r\n\r\n     /* MARKET SATIS */\r\n\r\n\r\n      insert into @TABLE_SAT_DAG \r\n      (ID,PARENTID,GRP_ID,ACK,GUN_SAY,GUN_ORT,TUTAR,YUZDE)\r\n       VALUES (@id,@parentid,@GRP_ID,'MARKET SATIŞLARI',0,0,0,0)\r\n\r\n\r\n      SELECT \r\n       @gun_say=isnull(DATEDIFF(day,@BAS_TAR,@BIT_TAR)+1,1),\r\n       @top_tutar=isnull(SUM(\r\n       CASE \r\n       WHEN (@KDVTIP=1) and (h.islmtip='satis') then  (h.mik*h.brmfiy)\r\n       WHEN (@KDVTIP=1) and (h.islmtip='iade') then -1*(h.mik*h.brmfiy)\r\n       WHEN (@KDVTIP=0) and (h.islmtip='satis') then \r\n       ((h.mik*h.brmfiy) / (1+h.kdvyuz))\r\n       WHEN (@KDVTIP=0) and (h.islmtip='iade') then \r\n       -1*((h.mik*h.brmfiy) / (1+h.kdvyuz))\r\n       end),0) \r\n       \r\n       FROM  \r\n       marsathrk as h\r\n       inner join marvardimas as m \r\n       on h.varno=m.varno and m.sil=0 and h.sil=0\r\n       where m.tarih>=@BAS_TAR and m.tarih<=@BIT_TAR\r\n       and m.varok=1\r\n       \r\n    \r\n      update @TABLE_SAT_DAG set \r\n      GUN_SAY=@gun_say,\r\n      TUTAR=@top_tutar,\r\n      GUN_ORT=@top_tutar/@gun_say\r\n       WHERE Id=@id\r\n       \r\n       \r\n       \r\n       \r\n       \r\n       \r\n  \r\n    /*TOPLAM */\r\n   \r\n      select @top_tutar=SUM(TUTAR),\r\n      @gun_say=MAX(GUN_SAY) \r\n      from @TABLE_SAT_DAG \r\n      WHERE GRP_ID=@GRP_ID\r\n  \r\n  \r\n  \r\n      UPDATE @TABLE_SAT_DAG \r\n      SET YUZDE=case when @top_tutar>0 then \r\n      (TUTAR*100)/@top_tutar else 0 end \r\n      WHERE GRP_ID=@GRP_ID\r\n      \r\n    \r\n\r\n  \r\n      UPDATE @TABLE_SAT_DAG \r\n      SET GUN_SAY=@gun_say,\r\n      GUN_ORT=case when @top_tutar>0 then \r\n      (@top_tutar/@gun_say) else 0 end,\r\n      TUTAR=@top_tutar,\r\n      YUZDE=100 where PARENTID=0\r\n      \r\n     \r\n       \r\n       \r\n       \r\n       \r\n       \r\n       \r\n   RETURN\r\n\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_Satis_Odeme_Rap",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_Satis_Odeme_Rap",
    "definition": "CREATE FUNCTION [dbo].[UDF_Satis_Odeme_Rap] (\r\n@firmano \t\tint,\r\n@Sat_BasTar\t\tDatetime,\r\n@Sat_BitTar\t\tDatetime,\r\n@Ode_BasTar\t\tDatetime,\r\n@Ode_BitTar\t\tDatetime)\r\nRETURNS\r\n   \r\n   @TABLE_BAKIYE_SATIS TABLE (\r\n   id\t\t\t\t\tint IDENTITY(1, 1) NOT NULL,\r\n   Cari_Tip\t\t\t\tVARCHAR(30) COLLATE Turkish_CI_AS,\r\n   Cari_Kod\t\t\t\tVARCHAR(30) COLLATE Turkish_CI_AS,\r\n   Cari_Unvan\t\t\tVARCHAR(200) COLLATE Turkish_CI_AS,\r\n   Satis_Top\t\t\tfloat,\r\n   Odeme_Top\t\t    float,\r\n   Bakiye\t\t\t\tfloat,\r\n   Limit_Top\t\t\tFloat,\r\n   Limit_Fark\t\t\tFloat)\r\n\r\nAS\r\nBEGIN\r\n \r\n\r\n\r\n   declare  @TABLE_BAKIYE TABLE (\r\n   id\t\t\t\t\tint IDENTITY(1, 1) NOT NULL,\r\n   Cari_Tip\t\t\t\tVARCHAR(30) COLLATE Turkish_CI_AS,\r\n   Cari_Kod\t\t\t\tVARCHAR(30) COLLATE Turkish_CI_AS,\r\n   Cari_Unvan\t\t\tVARCHAR(200) COLLATE Turkish_CI_AS,\r\n   Satis_Top\t\t\tfloat,\r\n   Odeme_Top\t\t    float,\r\n   Bakiye\t\t\t\tfloat,\r\n   Limit_Top\t\t\tFloat,\r\n   Fark_Top\t\t\t\tFloat )\r\n\r\n\r\n /*satıs borc */\r\n  if @firmano=0\r\n  insert into @TABLE_BAKIYE \r\n  (Cari_Tip,Cari_Kod,Cari_Unvan,Satis_Top,Odeme_Top,Bakiye)\r\n  select k.tip,k.kod,k.Unvan,Borc,0 Odeme_Top,0 Bakiye \r\n  from carihrk as h\r\n  inner join Genel_Cari_Kart as k \r\n  on h.cartip=k.cartip and h.carkod=k.kod\r\n  and h.sil=0 and k.CarTip_id=1\r\n  where h.tarih>=@Sat_BasTar\r\n  and h.tarih<=@Sat_BitTar\r\n  and Borc>0 \r\n  \r\n  \r\n  if @firmano>0\r\n  insert into @TABLE_BAKIYE\r\n  (Cari_Tip,Cari_Kod,Cari_Unvan,Satis_Top,Odeme_Top,Bakiye)\r\n  select k.tip,k.kod,k.Unvan,Borc,0 Odeme_Top,0 Bakiye \r\n  from carihrk as h\r\n  inner join Genel_Cari_Kart as k \r\n  on h.cartip=k.cartip and h.carkod=k.kod\r\n  and h.sil=0 and k.CarTip_id=1\r\n  and h.firmano in (0,@firmano)\r\n  where h.tarih>=@Sat_BasTar\r\n  and h.tarih<=@Sat_BitTar\r\n  and Borc>0 \r\n  \r\n  \r\n  \r\n  \r\n  /*odeme toplam */\r\n  if @firmano=0\r\n  insert into @TABLE_BAKIYE\r\n  (Cari_Tip,Cari_Kod,Cari_Unvan,Satis_Top,Odeme_Top,Bakiye)\r\n  select k.tip,k.kod,k.Unvan,0,Alacak,0 Bakiye\r\n  from carihrk as h\r\n  inner join Genel_Cari_Kart as k \r\n  on h.cartip=k.cartip and h.carkod=k.kod\r\n  and h.sil=0 and k.CarTip_id=1\r\n  where h.tarih>=@Ode_BasTar\r\n  and h.tarih<=@Ode_BitTar\r\n  and alacak>0 \r\n\r\n  if @firmano>0\r\n  insert into @TABLE_BAKIYE\r\n  (Cari_Tip,Cari_Kod,Cari_Unvan,Satis_Top,Odeme_Top,Bakiye)\r\n  select k.tip,k.kod,k.Unvan,0,Alacak,0 Bakiye \r\n  from carihrk as h\r\n  inner join Genel_Cari_Kart as k \r\n  on h.cartip=k.cartip and h.carkod=k.kod\r\n  and h.sil=0 and k.CarTip_id=1\r\n  and h.firmano in (0,@firmano)\r\n  where h.tarih>=@Ode_BasTar\r\n  and h.tarih<=@Ode_BitTar\r\n  and alacak>0 \r\n\r\n  insert into @TABLE_BAKIYE_SATIS\r\n  (Cari_Tip,Cari_Kod,Cari_Unvan,Satis_Top,Odeme_Top,Bakiye)\r\n  select Cari_Tip,Cari_Kod,Cari_Unvan,\r\n  sum(Satis_Top),sum(Odeme_Top),sum(Satis_Top-Odeme_Top) Bakiye\r\n  from  @TABLE_BAKIYE\r\n  group by Cari_Tip,Cari_Kod,Cari_Unvan \r\n  \r\n  \r\n  \r\n  update  @TABLE_BAKIYE_SATIS set Limit_Top=dt.Risk_Limit\r\n  ,Limit_Fark=dt.Risk_Limit-Bakiye from @TABLE_BAKIYE_SATIS as t \r\n  join (Select k.kod,ISNULL(k.Risk_Limit,0) Risk_Limit\r\n    from Cari_Kart_Listesi as k )\r\n  dt on t.Cari_Kod=dt.kod\r\n  \r\n \r\n\r\n\r\n RETURN\r\n\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_Satis_Odeme_Rap_Hrk",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_Satis_Odeme_Rap_Hrk",
    "definition": "CREATE FUNCTION [dbo].[UDF_Satis_Odeme_Rap_Hrk] (\r\n@firmano \t\tint,\r\n@Sat_BasTar\t\tDatetime,\r\n@Sat_BitTar\t\tDatetime,\r\n@Ode_BasTar\t\tDatetime,\r\n@Ode_BitTar\t\tDatetime)\r\nRETURNS\r\n   \r\n   @TABLE_BAKIYE_SATIS TABLE (\r\n   id\t\t\t\t\tint IDENTITY(1, 1) NOT NULL,\r\n   Cari_Tip\t\t\t\tVARCHAR(30) COLLATE Turkish_CI_AS,\r\n   Cari_Kod\t\t\t\tVARCHAR(30) COLLATE Turkish_CI_AS,\r\n   Cari_Unvan\t\t\tVARCHAR(200) COLLATE Turkish_CI_AS,\r\n   Tarih\t\t\t\tDatetime,\r\n   Islem_Ad\t\t\t\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n   Satis_Top\t\t\tfloat,\r\n   Odeme_Top\t\t    float)\r\n\r\nAS\r\nBEGIN\r\n \r\n\r\n\r\n   declare  @TABLE_BAKIYE TABLE (\r\n   id\t\t\t\t\tint IDENTITY(1, 1) NOT NULL,\r\n   Cari_Tip\t\t\t\tVARCHAR(30) COLLATE Turkish_CI_AS,\r\n   Cari_Kod\t\t\t\tVARCHAR(30) COLLATE Turkish_CI_AS,\r\n   Cari_Unvan\t\t\tVARCHAR(200) COLLATE Turkish_CI_AS,\r\n   Tarih\t\t\t\tDatetime,\r\n   Islem_Ad\t\t\t\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n   Satis_Top\t\t\tfloat,\r\n   Odeme_Top\t\t    float)\r\n\r\n\r\n /*satis borc */\r\n  if @firmano=0\r\n  insert into @TABLE_BAKIYE\r\n  select k.tip,k.kod,k.Unvan,\r\n  h.tarih,h.islmhrkad,\r\n  Borc,0 Odeme_Top  \r\n  from carihrk as h\r\n  inner join Genel_Cari_Kart as k \r\n  on h.cartip=k.cartip and h.carkod=k.kod\r\n  and h.sil=0 and k.CarTip_id=1\r\n  where h.tarih>=@Sat_BasTar\r\n  and h.tarih<=@Sat_BitTar\r\n  and Borc>0 \r\n  \r\n  \r\n  if @firmano>0\r\n  insert into @TABLE_BAKIYE\r\n  select k.tip,k.kod,k.Unvan,\r\n  h.tarih,h.islmhrkad,\r\n  Borc,0 Odeme_Top  \r\n  from carihrk as h\r\n  inner join Genel_Cari_Kart as k \r\n  on h.cartip=k.cartip and h.carkod=k.kod\r\n  and h.sil=0 and k.CarTip_id=1\r\n  and h.firmano in (0,@firmano)\r\n  where h.tarih>=@Sat_BasTar\r\n  and h.tarih<=@Sat_BitTar\r\n  and Borc>0 \r\n  \r\n  \r\n  \r\n  \r\n  /*odeme toplam */\r\n  if @firmano=0\r\n  insert into @TABLE_BAKIYE\r\n  select k.tip,k.kod,k.Unvan,\r\n  h.tarih,h.islmhrkad,\r\n  0,Alacak  \r\n  from carihrk as h\r\n  inner join Genel_Cari_Kart as k \r\n  on h.cartip=k.cartip and h.carkod=k.kod\r\n  and h.sil=0 and k.CarTip_id=1\r\n  where h.tarih>=@Ode_BasTar\r\n  and h.tarih<=@Ode_BitTar\r\n  and alacak>0 \r\n\r\n  if @firmano>0\r\n  insert into @TABLE_BAKIYE\r\n  select k.tip,k.kod,k.Unvan,\r\n  h.tarih,h.islmhrkad,\r\n  0,Alacak  \r\n  from carihrk as h\r\n  inner join Genel_Cari_Kart as k \r\n  on h.cartip=k.cartip and h.carkod=k.kod\r\n  and h.sil=0 and k.CarTip_id=1\r\n  and h.firmano in (0,@firmano)\r\n  where h.tarih>=@Ode_BasTar\r\n  and h.tarih<=@Ode_BitTar\r\n  and alacak>0 \r\n\r\n  insert into @TABLE_BAKIYE_SATIS\r\n  select Cari_Tip,Cari_Kod,Cari_Unvan,\r\n  Tarih,Islem_Ad,\r\n  (Satis_Top),(Odeme_Top)\r\n  from  @TABLE_BAKIYE\r\n  order by Cari_Tip,Cari_Kod,Cari_Unvan \r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n RETURN\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_Satis_Personel_Rap",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_Satis_Personel_Rap",
    "definition": "CREATE FUNCTION [dbo].[UDF_Satis_Personel_Rap] (\r\n@firmano \t\tint,\r\n@Sat_BasTar\t\tDatetime,\r\n@Sat_BitTar\t\tDatetime)\r\nRETURNS\r\n   \r\n   @TABLE_BAKIYE_SATIS TABLE (\r\n   id\t\t\t\t\tint IDENTITY(1, 1) NOT NULL,\r\n   Per_id\t\t\t\tint,\r\n   Per_Kod\t\t\t\tVARCHAR(30) COLLATE Turkish_CI_AS,\r\n   Per_Unvan\t\t\tVARCHAR(200) COLLATE Turkish_CI_AS,\r\n   Satis_Tutar\t\t\tfloat,\r\n   Satis_Litre\t\t    float)\r\n\r\nAS\r\nBEGIN\r\n \r\n\r\n\r\n   declare  @TABLE_BAKIYE TABLE (\r\n   id\t\t\t\t\tint IDENTITY(1, 1) NOT NULL,\r\n   Per_id\t\t\t\tint,\r\n   Per_Kod\t\t\t\tVARCHAR(30) COLLATE Turkish_CI_AS,\r\n   Per_Unvan\t\t\tVARCHAR(200) COLLATE Turkish_CI_AS,\r\n   Yakit_Tip\t\t\tVARCHAR(30) COLLATE Turkish_CI_AS, \r\n   Yakit_Kod\t\t\tVARCHAR(30) COLLATE Turkish_CI_AS,\r\n   Satis_Tutar\t\t\tfloat,\r\n   Satis_Litre\t\t    float)\r\n\r\n\r\n /*satıs borc */\r\n  if @firmano=0\r\n  insert into @TABLE_BAKIYE (Per_id,Per_Kod,Per_Unvan,Yakit_Tip,Yakit_Kod,\r\n  Satis_Tutar,Satis_Litre)\r\n  select k.id,k.kod,k.ad+' '+k.soyad Unvan,h.stktip,h.stkod,\r\n  ((h.brmfiy*h.mik)+h.otvtut)*(1+h.kdvyuz) TUTARKDVLI,\r\n  h.mik \r\n  from Faturamas as m\r\n  inner join faturahrk as h on m.fatid=h.fatid\r\n  and m.sil=0 and h.sil=0  \r\n  inner join perkart as k \r\n  on m.per_id=k.id\r\n  where m.tarih>=@Sat_BasTar\r\n  and m.tarih<=@Sat_BitTar\r\n  and Per_id>0 \r\n  \r\n  \r\n  if @firmano>0\r\n  insert into @TABLE_BAKIYE (Per_id,Per_Kod,Per_Unvan,Yakit_Tip,Yakit_Kod,\r\n  Satis_Tutar,Satis_Litre)\r\n  select k.id,k.kod,k.ad+' '+k.soyad Unvan,h.stktip,h.stkod,\r\n  ((h.brmfiy*h.mik)+h.otvtut)*(1+h.kdvyuz) TUTARKDVLI,\r\n  h.mik\r\n  from Faturamas as m\r\n  inner join faturahrk as h on m.fatid=h.fatid\r\n  and m.sil=0 and h.sil=0  \r\n  inner join perkart as k \r\n  on m.per_id=k.id\r\n  where m.tarih>=@Sat_BasTar\r\n  and m.tarih<=@Sat_BitTar\r\n  and m.firmano in (0,@firmano)\r\n  and Per_id>0 \r\n  \r\n   \r\n  \r\n  \r\n \r\n\r\n  insert into @TABLE_BAKIYE_SATIS\r\n  (Per_id,Per_Kod,Per_Unvan, Satis_Tutar,Satis_Litre)\r\n  select Per_id,Per_Kod,Per_Unvan,\r\n  sum(Satis_Tutar),sum(Satis_Litre)\r\n  from  @TABLE_BAKIYE\r\n  group by Per_id,Per_Kod,Per_Unvan\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n RETURN\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_Satis_Personel_Rap_Hrk",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_Satis_Personel_Rap_Hrk",
    "definition": "CREATE FUNCTION [dbo].[UDF_Satis_Personel_Rap_Hrk] (\r\n@firmano \t\tint,\r\n@Sat_BasTar\t\tDatetime,\r\n@Sat_BitTar\t\tDatetime)\r\nRETURNS\r\n   \r\n   @TABLE_BAKIYE_SATIS TABLE (\r\n   id\t\t\t\t\tint IDENTITY(1, 1) NOT NULL,\r\n   Per_id\t\t\t\tint,\r\n   Per_Kod\t\t\t\tVARCHAR(30) COLLATE Turkish_CI_AS,\r\n   Per_Unvan\t\t\tVARCHAR(200) COLLATE Turkish_CI_AS,\r\n   Yakit_Tip\t\t\tVARCHAR(30) COLLATE Turkish_CI_AS, \r\n   Yakit_Kod\t\t\tVARCHAR(30) COLLATE Turkish_CI_AS,\r\n   Yakit_Ad\t\t\t    VARCHAR(50) COLLATE Turkish_CI_AS,\r\n   Satis_Tutar\t\t\tfloat,\r\n   Satis_Litre\t\t    float)\r\n\r\nAS\r\nBEGIN\r\n \r\n\r\n\r\n   declare  @TABLE_BAKIYE TABLE (\r\n   id\t\t\t\t\tint IDENTITY(1, 1) NOT NULL,\r\n   Per_id\t\t\t\tint,\r\n   Per_Kod\t\t\t\tVARCHAR(30) COLLATE Turkish_CI_AS,\r\n   Per_Unvan\t\t\tVARCHAR(200) COLLATE Turkish_CI_AS,\r\n   Yakit_Tip\t\t\tVARCHAR(30) COLLATE Turkish_CI_AS, \r\n   Yakit_Kod\t\t\tVARCHAR(30) COLLATE Turkish_CI_AS,\r\n   Satis_Tutar\t\t\tfloat,\r\n   Satis_Litre\t\t    float)\r\n\r\n\r\n\r\n  if @firmano=0\r\n  insert into @TABLE_BAKIYE (Per_id,Per_Kod,Per_Unvan,Yakit_Tip,Yakit_Kod,\r\n  Satis_Tutar,Satis_Litre)\r\n  select k.id,k.kod,k.ad+' '+k.soyad Unvan,h.stktip,h.stkod,\r\n  ((h.brmfiy*h.mik)+h.otvtut)*(1+h.kdvyuz) TUTARKDVLI,\r\n  h.mik \r\n  from Faturamas as m\r\n  inner join faturahrk as h on m.fatid=h.fatid\r\n  and m.sil=0 and h.sil=0  \r\n  inner join perkart as k \r\n  on m.per_id=k.id\r\n  where m.tarih>=@Sat_BasTar\r\n  and m.tarih<=@Sat_BitTar\r\n  and Per_id>0 \r\n  \r\n  \r\n  if @firmano>0\r\n  insert into @TABLE_BAKIYE (Per_id,Per_Kod,Per_Unvan,Yakit_Tip,Yakit_Kod,\r\n  Satis_Tutar,Satis_Litre)\r\n  select k.id,k.kod,k.ad+' '+k.soyad Unvan,h.stktip,h.stkod,\r\n  ((h.brmfiy*h.mik)+h.otvtut)*(1+h.kdvyuz) TUTARKDVLI,\r\n  h.mik\r\n  from Faturamas as m\r\n  inner join faturahrk as h on m.fatid=h.fatid\r\n  and m.sil=0 and h.sil=0  \r\n  inner join perkart as k \r\n  on m.per_id=k.id\r\n  where m.tarih>=@Sat_BasTar\r\n  and m.tarih<=@Sat_BitTar\r\n  and m.firmano in (0,@firmano)\r\n  and Per_id>0 \r\n  \r\n   \r\n  \r\n  \r\n \r\n\r\n  insert into @TABLE_BAKIYE_SATIS \r\n  (Per_id,Per_Kod,Per_Unvan,Yakit_Tip,Yakit_Kod,Yakit_Ad,Satis_Tutar,Satis_Litre)\r\n  select Per_id,Per_Kod,Per_Unvan,Yakit_Tip,Yakit_Kod,'',sum(Satis_Tutar),sum(Satis_Litre)\r\n  from  @TABLE_BAKIYE\r\n  group by Per_id,Per_Kod,Per_Unvan,Yakit_Tip,Yakit_Kod\r\n  \r\n  \r\n  \r\n  update @TABLE_BAKIYE_SATIS set Yakit_Ad=dt.ad from @TABLE_BAKIYE_SATIS as t\r\n  join (Select tip,kod,ad from stokkart) dt on dt.Tip=t.Yakit_Tip and dt.kod=t.Yakit_Kod\r\n\r\n\r\n\r\n\r\n RETURN\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_SAYACFIYATDEGISIM",
    "type": "SQL_INLINE_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_SAYACFIYATDEGISIM",
    "definition": "CREATE FUNCTION [dbo].UDF_SAYACFIYATDEGISIM (\r\n@SAYACKODIN        \tVARCHAR(8000),\r\n@TARIH1 \t\t\tDATETIME,\r\n@TARIH2 \t\t\tDATETIME)\r\nRETURNS TABLE AS\r\nRETURN\r\n(\r\nselect ps.sayackod as SAYACKOD,ps.stkod AS STOK_KOD,st.ad AS STOK_AD,\r\nconvert(varchar,min(kaptar),104)+' - '+convert(varchar,max(kaptar),104) as TARIH,\r\nsum(ps.satmik) AS MIKTAR,st.brim AS BRIM,max(kaptar) AS KAPTARIH,\r\nps.brimfiy as BRIMFIYAT,(ps.brimfiy*sum(ps.satmik)) AS TUTAR\r\n FROM pomvardisayac as ps\r\n inner join stokkart as st on ps.stkod=st.kod and st.tip=ps.stktip\r\n inner join sayackart as sy on sy.kod=ps.sayackod\r\n inner join pomvardimas as pom on ps.varno=pom.varno and pom.sil=0\r\n AND kaptar>=@TARIH1  AND kaptar<=@TARIH2\r\n where PS.sayackod in (select * from CsvToSTR(@SAYACKODIN)) \r\n and ps.satmik>0 and ps.varok=1\r\n group by ps.sayackod,ps.stkod,st.ad,st.brim,ps.brimfiy\r\n\r\n\r\n)"
  },
  {
    "schema": "dbo",
    "name": "UDF_SAYACPDA_HRK",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_SAYACPDA_HRK",
    "definition": "CREATE FUNCTION [dbo].UDF_SAYACPDA_HRK (@TARIH1 DATETIME, @TARIH2 DATETIME, @SAAT1 VARCHAR(8), @SAAT2 VARCHAR(8))\r\nRETURNS\r\n  @TB_SAYAC_PDA TABLE (\r\n    SIRA_NO        INT,\r\n    SAYAC_KOD   VARCHAR(20)  COLLATE Turkish_CI_AS,\r\n    STOK_KOD    VARCHAR(20)  COLLATE Turkish_CI_AS,\r\n    LITRE       FLOAT,\r\n    TUTAR       FLOAT)\r\nAS\r\nBEGIN\r\n  DECLARE @SAYAC_PDA_TEMP TABLE (\r\n    SIRA_NO        INT,\r\n    SAYAC_KOD   VARCHAR(20)  COLLATE Turkish_CI_AS,\r\n    STOK_KOD    VARCHAR(20)  COLLATE Turkish_CI_AS,\r\n    LITRE       FLOAT,\r\n    TUTAR       FLOAT)\r\n    \r\n  DECLARE @HRK_SIRANO      INT\r\n  DECLARE @HRK_SAYAC_KOD   VARCHAR(20)\r\n  DECLARE @HRK_STOK_KOD    VARCHAR(20)\r\n  DECLARE @HRK_LITRE       FLOAT\r\n  DECLARE @HRK_TUTAR       FLOAT\r\n\r\n /*---------------------------------------------------------------------------- */\r\n SET @HRK_SIRANO=0\r\n SET @HRK_LITRE=0\r\n SET @HRK_TUTAR=0\r\n\r\n DECLARE PDA_SAYAC_CUR CURSOR FAST_FORWARD FOR\r\n  SELECT k.kod,t.bagak from sayackart as k inner join tankkart as t on t.kod=k.tankod\r\n   where t.sil=0 and k.sil=0 and k.drm='Aktif' order by k.kod\r\n   OPEN PDA_SAYAC_CUR\r\n   FETCH NEXT FROM PDA_SAYAC_CUR INTO @HRK_SAYAC_KOD,@HRK_STOK_KOD\r\n\r\n    WHILE @@FETCH_STATUS = 0\r\n      BEGIN\r\n      SET @HRK_SIRANO = @HRK_SIRANO + 1\r\n\r\n      INSERT @SAYAC_PDA_TEMP\r\n      SELECT  @HRK_SIRANO,@HRK_SAYAC_KOD,@HRK_STOK_KOD,\r\n      @HRK_LITRE,@HRK_TUTAR\r\n\r\n    FETCH NEXT FROM PDA_SAYAC_CUR INTO @HRK_SAYAC_KOD,@HRK_STOK_KOD\r\n  END\r\n\r\n  CLOSE PDA_SAYAC_CUR\r\n  DEALLOCATE PDA_SAYAC_CUR\r\n\r\n\r\n  INSERT @TB_SAYAC_PDA\r\n    SELECT SIRA_NO,SAYAC_KOD,STOK_KOD,LITRE,TUTAR\r\n     FROM @SAYAC_PDA_TEMP\r\n\r\n  RETURN\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_SAYACVARMI",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_SAYACVARMI",
    "definition": "CREATE FUNCTION UDF_SAYACVARMI ()\r\nRETURNS\r\n   @TB_BOS_SAYAC TABLE (\r\n    FIRMANO     INT,\r\n    SAYACKOD    VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    ADAID       FLOAT,\r\n    ADAAD       VARCHAR(50)  COLLATE Turkish_CI_AS)\r\nAS\r\nBEGIN\r\n\r\n/*(@firmano int) */\r\n\r\n\r\n\r\n   DECLARE @TABLE_TEMP TABLE (\r\n   id\t\t\t\t\tint,\r\n   SAYACKOD\t\t\t    VARCHAR(50) COLLATE Turkish_CI_AS\r\n   )\r\n\r\ninsert into @TABLE_TEMP (SAYACKOD)\r\nselect t.sayackod from pomvardisayac t with (NOLOCK)\r\n inner join pomvardimas as m with (NOLOCK) on m.varno=t.varno\r\nwhere t.varok=0 and t.sil=0 and m.sil=0  group by t.sayackod\r\n\r\n insert into @TB_BOS_SAYAC (FIRMANO,SAYACKOD,ADAID,ADAAD)\r\n select s.firmano,s.kod,g.id,g.ad from sayackart as s with (NOLOCK) \r\n inner join grup as g with (NOLOCK) on\r\n s.grp1=g.id where s.drm='Aktif' and s.sil=0\r\n\r\n\r\n\r\n\r\n delete from @TB_BOS_SAYAC \r\n where SAYACKOD in (Select SAYACKOD FROM @TABLE_TEMP )\r\n\r\n\r\n\r\nRETURN\r\n\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_SIP_SEVIYE",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_SIP_SEVIYE",
    "definition": "CREATE FUNCTION [dbo].UDF_SIP_SEVIYE(\r\n@FIRMANO     INT,\r\n@STK_TIP     VARCHAR(30),\r\n@STK_KODIN\t VARCHAR(8000))\r\nRETURNS\r\n    @TB_DEP_SIP_SEVIYE TABLE (\r\n    STOK_KOD  \t\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n    STOK_AD    \t\tVARCHAR(100) COLLATE Turkish_CI_AS,\r\n    DEPO_KOD    \t\tVARCHAR(30) COLLATE Turkish_CI_AS,\r\n    DEPO_AD    \t\tVARCHAR(100) COLLATE Turkish_CI_AS,\r\n    BRIM       \t\tVARCHAR(30) COLLATE Turkish_CI_AS,\r\n    MEVCUTMIKTAR    FLOAT,\r\n    MINMIK     \t\tFLOAT,\r\n    FARK\t\t\tFLOAT)\r\nAS\r\nBEGIN\r\n    \r\n    \r\n   DECLARE @TB_TEMP_STOKLIST\r\n    TABLE (\r\n    DEP_KOD     varchar(50) COLLATE Turkish_CI_AS,\r\n    STK_TIP     varchar(50) COLLATE Turkish_CI_AS,\r\n    STK_KOD     varchar(50) COLLATE Turkish_CI_AS,\r\n    STK_AD     varchar(100) COLLATE Turkish_CI_AS,\r\n    STK_BRIM    varchar(50) COLLATE Turkish_CI_AS,\r\n    MIKTAR\t\tFLOAT,\r\n    MINMIK\t\tFLOAT)\r\n    \r\n    \r\n    \r\n     insert into @TB_TEMP_STOKLIST (DEP_KOD,STK_TIP,\r\n     STK_KOD,STK_AD,STK_BRIM,\r\n     MIKTAR,MINMIK)\r\n      select h.depkod,sk.tip,sk.kod,sk.ad,SK.brim,\r\n      ISNULL(SUM(h.giren-h.cikan),0),\r\n      SK.minmik\r\n       from stokkart as sk \r\n       inner join stkhrk as h on h.stktip=sk.tip \r\n       and h.stkod=sk.kod  and h.sil=0 \r\n       WHERE sk.tip=@STK_TIP and sk.sil=0\r\n       group by h.depkod,sk.tip,sk.kod,sk.ad,SK.brim,SK.minmik\r\n       \r\n   \r\n   \r\n     insert into @TB_DEP_SIP_SEVIYE \r\n      (DEPO_KOD,DEPO_AD,STOK_KOD,STOK_AD,\r\n      BRIM,MEVCUTMIKTAR,MINMIK,FARK)\r\n     select DEP_KOD,'',STK_KOD,STK_AD,STK_BRIM,\r\n     MIKTAR,MINMIK,(MINMIK-MIKTAR) from \r\n     @TB_TEMP_STOKLIST where (MIKTAR-MINMIK)<=MINMIK\r\n    \r\n    \r\n   /* if @STK_TIP='akykt' */\r\n    UPDATE @TB_DEP_SIP_SEVIYE \r\n    SET DEPO_AD=DT.AD FROM @TB_DEP_SIP_SEVIYE as  t\r\n    join (select k.kod,k.ad from Depo_Kart_Listesi as k ) dt\r\n    on dt.kod=t.DEPO_KOD \r\n\r\n\r\n\r\n  RETURN\r\n\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_STOK_BARKOD",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_STOK_BARKOD",
    "definition": "CREATE  FUNCTION UDF_STOK_BARKOD (\r\n@firmano int,\r\n@stokin VARCHAR(8000),\r\n@tip VARCHAR(30),\r\n@bassayi int,\r\n@satirsayi int,\r\n@FiyatSec int)\r\nRETURNS\r\n  @TB_BARKOD TABLE (\r\n    STOK_KOD        VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    STOK_AD         VARCHAR(100) COLLATE Turkish_CI_AS,\r\n    BARKOD          VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    EAN             INT,\r\n    SATISFIYATKDVLI FLOAT,\r\n    SATPARABIRIM    VARCHAR(10) COLLATE Turkish_CI_AS,\r\n    SATISFIYATDEGISIMTARIH  DATETIME,\r\n    SATISBIRIMFIYATKDVLI FLOAT,\r\n    SATISOLCUMBIRIM      VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    \r\n    /*SATISFIYATKDVLI2 FLOAT,\r\n    SATPARABIRIM2    VARCHAR(10) COLLATE Turkish_CI_AS,\r\n    SATISFIYATDEGISIMTARIH2  DATETIME,\r\n    SATISFIYATKDVLI3 FLOAT,\r\n    SATPARABIRIM3    VARCHAR(10) COLLATE Turkish_CI_AS,\r\n    SATISFIYATDEGISIMTARIH3  DATETIME,\r\n    */\r\n    SATISFIYATKDVLI4 FLOAT,\r\n    SATPARABIRIM4    VARCHAR(10) COLLATE Turkish_CI_AS,\r\n    SATISFIYATDEGISIMTARIH4  DATETIME,\r\n    SATISBIRIMFIYATKDVLI4 FLOAT,\r\n    YERLI\t\t\t     BIT DEFAULT 0,\r\n    URETIMYERID\t\t\t INT DEFAULT 0,\r\n    URETIMYERAD\t\t\tVARCHAR(100) COLLATE Turkish_CI_AS,\r\n    KALANMIKTAR FLOAT   DEFAULT 0\r\n    )\r\nAS\r\nBEGIN\r\n\r\n  DECLARE @HRK_STOK_KOD    VARCHAR(30)\r\n  DECLARE @HRK_STOK_AD     VARCHAR(50)\r\n  DECLARE @HRK_BARKOD      VARCHAR(20)\r\n  DECLARE @HRK_EAN         INT\r\n  \r\n  DECLARE @HRK_SATISFKDVLI1 FLOAT\r\n  DECLARE @HRK_SATPBRM1     VARCHAR(8)\r\n  DECLARE @HRK_SATISDEGISIMTARIH1 DATETIME\r\n  \r\n  DECLARE @HRK_SATISFKDVLI2 FLOAT\r\n  DECLARE @HRK_SATPBRM2     VARCHAR(8)\r\n  DECLARE @HRK_SATISDEGISIMTARIH2 DATETIME\r\n  \r\n  DECLARE @HRK_SATISFKDVLI3 FLOAT\r\n  DECLARE @HRK_SATPBRM3     VARCHAR(8)\r\n  DECLARE @HRK_SATISDEGISIMTARIH3 DATETIME\r\n  \r\n  DECLARE @HRK_SATISFKDVLI4 FLOAT\r\n  DECLARE @HRK_SATPBRM4     VARCHAR(8)\r\n  DECLARE @HRK_SATISDEGISIMTARIH4 DATETIME\r\n  \r\n  DECLARE @HRK_URETIMYERID     INT\r\n  DECLARE @HRK_YERLI           BIT\r\n  \r\n  \r\n  DECLARE @HRK_OLCUMBIRIMID     INT\r\n  DECLARE @HRK_OLCUMBIRIMCARPAN FLOAT\r\n  \r\n  \r\n  Declare @MarketSubeFiyat Bit\r\n  \r\n  Select top 1 @MarketSubeFiyat=Market_Sube From SistemTanim\r\n  \r\n  \r\n  \r\n  DECLARE @i               INT\r\n  DECLARE @HRK_ONSTOK_KOD  VARCHAR(30)\r\n\r\n\r\n DECLARE @EKSTRE_TEMP TABLE (\r\n stokid      int)\r\n declare @separator char(1)\r\n set @separator = ','\r\n\r\n declare @separator_position int\r\n declare @array_value varchar(1000)\r\n\r\n IF (LEN(RTRIM(@stokin)) > 0)\r\n BEGIN\r\n  set @stokin = @stokin + ','\r\n END\r\n\r\n while patindex('%,%' , @stokin) <> 0\r\n begin\r\n\r\n   select @separator_position =  patindex('%,%' , @stokin)\r\n   select @array_value = left(@stokin, @separator_position - 1)\r\n\r\n  Insert @EKSTRE_TEMP\r\n  Values (Cast(@array_value as float))\r\n  select @stokin = stuff(@stokin, 1, @separator_position, '')\r\n end\r\n\r\n\r\n   SET @HRK_ONSTOK_KOD=''\r\n\r\n  if isnull(@MarketSubeFiyat,0)=0\r\n   DECLARE BARKOD_HRK CURSOR FAST_FORWARD FOR\r\n    SELECT\r\n    st.kod,st.ad,MIN(bd.BARKOD),LEN(MIN(bd.BARKOD)),\r\n    case when sat1kdvtip='Dahil' then sat1fiy\r\n    else sat1fiy*(1+(sat1kdv/100)) end,\r\n    sat1pbrm AS SATPARABIRIM,\r\n    case when sat2kdvtip='Dahil' then sat2fiy\r\n    else sat2fiy*(1+(sat2kdv/100)) end,\r\n    sat2pbrm AS SATPARABIRIM,\r\n    case when sat3kdvtip='Dahil' then sat3fiy\r\n    else sat3fiy*(1+(sat3kdv/100)) end,\r\n    sat3pbrm AS SATPARABIRIM,\r\n    case when sat4kdvtip='Dahil' then sat4fiy\r\n    else sat4fiy*(1+(sat4kdv/100)) end,\r\n    sat4pbrm AS SATPARABIRIM,\r\n    st.Yerli,st.UretimYerId,\r\n    st.SatisFiyat1DegisimTarih,st.SatisFiyat2DegisimTarih,\r\n    st.SatisFiyat3DegisimTarih,st.SatisFiyat4DegisimTarih,\r\n    st.OlcumBirimId,isnull(st.OlcumBirimCarpan,0) OlcumBirimCarpan \r\n    from stokkart as st with (nolock)\r\n    inner join barkod bd with (nolock) on bd.kod=st.kod and bd.tip=st.tip\r\n    where st.sil=0 and bd.sil=0 and st.tip=@tip and bd.master=1\r\n    and st.id IN (SELECT * FROM @EKSTRE_TEMP )\r\n    group by st.kod,st.ad,\r\n    sat1kdvtip,sat1fiy,sat1pbrm,sat1kdv,\r\n    sat2kdvtip,sat2fiy,sat2pbrm,sat2kdv,\r\n    sat3kdvtip,sat3fiy,sat3pbrm,sat3kdv,\r\n    sat4kdvtip,sat4fiy,sat4pbrm,sat4kdv,\r\n    st.Yerli,st.UretimYerId,\r\n    st.SatisFiyat1DegisimTarih,st.SatisFiyat2DegisimTarih,\r\n    st.SatisFiyat3DegisimTarih,st.SatisFiyat4DegisimTarih,\r\n    st.OlcumBirimId,st.OlcumBirimCarpan\r\n    order by st.kod\r\n    \r\n    \r\n   if isnull(@MarketSubeFiyat,0)=1\r\n    begin\r\n    \r\n      Declare @TB_STOK_FIYAT TABLE (\r\n      FirmaNo\t\t\tint,\r\n      Stktip_id    \ttinyint,\r\n      Stk_id     \t\tint,\r\n      SatisFiyat1      \t\tFloat,\r\n      SatisFiyat2      \t\tFloat,\r\n      SatisFiyat3      \t\tFloat,\r\n      SatisFiyat4      \t\tFloat,\r\n      SatisFiyat1DegisimTarih  datetime,\r\n      SatisFiyat2DegisimTarih  datetime,\r\n      SatisFiyat3DegisimTarih  datetime,\r\n      SatisFiyat4DegisimTarih  datetime,\r\n     \r\n      ParaBrm\t\t\tVARCHAR(20) COLLATE Turkish_CI_AS)\r\n      \r\n      \r\n       /*Satış Fiyat 1  */\r\n       insert @TB_STOK_FIYAT (FirmaNo,Stktip_id,Stk_id,SatisFiyat1,ParaBrm,\r\n       SatisFiyat1DegisimTarih) \r\n       Select FirmaNo,Stktip_id,Stk_id,\r\n       SatisFiyat1=case \r\n       when Kdvtip=1 then Fiyat \r\n       when Kdvtip=0 then Fiyat*(1+(Kdv/100))\r\n       end,\r\n       ParaBrm,FiyatDegisimTarih  \r\n       from Stok_Fiyat with (nolock) \r\n       where Firmano=@Firmano and Stktip_id=2 \r\n       and FiyTip=2 and FiyNo=1\r\n       \r\n       \r\n       /*Satış Fiyat 2 */\r\n       update  @TB_STOK_FIYAT set  SatisFiyat2=Dt.Fiyat,\r\n       SatisFiyat2DegisimTarih=dt.FiyatDegisimTarih From @TB_STOK_FIYAT as t \r\n       join (Select FirmaNo,Stktip_id,Stk_id,FiyatDegisimTarih,\r\n       Fiyat=case \r\n       when Kdvtip=1 then Fiyat \r\n       when Kdvtip=0 then Fiyat*(1+(Kdv/100))\r\n       end\r\n       from Stok_Fiyat with (nolock)\r\n       where Firmano=@Firmano and Stktip_id=2 \r\n       and FiyTip=2 and FiyNo=2) dt on t.Stktip_id=Dt.Stktip_id\r\n       and t.Stk_id=dt.Stk_id \r\n       \r\n      \r\n      \r\n      /*Satış Fiyat 3 */\r\n       update  @TB_STOK_FIYAT set SatisFiyat3=Dt.Fiyat,\r\n       SatisFiyat3DegisimTarih=dt.FiyatDegisimTarih From @TB_STOK_FIYAT as t \r\n       join (Select FirmaNo,Stktip_id,Stk_id,FiyatDegisimTarih,\r\n       Fiyat=case \r\n       when Kdvtip=1 then Fiyat \r\n       when Kdvtip=0 then Fiyat*(1+(Kdv/100))\r\n       end\r\n       from Stok_Fiyat with (nolock)\r\n       where Firmano=@Firmano and Stktip_id=2 \r\n       and FiyTip=2 and FiyNo=3) dt on t.Stktip_id=Dt.Stktip_id\r\n       and t.Stk_id=dt.Stk_id \r\n      \r\n       /*Satış Fiyat 4 */\r\n       update  @TB_STOK_FIYAT set SatisFiyat4=Dt.Fiyat,\r\n       SatisFiyat4DegisimTarih=dt.FiyatDegisimTarih From @TB_STOK_FIYAT as t \r\n       join (Select FirmaNo,Stktip_id,Stk_id,FiyatDegisimTarih,\r\n       Fiyat=case \r\n       when Kdvtip=1 then Fiyat \r\n       when Kdvtip=0 then Fiyat*(1+(Kdv/100))\r\n       end\r\n       from Stok_Fiyat with (nolock)\r\n       where Firmano=@Firmano and Stktip_id=2 \r\n       and FiyTip=2 and FiyNo=4) dt on t.Stktip_id=Dt.Stktip_id\r\n       and t.Stk_id=dt.Stk_id \r\n      \r\n     \r\n      DECLARE BARKOD_HRK CURSOR FAST_FORWARD FOR\r\n      SELECT\r\n      st.kod,st.ad,MIN(bd.BARKOD),LEN(MIN(bd.BARKOD)),\r\n      fiy.SatisFiyat1,\r\n      sat1pbrm AS SATPARABIRIM,\r\n      fiy.SatisFiyat2,\r\n      sat2pbrm AS SATPARABIRIM,\r\n      fiy.SatisFiyat3,\r\n      sat3pbrm AS SATPARABIRIM,\r\n      fiy.SatisFiyat4,\r\n      sat4pbrm AS SATPARABIRIM,\r\n      st.Yerli,st.UretimYerId,\r\n      fiy.SatisFiyat1DegisimTarih,fiy.SatisFiyat2DegisimTarih,\r\n      fiy.SatisFiyat3DegisimTarih,fiy.SatisFiyat4DegisimTarih,\r\n      st.OlcumBirimId,isnull(st.OlcumBirimCarpan,0) OlcumBirimCarpan\r\n      from stokkart as st with (nolock)\r\n      inner join @TB_STOK_FIYAT as fiy on fiy.Stk_id=st.id\r\n      inner join barkod bd with (nolock) on bd.kod=st.kod and bd.tip=st.tip\r\n      where st.sil=0 and bd.sil=0 and st.tip=@tip and bd.master=1\r\n      and st.id IN (SELECT * FROM @EKSTRE_TEMP )\r\n      group by st.kod,st.ad,\r\n      SatisFiyat1,sat1pbrm,\r\n      SatisFiyat2,sat2pbrm,\r\n      SatisFiyat3,sat3pbrm,\r\n      SatisFiyat4,sat4pbrm,\r\n      st.Yerli,st.UretimYerId,\r\n      fiy.SatisFiyat1DegisimTarih,fiy.SatisFiyat2DegisimTarih,\r\n      fiy.SatisFiyat3DegisimTarih,fiy.SatisFiyat4DegisimTarih,\r\n      st.OlcumBirimId,st.OlcumBirimCarpan\r\n      order by st.kod  \r\n   end  \r\n    \r\n    \r\n\r\n    OPEN BARKOD_HRK\r\n    FETCH NEXT FROM BARKOD_HRK INTO\r\n    @HRK_STOK_KOD,@HRK_STOK_AD,@HRK_BARKOD,@HRK_EAN,\r\n    @HRK_SATISFKDVLI1,@HRK_SATPBRM1,\r\n    @HRK_SATISFKDVLI2,@HRK_SATPBRM2,\r\n    @HRK_SATISFKDVLI3,@HRK_SATPBRM3,\r\n    @HRK_SATISFKDVLI4,@HRK_SATPBRM4,\r\n    @HRK_YERLI,@HRK_URETIMYERID,\r\n    @HRK_SATISDEGISIMTARIH1,@HRK_SATISDEGISIMTARIH2,\r\n    @HRK_SATISDEGISIMTARIH3,@HRK_SATISDEGISIMTARIH4,\r\n    @HRK_OLCUMBIRIMID,@HRK_OLCUMBIRIMCARPAN\r\n    \r\n    WHILE @@FETCH_STATUS = 0\r\n    BEGIN\r\n    IF @HRK_ONSTOK_KOD<>@HRK_STOK_KOD\r\n    begin\r\n    set @HRK_ONSTOK_KOD=@HRK_STOK_KOD\r\n    set @i=1\r\n    end\r\n\r\n     while @i<=@satirsayi\r\n     begin\r\n     \r\n     \r\n    \r\n     \r\n     INSERT @TB_BARKOD SELECT\r\n        @HRK_STOK_KOD,@HRK_STOK_AD,@HRK_BARKOD,@HRK_EAN,\r\n        case \r\n        when @FiyatSec=1 then round(@HRK_SATISFKDVLI1,2)\r\n        when @FiyatSec=2 then round(@HRK_SATISFKDVLI2,2)\r\n        when @FiyatSec=3 then round(@HRK_SATISFKDVLI3,2)\r\n        when @FiyatSec=4 then round(@HRK_SATISFKDVLI4,2) end,\r\n        case\r\n        when @FiyatSec=1 then @HRK_SATPBRM1\r\n        when @FiyatSec=2 then @HRK_SATPBRM2\r\n        when @FiyatSec=3 then @HRK_SATPBRM3\r\n        when @FiyatSec=4 then @HRK_SATPBRM4 end, \r\n        case \r\n        when @FiyatSec=1 then @HRK_SATISDEGISIMTARIH1\r\n        when @FiyatSec=2 then @HRK_SATISDEGISIMTARIH2\r\n        when @FiyatSec=3 then @HRK_SATISDEGISIMTARIH3\r\n        when @FiyatSec=4 then @HRK_SATISDEGISIMTARIH4 end,\r\n        @HRK_OLCUMBIRIMCARPAN,\r\n        \r\n        case \r\n        when @HRK_OLCUMBIRIMID=0 then ''\r\n        when @HRK_OLCUMBIRIMID=1 then 'KG'\r\n        when @HRK_OLCUMBIRIMID=2 then 'LT' end, \r\n             \r\n        round(@HRK_SATISFKDVLI4,2),\r\n        @HRK_SATPBRM4,\r\n        @HRK_SATISDEGISIMTARIH4,\r\n        @HRK_OLCUMBIRIMCARPAN, \r\n        \r\n        \r\n        @HRK_YERLI,@HRK_URETIMYERID,'',0\r\n         \r\n      \r\n        \r\n        \r\n      set @i=@i+1\r\n      end\r\n\r\n     FETCH NEXT FROM BARKOD_HRK INTO\r\n       @HRK_STOK_KOD,@HRK_STOK_AD,@HRK_BARKOD,@HRK_EAN,\r\n       @HRK_SATISFKDVLI1,@HRK_SATPBRM1,\r\n      @HRK_SATISFKDVLI2,@HRK_SATPBRM2,\r\n      @HRK_SATISFKDVLI3,@HRK_SATPBRM3,\r\n      @HRK_SATISFKDVLI4,@HRK_SATPBRM4,\r\n      @HRK_YERLI,@HRK_URETIMYERID,\r\n      @HRK_SATISDEGISIMTARIH1,@HRK_SATISDEGISIMTARIH2,\r\n      @HRK_SATISDEGISIMTARIH3,@HRK_SATISDEGISIMTARIH4,\r\n      @HRK_OLCUMBIRIMID,@HRK_OLCUMBIRIMCARPAN\r\n     END\r\n\r\n    CLOSE BARKOD_HRK\r\n    DEALLOCATE BARKOD_HRK\r\n\r\n   \r\n   \r\n    UPDATE @TB_BARKOD SET \r\n    SATISBIRIMFIYATKDVLI=\r\n    case when SATISBIRIMFIYATKDVLI>0 then \r\n    round(SATISFIYATKDVLI/SATISBIRIMFIYATKDVLI,2)\r\n    else SATISFIYATKDVLI end,       \r\n    SATISBIRIMFIYATKDVLI4=\r\n    case when SATISBIRIMFIYATKDVLI4>0 then \r\n    round(SATISFIYATKDVLI4/SATISBIRIMFIYATKDVLI4,2)\r\n    else SATISFIYATKDVLI4 end\r\n    \r\n    \r\n    \r\n    update @TB_BARKOD set KALANMIKTAR=mev_miktar from @TB_BARKOD as t \r\n    join (select Kod,tip,mev_miktar from Bakiye_Stok_Miktar as Ul WITH (NOLOCK) ) dt\r\n    on t.STOK_KOD=dt.kod and dt.tip=@tip\r\n    \r\n        \r\n    \r\n    update @TB_BARKOD set URETIMYERAD=dt.ad from @TB_BARKOD as t \r\n    join (select Id,Ad from  UlkeList as Ul WITH (NOLOCK) ) dt\r\n    on dt.Id=t.URETIMYERID\r\n    \r\n    \r\n     delete from @TB_BARKOD where  (SATISFIYATDEGISIMTARIH is null or\r\n     URETIMYERAD='') \r\n     \r\n    \r\n    \r\n    \r\n\r\n  RETURN\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_Stok_Fiyat",
    "type": "SQL_SCALAR_FUNCTION",
    "full_name": "dbo.UDF_Stok_Fiyat",
    "definition": "CREATE FUNCTION [dbo].UDF_Stok_Fiyat \r\n(@tip    \t\tvarchar(20),\r\n@SatTip\t\t\ttinyint,\r\n@kod    \t\tvarchar(50),\r\n@Kdvtip \t\tvarchar(20),\r\n@FiyNo   \t\tint)\r\n  RETURNS   float\r\nAS\r\nBEGIN\r\n  \r\n declare @fiyat    float\r\n\r\n\r\nif @SatTip=2 /*satis */\r\n begin\r\n  if @FiyNo=1\r\n   select @fiyat=\r\n   case \r\n   when k.sat1kdvtip='Dahil' and @Kdvtip='Dahil' then \r\n   k.sat1fiy \r\n   when k.sat1kdvtip='Hariç' and @Kdvtip='Dahil' then \r\n   k.sat1fiy*(1+(k.sat1kdv/100))\r\n   \r\n   when k.sat1kdvtip='Hariç' and @Kdvtip='Hariç' then \r\n   k.sat1fiy \r\n   when k.sat1kdvtip='Dahil' and @Kdvtip='Hariç' then \r\n   k.sat1fiy/(1+(k.sat1kdv/100))\r\n   end \r\n   from stokkart as k \r\n   where k.tip=@tip and k.kod=@kod\r\n\r\n\r\n  if @FiyNo=2\r\n   select @fiyat=\r\n   case \r\n   when k.sat2kdvtip='Dahil' and @Kdvtip='Dahil' then \r\n   k.sat2fiy \r\n   when k.sat2kdvtip='Hariç' and @Kdvtip='Dahil' then \r\n   k.sat2fiy*(1+(k.sat2kdv/100))\r\n   \r\n   when k.sat2kdvtip='Hariç' and @Kdvtip='Hariç' then \r\n   k.sat2fiy \r\n   when k.sat2kdvtip='Dahil' and @Kdvtip='Hariç' then \r\n   k.sat2fiy/(1+(k.sat2kdv/100))\r\n   end \r\n   from stokkart as k \r\n   where k.tip=@tip and k.kod=@kod\r\n\r\n\r\n\r\n   if @FiyNo=3\r\n   select @fiyat=\r\n   case \r\n   when k.sat3kdvtip='Dahil' and @Kdvtip='Dahil' then \r\n   k.sat3fiy \r\n   when k.sat3kdvtip='Hariç' and @Kdvtip='Dahil' then \r\n   k.sat3fiy*(1+(k.sat3kdv/100))\r\n   \r\n   when k.sat3kdvtip='Hariç' and @Kdvtip='Hariç' then \r\n   k.sat3fiy \r\n   when k.sat3kdvtip='Dahil' and @Kdvtip='Hariç' then \r\n   k.sat3fiy/(1+(k.sat3kdv/100))\r\n   end \r\n   from stokkart as k \r\n   where k.tip=@tip and k.kod=@kod\r\n\r\n\r\n   if @FiyNo=4\r\n   select @fiyat=\r\n   case \r\n   when k.sat4kdvtip='Dahil' and @Kdvtip='Dahil' then \r\n   k.sat4fiy \r\n   when k.sat4kdvtip='Hariç' and @Kdvtip='Dahil' then \r\n   k.sat4fiy*(1+(k.sat4kdv/100))\r\n   \r\n   when k.sat4kdvtip='Hariç' and @Kdvtip='Hariç' then \r\n   k.sat4fiy \r\n   when k.sat4kdvtip='Dahil' and @Kdvtip='Hariç' then \r\n   k.sat4fiy/(1+(k.sat4kdv/100))\r\n   end \r\n   from stokkart as k \r\n   where k.tip=@tip and k.kod=@kod\r\n end\r\n \r\n if @SatTip=1 /*alis */\r\n   begin\r\n   select @fiyat=\r\n   case \r\n   when k.alskdvtip='Dahil' and @Kdvtip='Dahil' then \r\n   k.alsfiy \r\n   when k.alskdvtip='Hariç' and @Kdvtip='Dahil' then \r\n   k.alsfiy*(1+(k.alskdv/100))\r\n   \r\n   when k.alskdvtip='Hariç' and @Kdvtip='Hariç' then \r\n   k.alsfiy \r\n   when k.alskdvtip='Dahil' and @Kdvtip='Hariç' then \r\n   k.alsfiy/(1+(k.alskdv/100))\r\n   end \r\n   from stokkart as k \r\n   where k.tip=@tip and k.kod=@kod\r\n   \r\n   \r\n   \r\n   \r\n   \r\n   end\r\n \r\n \r\n \r\n \r\n\r\n  RETURN @fiyat\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_STOK_HRK",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_STOK_HRK",
    "definition": "CREATE FUNCTION [dbo].UDF_STOK_HRK (\r\n@FIRMANO\t      INT,\r\n@HRK_KRITER       VARCHAR(4000),\r\n@DEPO_KOD         VARCHAR(50),\r\n@STOK_TIP         VARCHAR(20),\r\n@STOK_KOD         VARCHAR(30),\r\n@ALSATTIP         INT,\r\n@STOK_DEPKOD      VARCHAR(30),\r\n@TARIH1 \t\t  DATETIME,\r\n@TARIH2 \t\t  DATETIME,\r\n@SAAT1 \t\t\t  VARCHAR(10),\r\n@SAAT2 \t\t\t  VARCHAR(10),\r\n@DEVIR \t\t\t  INT)\r\nRETURNS\r\n  @TB_STOK_HRK TABLE (\r\n    id          int,\r\n    FIRMANO     INT,\r\n    STOK_TIP    VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    STOK_KOD    VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    STOK_AD     VARCHAR(100) COLLATE Turkish_CI_AS,\r\n    STOK_BARKOD VARCHAR(30)  COLLATE Turkish_CI_AS, \r\n    DEPO_KOD    VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    DEPO_AD     VARCHAR(100) COLLATE Turkish_CI_AS,\r\n    TARIH       DATETIME,\r\n    SAAT        VARCHAR(10)  COLLATE Turkish_CI_AS,\r\n    BELGENO     VARCHAR(50)  COLLATE Turkish_CI_AS,\r\n    ACIKLAMA    VARCHAR(200) COLLATE Turkish_CI_AS,\r\n    ISLTIPAD    VARCHAR(50)  COLLATE Turkish_CI_AS,\r\n    YERAD       VARCHAR(50)  COLLATE Turkish_CI_AS,\r\n    KULAD       VARCHAR(70)   COLLATE Turkish_CI_AS,\r\n    ISLTIP      VARCHAR(20)   COLLATE Turkish_CI_AS,\r\n    KRS_TIP     VARCHAR(30)  COLLATE Turkish_CI_AS,\r\n    KRS_KOD     VARCHAR(50)  COLLATE Turkish_CI_AS,\r\n    KRS_UNVAN   VARCHAR(150)  COLLATE Turkish_CI_AS,\r\n    ISLID       FLOAT,\r\n    BRMFIYKDVLI FLOAT,\r\n    KDVYUZ      FLOAT,\r\n    VARNO       FLOAT,\r\n    GIREN       DECIMAL(18,8),\r\n    CIKAN       DECIMAL(18,8),\r\n    KALAN       DECIMAL(18,8),\r\n    RAP_ID      INT DEFAULT 0,\r\n    FIS_ID      INT,\r\n    FAT_ID      INT,\r\n    IRS_ID      INT,\r\n    MARSAT_ID   INT,\r\n    SAY_ID      INT,\r\n    REMOTE_ID   INT)\r\nAS\r\nBEGIN\r\n  \r\n  DECLARE @HRK_STOK_TIP    VARCHAR(20)\r\n  DECLARE @HRK_STOK_KOD    VARCHAR(30)\r\n  DECLARE @HRK_STOK_AD     VARCHAR(100)\r\n  DECLARE @HRK_STOK_BARKOD VARCHAR(30)\r\n  DECLARE @KUM_KALAN       DECIMAL(18,8)\r\n  \r\n  DECLARE @ONDA_HANE       INT\r\n  \r\n\r\n  SET @KUM_KALAN = 0\r\n\r\n select @HRK_STOK_AD=k.ad,\r\n @HRK_STOK_BARKOD=K.BARKOD from stokkart as k\r\n  where k.kod=@STOK_KOD \r\n  and k.tip=@STOK_TIP\r\n\r\n SET @ONDA_HANE=2\r\n\r\n  SELECT @ONDA_HANE=isnull(Ondalik_Hane,2) from Stk_Tip  where kod=@STOK_TIP\r\n\r\n  /* Devir atanıyor */\r\n  IF @DEVIR=1\r\n   BEGIN\r\n\r\n    IF @ALSATTIP=0 /*TUMU */\r\n     INSERT @TB_STOK_HRK (id,FIRMANO,\r\n     STOK_TIP,STOK_KOD,STOK_AD,\r\n     STOK_BARKOD,DEPO_KOD,DEPO_AD,\r\n     TARIH,SAAT,BELGENO,ACIKLAMA,\r\n     ISLTIPAD,YERAD,KULAD,ISLTIP,\r\n     KRS_TIP,KRS_KOD,KRS_UNVAN,\r\n     ISLID,BRMFIYKDVLI,\r\n     KDVYUZ,VARNO,GIREN,CIKAN,KALAN,\r\n     FAT_ID,FIS_ID,IRS_ID,MARSAT_ID,SAY_ID,\r\n     REMOTE_ID)\r\n     SELECT\r\n      0,/*id */\r\n      @FIRMANO, \r\n      '',/*STOK TIP */\r\n      @STOK_KOD, /* STOK_KOD */\r\n      @HRK_STOK_AD, /* STOK_AD */\r\n      @HRK_STOK_BARKOD,\r\n      '-', /* STOK_DEPO */\r\n      '-',/*DEPOKOD */\r\n      max(tarih),\r\n      @SAAT1,\r\n      'DEVİR', /* BELGE NO */\r\n      CONVERT(VARCHAR(10), max(tarih), 104) +' DEVİR BAKİYESİ', /* AÇIKLAMA */\r\n      '-','-','-','-',\r\n      '-','-','-',\r\n      0,0,0,0,\r\n      ISNULL(SUM(round(giren,@ONDA_HANE)),0), /* giren */\r\n      ISNULL(SUM(round(cikan,@ONDA_HANE)),0), /* cikan */\r\n      ISNULL(SUM( round((giren-cikan),@ONDA_HANE) ),0), /* kalan */\r\n      0,0,0,0,0,0\r\n    FROM stkhrk with (nolock) \r\n    WHERE stktip=@STOK_TIP and stkod=@STOK_KOD and sil=0\r\n    and depkod in (select * from Depo_Kodin_str(@DEPO_KOD) )\r\n    AND tarih < @TARIH1\r\n    \r\n  IF @ALSATTIP=1 /*GIRISLER */\r\n   INSERT @TB_STOK_HRK (id,FIRMANO,\r\n    STOK_TIP,STOK_KOD,STOK_AD,\r\n    STOK_BARKOD,DEPO_KOD,DEPO_AD,\r\n    TARIH,SAAT,BELGENO,ACIKLAMA,\r\n    ISLTIPAD,YERAD,KULAD,ISLTIP,\r\n    KRS_TIP,KRS_KOD,KRS_UNVAN,\r\n    ISLID,BRMFIYKDVLI,\r\n    KDVYUZ,VARNO,GIREN,CIKAN,KALAN,\r\n    FAT_ID,FIS_ID,IRS_ID,MARSAT_ID,SAY_ID,\r\n    REMOTE_ID)\r\n    SELECT\r\n      0,/*id */\r\n      @FIRMANO,\r\n      '',/*STOK TIP */\r\n      @STOK_KOD, /* STOK_KOD */\r\n      @HRK_STOK_AD, /* STOK_AD */\r\n      @HRK_STOK_BARKOD,\r\n      '-', /* STOK_DEPO */\r\n      '-',/*DEPOKOD */\r\n      max(tarih),\r\n      @SAAT1,\r\n      'DEVİR', /* BELGE NO */\r\n      CONVERT(VARCHAR(10), max(tarih), 104) +' DEVİR BAKİYESİ', /* AÇIKLAMA */\r\n      '-','-','-','-',\r\n      '-','-','-',0,0,0,0,\r\n      ISNULL(SUM(round(giren,@ONDA_HANE)),0), /* giren */\r\n      ISNULL(SUM(round(cikan,@ONDA_HANE)),0), /* cikan */\r\n      ISNULL(SUM(round((giren-cikan),@ONDA_HANE)),0), /* kalan */\r\n      0,0,0,0,0,0\r\n    FROM stkhrk with (nolock) \r\n    WHERE cikan=0 and stktip=@STOK_TIP and stkod=@STOK_KOD and sil=0\r\n    and depkod in (select * from Depo_Kodin_str(@DEPO_KOD) )\r\n    AND tarih < @TARIH1\r\n\r\n\r\n  IF @ALSATTIP=2 /*CIKISLAR */\r\n  INSERT @TB_STOK_HRK (id,FIRMANO,\r\n    STOK_TIP,STOK_KOD,STOK_AD,\r\n    STOK_BARKOD,DEPO_KOD,DEPO_AD,\r\n    TARIH,SAAT,BELGENO,ACIKLAMA,\r\n    ISLTIPAD,YERAD,KULAD,ISLTIP,\r\n    KRS_TIP,KRS_KOD,KRS_UNVAN,\r\n    ISLID,BRMFIYKDVLI,\r\n    KDVYUZ,VARNO,GIREN,CIKAN,KALAN,\r\n    FAT_ID,FIS_ID,IRS_ID,MARSAT_ID,SAY_ID,\r\n    REMOTE_ID)\r\n    SELECT\r\n      0,/*id */\r\n      @FIRMANO,\r\n      '',/*STOK TIP */\r\n      @STOK_KOD, /* STOK_KOD */\r\n      @HRK_STOK_AD, /* STOK_AD */\r\n      @HRK_STOK_BARKOD,\r\n      '-', /* STOK_DEPO */\r\n      '-',/*DEPOKOD */\r\n      max(tarih),\r\n      @SAAT1,\r\n      'DEVİR', /* BELGE NO */\r\n      CONVERT(VARCHAR(10), max(tarih), 104) +' DEVİR BAKİYESİ', /* AÇIKLAMA */\r\n      '-','-','-','-',\r\n      '-','-','-',\r\n      0,0,0,0,\r\n      ISNULL(SUM(round(giren,@ONDA_HANE)),0), /* giren */\r\n      ISNULL(SUM(round(cikan,@ONDA_HANE)),0), /* cikan */\r\n      ISNULL(SUM(round((giren-cikan),@ONDA_HANE)),0), /* kalan */\r\n      0,0,0,0,0,0\r\n      FROM stkhrk with (nolock) \r\n      WHERE giren=0 and stktip=@STOK_TIP and stkod=@STOK_KOD and sil=0\r\n      and depkod in (select * from Depo_Kodin_str(@DEPO_KOD) )\r\n       AND tarih < @TARIH1\r\n    \r\n      SELECT @KUM_KALAN = isnull(KALAN,0) FROM @TB_STOK_HRK\r\n      if (SELECT COUNT(*) FROM @TB_STOK_HRK WHERE (GIREN>0 OR CIKAN>0))=0 \r\n       delete from @TB_STOK_HRK \r\n    \r\n   END\r\n\r\n  IF @ALSATTIP=0 /*TUMU */\r\n  begin\r\n  INSERT @TB_STOK_HRK (id,FIRMANO,\r\n    STOK_TIP,STOK_KOD,STOK_AD,\r\n    STOK_BARKOD,DEPO_KOD,DEPO_AD,\r\n    TARIH,SAAT,BELGENO,ACIKLAMA,\r\n    ISLTIPAD,YERAD,KULAD,ISLTIP,\r\n    KRS_TIP,KRS_KOD,KRS_UNVAN,\r\n    ISLID,BRMFIYKDVLI,\r\n    KDVYUZ,VARNO,GIREN,CIKAN,KALAN,\r\n    FAT_ID,FIS_ID,IRS_ID,MARSAT_ID,SAY_ID,\r\n    REMOTE_ID)\r\n    SELECT\r\n      h.id,\r\n      h.firmano,\r\n      @STOK_TIP,@STOK_KOD,@HRK_STOK_AD,\r\n      h.barkod,depkod,(dep.ad) as depoad,\r\n       tarih,saat,belno,\r\n      ack, /* AÇIKLAMA, */\r\n      islmtipad,yerad,olususer,islmtip,\r\n      Karsi_KartTip,Karsi_KartKod,'',\r\n      stkhrkid,\r\n      brmfiykdvli,kdvyuz,h.varno,\r\n      round(giren,@ONDA_HANE),\r\n      round(cikan,@ONDA_HANE),\r\n      round((giren-cikan),@ONDA_HANE) AS KALAN,\r\n      h.fatid,h.fisid,h.irid,h.marsatid,h.sayid,h.remote_id\r\n    FROM stkhrk as h with (nolock)  inner join Depo_Kart_Listesi as dep on\r\n    dep.kod=h.depkod\r\n    WHERE h.stktip=@STOK_TIP and h.stkod=@STOK_KOD and h.sil=0\r\n      and h.islmtip not in \r\n      (select * from CsvToSTR(@HRK_KRITER))\r\n      and h.depkod in (select * from Depo_Kodin_str(@DEPO_KOD) ) \r\n     AND tarih >= @TARIH1  AND tarih <= @TARIH2\r\n    ORDER BY tarih,saat\r\n   end\r\n\r\n  IF @ALSATTIP=1 /*GIRISLER */\r\n  begin\r\n  INSERT @TB_STOK_HRK (id,FIRMANO,\r\n    STOK_TIP,STOK_KOD,STOK_AD,\r\n    STOK_BARKOD,DEPO_KOD,DEPO_AD,\r\n    TARIH,SAAT,BELGENO,ACIKLAMA,\r\n    ISLTIPAD,YERAD,KULAD,ISLTIP,\r\n    KRS_TIP,KRS_KOD,KRS_UNVAN,\r\n    ISLID,BRMFIYKDVLI,\r\n    KDVYUZ,VARNO,GIREN,CIKAN,KALAN,\r\n    FAT_ID,FIS_ID,IRS_ID,MARSAT_ID,SAY_ID,\r\n    REMOTE_ID)\r\n    SELECT\r\n      h.id,\r\n      h.firmano,\r\n      @STOK_TIP,@STOK_KOD,@HRK_STOK_AD,\r\n      h.barkod,depkod,(dep.ad) as depoad,\r\n       tarih,saat,belno,\r\n      ack, /* AÇIKLAMA, */\r\n      islmtipad,yerad,olususer,islmtip,\r\n      Karsi_KartTip,Karsi_KartKod,'',\r\n      stkhrkid,\r\n      brmfiykdvli,kdvyuz,h.varno,\r\n      round(giren,@ONDA_HANE),\r\n      round(cikan,@ONDA_HANE),\r\n      round((giren-cikan),@ONDA_HANE) AS KALAN,\r\n      h.fatid,h.fisid,h.irid,h.marsatid,h.sayid,h.remote_id\r\n    FROM stkhrk as h with (nolock)  inner join Depo_Kart_Listesi as dep on\r\n     dep.kod=h.depkod\r\n    WHERE h.cikan=0 and h.stktip=@STOK_TIP and h.stkod=@STOK_KOD and h.sil=0\r\n     and h.islmtip not in \r\n      (select * from CsvToSTR(@HRK_KRITER)) \r\n      and h.depkod in (select * from Depo_Kodin_str(@DEPO_KOD) )\r\n    AND tarih >= @TARIH1  AND tarih <= @TARIH2\r\n    ORDER BY tarih,saat\r\n   end\r\n\r\n  IF @ALSATTIP=2 /*CIKISLAR */\r\n  begin\r\n  INSERT @TB_STOK_HRK (id,FIRMANO,\r\n    STOK_TIP,STOK_KOD,STOK_AD,\r\n    STOK_BARKOD,DEPO_KOD,DEPO_AD,\r\n    TARIH,SAAT,BELGENO,ACIKLAMA,\r\n    ISLTIPAD,YERAD,KULAD,ISLTIP,\r\n    KRS_TIP,KRS_KOD,KRS_UNVAN,\r\n    ISLID,BRMFIYKDVLI,\r\n    KDVYUZ,VARNO,GIREN,CIKAN,KALAN,\r\n    FAT_ID,FIS_ID,IRS_ID,MARSAT_ID,SAY_ID,\r\n    REMOTE_ID)\r\n    SELECT\r\n      h.id,\r\n      h.firmano,\r\n      @STOK_TIP,@STOK_KOD,@HRK_STOK_AD,\r\n      h.barkod,depkod,(dep.ad) as depoad,\r\n       tarih,saat,belno,\r\n      ack, /* AÇIKLAMA, */\r\n      islmtipad,yerad,olususer,islmtip,\r\n      Karsi_KartTip,Karsi_KartKod,'',\r\n      stkhrkid,\r\n      brmfiykdvli,kdvyuz,h.varno,\r\n      round(giren,@ONDA_HANE),\r\n      round(cikan,@ONDA_HANE),\r\n      round((giren-cikan),@ONDA_HANE) AS KALAN,\r\n      h.fatid,h.fisid,h.irid,h.marsatid,h.sayid,h.remote_id\r\n    FROM stkhrk as h with (nolock)  inner join Depo_Kart_Listesi as dep on\r\n     dep.kod=h.depkod\r\n    WHERE h.giren=0 and h.stktip=@STOK_TIP and h.stkod=@STOK_KOD and h.sil=0\r\n     and h.islmtip not in \r\n      (select * from CsvToSTR(@HRK_KRITER))\r\n      and h.depkod in (select * from Depo_Kodin_str(@DEPO_KOD) ) \r\n    AND tarih >= @TARIH1  AND tarih <= @TARIH2\r\n    ORDER BY tarih,saat\r\n   end\r\n\r\n\r\n\r\n   if @FIRMANO>0\r\n    delete from  @TB_STOK_HRK where FIRMANO NOT IN (0,@FIRMANO)\r\n\r\n\r\n\r\n    update @TB_STOK_HRK set RAP_ID=dt.fatrap_id\r\n   FROM @TB_STOK_HRK AS T join\r\n   (select fatid,fatrap_id from faturamas with (nolock)) dt\r\n   on t.FAT_ID=dt.fatid \r\n\r\n\r\n   update @TB_STOK_HRK set KRS_UNVAN=dt.AD\r\n   FROM @TB_STOK_HRK AS T join\r\n   (select cartp,kod,ad from genel_kart) dt\r\n   on dt.cartp=t.KRS_TIP and dt.kod=t.KRS_KOD\r\n   \r\n    \r\n   update @TB_STOK_HRK set KRS_KOD='-',KRS_UNVAN='-'\r\n   WHERE (KRS_KOD is null)\r\n\r\n\r\n\r\n  RETURN\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_STOK_ORT_FIY",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_STOK_ORT_FIY",
    "definition": "CREATE FUNCTION UDF_STOK_ORT_FIY \r\n(@FIRMANO\t\tINT,\r\n@DEPO_KOD        VARCHAR(50),\r\n@HRK_KRITER     VARCHAR(4000),\r\n@STOK_TIP\t\tVARCHAR(10),\r\n@STOK_KODIN \tVARCHAR(4000),\r\n@BAS_TAR\t\tDATETIME,\r\n@BIT_TAR\t\tDATETIME)\r\n RETURNS\r\n  @TB_STOK_ORT_FIY TABLE (\r\n    GRUP_ID    \t\tINT,\r\n    GRUP_AD  \t\tVARCHAR(150) COLLATE Turkish_CI_AS,\r\n    STOK_TIP    \tVARCHAR(20) COLLATE Turkish_CI_AS,\r\n    STOK_KOD    \tVARCHAR(30) COLLATE Turkish_CI_AS,\r\n    STOK_AD  \t    VARCHAR(150) COLLATE Turkish_CI_AS,\r\n    GUN_SAY\t\t\tINT,\r\n    DEPO_MIKTAR     FLOAT DEFAULT 0,\t\r\n    MIKTAR    \t    FLOAT,\r\n    ORT_BRM_FIY     FLOAT,\r\n    ORT_TUTAR       FLOAT,\r\n    GUN_ORT_MIKTAR  FLOAT,\r\n    GUN_ORT_FIY     FLOAT,\r\n    GUN_ORT_TUTAR   FLOAT)\r\nAS\r\nBEGIN\r\n\r\n    if @DEPO_KOD='' \r\n    begin\r\n     insert into @TB_STOK_ORT_FIY \r\n     (GRUP_ID,GRUP_AD,STOK_TIP,STOK_KOD,STOK_AD,\r\n     GUN_SAY,MIKTAR,\r\n     ORT_BRM_FIY,ORT_TUTAR,\r\n     GUN_ORT_MIKTAR,GUN_ORT_FIY,GUN_ORT_TUTAR)\r\n     SELECT g.id,g.ad,k.tip,k.kod,k.ad,\r\n     (DATEDIFF(DAY,@BAS_TAR,@BIT_TAR))+1,\r\n      sum(h.cikan),\r\n      0,sum((h.cikan)*h.brmfiykdvli),\r\n      0,0,0\r\n      FROM stokkart as k with (nolock)\r\n      left join grup as g on g.id=k.grp1\r\n      inner join stkhrk h with (nolock) on k.kod=h.stkod and\r\n      k.tip=h.stktip and h.sil=0  and h.islmtip not in\r\n      (select * from CsvToSTR(@HRK_KRITER))\r\n      WHERE k.tip=@STOK_TIP and k.sil=0 and k.kod\r\n      in (select * FROM CsvToSTR(@STOK_KODIN))\r\n      and tarih >= @BAS_TAR  and tarih <= @BIT_TAR\r\n      group by k.tip,g.id,g.ad,k.kod,k.ad\r\n    end\r\n\r\n    if @DEPO_KOD<>'' \r\n    begin\r\n     insert into @TB_STOK_ORT_FIY \r\n     (GRUP_ID,GRUP_AD,STOK_TIP,STOK_KOD,STOK_AD,\r\n     GUN_SAY,MIKTAR,\r\n     ORT_BRM_FIY,ORT_TUTAR,\r\n     GUN_ORT_MIKTAR,GUN_ORT_FIY,GUN_ORT_TUTAR)\r\n     SELECT g.id,g.ad,k.tip,k.kod,k.ad,\r\n     (DATEDIFF(DAY,@BAS_TAR,@BIT_TAR))+1,\r\n      sum(h.cikan),\r\n      0,sum((h.cikan)*h.brmfiykdvli),\r\n      0,0,0\r\n      FROM stokkart as k with (nolock)\r\n      left join grup as g on g.id=k.grp1\r\n      inner join stkhrk h with (nolock) on k.kod=h.stkod and\r\n      k.tip=h.stktip and h.sil=0\r\n      and h.islmtip not in\r\n      (select * from CsvToSTR(@HRK_KRITER))\r\n      WHERE k.tip=@STOK_TIP and k.sil=0 and k.kod\r\n      in (select * FROM CsvToSTR(@STOK_KODIN))\r\n      and tarih >= @BAS_TAR  and tarih <= @BIT_TAR\r\n      and h.depkod =@DEPO_KOD\r\n      group by k.tip,g.id,g.ad,k.kod,k.ad\r\n    end \r\n\r\n    update @TB_STOK_ORT_FIY set \r\n    ORT_BRM_FIY=case when MIKTAR<>0 then \r\n    ORT_TUTAR/MIKTAR else 0 end,\r\n    GUN_ORT_MIKTAR=case when GUN_SAY<>0 then \r\n    MIKTAR/GUN_SAY else 0 end,\r\n    GUN_ORT_FIY=case when GUN_SAY<>0 then \r\n    ORT_TUTAR/GUN_SAY else 0 end\r\n    \r\n    \r\n    update @TB_STOK_ORT_FIY set \r\n    GUN_ORT_TUTAR=GUN_ORT_MIKTAR*GUN_ORT_FIY\r\n    \r\n    \r\n   if @DEPO_KOD=''  \r\n    update @TB_STOK_ORT_FIY set  DEPO_MIKTAR=dt.mevmiktar from @TB_STOK_ORT_FIY as t \r\n    join (select stktip,stkod,\r\n    isnull(sum(mk.giren-mk.cikan),0) mevmiktar \r\n    from  stkhrk as mk WITH (NOLOCK, INDEX = stkhrk_idx5)\r\n      where  mk.sil=0 group by stktip,stkod  ) dt on \r\n      dt.stktip=t.STOK_TIP and dt.stkod=t.STOK_KOD\r\n   \r\n    \r\n   if @DEPO_KOD<>''  \r\n    update @TB_STOK_ORT_FIY set  DEPO_MIKTAR=dt.mevmiktar from @TB_STOK_ORT_FIY as t \r\n    join (select stktip,stkod,\r\n    isnull(sum(mk.giren-mk.cikan),0) mevmiktar \r\n    from  stkhrk as mk WITH (NOLOCK, INDEX = stkhrk_idx5)\r\n      where  mk.sil=0 and mk.depkod =@DEPO_KOD \r\n      group by stktip,stkod  ) dt on \r\n      dt.stktip=t.STOK_TIP and dt.stkod=t.STOK_KOD \r\n\r\n\r\n  RETURN\r\n\r\n\r\n\r\n\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_STOK_PERIYOT",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_STOK_PERIYOT",
    "definition": "CREATE FUNCTION UDF_STOK_PERIYOT (\r\n@FIRMA_NO       \tINT,\r\n@HRK_KRITER       VARCHAR(4000),\r\n@STOK_DEPKOD      VARCHAR(20),\r\n@STOK_TIP         VARCHAR(20),\r\n@STOK_GRPTIP      INT,\r\n@STOK_KODIN       VARCHAR (8000),\r\n@PERIYOTTIP       INT,\r\n@TARIH1           DATETIME,\r\n@TARIH2           DATETIME)\r\nRETURNS\r\n\r\n  @TB_STOKPER_HRK TABLE (\r\n    PERIYOTTAR          DATETIME,\r\n    PERIYOTAD           VARCHAR(50)  COLLATE Turkish_CI_AS,\r\n    STOK_TIP            VARCHAR(20)  COLLATE Turkish_CI_AS,\r\n    STOK_GRPID          FLOAT,\r\n    STOK_GRPAD          VARCHAR(100)  COLLATE Turkish_CI_AS,\r\n    STOK_KOD            VARCHAR(50)   COLLATE Turkish_CI_AS,\r\n    STOK_AD             VARCHAR(150)   COLLATE Turkish_CI_AS,\r\n    DEPO_KOD            VARCHAR(30)   COLLATE Turkish_CI_AS,\r\n    DEPO_AD             VARCHAR(100)   COLLATE Turkish_CI_AS,\r\n    ALISMIKTAR          FLOAT,\r\n    ALISTUTAR           FLOAT,\r\n    SATISMIKTAR         FLOAT,\r\n    SATISTUTAR          FLOAT)\r\nAS\r\nBEGIN\r\n\r\n\r\n  DECLARE @STKHRKPER_TEMP TABLE (\r\n    PERIYOTTAR            DATETIME,\r\n    PERIYOTAD             VARCHAR(50)   COLLATE Turkish_CI_AS,\r\n    STOK_TIP              VARCHAR(20)   COLLATE Turkish_CI_AS,\r\n    STOK_GRPID            FLOAT,\r\n    STOK_GRPAD          VARCHAR(100)  COLLATE Turkish_CI_AS,\r\n    STOK_KOD              VARCHAR(50)   COLLATE Turkish_CI_AS,\r\n    STOK_AD               VARCHAR(150)   COLLATE Turkish_CI_AS,\r\n    DEPO_KOD              VARCHAR(30)   COLLATE Turkish_CI_AS,\r\n    DEPO_AD               VARCHAR(100)   COLLATE Turkish_CI_AS,\r\n    ALISMIKTAR            FLOAT DEFAULT 0,\r\n    ALISTUTAR             FLOAT DEFAULT 0,\r\n    SATISMIKTAR           FLOAT DEFAULT 0,\r\n    SATISTUTAR            FLOAT DEFAULT 0)\r\n\r\n  DECLARE @HRK_PERIYOTTAR   DATETIME\r\n  DECLARE @HRK_PERIYOTAD    VARCHAR(50)\r\n  DECLARE @HRK_STOK_TIP     VARCHAR(20)\r\n  DECLARE @HRK_GRPID        FLOAT\r\n  DECLARE @HRK_STOK_KOD     VARCHAR(50)\r\n  DECLARE @HRK_STOK_AD      VARCHAR(150)\r\n  DECLARE @HRK_DEPO_KOD     VARCHAR(30)\r\n  DECLARE @HRK_DEPO_AD      VARCHAR(100)\r\n  DECLARE @HRK_ALISMIK      FLOAT\r\n  DECLARE @HRK_ALISTUT      FLOAT\r\n  DECLARE @HRK_SATISMIK     FLOAT\r\n  DECLARE @HRK_SATISTUT     FLOAT\r\n\r\n  DECLARE @HRK_BRIM         VARCHAR(50)\r\n  DECLARE @HRK_BRMFIYKDVLI  FLOAT\r\n  DECLARE @HRK_KDVYUZ       FLOAT\r\n\r\n/*\r\n0=GUNLUK\r\n1=HAFTALIK  select datepart(wk, GETDATE() )\r\n2=AYLIK\r\n3=HAFTANIN GUNLERI\r\n\r\nSELECT Gun =\r\n   CASE DATEPART(dw,GETDATE())\r\n   WHEN 1 THEN 'PAZAR'\r\n   WHEN 2 THEN 'PAZARTESİ'\r\n   WHEN 3 THEN 'SALI'\r\n   WHEN 4 THEN 'ÇARŞAMBA'\r\n   WHEN 5 THEN 'PERŞEMBE'\r\n   WHEN 6 THEN 'CUMA'\r\n   WHEN 7 THEN 'CUMARTESİ'\r\n   END\r\n*/\r\n\r\n\r\n /*---------------------------------------------------------------------------- */\r\n\r\n  IF @STOK_GRPTIP=0 and (@STOK_DEPKOD='')\r\n  begin\r\n    IF (@FIRMA_NO=0)\r\n     DECLARE STKPER_HRK CURSOR FAST_FORWARD FOR\r\n     SELECT\r\n       h.tarih,\r\n       h.tarih,   /*isnull(( */\r\n       k.tip,k.grp1,k.kod,k.ad,h.brmfiykdvli,\r\n      ISNULL(SUM(giren),0),ISNULL(SUM(cikan),0)\r\n      FROM stokkart as k with (nolock) \r\n      left Join stkhrk as h with (nolock)  on\r\n      h.stkod=k.kod and k.sil=0 and h.stktip=k.tip\r\n      and h.sil=0\r\n      AND (h.tarih >= @TARIH1 and h.tarih <= @TARIH2)\r\n      and h.islmtip not in \r\n      (select * from CsvToSTR(@HRK_KRITER))\r\n      where k.tip=@STOK_TIP\r\n      and k.kod in (select * FROM CsvToSTR(@STOK_KODIN))\r\n      GROUP BY k.tip,k.grp1,k.kod,k.ad,k.brim,h.tarih,h.brmfiykdvli\r\n      order by h.tarih\r\n      \r\n      IF (@FIRMA_NO>0) \r\n        DECLARE STKPER_HRK CURSOR FAST_FORWARD FOR\r\n       SELECT\r\n       h.tarih,\r\n       h.tarih,   /*isnull(( */\r\n       k.tip,k.grp1,k.kod,k.ad,h.brmfiykdvli,\r\n      ISNULL(SUM(giren),0),ISNULL(SUM(cikan),0)\r\n      FROM stokkart as k with (nolock) \r\n      left Join stkhrk as h with (nolock)  on\r\n      h.stkod=k.kod and k.sil=0 and h.stktip=k.tip\r\n      and h.sil=0\r\n      and h.firmano in (0,@FIRMA_NO)\r\n      AND (h.tarih >= @TARIH1 and h.tarih <= @TARIH2)\r\n      and h.islmtip not in \r\n      (select * from CsvToSTR(@HRK_KRITER))\r\n      where k.tip=@STOK_TIP\r\n      and k.kod in (select * FROM CsvToSTR(@STOK_KODIN))\r\n      GROUP BY k.tip,k.grp1,k.kod,k.ad,k.brim,h.tarih,h.brmfiykdvli\r\n      order by h.tarih \r\n      \r\n   end  \r\n   \r\n\r\n   IF @STOK_GRPTIP=0 and (@STOK_DEPKOD!='')\r\n   begin\r\n    IF (@FIRMA_NO=0)\r\n    DECLARE STKPER_HRK CURSOR FAST_FORWARD FOR\r\n     SELECT\r\n       h.tarih,\r\n       h.tarih,   /*isnull(( */\r\n       k.tip,k.grp1,k.kod,k.ad,h.brmfiykdvli,\r\n      ISNULL(SUM(giren),0),ISNULL(SUM(cikan),0)\r\n      FROM stokkart as k with (nolock) \r\n      left Join stkhrk as h with (nolock)  on\r\n      h.stkod=k.kod and k.sil=0 and h.stktip=k.tip \r\n      and h.sil=0 and h.depkod=@STOK_DEPKOD\r\n      AND (h.tarih >= @TARIH1 and h.tarih <= @TARIH2)\r\n      and h.islmtip not in \r\n      (select * from CsvToSTR(@HRK_KRITER))\r\n      where k.tip=@STOK_TIP\r\n      and k.kod in (select * FROM CsvToSTR(@STOK_KODIN))\r\n      GROUP BY k.tip,k.grp1,k.kod,k.ad,k.brim,h.tarih,h.brmfiykdvli\r\n      order by h.tarih\r\n      \r\n      \r\n      IF (@FIRMA_NO>0) \r\n       DECLARE STKPER_HRK CURSOR FAST_FORWARD FOR\r\n       SELECT\r\n       h.tarih,\r\n       h.tarih,   /*isnull(( */\r\n       k.tip,k.grp1,k.kod,k.ad,h.brmfiykdvli,\r\n      ISNULL(SUM(giren),0),ISNULL(SUM(cikan),0)\r\n      FROM stokkart as k with (nolock) \r\n      left Join stkhrk as h with (nolock)  on\r\n      h.stkod=k.kod and k.sil=0 and h.stktip=k.tip \r\n      and h.sil=0 and h.depkod=@STOK_DEPKOD\r\n      and h.firmano in (0,@FIRMA_NO)\r\n      AND (h.tarih >= @TARIH1 and h.tarih <= @TARIH2)\r\n      and h.islmtip not in \r\n      (select * from CsvToSTR(@HRK_KRITER))\r\n      where k.tip=@STOK_TIP\r\n      and k.kod in (select * FROM CsvToSTR(@STOK_KODIN))\r\n      GROUP BY k.tip,k.grp1,k.kod,k.ad,k.brim,h.tarih,h.brmfiykdvli\r\n      order by h.tarih\r\n\r\n    end\r\n\r\n  IF @STOK_GRPTIP=1 and (@STOK_DEPKOD='')\r\n  begin\r\n  \r\n   IF (@FIRMA_NO=0)\r\n     DECLARE STKPER_HRK CURSOR FAST_FORWARD FOR\r\n      SELECT\r\n       h.tarih,\r\n       h.tarih,   /*isnull(( */\r\n       k.tip,k.grp1,k.kod,k.ad,ISNULL(h.brmfiykdvli,0),\r\n      ISNULL(SUM(giren),0),ISNULL(SUM(cikan),0)\r\n      FROM stokkart as k with (nolock) \r\n      left Join stkhrk as h with (nolock) on\r\n      h.stkod=k.kod and k.sil=0 and h.stktip=k.tip\r\n      and h.sil=0\r\n      AND (h.tarih >= @TARIH1 and h.tarih <= @TARIH2)\r\n      and h.islmtip not in \r\n      (select * from CsvToSTR(@HRK_KRITER))\r\n      where k.tip=@STOK_TIP\r\n      and k.grp1 in (select * FROM CsvToSTR(@STOK_KODIN))\r\n      GROUP BY k.tip,k.grp1,k.kod,k.ad,k.brim,h.tarih,h.brmfiykdvli\r\n      order by h.tarih\r\n      \r\n      \r\n     IF (@FIRMA_NO>0)   \r\n      DECLARE STKPER_HRK CURSOR FAST_FORWARD FOR\r\n      SELECT\r\n       h.tarih,\r\n       h.tarih,   /*isnull(( */\r\n       k.tip,k.grp1,k.kod,k.ad,ISNULL(h.brmfiykdvli,0),\r\n      ISNULL(SUM(giren),0),ISNULL(SUM(cikan),0)\r\n      FROM stokkart as k with (nolock) \r\n      left Join stkhrk as h with (nolock) on\r\n      h.stkod=k.kod and k.sil=0 and h.stktip=k.tip\r\n      and h.sil=0\r\n      and h.firmano in (0,@FIRMA_NO)\r\n      AND (h.tarih >= @TARIH1 and h.tarih <= @TARIH2)\r\n      and h.islmtip not in \r\n      (select * from CsvToSTR(@HRK_KRITER))\r\n      where k.tip=@STOK_TIP\r\n      and k.grp1 in (select * FROM CsvToSTR(@STOK_KODIN))\r\n      GROUP BY k.tip,k.grp1,k.kod,k.ad,k.brim,h.tarih,h.brmfiykdvli\r\n      order by h.tarih\r\n      \r\n   end   \r\n      \r\n      \r\n      \r\n   IF @STOK_GRPTIP=1 and (@STOK_DEPKOD!='')\r\n   begin\r\n    IF (@FIRMA_NO=0)\r\n    DECLARE STKPER_HRK CURSOR FAST_FORWARD FOR\r\n     SELECT\r\n       h.tarih,\r\n       h.tarih,   /*isnull(( */\r\n       k.tip,k.grp1,k.kod,k.ad,ISNULL(h.brmfiykdvli,0),\r\n      ISNULL(SUM(giren),0),ISNULL(SUM(cikan),0)\r\n      FROM stokkart as k with (nolock) \r\n      left Join stkhrk as h with (nolock) on\r\n      h.stkod=k.kod and k.sil=0 and h.stktip=k.tip\r\n      and h.sil=0 and h.depkod=@STOK_DEPKOD\r\n      AND (h.tarih >= @TARIH1 and h.tarih <= @TARIH2)\r\n      and h.islmtip not in \r\n      (select * from CsvToSTR(@HRK_KRITER))\r\n      where k.tip=@STOK_TIP\r\n      and k.grp1 in (select * FROM CsvToSTR(@STOK_KODIN))\r\n      GROUP BY k.tip,k.grp1,k.kod,k.ad,k.brim,h.tarih,h.brmfiykdvli\r\n      order by h.tarih\r\n      \r\n      \r\n     IF (@FIRMA_NO>0)\r\n       DECLARE STKPER_HRK CURSOR FAST_FORWARD FOR\r\n      SELECT\r\n       h.tarih,\r\n       h.tarih,   /*isnull(( */\r\n       k.tip,k.grp1,k.kod,k.ad,ISNULL(h.brmfiykdvli,0),\r\n      ISNULL(SUM(giren),0),ISNULL(SUM(cikan),0)\r\n      FROM stokkart as k with (nolock) \r\n      left Join stkhrk as h with (nolock) on\r\n      h.stkod=k.kod and k.sil=0 and h.stktip=k.tip\r\n      and h.sil=0 and h.depkod=@STOK_DEPKOD\r\n      and h.firmano in (0,@FIRMA_NO)\r\n      AND (h.tarih >= @TARIH1 and h.tarih <= @TARIH2)\r\n      and h.islmtip not in \r\n      (select * from CsvToSTR(@HRK_KRITER))\r\n      where k.tip=@STOK_TIP\r\n      and k.grp1 in (select * FROM CsvToSTR(@STOK_KODIN))\r\n      GROUP BY k.tip,k.grp1,k.kod,k.ad,k.brim,h.tarih,h.brmfiykdvli\r\n      order by h.tarih\r\n      \r\n   end      \r\n      \r\n  \r\n\r\n  OPEN STKPER_HRK\r\n\r\n  FETCH NEXT FROM STKPER_HRK INTO\r\n   @HRK_PERIYOTTAR,@HRK_PERIYOTAD,@HRK_STOK_TIP,@HRK_GRPID,@HRK_STOK_KOD,@HRK_STOK_AD,\r\n   @HRK_BRMFIYKDVLI,@HRK_ALISMIK,@HRK_SATISMIK\r\n\r\n  WHILE @@FETCH_STATUS = 0\r\n  BEGIN\r\n  \r\n       if @HRK_PERIYOTTAR>0\r\n       begin\r\n       IF @PERIYOTTIP=0\r\n       set @HRK_PERIYOTAD=convert(varchar,@HRK_PERIYOTTAR,104)\r\n       \r\n       IF @PERIYOTTIP=1\r\n       begin\r\n       if datepart(wk,(@HRK_PERIYOTTAR-1))=53\r\n        set @HRK_PERIYOTAD=1\r\n        else\r\n        set @HRK_PERIYOTAD=datepart(wk,(@HRK_PERIYOTTAR-1))\r\n       end\r\n       \r\n       IF @PERIYOTTIP=2\r\n       set @HRK_PERIYOTAD=\r\n        (select\r\n          CASE DATEPART(mm,@HRK_PERIYOTTAR)\r\n           WHEN 1 THEN 'OCAK'\r\n           WHEN 2 THEN 'ŞUBAT'\r\n           WHEN 3 THEN 'MART'\r\n           WHEN 4 THEN 'NİSAN'\r\n           WHEN 5 THEN 'MAYIS'\r\n           WHEN 6 THEN 'HAZİRAN'\r\n           WHEN 7 THEN 'TEMMUZ'\r\n           WHEN 8 THEN 'AĞUSTOS'\r\n           WHEN 9 THEN 'EYLÜL'\r\n           WHEN 10 THEN 'EKİM'\r\n           WHEN 11 THEN 'KASIM'\r\n           WHEN 12 THEN 'ARALIK'\r\n          END)\r\n\r\n       IF @PERIYOTTIP=3\r\n       set @HRK_PERIYOTAD=\r\n         (select CASE DATEPART(dw,@HRK_PERIYOTTAR)\r\n          WHEN 1 THEN 'PAZAR'\r\n          WHEN 2 THEN 'PAZARTESİ'\r\n          WHEN 3 THEN 'SALI'\r\n          WHEN 4 THEN 'ÇARŞAMBA'\r\n          WHEN 5 THEN 'PERŞEMBE'\r\n          WHEN 6 THEN 'CUMA'\r\n          WHEN 7 THEN 'CUMARTESİ'\r\n          END)\r\n       end\r\n\r\n\r\n     INSERT @STKHRKPER_TEMP (PERIYOTTAR,PERIYOTAD,STOK_TIP,STOK_GRPID,STOK_KOD,\r\n     STOK_AD,DEPO_KOD,DEPO_AD,\r\n     ALISMIKTAR,ALISTUTAR,SATISMIKTAR,SATISTUTAR)\r\n      SELECT\r\n        @HRK_PERIYOTTAR,@HRK_PERIYOTAD,@HRK_STOK_TIP,@HRK_GRPID,@HRK_STOK_KOD,\r\n        @HRK_STOK_AD,@HRK_DEPO_KOD,@HRK_DEPO_AD,\r\n        @HRK_ALISMIK,@HRK_BRMFIYKDVLI*@HRK_ALISMIK,@HRK_SATISMIK,@HRK_BRMFIYKDVLI*@HRK_SATISMIK\r\n\r\n      FETCH NEXT FROM STKPER_HRK INTO\r\n   @HRK_PERIYOTTAR,@HRK_PERIYOTAD,@HRK_STOK_TIP,@HRK_GRPID,@HRK_STOK_KOD,@HRK_STOK_AD,\r\n   @HRK_BRMFIYKDVLI,@HRK_ALISMIK,@HRK_SATISMIK\r\n  END\r\n\r\n  CLOSE STKPER_HRK\r\n  DEALLOCATE STKPER_HRK\r\n\r\n  /*---------------------------------------------------------------------------- */\r\n  update @STKHRKPER_TEMP set PERIYOTTAR=@HRK_PERIYOTTAR,PERIYOTAD=@HRK_PERIYOTAD\r\n   where PERIYOTTAR is null\r\n  \r\n  \r\n  \r\n  \r\n/*----------------------------------------------------------------------------- */\r\n\r\n  update @STKHRKPER_TEMP set STOK_GRPAD=dt.ad  from @STKHRKPER_TEMP t join\r\n  (select id,ad from grup ) \r\n  dt on dt.id=t.STOK_GRPID\r\n  \r\n  \r\n\r\n  INSERT @TB_STOKPER_HRK (PERIYOTTAR,PERIYOTAD,STOK_TIP,STOK_GRPID,\r\n  STOK_GRPAD,STOK_KOD,STOK_AD,\r\n     ALISMIKTAR,ALISTUTAR,SATISMIKTAR,SATISTUTAR)\r\n    SELECT PERIYOTTAR,PERIYOTAD,STOK_TIP,STOK_GRPID,STOK_GRPAD,\r\n    STOK_KOD,STOK_AD,\r\n     ALISMIKTAR,ALISTUTAR,SATISMIKTAR,SATISTUTAR FROM @STKHRKPER_TEMP\r\n\r\n  RETURN\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_STOK_SATIS_KODBARKOD",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_STOK_SATIS_KODBARKOD",
    "definition": "CREATE FUNCTION dbo.UDF_STOK_SATIS_KODBARKOD (\r\n@FirmaNo   \tint,\r\n@DepoKod   \tvarchar(50),\r\n@AraTip\t\tvarchar(10),\r\n@StokTip   \tvarchar(10),\r\n@StokKod    varchar(50),\r\n@StokBarkod varchar(50)\r\n)\r\nRETURNS\r\n    @TB_STOK_SATIS TABLE (\r\n    STOK_FIRMANO         INT,\r\n    STOK_TIP             VARCHAR(10) COLLATE Turkish_CI_AS,\r\n    STOK_ID              INT,\r\n    STOK_BARKOD          VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    STOK_KOD             VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    STOK_AD              VARCHAR(150) COLLATE Turkish_CI_AS,\r\n    STOK_MINMIKTAR\t\t FLOAT,\r\n    STOK_CARPAN \t\t FLOAT,\r\n    STOK_TERAZI \t\t INT,\r\n    STOK_BRIMCARPAN\t\t FLOAT,\r\n    STOK_MEVCUTMIKTAR    FLOAT,\r\n    STOK_SAYIM  \t\t INT,\r\n    STOK_EKSISATIS       INT,\r\n    STOK_RECETELI        bit default 0,\r\n    STOK_GTIP            varchar(20),\r\n    STOK_BEDELSIZ        BIT DEFAULT 0,\r\n    STOK_SATIS1FIYAT     FLOAT DEFAULT 0,\r\n    STOK_SATIS1PBRMKOD   VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    STOK_SATIS2FIYAT     FLOAT DEFAULT 0,\r\n    STOK_SATIS2PBRMKOD   VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    STOK_SATIS3FIYAT     FLOAT DEFAULT 0,\r\n    STOK_SATIS3PBRMKOD   VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    STOK_SATIS4FIYAT     FLOAT DEFAULT 0,\r\n    STOK_SATIS4PBRMKOD   VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    \r\n    STOK_YKNO            VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    STOK_GRP1ID          int,\r\n    STOK_BRM\t\t\t VARCHAR(20) COLLATE Turkish_CI_AS,\t\r\n    STOK_KDV             FLOAT DEFAULT 0)\r\nBEGIN\r\n\r\n    declare @UrunId   int \r\n\r\n\r\n   if @AraTip='stkkod'\r\n    insert @TB_STOK_SATIS (STOK_FIRMANO,STOK_TIP,STOK_ID,STOK_BARKOD,STOK_KOD,STOK_AD,\r\n    STOK_MINMIKTAR,STOK_CARPAN,STOK_TERAZI,STOK_BRIMCARPAN,\r\n    STOK_YKNO,STOK_GRP1ID,STOK_BRM,STOK_KDV,\r\n    STOK_MEVCUTMIKTAR,STOK_SAYIM,STOK_EKSISATIS,STOK_GTIP)\r\n    select k.firmano,@StokTip,K.id,k.barkod,k.kod,k.ad,k.minmik,1 as carpan,\r\n    (0) as TERAZI,k.brmcarp,\r\n    k.ykno,k.grp1,k.brim,k.sat1kdv,\r\n    dbo.stoksonmik(@DepoKod,k.tip,k.kod) as kalanmiktar,\r\n    dbo.sayimvarmi(@FirmaNo,@DepoKod,k.tip,k.kod) as sayim,\r\n    case when k.eksat='Evet' then 1 else 0 end,isnull(k.gtip,'') \r\n    from stokkart as k with (nolock) \r\n    where k.sil=0 and k.drm='Aktif' and k.tip=@StokTip and K.Kod=@StokKod\r\n    \r\n    \r\n   if @AraTip='barkod'\r\n    insert @TB_STOK_SATIS (STOK_FIRMANO,STOK_TIP,STOK_ID,STOK_BARKOD,STOK_KOD,STOK_AD,\r\n    STOK_MINMIKTAR,STOK_CARPAN,STOK_TERAZI,STOK_BRIMCARPAN,\r\n    STOK_YKNO,STOK_GRP1ID,STOK_BRM,STOK_KDV,\r\n    STOK_MEVCUTMIKTAR,STOK_SAYIM,STOK_EKSISATIS,STOK_GTIP,STOK_BEDELSIZ)\r\n     \r\n    select STOK_FIRMANO,@StokTip,STOK_ID,STOK_BARKOD,STOK_KOD,STOK_AD,\r\n    STOK_MIN,CARPAN,TERAZI,CARPAN,\r\n    k.ykno,k.grp1,k.brim,k.sat1kdv,\r\n    dbo.stoksonmik(@DepoKod,STOK_TIP,STOK_KOD) as kalanmiktar,\r\n    dbo.sayimvarmi(@FirmaNo,@DepoKod,STOK_TIP,STOK_KOD) as sayim,\r\n    case when STOK_EKSISAT='Evet' then 1 else 0 end,\r\n    isnull(STOK_GTIP,''),STOK_BEDELSIZ from TERAZI_BARKOD_GETIR (@StokTip,@StokBarkod) as b\r\n    inner join stokkart as k with (nolock) on k.id=b.STOK_ID\r\n\r\n    \r\n    select @UrunId=STOK_ID from @TB_STOK_SATIS \r\n\r\n    if isnull(@UrunId,0)>0\r\n       if EXISTS(Select id From Stok_Recete Where Urun_id=@UrunId and Sil=0 )\r\n         update @TB_STOK_SATIS Set STOK_RECETELI=1\r\n\r\n\r\n\r\n    /*Fiyat bilgisi eklenecek */\r\n    declare @Market_Sube   bit\r\n    select @Market_Sube=isnull(Market_Sube,0) from sistemtanim\r\n    \r\n     if @Market_Sube=0\r\n     begin\r\n       update @TB_STOK_SATIS set \r\n       STOK_SATIS1FIYAT=case when sat1kdvtip='Dahil' then round(sat1fiy,2) else round(sat1fiy*(1+(sat1kdv/100)),2) end,\r\n       STOK_SATIS1PBRMKOD=sat1pbrm,\r\n       STOK_SATIS2FIYAT=case when sat2kdvtip='Dahil' then round(sat2fiy,2) else round(sat2fiy*(1+(sat2kdv/100)),2) end,\r\n       STOK_SATIS2PBRMKOD=sat2pbrm,\r\n       STOK_SATIS3FIYAT=case when sat3kdvtip='Dahil' then round(sat3fiy,2) else round(sat3fiy*(1+(sat3kdv/100)),2) end,\r\n       STOK_SATIS3PBRMKOD=sat3pbrm,\r\n       STOK_SATIS4FIYAT=case when sat4kdvtip='Dahil' then round(sat4fiy,2) else round(sat4fiy*(1+(sat4kdv/100)),2) end,\r\n       STOK_SATIS4PBRMKOD=sat4pbrm\r\n       from stokkart where id=@UrunId\r\n     end\r\n     \r\n     \r\n    if @Market_Sube=1\r\n     begin\r\n     \r\n       update @TB_STOK_SATIS  set \r\n       STOK_SATIS1FIYAT=dt.Fiyat,\r\n       STOK_SATIS1PBRMKOD=dt.ParaBrm\r\n        from @TB_STOK_SATIS as t join \r\n       (select Stk_id,ParaBrm, case when kdvtip=1 then round(fiyat,2) else round(fiyat*(1+(kdv/100)),2) end as Fiyat\r\n       from Stok_Fiyat with (nolock) Where Stk_id=@UrunId and FiyNo=1 and FiyTip=2 and Firmano=@FirmaNo ) dt\r\n       on dt.Stk_id=t.STOK_ID\r\n       \r\n       \r\n       update @TB_STOK_SATIS  set \r\n       STOK_SATIS2FIYAT=dt.Fiyat,\r\n       STOK_SATIS2PBRMKOD=dt.ParaBrm\r\n        from @TB_STOK_SATIS as t join \r\n       (select Stk_id,ParaBrm, case when kdvtip=1 then round(fiyat,2) else round(fiyat*(1+(kdv/100)),2) end as Fiyat\r\n       from Stok_Fiyat with (nolock) Where Stk_id=@UrunId and FiyNo=2 and FiyTip=2 and Firmano=@FirmaNo ) dt\r\n       on dt.Stk_id=t.STOK_ID\r\n       \r\n       \r\n       \r\n        update @TB_STOK_SATIS  set \r\n       STOK_SATIS3FIYAT=dt.Fiyat,\r\n       STOK_SATIS3PBRMKOD=dt.ParaBrm\r\n        from @TB_STOK_SATIS as t join \r\n       (select Stk_id,ParaBrm, case when kdvtip=1 then round(fiyat,2) else round(fiyat*(1+(kdv/100)),2) end as Fiyat\r\n       from Stok_Fiyat with (nolock) Where Stk_id=@UrunId and FiyNo=3 and FiyTip=2 and Firmano=@FirmaNo ) dt\r\n       on dt.Stk_id=t.STOK_ID\r\n       \r\n       \r\n        update @TB_STOK_SATIS  set \r\n       STOK_SATIS4FIYAT=dt.Fiyat,\r\n       STOK_SATIS4PBRMKOD=dt.ParaBrm\r\n        from @TB_STOK_SATIS as t join \r\n       (select Stk_id,ParaBrm, case when kdvtip=1 then round(fiyat,2) else round(fiyat*(1+(kdv/100)),2) end as Fiyat\r\n       from Stok_Fiyat with (nolock) Where Stk_id=@UrunId and FiyNo=4 and FiyTip=2 and Firmano=@FirmaNo ) dt\r\n       on dt.Stk_id=t.STOK_ID\r\n       \r\n\r\n     end\r\n     \r\n\r\n    \r\n    return\r\n    \r\n    \r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_STOK_TAR",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_STOK_TAR",
    "definition": "CREATE FUNCTION [dbo].[UDF_STOK_TAR] (\r\n@FIRMANO          INT,\r\n@HRK_KRITER       VARCHAR(4000),\r\n@STOK_DEPKOD      VARCHAR(20),\r\n@STOK_KODIN       VARCHAR (8000),\r\n@STOK_TIP         VARCHAR(20),\r\n@STOKBRIMTIP      INT,\r\n@KDVTIP           VARCHAR(10),\r\n@TARIH1           DATETIME,\r\n@TARIH2           DATETIME)\r\nRETURNS\r\n\r\n  @TB_STOKTAR_HRK TABLE (\r\n    FIRMANO           INT,\r\n    STOK_TIP          VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    STOK_GRUP         VARCHAR(100) COLLATE Turkish_CI_AS,\r\n    STOK_KOD          VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    STOK_AD           VARCHAR(100) COLLATE Turkish_CI_AS,\r\n    STOK_BARKOD       VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    DEPO_KOD          VARCHAR(30)  COLLATE Turkish_CI_AS,\r\n    DEPO_AD           VARCHAR(50)  COLLATE Turkish_CI_AS,\r\n    DEVIRMIKTAR       FLOAT,\r\n    DEVIRBRMFIY       FLOAT,\r\n    DEVIRTUTAR        FLOAT,\r\n    GIRENMIKTAR       FLOAT,\r\n    GIRENTUTAR        FLOAT,\r\n    CIKANMIKTAR       FLOAT,\r\n    CIKANTUTAR        FLOAT,\r\n    KALANMIKTAR       FLOAT,\r\n    KALANTUTAR        FLOAT,\r\n    BRIM              VARCHAR(20)  COLLATE Turkish_CI_AS,\r\n    BRMFIYKDVLI       FLOAT,\r\n    KDVYUZ            FLOAT,\r\n    MEVCUTMIKTAR      FLOAT)\r\nAS\r\nBEGIN\r\n  DECLARE @STKHRKTAR_TEMP TABLE (\r\n    FIRMANO           INT,\r\n    STOK_TIP        VARCHAR(20)   COLLATE Turkish_CI_AS,\r\n    STOK_GRUP       VARCHAR(100) COLLATE Turkish_CI_AS,\r\n    STOK_KOD        VARCHAR(50)   COLLATE Turkish_CI_AS,\r\n    STOK_AD         VARCHAR(150)  COLLATE Turkish_CI_AS,\r\n    STOK_BARKOD     VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    DEPO_KOD        VARCHAR(30)   COLLATE Turkish_CI_AS,\r\n    DEPO_AD         VARCHAR(50)   COLLATE Turkish_CI_AS,\r\n    DEVIRMIKTAR     FLOAT,\r\n    DEVIRBRMFIY     FLOAT,\r\n    DEVIRTUTAR      FLOAT,\r\n    GIRENMIKTAR     FLOAT,\r\n    GIRENTUTAR      FLOAT,\r\n    CIKANMIKTAR     FLOAT,\r\n    CIKANTUTAR      FLOAT,\r\n    KALANMIKTAR     FLOAT,\r\n    KALANTUTAR      FLOAT,\r\n    BRIM            VARCHAR(20)  COLLATE Turkish_CI_AS,\r\n    BRMFIYKDVLI     FLOAT,\r\n    KDVYUZ          FLOAT,\r\n    MEVCUTMIKTAR    FLOAT)\r\n\r\n  DECLARE @HRK_FIRMANO    INT\r\n  DECLARE @HRK_STOK_TIP    VARCHAR(20)\r\n  DECLARE @HRK_STOK_GRUP   VARCHAR(100)\r\n  DECLARE @HRK_STOK_KOD    VARCHAR(50)\r\n  DECLARE @HRK_STOK_AD     VARCHAR(150)\r\n  DECLARE @HRK_BARKOD      VARCHAR(30)\r\n  DECLARE @HRK_DEPO_KOD    VARCHAR(30)\r\n  DECLARE @HRK_DEPO_AD     VARCHAR(50)\r\n  DECLARE @HRK_TARIH       DATETIME\r\n  DECLARE @HRK_DEVIRMIK    FLOAT\r\n  DECLARE @HRK_DEVIRBRM    FLOAT\r\n  DECLARE @HRK_DEVIRTUT    FLOAT\r\n  DECLARE @HRK_GIRENMIK    FLOAT\r\n  DECLARE @HRK_GIRENTUT    FLOAT\r\n  DECLARE @HRK_CIKANMIK    FLOAT\r\n  DECLARE @HRK_CIKANTUT    FLOAT\r\n  DECLARE @HRK_KALANMIK    FLOAT\r\n  DECLARE @HRK_KALANTUT    FLOAT\r\n  DECLARE @HRK_BRIM        VARCHAR(50)\r\n  DECLARE @HRK_BRMFIYKDVLI FLOAT\r\n  DECLARE @HRK_KDVYUZ      FLOAT\r\n  DECLARE @MEVCUTMIKTAR    FLOAT\r\n\r\n\r\n\r\n /*---------------------------------------------------------------------------- */\r\n   \r\n   DECLARE @STKHRK_TEMP TABLE (\r\n    FIRMANO         INT,\r\n    TARIH           DATETIME,\r\n    STOK_TIP        VARCHAR(20)   COLLATE Turkish_CI_AS,\r\n    STOK_KOD        VARCHAR(50)   COLLATE Turkish_CI_AS,\r\n    DEPO_KOD        VARCHAR(30)   COLLATE Turkish_CI_AS,\r\n    GIRENMIKTAR     FLOAT,\r\n    CIKANMIKTAR     FLOAT,\r\n    BRIM            VARCHAR(20)  COLLATE Turkish_CI_AS,\r\n    ISLEMTIP        VARCHAR(20)  COLLATE Turkish_CI_AS,\r\n    BRMFIYKDVLI     FLOAT,\r\n    KDVYUZ          FLOAT,\r\n    MEVCUTMIKTAR    FLOAT)\r\n \r\n\r\n \r\n if (@FIRMANO=0) and (@STOK_DEPKOD<>'')\r\n  begin\r\n   INSERT @STKHRK_TEMP (FIRMANO,TARIH,STOK_TIP,STOK_KOD,DEPO_KOD,ISLEMTIP,\r\n   BRIM,KDVYUZ,BRMFIYKDVLI,GIRENMIKTAR,CIKANMIKTAR)\r\n   SELECT 0,h.Tarih+cast(h.saat as datetime),k.tip,k.kod,isnull(h.depkod,''),h.islmtip,\r\n   k.brim,h.kdvyuz,\r\n   h.brmfiykdvli,h.giren,h.cikan from stokkart as k with (nolock)\r\n   inner join stkhrk h with (nolock) on k.kod=h.stkod and\r\n   k.tip=h.stktip and h.sil=0 and h.depkod=@STOK_DEPKOD\r\n   and h.islmtip not in\r\n   (select * from CsvToSTR(@HRK_KRITER)) \r\n   WHERE k.tip=@STOK_TIP and k.sil=0 and k.kod\r\n   in (select * FROM CsvToSTR(@STOK_KODIN))\r\n   AND tarih <= @TARIH2\r\n   \r\n   \r\n   \r\n   \r\n   \r\n   \r\n end\r\n\r\n\r\n if (@FIRMANO=0) and (@STOK_DEPKOD='') \r\n  begin\r\n   INSERT @STKHRK_TEMP (FIRMANO,TARIH,STOK_TIP,STOK_KOD,DEPO_KOD,ISLEMTIP,\r\n   BRIM,KDVYUZ,BRMFIYKDVLI,GIRENMIKTAR,CIKANMIKTAR)\r\n   SELECT 0,h.Tarih+cast(h.saat as datetime),k.tip,k.kod,isnull(h.depkod,''),h.islmtip,\r\n   k.brim,h.kdvyuz,\r\n   h.brmfiykdvli,h.giren,h.cikan from stokkart as k with (nolock)\r\n   inner join stkhrk h with (nolock) on k.kod=h.stkod and\r\n   k.tip=h.stktip and h.sil=0 \r\n   and h.islmtip not in\r\n   (select * from CsvToSTR(@HRK_KRITER)) \r\n   WHERE k.tip=@STOK_TIP and k.sil=0 and k.kod\r\n   in (select * FROM CsvToSTR(@STOK_KODIN))\r\n   AND tarih <= @TARIH2\r\n   \r\n   \r\n   \r\n   \r\n   \r\n  end\r\n /*------------------------------------------------------------ */\r\n \r\n  /*firmano Kriter */\r\n  if (@FIRMANO>0) and  (@STOK_DEPKOD<>'')\r\n  begin\r\n   INSERT @STKHRK_TEMP (FIRMANO,TARIH,STOK_TIP,STOK_KOD,DEPO_KOD,ISLEMTIP,\r\n   BRIM,KDVYUZ,BRMFIYKDVLI,GIRENMIKTAR,CIKANMIKTAR)\r\n   SELECT 0,h.Tarih+cast(h.saat as datetime),k.tip,k.kod,isnull(h.depkod,''),h.islmtip,\r\n   k.brim,h.kdvyuz,\r\n   h.brmfiykdvli,h.giren,h.cikan from stokkart as k with (nolock)\r\n   inner join stkhrk h with (nolock) on k.kod=h.stkod and\r\n   k.tip=h.stktip and h.sil=0 and h.firmano in (@FIRMANO,0)\r\n   and h.depkod=@STOK_DEPKOD\r\n   and h.islmtip not in\r\n   (select * from CsvToSTR(@HRK_KRITER)) \r\n   WHERE k.tip=@STOK_TIP and k.sil=0 and k.kod\r\n   in (select * FROM CsvToSTR(@STOK_KODIN))\r\n   AND tarih <= @TARIH2\r\n   \r\n\r\n  end\r\n\r\n\r\n if (@FIRMANO>0) and (@STOK_DEPKOD='')\r\n begin\r\n   INSERT @STKHRK_TEMP (FIRMANO,TARIH,STOK_TIP,STOK_KOD,DEPO_KOD,ISLEMTIP,\r\n   BRIM,KDVYUZ,BRMFIYKDVLI,GIRENMIKTAR,CIKANMIKTAR)\r\n   SELECT 0,h.Tarih+cast(h.saat as datetime),k.tip,k.kod,isnull(h.depkod,''),h.islmtip,\r\n   k.brim,h.kdvyuz,\r\n   h.brmfiykdvli,h.giren,h.cikan from stokkart as k with (nolock)\r\n   inner join stkhrk h with (nolock) on k.kod=h.stkod and\r\n   k.tip=h.stktip and h.sil=0 and h.firmano in (@FIRMANO,0)\r\n   and h.islmtip not in\r\n   (select * from CsvToSTR(@HRK_KRITER)) \r\n   WHERE k.tip=@STOK_TIP and k.sil=0 and k.kod\r\n   in (select * FROM CsvToSTR(@STOK_KODIN))\r\n   AND tarih <= @TARIH2\r\n   \r\n   \r\n  \r\n   \r\n   \r\n  end\r\n\r\n /*------------------------------------------------------------ */\r\n \r\n\r\n \r\n if (@STOK_DEPKOD<>'')\r\n   INSERT @STKHRKTAR_TEMP (FIRMANO,STOK_TIP,STOK_GRUP,STOK_KOD,STOK_AD,\r\n   STOK_BARKOD,DEPO_KOD,DEPO_AD,BRIM,KDVYUZ,BRMFIYKDVLI,\r\n   DEVIRMIKTAR,DEVIRBRMFIY,DEVIRTUTAR,GIRENMIKTAR,GIRENTUTAR,\r\n   CIKANMIKTAR,CIKANTUTAR,KALANMIKTAR,KALANTUTAR,MEVCUTMIKTAR)\r\n   SELECT FIRMANO,STOK_TIP,'',STOK_KOD,'',\r\n   '',DEPO_KOD,'',BRIM,MAX(KDVYUZ)*100,0 BRMFIYKDVLI,\r\n   0 DEVIRMIKTAR,0 DEVIRBRMFIY,0 DEVIRTUTAR,0 GIRENMIKTAR,0 GIRENTUTAR,\r\n   0 CIKANMIKTAR,0 CIKANTUTAR,0 KALANMIKTAR,0 KALANTUTAR,MAX(MEVCUTMIKTAR)\r\n   FROM @STKHRK_TEMP\r\n   GROUP BY FIRMANO,STOK_TIP,STOK_KOD,BRIM,DEPO_KOD\r\n\r\n  if (@STOK_DEPKOD='')\r\n   INSERT @STKHRKTAR_TEMP (FIRMANO,STOK_TIP,STOK_GRUP,STOK_KOD,STOK_AD,\r\n   STOK_BARKOD,DEPO_KOD,DEPO_AD,BRIM,KDVYUZ,BRMFIYKDVLI,\r\n   DEVIRMIKTAR,DEVIRBRMFIY,DEVIRTUTAR,GIRENMIKTAR,GIRENTUTAR,\r\n   CIKANMIKTAR,CIKANTUTAR,KALANMIKTAR,KALANTUTAR,MEVCUTMIKTAR)\r\n   SELECT FIRMANO,STOK_TIP,'',STOK_KOD,'',\r\n   '','' DEPO_KOD,'',BRIM,0 KDVYUZ,0 BRMFIYKDVLI,\r\n   0 DEVIRMIKTAR,0 DEVIRBRMFIY,0 DEVIRTUTAR,0 GIRENMIKTAR,0 GIRENTUTAR,\r\n   0 CIKANMIKTAR,0 CIKANTUTAR,0 KALANMIKTAR,0 KALANTUTAR,MAX(MEVCUTMIKTAR)\r\n   FROM @STKHRK_TEMP\r\n   GROUP BY FIRMANO,STOK_TIP,STOK_KOD,BRIM\r\n\r\n\r\n\r\n  /* MEVCUT MIKTAR   */\r\n  if (@FIRMANO=0) and (@STOK_DEPKOD<>'')\r\n   UPDATE @STKHRKTAR_TEMP SET MEVCUTMIKTAR=DT.miktar from @STKHRKTAR_TEMP as t join\r\n   (select h.stktip,h.stkod,sum(h.giren-h.cikan) as miktar from stkhrk h with (nolock) where sil=0\r\n   and h.stktip=@STOK_TIP and h.depkod=@STOK_DEPKOD and h.stkod in (select * FROM CsvToSTR(@STOK_KODIN))\r\n   group by h.stktip,h.stkod ) dt on dt.stkod=t.STOK_KOD and dt.stktip=t.STOK_TIP\r\n   \r\n  if (@FIRMANO=0) and (@STOK_DEPKOD='')   \r\n   UPDATE @STKHRKTAR_TEMP SET MEVCUTMIKTAR=DT.miktar from @STKHRKTAR_TEMP as t join\r\n   (select h.stktip,h.stkod,sum(h.giren-h.cikan) as miktar from stkhrk h with (nolock) where sil=0\r\n   and h.stktip=@STOK_TIP and h.stkod in (select * FROM CsvToSTR(@STOK_KODIN))\r\n   group by h.stktip,h.stkod ) dt on dt.stkod=t.STOK_KOD and dt.stktip=t.STOK_TIP \r\n\r\n\r\n  if (@FIRMANO>0) and  (@STOK_DEPKOD<>'')\r\n   UPDATE @STKHRKTAR_TEMP SET MEVCUTMIKTAR=DT.miktar from @STKHRKTAR_TEMP as t join\r\n   (select h.stktip,h.stkod,sum(h.giren-h.cikan) as miktar from stkhrk h with (nolock) where sil=0\r\n   and h.stktip=@STOK_TIP and h.firmano in (@FIRMANO,0)\r\n   and h.depkod=@STOK_DEPKOD and h.stkod in (select * FROM CsvToSTR(@STOK_KODIN))\r\n   group by h.stktip,h.stkod ) dt on dt.stkod=t.STOK_KOD and dt.stktip=t.STOK_TIP\r\n\r\n  if (@FIRMANO>0) and (@STOK_DEPKOD='')\r\n    UPDATE @STKHRKTAR_TEMP SET MEVCUTMIKTAR=DT.miktar from @STKHRKTAR_TEMP as t join \r\n   (select h.stktip,h.stkod,sum(h.giren-h.cikan) as miktar from stkhrk h with (nolock) where sil=0\r\n   and h.stktip=@STOK_TIP and h.firmano in (@FIRMANO,0)\r\n   and h.stkod in (select * FROM CsvToSTR(@STOK_KODIN))\r\n   group by h.stktip,h.stkod ) dt on dt.stkod=t.STOK_KOD and dt.stktip=t.STOK_TIP\r\n   \r\n\r\n /*Devir Bilgileri Hesapla */\r\n \r\n if @STOK_DEPKOD<>'' \r\n begin\r\n   UPDATE @STKHRKTAR_TEMP SET DEVIRMIKTAR=DEVIRMIKTART\r\n   from @STKHRKTAR_TEMP t join\r\n   (SELECT k.STOK_TIP,k.STOK_KOD,k.DEPO_KOD,\r\n   isnull(SUM(GIRENMIKTAR-CIKANMIKTAR),0) AS DEVIRMIKTART\r\n   from @STKHRK_TEMP as k WHERE K.TARIH < @TARIH1\r\n   group by k.STOK_TIP,k.STOK_KOD,k.DEPO_KOD)\r\n   dt  on t.STOK_TIP=dt.STOK_TIP and t.STOK_KOD=dt.STOK_KOD\r\n   and t.DEPO_KOD=dt.DEPO_KOD\r\n end\r\n \r\n if @STOK_DEPKOD='' \r\n begin\r\n   UPDATE @STKHRKTAR_TEMP SET DEVIRMIKTAR=DEVIRMIKTART\r\n   from @STKHRKTAR_TEMP t join\r\n   (SELECT k.STOK_TIP,k.STOK_KOD,\r\n   isnull(SUM(GIRENMIKTAR-CIKANMIKTAR),0) AS DEVIRMIKTART\r\n   from @STKHRK_TEMP as k WHERE K.TARIH < @TARIH1\r\n   group by k.STOK_TIP,k.STOK_KOD)\r\n   dt  on t.STOK_TIP=dt.STOK_TIP and t.STOK_KOD=dt.STOK_KOD\r\n end\r\n\r\n /*Devir Bilgileri Hesapla Sonu */\r\n \r\n \r\n \r\n  /*Icerik Giren Cikan Bilgileri */\r\n  \r\n   DECLARE STKTAR_HRK CURSOR FAST_FORWARD FOR\r\n    SELECT\r\n      k.STOK_TIP,k.STOK_KOD\r\n      FROM @STKHRKTAR_TEMP as k\r\n      GROUP BY k.STOK_TIP,k.STOK_KOD\r\n\r\n  OPEN STKTAR_HRK\r\n\r\n  FETCH NEXT FROM STKTAR_HRK INTO\r\n   @HRK_STOK_TIP,@HRK_STOK_KOD\r\n   /*@HRK_DEPO_KOD */\r\n   \r\n\r\n  WHILE @@FETCH_STATUS = 0\r\n  BEGIN\r\n  \r\n   SET @HRK_KDVYUZ=0\r\n   SET @HRK_BRMFIYKDVLI=0\r\n   SET @HRK_DEVIRBRM=0\r\n  \r\n  \r\n   SET @HRK_GIRENMIK=0\r\n   SET @HRK_CIKANMIK=0 \r\n   SET @HRK_GIRENTUT=0 \r\n   SET @HRK_CIKANTUT=0\r\n  \r\n     SELECT\r\n      @HRK_GIRENMIK=ISNULL(SUM(k.GIRENMIKTAR),0),\r\n      @HRK_CIKANMIK=ISNULL(SUM(k.CIKANMIKTAR),0),\r\n      @HRK_GIRENTUT=ISNULL(SUM(k.GIRENMIKTAR*k.BRMFIYKDVLI),0),\r\n      @HRK_CIKANTUT=ISNULL(SUM(k.CIKANMIKTAR*k.BRMFIYKDVLI),0)\r\n      FROM @STKHRK_TEMP as k WHERE k.STOK_KOD=@HRK_STOK_KOD\r\n      and k.TARIH>=@TARIH1 /*and k.TARIH<=@TARIH2  */\r\n      GROUP BY k.STOK_TIP,k.STOK_KOD\r\n  \r\n  \r\n\r\n  /* Ortalama Alis */\r\n   IF @STOKBRIMTIP=0\r\n    BEGIN\r\n    \r\n    select @HRK_KDVYUZ=(alskdv/100) From Stokkart \r\n    with (nolock) Where tip=@HRK_STOK_TIP and Kod=@HRK_STOK_KOD\r\n    \r\n\r\n    SELECT  @HRK_BRMFIYKDVLI=case when SUM(h.GIRENMIKTAR)<>0 then \r\n    sum(h.GIRENMIKTAR*h.BRMFIYKDVLI)/SUM(h.GIRENMIKTAR)\r\n    else 0 end \r\n    from @STKHRK_TEMP as h \r\n    where STOK_TIP=@HRK_STOK_TIP and STOK_KOD=@HRK_STOK_KOD\r\n    and  h.TARIH<=DATEADD(MINUTE,59,DATEADD(HOUR,23,@TARIH2)) \r\n    \r\n    SELECT  @HRK_DEVIRBRM=case when SUM(h.GIRENMIKTAR)<>0 then \r\n    sum(h.GIRENMIKTAR*h.BRMFIYKDVLI)/SUM(h.GIRENMIKTAR)\r\n    else 0 end \r\n    from @STKHRK_TEMP as h \r\n    where STOK_TIP=@HRK_STOK_TIP and STOK_KOD=@HRK_STOK_KOD\r\n    and h.TARIH<@TARIH1\r\n        \r\n    \r\n    \r\n     \r\n  END\r\n\r\n   /* Son Tarihteki Alis Fiyat */\r\n   if @STOKBRIMTIP=1\r\n    BEGIN\r\n        /*\r\n        SELECT TOP 1 @HRK_KDVYUZ=isnull(h.KDVYUZ,0),\r\n        @HRK_BRMFIYKDVLI=isnull(h.BRMFIYKDVLI,0)\r\n        from @STKHRK_TEMP as h \r\n        where STOK_TIP=@HRK_STOK_TIP and STOK_KOD=@HRK_STOK_KOD\r\n        and h.TARIH<=@TARIH2 and h.GIRENMIKTAR>0 \r\n        order by h.TARIH desc\r\n        \r\n        \r\n         SELECT TOP 1 @HRK_DEVIRBRM=isnull(h.BRMFIYKDVLI,0)\r\n         from @STKHRK_TEMP as h \r\n         where STOK_TIP=@HRK_STOK_TIP and STOK_KOD=@HRK_STOK_KOD\r\n         and h.TARIH<@TARIH1 and h.GIRENMIKTAR>0 \r\n         order by h.TARIH desc \r\n         \r\n         */\r\n         \r\n         /* SELECT TOP 1 \r\n          @HRK_KDVYUZ=isnull(h.KDVYUZ,0)\r\n          from @STKHRK_TEMP as h \r\n          where STOK_TIP=@HRK_STOK_TIP and STOK_KOD=@HRK_STOK_KOD\r\n          and h.TARIH<=DATEADD(MINUTE,59,DATEADD(HOUR,23,@TARIH2)) \r\n          order by h.TARIH desc\r\n         */\r\n         \r\n         select @HRK_KDVYUZ=(alskdv/100) From Stokkart  \r\n         with (nolock) Where tip=@HRK_STOK_TIP and Kod=@HRK_STOK_KOD\r\n    \r\n         \r\n         \r\n                  declare @EvrakTarih datetime\r\n                   \r\n                       \r\n             \r\n                    SELECT TOP 1 @EvrakTarih=h.TARIH,\r\n                    @HRK_BRMFIYKDVLI=h.BRMFIYKDVLI \r\n                    from @STKHRK_TEMP as h \r\n                    where STOK_TIP=@HRK_STOK_TIP and STOK_KOD=@HRK_STOK_KOD\r\n                    and h.TARIH<=DATEADD(MINUTE,59,DATEADD(HOUR,23,@TARIH2)) \r\n                    and h.GIRENMIKTAR>0 and ISLEMTIP<>'MARIAD'\r\n                    order by h.TARIH desc\r\n                 \r\n                  /*Ayni Zaman Dilinde 1 den fazla Kayit Varsa  */\r\n                    if (Select Count(STOK_KOD) from @STKHRK_TEMP as h \r\n                    where STOK_TIP=@HRK_STOK_TIP and STOK_KOD=@HRK_STOK_KOD\r\n                    and h.TARIH=@EvrakTarih and h.GIRENMIKTAR>0 and ISLEMTIP<>'MARIAD')>1\r\n                    begin\r\n                       SELECT @HRK_BRMFIYKDVLI=\r\n                       sum(h.BRMFIYKDVLI*h.GIRENMIKTAR)/sum(h.GIRENMIKTAR)\r\n                     from @STKHRK_TEMP as h \r\n                      where STOK_TIP=@HRK_STOK_TIP and STOK_KOD=@HRK_STOK_KOD\r\n                      and h.TARIH=@EvrakTarih and h.GIRENMIKTAR>0 and ISLEMTIP<>'MARIAD'\r\n                     end \r\n          \r\n          \r\n          \r\n         \r\n                    SELECT TOP 1 @EvrakTarih=h.TARIH,\r\n                    @HRK_DEVIRBRM=h.BRMFIYKDVLI \r\n                    from @STKHRK_TEMP as h \r\n                    where STOK_TIP=@HRK_STOK_TIP and STOK_KOD=@HRK_STOK_KOD\r\n                    and h.TARIH<@TARIH1 and h.GIRENMIKTAR>0 and ISLEMTIP<>'MARIAD'\r\n                    order by h.TARIH desc\r\n         \r\n         \r\n                    /*Ayni Zaman Diliminde 1 den fazla Kayit Varsa  */\r\n                    if (Select Count(STOK_KOD) from @STKHRK_TEMP as h \r\n                    where STOK_TIP=@HRK_STOK_TIP and STOK_KOD=@HRK_STOK_KOD\r\n                    and h.TARIH=@EvrakTarih and h.GIRENMIKTAR>0 and ISLEMTIP<>'MARIAD')>1\r\n                    begin\r\n                       SELECT @HRK_DEVIRBRM=\r\n                       sum(h.BRMFIYKDVLI*h.GIRENMIKTAR)/sum(h.GIRENMIKTAR)\r\n                     from @STKHRK_TEMP as h \r\n                      where STOK_TIP=@HRK_STOK_TIP and STOK_KOD=@HRK_STOK_KOD\r\n                      and h.TARIH=@EvrakTarih and h.GIRENMIKTAR>0 and ISLEMTIP<>'MARIAD'\r\n                     end \r\n                    \r\n         \r\n\r\n         \r\n         \r\n     END  \r\n   \r\n   \r\n   /* Son Tarihteki Satis Fiyati */\r\n   if @STOKBRIMTIP=2\r\n    BEGIN\r\n    \r\n     select @HRK_KDVYUZ=(sat1kdv/100) From Stokkart  \r\n      with (nolock) Where tip=@HRK_STOK_TIP and Kod=@HRK_STOK_KOD\r\n    \r\n   \r\n   \r\n      SELECT TOP 1 \r\n      /*@HRK_KDVYUZ=isnull(h.KDVYUZ,0), */\r\n      @HRK_BRMFIYKDVLI=isnull(h.BRMFIYKDVLI,0)\r\n      from @STKHRK_TEMP as h \r\n      where STOK_TIP=@HRK_STOK_TIP and STOK_KOD=@HRK_STOK_KOD\r\n      and h.TARIH<=DATEADD(MINUTE,59,DATEADD(HOUR,23,@TARIH2)) \r\n      and h.CIKANMIKTAR>0 \r\n      order by h.TARIH desc\r\n      \r\n      \r\n       SELECT TOP 1 @HRK_DEVIRBRM=isnull(h.BRMFIYKDVLI,0)\r\n       from @STKHRK_TEMP as h \r\n       where STOK_TIP=@HRK_STOK_TIP and STOK_KOD=@HRK_STOK_KOD\r\n       and h.TARIH<@TARIH1 and h.CIKANMIKTAR>0 \r\n       order by h.TARIH desc\r\n\r\n    END\r\n   \r\n   \r\n   /*Fifo (Ortalama Birim Fiyat) */\r\n   if @STOKBRIMTIP=3\r\n   BEGIN\r\n    set  @HRK_DEPO_KOD=''\r\n    if @STOK_DEPKOD<>''\r\n    set @HRK_DEPO_KOD=@STOK_DEPKOD\r\n   \r\n   \r\n      select @HRK_KDVYUZ=(sat1kdv/100) From Stokkart \r\n      with (nolock) Where tip=@HRK_STOK_TIP and Kod=@HRK_STOK_KOD\r\n   \r\n   \r\n     SELECT @HRK_BRMFIYKDVLI=MALIYET FROM STOKFIFO (1,@HRK_DEPO_KOD,@HRK_STOK_TIP,@HRK_STOK_KOD,@TARIH1,@TARIH2)\r\n     SELECT @HRK_DEVIRBRM=MALIYET FROM STOKFIFO (1,@HRK_DEPO_KOD,@HRK_STOK_TIP,@HRK_STOK_KOD,0,@TARIH1)\r\n   END\r\n   \r\n   /*Satis Fiyat -1 */\r\n   IF @STOKBRIMTIP=4\r\n   BEGIN\r\n   \r\n   \r\n     select \r\n     @HRK_KDVYUZ=sat1kdv/100,\r\n     @HRK_BRMFIYKDVLI=case when sat1kdvtip='Dahil' then\r\n      sat1fiy else sat1fiy*(1+(sat1kdv/100)) end from stokkart with (nolock) \r\n      where tip=@HRK_STOK_TIP and kod=@HRK_STOK_KOD\r\n     \r\n      SET @HRK_DEVIRBRM=@HRK_BRMFIYKDVLI\r\n   \r\n   END\r\n\r\n   /*Satis Fiyat -2 */\r\n   if @STOKBRIMTIP=5\r\n   BEGIN\r\n   select @HRK_KDVYUZ=sat2kdv/100,\r\n   @HRK_BRMFIYKDVLI=case when sat2kdvtip='Dahil' then\r\n    sat2fiy else sat2fiy*(1+(sat2kdv/100))  end from stokkart with (nolock)\r\n   where tip=@HRK_STOK_TIP and kod=@HRK_STOK_KOD\r\n   \r\n   SET @HRK_DEVIRBRM=@HRK_BRMFIYKDVLI\r\n   \r\n   END\r\n   \r\n   \r\n    /*Alis Fiyat */\r\n   if @STOKBRIMTIP=6\r\n   BEGIN\r\n   select @HRK_KDVYUZ=alskdv/100,\r\n   @HRK_BRMFIYKDVLI=case when alskdvtip='Dahil' then\r\n    alsfiy else alsfiy*(1+(alsfiy/100))  end from stokkart with (nolock)\r\n   where tip=@HRK_STOK_TIP and kod=@HRK_STOK_KOD\r\n   \r\n   SET @HRK_DEVIRBRM=@HRK_BRMFIYKDVLI\r\n   \r\n   END\r\n   \r\n\r\n   IF @KDVTIP<>'Dahil' /*Haric */\r\n    BEGIN\r\n     set @HRK_BRMFIYKDVLI=@HRK_BRMFIYKDVLI/(1+@HRK_KDVYUZ)\r\n     set @HRK_DEVIRBRM=@HRK_DEVIRBRM/(1+@HRK_KDVYUZ)\r\n     SET @HRK_GIRENTUT=@HRK_GIRENTUT/(1+@HRK_KDVYUZ)\r\n     SET @HRK_CIKANTUT=@HRK_CIKANTUT/(1+@HRK_KDVYUZ)\r\n      \r\n    END \r\n\r\n\r\n\r\n \r\n     update @STKHRKTAR_TEMP\r\n       set KDVYUZ=@HRK_KDVYUZ,BRMFIYKDVLI=@HRK_BRMFIYKDVLI,\r\n       DEVIRTUTAR=DEVIRMIKTAR*@HRK_DEVIRBRM,\r\n       GIRENMIKTAR=@HRK_GIRENMIK,GIRENTUTAR=@HRK_GIRENTUT,\r\n       CIKANMIKTAR=@HRK_CIKANMIK,CIKANTUTAR=@HRK_CIKANTUT,\r\n       KALANMIKTAR=DEVIRMIKTAR+@HRK_GIRENMIK-@HRK_CIKANMIK,\r\n       KALANTUTAR=(DEVIRMIKTAR+@HRK_GIRENMIK-@HRK_CIKANMIK)*@HRK_BRMFIYKDVLI\r\n       where STOK_TIP=@HRK_STOK_TIP and STOK_KOD=@HRK_STOK_KOD\r\n\r\n\r\n\r\n     FETCH NEXT FROM STKTAR_HRK INTO\r\n    @HRK_STOK_TIP,@HRK_STOK_KOD\r\n  END\r\n\r\n  CLOSE STKTAR_HRK\r\n  DEALLOCATE STKTAR_HRK\r\n\r\n  /*---------------------------------------------------------------------------- */\r\n  \r\n  \r\n   UPDATE @STKHRKTAR_TEMP set STOK_AD=dt.ad,\r\n   STOK_BARKOD=DT.barkod,STOK_GRUP=dt.grup_ad from @STKHRKTAR_TEMP as t join \r\n   (select K.tip,K.kod,K.ad,K.barkod,g.ad grup_ad from stokkart k with (nolock)\r\n   left join grup as g on g.id=case when k.grp3>0 then k.grp3 \r\n   when k.grp2>0 then k.grp2 when k.grp1>0 then k.grp1 end) dt\r\n   on dt.tip=t.STOK_TIP and dt.kod=STOK_KOD\r\n  \r\n  \r\n    \r\n  /*\r\n    update @STKHRKTAR_TEMP set KALANMIKTAR=DEVIRMIKTAR+GIRENMIKTAR-CIKANMIKTAR,\r\n    KALANTUTAR=(DEVIRTUTAR/DEVIRMIKTAR)*(DEVIRMIKTAR+GIRENMIKTAR-CIKANMIKTAR)\r\n    where GIRENMIKTAR=0 and CIKANMIKTAR=0 and DEVIRMIKTAR>0\r\n    */\r\n  \r\n   INSERT @TB_STOKTAR_HRK\r\n    SELECT * FROM @STKHRKTAR_TEMP\r\n  \r\n\r\n  \r\n\r\n  RETURN\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_STOKFIYATDEGISIM",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_STOKFIYATDEGISIM",
    "definition": "CREATE FUNCTION [dbo].UDF_STOKFIYATDEGISIM (@STOK_DEPKOD VARCHAR(20),\r\n@STOK_TIP VARCHAR(20),\r\n@STOKBRIMTIP INT,\r\n@KDVTIP VARCHAR(10),\r\n@TARIH1 DATETIME, @TARIH2 DATETIME)\r\nRETURNS\r\n\r\n  @TB_STOKTAR_HRK TABLE (\r\n    STOK_TIP    VARCHAR(20)   COLLATE Turkish_CI_AS,\r\n    STOK_KOD    VARCHAR(20)   COLLATE Turkish_CI_AS,\r\n    STOK_AD     VARCHAR(50)   COLLATE Turkish_CI_AS,\r\n    DEPO_KOD    VARCHAR(20)   COLLATE Turkish_CI_AS,\r\n    DEPO_AD     VARCHAR(50)   COLLATE Turkish_CI_AS,\r\n    DEVIRMIKTAR     FLOAT,\r\n    DEVIRTUTAR      FLOAT,\r\n    GIRENMIKTAR      FLOAT,\r\n    GIRENTUTAR       FLOAT,\r\n    CIKANMIKTAR      FLOAT,\r\n    CIKANTUTAR       FLOAT,\r\n    KALANMIKTAR      FLOAT,\r\n    KALANTUTAR       FLOAT,\r\n    BRIM             VARCHAR(20)   COLLATE Turkish_CI_AS,\r\n    BRMFIYKDVLI     FLOAT,\r\n    KDVYUZ      FLOAT)\r\nAS\r\nBEGIN\r\n  DECLARE @STKHRKTAR_TEMP TABLE (\r\n    STOK_TIP    VARCHAR(20)   COLLATE Turkish_CI_AS,\r\n    STOK_KOD    VARCHAR(20)   COLLATE Turkish_CI_AS,\r\n    STOK_AD     VARCHAR(50)   COLLATE Turkish_CI_AS,\r\n    DEPO_KOD    VARCHAR(20)   COLLATE Turkish_CI_AS,\r\n    DEPO_AD     VARCHAR(50)   COLLATE Turkish_CI_AS,\r\n    DEVIRMIKTAR     FLOAT,\r\n    DEVIRTUTAR      FLOAT,\r\n    GIRENMIKTAR      FLOAT,\r\n    GIRENTUTAR       FLOAT,\r\n    CIKANMIKTAR      FLOAT,\r\n    CIKANTUTAR       FLOAT,\r\n    KALANMIKTAR      FLOAT,\r\n    KALANTUTAR       FLOAT,\r\n    BRIM             VARCHAR(20)  COLLATE Turkish_CI_AS,\r\n    BRMFIYKDVLI     FLOAT,\r\n    KDVYUZ      FLOAT)\r\n\r\n  DECLARE @HRK_STOK_TIP    VARCHAR(20)\r\n  DECLARE @HRK_STOK_KOD    VARCHAR(20)\r\n  DECLARE @HRK_STOK_AD     VARCHAR(50)\r\n  DECLARE @HRK_DEPO_KOD    VARCHAR(20)\r\n  DECLARE @HRK_DEPO_AD     VARCHAR(50)\r\n  DECLARE @HRK_TARIH       DATETIME\r\n  DECLARE @HRK_DEVIRMIK    FLOAT\r\n  DECLARE @HRK_DEVIRTUT    FLOAT\r\n  DECLARE @HRK_GIRENMIK    FLOAT\r\n  DECLARE @HRK_GIRENTUT    FLOAT\r\n  DECLARE @HRK_CIKANMIK    FLOAT\r\n  DECLARE @HRK_CIKANTUT    FLOAT\r\n  DECLARE @HRK_KALANMIK    FLOAT\r\n  DECLARE @HRK_KALANTUT    FLOAT\r\n\r\n  DECLARE @HRK_BRIM        VARCHAR(50)\r\n  DECLARE @HRK_BRMFIYKDVLI FLOAT\r\n  DECLARE @HRK_KDVYUZ      FLOAT\r\n\r\n/*\r\n0=ALIS FIYAT\r\n1=SATIS FIYAT 1\r\n2=SATIS FIYAT 2\r\n3=FIFO ALIS ORT\r\n4=FIFO ALIS ORT\r\n*/\r\n\r\n\r\n /*---------------------------------------------------------------------------- */\r\n INSERT @STKHRKTAR_TEMP (STOK_TIP,STOK_KOD,STOK_AD,DEPO_KOD,DEPO_AD,BRIM,KDVYUZ,BRMFIYKDVLI,\r\n DEVIRMIKTAR,DEVIRTUTAR,GIRENMIKTAR,GIRENTUTAR,CIKANMIKTAR,CIKANTUTAR,\r\n KALANMIKTAR,KALANTUTAR)\r\n SELECT k.tip,k.kod,k.ad,d.kod,D.ad,k.brim,0,0,\r\n /*---------devır mıktar */\r\n   (SELECT isnull(SUM(giren-cikan),0) from stkhrk as s\r\n   WHERE s.stktip=k.tip and s.stkod=k.kod and s.depkod=sd.depkod\r\n   AND tarih < @TARIH1),\r\n /*--------------- */\r\n  0,0,0,0,0,\r\n 0,0 from stokkart as k\r\n inner join stkdrm as sd on sd.stktip=k.tip and sd.stkod=k.kod\r\n inner join Depo_Kart_Listesi  as d on d.kod=sd.depkod\r\n WHERE k.tip=@STOK_TIP and k.sil=0\r\n\r\n\r\n  DECLARE STKTAR_HRK CURSOR FAST_FORWARD FOR\r\n   SELECT\r\n      k.tip,k.kod,k.ad,d.kod,D.ad,K.brim,S.kdvyuz,\r\n      ISNULL(SUM(giren),0),ISNULL(SUM(cikan),0)\r\n      \r\n      FROM stkhrk as s inner join stokkart as k on s.stktip=k.tip\r\n      and s.stkod=k.kod and k.sil=0\r\n      inner join Depo_Kart_Listesi as d on d.kod=s.depkod\r\n      WHERE s.stktip=@STOK_TIP\r\n      AND (tarih >= @TARIH1 and tarih <= @TARIH2 )\r\n      GROUP BY k.tip,k.kod,k.ad,d.kod,D.ad,kdvyuz,k.brim\r\n\r\n\r\n  OPEN STKTAR_HRK\r\n\r\n  FETCH NEXT FROM STKTAR_HRK INTO\r\n   @HRK_STOK_TIP,@HRK_STOK_KOD,@HRK_STOK_AD,@HRK_DEPO_KOD,@HRK_DEPO_AD,@HRK_BRIM,\r\n   @HRK_KDVYUZ,@HRK_GIRENMIK,@HRK_CIKANMIK\r\n\r\n  WHILE @@FETCH_STATUS = 0\r\n  BEGIN\r\n\r\n  \r\n   IF @STOKBRIMTIP=0\r\n   SELECT  @HRK_KDVYUZ=alskdv/100,@HRK_BRMFIYKDVLI=case when alskdvtip='Dahil' then alsfiy else alsfiy*(1+(alskdv/100)) end from stokkart\r\n   where tip=@HRK_STOK_TIP and kod=@HRK_STOK_KOD\r\n\r\n   IF @STOKBRIMTIP=1\r\n   select @HRK_KDVYUZ=sat1kdv/100,@HRK_BRMFIYKDVLI=case when sat1kdvtip='Dahil' then sat1fiy else sat1fiy*(1+(sat1kdv/100)) end from stokkart\r\n   where tip=@HRK_STOK_TIP and kod=@HRK_STOK_KOD\r\n\r\n   if @STOKBRIMTIP=2\r\n   select @HRK_KDVYUZ=sat2kdv/100,@HRK_BRMFIYKDVLI=case when sat2kdvtip='Dahil' then sat2fiy else sat2fiy*(1+(sat2kdv/100))  end from stokkart\r\n   where tip=@HRK_STOK_TIP and kod=@HRK_STOK_KOD\r\n   \r\n   if @STOKBRIMTIP=3\r\n   SELECT @HRK_BRMFIYKDVLI=MALIYET FROM STOKFIFO (1,@HRK_DEPO_KOD,@HRK_STOK_TIP,@HRK_STOK_KOD,@TARIH1,@TARIH2)\r\n   \r\n   if @STOKBRIMTIP=4\r\n   SELECT @HRK_BRMFIYKDVLI=MALIYET FROM STOKFIFO (2,@HRK_DEPO_KOD,@HRK_STOK_TIP,@HRK_STOK_KOD,@TARIH1,@TARIH2)\r\n\r\n   \r\n   \r\n   IF @KDVTIP='Harıç'\r\n   set @HRK_BRMFIYKDVLI=@HRK_BRMFIYKDVLI/(1+@HRK_KDVYUZ)\r\n   \r\n   select @HRK_DEVIRMIK=DEVIRMIKTAR from @STKHRKTAR_TEMP where STOK_TIP=@HRK_STOK_TIP and STOK_KOD=@HRK_STOK_KOD\r\n   and DEPO_KOD=@HRK_DEPO_KOD\r\n   \r\n   SET @HRK_DEVIRTUT=@HRK_DEVIRMIK*@HRK_BRMFIYKDVLI\r\n   SET @HRK_GIRENTUT=@HRK_GIRENMIK*@HRK_BRMFIYKDVLI\r\n   SET @HRK_CIKANTUT=@HRK_CIKANMIK*@HRK_BRMFIYKDVLI\r\n\r\n   SET @HRK_KALANMIK=@HRK_DEVIRMIK+@HRK_GIRENMIK-@HRK_CIKANMIK\r\n   SET @HRK_KALANTUT=@HRK_KALANMIK*@HRK_BRMFIYKDVLI\r\n  \r\n  \r\n\r\n    update @STKHRKTAR_TEMP\r\n       set KDVYUZ=@HRK_KDVYUZ,BRMFIYKDVLI=@HRK_BRMFIYKDVLI,\r\n       DEVIRTUTAR=@HRK_DEVIRTUT,GIRENMIKTAR=@HRK_GIRENMIK,GIRENTUTAR=@HRK_GIRENTUT,\r\n       CIKANMIKTAR=@HRK_CIKANMIK,CIKANTUTAR=@HRK_CIKANTUT,\r\n       KALANMIKTAR=@HRK_KALANMIK,KALANTUTAR=@HRK_KALANTUT\r\n       where STOK_TIP=@HRK_STOK_TIP and STOK_KOD=@HRK_STOK_KOD\r\n       and DEPO_KOD=@HRK_DEPO_KOD\r\n       \r\n\r\n     FETCH NEXT FROM STKTAR_HRK INTO\r\n   @HRK_STOK_TIP,@HRK_STOK_KOD,@HRK_STOK_AD,@HRK_DEPO_KOD,@HRK_DEPO_AD,@HRK_BRIM,\r\n   @HRK_KDVYUZ,@HRK_GIRENMIK,@HRK_CIKANMIK\r\n  END\r\n\r\n  CLOSE STKTAR_HRK\r\n  DEALLOCATE STKTAR_HRK\r\n\r\n  /*---------------------------------------------------------------------------- */\r\n\r\n  INSERT @TB_STOKTAR_HRK\r\n    SELECT * FROM @STKHRKTAR_TEMP\r\n\r\n  RETURN\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_TANK_STOK_DRM",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_TANK_STOK_DRM",
    "definition": "CREATE FUNCTION [dbo].[UDF_TANK_STOK_DRM]\r\n(@TARIH DATETIME)\r\nRETURNS\r\n  @TB_STOK_DEPO_DRM TABLE (\r\n    ID\t\t\t\t\tINT,\r\n    FIRMA_NO\t\t\tINT,\r\n    FIRMA_UNVAN\t\t     VARCHAR(150) COLLATE Turkish_CI_AS,\r\n    TANK_KOD             VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    TANK_AD              VARCHAR(150) COLLATE Turkish_CI_AS,\r\n    GIREN                FLOAT,\r\n    CIKAN                FLOAT,\r\n    KALAN                FLOAT)\r\nAS\r\nBEGIN\r\n\r\n   insert into @TB_STOK_DEPO_DRM (ID,FIRMA_NO,TANK_KOD,TANK_AD,\r\n   GIREN,CIKAN,KALAN)\r\n   select K.id,K.firmano,k.kod,k.ad,\r\n   sum(giren),sum(cikan),sum(giren-cikan)\r\n   from tankkart as k with (nolock)\r\n   inner join stkhrk as h with (nolock) on \r\n   k.kod=h.depkod \r\n   and h.sil=0 and k.sil=0\r\n   and h.tarih<=@TARIH\r\n   group by K.id,K.firmano,k.kod,k.ad\r\n   order by K.firmano \r\n \r\n   update @TB_STOK_DEPO_DRM set FIRMA_UNVAN=DT.ad from @TB_STOK_DEPO_DRM as t\r\n   join (select id,ad from firma) dt on dt.id=t.FIRMA_NO\r\n\r\n  RETURN\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_UDF_CARIFIS_BK",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_UDF_CARIFIS_BK",
    "definition": "CREATE FUNCTION [dbo].UDF_UDF_CARIFIS_BK (@CARI_TIP VARCHAR(20),\r\n@CARI_KOD VARCHAR(20),\r\n@TARIH1 DATETIME,\r\n@TARIH2 DATETIME,\r\n@SAAT1 VARCHAR(8),\r\n@SAAT2 VARCHAR(8),\r\n@DEVIR INT)\r\nRETURNS\r\n    @TB_CARI_EKSTRE TABLE (\r\n    CARI_TIP    VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    CARI_KOD    VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    CARI_UNVAN  VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    TARIH       DATETIME,\r\n    SAAT        VARCHAR(8)  COLLATE Turkish_CI_AS,\r\n    BELGENO     VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    YKNO        VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    STOKKOD     VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    STOKAD      VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    MIKTAR      FLOAT,\r\n    BFIYAT      FLOAT,\r\n    PLAKA       VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    ACIKLAMA    VARCHAR(100) COLLATE Turkish_CI_AS,\r\n    ISLTIPAD    VARCHAR(30)  COLLATE Turkish_CI_AS,\r\n    ISLHRKAD    VARCHAR(30)  COLLATE Turkish_CI_AS,\r\n    YERAD       VARCHAR(30)  COLLATE Turkish_CI_AS,\r\n    KULAD       VARCHAR(50)  COLLATE Turkish_CI_AS,\r\n    ISLTIP      VARCHAR(10)   COLLATE Turkish_CI_AS,\r\n    ISLHRK      VARCHAR(10)   COLLATE Turkish_CI_AS,\r\n    HRKID       FLOAT,\r\n    MASID       FLOAT,\r\n    BORC        DECIMAL(18,8),\r\n    ALACAK      DECIMAL(18,8),\r\n    BAKIYE      DECIMAL(18,8))\r\nAS\r\nBEGIN\r\n  DECLARE @EKSTRE_TEMP TABLE (\r\n    CARI_TIP    VARCHAR(20)  COLLATE Turkish_CI_AS,\r\n    CARI_KOD VARCHAR(20)     COLLATE Turkish_CI_AS,\r\n    CARI_UNVAN  VARCHAR(50)  COLLATE Turkish_CI_AS,\r\n    TARIH       DATETIME,\r\n    SAAT        VARCHAR(8)   COLLATE Turkish_CI_AS,\r\n    BELGENO    VARCHAR(30)   COLLATE Turkish_CI_AS,\r\n    YKNO        VARCHAR(20)  COLLATE Turkish_CI_AS,\r\n    STOKKOD     VARCHAR(20)  COLLATE Turkish_CI_AS,\r\n    STOKAD      VARCHAR(50)  COLLATE Turkish_CI_AS,\r\n    MIKTAR      FLOAT,\r\n    BFIYAT      FLOAT,\r\n    PLAKA       VARCHAR(20)   COLLATE Turkish_CI_AS,\r\n    ACIKLAMA    VARCHAR(100)  COLLATE Turkish_CI_AS,\r\n    ISLTIPAD    VARCHAR(30)   COLLATE Turkish_CI_AS,\r\n    ISLHRKAD    VARCHAR(30)   COLLATE Turkish_CI_AS,\r\n    YERAD       VARCHAR(30)   COLLATE Turkish_CI_AS,\r\n    KULAD       VARCHAR(50)   COLLATE Turkish_CI_AS,\r\n    ISLTIP      VARCHAR(10)   COLLATE Turkish_CI_AS,\r\n    ISLHRK      VARCHAR(10)   COLLATE Turkish_CI_AS,\r\n    HRKID       FLOAT,\r\n    MASID       FLOAT,\r\n    BORC        DECIMAL(18,8),\r\n    ALACAK      DECIMAL(18,8),\r\n    BAKIYE      DECIMAL(18,8))\r\n\r\n  DECLARE @HRK_CARI_TIP    VARCHAR(20)\r\n  DECLARE @HRK_CARI_KOD    VARCHAR(20)\r\n  DECLARE @HRK_CARI_UNVAN  VARCHAR(50)\r\n  DECLARE @HRK_TARIH       DATETIME\r\n  DECLARE @HRK_SAAT        VARCHAR(8)\r\n  DECLARE @HRK_BELGENO     VARCHAR(30)\r\n  DECLARE @HRK_YKNO        VARCHAR(20)\r\n  DECLARE @HRK_STOKKOD     VARCHAR(20)\r\n  DECLARE @HRK_STOKAD      VARCHAR(50)\r\n  DECLARE @HRK_MIKTAR      FLOAT\r\n  DECLARE @HRK_BFIYAT      FLOAT\r\n  DECLARE @HRK_PLAKA       VARCHAR(20)\r\n  DECLARE @HRK_ACIKLAMA    VARCHAR(100)\r\n  DECLARE @HRK_ISLTIPAD    VARCHAR(30)\r\n  DECLARE @HRK_ISLHRKAD    VARCHAR(30)\r\n  DECLARE @HRK_YERAD       VARCHAR(30)\r\n  DECLARE @HRK_KULAD       VARCHAR(50)\r\n  DECLARE @HRK_ISLTIP      VARCHAR(10)\r\n  DECLARE @HRK_ISLHRK      VARCHAR(10)\r\n  DECLARE @HRK_HRKID       FLOAT\r\n  DECLARE @HRK_MASID       FLOAT\r\n  DECLARE @HRK_BORC        DECIMAL(18,8)\r\n  DECLARE @HRK_ALACAK      DECIMAL(18,8)\r\n  DECLARE @HRK_BAKIYE      DECIMAL(18,8)\r\n  DECLARE @KUM_BAKIYE      DECIMAL(18,8)\r\n\r\n  SET @KUM_BAKIYE = 0\r\n\r\nselect @HRK_CARI_UNVAN=ck.ad from Genel_Kart as ck\r\nwhere kod=@CARI_KOD and ck.cartp=@CARI_TIP\r\n\r\n  /* Devir atanıyor */\r\n  IF @DEVIR=1\r\n   BEGIN\r\n  INSERT @EKSTRE_TEMP\r\n    SELECT\r\n      '',/*CARI TIP */\r\n      @CARI_KOD, /* CARI_KOD */\r\n      @HRK_CARI_UNVAN, /* CARI_UNVAN */\r\n      @TARIH1,\r\n      @SAAT1,\r\n      'DEVİR', /* BELGE NO */\r\n      '',/*YKNO */\r\n      '',/*STOKKOD */\r\n      '',/*STOKAD */\r\n      0,/*MİKTAR */\r\n      0,/*BFIYAT */\r\n      '', /*PLAKA */\r\n      CONVERT(VARCHAR(10), @TARIH1, 104) +' DEVİR BAKİYESİ', /* AÇIKLAMA */\r\n      '-','-','-','-','-','-',0,0,\r\n      ISNULL(SUM(CASE WHEN borc>0 THEN borc ELSE 0 END),0), /* BORC */\r\n      ISNULL(SUM(CASE WHEN alacak>0 THEN alacak ELSE 0 END),0), /* ALACAK */\r\n      ISNULL(SUM((borc-alacak)),0) \r\n     FROM carihrk\r\n     WHERE cartip=@CARI_TIP and carkod=@CARI_KOD\r\n     and islmhrk not in ('CAK','FATVERSAT')\r\n     and sil=0  AND (tarih < @TARIH1 OR (tarih = @TARIH1 AND saat < @SAAT1))\r\n     \r\n      SELECT @KUM_BAKIYE = BAKIYE FROM @EKSTRE_TEMP\r\n  \r\n     \r\n  /* veresiye hareketlerinden gelen bakiye alınıyor */\r\n  SELECT\r\n    @HRK_BORC   = ISNULL(SUM(case when fistip='FISVERSAT' THEN toptut else 0 end ),0),\r\n    @HRK_ALACAK = ISNULL(SUM(case when fistip='FISALCSAT' THEN toptut else 0 end),0),\r\n    @HRK_BAKIYE = ISNULL(SUM(case when fistip='FISVERSAT' then toptut else -toptut end  ),0)\r\n  FROM veresimas\r\n  WHERE cartip=@CARI_TIP and carkod=@CARI_KOD \r\n  and sil=0  AND (tarih < @TARIH1 OR (tarih = @TARIH1 AND saat < @SAAT1))\r\n\r\n  /* Faturalardan gelen bakiye hareketlerden gelen bakiyeye ekleniyor */\r\n  UPDATE @EKSTRE_TEMP SET\r\n    BORC    = BORC    + @HRK_BORC,\r\n    ALACAK  = ALACAK  + @HRK_ALACAK,\r\n    BAKIYE  = BAKIYE  + @HRK_BAKIYE\r\n\r\n  /* Kümülatif bakiye için kullanılacak değişkene devir bakiyesi atanıyor. */\r\n   SELECT @KUM_BAKIYE = BAKIYE FROM @EKSTRE_TEMP\r\n  END\r\n\r\n  /* Hareketler işleniyor */\r\n  /*---------------------------------------------------------------------------- */\r\n\r\n  DECLARE CRS_HRK CURSOR FAST_FORWARD FOR\r\n    /* Cari Fişlerden gelen harektler */\r\n    SELECT\r\n      @CARI_TIP,@CARI_KOD,@HRK_CARI_UNVAN,\r\n       tarih,saat,belno,\r\n       '',/*YKNO */\r\n       '',/*STOKKOD */\r\n       '',/*STOKAD */\r\n       0,/*MİKTAR */\r\n       0,/*BFIYAT */\r\n       '', /*PLAKA */\r\n      ack, /* AÇIKLAMA, */\r\n      islmtipad,islmhrkad,yerad,olususer,islmtip,islmhrk,carhrkid,masterid,\r\n      borc,\r\n      alacak,\r\n      borc-alacak AS BAKIYE\r\n    FROM carihrk\r\n    WHERE cartip=@CARI_TIP and carkod=@CARI_KOD\r\n     and islmhrk not in ('CAK','FATVERSAT')\r\n     and sil=0 AND (tarih > @TARIH1 OR (tarih = @TARIH1 AND saat > @SAAT1))\r\n     AND (tarih < @TARIH2 OR (tarih = @TARIH2 AND saat < @SAAT2))\r\n     UNION\r\n    /* veresiye Hareketleri */\r\n     SELECT\r\n      @CARI_TIP,@CARI_KOD,@HRK_CARI_UNVAN,\r\n       tarih,saat,\r\n       seri+cast([no] as varchar),\r\n       veresimas.ykno,/*YKNO */\r\n       stkod,\r\n       stokkart.ad,\r\n       mik,\r\n       brmfiy,/*BFIYAT */\r\n       plaka, /*PLAKA */\r\n       ack, /* AÇIKLAMA, */\r\n       fisad,fisad,yerad,veresihrk.olususer,'-',fistip,0,0,\r\n       CASE WHEN fistip='FISVERSAT' THEN  brmfiy*mik else 0 end,\r\n       CASE WHEN fistip='FISALCSAT' THEN brmfiy*mik else 0 end,\r\n       CASE WHEN fistip='FISALCSAT' THEN  -1*brmfiy*mik else brmfiy*mik end AS BAKIYE\r\n    FROM veresihrk inner join veresimas on veresihrk.verid=veresimas.verid\r\n    and veresimas.sil=0 and veresihrk.sil=0 inner join stokkart on stokkart.kod=veresihrk.stkod\r\n    and stokkart.tip=veresihrk.stktip\r\n     where cartip=@CARI_TIP and carkod=@CARI_KOD /*and aktip='BK' */\r\n     AND (tarih > @TARIH1 OR (tarih = @TARIH1 AND saat > @SAAT1))\r\n     AND (tarih < @TARIH2 OR (tarih = @TARIH2 AND saat < @SAAT2))\r\n\r\n    ORDER BY tarih\r\n\r\n  OPEN CRS_HRK\r\n\r\n  FETCH NEXT FROM CRS_HRK INTO\r\n   @HRK_CARI_TIP,@HRK_CARI_KOD,@HRK_CARI_UNVAN,@HRK_TARIH,@HRK_SAAT,@HRK_BELGENO,@HRK_YKNO,@HRK_STOKKOD,\r\n   @HRK_STOKAD,@HRK_MIKTAR,@HRK_BFIYAT,@HRK_PLAKA,@HRK_ACIKLAMA,\r\n   @HRK_ISLTIPAD,@HRK_ISLHRKAD,@HRK_YERAD,@HRK_KULAD,@HRK_ISLTIP,@HRK_ISLHRK,@HRK_HRKID,@HRK_MASID,@HRK_BORC, @HRK_ALACAK, @HRK_BAKIYE\r\n\r\n  WHILE @@FETCH_STATUS = 0\r\n  BEGIN\r\n    SET @KUM_BAKIYE = @KUM_BAKIYE + @HRK_BAKIYE\r\n\r\n    INSERT @EKSTRE_TEMP\r\n      SELECT\r\n       @HRK_CARI_TIP,@HRK_CARI_KOD,@HRK_CARI_UNVAN,@HRK_TARIH,@HRK_SAAT,@HRK_BELGENO,@HRK_YKNO,@HRK_STOKKOD,\r\n   @HRK_STOKAD,@HRK_MIKTAR,@HRK_BFIYAT,@HRK_PLAKA,@HRK_ACIKLAMA,\r\n       @HRK_ISLTIPAD,@HRK_ISLHRKAD,@HRK_YERAD,@HRK_KULAD,@HRK_ISLTIP,@HRK_ISLHRK,@HRK_HRKID,@HRK_MASID,@HRK_BORC, @HRK_ALACAK, @KUM_BAKIYE\r\n\r\n    FETCH NEXT FROM CRS_HRK INTO\r\n      @HRK_CARI_TIP,@HRK_CARI_KOD, @HRK_CARI_UNVAN,@HRK_TARIH,@HRK_SAAT,@HRK_BELGENO,@HRK_YKNO,@HRK_STOKKOD,\r\n   @HRK_STOKAD,@HRK_MIKTAR,@HRK_BFIYAT,@HRK_PLAKA,@HRK_ACIKLAMA,\r\n      @HRK_ISLTIPAD,@HRK_ISLHRKAD,@HRK_YERAD,@HRK_KULAD,@HRK_ISLTIP,@HRK_ISLHRK,@HRK_HRKID,@HRK_MASID,@HRK_BORC, @HRK_ALACAK, @HRK_BAKIYE\r\n  END\r\n\r\n  CLOSE CRS_HRK\r\n  DEALLOCATE CRS_HRK\r\n\r\n  /*---------------------------------------------------------------------------- */\r\n\r\n  INSERT @TB_CARI_EKSTRE\r\n    SELECT CARI_TIP,CARI_KOD,CARI_UNVAN,TARIH,SAAT,BELGENO,YKNO,STOKKOD,\r\n   STOKAD,MIKTAR,BFIYAT,PLAKA,ACIKLAMA,ISLTIPAD,ISLHRKAD,YERAD,KULAD,ISLTIP,ISLHRK,\r\n   HRKID,MASID,BORC,ALACAK,BAKIYE FROM @EKSTRE_TEMP\r\n\r\n  RETURN\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_VADESIGENELLER",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_VADESIGENELLER",
    "definition": "CREATE FUNCTION [dbo].UDF_VADESIGENELLER (\r\n@firmano      \tint,\r\n@CEKIN \t\t\tVARCHAR(100),\r\n@SLIP \t\t\tINT,\r\n@SLIPBNK \t\tINT,\r\n@ISTKART \t\tINT,\r\n@ALSFATIN \t\tVARCHAR(100),\r\n@SATFATIN \t\tVARCHAR(100),\r\n@FISIN \t\t\tVARCHAR(8000),\r\n@VADKRD\t\t\tINT,\r\n@TARIH1\t\t\tDATETIME,\r\n@TARIH2 \t\tDATETIME)\r\nRETURNS\r\n  @TB_VADGEL_EKSTRE TABLE (\r\n    FIRMANO   \t\tINT,\r\n    FIRMAAD  \t\tVARCHAR(100)  COLLATE Turkish_CI_AS,\r\n    ISLEMTURAD  \tVARCHAR(50)  COLLATE Turkish_CI_AS,\r\n    ISLEMHRKAD  \tVARCHAR(50)  COLLATE Turkish_CI_AS,\r\n    CARI_TIP    \tVARCHAR(30)  COLLATE Turkish_CI_AS,\r\n    CARI_TUR    \tVARCHAR(50)  COLLATE Turkish_CI_AS,\r\n    CARI_KOD    \tVARCHAR(30)  COLLATE Turkish_CI_AS,\r\n    CARI_UNVAN  \tVARCHAR(150)  COLLATE Turkish_CI_AS,\r\n    BELGENO     \tVARCHAR(30)  COLLATE Turkish_CI_AS,\r\n    REFNO       \tVARCHAR(20)  COLLATE Turkish_CI_AS,\r\n    ACIKLAMA    \tVARCHAR(200) COLLATE Turkish_CI_AS,\r\n    BANKAAD     \tVARCHAR(150)  COLLATE Turkish_CI_AS,\r\n    GIREN           FLOAT,\r\n    CIKAN           FLOAT,\r\n    VADETARIHI      DATETIME,\r\n    ISLEMTARIHI     DATETIME,\r\n    PARABRM         VARCHAR(10)  COLLATE Turkish_CI_AS,\r\n    GCTIP           INT,\r\n    MAS_ID\t\t\tINT,\r\n    TABLE_AD\t\tVARCHAR(50)  COLLATE Turkish_CI_AS,\r\n    NOT_ACK         VARCHAR(500)  COLLATE Turkish_CI_AS)\r\nAS\r\nBEGIN\r\n  DECLARE @EKSTRE_VTEMP TABLE (\r\n    FIRMANO   \t\tINT,\r\n    FIRMAAD  \t\tVARCHAR(100)  COLLATE Turkish_CI_AS,\r\n    ISLEMTURAD  VARCHAR(30)  COLLATE Turkish_CI_AS,\r\n    ISLEMHRKAD  VARCHAR(50)   COLLATE Turkish_CI_AS,\r\n    CARI_TIP    VARCHAR(30)   COLLATE Turkish_CI_AS,\r\n    CARI_TUR    VARCHAR(50)   COLLATE Turkish_CI_AS,\r\n    CARI_KOD    VARCHAR(30)   COLLATE Turkish_CI_AS,\r\n    CARI_UNVAN  VARCHAR(150)   COLLATE Turkish_CI_AS,\r\n    BELGENO     VARCHAR(30)   COLLATE Turkish_CI_AS,\r\n    REFNO       VARCHAR(20)   COLLATE Turkish_CI_AS,\r\n    ACIKLAMA    VARCHAR(200)  COLLATE Turkish_CI_AS,\r\n    BANKAAD     VARCHAR(150)   COLLATE Turkish_CI_AS,\r\n    DRM         VARCHAR(10)   COLLATE Turkish_CI_AS,\r\n    GIREN           FLOAT,\r\n    CIKAN           FLOAT,\r\n    VADETARIHI      DATETIME,\r\n    ISLEMTARIHI     DATETIME,\r\n    PARABRM         VARCHAR(10)   COLLATE Turkish_CI_AS,\r\n    GCTIP           INT,\r\n    MAS_ID\t\t\tINT,\r\n    TABLE_AD\t\tVARCHAR(50)  COLLATE Turkish_CI_AS )\r\n\r\n  DECLARE @HRK_FIRMANO     INT\r\n  DECLARE @HRK_FIRMAAD     VARCHAR(100)\r\n  DECLARE @HRK_CARI_TIP    VARCHAR(30)\r\n  DECLARE @HRK_CARI_TUR    VARCHAR(50)\r\n  DECLARE @HRK_CARI_KOD    VARCHAR(30)\r\n  DECLARE @HRK_CARI_UNVAN  VARCHAR(150)\r\n  DECLARE @HRK_ISLEMHRKAD  VARCHAR(50)\r\n  DECLARE @HRK_ISLEMTURAD  VARCHAR(50)\r\n  DECLARE @HRK_BELGENO     VARCHAR(50)\r\n  DECLARE @HRK_REFNO       VARCHAR(50)\r\n  DECLARE @HRK_ACIKLAMA    VARCHAR(200)\r\n  DECLARE @HRK_BANKAAD     VARCHAR(150)\r\n  DECLARE @HRK_DRM         VARCHAR(10)\r\n  DECLARE @HRK_PARABRM     VARCHAR(10)\r\n  DECLARE @HRK_TABLE_AD    VARCHAR(50) \r\n \r\n  DECLARE @HRK_GCTIP      \tINT\r\n  \r\n  DECLARE @HRK_GIREN           FLOAT\r\n  DECLARE @HRK_CIKAN           FLOAT\r\n  DECLARE @HRK_VADETARIHI      DATETIME\r\n  DECLARE @HRK_ISLEMTARIHI     DATETIME\r\n  DECLARE @HRK_MAS_ID          INT\r\n\r\n/*---CEKLER KONTROL EDİLİYOR */\r\n     DECLARE CRS_CEK_HRK CURSOR FAST_FORWARD FOR\r\n     SELECT\r\n      c.firmano,C.cekid,'cekkart',\r\n      case WHEN gctip='G' then C.cartip else C.vercartip end,\r\n      case WHEN gctip='G' then C.carkod else C.vercarkod end,\r\n      C.islmhrkad,c.drmad,\r\n      c.ceksenno,c.refno,c.ack,case when drm='TAK' THEN\r\n      (SELECT bk.ad from bankakart as bk where C.vercarkod=bk.kod)\r\n      ELSE c.banka end,C.drm,c.giren,c.cikan,c.vadetar,c.tarih,C.parabrm\r\n      from cekkart as c\r\n      where c.sil=0 and c.drm in (SELECT * FROM dbo.CsvToSTR (@CEKIN))\r\n      AND vadetar <= @TARIH2 and (c.sonuc=0 or c.sonuc is null )\r\n      /*vadetar >= @TARIH1 and */\r\n  OPEN CRS_CEK_HRK\r\n  FETCH NEXT FROM CRS_CEK_HRK INTO\r\n   @HRK_FIRMANO,@HRK_MAS_ID,@HRK_TABLE_AD,\r\n   @HRK_CARI_TIP,@HRK_CARI_KOD,@HRK_ISLEMTURAD,@HRK_ISLEMHRKAD,@HRK_BELGENO,\r\n   @HRK_REFNO,@HRK_ACIKLAMA,@HRK_BANKAAD,@HRK_DRM,@HRK_GIREN,@HRK_CIKAN,@HRK_VADETARIHI,\r\n   @HRK_ISLEMTARIHI,@HRK_PARABRM\r\n\r\n  WHILE @@FETCH_STATUS = 0\r\n  BEGIN\r\n  \r\n   if @HRK_DRM='CIR'\r\n   SET @HRK_GIREN=@HRK_CIKAN\r\n   \r\n   IF @HRK_GIREN>0\r\n   SET @HRK_GCTIP=1\r\n   \r\n   IF @HRK_CIKAN>0\r\n   SET @HRK_GCTIP=-1\r\n\r\n   IF @HRK_GIREN=@HRK_CIKAN\r\n   SET @HRK_GCTIP=0\r\n\r\n    set @HRK_CARI_UNVAN=''\r\n  \r\n   select @HRK_CARI_TUR=C.tip,\r\n   @HRK_CARI_UNVAN=isnull(c.ad,'') from  Genel_kart as c where c.cartp=@HRK_CARI_TIP\r\n   and c.kod=@HRK_CARI_KOD\r\n    INSERT @EKSTRE_VTEMP (FIRMANO,MAS_ID,TABLE_AD,ISLEMTURAD,ISLEMHRKAD,CARI_TIP,CARI_TUR,CARI_KOD,CARI_UNVAN,BELGENO,\r\n    REFNO,ACIKLAMA,BANKAAD,GIREN,CIKAN,VADETARIHI,ISLEMTARIHI,PARABRM)\r\n      SELECT @HRK_FIRMANO,@HRK_MAS_ID,@HRK_TABLE_AD,\r\n       @HRK_ISLEMTURAD,@HRK_ISLEMHRKAD,\r\n       @HRK_CARI_TIP,@HRK_CARI_TUR,@HRK_CARI_KOD,@HRK_CARI_UNVAN,@HRK_BELGENO,@HRK_REFNO,\r\n       @HRK_ACIKLAMA,@HRK_BANKAAD,@HRK_GIREN,@HRK_CIKAN,@HRK_VADETARIHI,@HRK_ISLEMTARIHI,\r\n       @HRK_PARABRM\r\n       \r\n    FETCH NEXT FROM CRS_CEK_HRK INTO\r\n    @HRK_FIRMANO,@HRK_MAS_ID,@HRK_TABLE_AD,\r\n    @HRK_CARI_TIP,@HRK_CARI_KOD,@HRK_ISLEMTURAD,@HRK_ISLEMHRKAD,@HRK_BELGENO,\r\n   @HRK_REFNO,@HRK_ACIKLAMA,@HRK_BANKAAD,@HRK_DRM,@HRK_GIREN,@HRK_CIKAN,@HRK_VADETARIHI,\r\n   @HRK_ISLEMTARIHI,@HRK_PARABRM\r\n  END\r\n\r\n  CLOSE CRS_CEK_HRK\r\n  DEALLOCATE CRS_CEK_HRK\r\n  \r\n/*slipler */\r\n   IF (@SLIP=1) and (@SLIPBNK=0)\r\n   BEGIN\r\n     DECLARE CRS_HRK CURSOR FAST_FORWARD FOR\r\n     SELECT\r\n      c.firmano,c.poshrkid,'poshrk',\r\n      C.cartip,c.carkod,C.islmtipad,c.islmhrkad,\r\n      c.belno,c.ack,bk.ad,\r\n      c.giren,c.cikan,c.vadetar,c.tarih,C.parabrm\r\n      from poshrk as c\r\n      inner join bankakart bk on bk.kod=c.bankod\r\n      where c.sil=0  and c.aktip in ('BK','BL')\r\n      AND c.vadetar >= @TARIH1 and c.vadetar <= @TARIH2\r\n   END\r\n\r\n IF (@SLIPBNK=1)\r\n    BEGIN\r\n     DECLARE CRS_HRK CURSOR FAST_FORWARD FOR\r\n     SELECT\r\n      c.firmano,0,'poshrk',\r\n      '-','-',C.islmtipad,c.islmhrkad,\r\n      '-' as belno,'-' as ack,bk.ad,\r\n      SUM(c.giren),SUM(c.cikan),c.vadetar,c.tarih,C.parabrm\r\n      from poshrk as c\r\n      inner join bankakart bk on bk.kod=c.bankod\r\n      where c.sil=0 and c.aktip in ('BK','BL')\r\n      AND c.vadetar >= @TARIH1 and c.vadetar <= @TARIH2\r\n      group by c.firmano,\r\n      C.islmtipad,c.islmhrkad,bk.ad,c.vadetar,c.tarih,C.parabrm\r\n   END\r\n   \r\n   \r\n    if (@SLIP=1) or (@SLIPBNK=1)\r\n    begin\r\n\r\n     OPEN CRS_HRK\r\n    \r\n    FETCH NEXT FROM CRS_HRK INTO\r\n    @HRK_FIRMANO,@HRK_MAS_ID,@HRK_TABLE_AD,\r\n    @HRK_CARI_TIP,@HRK_CARI_KOD,@HRK_ISLEMTURAD,@HRK_ISLEMHRKAD,@HRK_BELGENO,\r\n    @HRK_ACIKLAMA,@HRK_BANKAAD,@HRK_GIREN,@HRK_CIKAN,@HRK_VADETARIHI,\r\n    @HRK_ISLEMTARIHI,@HRK_PARABRM\r\n\r\n  WHILE @@FETCH_STATUS = 0\r\n  BEGIN\r\n  set @HRK_REFNO=''\r\n  \r\n   IF @HRK_GIREN>0\r\n   SET @HRK_GCTIP=1\r\n\r\n   IF @HRK_CIKAN>0\r\n   SET @HRK_GCTIP=-1\r\n\r\n   IF @HRK_GIREN=@HRK_CIKAN\r\n   SET @HRK_GCTIP=0\r\n  \r\n  \r\n   Set @HRK_CARI_UNVAN=''\r\n  \r\n   IF @SLIPBNK=0\r\n   begin\r\n    select @HRK_CARI_TUR=C.tip,\r\n   @HRK_CARI_UNVAN=isnull(c.ad,'') from  Genel_kart as c where c.cartp=@HRK_CARI_TIP\r\n   and c.kod=@HRK_CARI_KOD\r\n   end\r\n   \r\n   \r\n    INSERT @EKSTRE_VTEMP (FIRMANO,MAS_ID,TABLE_AD,ISLEMTURAD,ISLEMHRKAD,CARI_TIP,CARI_TUR,CARI_KOD,CARI_UNVAN,BELGENO,\r\n    REFNO,ACIKLAMA,BANKAAD,GIREN,CIKAN,VADETARIHI,ISLEMTARIHI,PARABRM)\r\n      SELECT @HRK_FIRMANO,@HRK_MAS_ID,@HRK_TABLE_AD,\r\n      @HRK_ISLEMTURAD,@HRK_ISLEMHRKAD,\r\n       @HRK_CARI_TIP,@HRK_CARI_TUR,@HRK_CARI_KOD,@HRK_CARI_UNVAN,@HRK_BELGENO,@HRK_REFNO,\r\n       @HRK_ACIKLAMA,@HRK_BANKAAD,@HRK_GIREN,@HRK_CIKAN,@HRK_VADETARIHI,@HRK_ISLEMTARIHI,\r\n       @HRK_PARABRM\r\n\r\n    FETCH NEXT FROM CRS_HRK INTO\r\n    @HRK_FIRMANO,@HRK_MAS_ID,@HRK_TABLE_AD,\r\n    @HRK_CARI_TIP,@HRK_CARI_KOD,@HRK_ISLEMTURAD,@HRK_ISLEMHRKAD,@HRK_BELGENO,\r\n   @HRK_ACIKLAMA,@HRK_BANKAAD,@HRK_GIREN,@HRK_CIKAN,@HRK_VADETARIHI,\r\n   @HRK_ISLEMTARIHI,@HRK_PARABRM\r\n   END\r\n\r\n   CLOSE CRS_HRK\r\n   DEALLOCATE CRS_HRK\r\n  end\r\n\r\n  \r\n/*---isletme krdi kartları */\r\nif @ISTKART=1\r\n begin\r\n   DECLARE CRS_HRK CURSOR FAST_FORWARD FOR\r\n     SELECT\r\n      c.firmano,c.istkhrkid,'istkhrk',\r\n      C.cartip,c.carkod,'İŞLETME K.KART',C.islmhrkad,\r\n      c.belno,c.ack,bk.ad,\r\n      c.borc,c.alacak,\r\n      c.vadetar,c.tarih,C.parabrm\r\n      from istkhrk as c\r\n      inner join istkart bk on bk.kod=c.istkkod\r\n      where c.sil=0 \r\n      AND vadetar >= @TARIH1 and vadetar <= @TARIH2\r\n     OPEN CRS_HRK\r\n    FETCH NEXT FROM CRS_HRK INTO\r\n   @HRK_FIRMANO,@HRK_MAS_ID,@HRK_TABLE_AD,\r\n   @HRK_CARI_TIP,@HRK_CARI_KOD,@HRK_ISLEMTURAD,@HRK_ISLEMHRKAD,@HRK_BELGENO,\r\n   @HRK_ACIKLAMA,@HRK_BANKAAD,@HRK_GIREN,@HRK_CIKAN,@HRK_VADETARIHI,\r\n   @HRK_ISLEMTARIHI,@HRK_PARABRM\r\n\r\n  WHILE @@FETCH_STATUS = 0\r\n  BEGIN\r\n\r\n   set @HRK_REFNO=''\r\n\r\n   IF @HRK_GIREN>0\r\n   SET @HRK_GCTIP=1\r\n\r\n   IF @HRK_CIKAN>0\r\n   SET @HRK_GCTIP=-1\r\n\r\n   IF @HRK_GIREN=@HRK_CIKAN\r\n   SET @HRK_GCTIP=0\r\n\r\n\r\n  set @HRK_CARI_UNVAN=''\r\n   \r\n    select @HRK_CARI_TUR=C.tip,\r\n   @HRK_CARI_UNVAN=isnull(c.ad,'') from  Genel_kart as c where \r\n   c.cartp=@HRK_CARI_TIP\r\n   and c.kod=@HRK_CARI_KOD\r\n    INSERT @EKSTRE_VTEMP (FIRMANO,MAS_ID,TABLE_AD,\r\n    ISLEMTURAD,ISLEMHRKAD,CARI_TIP,CARI_TUR,CARI_KOD,CARI_UNVAN,BELGENO,\r\n    REFNO,ACIKLAMA,BANKAAD,GIREN,CIKAN,VADETARIHI,ISLEMTARIHI,PARABRM)\r\n      SELECT @HRK_FIRMANO,@HRK_MAS_ID,@HRK_TABLE_AD,\r\n      @HRK_ISLEMTURAD,@HRK_ISLEMHRKAD,\r\n       @HRK_CARI_TIP,@HRK_CARI_TUR,@HRK_CARI_KOD,@HRK_CARI_UNVAN,@HRK_BELGENO,@HRK_REFNO,\r\n       @HRK_ACIKLAMA,@HRK_BANKAAD,@HRK_GIREN,@HRK_CIKAN,@HRK_VADETARIHI,@HRK_ISLEMTARIHI,\r\n       @HRK_PARABRM\r\n\r\n    FETCH NEXT FROM CRS_HRK INTO\r\n    @HRK_FIRMANO,@HRK_MAS_ID,@HRK_TABLE_AD,\r\n    @HRK_CARI_TIP,@HRK_CARI_KOD,@HRK_ISLEMTURAD,\r\n    @HRK_ISLEMHRKAD,@HRK_BELGENO,\r\n   @HRK_ACIKLAMA,@HRK_BANKAAD,@HRK_GIREN,@HRK_CIKAN,@HRK_VADETARIHI,\r\n   @HRK_ISLEMTARIHI,@HRK_PARABRM\r\n  END\r\n\r\n  CLOSE CRS_HRK\r\n  DEALLOCATE CRS_HRK\r\n end\r\n  \r\n /*vadeli kredi taksit */\r\n if @VADKRD=1\r\n begin\r\n   DECLARE CRS_HRK CURSOR FAST_FORWARD FOR\r\n     SELECT\r\n      bk.firmano,t.id,'taksit_hrk',\r\n      'bankakart',bk.bankod,'BANKA KARTLARI',\r\n      'VADELİ KREDİ TAKSİT',bk.belno,bk.ack,\r\n      0,t.tutar,\r\n      t.tarih,t.tarih,t.parabrm\r\n      from bankahrk as bk\r\n      inner join taksit_hrk t on bk.bankhrkid=t.mas_id\r\n      where bk.sil=0 and t.sil=0\r\n      and bk.islmtip='KRD' and bk.islmhrk='VKC'\r\n      AND t.tarih >= @TARIH1 and t.tarih <= @TARIH2\r\n     OPEN CRS_HRK\r\n    FETCH NEXT FROM CRS_HRK INTO\r\n   @HRK_FIRMANO,@HRK_MAS_ID,@HRK_TABLE_AD,\r\n   @HRK_CARI_TIP,@HRK_CARI_KOD,@HRK_ISLEMTURAD,@HRK_ISLEMHRKAD,@HRK_BELGENO,\r\n   @HRK_ACIKLAMA,@HRK_GIREN,@HRK_CIKAN,@HRK_VADETARIHI,\r\n   @HRK_ISLEMTARIHI,@HRK_PARABRM\r\n\r\n  WHILE @@FETCH_STATUS = 0\r\n  BEGIN\r\n\r\n   set @HRK_REFNO=''\r\n\r\n   IF @HRK_GIREN>0\r\n   SET @HRK_GCTIP=1\r\n\r\n   IF @HRK_CIKAN>0\r\n   SET @HRK_GCTIP=-1\r\n\r\n   IF @HRK_GIREN=@HRK_CIKAN\r\n   SET @HRK_GCTIP=0\r\n\r\n\r\n  set @HRK_CARI_UNVAN=''\r\n   \r\n   select @HRK_CARI_TUR=C.tip,\r\n   @HRK_CARI_UNVAN=isnull(c.ad,'') from  Genel_kart as c where \r\n   c.cartp=@HRK_CARI_TIP\r\n   and c.kod=@HRK_CARI_KOD\r\n    \r\n    INSERT @EKSTRE_VTEMP (FIRMANO,MAS_ID,TABLE_AD,\r\n    ISLEMTURAD,ISLEMHRKAD,CARI_TIP,CARI_TUR,CARI_KOD,CARI_UNVAN,BELGENO,\r\n    REFNO,ACIKLAMA,BANKAAD,GIREN,CIKAN,VADETARIHI,ISLEMTARIHI,PARABRM)\r\n     \r\n     SELECT @HRK_FIRMANO,@HRK_MAS_ID,@HRK_TABLE_AD,\r\n      @HRK_ISLEMTURAD,@HRK_ISLEMHRKAD,\r\n       @HRK_CARI_TIP,@HRK_CARI_TUR,@HRK_CARI_KOD,@HRK_CARI_UNVAN,@HRK_BELGENO,@HRK_REFNO,\r\n       @HRK_ACIKLAMA,@HRK_BANKAAD,@HRK_GIREN,@HRK_CIKAN,@HRK_VADETARIHI,@HRK_ISLEMTARIHI,\r\n       @HRK_PARABRM\r\n\r\n    FETCH NEXT FROM CRS_HRK INTO\r\n    @HRK_FIRMANO,@HRK_MAS_ID,@HRK_TABLE_AD,\r\n    @HRK_CARI_TIP,@HRK_CARI_KOD,@HRK_ISLEMTURAD,@HRK_ISLEMHRKAD,@HRK_BELGENO,\r\n   @HRK_ACIKLAMA,@HRK_GIREN,@HRK_CIKAN,@HRK_VADETARIHI,\r\n   @HRK_ISLEMTARIHI,@HRK_PARABRM\r\n  END\r\n\r\n  CLOSE CRS_HRK\r\n  DEALLOCATE CRS_HRK\r\n end\r\n  \r\n  \r\n  \r\n  \r\n\r\n/*alış faturası */\r\n     DECLARE CRS_HRK CURSOR FAST_FORWARD FOR\r\n     SELECT\r\n      c.firmano,c.fatid,'faturamas',\r\n      C.cartip,c.carkod,'FATURA',C.fatad,\r\n      c.fatseri+cast(c.fatno as varchar),c.ack,'',\r\n      0,((fattop-(satisktop+genisktop))+(kdvtop+giderkdvtop+gidertop+yuvtop)),\r\n      c.vadtar,c.tarih,C.parabrm\r\n      from faturamas as c\r\n      where c.sil=0 and c.fattur_id=1 and c.fattip in (SELECT * FROM dbo.CsvToSTR (@ALSFATIN))\r\n      AND vadtar >= @TARIH1 and vadtar <= @TARIH2 and (c.odeme=0 or c.odeme is null )\r\n     OPEN CRS_HRK\r\n    FETCH NEXT FROM CRS_HRK INTO\r\n   @HRK_FIRMANO,@HRK_MAS_ID,@HRK_TABLE_AD,\r\n   @HRK_CARI_TIP,@HRK_CARI_KOD,@HRK_ISLEMTURAD,@HRK_ISLEMHRKAD,@HRK_BELGENO,\r\n   @HRK_ACIKLAMA,@HRK_BANKAAD,@HRK_GIREN,@HRK_CIKAN,@HRK_VADETARIHI,\r\n   @HRK_ISLEMTARIHI,@HRK_PARABRM\r\n\r\n  WHILE @@FETCH_STATUS = 0\r\n  BEGIN\r\n\r\n   set @HRK_REFNO=''\r\n\r\n   IF @HRK_GIREN>0\r\n   SET @HRK_GCTIP=1\r\n\r\n   IF @HRK_CIKAN>0\r\n   SET @HRK_GCTIP=-1\r\n\r\n   IF @HRK_GIREN=@HRK_CIKAN\r\n   SET @HRK_GCTIP=0\r\n\r\n   set @HRK_CARI_UNVAN=''\r\n\r\n   select @HRK_CARI_TUR=C.tip,\r\n   @HRK_CARI_UNVAN=isnull(c.ad,'') from  Genel_kart as c where c.cartp=@HRK_CARI_TIP\r\n   and c.kod=@HRK_CARI_KOD\r\n    INSERT @EKSTRE_VTEMP (FIRMANO,MAS_ID,TABLE_AD,\r\n    ISLEMTURAD,ISLEMHRKAD,CARI_TIP,CARI_TUR,CARI_KOD,CARI_UNVAN,BELGENO,\r\n    REFNO,ACIKLAMA,BANKAAD,GIREN,CIKAN,VADETARIHI,ISLEMTARIHI,PARABRM)\r\n      SELECT @HRK_FIRMANO,@HRK_MAS_ID,@HRK_TABLE_AD,\r\n      @HRK_ISLEMTURAD,@HRK_ISLEMHRKAD,\r\n       @HRK_CARI_TIP,@HRK_CARI_TUR,@HRK_CARI_KOD,@HRK_CARI_UNVAN,@HRK_BELGENO,@HRK_REFNO,\r\n       @HRK_ACIKLAMA,@HRK_BANKAAD,@HRK_GIREN,@HRK_CIKAN,@HRK_VADETARIHI,@HRK_ISLEMTARIHI,\r\n       @HRK_PARABRM\r\n\r\n    FETCH NEXT FROM CRS_HRK INTO\r\n    @HRK_FIRMANO,@HRK_MAS_ID,@HRK_TABLE_AD,\r\n    @HRK_CARI_TIP,@HRK_CARI_KOD,@HRK_ISLEMTURAD,@HRK_ISLEMHRKAD,@HRK_BELGENO,\r\n   @HRK_ACIKLAMA,@HRK_BANKAAD,@HRK_GIREN,@HRK_CIKAN,@HRK_VADETARIHI,\r\n   @HRK_ISLEMTARIHI,@HRK_PARABRM\r\n  END\r\n\r\n  CLOSE CRS_HRK\r\n  DEALLOCATE CRS_HRK\r\n\r\n\r\n/*------------satis faturası */\r\n     DECLARE CRS_HRK CURSOR FAST_FORWARD FOR\r\n     SELECT\r\n      c.firmano,c.fatid,'faturamas',\r\n      C.cartip,c.carkod,'FATURA',C.fatad,\r\n      c.fatseri+cast(c.fatno as varchar),c.ack,'',\r\n      ((fattop-(satisktop+genisktop))+(kdvtop+giderkdvtop+gidertop+yuvtop)),0,\r\n      c.vadtar,c.tarih,C.parabrm\r\n      from faturamas as c\r\n      where c.sil=0 and c.fattur_id=2 and c.fattip in (SELECT * FROM dbo.CsvToSTR (@SATFATIN))\r\n      AND vadtar >= @TARIH1 and vadtar <= @TARIH2 and (c.odeme=0 or c.odeme is null )\r\n     OPEN CRS_HRK\r\n    FETCH NEXT FROM CRS_HRK INTO\r\n   @HRK_FIRMANO,@HRK_MAS_ID,@HRK_TABLE_AD,\r\n   @HRK_CARI_TIP,@HRK_CARI_KOD,@HRK_ISLEMTURAD,@HRK_ISLEMHRKAD,@HRK_BELGENO,\r\n   @HRK_ACIKLAMA,@HRK_BANKAAD,@HRK_GIREN,@HRK_CIKAN,@HRK_VADETARIHI,\r\n   @HRK_ISLEMTARIHI,@HRK_PARABRM\r\n\r\n  WHILE @@FETCH_STATUS = 0\r\n  BEGIN\r\n\r\n   set @HRK_REFNO=''\r\n\r\n   IF @HRK_GIREN>0\r\n   SET @HRK_GCTIP=1\r\n\r\n   IF @HRK_CIKAN>0\r\n   SET @HRK_GCTIP=-1\r\n\r\n   IF @HRK_GIREN=@HRK_CIKAN\r\n   SET @HRK_GCTIP=0\r\n\r\n    set @HRK_CARI_UNVAN=''\r\n\r\n   select @HRK_CARI_TUR=C.tip,\r\n   @HRK_CARI_UNVAN=isnull(c.ad,'') from  Genel_kart as c where c.cartp=@HRK_CARI_TIP\r\n   and c.kod=@HRK_CARI_KOD\r\n    INSERT @EKSTRE_VTEMP (FIRMANO,MAS_ID,TABLE_AD,\r\n    ISLEMTURAD,ISLEMHRKAD,CARI_TIP,CARI_TUR,CARI_KOD,CARI_UNVAN,BELGENO,\r\n    REFNO,ACIKLAMA,BANKAAD,GIREN,CIKAN,VADETARIHI,ISLEMTARIHI,PARABRM)\r\n      SELECT @HRK_FIRMANO,@HRK_MAS_ID,@HRK_TABLE_AD,\r\n      @HRK_ISLEMTURAD,@HRK_ISLEMHRKAD,\r\n       @HRK_CARI_TIP,@HRK_CARI_TUR,@HRK_CARI_KOD,@HRK_CARI_UNVAN,@HRK_BELGENO,@HRK_REFNO,\r\n       @HRK_ACIKLAMA,@HRK_BANKAAD,@HRK_GIREN,@HRK_CIKAN,@HRK_VADETARIHI,@HRK_ISLEMTARIHI,\r\n       @HRK_PARABRM\r\n\r\n    FETCH NEXT FROM CRS_HRK INTO\r\n    @HRK_FIRMANO,@HRK_MAS_ID,@HRK_TABLE_AD,\r\n    @HRK_CARI_TIP,@HRK_CARI_KOD,@HRK_ISLEMTURAD,@HRK_ISLEMHRKAD,@HRK_BELGENO,\r\n   @HRK_ACIKLAMA,@HRK_BANKAAD,@HRK_GIREN,@HRK_CIKAN,@HRK_VADETARIHI,\r\n   @HRK_ISLEMTARIHI,@HRK_PARABRM\r\n  END\r\n\r\n  CLOSE CRS_HRK\r\n  DEALLOCATE CRS_HRK\r\n  \r\n  \r\n/*----veresiye fisler */\r\n\r\n    DECLARE CRS_HRK CURSOR FAST_FORWARD FOR\r\n     SELECT\r\n      c.firmano,c.verid,'veresimas',\r\n      C.cartip,ck.tip,c.carkod,ck.ad,'FİŞ',c.fisad,\r\n      c.seri+cast(c.no as varchar),c.ack,'',\r\n      c.toptut,0,\r\n      c.vadtar,c.tarih,C.parabrm\r\n      from veresimas as c\r\n      inner join Genel_kart as ck on\r\n      ck.kod=c.carkod and c.cartip=ck.cartp\r\n      where c.sil=0 and c.fistip='FISVERSAT' AND c.aktip='BK'\r\n      and ck.id in (SELECT * FROM dbo.CsvToInt (@FISIN))\r\n      AND vadtar >= @TARIH1 and vadtar <= @TARIH2\r\n     OPEN CRS_HRK\r\n    FETCH NEXT FROM CRS_HRK INTO\r\n   @HRK_FIRMANO,@HRK_MAS_ID,@HRK_TABLE_AD,\r\n   @HRK_CARI_TIP,@HRK_CARI_TUR,@HRK_CARI_KOD,@HRK_CARI_UNVAN,@HRK_ISLEMTURAD,@HRK_ISLEMHRKAD,@HRK_BELGENO,\r\n   @HRK_ACIKLAMA,@HRK_BANKAAD,@HRK_GIREN,@HRK_CIKAN,@HRK_VADETARIHI,\r\n   @HRK_ISLEMTARIHI,@HRK_PARABRM\r\n\r\n  WHILE @@FETCH_STATUS = 0\r\n  BEGIN\r\n\r\n   set @HRK_REFNO=''\r\n\r\n   IF @HRK_GIREN>0\r\n   SET @HRK_GCTIP=1\r\n\r\n   IF @HRK_CIKAN>0\r\n   SET @HRK_GCTIP=-1\r\n\r\n   IF @HRK_GIREN=@HRK_CIKAN\r\n   SET @HRK_GCTIP=0\r\n\r\n\r\n    INSERT @EKSTRE_VTEMP (FIRMANO,MAS_ID,TABLE_AD,\r\n    ISLEMTURAD,ISLEMHRKAD,CARI_TIP,CARI_TUR,CARI_KOD,CARI_UNVAN,BELGENO,\r\n    REFNO,ACIKLAMA,BANKAAD,GIREN,CIKAN,VADETARIHI,ISLEMTARIHI,PARABRM)\r\n      SELECT @HRK_FIRMANO,@HRK_MAS_ID,@HRK_TABLE_AD,\r\n      @HRK_ISLEMTURAD,@HRK_ISLEMHRKAD,\r\n       @HRK_CARI_TIP,@HRK_CARI_TUR,@HRK_CARI_KOD,@HRK_CARI_UNVAN,@HRK_BELGENO,@HRK_REFNO,\r\n       @HRK_ACIKLAMA,@HRK_BANKAAD,@HRK_GIREN,@HRK_CIKAN,@HRK_VADETARIHI,@HRK_ISLEMTARIHI,\r\n       @HRK_PARABRM\r\n\r\n    FETCH NEXT FROM CRS_HRK INTO\r\n    @HRK_FIRMANO,@HRK_MAS_ID,@HRK_TABLE_AD,\r\n    @HRK_CARI_TIP,@HRK_CARI_TUR,@HRK_CARI_KOD,@HRK_CARI_UNVAN,@HRK_ISLEMTURAD,@HRK_ISLEMHRKAD,@HRK_BELGENO,\r\n   @HRK_ACIKLAMA,@HRK_BANKAAD,@HRK_GIREN,@HRK_CIKAN,@HRK_VADETARIHI,\r\n   @HRK_ISLEMTARIHI,@HRK_PARABRM\r\n  END\r\n\r\n  CLOSE CRS_HRK\r\n  DEALLOCATE CRS_HRK\r\n\r\n  \r\n  /*---------------------------------------------------------------------------- */\r\n    INSERT @TB_VADGEL_EKSTRE (FIRMANO,MAS_ID,TABLE_AD,\r\n    ISLEMTURAD,ISLEMHRKAD,CARI_TIP,CARI_TUR,CARI_KOD,CARI_UNVAN,BELGENO,\r\n    REFNO,ACIKLAMA,BANKAAD,GIREN,CIKAN,VADETARIHI,ISLEMTARIHI,PARABRM,GCTIP)\r\n    SELECT FIRMANO,MAS_ID,TABLE_AD,\r\n    ISLEMTURAD,ISLEMHRKAD,CARI_TIP,CARI_TUR,CARI_KOD,CARI_UNVAN,BELGENO,\r\n    REFNO,ACIKLAMA,BANKAAD,GIREN,CIKAN,VADETARIHI,ISLEMTARIHI,PARABRM,\r\n    GCTIP FROM @EKSTRE_VTEMP\r\n \r\n  \r\n    update @TB_VADGEL_EKSTRE set FIRMAAD=dt.ad from @TB_VADGEL_EKSTRE as t\r\n    join (select id,ad from firma as k ) dt\r\n    on dt.id=t.FIRMANO\r\n  \r\n    update @TB_VADGEL_EKSTRE set NOT_ACK=dt.ack from \r\n    @TB_VADGEL_EKSTRE as t join (select Table_Ad,Mas_id,\r\n    ack from evrak_Not as k ) dt\r\n    on dt.table_ad=t.table_ad and dt.mas_id=t.mas_Id\r\n  \r\n    \r\n  \r\n  \r\n  \r\n  \r\n    /*if @firmano>0 */\r\n     /*delete from @TB_VADGEL_EKSTRE where FIRMANO not in (@firmano) */\r\n  \r\n  \r\n  \r\n  \r\n  \r\n RETURN\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_VAR_ACIK_FAZLA",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_VAR_ACIK_FAZLA",
    "definition": "CREATE FUNCTION [dbo].UDF_VAR_ACIK_FAZLA (@VARNIN VARCHAR(max),@tip varchar(30))\r\nRETURNS\r\n  @TB_TAH_ODE_TOPLAM TABLE (\r\n    CARI_TIP    VARCHAR(20)  COLLATE Turkish_CI_AS,\r\n    CARI_KOD     VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    CARI_ADI     VARCHAR(150)  COLLATE Turkish_CI_AS,\r\n    CARI_GRUP    VARCHAR(100)  COLLATE Turkish_CI_AS,\r\n    GIREN         FLOAT,\r\n    CIKAN         FLOAT)\r\nAS\r\nBEGIN\r\n \r\n \r\n \r\n  if @tip='pomvardimas'\r\n  begin\r\n  INSERT @TB_TAH_ODE_TOPLAM (CARI_TIP,CARI_KOD,CARI_ADI,CARI_GRUP,GIREN,CIKAN)\r\n  select h.cartip,h.kod,ck.ad+' '+ck.soyad,gp.ad,sum(case when h.ackfaz='fazla' then tutar else 0 end),\r\n  sum(case when h.ackfaz='acik' then tutar else 0 end)\r\n  FROM  pomvardikap as h with (nolock)\r\n  inner join perkart as ck with (nolock) on ck.kod=h.kod and h.cartip='perkart'\r\n  inner join grup as gp with (nolock) on gp.id=ck.grp1\r\n  where h.varno in (select * from CsvToInt_Max(@VARNIN)) and h.varok=1\r\n  and h.sil=0\r\n  group by h.cartip,h.kod,ck.ad+' '+ck.soyad,gp.ad\r\n  end\r\n\r\n  if @tip='marvardimas'\r\n  begin\r\n  INSERT @TB_TAH_ODE_TOPLAM (CARI_TIP,CARI_KOD,CARI_ADI,CARI_GRUP,GIREN,CIKAN)\r\n  select h.cartip,h.kod,ck.ad+' '+ck.soyad,gp.ad,sum(case when h.ackfaz='fazla' then tutar else 0 end),\r\n  sum(case when h.ackfaz='acik' then tutar else 0 end)\r\n  FROM  marvardikap as h with (nolock)\r\n  inner join perkart as ck with (nolock) on ck.kod=h.kod and h.cartip='perkart'\r\n  inner join grup as gp with (nolock) on gp.id=ck.grp1\r\n  where h.varno in (select * from CsvToInt_Max(@VARNIN)) and h.sil=0\r\n  group by h.cartip,h.kod,ck.ad+' '+ck.soyad,gp.ad\r\n  end\r\n  \r\n  \r\n  \r\n   if @tip='resvardimas'\r\n  begin\r\n  INSERT @TB_TAH_ODE_TOPLAM (CARI_TIP,CARI_KOD,CARI_ADI,CARI_GRUP,GIREN,CIKAN)\r\n  select h.cartip,h.kod,ck.ad+' '+ck.soyad,gp.ad,sum(case when h.ackfaz='fazla' then tutar else 0 end),\r\n  sum(case when h.ackfaz='acik' then tutar else 0 end)\r\n  FROM  resvardikap as h with (nolock)\r\n  inner join perkart as ck with (nolock) on ck.kod=h.kod and h.cartip='perkart'\r\n  inner join grup as gp with (nolock) on gp.id=ck.grp1\r\n  where h.varno in (select * from CsvToInt_Max(@VARNIN)) and h.sil=0\r\n  group by h.cartip,h.kod,ck.ad+' '+ck.soyad,gp.ad\r\n  end\r\n\r\n\r\n\r\n\r\n  RETURN\r\n\r\nend"
  },
  {
    "schema": "dbo",
    "name": "UDF_VAR_AKARYAKIT_SATIS",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_VAR_AKARYAKIT_SATIS",
    "definition": "CREATE FUNCTION [dbo].UDF_VAR_AKARYAKIT_SATIS \r\n(@VARNIN VARCHAR(max),@tip varchar(30))\r\nRETURNS\r\n  @TB_AKARYAKIT_SATIS TABLE (\r\n    STOK_KOD           VARCHAR(20)  COLLATE Turkish_CI_AS,\r\n    STOK_AD            VARCHAR(100)  COLLATE Turkish_CI_AS,\r\n    STOK_TIP           VARCHAR(20)  COLLATE Turkish_CI_AS,\r\n    SATISMIKTAR         FLOAT,\r\n    SATISTUTAR          FLOAT,\r\n    VERSATMIKTAR        FLOAT,\r\n    VERSATTUTAR         FLOAT,\r\n    KDV                 FLOAT,\r\n    KDVTUTAR            FLOAT,\r\n    BIRIMFIYAT          FLOAT)\r\nAS\r\nBEGIN\r\n  \r\n\r\n\r\n  INSERT @TB_AKARYAKIT_SATIS (STOK_KOD,STOK_AD,STOK_TIP,\r\n  SATISMIKTAR,SATISTUTAR,\r\n  KDV,KDVTUTAR,BIRIMFIYAT,VERSATMIKTAR,VERSATTUTAR)\r\n  select st.kod,st.ad,st.tip,\r\n  sum(ps.satmik),\r\n  sum(PS.satmik*ps.brimfiy),avg(ps.kdvyuz*100),\r\n  sum(  (PS.satmik*ps.brimfiy)-  ((PS.satmik*ps.brimfiy)/(1+ps.kdvyuz))  ),\r\n  case when sum(ps.satmik)>0 then\r\n  sum(PS.satmik*ps.brimfiy)/sum(ps.satmik) else 0 end,\r\n  0,0\r\n  FROM  pomvardistok as ps with (nolock)\r\n  inner join stokkart as st with (nolock) on st.kod=ps.kod and ps.stktip=st.tip\r\n  where ps.varno in (select * from CsvToInt_Max(@VARNIN)) and ps.sil=0\r\n  group by st.kod,st.ad,st.tip order by st.ad\r\n  \r\n  \r\n  update @TB_AKARYAKIT_SATIS set VERSATMIKTAR=isnull(dt.VERSATMIKTAR,0),\r\n  VERSATTUTAR=isnull(dt.VERSATTUTAR,0) from @TB_AKARYAKIT_SATIS as t\r\n  join (select vh.stkod,vh.stktip,sum(vh.mik) as VERSATMIKTAR,\r\n  sum(vh.mik*(vh.brmfiy-(vh.fiyfarktop+vh.vadfarktop))) VERSATTUTAR\r\n  from veresihrk  as vh with (nolock)\r\n  inner join veresimas as vm with (nolock) on vh.verid=vm.verid and vm.sil=0\r\n  and vh.sil=0\r\n  where vm.varno in (select * from CsvToInt_Max(@VARNIN)) and vm.yertip=@tip\r\n  group by vh.stkod,vh.stktip)\r\n  dt on t.STOK_TIP=dt.stktip and t.STOK_KOD=dt.stkod\r\n\r\n\r\n  RETURN\r\n\r\nend"
  },
  {
    "schema": "dbo",
    "name": "UDF_VAR_BANKONOT",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_VAR_BANKONOT",
    "definition": "CREATE FUNCTION [dbo].[UDF_VAR_BANKONOT] \r\n(@VARNIN VARCHAR(8000),@TIP VARCHAR(30))\r\nRETURNS\r\n  @TB_BANKONOT TABLE (\r\n    KASA_KOD            VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    KASA_AD     \t\tVARCHAR(150) COLLATE Turkish_CI_AS,\r\n    PARABRIM\t\t\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n    ACIKLAMA\t\t\tVARCHAR(150) COLLATE Turkish_CI_AS,\r\n    ADET\t\t\t    INT,\r\n    TUTAR         \t    FLOAT,\r\n    TLTUTAR             FLOAT )\r\nAS\r\nBEGIN\r\n \r\n  \r\n   insert into @TB_BANKONOT\r\n   \r\n     SELECT kh.kaskod AS KASA_KOD,k.ad as KASA_AD,\r\n       kh.parabrm as PARABRIM,\r\n       bt.ack ACIKLAMA,sum(bh.adet) ADET,\r\n       sum(bh.deger*bh.adet) as TUTAR,\r\n       sum(bh.deger*bh.adet*kh.kur) as TLTUTAR\r\n       FROM kasahrk AS kh INNER JOIN kasakart AS k ON \r\n       kh.kaskod=k.kod and kh.varno in  (select * from CsvToInt(@VARNIN))\r\n       and kh.sil=0 \r\n       and yertip=@TIP and islmhrk='TES' and kh.banknot=1 \r\n       INNER JOIN banknot_hrk as bh  on bh.hrk_id=kh.kashrkid \r\n       INNER JOIN banknot_tip as bt  on bt.id=bh.tip \r\n       group by kh.kaskod,k.ad,Kh.parabrm,bh.tip,bt.ack \r\n \r\n    \r\n   \r\n  RETURN\r\n\r\nend"
  },
  {
    "schema": "dbo",
    "name": "UDF_VAR_BANKYATCEK_TOPLAM",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_VAR_BANKYATCEK_TOPLAM",
    "definition": "CREATE FUNCTION [dbo].UDF_VAR_BANKYATCEK_TOPLAM (\r\n@VARNIN VARCHAR(max),@TIP VARCHAR(30))\r\nRETURNS\r\n  @TB_TAH_ODE_TOPLAM TABLE (\r\n    CARI_KOD     VARCHAR(20)  COLLATE Turkish_CI_AS,\r\n    CARI_ADI     VARCHAR(40)  COLLATE Turkish_CI_AS,\r\n    CARI_GRUP    VARCHAR(30)  COLLATE Turkish_CI_AS,\r\n    CEKILEN         FLOAT,\r\n    YATIRILAN       FLOAT)\r\nAS\r\nBEGIN\r\n  \r\n  INSERT @TB_TAH_ODE_TOPLAM (CARI_KOD,CARI_ADI,CARI_GRUP,YATIRILAN,CEKILEN)\r\n  select h.bankod,ck.ad,gp.ad,sum(h.borc),sum(h.alacak)\r\n  FROM  bankahrk as h with (nolock)\r\n  inner join bankakart as ck with (nolock) on ck.kod=h.bankod\r\n  inner join grup as gp  with (nolock) on gp.id=ck.grp1\r\n  where h.varno in (select * from CsvToInt_Max(@VARNIN) )\r\n  and h.sil=0 and h.yertip=@TIP\r\n  group by h.bankod,ck.ad,gp.ad\r\n\r\n  RETURN\r\n\r\nend"
  },
  {
    "schema": "dbo",
    "name": "UDF_VAR_CAR_TAHODE",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_VAR_CAR_TAHODE",
    "definition": "CREATE FUNCTION [dbo].[UDF_VAR_CAR_TAHODE] \r\n(@VARNIN VARCHAR(8000),@TIP VARCHAR(30))\r\nRETURNS\r\n  @TB_CAR_TAHODE TABLE (\r\n    CARIKOD             VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    CARIUNVAN     \t\tVARCHAR(150) COLLATE Turkish_CI_AS,\r\n    BELGENO\t\t\t\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n    ACIKLAMA\t\t\tVARCHAR(150) COLLATE Turkish_CI_AS,\r\n    GYTLTUTAR        \tFLOAT,\r\n    CYTLTUTAR           FLOAT,\r\n    KUR        \t\t\tFLOAT,\r\n    ISLEMTIP         \tVARCHAR(50) COLLATE Turkish_CI_AS )\r\nAS\r\nBEGIN\r\n \r\n  \r\n   insert into @TB_CAR_TAHODE\r\n   SELECT  P.carkod,vk.ad,p.belno,P.ack,\r\n    p.alacak,p.borc,P.kur AS KUR,P.islmhrkad \r\n    FROM  carihrk AS P WITH(NOLOCK) \r\n     INNER JOIN Genel_Kart AS vk with (nolock)\r\n     ON (P.carkod=vk.kod and vk.cartp=p.cartip \r\n     and P.varno in  (select * from CsvToInt(@VARNIN)) \r\n     and p.sil=0 and yertip=@TIP  ) \r\n     ORDER BY P.carkod \r\n   \r\n    \r\n   \r\n  RETURN\r\n\r\nend"
  },
  {
    "schema": "dbo",
    "name": "UDF_VAR_CAR_VER",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_VAR_CAR_VER",
    "definition": "CREATE FUNCTION [dbo].[UDF_VAR_CAR_VER] \r\n(@VARNIN VARCHAR(8000),@TIP VARCHAR(30))\r\nRETURNS\r\n  @TB_CAR_VER TABLE (\r\n    CARIKOD             VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    CARIUNVAN     \t\tVARCHAR(150) COLLATE Turkish_CI_AS,\r\n    FISSERINO\t\t\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n    ACIKLAMA\t\t\tVARCHAR(150) COLLATE Turkish_CI_AS,\r\n    PLAKA\t\t\t\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n    BYTLTUTAR        \tFLOAT,\r\n    AYTLTUTAR           FLOAT,\r\n    KUR        \t\t\tFLOAT,\r\n    FISAD         \t    VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    OTOTAG              INT )\r\nAS\r\nBEGIN\r\n\r\n\r\n \r\n  \r\n    insert into @TB_CAR_VER (CARIKOD,CARIUNVAN,FISSERINO,ACIKLAMA,PLAKA,BYTLTUTAR,AYTLTUTAR,\r\n    KUR,FISAD,OTOTAG)\r\n    SELECT P.carkod AS CARIKOD,\r\n    S.ad as CARIUNVAN,p.seri+cast(no as varchar) as FISSERINO,\r\n    P.ack ACIKLAMA,p.PLAKA,\r\n    BYTLTUTAR=case when fistip='FISVERSAT' \r\n    THEN p.toptut-(fiyfarktop+vadfarktop+isnull(isktop,0)) ELSE 0 END,\r\n    AYTLTUTAR=case when fistip='FISALCSAT' THEN \r\n    p.toptut-(fiyfarktop+vadfarktop+isnull(isktop,0)) ELSE 0 END,\r\n    P.kur AS KUR,P.fisad as FISAD,P.ototag\r\n     FROM  veresimas AS P  with (nolock)\r\n    INNER JOIN Genel_Kart AS S  with (nolock) ON (P.carkod=S.kod and s.cartp=p.cartip \r\n    AND p.sil=0 and P.varno in  (select * from CsvToInt(@VARNIN)) \r\n    and yertip=@TIP) \r\n    /*order by S.ad */\r\n   \r\n\r\n   \r\n  RETURN\r\n\r\nend"
  },
  {
    "schema": "dbo",
    "name": "UDF_VAR_CAR_VER_GRP",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_VAR_CAR_VER_GRP",
    "definition": "CREATE FUNCTION [dbo].[UDF_VAR_CAR_VER_GRP] \r\n(@VARNIN VARCHAR(8000),@TIP VARCHAR(30))\r\nRETURNS\r\n  @TB_CAR_VER_GRP TABLE (\r\n    CARITIP             VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    CARIKOD             VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    CARIUNVAN     \t\tVARCHAR(150) COLLATE Turkish_CI_AS,\r\n    FIS_ADET\t\t\tINT,\r\n    BYTLTUTAR        \tFLOAT,\r\n    AYTLTUTAR           FLOAT,\r\n    TOPMIKTAR           FLOAT,\r\n    CARIBAKIYE          FLOAT)\r\nAS\r\nBEGIN\r\n \r\n  \r\n   insert into @TB_CAR_VER_GRP\r\n   \r\n   SELECT P.cartip,P.carkod AS CARIKOD,S.ad as CARIUNVAN,\r\n   count(p.carkod) as FIS_ADET,\r\n   BYTLTUTAR=SUM(case when fistip='FISVERSAT' THEN p.toptut-isnull(isktop,0) ELSE 0 END),\r\n   AYTLTUTAR=SUM(case when fistip='FISALCSAT' THEN p.toptut-isnull(isktop,0) ELSE 0 END), \r\n   TOPMIKTAR=SUM(case when fistip='FISVERSAT' THEN isnull(Top_Mik,0) ELSE 0 END),\r\n   0 CARIBAKIYE\r\n    FROM  veresimas AS P with (nolock)\r\n     INNER JOIN Genel_Kart AS S with (nolock) ON \r\n     (P.carkod=S.kod and s.cartp=p.cartip AND p.sil=0 \r\n     and P.varno in  (select * from CsvToInt(@VARNIN))\r\n     and yertip=@TIP) \r\n     group by p.cartip,P.carkod,S.ad \r\n     order by S.ad\r\n   \r\n\r\n    UPDATE @TB_CAR_VER_GRP set \r\n     CARIBAKIYE=dt.top_bakiye from @TB_CAR_VER_GRP as t join (\r\n     select kod,top_bakiye from  Cari_Kart_Listesi) dt \r\n     on dt.kod=t.CARIKOD and t.CARITIP='carikart'\r\n    \r\n   \r\n  RETURN\r\n\r\nend"
  },
  {
    "schema": "dbo",
    "name": "UDF_VAR_CARI_SECIMLI",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_VAR_CARI_SECIMLI",
    "definition": "CREATE FUNCTION [dbo].[UDF_VAR_CARI_SECIMLI] \r\n(@VARNIN VARCHAR(1000),\r\n @GRPIN VARCHAR(4000))\r\nRETURNS\r\n    @TB_CARI_SECIMLI TABLE (\r\n    GRP_ID     \t\tINT, \r\n    GRP_AD\t\t\tVARCHAR(70)  COLLATE Turkish_CI_AS,\r\n    BAKIYE     \t\tFLOAT)\r\n    \r\nAS\r\nBEGIN    \r\n\r\n       insert into @TB_CARI_SECIMLI\r\n       (GRP_ID,GRP_AD,BAKIYE)\r\n       select grp.id,grp.ad,sum(k.top_bakiye)\r\n       from Cari_Kart_Listesi as k \r\n       left join grup as grp on grp.id=k.grp1 and grp.sil=0\r\n       where k.sil=0 and grp.id in (select * from CsvToInt(@GRPIN))\r\n       GROUP by grp.id,grp.ad\r\n\r\n      RETURN\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_VAR_CARIODE_TOPLAM",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_VAR_CARIODE_TOPLAM",
    "definition": "CREATE FUNCTION [dbo].UDF_VAR_CARIODE_TOPLAM (@VARNIN VARCHAR(4000),@TIP VARCHAR(30))\r\nRETURNS\r\n  @TB_CARI_TAH_TOPLAM TABLE (\r\n    CARI_TIP      VARCHAR(20)  COLLATE Turkish_CI_AS,\r\n    CARI_KOD      VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    CARI_UNVAN    VARCHAR(150) COLLATE Turkish_CI_AS,\r\n    TARIH         DATETIME,\r\n    BELGENO       VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    ACIKLAMA      VARCHAR(100) COLLATE Turkish_CI_AS,\r\n    TUTAR         FLOAT,\r\n    ISLEM         VARCHAR(50) COLLATE Turkish_CI_AS)\r\nAS\r\nBEGIN\r\n  \r\n  INSERT @TB_CARI_TAH_TOPLAM (CARI_TIP,CARI_KOD,CARI_UNVAN,TARIH,BELGENO,\r\n  ACIKLAMA,TUTAR,ISLEM)\r\n  select h.cartip,h.carkod,ck.ad,h.tarih,h.belno,h.ack,h.cikan,h.islmhrkad\r\n  FROM  kasahrk as h\r\n  inner join Genel_Kart as ck on ck.kod=h.carkod and h.cartip=ck.cartp\r\n  where h.cikan>0 and h.islmhrk<>'VTO' \r\n  and h.varno in (select * from CsvToInt(@VARNIN)) \r\n  and h.sil=0 and h.yertip=@TIP\r\n\r\n\r\n  RETURN\r\n\r\nend"
  },
  {
    "schema": "dbo",
    "name": "UDF_VAR_CARITAH_TOPLAM",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_VAR_CARITAH_TOPLAM",
    "definition": "CREATE FUNCTION [dbo].UDF_VAR_CARITAH_TOPLAM (\r\n@VARNIN VARCHAR(4000),@TIP VARCHAR(30))\r\nRETURNS\r\n  @TB_CARI_TAH_TOPLAM TABLE (\r\n    CARI_TIP      VARCHAR(20)  COLLATE Turkish_CI_AS,\r\n    CARI_KOD      VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    CARI_UNVAN    VARCHAR(150) COLLATE Turkish_CI_AS,\r\n    TARIH         DATETIME,\r\n    BELGENO       VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    ACIKLAMA      VARCHAR(100) COLLATE Turkish_CI_AS,\r\n    TUTAR         FLOAT,\r\n    ISLEM         VARCHAR(50) COLLATE Turkish_CI_AS)\r\nAS\r\nBEGIN\r\n \r\n  INSERT @TB_CARI_TAH_TOPLAM (CARI_TIP,CARI_KOD,CARI_UNVAN,TARIH,BELGENO,\r\n  ACIKLAMA,TUTAR,ISLEM)\r\n  select h.cartip,h.carkod,ck.ad,h.tarih,h.belno,h.ack,h.giren,h.islmhrkad\r\n  FROM  kasahrk as h\r\n  inner join Genel_Kart as ck on ck.kod=h.carkod and h.cartip=ck.cartp\r\n  where h.giren>0 and h.islmhrk<>'VTO' \r\n  and h.varno in (select * from CsvToInt(@VARNIN)) \r\n  and h.sil=0 and h.yertip=@TIP\r\n\r\n\r\n  RETURN\r\n\r\nend"
  },
  {
    "schema": "dbo",
    "name": "UDF_VAR_CEK_TOPLAM",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_VAR_CEK_TOPLAM",
    "definition": "CREATE FUNCTION [dbo].UDF_VAR_CEK_TOPLAM (\r\n@VARNIN VARCHAR(max),@TIP VARCHAR(30)\r\n)\r\nRETURNS\r\n  @TB_TAH_ODE_TOPLAM TABLE (\r\n    CARI_KOD     VARCHAR(30)  COLLATE Turkish_CI_AS,\r\n    CARI_AD      VARCHAR(150)   COLLATE Turkish_CI_AS,\r\n    CARI_GRUP    VARCHAR(50)  COLLATE Turkish_CI_AS,\r\n    CEKNO        VARCHAR(50)  COLLATE Turkish_CI_AS,\r\n    REFERANSNO   VARCHAR(50)  COLLATE Turkish_CI_AS,\r\n    BANKA_AD\t VARCHAR(70)  COLLATE Turkish_CI_AS,\t\r\n    BANKA_SUBE   VARCHAR(70)  COLLATE Turkish_CI_AS,\r\n    KESIDECI     VARCHAR(100)  COLLATE Turkish_CI_AS,\r\n    CEKTUTAR     FLOAT,\r\n    VADETARIHI   DATETIME)\r\nAS\r\nBEGIN\r\n  \r\n\r\n  INSERT @TB_TAH_ODE_TOPLAM (CARI_KOD,CARI_AD,CARI_GRUP,CEKNO,\r\n  REFERANSNO,BANKA_AD,BANKA_SUBE,KESIDECI,\r\n  CEKTUTAR,VADETARIHI)\r\n  select h.carkod,ck.ad,ck.grupad1,h.ceksenno,h.refno,\r\n  h.banka,h.banksub,h.kesideci,\r\n  (h.giren*kur),h.vadetar\r\n  FROM  cekkart as h with (nolock)\r\n  inner join Genel_Kart as ck with (nolock) on ck.kod=h.carkod and ck.cartp=h.cartip\r\n  where h.varno in (select * from CsvToInt_Max(@VARNIN) )\r\n  and h.sil=0 \r\n  and h.yertip=@TIP\r\n\r\n  RETURN\r\n\r\nend"
  },
  {
    "schema": "dbo",
    "name": "UDF_VAR_EMTIA_SATIS",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_VAR_EMTIA_SATIS",
    "definition": "CREATE FUNCTION [dbo].UDF_VAR_EMTIA_SATIS (\r\n@VARNIN VARCHAR(max),@TIP VARCHAR(30))\r\nRETURNS\r\n  @TB_EMTIA_SATIS TABLE (\r\n    STOK_KOD    VARCHAR(20)  COLLATE Turkish_CI_AS,\r\n    STOK_AD     VARCHAR(150)  COLLATE Turkish_CI_AS,\r\n    SATISMIKTAR      FLOAT,\r\n    SATISTUTAR        FLOAT,\r\n    KDV               FLOAT,\r\n    KDVTUTAR          FLOAT,\r\n    BIRIMFIYAT        FLOAT)\r\nAS\r\nBEGIN\r\n  \r\n  INSERT @TB_EMTIA_SATIS (STOK_KOD,STOK_AD,SATISMIKTAR,SATISTUTAR,\r\n  KDV,KDVTUTAR,BIRIMFIYAT)\r\n  select EM.stkod,st.ad,sum(em.mik),sum(em.brmfiy*em.mik),avg(em.kdvyuz*100),\r\n  sum(   (em.brmfiy*em.mik)-  ((em.brmfiy*em.mik)/  (1+em.kdvyuz))   ),AVG(brmfiy)\r\n  FROM  emtiasat as em with (nolock) \r\n  inner join stokkart as st with (nolock) on st.kod=em.stkod and st.tip=em.stktip\r\n  where em.varno in (select * from CsvToInt_Max(@VARNIN)) and em.sil=0\r\n  group by EM.stkod,st.ad\r\n\r\n  RETURN\r\n\r\nend"
  },
  {
    "schema": "dbo",
    "name": "UDF_VAR_FINANS_HRK",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_VAR_FINANS_HRK",
    "definition": "CREATE FUNCTION [dbo].[UDF_VAR_FINANS_HRK] \r\n(@VARNIN VARCHAR(max),@TIP VARCHAR(30))\r\nRETURNS\r\n  @TB_CAR_TAHODE TABLE (\r\n    CARTIP\t\t\t\tVARCHAR(20) COLLATE Turkish_CI_AS,\r\n    CARIKOD             VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    CARIUNVAN     \t\tVARCHAR(150) COLLATE Turkish_CI_AS,\r\n    KAR_CARTIP\t\t\t\tVARCHAR(20) COLLATE Turkish_CI_AS,\r\n    KAR_CARIKOD             VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    KAR_CARIUNVAN     \t\tVARCHAR(150) COLLATE Turkish_CI_AS,\r\n    BELGENO\t\t\t\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n    ACIKLAMA\t\t\tVARCHAR(150) COLLATE Turkish_CI_AS,\r\n    GTUTAR        \tFLOAT,\r\n    CTUTAR           FLOAT,\r\n    KUR        \t\t\tFLOAT,\r\n    ISLEMTIP         \tVARCHAR(50) COLLATE Turkish_CI_AS )\r\nAS\r\nBEGIN\r\n \r\n  \r\n  insert into @TB_CAR_TAHODE (CARTIP,CARIKOD,CARIUNVAN,\r\n  KAR_CARTIP,KAR_CARIKOD,KAR_CARIUNVAN,\r\n  BELGENO,ACIKLAMA,GTUTAR,CTUTAR,KUR,ISLEMTIP)\r\n  SELECT h.cartip,h.carkod,'','kasakart',h.kaskod,'',\r\n  h.belno,h.ack,\r\n  h.giren*h.kur,h.cikan*h.kur,h.kur,h.islmhrkad\r\n  from kasahrk as h with (nolock)\r\n  where h.masterid=0\r\n  and h.islmhrk<>'TES' and h.sil=0\r\n  and h.yertip=@TIP and h.varno in (select * from CsvToInt_Max(@VARNIN)) \r\n   \r\n \r\n\r\n\r\n   /* pos hrk */\r\n\r\n  insert into @TB_CAR_TAHODE \r\n  (CARTIP,CARIKOD,CARIUNVAN,\r\n  KAR_CARTIP,KAR_CARIKOD,KAR_CARIUNVAN,\r\n  BELGENO,ACIKLAMA,GTUTAR,CTUTAR,KUR,ISLEMTIP)\r\n\r\n  SELECT h.cartip,h.carkod,'','poskart',h.poskod,'',\r\n  h.belno,h.ack,h.giren,h.cikan,h.kur,h.islmhrkad\r\n  from poshrk as h with (nolock)\r\n  where h.masterid=0\r\n  and h.islmhrk<>'POS' and h.sil=0\r\n  and h.yertip=@TIP and h.varno in (select * from CsvToInt_Max(@VARNIN)) \r\n\r\n\r\n /*--cekkart */\r\n  insert into @TB_CAR_TAHODE \r\n  (CARTIP,CARIKOD,CARIUNVAN,\r\n  KAR_CARTIP,KAR_CARIKOD,KAR_CARIUNVAN,\r\n  BELGENO,ACIKLAMA,GTUTAR,CTUTAR,KUR,ISLEMTIP)\r\n\r\n  select\r\n  case when h.islmhrk='ALN' then h.cartip\r\n  when islmhrk='KSN' then   h.vercartip end, \r\n  case when h.islmhrk='ALN' then h.carkod\r\n  when islmhrk='KSN' then   h.vercarkod end,'',\r\n  'cekkart','','',\r\n  ceksenno,ack,h.giren,h.cikan,h.kur,h.islmhrkad\r\n  from cekkart as h with (nolock)\r\n  where\r\n  h.sil=0 and h.yertip=@TIP \r\n  and h.varno in (select * from CsvToInt_Max(@VARNIN)) \r\n\r\n /*- banka hrk */\r\n  insert into @TB_CAR_TAHODE \r\n  (CARTIP,CARIKOD,CARIUNVAN,\r\n  KAR_CARTIP,KAR_CARIKOD,KAR_CARIUNVAN,\r\n  BELGENO,ACIKLAMA,GTUTAR,CTUTAR,KUR,ISLEMTIP)\r\n  \r\n  /*h.kaskod, */\r\n  select h.cartip,h.carkod,'','bankakart',h.bankod,'',  \r\n  h.belno,h.ack,case \r\n  when h.islmhrk='CKN' then h.alacak\r\n  when h.islmhrk='YTN' then 0\r\n   else h.borc end,\r\n  case \r\n  when h.islmhrk='YTN' then h.borc \r\n  when h.islmhrk='CKN' then 0\r\n  else h.alacak end,h.kur,h.islmhrkad\r\n  from bankahrk as h with (nolock)\r\n  where h.masterid=0\r\n  and h.sil =0\r\n  and h.yertip=@TIP and h.varno in (select * from CsvToInt_Max(@VARNIN)) \r\n\r\n\r\n /*- cari hrk */\r\n  insert into @TB_CAR_TAHODE \r\n  (CARTIP,CARIKOD,CARIUNVAN,\r\n  KAR_CARTIP,KAR_CARIKOD,KAR_CARIUNVAN,\r\n  BELGENO,ACIKLAMA,GTUTAR,CTUTAR,KUR,ISLEMTIP)\r\n  \r\n  select h.cartip,h.carkod,'',\r\n  '','','',\r\n  h.belno,h.ack,\r\n  h.borc,h.alacak,h.kur,\r\n  h.islmhrkad  from carihrk as h with (nolock)\r\n  where h.masterid=0 and h.islmtip='MAH'\r\n  and h.sil=0\r\n  and h.yertip=@TIP and h.varno  in (select * from CsvToInt_Max(@VARNIN)) \r\n\r\n\r\n/*isletme k.k hrk */\r\n  insert into @TB_CAR_TAHODE \r\n  (CARTIP,CARIKOD,CARIUNVAN,\r\n  KAR_CARTIP,KAR_CARIKOD,KAR_CARIUNVAN,\r\n  BELGENO,ACIKLAMA,GTUTAR,CTUTAR,KUR,ISLEMTIP)\r\n\r\n  select h.cartip,h.carkod,'','istkart',h.istkkod,'',\r\n  h.belno,h.ack,\r\n  h.borc,h.alacak,h.kur,h.islmhrkad\r\n  from istkhrk as h with (nolock)\r\n  where h.masterid=0\r\n  and h.sil =0\r\n  and h.yertip=@TIP and h.varno in (select * from CsvToInt_Max(@VARNIN)) \r\n\r\n /*cari unvan */\r\n  update @TB_CAR_TAHODE set CARIUNVAN=dt.ad from @TB_CAR_TAHODE as t\r\n  join (select kod,ad,cartp,tip from Genel_Kart with (nolock) ) dt\r\n  on dt.kod=t.CARIKOD and dt.cartp=t.CARTIP\r\n\r\n /*cari unvan */\r\n  update @TB_CAR_TAHODE set KAR_CARIUNVAN=dt.ad from @TB_CAR_TAHODE as t\r\n  join (select kod,ad,cartp,tip from Genel_Kart with (nolock) ) dt\r\n  on dt.kod=t.KAR_CARIKOD and dt.cartp=t.KAR_CARTIP \r\n\r\n\r\n /* update @TB_CAR_TAHODE  set Ytlgiren=giren*kur,ytlcikan=cikan*kur */\r\n\r\n\r\n \r\n   \r\n   \r\n    \r\n   \r\n  RETURN\r\n\r\nend"
  },
  {
    "schema": "dbo",
    "name": "UDF_VAR_GELTAH_ODE_TOPLAM",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_VAR_GELTAH_ODE_TOPLAM",
    "definition": "CREATE FUNCTION [dbo].UDF_VAR_GELTAH_ODE_TOPLAM \r\n(@VARNIN VARCHAR(max),@TIP VARCHAR(30))\r\nRETURNS\r\n  @TB_TAH_ODE_TOPLAM TABLE (\r\n    CARI_TIP      VARCHAR(20)  COLLATE Turkish_CI_AS,\r\n    CARI_KOD      VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    CARI_ADI      VARCHAR(150)  COLLATE Turkish_CI_AS,\r\n    CARI_GRUP     VARCHAR(50)  COLLATE Turkish_CI_AS,\r\n    CARI_ACK      VARCHAR(150)  COLLATE Turkish_CI_AS,\r\n    GIREN         FLOAT,\r\n    CIKAN         FLOAT,\r\n    BELGENO       VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    ACIKLAMA      VARCHAR(100) COLLATE Turkish_CI_AS,\r\n    ISLEM         VARCHAR(50) COLLATE Turkish_CI_AS)\r\nAS\r\nBEGIN\r\n  \r\n  INSERT @TB_TAH_ODE_TOPLAM (CARI_TIP,CARI_KOD,CARI_ADI,CARI_GRUP,CARI_ACK,\r\n  GIREN,CIKAN,BELGENO,ACIKLAMA,ISLEM)\r\n  select h.cartip,h.carkod,ck.ad,gp.ad,H.ack,\r\n  (h.giren*h.kur),(h.cikan*h.kur),\r\n  h.belno,h.ack,h.islmhrkad\r\n  FROM  kasahrk as h with (nolock)\r\n  inner join gelgidkart as ck with (nolock) on ck.kod=h.carkod and h.cartip='gelgidkart'\r\n  inner join grup as gp with (nolock) on gp.id=ck.grp1\r\n  where h.varno in (select * from CsvToInt_Max(@VARNIN)) \r\n  and h.sil=0 and h.yertip=@TIP\r\n\r\n\r\n  RETURN\r\n\r\nend"
  },
  {
    "schema": "dbo",
    "name": "UDF_VAR_GNLTAH_ODE_TOPLAM",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_VAR_GNLTAH_ODE_TOPLAM",
    "definition": "CREATE FUNCTION [dbo].UDF_VAR_GNLTAH_ODE_TOPLAM \r\n(@VARNIN VARCHAR(max),@TIP VARCHAR(30))\r\nRETURNS\r\n  @TB_TAH_ODE_TOPLAM TABLE (\r\n    CARI_TIP     VARCHAR(20)  COLLATE Turkish_CI_AS,\r\n    CARI_KOD     VARCHAR(20)  COLLATE Turkish_CI_AS,\r\n    CARI_ADI     VARCHAR(150)  COLLATE Turkish_CI_AS,\r\n    CARI_GRUP    VARCHAR(50)  COLLATE Turkish_CI_AS,\r\n    GIREN         FLOAT,\r\n    CIKAN         FLOAT)\r\nAS\r\nBEGIN\r\n \r\n  INSERT @TB_TAH_ODE_TOPLAM (CARI_TIP,CARI_KOD,CARI_ADI,CARI_GRUP,GIREN,CIKAN)\r\n  select h.cartip,h.carkod,ck.ad,ck.grupad1,sum(h.giren*kur),sum(h.cikan*kur)\r\n  FROM  kasahrk as h with (nolock)\r\n  inner join Genel_Kart as ck with (nolock) on ck.kod=h.carkod and h.cartip=ck.cartp\r\n  and ck.crno=1\r\n  where h.varno in (select * from CsvToInt_Max(@VARNIN)) \r\n  and h.sil=0 and h.yertip=@TIP\r\n  group by h.cartip,h.carkod,ck.ad,ck.grupad1\r\n\r\n  RETURN\r\n\r\nend"
  },
  {
    "schema": "dbo",
    "name": "UDF_VAR_GNLTOPLAM",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_VAR_GNLTOPLAM",
    "definition": "CREATE FUNCTION UDF_VAR_GNLTOPLAM (@VARNIN VARCHAR(max),@TIP VARCHAR(30))\r\nRETURNS\r\n  @TB_TAH_ODE_TOPLAM TABLE (\r\n    ACIKLAMA     VARCHAR(50)  COLLATE Turkish_CI_AS,\r\n    GIREN         FLOAT,\r\n    CIKAN         FLOAT,\r\n    BAKIYE        FLOAT,\r\n    SIRA          FLOAT)\r\nAS\r\nBEGIN\r\n  DECLARE @ACIKFAZLA FLOAT\r\n  DECLARE @GIREN     FLOAT\r\n  DECLARE @CIKAN     FLOAT\r\n  DECLARE @FARKGIREN FLOAT\r\n  DECLARE @FARKCIKAN FLOAT\r\n  DECLARE @VARNO\t INT\r\n \r\n  \r\n  if @TIP='pomvardimas'\r\n  begin\r\n    INSERT @TB_TAH_ODE_TOPLAM (ACIKLAMA,GIREN,CIKAN,BAKIYE,SIRA)\r\n    select h.tipack,sum(h.giris),sum(h.cikis),sum(h.bakiye),h.sr\r\n    FROM  pomvardiozet as h\r\n    where h.varno in (select * from CsvToInt_Max(@VARNIN))\r\n    and h.sil=0 and h.sr<=40 \r\n    group by h.tipack,h.sr\r\n  end\r\n  \r\n  if @TIP='marvardimas'\r\n  begin\r\n      INSERT @TB_TAH_ODE_TOPLAM (ACIKLAMA,GIREN,CIKAN,BAKIYE,SIRA)\r\n      select h.tipack,sum(h.giris),sum(h.cikis),sum(h.bakiye),h.sr\r\n      FROM  marvardiozet as h with (NOLOCK)\r\n      where h.varno in (select * from CsvToInt_Max(@VARNIN)) \r\n      and h.sil=0 and h.sr<=40\r\n      group by h.tipack,H.sr\r\n  end\r\n  \r\n  \r\n  \r\n  if @TIP='resvardimas'\r\n  begin\r\n      INSERT @TB_TAH_ODE_TOPLAM (ACIKLAMA,GIREN,CIKAN,BAKIYE,SIRA)\r\n      select h.tipack,sum(h.giris),sum(h.cikis),sum(h.bakiye),h.sr\r\n      FROM  resvardiozet as h with (NOLOCK)\r\n      where h.varno in (select * from CsvToInt_Max(@VARNIN)) \r\n      and h.sil=0 and h.sr<=40\r\n      group by h.tipack,H.sr\r\n  end\r\n\r\n\r\n  \r\n  \r\n  SELECT @GIREN=GIREN,@CIKAN=CIKAN,@ACIKFAZLA=(GIREN-CIKAN)\r\n  FROM @TB_TAH_ODE_TOPLAM WHERE SIRA=40 /*-ARA TOPLAM */\r\n\r\n  IF @ACIKFAZLA<0\r\n  SET @FARKGIREN=ABS(@ACIKFAZLA) ELSE SET @FARKGIREN=0\r\n  IF @ACIKFAZLA>0\r\n  SET @FARKCIKAN=ABS(@ACIKFAZLA) ELSE SET @FARKCIKAN=0\r\n\r\n  INSERT INTO @TB_TAH_ODE_TOPLAM (ACIKLAMA,GIREN,CIKAN,BAKIYE,SIRA)\r\n  VALUES ('Fark',@FARKGIREN,@FARKCIKAN,@ACIKFAZLA,41)\r\n\r\n  INSERT INTO @TB_TAH_ODE_TOPLAM (ACIKLAMA,GIREN,CIKAN,BAKIYE,SIRA)\r\n  VALUES ('Genel Toplam',(@GIREN+@FARKGIREN),(@CIKAN+@FARKCIKAN),\r\n  (@GIREN+@FARKGIREN-@CIKAN+@FARKCIKAN),42)\r\n  \r\n  \r\n\r\n\r\n  RETURN\r\n\r\nend"
  },
  {
    "schema": "dbo",
    "name": "UDF_VAR_HIZMET_SATIS",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_VAR_HIZMET_SATIS",
    "definition": "CREATE FUNCTION [dbo].UDF_VAR_HIZMET_SATIS (@VARNIN VARCHAR(4000),@TIP VARCHAR(30))\r\nRETURNS\r\n  @TB_EMTIA_SATIS TABLE (\r\n    STOK_KOD    VARCHAR(30)  COLLATE Turkish_CI_AS,\r\n    STOK_AD     VARCHAR(150) COLLATE Turkish_CI_AS,\r\n    SATISMIKTAR      FLOAT,\r\n    SATISTUTAR        FLOAT,\r\n    IADEMIKTAR        FLOAT,\r\n    IADETUTAR         FLOAT,\r\n    KDV               FLOAT,\r\n    KDVTUTAR          FLOAT,\r\n    BIRIMFIYAT        FLOAT)\r\nAS\r\nBEGIN\r\n\r\ndeclare @hizmet_grp    int\r\n\r\n\r\n select @hizmet_grp=grp_hizmet from sistemtanim\r\n\r\n\r\n  DECLARE @EKSTRE_TEMP TABLE (\r\n    VARNO      FLOAT)\r\n declare @separator char(1)\r\n set @separator = ','\r\n\r\n declare @separator_position int\r\n declare @array_value varchar(1000)\r\n\r\n IF (LEN(RTRIM(@VARNIN)) > 0)\r\n BEGIN\r\n  set @VARNIN = @VARNIN + ','\r\n END\r\n\r\n while patindex('%,%' , @VARNIN) <> 0\r\n begin\r\n\r\n   select @separator_position =  patindex('%,%' , @VARNIN)\r\n   select @array_value = left(@VARNIN, @separator_position - 1)\r\n\r\n  Insert @EKSTRE_TEMP\r\n  Values (Cast(@array_value as float))\r\n  select @VARNIN = stuff(@VARNIN, 1, @separator_position, '')\r\n end\r\n\r\n  INSERT @TB_EMTIA_SATIS (STOK_KOD,STOK_AD,SATISMIKTAR,SATISTUTAR,\r\n  IADEMIKTAR,IADETUTAR,KDV,KDVTUTAR,BIRIMFIYAT)\r\n  select em.stkod,st.ad,isnull(sum(case when em.islmtip='satis' then em.mik else 0 end),0),\r\n  isnull(sum(case when em.islmtip='satis' then em.mik*em.brmfiy else 0 end),0),\r\n  isnull(sum(case when em.islmtip='iade' then em.mik else 0 end),0),\r\n  isnull(sum(case when em.islmtip='iade' then em.mik*em.brmfiy else 0 end),0),\r\n  (em.kdvyuz*100),sum( ( (\r\n  (case when em.islmtip='satis' then em.mik else -1*em.mik end)*em.brmfiy) / (1+em.kdvyuz) )*em.kdvyuz),em.brmfiy\r\n  FROM  marsathrk as em\r\n  inner join stokkart as st on st.kod=em.stkod and st.tip=em.stktip and st.grp1=@hizmet_grp\r\n  where em.varno in (select * from @EKSTRE_TEMP) and em.sil=0 \r\n  group by em.stkod,st.ad,em.kdvyuz,em.brmfiy\r\n\r\n  RETURN\r\n\r\nend"
  },
  {
    "schema": "dbo",
    "name": "UDF_VAR_KASA_SON_DRM",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_VAR_KASA_SON_DRM",
    "definition": "CREATE FUNCTION [dbo].[UDF_VAR_KASA_SON_DRM] \r\n(@VARNIN VARCHAR(1000))\r\nRETURNS\r\n    @TB_KASA_SONDRM TABLE (\r\n    KASA_KOD     \tVARCHAR(40)  COLLATE Turkish_CI_AS,\r\n    KASA_AD\t\t\tVARCHAR(70)  COLLATE Turkish_CI_AS,\r\n    PARABRM\t\t\tVARCHAR(20)  COLLATE Turkish_CI_AS,\r\n    BAKIYE     \t\tFLOAT,\r\n    KUR\t\t\t\tFLOAT,\r\n    KUR_BAKIYE\t\tFLOAT)\r\n    \r\nAS\r\nBEGIN    \r\n\r\n     DECLARE @PARABRM    VARCHAR(30)\r\n     DECLARE @DATE\t\t DATETIME\r\n\r\n     SELECT @PARABRM=k.sistem_parabrm from sistemtanim as k\r\n     \r\n     \r\n     \r\n     SELECT @DATE='2100-01-01'\r\n     \r\n\r\n\r\n       insert into @TB_KASA_SONDRM\r\n       (KASA_KOD,KASA_AD,PARABRM,BAKIYE,KUR,KUR_BAKIYE)\r\n       select K.kod,K.ad,K.parabrm,\r\n       k.top_bakiye,DBO.UDF_CAPRAZ_KUR \r\n       (@DATE,K.parabrm,@PARABRM),0\r\n       from Kasa_Kart_Listesi as k\r\n       where k.firmano in (select firmano from pomvardimas \r\n       where varno in (select * from CsvToInt(@VARNIN) ))\r\n       \r\n       \r\n      UPDATE @TB_KASA_SONDRM SET KUR_BAKIYE=BAKIYE*KUR\r\n        \r\n       \r\n\r\n      RETURN\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_VAR_LITRE_ARAC_GUNLUK",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_VAR_LITRE_ARAC_GUNLUK",
    "definition": "CREATE FUNCTION [dbo].UDF_VAR_LITRE_ARAC_GUNLUK\r\n(@FIRMANO     INT,\r\n @VARIN        VARCHAR(8000))\r\n RETURNS\r\n    @TB_VAR_LITRE_ARAC TABLE (\r\n    GUN\t\t\t\tINT,\r\n    AY\t\t\t\tINT,\r\n    YIL\t\t\t\tINT,\r\n    TARIH\t\t      \tdatetime,\r\n    LITRE\t\t      \tFLOAT,\r\n    TUTAR\t\t\tFLOAT,\r\n    ARAC_SAYI          \t\tFLOAT,\r\n    GUN_SAYI\t\t\tINT,\r\n    ORT_LITRE\t\t\tFLOAT,\r\n    ORT_ARAC\t\t\tFLOAT,\r\n    ORT_TUTAR\t\t\tFLOAT)\r\nAS\r\nBEGIN\r\n   \r\n  declare @GUNSAYI    FLOAT\r\n  declare @LITRE   FLOAT\r\n  declare @ARAC   FLOAT\r\n  declare @TUTAR   FLOAT\r\n\r\n  \r\n   INSERT @TB_VAR_LITRE_ARAC (GUN,AY,YIL,TARIH,LITRE,\r\n   TUTAR,ARAC_SAYI,GUN_SAYI,ORT_LITRE,ORT_ARAC,ORT_TUTAR)\r\n   select day(p.tarih),\r\n   month(p.tarih),YEAR(p.tarih),p.tarih,\r\n   round( sum(ot.miktar),3),\r\n   round( sum(ot.tutar),3),\r\n   count(ot.miktar),\r\n   0,0,0,0  \r\n   FROM  otomasoku as ot \r\n   inner join pomvardimas as p on \r\n   p.varno=ot.varno\r\n   where p.varno in (select * from CsvToInt(@VARIN))\r\n   group by p.tarih\r\n   \r\n   \r\n   select @GUNSAYI=datediff(day,min(TARIH),max(TARIH))+1,\r\n   @LITRE=sum(LITRE),\r\n   @ARAC=sum(ARAC_SAYI),\r\n   @TUTAR=sum(TUTAR)\r\n   FROM @TB_VAR_LITRE_ARAC \r\n   \r\n   update @TB_VAR_LITRE_ARAC set\r\n   GUN_SAYI=@GUNSAYI,\r\n   ORT_LITRE=CASE WHEN @GUNSAYI>0 THEN \r\n   @LITRE/@GUNSAYI ELSE 0 END,\r\n   ORT_ARAC=case when (@GUNSAYI)>0 THEN \r\n   @ARAC/@GUNSAYI else 0 end,\r\n   ORT_TUTAR=case when @GUNSAYI>0 THEN \r\n   @TUTAR/@GUNSAYI else 0 end\r\n\r\n    \r\n     \r\n   Return\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_VAR_LITRE_ARAC_SAAT",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_VAR_LITRE_ARAC_SAAT",
    "definition": "CREATE FUNCTION [dbo].[UDF_VAR_LITRE_ARAC_SAAT]\r\n(@FIRMANO     INT,\r\n@VARIN        VARCHAR(8000))\r\nRETURNS\r\n    @TB_VAR_LITRE_ARAC TABLE (\r\n    MINTAR\t\t\t\tDATETIME,\r\n    MAXTAR\t\t\t\tDATETIME,\r\n    SAAT\t\t\t\tINT,\r\n    LITRE\t\t      \tFLOAT,\r\n    TUTAR\t\t\t\tFLOAT,\r\n    ARAC_SAYI          \tFLOAT,\r\n    GUN_SAYI\t\t\tINT,\r\n    ORT_LITRE\t\t\tFLOAT,\r\n    ORT_ARAC\t\t\tFLOAT,\r\n    ORT_TUTAR\t\t\tFLOAT)\r\nAS\r\nBEGIN\r\n   \r\n \r\n  declare @GUNSAYI    FLOAT\r\n  declare @LITRE   FLOAT\r\n  declare @ARAC   FLOAT\r\n  declare @TUTAR   FLOAT\r\n\r\n  \r\n   INSERT @TB_VAR_LITRE_ARAC (MINTAR,MAXTAR,SAAT,LITRE,\r\n   TUTAR,ARAC_SAYI,GUN_SAYI,ORT_LITRE,ORT_ARAC,ORT_TUTAR)\r\n   select \r\n   min(tarih),\r\n   max(tarih),\r\n   LEFT(ot.saat,2),\r\n   round(sum(ot.miktar),3),\r\n   round(sum(ot.tutar),3),\r\n   count(ot.miktar),\r\n   0,0,0,0  \r\n   FROM  otomasoku as ot\r\n   where varno in (select * from CsvToInt(@VARIN))\r\n   group by LEFT(ot.saat,2)\r\n   \r\n   \r\n   select @GUNSAYI=datediff(day,MIN(MINTAR),MAX(MAXTAR))+1,\r\n   @LITRE=sum(LITRE),\r\n   @ARAC=sum(ARAC_SAYI),\r\n   @TUTAR=sum(TUTAR)\r\n   FROM @TB_VAR_LITRE_ARAC \r\n   \r\n   \r\n   \r\n   \r\n   update @TB_VAR_LITRE_ARAC set \r\n   GUN_SAYI=@GUNSAYI,\r\n   ORT_LITRE=CASE WHEN (@GUNSAYI*24)>0 THEN \r\n   @LITRE/(@GUNSAYI*24) ELSE 0 END,\r\n   ORT_ARAC=case when (@GUNSAYI*24)>0 THEN \r\n   @ARAC/(@GUNSAYI*24) else 0 end,\r\n   ORT_TUTAR=case when (@GUNSAYI*24)>0 THEN \r\n   @TUTAR/(@GUNSAYI*24) else 0 end\r\n\r\n   \r\n  \r\n   \r\n   \r\n   \r\n   return\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_VAR_MAR_SATTIPSTOKGRUP",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_VAR_MAR_SATTIPSTOKGRUP",
    "definition": "CREATE FUNCTION [dbo].UDF_VAR_MAR_SATTIPSTOKGRUP\r\n(@VARNOIN VARCHAR(max),@TIP VARCHAR(30))\r\nRETURNS\r\n   @TB_VAR_STOKGRP_ODEME TABLE (\r\n    STOK_GRUP     \tVARCHAR(100)  COLLATE Turkish_CI_AS,\r\n    KDV_ORAN\t\tFLOAT,\r\n    SATILAN_MIK   \tFLOAT,\r\n    IADE_MIK      \tFLOAT,\r\n    NAKIT_TUT     \tFLOAT,\r\n    POS_TUT       \tFLOAT,\r\n    VER_TUT   \t\tFLOAT)\r\n\r\nAS\r\nBEGIN\r\n\r\n\r\n  DECLARE   @TB_VAR_STOKGRP TABLE (\r\n    STOK_TIP      \tVARCHAR(20)  COLLATE Turkish_CI_AS,\r\n    STOK_KOD      \tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n    STOK_ANAGRUP     \tVARCHAR(100)  COLLATE Turkish_CI_AS,\r\n    STOK_ANAGRPID\t\tINT,\r\n    STOK_GRUP     \tVARCHAR(100)  COLLATE Turkish_CI_AS,\r\n    STOK_GRPID\t\tINT,\r\n    KDV_ORAN\t\tFLOAT,\r\n    SATILAN_MIK   \tFLOAT,\r\n    IADE_MIK      \tFLOAT,\r\n    NAKIT_TUT     \tFLOAT,\r\n    POS_TUT       \tFLOAT,\r\n    VER_TUT   \t\tFLOAT)\r\n\r\n\r\n\r\n /* marsatmas  */\r\n /*MAR GIDER */\r\n /*FISVERSAT VERESIYE */\r\n /*POS    POS */\r\n /*NAK    NAKİT */\r\n\r\n\r\n /*stoklar */\r\n insert into @TB_VAR_STOKGRP\r\n (STOK_TIP,STOK_KOD,KDV_ORAN,\r\n SATILAN_MIK,IADE_MIK,\r\n NAKIT_TUT,POS_TUT,VER_TUT)\r\n \r\n select h.stktip,h.stkod,h.kdvyuz*100,\r\n ISNULL(sum(case when m.islmtip='satis' then h.mik else 0 END),0),\r\n ISNULL(SUM(case when m.islmtip='iade' then h.mik else 0 END),0),\r\n ISNULL(SUM(case when m.islmtip='satis' and m.islmhrk='NAK' then  \r\n (h.mik*(h.brmfiy*(1-h.indyuz))) \r\n when m.islmtip='iade' and m.islmhrk='NAK' then -1*(h.mik*(h.brmfiy*(1-h.indyuz))) END),0),\r\n ISNULL(SUM(case when m.islmtip='satis' and m.islmhrk='POS' then (h.mik*(h.brmfiy*(1-h.indyuz)))\r\n when m.islmtip='iade' and m.islmhrk='POS' then -1*(h.mik*(h.brmfiy*(1-h.indyuz))) END),0),\r\n ISNULL(SUM(case when m.islmhrk='FISVERSAT' then (h.mik*(h.brmfiy*(1-h.indyuz))) else 0 END),0)\r\n from marsatmas as m with (nolock)\r\n inner join marsathrk as h with (nolock) on h.varno=m.varno and m.marsatid=h.marsatid\r\n and m.varno in (select * from dbo.CsvToInt_Max(@VARNOIN))\r\n and m.sil=0 and h.sil=0  \r\n group by h.stktip,h.stkod,h.kdvyuz\r\n \r\n \r\n \r\n   update @TB_VAR_STOKGRP set \r\n   STOK_ANAGRPID=dt.grp1,\r\n   STOK_GRPID=dt.grpid from @TB_VAR_STOKGRP\r\n   t join (select tip,kod,s.grp1,\r\n   grpid=case when s.grp3>0 then s.grp3\r\n   when s.grp2>0 then s.grp2\r\n   when s.grp1>0 then s.grp1 end \r\n   from stokkart as s  with (nolock) )\r\n   dt on t.STOK_TIP=dt.tip and t.STOK_KOD=kod\r\n   \r\n   \r\n   update @TB_VAR_STOKGRP set STOK_GRUP=dt.ad from @TB_VAR_STOKGRP\r\n   t join (select id,ad from grup with (nolock) )\r\n   dt on t.STOK_GRPID=dt.id \r\n \r\n \r\n  \r\n  insert into @TB_VAR_STOKGRP_ODEME\r\n   (STOK_GRUP,KDV_ORAN,\r\n    SATILAN_MIK,IADE_MIK,\r\n    NAKIT_TUT,POS_TUT,VER_TUT) \r\n   select STOK_GRUP,KDV_ORAN,\r\n    SUM(SATILAN_MIK),SUM(IADE_MIK),\r\n    SUM(NAKIT_TUT),SUM(POS_TUT),\r\n    SUM(VER_TUT)\r\n    FROM @TB_VAR_STOKGRP\r\n    group by STOK_GRUP,KDV_ORAN \r\n \r\n\r\nRETURN\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_VAR_MAR_STOK_SECIMLI",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_VAR_MAR_STOK_SECIMLI",
    "definition": "CREATE FUNCTION [dbo].UDF_VAR_MAR_STOK_SECIMLI \r\n(@VARNIN VARCHAR(1000),\r\n@GRPIN VARCHAR(4000))\r\nRETURNS\r\n    @TB_STOK_SECIMLI TABLE (\r\n    DEPO_KOD     VARCHAR(30)  COLLATE Turkish_CI_AS, \r\n    STOK_TIP    VARCHAR(10)  COLLATE Turkish_CI_AS,\r\n    STOK_KOD    VARCHAR(30)  COLLATE Turkish_CI_AS,\r\n    STOK_AD     VARCHAR(100)  COLLATE Turkish_CI_AS,\r\n    STOK_GRUP   VARCHAR(70)  COLLATE Turkish_CI_AS,\r\n    STOK_SAT1FIY    FLOAT,\r\n    ONCEKIMIKTAR     FLOAT,\r\n    ONCEKITUTAR      FLOAT,\r\n    MALALISMIKTAR    FLOAT,\r\n    MALALISTUTAR     FLOAT,\r\n    SATISMIKTAR      FLOAT,\r\n    SATISTUTAR       FLOAT,\r\n    IADEMIKTAR       FLOAT,\r\n    IADETUTAR        FLOAT,\r\n    KALANMIKTAR      FLOAT,\r\n    KALANTUTAR       FLOAT)\r\n    \r\nAS\r\nBEGIN    \r\n\r\n\r\n   DECLARE @MIN_TARIH   DATETIME\r\n   DECLARE @MAX_TARIH   DATETIME   \r\n   declare @STK_TIP     varchar(20)\r\n   declare @DEP_KOD     varchar(50)\r\n   \r\n\r\n   SELECT \r\n   @DEP_KOD=min(mv.depkod),\r\n   @MIN_TARIH=min(cast(mv.tarih as float)+cast(mv.saat as datetime)),\r\n   @MAX_TARIH=max(cast(mv.tarih as float)+cast(mv.saat as datetime))\r\n   FROM marvardimas as mv where sil=0 and \r\n   varno in (select * from CsvToInt(@VARNIN))\r\n  \r\n   \r\n   \r\n      set @STK_TIP='markt' \r\n        \r\n   \r\n       insert into @TB_STOK_SECIMLI\r\n       (DEPO_KOD,STOK_GRUP,STOK_TIP,\r\n       STOK_KOD,STOK_AD,STOK_SAT1FIY,\r\n       ONCEKIMIKTAR,ONCEKITUTAR,\r\n       MALALISMIKTAR,MALALISTUTAR,\r\n       SATISMIKTAR,SATISTUTAR,\r\n       IADEMIKTAR,IADETUTAR,\r\n       KALANMIKTAR,KALANTUTAR)\r\n       select @DEP_KOD,grp.ad,sk.tip,sk.kod,sk.ad,\r\n       case when sk.sat1kdvtip='Dahil' then sk.sat1fiy\r\n       else sk.sat1fiy*(1+(sk.sat1kdv/100)) end,\r\n       0,0,0,0,0,0,0,0,0,0\r\n       from stokkart as sk \r\n       left join grup as grp on grp.id=sk.grp1 and grp.sil=0\r\n       where sk.sil=0 and sk.tip=@STK_TIP\r\n       and grp.id in (select * from CsvToInt(@GRPIN))\r\n      \r\n       \r\n      update @TB_STOK_SECIMLI set  \r\n      ONCEKIMIKTAR=dt.mik,\r\n      ONCEKITUTAR=dt.mik*STOK_SAT1FIY  from \r\n      @TB_STOK_SECIMLI as t\r\n       join (SELECT\r\n       H.DEPKOD,h.stktip,h.stkod,\r\n       ISNULL(SUM(h.giren-h.cikan),0) as mik\r\n       from @TB_STOK_SECIMLI as dm\r\n       left join stkhrk as h on \r\n       h.stktip=dm.STOK_TIP\r\n       and h.stkod=dm.STOK_KOD and h.sil=0\r\n       AND h.tarih < @MIN_TARIH \r\n       group by H.DEPKOD,h.stktip,h.stkod)\r\n       dt on \r\n       T.DEPO_KOD=dt.DEPKOD and \r\n       t.STOK_TIP=dt.stktip\r\n       and t.STOK_KOD=dt.stkod\r\n     \r\n         \r\n      \r\n      update @TB_STOK_SECIMLI set  \r\n      MALALISMIKTAR=dt.mik,\r\n      MALALISTUTAR=dt.tutar\r\n      from \r\n      @TB_STOK_SECIMLI as t\r\n       join (SELECT\r\n       H.DEPKOD,h.stktip,h.stkod,\r\n       ISNULL(SUM(h.giren),0) as mik,\r\n       ISNULL(SUM((h.giren)*h.brmfiykdvli),0) as tutar\r\n       from @TB_STOK_SECIMLI as dm\r\n       left join stkhrk as h on \r\n       h.stktip=dm.STOK_TIP\r\n       and h.stkod=dm.STOK_KOD and h.sil=0\r\n       AND h.tarih > @MIN_TARIH \r\n       and h.tarih < @MAX_TARIH\r\n       and h.islmtip<>'MARIAD'\r\n       group by H.DEPKOD,h.stktip,h.stkod)\r\n       dt on \r\n       T.DEPO_KOD=dt.DEPKOD and \r\n       t.STOK_TIP=dt.stktip\r\n       and t.STOK_KOD=dt.stkod\r\n      \r\n      \r\n      update @TB_STOK_SECIMLI \r\n      set SATISMIKTAR=dt.SATISMIKTAR,\r\n      SATISTUTAR=dt.SATISTUTAR,\r\n      IADEMIKTAR=dt.IADEMIKTAR,\r\n      IADETUTAR=dt.IADETUTAR  from @TB_STOK_SECIMLI t join\r\n      (select sk.kod,sk.tip,\r\n       isnull(sum(case when islmtip='satis' then mhk.mik else -1*mhk.mik end),0) as SATISMIKTAR,\r\n       isnull(sum(case when islmtip='satis' then mhk.mik*((mhk.brmfiy*mhk.kur))\r\n       else -1*mhk.mik*((mhk.brmfiy*mhk.kur)) end),0) SATISTUTAR ,\r\n       isnull(sum(case when islmtip='iade' then mhk.mik else 0 end),0) IADEMIKTAR,\r\n       isnull(sum(case when islmtip='iade' then mhk.mik*((mhk.brmfiy*mhk.kur))\r\n        else 0 end),0) IADETUTAR from marvardimas as mv \r\n       left join marsathrk as mhk on mhk.varno=mv.varno and mv.sil=0 and mhk.sil=0\r\n       left join stokkart as sk on sk.kod=mhk.stkod and sk.tip=mhk.stktip\r\n       where mv.varno in (select * from CsvToSTR(@VARNIN))\r\n       group by sk.kod,sk.tip ) dt \r\n       on dt.tip=t.STOK_TIP\r\n       and t.STOK_KOD=dt.kod\r\n      \r\n      \r\n            \r\n       \r\n       update @TB_STOK_SECIMLI set \r\n       KALANMIKTAR=ONCEKIMIKTAR+MALALISMIKTAR-SATISMIKTAR+IADEMIKTAR,\r\n       KALANTUTAR=(ONCEKIMIKTAR+MALALISMIKTAR-SATISMIKTAR+IADEMIKTAR)*\r\n       STOK_SAT1FIY\r\n       \r\n   \r\n   \r\n   \r\n   \r\n   \r\n   \r\n   \r\n\r\n\r\n\r\n\r\n\r\n  RETURN\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_VAR_MAREMTIA_SATIS",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_VAR_MAREMTIA_SATIS",
    "definition": "CREATE FUNCTION [dbo].UDF_VAR_MAREMTIA_SATIS\r\n(@VARNIN VARCHAR(4000),@TIP VARCHAR(30))\r\nRETURNS\r\n  @TB_EMTIA_SATIS TABLE (\r\n    STOK_KOD    VARCHAR(20)  COLLATE Turkish_CI_AS,\r\n    STOK_AD     VARCHAR(150) COLLATE Turkish_CI_AS,\r\n    SATISMIKTAR      FLOAT,\r\n    SATISTUTAR        FLOAT,\r\n    IADEMIKTAR        FLOAT,\r\n    IADETUTAR         FLOAT,\r\n    KDV               FLOAT,\r\n    KDVTUTAR          FLOAT,\r\n    BIRIMFIYAT        FLOAT)\r\nAS\r\nBEGIN\r\n  DECLARE @EKSTRE_TEMP TABLE (\r\n    VARNO      FLOAT)\r\n declare @separator char(1)\r\n set @separator = ','\r\n\r\n declare @separator_position int\r\n declare @array_value varchar(1000)\r\n\r\n IF (LEN(RTRIM(@VARNIN)) > 0)\r\n BEGIN\r\n  set @VARNIN = @VARNIN + ','\r\n END\r\n\r\n while patindex('%,%' , @VARNIN) <> 0\r\n begin\r\n\r\n   select @separator_position =  patindex('%,%' , @VARNIN)\r\n   select @array_value = left(@VARNIN, @separator_position - 1)\r\n\r\n  Insert @EKSTRE_TEMP\r\n  Values (Cast(@array_value as float))\r\n  select @VARNIN = stuff(@VARNIN, 1, @separator_position, '')\r\n end\r\n\r\n  INSERT @TB_EMTIA_SATIS (STOK_KOD,STOK_AD,SATISMIKTAR,SATISTUTAR,\r\n  IADEMIKTAR,IADETUTAR,KDV,KDVTUTAR,BIRIMFIYAT)\r\n  select em.stkod,st.ad,\r\n  isnull(sum(case when em.islmtip='satis' then em.mik else 0 end),0),\r\n  isnull(sum(case when em.islmtip='satis' then em.mik*em.brmfiy*em.kur else 0 end),0),\r\n  isnull(sum(case when em.islmtip='iade' then em.mik else 0 end),0),\r\n  isnull(sum(case when em.islmtip='iade' then em.mik*em.brmfiy*em.kur else 0 end),0),\r\n  (st.sat1kdv),\r\n  sum( ( ((case when em.islmtip='satis' then em.mik else -1*em.mik end)*em.brmfiy*em.kur) / (1+em.kdvyuz) )*em.kdvyuz),em.brmfiy\r\n  FROM  marsathrk as em with (nolock)\r\n  inner join stokkart as st with (nolock) on st.kod=em.stkod and st.tip=em.stktip\r\n  where em.varno in (select * from @EKSTRE_TEMP) and em.sil=0 \r\n  group by em.stkod,st.ad,st.sat1kdv,em.brmfiy\r\n\r\n  RETURN\r\n\r\nend"
  },
  {
    "schema": "dbo",
    "name": "UDF_VAR_MARKDV_TOPLAM",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_VAR_MARKDV_TOPLAM",
    "definition": "CREATE FUNCTION [dbo].UDF_VAR_MARKDV_TOPLAM (\r\n@VARNIN VARCHAR(max),@TIP VARCHAR(30))\r\nRETURNS\r\n  @TB_EMTIA_SATIS TABLE (\r\n    SATISMIKTAR      FLOAT,\r\n    SATISTUTAR        FLOAT,\r\n    IADEMIKTAR        FLOAT,\r\n    IADETUTAR         FLOAT,\r\n    KDV               FLOAT,\r\n    KDVTUTAR          FLOAT)\r\nAS\r\nBEGIN\r\n  \r\n\r\n  INSERT @TB_EMTIA_SATIS (SATISMIKTAR,SATISTUTAR,\r\n  IADEMIKTAR,IADETUTAR,KDV,KDVTUTAR)\r\n  select \r\n  isnull(sum(case when em.islmtip='satis' then em.mik else 0 end),0),\r\n  isnull(sum(case when em.islmtip='satis' then \r\n  em.mik*em.brmfiy*em.kur\r\n  *(1-em.indyuz) else 0 end),0),\r\n  isnull(sum(case when em.islmtip='iade' then \r\n  em.mik else 0 end),0),\r\n  isnull(sum(case when em.islmtip='iade' then \r\n  em.mik*em.brmfiy*em.kur*(1-em.indyuz) else 0 end),0),\r\n  (em.kdvyuz*100),sum( ( ((case when em.islmtip='satis' then \r\n  em.mik else -1*em.mik end)*em.brmfiy*em.kur*(1-em.indyuz)) / (1+em.kdvyuz) )*em.kdvyuz)\r\n  FROM  marsathrk as em with (nolock)\r\n  inner join stokkart as st with (nolock) on st.kod=em.stkod and st.tip=em.stktip\r\n  where em.varno in (select * from CsvToInt_Max(@VARNIN) ) and em.sil=0\r\n  group by em.kdvyuz\r\n\r\n  RETURN\r\n\r\nend"
  },
  {
    "schema": "dbo",
    "name": "UDF_VAR_MUSTAH_ODE_TOPLAM",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_VAR_MUSTAH_ODE_TOPLAM",
    "definition": "CREATE FUNCTION [dbo].UDF_VAR_MUSTAH_ODE_TOPLAM (@VARNIN VARCHAR(max),@TIP VARCHAR(30))\r\nRETURNS\r\n  @TB_TAH_ODE_TOPLAM TABLE (\r\n    CARI_TIP    VARCHAR(20)  COLLATE Turkish_CI_AS,\r\n    CARI_KOD     VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    CARI_ADI     VARCHAR(150) COLLATE Turkish_CI_AS,\r\n    CARI_GRUP    VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    GIREN         FLOAT,\r\n    CIKAN         FLOAT,\r\n    BELGENO       VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    ACIKLAMA      VARCHAR(100) COLLATE Turkish_CI_AS,\r\n    ISLEM         VARCHAR(50) COLLATE Turkish_CI_AS)\r\nAS\r\nBEGIN\r\n \r\n\r\n  INSERT @TB_TAH_ODE_TOPLAM (CARI_TIP,CARI_KOD,CARI_ADI,CARI_GRUP,GIREN,CIKAN,\r\n  BELGENO,ACIKLAMA,ISLEM)\r\n  select h.cartip,h.carkod,ck.unvan,gp.ad,(h.giren),(h.cikan),\r\n  h.belno,h.ack,h.islmhrkad\r\n  FROM  kasahrk as h with (nolock)\r\n  inner join carikart as ck with (nolock) on ck.kod=h.carkod and h.cartip='carikart'\r\n  inner join grup as gp with (nolock) on gp.id=ck.grp1\r\n  where h.varno in (select * from dbo.CsvToInt_Max(@VARNIN)) \r\n  and h.sil=0 and h.yertip=@TIP\r\n\r\n\r\n  RETURN\r\n\r\nend"
  },
  {
    "schema": "dbo",
    "name": "UDF_VAR_NAK_TES_HRK",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_VAR_NAK_TES_HRK",
    "definition": "CREATE FUNCTION [dbo].[UDF_VAR_NAK_TES_HRK] \r\n(@VARNIN VARCHAR(8000),@TIP VARCHAR(30))\r\nRETURNS\r\n  @TB_NAK_TES_HRK TABLE (\r\n    PER_KODU            VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    PER_UNVAN     \t\tVARCHAR(150) COLLATE Turkish_CI_AS,\r\n    PARABRIM\t\t\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n    TLTUTAR        \t    FLOAT,\r\n    KUR        \t\t\tFLOAT,\r\n    TUTAR               FLOAT,\r\n    ACIKLAMA         \tVARCHAR(150) )\r\nAS\r\nBEGIN\r\n \r\n  \r\n   insert into @TB_NAK_TES_HRK\r\n   SELECT  P.perkod AS PER_KODU,s.ad+' '+s.soyad AS PER_UNVAN,\r\n    p.parabrm as PARABRIM,\r\n    (p.kur*p.giren) AS TLTUTAR,(P.kur) AS KUR,(P.giren) AS TUTAR,\r\n    p.ack ACIKLAMA FROM kasahrk AS P INNER JOIN perkart AS S ON \r\n    (P.perkod=S.kod and P.varno in  (select * from CsvToInt(@VARNIN)) \r\n    and p.sil=0 and yertip=@TIP and islmhrk='TES') \r\n \r\n \r\n    \r\n   \r\n  RETURN\r\n\r\nend"
  },
  {
    "schema": "dbo",
    "name": "UDF_VAR_NAKIT_STOK_GRUP",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_VAR_NAKIT_STOK_GRUP",
    "definition": "CREATE FUNCTION [dbo].[UDF_VAR_NAKIT_STOK_GRUP] \r\n(@VARNIN VARCHAR(max),@TIP VARCHAR(30))\r\nRETURNS\r\n  @TB_VAR_NAK_HRK TABLE (\r\n    CARI_TIP        VARCHAR(20)  COLLATE Turkish_CI_AS,\r\n    CARI_KOD        VARCHAR(50)  COLLATE Turkish_CI_AS,\r\n    CARI_ADI        VARCHAR(150)  COLLATE Turkish_CI_AS,\r\n    CARI_GRUP       VARCHAR(70)  COLLATE Turkish_CI_AS,\r\n    STOK_TIP        VARCHAR(20)  COLLATE Turkish_CI_AS,\r\n    STOK_KOD        VARCHAR(20)  COLLATE Turkish_CI_AS,\r\n    STOK_AD         VARCHAR(100)  COLLATE Turkish_CI_AS,\r\n    MIKTAR          FLOAT,\r\n    BRMFIYATKDVSIZ  FLOAT,\r\n    BRMFIYATKDVLI   FLOAT,\r\n    KDV\t\t\t\tFLOAT,\r\n    KDVTUTAR\t\tFLOAT,\r\n    TUTARKDVSIZ     FLOAT,\r\n    TUTARKDVLI      FLOAT)\r\nAS\r\nBEGIN\r\n\r\n\r\n    DECLARE @TB_NAK_HRK TABLE (\r\n    CARI_TIP        VARCHAR(20)  COLLATE Turkish_CI_AS,\r\n    CARI_KOD        VARCHAR(50)  COLLATE Turkish_CI_AS,\r\n    CARI_ADI        VARCHAR(150)  COLLATE Turkish_CI_AS,\r\n    CARI_GRUP       VARCHAR(70)  COLLATE Turkish_CI_AS,\r\n    STOK_TIP        VARCHAR(20)  COLLATE Turkish_CI_AS,\r\n    STOK_KOD        VARCHAR(20)  COLLATE Turkish_CI_AS,\r\n    STOK_AD         VARCHAR(100)  COLLATE Turkish_CI_AS,\r\n    MIKTAR          FLOAT,\r\n    BRMFIYATKDVSIZ  FLOAT,\r\n    BRMFIYATKDVLI   FLOAT,\r\n    KDV\t\t\t\tFLOAT,\r\n    KDVTUTAR\t\tFLOAT,\r\n    TUTARKDVSIZ     FLOAT,\r\n    TUTARKDVLI      FLOAT)\r\n   \r\n\r\n\r\n\r\n\r\n  \r\n    DECLARE @VARNO \t\t\t\t  int\r\n    DECLARE @STOK_TIP             VARCHAR(10) \r\n    DECLARE @STOK_KOD             VARCHAR(30)\r\n    DECLARE @STOK_KDVYUZ          FLOAT\r\n    DECLARE @STOK_MIKTAR          FLOAT\r\n    DECLARE @STOK_BRMKDVLI\t\t  FLOAT\r\n    DECLARE @STOK_BRMKDVSIZ\t\t  FLOAT\r\n    DECLARE @STOK_TUTARKDVLI\t  FLOAT\r\n    DECLARE @STOK_TUTARKDVSIZ\t  FLOAT\r\n\r\n\r\n    DECLARE @CAR_TIP             VARCHAR(30) \r\n    DECLARE @CAR_KOD             VARCHAR(50) \r\n   \r\n   \r\n\r\n     set @CAR_TIP='carikart'\r\n     SELECT @CAR_KOD=zrap_carkod FROM sistemtanim\r\n\r\n\r\n\r\n\r\n   DECLARE VARDI_STOK CURSOR FAST_FORWARD FOR\r\n    SELECT p.varno,ps.stktip,ps.stkod,max(ps.kdvyuz),\r\n     sum(ps.satmik),sum(ps.tutar)\r\n     from pomvardimas as p with (nolock)\r\n     inner join pomvardisayac as ps with (nolock)\r\n      on ps.varno=p.varno and p.sil=0 \r\n      and  p.varno in (select * from CsvToInt_Max(@VARNIN) )\r\n      group by p.varno,ps.stktip,ps.stkod \r\n      order by p.varno\r\n     OPEN  VARDI_STOK\r\n      FETCH NEXT FROM VARDI_STOK INTO\r\n       @VARNO,@STOK_TIP,@STOK_KOD,@STOK_KDVYUZ,\r\n       @STOK_MIKTAR,@STOK_TUTARKDVLI\r\n       WHILE @@FETCH_STATUS = 0\r\n        BEGIN  \r\n\r\n\r\n     declare @GEC_STOK_MIKTAR      FLOAT\r\n     declare @GEC_STOK_TUTAR       FLOAT\r\n\r\n     set @GEC_STOK_MIKTAR=0\r\n     set @GEC_STOK_TUTAR=0\r\n\r\n     select @GEC_STOK_MIKTAR=sum(h.mik),\r\n     @GEC_STOK_TUTAR=sum(h.mik*(h.brmfiy-(h.fiyfarktop+h.vadfarktop)))\r\n     from veresimas as  m   with (nolock) \r\n     inner join veresihrk as h  with (nolock)\r\n     on m.verid=h.verid and m.sil=h.sil and m.sil=0\r\n     and h.stktip=@STOK_TIP and h.stkod=@STOK_KOD\r\n     and m.yertip='pomvardimas' and m.varno=@VARNO\r\n     group by m.varno,h.stktip,h.stkod\r\n     \r\n     \r\n      set @STOK_MIKTAR=@STOK_MIKTAR-@GEC_STOK_MIKTAR\r\n      set @STOK_TUTARKDVLI=@STOK_TUTARKDVLI-@GEC_STOK_TUTAR\r\n     \r\n     \r\n      SET @STOK_BRMKDVLI=0\r\n      SET @STOK_BRMKDVSIZ=0\r\n     \r\n     \r\n     if @STOK_MIKTAR<>0\r\n      begin\r\n       SET @STOK_BRMKDVLI=@STOK_TUTARKDVLI/@STOK_MIKTAR\r\n       SET @STOK_BRMKDVSIZ=@STOK_BRMKDVLI/(1+@STOK_KDVYUZ) \r\n      end \r\n     \r\n     SET @STOK_TUTARKDVSIZ=@STOK_BRMKDVSIZ*@STOK_MIKTAR \r\n     \r\n     \r\n     insert into @TB_NAK_HRK \r\n      (CARI_TIP,CARI_KOD,STOK_TIP,STOK_KOD,\r\n      KDV,MIKTAR,BRMFIYATKDVLI,\r\n      BRMFIYATKDVSIZ,TUTARKDVLI,\r\n      TUTARKDVSIZ,KDVTUTAR)\r\n      values \r\n      (@CAR_TIP,@CAR_KOD,@STOK_TIP,@STOK_KOD,\r\n      @STOK_KDVYUZ*100,@STOK_MIKTAR,@STOK_BRMKDVLI,\r\n      @STOK_BRMKDVSIZ,@STOK_TUTARKDVLI,\r\n      @STOK_TUTARKDVSIZ,@STOK_TUTARKDVLI-@STOK_TUTARKDVSIZ) \r\n\r\n\r\n     FETCH NEXT FROM VARDI_STOK INTO\r\n       @VARNO,@STOK_TIP,@STOK_KOD,@STOK_KDVYUZ,\r\n       @STOK_MIKTAR,@STOK_TUTARKDVLI\r\n\r\n   END\r\n   \r\n     CLOSE VARDI_STOK\r\n     DEALLOCATE VARDI_STOK \r\n  \r\n   \r\n     delete from @TB_NAK_HRK where MIKTAR=0\r\n    \r\n    \r\n  \r\n     insert into @TB_VAR_NAK_HRK \r\n      (CARI_TIP,CARI_KOD,STOK_TIP,STOK_KOD,\r\n      KDV,MIKTAR,BRMFIYATKDVLI,\r\n      BRMFIYATKDVSIZ,TUTARKDVLI,\r\n      TUTARKDVSIZ,KDVTUTAR) \r\n      select \r\n      CARI_TIP,CARI_KOD,STOK_TIP,STOK_KOD,\r\n      KDV,sum(MIKTAR),\r\n      case when SUM(MIKTAR)<>0 then \r\n      SUM(TUTARKDVLI)/SUM(MIKTAR) else 0 end,\r\n      case when SUM(MIKTAR)<>0 then \r\n      SUM(TUTARKDVSIZ)/SUM(MIKTAR) else 0 end,\r\n      SUM(TUTARKDVLI),\r\n      SUM(TUTARKDVSIZ),\r\n      SUM(KDVTUTAR)\r\n      FROM @TB_NAK_HRK\r\n      GROUP BY \r\n      CARI_TIP,CARI_KOD,STOK_TIP,\r\n      STOK_KOD,\r\n      KDV\r\n      \r\n      \r\n      \r\n     UPDATE @TB_VAR_NAK_HRK \r\n     SET CARI_ADI=DT.AD,\r\n     CARI_GRUP=DT.grupad1\r\n     FROM @TB_VAR_NAK_HRK AS T \r\n     join (select kod,cartp,ad,grupad1 from Genel_Kart )\r\n     dt on dt.kod=t.CARI_KOD and dt.cartp=t.CARI_TIP\r\n   \r\n   \r\n     UPDATE @TB_VAR_NAK_HRK set \r\n     STOK_AD=dt.AD\r\n     from @TB_VAR_NAK_HRK t join\r\n     (select sk.tip,sk.kod,sk.ad from gelgidlistok as sk) dt\r\n     on dt.tip=t.STOK_TIP and dt.kod=t.STOK_KOD\r\n   \r\n    \r\n    \r\n  \r\n  RETURN\r\n\r\nend"
  },
  {
    "schema": "dbo",
    "name": "UDF_VAR_NAKIT_TES",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_VAR_NAKIT_TES",
    "definition": "CREATE FUNCTION [dbo].[UDF_VAR_NAKIT_TES] \r\n(@VARNIN VARCHAR(8000),@TIP VARCHAR(30))\r\nRETURNS\r\n  @TB_NAKIT_TES TABLE (\r\n    KASKOD              VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    KASAAD     \t\t\tVARCHAR(100) COLLATE Turkish_CI_AS,\r\n    PARABRIM\t\t\tVARCHAR(30) COLLATE Turkish_CI_AS,\r\n    YTLTUTAR        \tFLOAT,\r\n    KUR             \tFLOAT,\r\n    TUTAR        \t\tFLOAT)\r\nAS\r\nBEGIN\r\n \r\n   insert into @TB_NAKIT_TES\r\n   SELECT  P.kaskod,S.ad,p.parabrm,\r\n      sum(p.kur*p.giren),avg(P.kur),\r\n      sum(P.giren) \r\n      FROM  kasahrk AS P INNER JOIN kasakart AS S ON \r\n       (P.kaskod=S.kod and p.varno in (select * from CsvToInt(@VARNIN))\r\n       and p.sil=0 and \r\n       yertip=@TIP and islmhrk='TES') \r\n       group by P.kaskod,S.ad,p.parabrm \r\n   \r\n\r\n\r\n  RETURN\r\n\r\nend"
  },
  {
    "schema": "dbo",
    "name": "UDF_VAR_PER_ARAC",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_VAR_PER_ARAC",
    "definition": "CREATE FUNCTION [dbo].[UDF_VAR_PER_ARAC]\r\n(@FIRMANO     INT,\r\n@VARIN        VARCHAR(8000))\r\nRETURNS\r\n    @TB_VAR_PER_ARAC TABLE (\r\n    MINTAR\t\t\t\tDATETIME,\r\n    MAXTAR\t\t\t\tDATETIME,\r\n    PER_KOD\t\t\t\tVARCHAR(30),\r\n    PER_UNVAN\t\t\tVARCHAR(100),\r\n    LITRE\t\t      \tFLOAT,\r\n    TUTAR\t\t\t\tFLOAT,\r\n    ARAC_SAYI          \tFLOAT,\r\n    PER_SAYI\t\t\tINT,\r\n    ORT_LITRE\t\t\tFLOAT,\r\n    ORT_ARAC\t\t\tFLOAT,\r\n    ORT_TUTAR\t\t\tFLOAT,\r\n    TAG\t\t\t\t\tINT)\r\nAS\r\nBEGIN\r\n   \r\n\r\n  declare @PERSAYI    FLOAT\r\n  declare @LITRE   FLOAT\r\n  declare @ARAC   FLOAT\r\n  declare @TUTAR   FLOAT\r\n  declare @TOP_ARAC  FLOAT\r\n  DECLARE @TOP_LT    FLOAT\r\n  DECLARE @TOP_TUT   FLOAT\r\n\r\n\r\n  declare @OT_ARAC  FLOAT\r\n  DECLARE @OT_LT    FLOAT\r\n  DECLARE @OT_TUT   FLOAT\r\n\r\n\r\n\r\n    \r\n   INSERT @TB_VAR_PER_ARAC (MINTAR,MAXTAR,\r\n   PER_KOD,LITRE,TUTAR,ARAC_SAYI,TAG,\r\n   PER_SAYI,ORT_LITRE,ORT_ARAC,ORT_TUTAR)\r\n   select min(tarih),\r\n    max(tarih),ot.perkod,\r\n    round( sum(ot.miktar),3),\r\n   round( sum(ot.tutar),3),\r\n   count(ot.miktar),max(ot.tag),\r\n   0,0,0,0\r\n   FROM  otomasoku as ot\r\n   where varno in (select * from CsvToInt(@VARIN))\r\n   group by ot.perkod\r\n   \r\n   select @LITRE=sum(LITRE),\r\n   @ARAC=sum(ARAC_SAYI),\r\n   @TUTAR=sum(TUTAR)\r\n   FROM @TB_VAR_PER_ARAC \r\n   \r\n   SELECT \r\n   @PERSAYI=COUNT(DISTINCT(PER_KOD))\r\n   FROM @TB_VAR_PER_ARAC where Tag=0\r\n   \r\n   SELECT\r\n   @TOP_ARAC=isnull(sum(ARAC_SAYI),0),\r\n   @TOP_LT=isnull(sum(LITRE),0),\r\n   @TOP_TUT=isnull(SUM(TUTAR),0)\r\n    FROM @TB_VAR_PER_ARAC \r\n      \r\n   \r\n   SELECT\r\n   @OT_ARAC=isnull(sum(ARAC_SAYI),0),\r\n   @OT_LT=isnull(sum(LITRE),0),\r\n   @OT_TUT=isnull(SUM(TUTAR),0)\r\n    FROM @TB_VAR_PER_ARAC where tag>0\r\n   \r\n   \r\n   \r\n   UPDATE @TB_VAR_PER_ARAC set \r\n   LITRE=LITRE+CASE WHEN @PERSAYI>0 THEN \r\n   round(@OT_LT/@PERSAYI,1) ELSE 0 END,\r\n   ARAC_SAYI=ARAC_SAYI+case when (@PERSAYI)>0 THEN \r\n   (round((@OT_ARAC)/@PERSAYI,1)) else 0 end,\r\n   TUTAR=TUTAR+case when @PERSAYI>0 THEN \r\n   round(@OT_TUT/@PERSAYI,2) else 0 end\r\n   WHERE TAG=0\r\n   \r\n   \r\n  \r\n   \r\n  \r\n  /*  \r\n   update @TB_VAR_PER_ARAC set\r\n   PER_SAYI=@PERSAYI,\r\n   ORT_LITRE=CASE WHEN @PERSAYI>0 THEN \r\n   round(LT/@PERSAYI,1)+round((@OT_LT/@PERSAYI),1) ELSE 0 END,\r\n   ORT_ARAC=case when (@PERSAYI)>0 THEN \r\n   (round((A_SAY)/@PERSAYI,1))+round((@OT_ARAC/@PERSAYI),1) else 0 end,\r\n   ORT_TUTAR=case when @PERSAYI>0 THEN \r\n   round(TUT/@PERSAYI,2)+round((@OT_ARAC/@PERSAYI),1) else 0 end\r\n   FROM @TB_VAR_PER_ARAC T JOIN\r\n   (SELECT PER_KOD,\r\n   sum(LITRE) LT,\r\n   sum(ARAC_SAYI) A_SAY,\r\n   sum(TUTAR) TUT   FROM @TB_VAR_PER_ARAC\r\n   where Tag=0\r\n   GROUP BY PER_KOD ) DT\r\n   ON DT.PER_KOD=T.PER_KOD\r\n   \r\n  */\r\n  \r\n   \r\n \r\n     \r\n   \r\n   UPDATE @TB_VAR_PER_ARAC set \r\n   PER_SAYI=@PERSAYI,\r\n   ORT_LITRE=CASE WHEN @PERSAYI>0 THEN \r\n   round(@TOP_LT/@PERSAYI,1) ELSE 0 END,\r\n   ORT_ARAC=case when (@PERSAYI)>0 THEN \r\n   (round((@TOP_ARAC)/@PERSAYI,1)) else 0 end,\r\n   ORT_TUTAR=case when @PERSAYI>0 THEN \r\n   round(@TOP_TUT/@PERSAYI,2) else 0 end,\r\n   \r\n   \r\n   PER_UNVAN=dt.unvan from \r\n   @TB_VAR_PER_ARAC as t join \r\n   (select kod,ad+' '+soyad as unvan from perkart) dt\r\n   on dt.kod=t.PER_KOD\r\n   \r\n   \r\n   return\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_VAR_PERTAH_ODE_TOPLAM",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_VAR_PERTAH_ODE_TOPLAM",
    "definition": "CREATE FUNCTION [dbo].UDF_VAR_PERTAH_ODE_TOPLAM (@VARNIN VARCHAR(max),@TIP VARCHAR(30))\r\nRETURNS\r\n  @TB_TAH_ODE_TOPLAM TABLE (\r\n    CARI_TIP    VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    CARI_KOD     VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    CARI_ADI     VARCHAR(150) COLLATE Turkish_CI_AS,\r\n    CARI_GRUP    VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    GIREN         FLOAT,\r\n    CIKAN         FLOAT,\r\n    BELGENO       VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    ACIKLAMA      VARCHAR(100) COLLATE Turkish_CI_AS,\r\n    ISLEM         VARCHAR(50) COLLATE Turkish_CI_AS)\r\nAS\r\nBEGIN\r\n \r\n\r\n  INSERT @TB_TAH_ODE_TOPLAM (CARI_TIP,CARI_KOD,CARI_ADI,CARI_GRUP,GIREN,CIKAN,\r\n  BELGENO,ACIKLAMA,ISLEM)\r\n  select h.cartip,h.carkod,ck.ad+' '+ck.soyad,gp.ad,(h.giren),(h.cikan),\r\n  h.belno,h.ack,h.islmhrkad\r\n  FROM  kasahrk as h with (nolock)\r\n  inner join perkart as ck with (nolock) on ck.kod=h.carkod and h.cartip='perkart'\r\n  inner join grup as gp with (nolock) on gp.id=ck.grp1\r\n  where h.varno in (select * from dbo.CsvToInt_Max(@VARNIN))\r\n  and h.sil=0 and h.yertip=@TIP\r\n  \r\n  \r\n  \r\n  \r\n  INSERT @TB_TAH_ODE_TOPLAM (CARI_TIP,CARI_KOD,CARI_ADI,CARI_GRUP,GIREN,CIKAN,\r\n  BELGENO,ACIKLAMA,ISLEM)\r\n  select h.cartip,h.carkod,ck.ad+' '+ck.soyad,gp.ad,\r\n  (h.borc),(h.alacak),\r\n  h.belno,h.ack,h.islmhrkad\r\n  FROM  bankahrk as h with (nolock)\r\n  inner join perkart as ck with (nolock) on ck.kod=h.carkod and h.cartip='perkart'\r\n  inner join grup as gp with (nolock) on gp.id=ck.grp1\r\n  where h.varno in (select * from dbo.CsvToInt_Max(@VARNIN))\r\n  and h.sil=0 and h.yertip=@TIP\r\n\r\n  \r\n  \r\n  \r\n  \r\n\r\n  RETURN\r\n\r\nend"
  },
  {
    "schema": "dbo",
    "name": "UDF_VAR_PERTESLIMAT_TOPLAM",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_VAR_PERTESLIMAT_TOPLAM",
    "definition": "CREATE FUNCTION [dbo].UDF_VAR_PERTESLIMAT_TOPLAM \r\n(@VARNIN VARCHAR(max),\r\n@TIP VARCHAR(30))\r\nRETURNS\r\n  @TB_TAH_ODE_TOPLAM TABLE (\r\n    CARI_KOD        VARCHAR(20)  COLLATE Turkish_CI_AS,\r\n    CARI_ADI        VARCHAR(150)  COLLATE Turkish_CI_AS,\r\n    CARI_GRUP       VARCHAR(30)  COLLATE Turkish_CI_AS,\r\n    TUTAR           FLOAT,\r\n    DOVIZ_TUTAR     FLOAT,\r\n    KUR             FLOAT,\r\n    PARABIRIM       VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    KASA_KOD        VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    KASA_AD         VARCHAR(40) COLLATE Turkish_CI_AS)\r\nAS\r\nBEGIN\r\n\r\n  INSERT @TB_TAH_ODE_TOPLAM (CARI_KOD,CARI_ADI,CARI_GRUP,\r\n  TUTAR,DOVIZ_TUTAR,\r\n  KUR,PARABIRIM,KASA_KOD,KASA_AD)\r\n  select h.perkod,ck.ad+' '+ck.soyad,gp.ad,\r\n  sum(h.giren*h.kur),sum(h.giren),\r\n  case when sum(h.giren*h.kur)>0 then \r\n   (sum(h.giren*h.kur)/sum(h.giren))\r\n   else avg(h.kur) end,\r\n   kk.parabrm,kk.kod,kk.ad\r\n  FROM  kasahrk as h with (nolock)\r\n  inner join perkart as ck with (nolock) on ck.kod=h.perkod\r\n  inner join kasakart as kk with (nolock) on kk.kod=h.kaskod\r\n  inner join grup as gp with (nolock) on gp.id=ck.grp1\r\n  where h.varno in (select * from CsvToInt_Max(@VARNIN) ) \r\n  and h.islmhrk='TES' and h.masterid=0 and h.sil=0 and h.yertip=@TIP\r\n  group by h.perkod,ck.ad+' '+ck.soyad,gp.ad,kk.parabrm,kk.kod,kk.ad\r\n\r\n\r\n\r\n\r\n  RETURN\r\n\r\nend"
  },
  {
    "schema": "dbo",
    "name": "UDF_VAR_POS",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_VAR_POS",
    "definition": "CREATE FUNCTION [dbo].[UDF_VAR_POS] \r\n(@VARNIN VARCHAR(8000),@TIP VARCHAR(30))\r\nRETURNS\r\n  @TB_POS TABLE (\r\n    CARIKOD             VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    CARIUNVAN     \t\tVARCHAR(150) COLLATE Turkish_CI_AS,\r\n    POSKOD              VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    POSAD\t\t\t\tVARCHAR(150) COLLATE Turkish_CI_AS,\r\n    BELGENO\t\t\t    VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    ACIKLAMA\t\t\tVARCHAR(150) COLLATE Turkish_CI_AS,\r\n    YTLTUTAR        \tFLOAT,\r\n    KOMISYON            FLOAT,\r\n    HESGECTUTAR\t\t\tFLOAT,\r\n    VADETARIHI          DATETIME,\r\n    KUR        \t\t\tFLOAT )\r\nAS\r\nBEGIN\r\n \r\n  \r\n   insert into @TB_POS\r\n    SELECT P.carkod AS CARIKOD,S.ad AS CARIUNVAN,\r\n     P.poskod AS POSKOD,T.AD AS POSAD,\r\n     p.belno as BELGENO,P.ack AS ACIKLAMA,\r\n     p.giren AS YTLTUTAR,\r\n     ((P.giren*P.bankomyuz)+((P.giren*P.bankomyuz)*P.extrakomyuz)+(P.giren*P.ekkomyuz)) AS KOMISYON,\r\n     P.giren-((P.giren*P.bankomyuz)+((P.giren*P.bankomyuz)*P.extrakomyuz)+(P.giren*P.ekkomyuz)) as HESGECTUTAR,\r\n     P.VADETAR AS VADETARIHI,P.kur AS KUR FROM \r\n     poshrk AS P inner join poskart T on p.poskod=T.kod \r\n     left JOIN Genel_Kart AS S \r\n     ON P.carkod=S.kod and s.cartp=p.cartip \r\n     where p.sil=0 \r\n     and P.varno in  (select * from CsvToInt(@VARNIN)) \r\n     and yertip=@TIP order by p.poskod \r\n\r\n \r\n   \r\n \r\n    \r\n   \r\n  RETURN\r\n\r\nend"
  },
  {
    "schema": "dbo",
    "name": "UDF_VAR_POS_GRP",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_VAR_POS_GRP",
    "definition": "CREATE FUNCTION [dbo].[UDF_VAR_POS_GRP] \r\n(@VARNIN VARCHAR(8000),@TIP VARCHAR(30))\r\nRETURNS\r\n  @TB_POS_GRP TABLE (\r\n    CARIKOD             VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    CARIUNVAN     \t\tVARCHAR(150) COLLATE Turkish_CI_AS,\r\n    POSKOD              VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    POSAD\t\t\t\tVARCHAR(150) COLLATE Turkish_CI_AS,\r\n    BELGENO\t\t\t    VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    ACIKLAMA\t\t\tVARCHAR(150) COLLATE Turkish_CI_AS,\r\n    YTLTUTAR        \tFLOAT,\r\n    KOMISYON            FLOAT,\r\n    HESGECTUTAR\t\t\tFLOAT,\r\n    VADETARIHI          DATETIME,\r\n    KUR        \t\t\tFLOAT )\r\nAS\r\nBEGIN\r\n \r\n  \r\n   insert into @TB_POS_GRP\r\n     SELECT ('-') AS CARIKOD,('-') AS CARIUNVAN,\r\n      P.poskod AS POSKOD,T.AD AS POSAD,\r\n      ('-') as BELGENO,('-') AS ACIKLAMA,\r\n      sum(p.giren) AS YTLTUTAR,\r\n      sum((P.giren*P.bankomyuz)+((P.giren*P.bankomyuz)*P.extrakomyuz)+(P.giren*P.ekkomyuz)) AS KOMISYON,\r\n      sum(P.giren-((P.giren*P.bankomyuz)+((P.giren*P.bankomyuz)*P.extrakomyuz)+(P.giren*P.ekkomyuz))) as HESGECTUTAR,\r\n      min(P.VADETAR) AS VADETARIHI,max(P.kur) AS KUR FROM \r\n      poshrk AS P inner join poskart T on p.poskod=T.kod where p.sil=0 \r\n      and P.varno in  (select * from CsvToInt(@VARNIN))\r\n      and yertip=@TIP\r\n      group by P.poskod,T.AD\r\n     \r\n     \r\n\r\n \r\n   \r\n \r\n    \r\n   \r\n  RETURN\r\n\r\nend"
  },
  {
    "schema": "dbo",
    "name": "UDF_VAR_POS_GRUP_TOPLAM",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_VAR_POS_GRUP_TOPLAM",
    "definition": "CREATE FUNCTION [dbo].UDF_VAR_POS_GRUP_TOPLAM (@VARNIN VARCHAR(max),@TIP VARCHAR(30))\r\nRETURNS\r\n  @TB_TAH_ODE_TOPLAM TABLE (\r\n    BANKA_KOD    VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    BANKA_AD    VARCHAR(100)  COLLATE Turkish_CI_AS,\r\n    POS_KOD     VARCHAR(30)  COLLATE Turkish_CI_AS,\r\n    POS_ADI     VARCHAR(100)  COLLATE Turkish_CI_AS,\r\n    POSTUTAR    FLOAT,\r\n    KOMISYONTUTAR FLOAT,\r\n    HESGECTUTAR   FLOAT)\r\nAS\r\nBEGIN\r\n \r\n  if @TIP='pomvardimas'\r\n  begin\r\n  INSERT @TB_TAH_ODE_TOPLAM\r\n  (BANKA_KOD,BANKA_AD,POS_KOD,POS_ADI,POSTUTAR,KOMISYONTUTAR,\r\n  HESGECTUTAR)\r\n  select h.bankod,bk.ad,h.poskod,pk.ad,SUM(h.giren),\r\n  SUM((h.giren*h.bankomyuz)+((h.giren*h.bankomyuz)*h.extrakomyuz)+(h.giren*h.ekkomyuz)),\r\n  SUM(h.giren-((h.giren*h.bankomyuz)+((h.giren*h.bankomyuz)*h.extrakomyuz)+(h.giren*h.ekkomyuz)))\r\n  FROM  poshrk as h with (nolock)\r\n  inner join poskart as pk  with (nolock) on pk.kod=h.poskod\r\n  inner join pomvardimas as pom with (nolock) on pom.varno=h.varno and pom.sil=0\r\n  left join bankakart as bk with (nolock) on bk.kod=pk.bankod\r\n  where h.varno in (select * from CsvToInt_Max(@VARNIN))\r\n  and h.sil=0 and h.yertip=@TIP\r\n  group by h.bankod,bk.ad,h.poskod,pk.ad\r\n  end\r\n  \r\n\r\n  if @TIP='marvardimas'\r\n  begin\r\n  INSERT @TB_TAH_ODE_TOPLAM (BANKA_KOD,BANKA_AD,POS_KOD,POS_ADI,POSTUTAR,\r\n  KOMISYONTUTAR,HESGECTUTAR)\r\n  select h.bankod,bk.ad,h.poskod,pk.ad,SUM(h.giren),\r\n  sum((h.giren*h.bankomyuz)+((h.giren*h.bankomyuz)*h.extrakomyuz)+(h.giren*h.ekkomyuz)),\r\n  sum(h.giren-((h.giren*h.bankomyuz)+((h.giren*h.bankomyuz)*h.extrakomyuz)+(h.giren*h.ekkomyuz)))\r\n  FROM  poshrk as h\r\n  inner join poskart as pk with (nolock) on pk.kod=h.poskod\r\n  inner join marvardimas as pom with (nolock) on pom.varno=h.varno and pom.sil=0\r\n  left join bankakart as bk with (nolock) on bk.kod=pk.bankod\r\n  where h.varno in (select * from CsvToInt_Max(@VARNIN))\r\n  and h.sil=0 and h.yertip=@TIP\r\n  group by h.bankod,bk.ad,h.poskod,pk.ad\r\n  end\r\n  \r\n  \r\n  \r\n  if @TIP='resvardimas'\r\n  begin\r\n  INSERT @TB_TAH_ODE_TOPLAM (BANKA_KOD,BANKA_AD,POS_KOD,POS_ADI,POSTUTAR,\r\n  KOMISYONTUTAR,HESGECTUTAR)\r\n  select h.bankod,bk.ad,h.poskod,pk.ad,SUM(h.giren),\r\n  sum((h.giren*h.bankomyuz)+((h.giren*h.bankomyuz)*h.extrakomyuz)+(h.giren*h.ekkomyuz)),\r\n  sum(h.giren-((h.giren*h.bankomyuz)+((h.giren*h.bankomyuz)*h.extrakomyuz)+(h.giren*h.ekkomyuz)))\r\n  FROM  poshrk as h with (nolock)\r\n  inner join poskart as pk with (nolock) on pk.kod=h.poskod\r\n  inner join resvardimas as pom with (nolock) on pom.varno=h.varno and pom.sil=0\r\n  left join bankakart as bk with (nolock) on bk.kod=pk.bankod\r\n  where h.varno in (select * from CsvToInt_Max(@VARNIN))\r\n  and h.sil=0 and h.yertip=@TIP\r\n  group by h.bankod,bk.ad,h.poskod,pk.ad\r\n  end;\r\n  \r\n  \r\n  \r\n\r\n  RETURN\r\n\r\nend"
  },
  {
    "schema": "dbo",
    "name": "UDF_VAR_POS_TOPLAM",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_VAR_POS_TOPLAM",
    "definition": "CREATE FUNCTION [dbo].UDF_VAR_POS_TOPLAM (@VARNIN VARCHAR(max),@TIP VARCHAR(30))\r\nRETURNS\r\n  @TB_TAH_ODE_TOPLAM TABLE (\r\n    BANKA_KOD    VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    BANKA_AD    VARCHAR(100)  COLLATE Turkish_CI_AS,\r\n    POS_KOD     VARCHAR(30)  COLLATE Turkish_CI_AS,\r\n    POS_ADI     VARCHAR(100)  COLLATE Turkish_CI_AS,\r\n    POSTUTAR    FLOAT,\r\n    CARI_TIP\t\t   VARCHAR(50)  COLLATE Turkish_CI_AS,\r\n    CARI_KOD\t\t   VARCHAR(50)  COLLATE Turkish_CI_AS,\r\n    CARI_UNVAN\t\t   VARCHAR(200)  COLLATE Turkish_CI_AS,\r\n    CARITUTAR   FLOAT,\r\n    KOMISYONTUTAR FLOAT,\r\n    HESGECTUTAR   FLOAT,\r\n    ISLEM_TARIHI    DATETIME,\r\n    VARDIYAACTAR    DATETIME,\r\n    VARDIYAKAPTAR    DATETIME,\r\n    VADETARIHI       DATETIME,\r\n    BELGENO       VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    ACIKLAMA      VARCHAR(100) COLLATE Turkish_CI_AS,\r\n    ISLEM         VARCHAR(50) COLLATE Turkish_CI_AS)\r\nAS\r\nBEGIN\r\n \r\n\r\n  if @TIP='pomvardimas'\r\n  begin\r\n  INSERT @TB_TAH_ODE_TOPLAM (BANKA_KOD,BANKA_AD,POS_KOD,POS_ADI,POSTUTAR,\r\n  CARI_TIP,CARI_KOD,CARI_UNVAN,CARITUTAR,\r\n  KOMISYONTUTAR,HESGECTUTAR,ISLEM_TARIHI,VARDIYAACTAR,VARDIYAKAPTAR,VADETARIHI,\r\n  BELGENO,ACIKLAMA,ISLEM)\r\n  select h.bankod,bk.ad,h.poskod,pk.ad,h.giren,\r\n  h.cartip,h.carkod,'',\r\n  case when h.carslip=1 then h.giren else 0 end,\r\n  ((h.giren*h.bankomyuz)+((h.giren*h.bankomyuz)*h.extrakomyuz)+(h.giren*h.ekkomyuz)),\r\n  h.giren-((h.giren*h.bankomyuz)+((h.giren*h.bankomyuz)*h.extrakomyuz)+(h.giren*h.ekkomyuz)),\r\n  h.tarih,pom.tarih,pom.kaptar,h.vadetar,\r\n  h.belno,h.ack,h.islmhrkad\r\n  FROM  poshrk as h  with (nolock)\r\n  inner join poskart as pk  with (nolock) on pk.kod=h.poskod\r\n  inner join pomvardimas as pom  with (nolock) on pom.varno=h.varno and pom.sil=0\r\n  left join bankakart as bk  with (nolock) on bk.kod=pk.bankod\r\n  where h.varno in (select * from CsvToInt_Max(@VARNIN)) \r\n  and h.sil=0 and h.yertip=@TIP\r\n  end;\r\n  \r\n  if @TIP='marvardimas'\r\n  begin\r\n  INSERT @TB_TAH_ODE_TOPLAM (BANKA_KOD,BANKA_AD,POS_KOD,POS_ADI,POSTUTAR,\r\n  CARI_TIP,CARI_KOD,CARI_UNVAN,CARITUTAR,\r\n  KOMISYONTUTAR,HESGECTUTAR,ISLEM_TARIHI,VARDIYAACTAR,VARDIYAKAPTAR,VADETARIHI,\r\n  BELGENO,ACIKLAMA,ISLEM)\r\n  select h.bankod,bk.ad,h.poskod,pk.ad,h.giren,\r\n  h.cartip,h.carkod,'',\r\n  case when h.carslip=1 then h.giren else 0 end,\r\n  ((h.giren*h.bankomyuz)+((h.giren*h.bankomyuz)*h.extrakomyuz)+(h.giren*h.ekkomyuz)),\r\n  h.giren-((h.giren*h.bankomyuz)+((h.giren*h.bankomyuz)*h.extrakomyuz)+(h.giren*h.ekkomyuz)),\r\n  h.tarih,pom.tarih,pom.kaptar,h.vadetar,\r\n  h.belno,h.ack,h.islmhrkad\r\n  FROM  poshrk as h with (nolock)\r\n  inner join poskart as pk  with (nolock) on pk.kod=h.poskod\r\n  inner join marvardimas as pom  with (nolock) on pom.varno=h.varno and pom.sil=0\r\n  left join bankakart as bk  with (nolock) on  bk.kod=pk.bankod\r\n  where h.varno in (select * from CsvToInt_Max(@VARNIN))\r\n  and h.sil=0 and h.yertip=@TIP\r\n  end;\r\n  \r\n    \r\n   update @TB_TAH_ODE_TOPLAM set CARI_UNVAN=DT.UNVAN FROM @TB_TAH_ODE_TOPLAM AS t \r\n   join (select cartip,kod,unvan from Genel_Cari_Kart with (nolock)) dt\r\n   on dt.carTip=t.CARI_TIP and dt.kod=t.CARI_KOD\r\n  \r\n  \r\n\r\n  RETURN\r\n\r\nend"
  },
  {
    "schema": "dbo",
    "name": "UDF_VAR_RESEMTIA_SATIS",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_VAR_RESEMTIA_SATIS",
    "definition": "CREATE FUNCTION [dbo].[UDF_VAR_RESEMTIA_SATIS]\r\n(@VARNIN VARCHAR(4000),@TIP VARCHAR(30))\r\nRETURNS\r\n  @TB_EMTIA_SATIS TABLE (\r\n    STOK_KOD    VARCHAR(20)  COLLATE Turkish_CI_AS,\r\n    STOK_AD     VARCHAR(150) COLLATE Turkish_CI_AS,\r\n    SATISMIKTAR      FLOAT,\r\n    SATISTUTAR        FLOAT,\r\n    IADEMIKTAR        FLOAT,\r\n    IADETUTAR         FLOAT,\r\n    KDV               FLOAT,\r\n    KDVTUTAR          FLOAT,\r\n    BIRIMFIYAT        FLOAT)\r\nAS\r\nBEGIN\r\n  DECLARE @EKSTRE_TEMP TABLE (\r\n    VARNO      FLOAT)\r\n declare @separator char(1)\r\n set @separator = ','\r\n\r\n declare @separator_position int\r\n declare @array_value varchar(1000)\r\n\r\n IF (LEN(RTRIM(@VARNIN)) > 0)\r\n BEGIN\r\n  set @VARNIN = @VARNIN + ','\r\n END\r\n\r\n while patindex('%,%' , @VARNIN) <> 0\r\n begin\r\n\r\n   select @separator_position =  patindex('%,%' , @VARNIN)\r\n   select @array_value = left(@VARNIN, @separator_position - 1)\r\n\r\n  Insert @EKSTRE_TEMP\r\n  Values (Cast(@array_value as float))\r\n  select @VARNIN = stuff(@VARNIN, 1, @separator_position, '')\r\n end\r\n\r\n  INSERT @TB_EMTIA_SATIS (STOK_KOD,STOK_AD,SATISMIKTAR,SATISTUTAR,\r\n  IADEMIKTAR,IADETUTAR,KDV,KDVTUTAR,BIRIMFIYAT)\r\n  select st.kod,st.ad,\r\n  isnull(sum(case when m.Iade=0 then em.miktar else 0 end),0),\r\n  isnull(sum(case when m.Iade=0 then em.miktar*em.birimfiyat*em.kur else 0 end),0),\r\n  isnull(sum(case when m.Iade=1 then em.miktar else 0 end),0),\r\n  isnull(sum(case when m.Iade=1 then em.miktar*em.birimfiyat*em.kur else 0 end),0),\r\n  (em.kdvyuz*100),\r\n  sum( ( ((case when m.Iade=0 then em.miktar else -1*em.miktar end)*em.birimfiyat*em.kur) / (1+em.kdvyuz) )*em.kdvyuz),\r\n  em.birimfiyat\r\n  FROM  ressathrk as em\r\n  inner join ResSatMas as m on m.Id=em.RessatId and m.Sil=0 \r\n  inner join stokkart as st on st.id=em.stkId and st.Tip_id=em.StkTipId\r\n  where em.varno in (select * from @EKSTRE_TEMP) and em.sil=0 \r\n  group by st.kod,st.ad,em.kdvyuz,em.birimfiyat\r\n\r\n  RETURN\r\n\r\nend"
  },
  {
    "schema": "dbo",
    "name": "UDF_VAR_RESKDV_TOPLAM",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_VAR_RESKDV_TOPLAM",
    "definition": "CREATE FUNCTION [dbo].[UDF_VAR_RESKDV_TOPLAM] (\r\n@VARNIN VARCHAR(4000),@TIP VARCHAR(30))\r\nRETURNS\r\n  @TB_EMTIA_SATIS TABLE (\r\n    SATISMIKTAR      FLOAT,\r\n    SATISTUTAR        FLOAT,\r\n    IADEMIKTAR        FLOAT,\r\n    IADETUTAR         FLOAT,\r\n    KDV               FLOAT,\r\n    KDVTUTAR          FLOAT)\r\nAS\r\nBEGIN\r\n  \r\n\r\n  INSERT @TB_EMTIA_SATIS (SATISMIKTAR,SATISTUTAR,\r\n  IADEMIKTAR,IADETUTAR,KDV,KDVTUTAR)\r\n  select \r\n  isnull(sum(case when m.Iade=0 then em.miktar else 0 end),0),\r\n  isnull(sum(case when m.Iade=0 then em.miktar*em.birimfiyat*em.kur else 0 end),0),\r\n  isnull(sum(case when m.Iade=1 then em.miktar else 0 end),0),\r\n  isnull(sum(case when m.Iade=1 then em.miktar*em.birimfiyat*em.kur else 0 end),0),\r\n  (em.kdvyuz*100),sum( ( ((case when m.Iade=0 then em.miktar else\r\n   -1*em.miktar end)*em.birimfiyat*em.kur) / (1+em.kdvyuz) )*em.kdvyuz)\r\n  FROM  ressathrk as em\r\n  inner join  ressatmas as m on m.Id=em.ResSatId and m.Sil=0   \r\n  inner join stokkart as st on st.id=em.stkId and st.tip_id=em.stktipId\r\n  where em.varno in (select * from CsvToInt(@VARNIN) ) and em.sil=0\r\n  group by em.kdvyuz\r\n\r\n  RETURN\r\n\r\nend"
  },
  {
    "schema": "dbo",
    "name": "UDF_VAR_SATISIADE_TOPLAM",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_VAR_SATISIADE_TOPLAM",
    "definition": "CREATE FUNCTION [dbo].UDF_VAR_SATISIADE_TOPLAM (@VARNIN VARCHAR(max),@TIP VARCHAR(30))\r\nRETURNS\r\n  @TB_SATISIADE_TOPLAM TABLE (\r\n    STOK_TIP    VARCHAR(10)  COLLATE Turkish_CI_AS,\r\n    STOK_KOD    VARCHAR(30)  COLLATE Turkish_CI_AS,\r\n    STOK_AD     VARCHAR(100)  COLLATE Turkish_CI_AS,\r\n    STOK_GRUP   VARCHAR(50)  COLLATE Turkish_CI_AS,\r\n    ONCEKIMIKTAR     FLOAT,\r\n    ONCEKITUTAR      FLOAT,\r\n    MALALISMIKTAR    FLOAT,\r\n    MALALISTUTAR     FLOAT,\r\n    SATISMIKTAR      FLOAT,\r\n    SATISTUTAR       FLOAT,\r\n    IADEMIKTAR       FLOAT,\r\n    IADETUTAR        FLOAT,\r\n    DIGERMIKTAR      FLOAT,\r\n    DIGERTUTAR       FLOAT,\r\n    KALANMIKTAR      FLOAT,\r\n    KALANTUTAR       FLOAT)\r\nAS\r\nBEGIN\r\n\r\n\r\n  DECLARE @DEPO_KOD VARCHAR(30)\r\n  DECLARE @STOK_TIP      VARCHAR(20)\r\n  DECLARE @STOK_KOD      VARCHAR(30)\r\n  DECLARE @STOK_AD       VARCHAR(50)\r\n  DECLARE @STOK_GRUP     VARCHAR(50)\r\n  DECLARE @ONCEKIMIKTAR  FLOAT\r\n  DECLARE @ONCEKITUTAR   FLOAT\r\n  DECLARE @MALALISMIKTAR FLOAT\r\n  DECLARE @MALALISTUTAR  FLOAT\r\n  DECLARE @SATISTUTAR    FLOAT\r\n  DECLARE @SATISMIKTAR   FLOAT\r\n  DECLARE @IADEMIKTAR    FLOAT\r\n  DECLARE @IADETUAR      FLOAT\r\n  DECLARE @DIGERMIKTAR   FLOAT\r\n  DECLARE @DIGERTUTAR    FLOAT\r\n  \r\n  DECLARE @KALANMIKTAR   FLOAT\r\n  DECLARE @KALANTUTAR     FLOAT\r\n  \r\n  DECLARE @MINTARIH     DATETIME\r\n  DECLARE @MAXTARIH     DATETIME\r\n\r\n  DECLARE @MINSAAT     VARCHAR(8)\r\n  DECLARE @MAXSAAT     VARCHAR(8)\r\n\r\n\r\n   declare @VarnoSayi    int\r\n   \r\n\r\n  select @VarnoSayi=count(*) from CsvToInt_Max(@VARNIN)\r\n\r\n\r\n/*-- stok son durumları */\r\n  DECLARE @TB_DEP_TARIH TABLE (\r\n    VAR_NO     FLOAT,\r\n    DEP_KOD    VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    STOK_TIP   VARCHAR(10) COLLATE Turkish_CI_AS,\r\n    STOK_KOD   VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    STOK_SAT1FIY    FLOAT,\r\n    MIKTAR     FLOAT,\r\n    TUTAR      FLOAT)\r\n    \r\n  /* INSERT INTO @TB_DEP_TARIH \r\n   SELECT * FROM DBO.DEPO_TARIHLI_STOKIN (@TIP,@VARNIN)\r\n----stok son durumları\r\n*/\r\n   DECLARE @MIN_TARIH   DATETIME\r\n   DECLARE @MAX_TARIH   DATETIME   \r\n   declare @STK_TIP     varchar(20)\r\n   declare @DEP_KOD     varchar(50)\r\n   \r\n   SELECT \r\n   @DEP_KOD=min(mv.depkod),\r\n   @MIN_TARIH=min(cast(mv.tarih as float)+cast(mv.saat as datetime)),\r\n   @MAX_TARIH=max(cast(mv.tarih as float)+cast(mv.saat as datetime))\r\n   FROM marvardimas as mv with (nolock) where sil=0 and \r\n   varno in (select * from CsvToInt_Max(@VARNIN))\r\n   \r\n   \r\n      insert into @TB_DEP_TARIH\r\n       (DEP_KOD,STOK_TIP,STOK_KOD,\r\n       STOK_SAT1FIY,MIKTAR,TUTAR)\r\n       select @DEP_KOD,sk.tip,sk.kod,\r\n       case when sk.sat1kdvtip='Dahil' then sk.sat1fiy\r\n       else sk.sat1fiy*(1+(sk.sat1kdv/100)) end,\r\n       0,0\r\n       from stokkart as sk with (nolock)\r\n       where sk.sil=0 and sk.tip='markt'\r\n\r\n     update @TB_DEP_TARIH set  \r\n      MIKTAR=dt.mik,\r\n      TUTAR=dt.mik*STOK_SAT1FIY  from \r\n      @TB_DEP_TARIH as t\r\n       join (SELECT\r\n       H.DEPKOD,h.stktip,h.stkod,\r\n       ISNULL(SUM(h.giren-h.cikan),0) as mik\r\n       from @TB_DEP_TARIH as dm\r\n       left join stkhrk as h with (nolock) on \r\n       h.stktip=dm.STOK_TIP\r\n       and h.stkod=dm.STOK_KOD and h.sil=0\r\n       AND h.tarih+cast(h.saat as datetime) < @MIN_TARIH \r\n       group by H.DEPKOD,h.stktip,h.stkod)\r\n       dt on \r\n       T.DEP_KOD=dt.DEPKOD and \r\n       t.STOK_TIP=dt.stktip\r\n       and t.STOK_KOD=dt.stkod\r\n\r\n\r\n\r\n \r\n  DECLARE CRS_STOK_HRK CURSOR FAST_FORWARD FOR\r\n    SELECT\r\n       SK.tip,sk.kod,sk.ad,grup.ad,isnull(sum(case when islmtip='satis' then mhk.mik else -1*mhk.mik end),0),\r\n       isnull(sum(case when islmtip='satis' then mhk.mik*((mhk.brmfiy*mhk.kur))\r\n        else -1*mhk.mik*((mhk.brmfiy*mhk.kur)) end),0),\r\n       isnull(sum(case when islmtip='iade' then mhk.mik else 0 end),0),\r\n       isnull(sum(case when islmtip='iade' then mhk.mik*((mhk.brmfiy*mhk.kur)) else 0 end),0),\r\n       isnull(dep.MIKTAR,0),ISNULL(dep.TUTAR,0),\r\n       min(mv.tarih+cast(mv.saat as datetime)),max(mv.kaptar+cast(mv.kapsaat as datetime))\r\n       from marvardimas as mv with (nolock)\r\n       inner join marsathrk as mhk with (nolock) on mhk.varno=mv.varno and mv.sil=0 and mhk.sil=0\r\n       inner join stokkart as sk with (nolock) on sk.kod=mhk.stkod and sk.tip=mhk.stktip\r\n       left join @TB_DEP_TARIH as dep on /*dep.var_no=mv.varno and */\r\n       dep.STOK_TIP=sk.tip and sk.kod=dep.STOK_KOD\r\n       left join grup with (nolock) on grup.id=sk.grp1\r\n       where mv.varno in (select * from CsvToInt_Max(@VARNIN))\r\n       group by SK.tip,sk.kod,sk.ad,grup.ad,dep.MIKTAR,dep.TUTAR\r\n    OPEN CRS_STOK_HRK\r\n\r\n\r\n   FETCH NEXT FROM CRS_STOK_HRK INTO\r\n   @STOK_TIP,@STOK_KOD,@STOK_AD,@STOK_GRUP,@SATISMIKTAR,@SATISTUTAR,@IADEMIKTAR,@IADETUAR,\r\n   @ONCEKIMIKTAR,@ONCEKITUTAR,@MINTARIH,@MAXTARIH\r\n\r\n   WHILE @@FETCH_STATUS = 0\r\n   BEGIN\r\n    \r\n   \r\n    /* if isnull(@varnosayi,0)>0\r\n     begin \r\n      set @ONCEKIMIKTAR=@ONCEKIMIKTAR/isnull(@varnosayi,0)\r\n      set @ONCEKITUTAR= @ONCEKITUTAR/isnull(@varnosayi,0)\r\n     end \r\n     */ \r\n\r\n\r\n   Set @MINSAAT=convert(varchar,@MINTARIH,108);\r\n   set @MINTARIH=convert(varchar,@MINTARIH,101);\r\n   \r\n   Set @MAXSAAT=convert(varchar,@MAXTARIH,108);\r\n   set @MAXTARIH=convert(varchar,@MAXTARIH,101);\r\n\r\n    set @KALANMIKTAR=0\r\n    set @KALANTUTAR=0\r\n    \r\n\r\n\r\n    /*SELECT @ONCEKIMIKTAR=MIKTAR,@ONCEKITUTAR=TUTAR FROM */\r\n    /*dbo.DEPO_TARIHLI_STOK ('',@STOK_TIP,@STOK_KOD,@MINTARIH,@MINSAAT) */\r\n    set @MALALISMIKTAR=0\r\n    set @MALALISTUTAR=0\r\n    set @DIGERMIKTAR=0\r\n    set @DIGERTUTAR=0\r\n    \r\n   /*\r\n     SELECT @MALALISMIKTAR=MIKTAR,@MALALISTUTAR=TUTAR FROM\r\n     dbo.MALALIS_TARIHLI_STOK ('',@STOK_TIP,@STOK_KOD,@MAXTARIH,@MINTARIH,@MINSAAT,@MAXSAAT)\r\n\r\n      SELECT @DIGERMIKTAR=MIKTAR,@DIGERTUTAR=TUTAR FROM\r\n       dbo.MALCIKIS_TARIHLI_STOK ('',@STOK_TIP,@STOK_KOD,@MAXTARIH,@MINTARIH,@MINSAAT,@MAXSAAT)\r\n    */\r\n      SET @KALANMIKTAR=(@ONCEKIMIKTAR+@MALALISMIKTAR)-(@SATISMIKTAR+@DIGERMIKTAR)\r\n      SET @KALANTUTAR=(@ONCEKITUTAR+@MALALISTUTAR)-(@SATISTUTAR+@DIGERTUTAR)\r\n\r\n\r\n\r\n    INSERT @TB_SATISIADE_TOPLAM (STOK_TIP,STOK_KOD,STOK_AD,STOK_GRUP,ONCEKIMIKTAR,ONCEKITUTAR,\r\n    MALALISMIKTAR,MALALISTUTAR,SATISMIKTAR,SATISTUTAR,IADEMIKTAR,IADETUTAR,DIGERMIKTAR,DIGERTUTAR,\r\n    KALANMIKTAR,KALANTUTAR)\r\n    VALUES (@STOK_TIP,@STOK_KOD,@STOK_AD,@STOK_GRUP,@ONCEKIMIKTAR,@ONCEKITUTAR,@MALALISMIKTAR,@MALALISTUTAR,\r\n    @SATISMIKTAR,@SATISTUTAR,@IADEMIKTAR,@IADETUAR,@DIGERMIKTAR,@DIGERTUTAR,@KALANMIKTAR,@KALANTUTAR)\r\n\r\n\r\n      FETCH NEXT FROM CRS_STOK_HRK INTO\r\n     @STOK_TIP,@STOK_KOD,@STOK_AD,@STOK_GRUP,@SATISMIKTAR,@SATISTUTAR,@IADEMIKTAR,@IADETUAR,\r\n     @ONCEKIMIKTAR,@ONCEKITUTAR,@MINTARIH,@MAXTARIH\r\n\r\n\r\n  END\r\n\r\n  CLOSE CRS_STOK_HRK\r\n  DEALLOCATE CRS_STOK_HRK\r\n\r\n\r\n\r\n\r\n  RETURN\r\n\r\nend"
  },
  {
    "schema": "dbo",
    "name": "UDF_VAR_SATISIADEGRUP_TOPLAM",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_VAR_SATISIADEGRUP_TOPLAM",
    "definition": "CREATE FUNCTION UDF_VAR_SATISIADEGRUP_TOPLAM\r\n(@VARNIN VARCHAR(max),@TIP VARCHAR(30))\r\nRETURNS\r\n  @TB_SATISIADE_TOPLAM TABLE (\r\n    STOK_ANAGRUPID   INT,\r\n    STOK_ANAGRUP     VARCHAR(50)  COLLATE Turkish_CI_AS,\r\n    STOK_GRUPID      INT,\r\n    STOK_GRUP        VARCHAR(50)  COLLATE Turkish_CI_AS,\r\n    ONCEKIMIKTAR     FLOAT,\r\n    ONCEKITUTAR      FLOAT,\r\n    SATISMIKTAR      FLOAT,\r\n    SATISTUTAR       FLOAT,\r\n    DIGERGRSMIKTAR   FLOAT,\r\n    DIGERGRSTUTAR    FLOAT,\r\n    DIGERCKSMIKTAR   FLOAT,\r\n    DIGERCKSTUTAR    FLOAT,\r\n    IADEMIKTAR       FLOAT,\r\n    IADETUTAR        FLOAT,\r\n    KALANMIKTAR      FLOAT,\r\n    KALANTUTAR       FLOAT,\r\n    SATISTUTARYUZDE            FLOAT,\r\n    SATISMIKTARYUZDE           FLOAT)\r\nAS\r\nBEGIN\r\n\r\n  DECLARE @DEPO_KOD       VARCHAR(30)\r\n  DECLARE @STOK_GRUP      VARCHAR(50)\r\n  DECLARE @ONCEKIMIKTAR   FLOAT\r\n  DECLARE @ONCEKITUTAR    FLOAT\r\n  DECLARE @MALALISMIKTAR  FLOAT\r\n  DECLARE @MALALISTUTAR   FLOAT\r\n  DECLARE @SATISTUTAR     FLOAT\r\n  DECLARE @SATISMIKTAR    FLOAT\r\n  DECLARE @IADEMIKTAR     FLOAT\r\n  DECLARE @IADETUAR       FLOAT\r\n  DECLARE @DIGERGRSMIKTAR FLOAT\r\n  DECLARE @DIGERCKSMIKTAR FLOAT\r\n\r\n  DECLARE @KALANMIKTAR    FLOAT\r\n  DECLARE @KALANTUTAR     FLOAT\r\n\r\n\r\n  DECLARE @HRK_MINTARIH     DATETIME\r\n  DECLARE @HRK_MAXTARIH     DATETIME\r\n\r\n\r\n    declare @Market_Stok_AltGrup int\r\n  \r\n    select @Market_Stok_AltGrup=isnull(Market_Stok_AltGrup,0) From sistemtanim\r\n\r\n\r\n  DECLARE @TB_GEC_DEP\r\n   TABLE (\r\n    DEPKOD    VARCHAR(50)\r\n   \r\n   )\r\n\r\n\r\n  DECLARE @TB_GEC_STOKLIST\r\n   TABLE (\r\n   GRUPANA_ID    int,\r\n   GRUPANA_AD    VARCHAR(50) COLLATE Turkish_CI_AS,\r\n   GRUP_ID    int,\r\n   GRUP_AD    VARCHAR(50) COLLATE Turkish_CI_AS,\r\n   actarih      datetime,\r\n   kaptarih      datetime,\r\n   depkod     varchar(50),\r\n   STK_TIP    varchar(50),\r\n   STK_KOD    varchar(50),   \r\n   ONCEKIMIKTAR   FLOAT,\r\n   ONCEKITUTAR   FLOAT,\r\n   KALANMIKTAR   FLOAT,\r\n   KALANTUTAR   FLOAT)\r\n\r\n   declare @STK_TIP varchar(20)\r\n   \r\n   SET @STK_TIP='markt'\r\n\r\n   if @TIP='marvardimas'\r\n     begin\r\n     \r\n       insert into @TB_GEC_STOKLIST\r\n       (GRUPANA_ID,GRUPANA_AD,GRUP_ID,GRUP_AD,actarih,kaptarih,\r\n       depkod,STK_TIP,STK_KOD)\r\n       select SK.grp1,'',grp.id,grp.ad,\r\n       min(cast(mv.tarih as float)+cast(mv.saat as datetime)),\r\n       max(cast(mv.kaptar as float)+cast(mv.kapsaat as datetime)),\r\n       mv.depkod,sk.tip,sk.kod\r\n       from marvardimas as mv WITH (NOLOCK)\r\n       left join stokkart as sk WITH (NOLOCK) on sk.tip=@STK_TIP\r\n       left join grup as grp WITH (NOLOCK) on grp.id=\r\n       case when sk.grp3>0 then sk.grp3\r\n       when sk.grp2>0 then sk.grp2\r\n       when sk.grp1>0 then sk.grp1 end \r\n       and grp.sil=0 where mv.sil=0 and mv.varno in (select * from CsvToInt_Max(@VARNIN))\r\n       group by SK.grp1,grp.id,grp.ad,mv.depkod,sk.tip,sk.kod\r\n        \r\n       select  @HRK_MINTARIH=min(actarih),@HRK_MAXTARIH=max(kaptarih) from  @TB_GEC_STOKLIST\r\n      \r\n      /*-onceki stok miktar tutar */\r\n      \r\n      insert into @TB_GEC_DEP (DEPKOD)\r\n      select depkod From @TB_GEC_STOKLIST  group by depkod\r\n      \r\n       \r\n      update @TB_GEC_STOKLIST set ONCEKIMIKTAR=Miktar,\r\n       ONCEKITUTAR=tutar from @TB_GEC_STOKLIST as t join \r\n       ( select sk.tip,sk.kod,ISNULL(SUM(h.giren-h.cikan),0) Miktar,\r\n       ISNULL(SUM((h.giren-h.cikan)*case when sk.sat1kdvtip='Dahil' then sk.sat1fiy ELSE\r\n       sk.sat1fiy*(1+(sk.sat1kdv/100)) end),0) Tutar\r\n       from stokkart as sk WITH (NOLOCK)\r\n       left join stkhrk as h WITH (NOLOCK) on h.stktip=sk.tip \r\n       and h.stkod=sk.kod and sk.tip=@STK_TIP and  h.sil=0 \r\n       AND  (h.tarih+cast(h.saat as datetime))<@HRK_MINTARIH\r\n       /*and  h.depkod in ('M0001') */\r\n       and  h.depkod in (select DEPKOD From @TB_GEC_DEP)\r\n       group by sk.tip,sk.kod) dt on t.STK_TIP=dt.tip and t.STK_KOD=kod\r\n      \r\n      \r\n       /*-kalan stok miktar tutar */\r\n       update @TB_GEC_STOKLIST set KALANMIKTAR=Miktar,\r\n       KALANTUTAR=tutar from @TB_GEC_STOKLIST as t join \r\n       ( select sk.tip,sk.kod,ISNULL(SUM(h.giren-h.cikan),0) Miktar,\r\n       ISNULL(SUM((h.giren-h.cikan)*case when sk.sat1kdvtip='Dahil' then sk.sat1fiy ELSE\r\n       sk.sat1fiy*(1+(sk.sat1kdv/100)) end),0) Tutar\r\n       from stokkart as sk WITH (NOLOCK)\r\n       left join stkhrk as h WITH (NOLOCK) on h.stktip=sk.tip \r\n       and h.stkod=sk.kod and sk.tip=@STK_TIP  and h.sil=0 \r\n       AND  (h.tarih+cast(h.saat as datetime))<@HRK_MAXTARIH\r\n      /* and  h.depkod in ('M0001' ) */\r\n       and  h.depkod in (select DEPKOD From @TB_GEC_DEP  )\r\n       group by sk.tip,sk.kod) dt on t.STK_TIP=dt.tip and t.STK_KOD=kod\r\n       \r\n     \r\n      if @Market_Stok_AltGrup=0    \r\n      INSERT @TB_SATISIADE_TOPLAM (\r\n      STOK_ANAGRUPID,STOK_ANAGRUP,\r\n      STOK_GRUPID,STOK_GRUP,ONCEKIMIKTAR,ONCEKITUTAR,\r\n      DIGERGRSMIKTAR,DIGERGRSTUTAR,DIGERCKSMIKTAR,DIGERCKSTUTAR,\r\n      SATISMIKTAR,SATISTUTAR,IADEMIKTAR,IADETUTAR,KALANMIKTAR,KALANTUTAR)\r\n      SELECT DEP.GRUPANA_ID,DEP.GRUPANA_AD,dep.GRUPANA_ID,dep.GRUPANA_AD,\r\n      sum(ONCEKIMIKTAR),sum(ONCEKITUTAR),\r\n      0,0,0,0,0,0,0,0,sum(KALANMIKTAR),sum(KALANTUTAR)\r\n      FROM @TB_GEC_STOKLIST as dep\r\n      group by DEP.GRUPANA_ID,DEP.GRUPANA_AD\r\n      ORDER BY DEP.GRUPANA_ID,dep.GRUPANA_AD\r\n      \r\n      if @Market_Stok_AltGrup=1    \r\n      INSERT @TB_SATISIADE_TOPLAM (\r\n      STOK_ANAGRUPID,STOK_ANAGRUP,\r\n      STOK_GRUPID,STOK_GRUP,ONCEKIMIKTAR,ONCEKITUTAR,\r\n      DIGERGRSMIKTAR,DIGERGRSTUTAR,DIGERCKSMIKTAR,DIGERCKSTUTAR,\r\n      SATISMIKTAR,SATISTUTAR,IADEMIKTAR,IADETUTAR,KALANMIKTAR,KALANTUTAR)\r\n      SELECT DEP.GRUPANA_ID,DEP.GRUPANA_AD,dep.GRUP_ID,dep.GRUP_AD,\r\n      sum(ONCEKIMIKTAR),sum(ONCEKITUTAR),\r\n      0,0,0,0,0,0,0,0,sum(KALANMIKTAR),sum(KALANTUTAR)\r\n      FROM @TB_GEC_STOKLIST as dep\r\n      group by DEP.GRUPANA_ID,DEP.GRUPANA_AD,DEP.GRUP_ID,DEP.GRUP_AD\r\n      ORDER BY DEP.GRUPANA_ID,DEP.GRUPANA_AD,DEP.GRUP_ID,dep.GRUP_AD\r\n     \r\n     \r\n       UPDATE @TB_SATISIADE_TOPLAM SET STOK_ANAGRUP=dt.ad\r\n       from @TB_SATISIADE_TOPLAM as t join (select * from grup ) dt on \r\n       dt.id=t.STOK_ANAGRUPID\r\n      \r\n        UPDATE @TB_SATISIADE_TOPLAM SET STOK_GRUP=dt.ad\r\n       from @TB_SATISIADE_TOPLAM as t join (select * from grup ) dt on \r\n       dt.id=t.STOK_GRUPID\r\n     \r\n     \r\n         \r\n      /*  INSERT @TB_SATISIADE_TOPLAM (\r\n      STOK_ANAGRUPID,STOK_ANAGRUP,\r\n      STOK_GRUPID,STOK_GRUP,ONCEKIMIKTAR,ONCEKITUTAR,\r\n      DIGERGRSMIKTAR,DIGERGRSTUTAR,DIGERCKSMIKTAR,DIGERCKSTUTAR,\r\n      SATISMIKTAR,SATISTUTAR,IADEMIKTAR,IADETUTAR,KALANMIKTAR,KALANTUTAR)\r\n      SELECT DEP.GRUPANA_ID,DEP.GRUPANA_AD,dep.GRUP_ID,dep.GRUP_AD,\r\n      sum(MIKTAR),sum(TUTAR),\r\n      0,0,0,0,0,0,0,0,0,0 \r\n      FROM DBO.DEPO_TARIHLI_GRUP_STOKIN(@TIP,@VARNIN) as dep\r\n      group by DEP.GRUPANA_ID,DEP.GRUPANA_AD,dep.GRUP_ID,dep.GRUP_AD\r\n      ORDER BY DEP.GRUPANA_ID,dep.GRUP_ID\r\n      */\r\n      \r\n      \r\n      if @Market_Stok_AltGrup=0     \r\n      update @TB_SATISIADE_TOPLAM \r\n      set SATISMIKTAR=dt.SATISMIKTAR,\r\n      SATISTUTAR=dt.SATISTUTAR,\r\n      IADEMIKTAR=dt.IADEMIKTAR,\r\n      IADETUTAR=dt.IADETUTAR  \r\n      from @TB_SATISIADE_TOPLAM t join\r\n      (select grpid=sk.grp1,\r\n         isnull(sum(case when islmtip='satis' then mhk.mik else -1*mhk.mik end),0) as SATISMIKTAR,\r\n         isnull(sum(case when islmtip='satis' then mhk.mik*((mhk.brmfiy*mhk.kur))\r\n         else -1*mhk.mik*((mhk.brmfiy*mhk.kur)) end),0) SATISTUTAR ,\r\n         isnull(sum(case when islmtip='iade' then mhk.mik else 0 end),0) IADEMIKTAR,\r\n         isnull(sum(case when islmtip='iade' then mhk.mik*((mhk.brmfiy*mhk.kur))\r\n          else 0 end),0) IADETUTAR from marvardimas as mv   WITH (NOLOCK)\r\n         left join marsathrk as mhk  WITH (NOLOCK) on mhk.varno=mv.varno and mv.sil=0 and mhk.sil=0\r\n         left join stokkart as sk  WITH (NOLOCK) on sk.kod=mhk.stkod and sk.tip=mhk.stktip\r\n         where mv.varno in (select * from CsvToInt_Max(@VARNIN))\r\n         group by sk.grp1) dt on \r\n         dt.grpid=t.STOK_GRUPID\r\n         \r\n         \r\n         \r\n      if @Market_Stok_AltGrup=1     \r\n      update @TB_SATISIADE_TOPLAM \r\n      set SATISMIKTAR=dt.SATISMIKTAR,\r\n      SATISTUTAR=dt.SATISTUTAR,\r\n      IADEMIKTAR=dt.IADEMIKTAR,\r\n      IADETUTAR=dt.IADETUTAR  \r\n      from @TB_SATISIADE_TOPLAM t join\r\n      (select grpid=case \r\n      when sk.grp3>0 then sk.grp3 \r\n      when sk.grp2>0 then sk.grp2\r\n      when sk.grp1>0 then sk.grp1 end,\r\n         isnull(sum(case when islmtip='satis' then mhk.mik else -1*mhk.mik end),0) as SATISMIKTAR,\r\n         isnull(sum(case when islmtip='satis' then mhk.mik*((mhk.brmfiy*mhk.kur))\r\n         else -1*mhk.mik*((mhk.brmfiy*mhk.kur)) end),0) SATISTUTAR ,\r\n         isnull(sum(case when islmtip='iade' then mhk.mik else 0 end),0) IADEMIKTAR,\r\n         isnull(sum(case when islmtip='iade' then mhk.mik*((mhk.brmfiy*mhk.kur))\r\n          else 0 end),0) IADETUTAR from marvardimas as mv  WITH (NOLOCK)\r\n         left join marsathrk as mhk  WITH (NOLOCK) on mhk.varno=mv.varno and mv.sil=0 and mhk.sil=0\r\n         left join stokkart as sk  WITH (NOLOCK) on sk.kod=mhk.stkod and sk.tip=mhk.stktip\r\n         where mv.varno in (select * from CsvToInt_Max(@VARNIN))\r\n         group by sk.grp1,sk.grp2,sk.grp3 ) dt on \r\n         dt.grpid=t.STOK_GRUPID   \r\n    \r\n   end  /*marvardimas  */\r\n   \r\n   \r\n   \r\n    if @TIP='resvardimas'\r\n     begin\r\n\r\n     select \r\n      @HRK_MINTARIH=min(mv.tarih+cast(mv.saat as datetime)),\r\n      @HRK_MAXTARIH=max(mv.kaptarih+cast(mv.kapsaat as datetime))\r\n      from  resvardimas as mv  WITH (NOLOCK) where mv.sil=0 and\r\n      mv.varno  in (select * from CsvToInt_Max(@VARNIN))\r\n   \r\n     \r\n      INSERT @TB_SATISIADE_TOPLAM (\r\n      STOK_ANAGRUPID,STOK_ANAGRUP,\r\n      STOK_GRUPID,STOK_GRUP,\r\n      ONCEKIMIKTAR,ONCEKITUTAR,\r\n      DIGERGRSMIKTAR,DIGERGRSTUTAR,DIGERCKSMIKTAR,DIGERCKSTUTAR,\r\n      SATISMIKTAR,SATISTUTAR,IADEMIKTAR,IADETUTAR,\r\n      KALANMIKTAR,KALANTUTAR)\r\n      SELECT DEP.GRUPANA_ID,DEP.GRUPANA_AD,dep.GRUP_ID,dep.GRUP_AD,\r\n      sum(MIKTAR),sum(TUTAR),\r\n      0,0,0,0,0,0,0,0,0,0 \r\n      FROM DBO.DEPO_TARIHLI_GRUP_STOKIN (@TIP,@VARNIN) as dep\r\n      group by DEP.GRUPANA_ID,DEP.GRUPANA_AD,\r\n      dep.GRUP_ID,dep.GRUP_AD\r\n      ORDER BY DEP.GRUPANA_ID,dep.GRUP_ID\r\n      \r\n      \r\n      if @Market_Stok_AltGrup=0     \r\n      update @TB_SATISIADE_TOPLAM \r\n      set SATISMIKTAR=dt.SATISMIKTAR,\r\n      SATISTUTAR=dt.SATISTUTAR,\r\n      IADEMIKTAR=dt.IADEMIKTAR,\r\n      IADETUTAR=dt.IADETUTAR  \r\n      from @TB_SATISIADE_TOPLAM t join\r\n      (select grpid=sk.grp1,\r\n         isnull(sum(case when m.Iade=0 then mhk.miktar else -1*mhk.miktar end),0) as SATISMIKTAR,\r\n         isnull(sum(case when m.Iade=0 then mhk.miktar*((mhk.birimfiyat*mhk.kur))\r\n         else -1*mhk.miktar*((mhk.birimfiyat*mhk.kur)) end),0) SATISTUTAR ,\r\n         isnull(sum(case when m.Iade=1 then mhk.miktar else 0 end),0) IADEMIKTAR,\r\n         isnull(sum(case when m.Iade=1 then mhk.miktar*((mhk.birimfiyat*mhk.kur))\r\n          else 0 end),0) IADETUTAR from resvardimas as mv  WITH (NOLOCK)\r\n         inner join ressatmas as m  WITH (NOLOCK) on mv.varno=m.varno and m.sil=0\r\n         left join ressathrk as mhk  WITH (NOLOCK) on mhk.ResSatId=m.Id and mv.sil=0 and mhk.sil=0\r\n         left join stokkart as sk  WITH (NOLOCK) on sk.id=mhk.StkId and sk.tip_id=mhk.stktipId\r\n         where mv.varno in (select * from CsvToInt_Max(@VARNIN))\r\n         group by sk.grp1) dt on \r\n         dt.grpid=t.STOK_GRUPID\r\n         \r\n         \r\n         \r\n      if @Market_Stok_AltGrup=1     \r\n      update @TB_SATISIADE_TOPLAM \r\n      set SATISMIKTAR=dt.SATISMIKTAR,\r\n      SATISTUTAR=dt.SATISTUTAR,\r\n      IADEMIKTAR=dt.IADEMIKTAR,\r\n      IADETUTAR=dt.IADETUTAR  \r\n      from @TB_SATISIADE_TOPLAM t join\r\n      (select grpid=case \r\n      when sk.grp3>0 then sk.grp3 \r\n      when sk.grp2>0 then sk.grp2\r\n      when sk.grp1>0 then sk.grp1 end,\r\n         isnull(sum(case when m.Iade=0 then mhk.miktar else -1*mhk.miktar end),0) as SATISMIKTAR,\r\n         isnull(sum(case when m.Iade=0 then mhk.miktar*((mhk.birimfiyat*mhk.kur))\r\n         else -1*mhk.miktar*((mhk.birimfiyat*mhk.kur)) end),0) SATISTUTAR ,\r\n         isnull(sum(case when m.Iade=0 then mhk.miktar else 0 end),0) IADEMIKTAR,\r\n         isnull(sum(case when m.Iade=0 then mhk.miktar*((mhk.birimfiyat*mhk.kur))\r\n          else 0 end),0) IADETUTAR from resvardimas as mv  WITH (NOLOCK) \r\n          inner join ressatmas as m  WITH (NOLOCK) on mv.varno=m.varno and m.sil=0\r\n         left join ressathrk as mhk  WITH (NOLOCK) on mhk.ResSatId=m.Id  and mv.sil=0 and mhk.sil=0\r\n         left join stokkart as sk  WITH (NOLOCK) on sk.id=mhk.StkId and sk.tip_id=mhk.stktipId\r\n         where mv.varno in (select * from CsvToInt_Max(@VARNIN))\r\n         group by sk.grp1,sk.grp2,sk.grp3 ) dt on \r\n         dt.grpid=t.STOK_GRUPID   \r\n    \r\n   end  /*resvardimas  */\r\n   \r\n   \r\n   \r\n        \r\n         \r\n         \r\n      /*-diger giris ve cikis */\r\n     \r\n     if @HRK_MAXTARIH is null\r\n     begin \r\n     \r\n     \r\n     \r\n      if @Market_Stok_AltGrup=0 \r\n       update @TB_SATISIADE_TOPLAM set \r\n       DIGERGRSMIKTAR=dt.DIGERGRSMIKTAR,\r\n       DIGERGRSTUTAR=DT.DIGERGRSTUTAR,\r\n       DIGERCKSMIKTAR=dt.DIGERCKSMIKTAR,\r\n       DIGERCKSTUTAR=dt.DIGERCKSTUTAR\r\n       from @TB_SATISIADE_TOPLAM t join\r\n      (select grpid=sk.grp1,\r\n         isnull(sum(case when islmtip in ('FATAKALS','FATMRALS','FATYGALS','FATIADSAT','FATIADALS',\r\n        'IRSAKALS','IRSMRALS','IRSYGALS','HARGIRCIK') then sh.giren else 0 end),0) \r\n         DIGERGRSMIKTAR,\r\n         isnull(sum(case when islmtip in ('FATAKALS','FATMRALS','FATYGALS','FATIADSAT','FATIADALS',\r\n        'IRSAKALS','IRSMRALS','IRSYGALS','HARGIRCIK') then (sh.giren*sh.brmfiykdvli) else 0 end),0) \r\n         DIGERGRSTUTAR,\r\n         isnull(sum(case when islmtip in ('FATTOPSAT','FATPERSAT','FATIADSAT','FATIADALS',\r\n         'IRSAKSAT','IRSMRSAT','IRSYGSAT','HARGIRCIK') then sh.cikan else 0 end),0) \r\n         DIGERCKSMIKTAR,\r\n         isnull(sum(case when islmtip in ('FATTOPSAT','FATPERSAT','FATIADSAT','FATIADALS',\r\n         'IRSAKSAT','IRSMRSAT','IRSYGSAT','HARGIRCIK') then (sh.cikan*sh.brmfiykdvli) else 0 end),0) \r\n         DIGERCKSTUTAR\r\n         \r\n         From stkhrk as sh  WITH (NOLOCK)\r\n         left join stokkart as sk  WITH (NOLOCK) on sk.kod=sh.stkod and sk.tip=sh.stktip \r\n         and sk.tip='markt' where sh.sil=0  \r\n         and  (sh.tarih+cast(sh.saat as datetime))>=@HRK_MINTARIH\r\n         group by sk.grp1) dt on dt.grpid=t.STOK_GRUPID\r\n     \r\n     \r\n     \r\n      if @Market_Stok_AltGrup=1 \r\n       update @TB_SATISIADE_TOPLAM set \r\n       DIGERGRSMIKTAR=dt.DIGERGRSMIKTAR,\r\n       DIGERGRSTUTAR=DT.DIGERGRSTUTAR,\r\n       DIGERCKSMIKTAR=dt.DIGERCKSMIKTAR,\r\n       DIGERCKSTUTAR=dt.DIGERCKSTUTAR\r\n       from @TB_SATISIADE_TOPLAM t join\r\n      (select grpid=case \r\n      when sk.grp3>0 then sk.grp3 \r\n      when sk.grp2>0 then sk.grp2\r\n      when sk.grp1>0 then sk.grp1 end,\r\n         isnull(sum(case when islmtip in ('FATAKALS','FATMRALS','FATYGALS','FATIADSAT','FATIADALS',\r\n        'IRSAKALS','IRSMRALS','IRSYGALS','HARGIRCIK') then sh.giren else 0 end),0) \r\n         DIGERGRSMIKTAR,\r\n         isnull(sum(case when islmtip in ('FATAKALS','FATMRALS','FATYGALS','FATIADSAT','FATIADALS',\r\n        'IRSAKALS','IRSMRALS','IRSYGALS','HARGIRCIK') then (sh.giren*sh.brmfiykdvli) else 0 end),0) \r\n         DIGERGRSTUTAR,\r\n         isnull(sum(case when islmtip in ('FATTOPSAT','FATPERSAT','FATIADSAT','FATIADALS',\r\n         'IRSAKSAT','IRSMRSAT','IRSYGSAT','HARGIRCIK') then sh.cikan else 0 end),0) \r\n         DIGERCKSMIKTAR,\r\n         isnull(sum(case when islmtip in ('FATTOPSAT','FATPERSAT','FATIADSAT','FATIADALS',\r\n         'IRSAKSAT','IRSMRSAT','IRSYGSAT','HARGIRCIK') then (sh.cikan*sh.brmfiykdvli) else 0 end),0) \r\n         DIGERCKSTUTAR\r\n         \r\n         From stkhrk as sh \r\n         left join stokkart as sk on sk.kod=sh.stkod and sk.tip=sh.stktip \r\n         and sk.tip='markt'\r\n         where sh.sil=0  \r\n         and  (sh.tarih+cast(sh.saat as datetime))>=@HRK_MINTARIH\r\n         group by sk.grp1,sk.grp2,sk.grp3) \r\n         dt on dt.grpid=t.STOK_GRUPID\r\n         \r\n         \r\n         \r\n         \r\n         \r\n         \r\n         \r\n       end\r\n        else\r\n         begin\r\n         \r\n         \r\n          if @Market_Stok_AltGrup=0 \r\n          update @TB_SATISIADE_TOPLAM set \r\n           DIGERGRSMIKTAR=dt.DIGERGRSMIKTAR,\r\n           DIGERGRSTUTAR=DT.DIGERGRSTUTAR,\r\n           DIGERCKSMIKTAR=dt.DIGERCKSMIKTAR,\r\n           DIGERCKSTUTAR=dt.DIGERCKSTUTAR\r\n          \r\n          from @TB_SATISIADE_TOPLAM t join\r\n          (select grpid=sk.grp1,\r\n             isnull(sum(case when islmtip in ('FATAKALS','FATMRALS','FATYGALS','FATIADSAT','FATIADALS',\r\n            'IRSAKALS','IRSMRALS','IRSYGALS') then sh.giren else 0 end),0) \r\n             DIGERGRSMIKTAR,\r\n             isnull(sum(case when islmtip in ('FATAKALS','FATMRALS','FATYGALS','FATIADSAT','FATIADALS',\r\n            'IRSAKALS','IRSMRALS','IRSYGALS') then (sh.giren*sh.brmfiykdvli) else 0 end),0) \r\n             DIGERGRSTUTAR,\r\n             isnull(sum(case when islmtip in ('FATTOPSAT','FATPERSAT','FATIADSAT','FATIADALS',\r\n             'IRSAKSAT','IRSMRSAT','IRSYGSAT') then sh.cikan else 0 end),0) \r\n             DIGERCKSMIKTAR,\r\n             isnull(sum(case when islmtip in ('FATTOPSAT','FATPERSAT','FATIADSAT','FATIADALS',\r\n             'IRSAKSAT','IRSMRSAT','IRSYGSAT') then (sh.cikan*sh.brmfiykdvli) else 0 end),0) \r\n             DIGERCKSTUTAR\r\n             From stkhrk as sh \r\n             left join stokkart as sk on sk.kod=sh.stkod and sk.tip=sh.stktip \r\n             and sk.tip='markt'\r\n             where sh.sil=0  \r\n             and  (sh.tarih+cast(sh.saat as datetime))>=@HRK_MINTARIH\r\n             and  (sh.tarih+cast(sh.saat as datetime))<=@HRK_MAXTARIH\r\n             group by sk.grp1) \r\n             dt on dt.grpid=t.STOK_GRUPID\r\n         \r\n         \r\n         \r\n         if @Market_Stok_AltGrup=1 \r\n          update @TB_SATISIADE_TOPLAM set \r\n           DIGERGRSMIKTAR=dt.DIGERGRSMIKTAR,\r\n           DIGERGRSTUTAR=DT.DIGERGRSTUTAR,\r\n           DIGERCKSMIKTAR=dt.DIGERCKSMIKTAR,\r\n           DIGERCKSTUTAR=dt.DIGERCKSTUTAR\r\n          \r\n          from @TB_SATISIADE_TOPLAM t join\r\n          (select grpid=case \r\n           when sk.grp3>0 then sk.grp3 \r\n           when sk.grp2>0 then sk.grp2\r\n           when sk.grp1>0 then sk.grp1 end,\r\n             isnull(sum(case when islmtip in ('FATAKALS','FATMRALS','FATYGALS','FATIADSAT','FATIADALS',\r\n            'IRSAKALS','IRSMRALS','IRSYGALS') then sh.giren else 0 end),0) \r\n             DIGERGRSMIKTAR,\r\n             isnull(sum(case when islmtip in ('FATAKALS','FATMRALS','FATYGALS','FATIADSAT','FATIADALS',\r\n            'IRSAKALS','IRSMRALS','IRSYGALS') then (sh.giren*sh.brmfiykdvli) else 0 end),0) \r\n             DIGERGRSTUTAR,\r\n             isnull(sum(case when islmtip in ('FATTOPSAT','FATPERSAT','FATIADSAT','FATIADALS',\r\n             'IRSAKSAT','IRSMRSAT','IRSYGSAT') then sh.cikan else 0 end),0) \r\n             DIGERCKSMIKTAR,\r\n             isnull(sum(case when islmtip in ('FATTOPSAT','FATPERSAT','FATIADSAT','FATIADALS',\r\n             'IRSAKSAT','IRSMRSAT','IRSYGSAT') then (sh.cikan*sh.brmfiykdvli) else 0 end),0) \r\n             DIGERCKSTUTAR\r\n             \r\n             From stkhrk as sh \r\n             left join stokkart as sk on sk.kod=sh.stkod and sk.tip=sh.stktip \r\n             and sk.tip='markt'\r\n             where sh.sil=0  \r\n             and  (sh.tarih+cast(sh.saat as datetime))>=@HRK_MINTARIH\r\n             and  (sh.tarih+cast(sh.saat as datetime))<=@HRK_MAXTARIH\r\n             group by sk.grp1,sk.grp2,sk.grp3) \r\n             dt on dt.grpid=t.STOK_GRUPID\r\n          \r\n         end\r\n    \r\n       \r\n    \r\n     \r\n   /* update @TB_SATISIADE_TOPLAM set \r\n    KALANMIKTAR=(ONCEKIMIKTAR+DIGERGRSMIKTAR)\r\n    -(SATISMIKTAR+DIGERCKSMIKTAR),    \r\n     KALANTUTAR=((ONCEKIMIKTAR+DIGERGRSMIKTAR)\r\n    -(SATISMIKTAR+DIGERCKSMIKTAR))* (CASE WHEN ONCEKIMIKTAR=0 THEN 0 \r\n     ELSE  (ONCEKITUTAR/ONCEKIMIKTAR) END)\r\n   */\r\n    \r\n\r\n    \r\n   /*--GRUP TOPLAM BAŞLIK  */\r\n\r\n  \r\n    if @Market_Stok_AltGrup=0\r\n      update @TB_SATISIADE_TOPLAM set STOK_GRUPID=0 \r\n\r\n  \r\n   if @Market_Stok_AltGrup=1\r\n    INSERT @TB_SATISIADE_TOPLAM (\r\n    STOK_ANAGRUPID,STOK_ANAGRUP,\r\n    STOK_GRUPID,STOK_GRUP,\r\n    ONCEKIMIKTAR,ONCEKITUTAR,\r\n    DIGERGRSMIKTAR,DIGERGRSTUTAR,DIGERCKSMIKTAR,DIGERCKSTUTAR,\r\n    SATISMIKTAR,SATISTUTAR,IADEMIKTAR,IADETUTAR,\r\n    KALANMIKTAR,KALANTUTAR)\r\n    SELECT DEP.STOK_ANAGRUPID,DEP.STOK_ANAGRUP,0,DEP.STOK_ANAGRUP,\r\n    sum(ONCEKIMIKTAR),SUM(ONCEKITUTAR),\r\n    sum(DIGERGRSMIKTAR),SUM(DIGERGRSTUTAR),sum(DIGERCKSMIKTAR),\r\n    SUM(DIGERCKSTUTAR),SUM(SATISMIKTAR),SUM(SATISTUTAR),\r\n    SUM(IADEMIKTAR),SUM(IADETUTAR),SUM(KALANMIKTAR),SUM(KALANTUTAR)\r\n    FROM @TB_SATISIADE_TOPLAM dep\r\n    group by DEP.STOK_ANAGRUPID,DEP.STOK_ANAGRUP\r\n    ORDER BY DEP.STOK_ANAGRUPID\r\n    \r\n   set @SATISTUTAR=0\r\n   set @SATISMIKTAR=0\r\n   \r\n    if @Market_Stok_AltGrup=0 \r\n      select @SATISTUTAR=sum(SATISTUTAR),@SATISMIKTAR=sum(SATISMIKTAR) from @TB_SATISIADE_TOPLAM\r\n   \r\n    if @Market_Stok_AltGrup=1 \r\n      select @SATISTUTAR=sum(SATISTUTAR),@SATISMIKTAR=sum(SATISMIKTAR) from @TB_SATISIADE_TOPLAM\r\n      WHERE STOK_GRUPID>0\r\n      \r\n   \r\n   \r\n   UPDATE @TB_SATISIADE_TOPLAM SET \r\n   SATISTUTARYUZDE=\r\n   CASE WHEN @SATISTUTAR>0 THEN ROUND((SATISTUTAR/@SATISTUTAR)*100,2) ELSE 0 END,\r\n   SATISMIKTARYUZDE=\r\n   CASE WHEN @SATISMIKTAR>0 THEN ROUND((SATISMIKTAR/@SATISMIKTAR)*100,2) ELSE 0 END\r\n\r\n\r\n  RETURN\r\n\r\n\r\nend"
  },
  {
    "schema": "dbo",
    "name": "UDF_VAR_SAYAC",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_VAR_SAYAC",
    "definition": "CREATE FUNCTION [dbo].[UDF_VAR_SAYAC] \r\n(@VARNIN VARCHAR(8000),@TIP VARCHAR(30))\r\nRETURNS\r\n  @TB_SAYAC  TABLE (\r\n    SAYACKOD            VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    SAYACAD     \t\tVARCHAR(100) COLLATE Turkish_CI_AS,\r\n    ADAD\t\t\t\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n    ILKENDKS            FLOAT,\r\n    SONENDKS            FLOAT,\r\n    SATISMIKTAR         FLOAT,\r\n    SATISTUTAR          FLOAT,\r\n    TESTMIKTAR\t\t\tFLOAT,\r\n    BRIMFIYAT\t\t\tFLOAT,\r\n    TRANSFERMIKTAR      FLOAT)\r\nAS\r\nBEGIN\r\n \r\n   insert into @TB_SAYAC \r\n   SELECT p.SAYACKOD,p.SAYACAD,P.ADAD,\r\n        min(P.ilkendk),max(P.sonendk),\r\n        sum(P.satmik),sum(p.satmik*p.brimfiy),\r\n        sum(P.testmik),\r\n        case when sum(satmik)>0 \r\n        then sum(P.satmik*p.brimfiy)/sum(p.satmik) else 0 end,\r\n        sum(P.transfermik)\r\n         FROM  pomvardisayac AS p \r\n         where p.varno in (select * from CsvToInt(@VARNIN))\r\n         group by P.SAYACKOD,p.SAYACAD,P.ADAD\r\n   \r\n\r\n  RETURN\r\n\r\nend"
  },
  {
    "schema": "dbo",
    "name": "UDF_VAR_SAYAC_SATIS",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_VAR_SAYAC_SATIS",
    "definition": "CREATE FUNCTION [dbo].UDF_VAR_SAYAC_SATIS (@VARNIN VARCHAR(max),@TIP VARCHAR(30))\r\nRETURNS\r\n  @TB_SAYAC_SATIS TABLE (\r\n    SAYAC_KOD    VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    SAYAC_AD     VARCHAR(100) COLLATE Turkish_CI_AS,\r\n    ILKENDEKS         FLOAT,\r\n    SONENDEKS        FLOAT,\r\n    SATISMIKTAR      FLOAT,\r\n    TESTMIKTAR        FLOAT,\r\n    TRANSFERMIKTAR    FLOAT ,\r\n    BIRIMFIYAT        FLOAT,\r\n    TUTAR             FLOAT )\r\nAS\r\nBEGIN\r\n \r\n  INSERT @TB_SAYAC_SATIS (SAYAC_KOD,SAYAC_AD,ILKENDEKS,SONENDEKS,\r\n  SATISMIKTAR,TESTMIKTAR,TRANSFERMIKTAR,BIRIMFIYAT,TUTAR)\r\n  select ps.sayackod,sy.ad,MIN(ps.ilkendk),MAX(PS.sonendk),sum(ps.satmik),\r\n  sum(testmik),sum(transfermik),\r\n  case when sum(satmik)>0 then\r\n  sum(PS.satmik*ps.brimfiy)/sum(ps.satmik) else 0 end,\r\n  sum(ps.brimfiy*ps.satmik)\r\n  FROM  pomvardisayac as ps with (nolock) \r\n  inner join sayackart as sy with (nolock)  on sy.kod=ps.sayackod\r\n  where ps.varno in (select * from CsvToInt_Max(@VARNIN)) and ps.satmik>0 \r\n  and ps.sil=0 group by ps.sayackod,sy.ad\r\n\r\n  RETURN\r\n\r\nend"
  },
  {
    "schema": "dbo",
    "name": "UDF_VAR_SAYAC_ZRAPOR_HAZIRLA",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_VAR_SAYAC_ZRAPOR_HAZIRLA",
    "definition": "CREATE FUNCTION dbo.[UDF_VAR_SAYAC_ZRAPOR_HAZIRLA] \r\n(@VarNoIn varchar(500))\r\nRETURNS\r\n   \r\n   @TABLE_SAYAC_ZRAPOR TABLE (\r\n   Id\t\t\t\t\t    int IDENTITY(1, 1), \r\n   Firmano                  int,  \r\n   ZTip  \t\t\t\t\tVARCHAR(20) COLLATE Turkish_CI_AS,\r\n   CariKod\t\t\t\t\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n   Tarih\t\t\t\t\tdatetime,\r\n   ZSeri\t\t\t\t\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n   ZNo\t\t    \t\t\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n   YKKod     \t\t\t\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n   YkAd\t                    Varchar(50) COLLATE Turkish_CI_AS,\r\n   StokKod\t\t\t\t\tVARCHAR(50) COLLATE Turkish_CI_AS,\r\n   KdvYuzde\t\t\t\t\tFloat,\r\n   Fiyat\t\t\t\t\tFloat,\r\n   Litre\t\t\t\t\tFloat,\r\n   Tutar\t\t\t\t\tFloat\r\n   )\r\n   \r\nAS\r\nBEGIN\r\n  \r\n    DECLARE @EKSTRE_TEMP TABLE (\r\n    SayacKod      Varchar(30) COLLATE Turkish_CI_AS,\r\n    StokKod\t      Varchar(30) COLLATE Turkish_CI_AS,\r\n    YkKod\t      Varchar(30) COLLATE Turkish_CI_AS,\t\t\r\n    YkAd\t      Varchar(50) COLLATE Turkish_CI_AS,\r\n    KdvYuzde\t  Float,\r\n    Fiyat         Float,\r\n    Litre \t\t  Float,\r\n    Tutar         Float)\r\n\r\n    Declare @Tarih  Datetime\r\n    Declare @FirmaNo  int\r\n    declare @CariKod\t      Varchar(50)\r\n    \r\n    \r\n    select @CariKod=zrap_carkod From sistemtanim\r\n\r\n    Select @FirmaNo=Max(Firmano),@Tarih=MAX(Tarih) From PomVardimas with (nolock) \r\n    Where varno in (select * from CsvToInt(@VarNoIn))\r\n\r\n    insert into @EKSTRE_TEMP \r\n    (SayacKod,StokKod,KdvYuzde,Fiyat,Litre,Tutar)\r\n    SELECT p.SayacKod,p.stkod,p.kdvyuz,\r\n    case when sum(satmik)>0 \r\n    then sum(P.satmik*p.brimfiy)/sum(p.satmik) else 0 end,\r\n    sum(P.satmik),sum(p.satmik*p.brimfiy)\r\n    FROM  pomvardisayac AS p  with (nolock)\r\n    where p.varno in (select * from CsvToInt(@VarNoIn))\r\n    and satmik>0\r\n    group by P.SayacKod,p.stkod,p.kdvyuz\r\n    \r\n    \r\n    update @EKSTRE_TEMP set YKKod=dt.YKKod from @EKSTRE_TEMP as t\r\n    join (select Kod,ykkod from sayackart as c \r\n    where c.sil=0) dt \r\n    on dt.Kod=t.SayacKod\r\n    \r\n    update @EKSTRE_TEMP set YkAd=dt.Ad from @EKSTRE_TEMP as t\r\n    join (select Kod,Ad from yazarkasakart as c \r\n    where c.sil=0) dt on dt.Kod=t.YKKod\r\n  \r\n    \r\n  \r\n  insert into @TABLE_SAYAC_ZRAPOR \r\n  (Firmano,CariKod,Tarih,YKKod,YkAd,StokKod,KdvYuzde,Fiyat,Litre,Tutar) \r\n  Select @FirmaNo,@CariKod,@Tarih,YKKod,YkAd,StokKod,KdvYuzde,\r\n  round(case When Sum(Litre)>0 then Sum(Tutar)/Sum(Litre) else 0 end,8) Fiyat,\r\n  Sum(Litre),Sum(Tutar) From @EKSTRE_TEMP\r\n  Group by YKKod,YkAd,StokKod,KdvYuzde\r\n  \r\n\r\n\r\n  return\r\n\r\n\r\n\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_VAR_STOK_DRM",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_VAR_STOK_DRM",
    "definition": "CREATE FUNCTION [dbo].UDF_VAR_STOK_DRM (@VARNIN VARCHAR(8000),@TIP VARCHAR(30))\r\nRETURNS\r\n  @TB_TANK_STOK TABLE (\r\n    TANK_KOD    VARCHAR(20),\r\n    TANK_AD     VARCHAR(50),\r\n    ONCEKIMIKTAR        FLOAT,\r\n    MALALIM             FLOAT,\r\n    MALALIMTUTAR        FLOAT,\r\n    SATISMIKTAR         FLOAT,\r\n    TESTMIKTAR          FLOAT,\r\n    DIGERMIKTAR         FLOAT,\r\n    KALANMIKTAR         FLOAT)\r\nAS\r\nBEGIN\r\n  DECLARE @EKSTRE_TEMP TABLE (\r\n    VARNO      FLOAT)\r\n declare @separator char(1)\r\n set @separator = ','\r\n\r\n declare @separator_position int\r\n declare @array_value varchar(1000)\r\n\r\n IF (LEN(RTRIM(@VARNIN)) > 0)\r\n BEGIN\r\n  set @VARNIN = @VARNIN + ','\r\n END\r\n\r\n while patindex('%,%' , @VARNIN) <> 0\r\n begin\r\n\r\n   select @separator_position =  patindex('%,%' , @VARNIN)\r\n   select @array_value = left(@VARNIN, @separator_position - 1)\r\n\r\n  Insert @EKSTRE_TEMP\r\n  Values (Cast(@array_value as float))\r\n  select @VARNIN = stuff(@VARNIN, 1, @separator_position, '')\r\n end\r\n\r\n  DECLARE @HRK_VERNO FLOAT\r\n  DECLARE @HRK_TANK_KOD VARCHAR(30)\r\n  DECLARE @HRK_TANK_AD VARCHAR(30)\r\n  DECLARE @HRK_STK_KOD VARCHAR(30)\r\n  DECLARE @HRK_STK_TIP VARCHAR(10)\r\n  DECLARE @HRK_ONCEKIMIK FLOAT\r\n  DECLARE @HRK_MALALIM FLOAT\r\n  DECLARE @HRK_SATISMIKTAR FLOAT\r\n  DECLARE @HRK_TESTMIKTAR FLOAT\r\n  DECLARE @HRK_DIGERMIKTAR FLOAT\r\n  DECLARE @HRK_KALANMIKTAR FLOAT\r\n  DECLARE @HRK_MALTUTAR    FLOAT\r\n\r\n\r\n  DECLARE @HRK_MINTARIH DATETIME\r\n  DECLARE @HRK_MAXTARIH DATETIME\r\n\r\n    DECLARE CRS_HRK CURSOR FAST_FORWARD FOR\r\n    select ps.kod,ps.stkod,ps.stktip,st.ad,min(ps.acmik),0,sum(ps.satmik),sum(ps.testmik),\r\n    sum(PS.transfer_cks_mik),0,\r\n    min(pm.tarih+cast(pm.saat as datetime)),\r\n    max(pm.kaptar+cast(pm.kapsaat as datetime))\r\n    FROM  pomvarditank as ps\r\n    inner join pomvardimas as pm on ps.varno=pm.varno and pm.sil=0\r\n    inner join tankkart as st on st.kod=ps.kod\r\n    where ps.varno in (select * from @EKSTRE_TEMP)\r\n    and ps.sil=0 group by ps.kod,st.ad,ps.stkod,ps.stktip\r\n\r\n   OPEN CRS_HRK\r\n\r\n  FETCH NEXT FROM CRS_HRK INTO\r\n   @HRK_TANK_KOD,@HRK_STK_KOD,@HRK_STK_TIP,@HRK_TANK_AD,@HRK_ONCEKIMIK,@HRK_MALALIM,\r\n   @HRK_SATISMIKTAR,@HRK_TESTMIKTAR,@HRK_DIGERMIKTAR,@HRK_KALANMIKTAR,\r\n   @HRK_MINTARIH,@HRK_MAXTARIH\r\n\r\n  WHILE @@FETCH_STATUS = 0\r\n  BEGIN\r\n     SET @HRK_MALALIM=0\r\n     SET @HRK_MALTUTAR=0\r\n     \r\n     if @HRK_MAXTARIH is null\r\n      begin\r\n\r\n      SELECT @HRK_MALALIM=isnull(sum(giren-cikan),0),\r\n      @HRK_MALTUTAR=isnull(sum((giren-cikan)*brmfiykdvli),0)\r\n      from stkhrk\r\n      where sil=0 and depkod=@HRK_TANK_KOD and stkod=@HRK_STK_KOD AND stktip=@HRK_STK_TIP\r\n      and islmtip in ('FATAKALS','FATMRALS') and (tarih+cast(saat as datetime))>=@HRK_MINTARIH\r\n\r\n     end\r\n     else\r\n      begin\r\n      \r\n     SELECT @HRK_MALALIM=isnull(sum(giren-cikan),0),\r\n     @HRK_MALTUTAR=isnull(sum((giren-cikan)*brmfiykdvli),0) from stkhrk\r\n     where sil=0 and depkod=@HRK_TANK_KOD and stkod=@HRK_STK_KOD AND stktip=@HRK_STK_TIP\r\n     and islmtip in ('FATAKALS','FATMRALS') and (tarih+cast(saat as datetime))>=@HRK_MINTARIH\r\n     and (tarih+cast(saat as datetime))<=@HRK_MAXTARIH\r\n     end\r\n\r\n     SET @HRK_KALANMIKTAR=(@HRK_ONCEKIMIK+@HRK_MALALIM)-(@HRK_SATISMIKTAR)\r\n\r\n       INSERT @TB_TANK_STOK (TANK_KOD,TANK_AD,ONCEKIMIKTAR,MALALIM,MALALIMTUTAR,SATISMIKTAR,TESTMIKTAR,\r\n       DIGERMIKTAR,KALANMIKTAR)\r\n       VALUES (@HRK_TANK_KOD,@HRK_TANK_AD,@HRK_ONCEKIMIK,@HRK_MALALIM,@HRK_MALTUTAR,@HRK_SATISMIKTAR,@HRK_TESTMIKTAR,\r\n   @HRK_DIGERMIKTAR,@HRK_KALANMIKTAR)\r\n\r\n    FETCH NEXT FROM CRS_HRK INTO\r\n     @HRK_TANK_KOD,@HRK_STK_KOD,@HRK_STK_TIP,@HRK_TANK_AD,@HRK_ONCEKIMIK,@HRK_MALALIM,@HRK_SATISMIKTAR,@HRK_TESTMIKTAR,\r\n   @HRK_DIGERMIKTAR,@HRK_KALANMIKTAR,@HRK_MINTARIH,@HRK_MAXTARIH\r\n  END\r\n\r\n  CLOSE CRS_HRK\r\n  DEALLOCATE CRS_HRK\r\n\r\n  /*---------------------------------------------------------------------------- */\r\n\r\n\r\n\r\n  RETURN\r\n\r\nend"
  },
  {
    "schema": "dbo",
    "name": "UDF_VAR_STOK_SATIS",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_VAR_STOK_SATIS",
    "definition": "create FUNCTION [dbo].[UDF_VAR_STOK_SATIS] \r\n(@VARNIN VARCHAR(8000),@TIP VARCHAR(30))\r\nRETURNS\r\n  @TB_TANK_STOK TABLE (\r\n    FIRMANO\t\t\t    INT, \r\n    FIRMAUNVAN\t\t\tVARCHAR(100) COLLATE Turkish_CI_AS,\r\n    STOKKTIP            VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    STOKKOD     \t\tVARCHAR(30) COLLATE Turkish_CI_AS,\r\n    STOKAD     \t\t\tVARCHAR(100) COLLATE Turkish_CI_AS,\r\n    ONCEKIMIKTAR        FLOAT,\r\n    MALALIM             FLOAT,\r\n    MALALIMTUTAR        FLOAT,\r\n    SATISMIKTAR         FLOAT,\r\n    SATISTUTAR\t\t\tFLOAT,\r\n    BRIMFIYAT\t\t\tFLOAT,\r\n    TRANSFER_CKS_MIKTAR FLOAT,\r\n    TRANSFER_GRS_MIKTAR FLOAT,\r\n    TESTMIKTAR          FLOAT,\r\n    SONMIKTAR           FLOAT)\r\nAS\r\nBEGIN\r\n \r\n  \r\n   insert into @TB_TANK_STOK \r\n    SELECT P.firmano,'',P.stktip AS STOKKTIP,P.kod AS STOKKOD,\r\n    S.ad as STOKAD,p.acmik AS ONCEKIMIKTAR,0,0,\r\n    P.satmik AS SATISMIKTAR,(P.satmik*P.brimfiy) as SATISTUTAR,\r\n    P.brimfiy AS BRIMFIYAT,\r\n    P.transfer_cks_mik AS TRANSFER_CKS_MIKTAR,P.transfer_grs_mik AS TRANSFER_GRS_MIKTAR,\r\n    P.testmik AS TESTMIKTAR,\r\n    P.kalan AS SONMIKTAR FROM  pomvardistok AS P \r\n     inner JOIN stokkart AS S ON \r\n     (P.kod=S.kod and p.stktip=s.tip and isnull(p.sil,0)=0 and p.varno in (select * from CsvToInt(@VARNIN))) \r\n     order by P.stktip,P.kod\r\n\r\n    UPDATE @TB_TANK_STOK SET FIRMAUNVAN=DT.AD FROM @TB_TANK_STOK AS T \r\n    join (SELECT id,ad from firma ) dt\r\n    on dt.id=t.FIRMANO\r\n\r\n\r\n\r\n  RETURN\r\n\r\nend"
  },
  {
    "schema": "dbo",
    "name": "UDF_VAR_STOK_SATIS_GRUP",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_VAR_STOK_SATIS_GRUP",
    "definition": "CREATE FUNCTION [dbo].[UDF_VAR_STOK_SATIS_GRUP] \r\n(@VARNIN VARCHAR(8000),@TIP VARCHAR(30))\r\nRETURNS\r\n  @TB_TANK_STOK TABLE (\r\n    GRUP_AD     \t\tVARCHAR(100) COLLATE Turkish_CI_AS,\r\n    ONCEKIMIKTAR        FLOAT,\r\n    MALALIM             FLOAT,\r\n    MALALIMTUTAR        FLOAT,\r\n    SATISMIKTAR         FLOAT,\r\n    SATISTUTAR\t\t\tFLOAT,\r\n    BRIMFIYAT\t\t\tFLOAT,\r\n    TRANSFER_CKS_MIKTAR FLOAT,\r\n    TRANSFER_GRS_MIKTAR FLOAT,\r\n    TESTMIKTAR          FLOAT,\r\n    SONMIKTAR           FLOAT)\r\nAS\r\nBEGIN\r\n \r\n  \r\n   insert into @TB_TANK_STOK \r\n    SELECT dbo.Genel_Grup_Ad_Ver(s.grp1,s.grp2,s.grp3) GRUP_AD,\r\n    Sum(p.acmik) AS ONCEKIMIKTAR,\r\n    0,0,\r\n    sum(P.satmik) AS SATISMIKTAR,\r\n    sum(P.satmik*P.brimfiy) as SATISTUTAR,\r\n    case \r\n    when sum(P.satmik)>0 then\r\n    sum(P.satmik*P.brimfiy)/sum(P.satmik)\r\n    else \r\n    AVG(P.brimfiy) end BRIMFIYAT,\r\n    sum(P.transfer_cks_mik) AS TRANSFER_CKS_MIKTAR,\r\n    sum(P.transfer_grs_mik) AS TRANSFER_GRS_MIKTAR,\r\n    sum(P.testmik) AS TESTMIKTAR,\r\n    sum(P.kalan) AS SONMIKTAR FROM  \r\n    pomvardistok AS P with (nolock) \r\n    inner JOIN stokkart AS S with (nolock)  ON \r\n    (P.kod=S.kod and p.sil=0 and p.varno in (select * from CsvToInt(@VARNIN))) \r\n    group by s.grp1,s.grp2,s.grp3\r\n    \r\n\r\n\r\n\r\n\r\n\r\n  RETURN\r\n\r\nend"
  },
  {
    "schema": "dbo",
    "name": "UDF_VAR_STOK_TURU",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_VAR_STOK_TURU",
    "definition": "CREATE FUNCTION [dbo].[UDF_VAR_STOK_TURU]\r\n(@FIRMANO     INT,\r\n@VARIN        VARCHAR(8000))\r\nRETURNS\r\n    @TB_VAR_STOK_LITRE TABLE (\r\n    STOK_TIP\t\t\tVARCHAR(30) COLLATE Turkish_CI_AS,\r\n    STOK_KOD\t\t    VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    LITRE\t\t      \tFLOAT,\r\n    ARAC_SAYI          \tFLOAT)\r\nAS\r\nBEGIN\r\n   \r\n   \r\n   INSERT @TB_VAR_STOK_LITRE (STOK_TIP,STOK_KOD,LITRE,ARAC_SAYI)\r\n   select 'akykt',OT.stkod,round( sum(ot.miktar),3),\r\n   count(ot.miktar)\r\n   FROM  otomasoku as ot\r\n   where varno in (select * from CsvToInt(@VARIN))\r\n   GROUP BY OT.stkod\r\n   \r\n   \r\n  \r\n   \r\n   \r\n   \r\n   return\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_VAR_STOK_TURU_CARI",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_VAR_STOK_TURU_CARI",
    "definition": "CREATE FUNCTION [dbo].[UDF_VAR_STOK_TURU_CARI]\r\n(@FIRMANO     INT,\r\n@VARIN        VARCHAR(8000))\r\nRETURNS\r\n    @TB_VAR_STOK_LITRE TABLE (\r\n    STOK_TIP\t\t\tVARCHAR(30) COLLATE Turkish_CI_AS,\r\n    STOK_KOD\t\t    VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    STOK_TUTAR\t\t   \tFLOAT,\r\n    CARI_TUTAR     \t\tFLOAT)\r\nAS\r\nBEGIN\r\n   \r\n   \r\n   INSERT @TB_VAR_STOK_LITRE (STOK_TIP,STOK_KOD,STOK_TUTAR,CARI_TUTAR)\r\n   select 'akykt',OT.stkod,sum(ot.miktar),\r\n   sum(case when sattip='Veresiye' then ot.miktar else 0 end)\r\n   FROM  otomasoku as ot\r\n   where varno in (select * from CsvToInt(@VARIN))\r\n   GROUP BY OT.stkod\r\n   \r\n   \r\n   return\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_VAR_STOK_TURU_CARI_KARSILASTIR",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_VAR_STOK_TURU_CARI_KARSILASTIR",
    "definition": "CREATE FUNCTION [dbo].[UDF_VAR_STOK_TURU_CARI_KARSILASTIR]\r\n(@FIRMANO     INT,\r\n@VARIN        VARCHAR(8000),\r\n@ONCEVARIN    VARCHAR(8000))\r\nRETURNS\r\n    @TB_VAR_STOK_LITRE TABLE (\r\n    STOK_TIP\t\t\tVARCHAR(30) COLLATE Turkish_CI_AS,\r\n    STOK_KOD\t\t    VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    CARI_TUTAR     \t\tFLOAT,\r\n    ONCE_CARI_TUTAR     FLOAT)\r\nAS\r\nBEGIN\r\n   \r\n   \r\n   INSERT @TB_VAR_STOK_LITRE (STOK_TIP,STOK_KOD,CARI_TUTAR,\r\n   ONCE_CARI_TUTAR)\r\n   select 'akykt',OT.stkod,\r\n   sum(case when sattip='Veresiye' then ot.miktar else 0 end),\r\n   0\r\n   FROM  otomasoku as ot\r\n   where varno in (select * from CsvToInt(@VARIN))\r\n   GROUP BY OT.stkod\r\n   \r\n   \r\n   UPDATE @TB_VAR_STOK_LITRE SET ONCE_CARI_TUTAR=DT.TUTAR\r\n   from @TB_VAR_STOK_LITRE as t join \r\n   (select OT.stkod,\r\n   sum(case when sattip='Veresiye' then ot.miktar else 0 end)\r\n   as tutar\r\n   FROM  otomasoku as ot\r\n   where varno in (select * from CsvToInt(@ONCEVARIN))\r\n   GROUP BY OT.stkod ) dt \r\n   on  dt.stkod=t.STOK_KOD\r\n   \r\n   \r\n   return\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_VAR_STOK_TURU_KARSILASTIR",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_VAR_STOK_TURU_KARSILASTIR",
    "definition": "CREATE FUNCTION [dbo].[UDF_VAR_STOK_TURU_KARSILASTIR]\r\n(@FIRMANO     INT,\r\n@VARIN        VARCHAR(8000),\r\n@ONCEVARIN    VARCHAR(8000))\r\nRETURNS\r\n    @TB_VAR_STOK_LITRE TABLE (\r\n    STOK_TIP\t\t\tVARCHAR(30) COLLATE Turkish_CI_AS,\r\n    STOK_KOD\t\t    VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    LITRE\t\t      \tFLOAT,\r\n    ONCE_LITRE         \tFLOAT)\r\nAS\r\nBEGIN\r\n   \r\n   \r\n   INSERT @TB_VAR_STOK_LITRE (STOK_TIP,STOK_KOD,LITRE,ONCE_LITRE)\r\n   select 'akykt',OT.stkod,round( sum(ot.miktar),3),0\r\n   FROM  otomasoku as ot\r\n   where varno in (select * from CsvToInt(@VARIN))\r\n   GROUP BY OT.stkod\r\n   \r\n   \r\n   \r\n   \r\n   UPDATE @TB_VAR_STOK_LITRE SET ONCE_LITRE=DT.litre\r\n   from @TB_VAR_STOK_LITRE as t join \r\n   (select OT.stkod,round( sum(ot.miktar),3)\r\n   as litre\r\n   FROM  otomasoku as ot\r\n   where varno in (select * from CsvToInt(@ONCEVARIN))\r\n   GROUP BY OT.stkod ) dt \r\n   on  dt.stkod=t.STOK_KOD\r\n   \r\n   \r\n   \r\n  \r\n   \r\n   \r\n   \r\n   return\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_VAR_TANK_STOK",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_VAR_TANK_STOK",
    "definition": "CREATE FUNCTION [dbo].UDF_VAR_TANK_STOK (@VARNIN VARCHAR(max),@TIP VARCHAR(30))\r\nRETURNS\r\n  @TB_TANK_STOK TABLE (\r\n    TANK_KOD            VARCHAR(20),\r\n    TANK_AD             VARCHAR(50),\r\n    ONCEKIMIKTAR        FLOAT,\r\n    ONCEKITUTAR         FLOAT,\r\n    MALALIM             FLOAT,\r\n    MALALIMTUTAR        FLOAT,\r\n    SATISMIKTAR         FLOAT,\r\n    TESTMIKTAR          FLOAT,\r\n    TRANSFER_CKS_MIKTAR FLOAT,\r\n    TRANSFER_GRS_MIKTAR FLOAT,\r\n    DIGER_GRS_MIKTAR    FLOAT,\r\n    DIGER_CKS_MIKTAR    FLOAT,\r\n    KALANMIKTAR         FLOAT,\r\n    KALANTUTAR          FLOAT)\r\nAS\r\nBEGIN\r\n\r\n  DECLARE @HRK_VERNO \t\t\t\tFLOAT\r\n  DECLARE @HRK_TANK_KOD             VARCHAR(30)\r\n  DECLARE @HRK_TANK_AD \t\t\t\tVARCHAR(30)\r\n  DECLARE @HRK_STK_KOD \t\t\t\tVARCHAR(30)\r\n  DECLARE @HRK_STK_TIP \t\t\t\tVARCHAR(10)\r\n  DECLARE @HRK_ONCEKIMIK \t\t\tFLOAT\r\n  DECLARE @HRK_MALALIM \t\t\t\tFLOAT\r\n  DECLARE @HRK_SATISMIKTAR \t\t\tFLOAT\r\n  DECLARE @HRK_TESTMIKTAR \t\t\tFLOAT\r\n  DECLARE @TRANSFER_CKS_MIKTAR \t\tFLOAT\r\n  DECLARE @TRANSFER_GRS_MIKTAR \t\tFLOAT\r\n  DECLARE @HRK_DIGER_GRS_MIKTAR \tFLOAT\r\n  DECLARE @HRK_DIGER_CKS_MIKTAR \tFLOAT\r\n  DECLARE @HRK_KALANMIKTAR \t\t\tFLOAT\r\n  DECLARE @HRK_MALTUTAR    \t\t\tFLOAT\r\n  DECLARE @HRK_BRMFIYAT    \t\t\tFLOAT\r\n\r\n\r\n  DECLARE @HRK_MINTARIH DATETIME\r\n  DECLARE @HRK_MAXTARIH DATETIME\r\n\r\n    DECLARE CRS_HRK CURSOR FAST_FORWARD FOR\r\n    select ps.kod,ps.stkod,ps.stktip,st.ad,\r\n    0,0,\r\n    sum(ps.satmik),\r\n    sum(ps.testmik),\r\n    isnull(sum(PS.transfer_cks_mik),0),\r\n    isnull(sum(PS.transfer_grs_mik),0),\r\n    0,0,\r\n    case when sum(ps.satmik)>0 then\r\n    sum(PS.satmik*ps.brimfiy)/sum(ps.satmik) else 0 end,\r\n    min(pm.tarih+cast(pm.saat as datetime)),\r\n    max(pm.kaptar+cast(pm.kapsaat as datetime))\r\n    FROM  pomvarditank as ps with (nolock)\r\n    inner join pomvardimas as pm with (nolock) on ps.varno=pm.varno and pm.sil=0\r\n    inner join tankkart as st with (nolock) on st.kod=ps.kod\r\n    where ps.varno in (select * from CsvToInt_Max(@VARNIN))\r\n    and ps.sil=0 group by ps.kod,st.ad,ps.stkod,ps.stktip\r\n    order by st.ad\r\n\r\n   OPEN CRS_HRK\r\n\r\n  FETCH NEXT FROM CRS_HRK INTO\r\n   @HRK_TANK_KOD,@HRK_STK_KOD,@HRK_STK_TIP,@HRK_TANK_AD,\r\n   @HRK_ONCEKIMIK,@HRK_MALALIM,\r\n   @HRK_SATISMIKTAR,@HRK_TESTMIKTAR,@TRANSFER_CKS_MIKTAR,@TRANSFER_GRS_MIKTAR,\r\n   @HRK_DIGER_GRS_MIKTAR,@HRK_DIGER_CKS_MIKTAR,@HRK_BRMFIYAT,\r\n   @HRK_MINTARIH,@HRK_MAXTARIH\r\n\r\n  WHILE @@FETCH_STATUS = 0\r\n  BEGIN\r\n     SET @HRK_MALALIM=0\r\n     SET @HRK_MALTUTAR=0\r\n     SET @HRK_ONCEKIMIK=0\r\n     \r\n      SELECT @HRK_ONCEKIMIK=SUM(giren-cikan) from stkhrk as h\r\n      where h.sil=0 and h.depkod=@HRK_TANK_KOD \r\n      and (tarih+cast(saat as datetime))<@HRK_MINTARIH\r\n     \r\n     if @HRK_MAXTARIH is null\r\n      begin\r\n\r\n      SELECT @HRK_MALALIM=\r\n      isnull(sum( case when islmtip in ('FATAKALS','FATMRALS','FATYGALS','FATIADSAT',\r\n      'IRSAKALS','IRSMRALS','IRSYGALS') then giren-cikan else 0 end),0),\r\n      @HRK_MALTUTAR=isnull(sum( case when islmtip in ('FATAKALS','FATMRALS','FATYGALS','FATIADSAT',\r\n      'IRSAKALS','IRSMRALS','IRSYGALS') then \r\n      ((giren-cikan)*brmfiykdvli) else 0 end),0),\r\n      \r\n      @HRK_DIGER_GRS_MIKTAR=@TRANSFER_GRS_MIKTAR+\r\n      isnull(sum( case when islmtip \r\n      not in ('POMSAYSAT','POMTRANS') then giren else 0 end),0),\r\n      \r\n      @HRK_DIGER_CKS_MIKTAR=@TRANSFER_CKS_MIKTAR+\r\n      isnull(sum( case when islmtip \r\n      not in ('POMSAYSAT','POMTRANS') then cikan else 0 end),0)\r\n\r\n      from stkhrk with (nolock)\r\n      where sil=0 and depkod=@HRK_TANK_KOD and stkod=@HRK_STK_KOD \r\n      AND stktip=@HRK_STK_TIP\r\n      and (tarih+cast(saat as datetime))>=@HRK_MINTARIH\r\n      and (tarih+cast(saat as datetime))<=@HRK_MINTARIH\r\n\r\n     end\r\n     else\r\n      begin\r\n      \r\n     SELECT @HRK_MALALIM=\r\n      isnull(sum( case when islmtip in ('FATAKALS','FATMRALS','FATYGALS','FATIADSAT',\r\n      'IRSAKALS','IRSMRALS','IRSYGALS') then giren-cikan else 0 end),0),\r\n      @HRK_MALTUTAR=isnull(sum( case when islmtip in ('FATAKALS','FATMRALS','FATYGALS','FATIADSAT',\r\n      'IRSAKALS','IRSMRALS','IRSYGALS') then \r\n      ((giren-cikan)*brmfiykdvli) else 0 end),0),\r\n      @HRK_DIGER_GRS_MIKTAR=@TRANSFER_GRS_MIKTAR+\r\n      isnull(sum( case when islmtip not in ('POMSAYSAT','POMTRANS') then giren else 0 end),0),\r\n      \r\n      @HRK_DIGER_CKS_MIKTAR=@TRANSFER_CKS_MIKTAR+\r\n      isnull(sum( case when islmtip not in ('POMSAYSAT','POMTRANS') then cikan else 0 end),0)\r\n\r\n      from stkhrk with (nolock)\r\n      where sil=0 and depkod=@HRK_TANK_KOD and stkod=@HRK_STK_KOD AND stktip=@HRK_STK_TIP\r\n      and (tarih+cast(saat as datetime))>=@HRK_MINTARIH\r\n      and (tarih+cast(saat as datetime))<=@HRK_MAXTARIH\r\n     end\r\n\r\n     SET @HRK_KALANMIKTAR=(@HRK_ONCEKIMIK+@HRK_DIGER_GRS_MIKTAR)\r\n      -(@HRK_SATISMIKTAR+@HRK_DIGER_CKS_MIKTAR)\r\n\r\n       INSERT @TB_TANK_STOK (TANK_KOD,TANK_AD,ONCEKIMIKTAR,ONCEKITUTAR,\r\n       MALALIM,MALALIMTUTAR,SATISMIKTAR,TESTMIKTAR,\r\n       TRANSFER_CKS_MIKTAR,TRANSFER_GRS_MIKTAR,\r\n       DIGER_GRS_MIKTAR,DIGER_CKS_MIKTAR,KALANMIKTAR,KALANTUTAR)\r\n       VALUES (@HRK_TANK_KOD,@HRK_TANK_AD,@HRK_ONCEKIMIK,\r\n       @HRK_ONCEKIMIK*@HRK_BRMFIYAT,\r\n       @HRK_MALALIM,@HRK_MALTUTAR,@HRK_SATISMIKTAR,@HRK_TESTMIKTAR,\r\n       @TRANSFER_CKS_MIKTAR,@TRANSFER_GRS_MIKTAR,\r\n       @HRK_DIGER_GRS_MIKTAR,@HRK_DIGER_CKS_MIKTAR,@HRK_KALANMIKTAR,@HRK_KALANMIKTAR*@HRK_BRMFIYAT)\r\n\r\n    FETCH NEXT FROM CRS_HRK INTO\r\n     @HRK_TANK_KOD,@HRK_STK_KOD,@HRK_STK_TIP,@HRK_TANK_AD,@HRK_ONCEKIMIK,@HRK_MALALIM,\r\n     @HRK_SATISMIKTAR,@HRK_TESTMIKTAR,@TRANSFER_CKS_MIKTAR,@TRANSFER_GRS_MIKTAR,\r\n     @HRK_DIGER_GRS_MIKTAR,@HRK_DIGER_CKS_MIKTAR,@HRK_BRMFIYAT,@HRK_MINTARIH,@HRK_MAXTARIH\r\n  END\r\n\r\n  CLOSE CRS_HRK\r\n  DEALLOCATE CRS_HRK\r\n\r\n  /*---------------------------------------------------------------------------- */\r\n\r\n  RETURN\r\n\r\nend"
  },
  {
    "schema": "dbo",
    "name": "UDF_VAR_VERESI_MARKET",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_VAR_VERESI_MARKET",
    "definition": "CREATE FUNCTION [dbo].[UDF_VAR_VERESI_MARKET] (\r\n@VARNIN VARCHAR(4000),@TIP VARCHAR(30))\r\nRETURNS\r\n  @TB_EMTIA_SATIS TABLE (\r\n    STOK_KOD    VARCHAR(20)  COLLATE Turkish_CI_AS,\r\n    STOK_AD     VARCHAR(150)  COLLATE Turkish_CI_AS,\r\n    SATISMIKTAR      FLOAT,\r\n    SATISTUTAR        FLOAT,\r\n    KDV               FLOAT,\r\n    KDVTUTAR          FLOAT,\r\n    BIRIMFIYAT        FLOAT)\r\nAS\r\nBEGIN\r\n  \r\n  INSERT @TB_EMTIA_SATIS (STOK_KOD,STOK_AD,SATISMIKTAR,SATISTUTAR,\r\n  KDV,KDVTUTAR,BIRIMFIYAT)\r\n  select h.stkod,st.ad,\r\n  sum(h.mik),sum(h.brmfiy*h.mik),\r\n  avg(h.kdvyuz*100),\r\n  sum( (h.brmfiy*h.mik)-  ((h.brmfiy*h.mik)/  (1+h.kdvyuz))   ),\r\n  AVG(brmfiy)\r\n  FROM  veresimas as m\r\n  inner join veresihrk as h \r\n  on h.verid=m.verid and m.sil=0\r\n  and h.sil=0\r\n  inner join stokkart as st \r\n  on st.kod=h.stkod and st.tip=h.stktip\r\n  and h.stktip='markt'\r\n  where m.varno in (select * from CsvToInt(@VARNIN)) \r\n  group by h.stkod,st.ad\r\n\r\n  RETURN\r\n\r\nend"
  },
  {
    "schema": "dbo",
    "name": "UDF_VAR_VERESIYE_HRK",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_VAR_VERESIYE_HRK",
    "definition": "CREATE FUNCTION [dbo].UDF_VAR_VERESIYE_HRK (@VARNIN VARCHAR(8000),@TIP VARCHAR(30))\r\nRETURNS\r\n  @TB_VAR_VER_HRK TABLE (\r\n    CARI_TIP      VARCHAR(20)  COLLATE Turkish_CI_AS,\r\n    CARI_KOD      VARCHAR(50)  COLLATE Turkish_CI_AS,\r\n    CARI_ADI      VARCHAR(150)  COLLATE Turkish_CI_AS,\r\n    CARI_GRUP     VARCHAR(50)  COLLATE Turkish_CI_AS,\r\n    SERINO        VARCHAR(50)  COLLATE Turkish_CI_AS,\r\n    PLAKA         VARCHAR(50)  COLLATE Turkish_CI_AS,\r\n    STOK_TIP      VARCHAR(20)  COLLATE Turkish_CI_AS,\r\n    STOK_KOD      VARCHAR(50)  COLLATE Turkish_CI_AS,\r\n    STOK_AD       VARCHAR(100)  COLLATE Turkish_CI_AS,\r\n    MIKTAR        FLOAT,\r\n    BRMFIYAT      FLOAT,\r\n    TUTAR         FLOAT)\r\nAS\r\nBEGIN\r\n\r\n\r\n  INSERT @TB_VAR_VER_HRK (CARI_TIP,CARI_KOD,CARI_ADI,CARI_GRUP,\r\n  SERINO,PLAKA,STOK_TIP,STOK_KOD,MIKTAR,BRMFIYAT)\r\n  select m.cartip,m.carkod,ck.ad,ck.grupad1,\r\n  m.seri+cast(m.no as varchar),m.plaka,\r\n  h.stktip,h.stkod,\r\n  (case when fistip='FISVERSAT' THEN h.mik else -h.mik END),\r\n  ((h.brmfiy*(1-case when isnull(h.iskyuz,0)>0 then \r\n  isnull(h.iskyuz,0)/100 else 0 end   )) -(h.fiyfarktop+h.vadfarktop))\r\n  FROM  veresimas as m with (nolock)\r\n  inner join veresihrk as h  with (nolock) on h.verid=m.verid and h.sil=0 and m.sil=0\r\n  inner join Genel_Kart as ck  with (nolock) on ck.kod=m.carkod and m.cartip=ck.cartp\r\n  where m.varno in (select * from CsvToInt(@VARNIN) )\r\n  and h.sil=0 and m.sil=0 and m.yertip=@TIP order by ck.ad\r\n  \r\n  \r\n\r\n  UPDATE @TB_VAR_VER_HRK set STOK_AD=dt.AD,TUTAR=BRMFIYAT*MIKTAR\r\n  from @TB_VAR_VER_HRK t join\r\n  (select sk.tip,sk.kod,sk.ad from gelgidlistok as sk  with (nolock) ) dt\r\n  on dt.tip=t.STOK_TIP and dt.kod=t.STOK_KOD\r\n\r\n\r\n  RETURN\r\n\r\nend"
  },
  {
    "schema": "dbo",
    "name": "UDF_VAR_VERESIYE_STOK_GRUP",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_VAR_VERESIYE_STOK_GRUP",
    "definition": "CREATE FUNCTION [dbo].[UDF_VAR_VERESIYE_STOK_GRUP] \r\n(@VARNIN VARCHAR(max),@TIP VARCHAR(30))\r\nRETURNS\r\n  @TB_VAR_VER_HRK TABLE (\r\n    SIRA            VARCHAR(250)  COLLATE Turkish_CI_AS,\r\n    FISTIP          VARCHAR(5)  COLLATE Turkish_CI_AS,\r\n    CARI_TIP        VARCHAR(20)  COLLATE Turkish_CI_AS,\r\n    CARI_KOD        VARCHAR(50)  COLLATE Turkish_CI_AS,\r\n    CARI_ADI        VARCHAR(150)  COLLATE Turkish_CI_AS,\r\n    CARI_GRUP       VARCHAR(70)  COLLATE Turkish_CI_AS,\r\n    STOK_TIP        VARCHAR(20)  COLLATE Turkish_CI_AS,\r\n    STOK_KOD        VARCHAR(20)  COLLATE Turkish_CI_AS,\r\n    STOK_AD         VARCHAR(100)  COLLATE Turkish_CI_AS,\r\n    MIKTAR          FLOAT,\r\n    BRMFIYATKDVSIZ  FLOAT,\r\n    BRMFIYATKDVLI   FLOAT,\r\n    KDV\t\t\t\tFLOAT,\r\n    KDVTUTAR\t\tFLOAT,\r\n    TUTARKDVSIZ     FLOAT,\r\n    TUTARKDVLI      FLOAT)\r\nAS\r\nBEGIN\r\n\r\n\r\n    DECLARE @TB_VAR_HRK TABLE (\r\n    FISTIP          VARCHAR(5)  COLLATE Turkish_CI_AS,\r\n    CARI_TIP        VARCHAR(20)  COLLATE Turkish_CI_AS,\r\n    CARI_KOD        VARCHAR(50)  COLLATE Turkish_CI_AS,\r\n    CARI_ADI        VARCHAR(150)  COLLATE Turkish_CI_AS,\r\n    CARI_GRUP       VARCHAR(70)  COLLATE Turkish_CI_AS,\r\n    STOK_TIP        VARCHAR(20)  COLLATE Turkish_CI_AS,\r\n    STOK_KOD        VARCHAR(20)  COLLATE Turkish_CI_AS,\r\n    STOK_AD         VARCHAR(100)  COLLATE Turkish_CI_AS,\r\n    MIKTAR          FLOAT,\r\n    BRMFIYATKDVSIZ  FLOAT,\r\n    BRMFIYATKDVLI   FLOAT,\r\n    KDV\t\t\t\tFLOAT,\r\n    KDVTUTAR\t\tFLOAT,\r\n    TUTARKDVSIZ     FLOAT,\r\n    TUTARKDVLI      FLOAT)\r\n\r\n\r\n\r\n\r\n\r\n\r\n  INSERT @TB_VAR_HRK (FISTIP,CARI_TIP,CARI_KOD,\r\n  STOK_TIP,STOK_KOD,MIKTAR,TUTARKDVLI,KDV)\r\n  select 'IRS',m.cartip,m.carkod,\r\n  h.stktip,h.stkod,\r\n  sum(case when fistip='FISVERSAT' THEN h.mik else -h.mik END),\r\n  sum(case when fistip='FISVERSAT' THEN\r\n  h.mik*(h.brmfiy-(h.fiyfarktop+h.vadfarktop))\r\n  else -h.mik*(h.brmfiy-(h.fiyfarktop+h.vadfarktop)) END),\r\n  h.kdvyuz*100\r\n  FROM  veresimas as m with (nolock)\r\n  inner join veresihrk as h with (nolock) on h.verid=m.verid\r\n  where m.varno in (select * from CsvToInt_Max(@VARNIN) )\r\n  and h.sil=0 and m.sil=0 and m.yertip=@TIP\r\n  and m.otomas_id>0\r\n  group by m.cartip,m.carkod,\r\n  h.stktip,h.stkod,h.kdvyuz\r\n  \r\n  \r\n  \r\n  INSERT @TB_VAR_HRK (FISTIP,CARI_TIP,CARI_KOD,\r\n  STOK_TIP,STOK_KOD,MIKTAR,TUTARKDVLI,KDV)\r\n  select 'FAT',m.cartip,m.carkod,\r\n  h.stktip,h.stkod,\r\n  sum(case when fistip='FISVERSAT' THEN h.mik else -h.mik END),\r\n  sum(case when fistip='FISVERSAT' THEN\r\n  h.mik*(h.brmfiy-(h.fiyfarktop+h.vadfarktop))\r\n  else -h.mik*(h.brmfiy-(h.fiyfarktop+h.vadfarktop)) END),\r\n  h.kdvyuz*100\r\n  FROM  veresimas as m with (nolock)\r\n  inner join veresihrk as h with (nolock) on h.verid=m.verid\r\n  inner join Genel_Kart as ck with (nolock) on ck.kod=m.carkod and m.cartip=ck.cartp\r\n  where m.varno in (select * from CsvToInt_Max(@VARNIN) )\r\n  and h.sil=0 and m.sil=0 and m.yertip=@TIP\r\n  and m.otomas_id is null\r\n  group by m.cartip,m.carkod,\r\n  h.stktip,h.stkod,h.kdvyuz\r\n  \r\n  \r\n  \r\n  INSERT @TB_VAR_VER_HRK (FISTIP,CARI_TIP,CARI_KOD,\r\n  STOK_TIP,STOK_KOD,MIKTAR,TUTARKDVLI,KDV)\r\n  SELECT FISTIP,CARI_TIP,CARI_KOD,\r\n  STOK_TIP,STOK_KOD,SUM(MIKTAR),SUM(TUTARKDVLI),KDV\r\n  FROM @TB_VAR_HRK\r\n  GROUP BY \r\n  FISTIP,CARI_TIP,CARI_KOD,\r\n  STOK_TIP,STOK_KOD,KDV\r\n\r\n  \r\n\r\n\r\n     UPDATE @TB_VAR_VER_HRK \r\n     SET CARI_ADI=DT.AD,\r\n     CARI_GRUP=DT.grupad1\r\n     FROM @TB_VAR_VER_HRK AS T \r\n     join (select kod,cartp,ad,grupad1 from Genel_Kart )\r\n     dt on dt.kod=t.CARI_KOD and dt.cartp=t.CARI_TIP\r\n \r\n\r\n\r\n    UPDATE @TB_VAR_VER_HRK set \r\n    STOK_AD=dt.AD,\r\n    BRMFIYATKDVLI=case when MIKTAR>0 then\r\n    TUTARKDVLI/MIKTAR else 0 end\r\n    from @TB_VAR_VER_HRK t join\r\n    (select sk.tip,sk.kod,sk.ad from gelgidlistok as sk) dt\r\n    on dt.tip=t.STOK_TIP and dt.kod=t.STOK_KOD\r\n\r\n\r\n\r\n    UPDATE @TB_VAR_VER_HRK set \r\n    SIRA=FISTIP+CAST(CARI_KOD AS VARCHAR(200)),\r\n    BRMFIYATKDVSIZ=BRMFIYATKDVLI/(1+(KDV/100)),\r\n    TUTARKDVSIZ=TUTARKDVLI/(1+(KDV/100)),\r\n    KDVTUTAR=TUTARKDVLI-(TUTARKDVLI/(1+(KDV/100)))\r\n  \r\n  RETURN\r\n\r\nend"
  },
  {
    "schema": "dbo",
    "name": "UDF_VAR_VERESIYE_TOPLAM",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_VAR_VERESIYE_TOPLAM",
    "definition": "CREATE FUNCTION [dbo].UDF_VAR_VERESIYE_TOPLAM (@VARNIN VARCHAR(max),@TIP VARCHAR(30))\r\nRETURNS\r\n  @TB_TAH_ODE_TOPLAM TABLE (\r\n    CARI_TIP     VARCHAR(20)  COLLATE Turkish_CI_AS,\r\n    CARI_KOD     VARCHAR(30)  COLLATE Turkish_CI_AS,\r\n    CARI_ADI     VARCHAR(150)  COLLATE Turkish_CI_AS,\r\n    CARI_GRUP    VARCHAR(50)  COLLATE Turkish_CI_AS,\r\n    GIREN        FLOAT,\r\n    CIKAN        FLOAT)\r\nAS\r\nBEGIN\r\n\r\n\r\n  INSERT @TB_TAH_ODE_TOPLAM (CARI_TIP,CARI_KOD,CARI_ADI,CARI_GRUP,GIREN,CIKAN)\r\n  select h.cartip,h.carkod,ck.ad,ck.grupad1,\r\n  sum(case when fistip='FISVERSAT' THEN (toptut-(fiyfarktop+vadfarktop)) else 0 END),\r\n  sum(case when fistip='FISALCSAT' THEN (toptut-(fiyfarktop+vadfarktop)) else 0 END)\r\n  FROM  veresimas as h with (nolock)\r\n  inner join Genel_Kart as ck with (nolock) on ck.kod=h.carkod and h.cartip=ck.cartp\r\n  where h.varno in (select * from CsvToInt_Max(@VARNIN))\r\n  and h.sil=0 and h.yertip=@TIP\r\n  group by h.cartip,h.carkod,ck.ad,ck.grupad1\r\n\r\n  RETURN\r\n\r\nend"
  },
  {
    "schema": "dbo",
    "name": "UDF_VAR_YAKIT_FIYAT",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_VAR_YAKIT_FIYAT",
    "definition": "CREATE FUNCTION [dbo].[UDF_VAR_YAKIT_FIYAT] \r\n(@VARIN VARCHAR(4000),@tip varchar(30))\r\nRETURNS\r\n  @TB_YAKIT_FIYAT TABLE (\r\n    STOK_TIP    VARCHAR(20)  COLLATE Turkish_CI_AS,\r\n    STOK_KOD     VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    STOK_ADI     VARCHAR(150)  COLLATE Turkish_CI_AS,\r\n    VAR_LITRE         FLOAT,\r\n    VAR_FIYAT\t\t  FLOAT,\r\n    VAR_TUTAR\t\t  FLOAT,\r\n    SAT_FIYAT         FLOAT,\r\n    SAT_TUTAR\t\t  FLOAT,\r\n    IND_TUTAR\t\t  FLOAT   \r\n    )\r\nAS\r\nBEGIN\r\n  \r\n \r\n \r\n  if @tip='pomvardimas'\r\n  begin\r\n  INSERT @TB_YAKIT_FIYAT (STOK_TIP,STOK_KOD,STOK_ADI,VAR_LITRE,VAR_FIYAT,SAT_FIYAT)\r\n  select ot.stktip,ot.stkod,k.ad,\r\n    sum(ot.satmik),\r\n   case when sum(ot.satmik)>0 then \r\n    sum(ot.satmik * ot.brimfiy)/ sum(ot.satmik) else 0 END,\r\n    0\r\n    FROM  pomvardisayac as ot with (nolock)\r\n   inner join pomvardimas as p  with (nolock) on \r\n   p.varno=ot.varno\r\n   inner join stokkart as k with (nolock) on k.kod=ot.stkod and k.tip=ot.stktip \r\n   where p.varno in (select * from CsvToInt(@VARIN))\r\n   group by ot.stktip,ot.stkod,k.ad\r\n   order by k.ad\r\n   \r\n  \r\n  \r\n  \r\n  \r\n  \r\n   update @TB_YAKIT_FIYAT set \r\n   SAT_FIYAT=DT.fiyat from @TB_YAKIT_FIYAT as t \r\n  join (select stkod,max(round(ot.brimfiy,3)) as fiyat \r\n   FROM  pomvardisayac as ot with (nolock)\r\n   inner join pomvardimas as p  with (nolock) on \r\n   p.varno=ot.varno\r\n   where p.varno in (select * from CsvToInt(@VARIN))  \r\n   group by ot.stkod ) dt \r\n   on t.STOK_KOD=dt.stkod\r\n  \r\n  \r\n  update @TB_YAKIT_FIYAT \r\n  set VAR_TUTAR=VAR_LITRE*VAR_FIYAT,\r\n  SAT_TUTAR=VAR_LITRE*SAT_FIYAT \r\n  \r\n   \r\n  update @TB_YAKIT_FIYAT set IND_TUTAR=SAT_TUTAR-VAR_TUTAR\r\n \r\n  \r\n  \r\n  end\r\n\r\n\r\n\r\n /*\r\n  if @tip='marvardimas'\r\n  begin\r\n  INSERT @TB_TAH_ODE_TOPLAM (CARI_TIP,CARI_KOD,CARI_ADI,CARI_GRUP,GIREN,CIKAN)\r\n  select h.cartip,h.kod,ck.ad+' '+ck.soyad,gp.ad,sum(case when h.ackfaz='fazla' then tutar else 0 end),\r\n  sum(case when h.ackfaz='acik' then tutar else 0 end)\r\n  FROM  marvardikap as h\r\n  inner join perkart as ck on ck.kod=h.kod and h.cartip='perkart'\r\n  inner join grup as gp on gp.id=ck.grp1\r\n  where h.varno in (select * from @EKSTRE_TEMP) and h.sil=0\r\n  group by h.cartip,h.kod,ck.ad+' '+ck.soyad,gp.ad\r\n  end\r\n  \r\n  \r\n  \r\n   if @tip='resvardimas'\r\n  begin\r\n  INSERT @TB_TAH_ODE_TOPLAM (CARI_TIP,CARI_KOD,CARI_ADI,CARI_GRUP,GIREN,CIKAN)\r\n  select h.cartip,h.kod,ck.ad+' '+ck.soyad,gp.ad,sum(case when h.ackfaz='fazla' then tutar else 0 end),\r\n  sum(case when h.ackfaz='acik' then tutar else 0 end)\r\n  FROM  resvardikap as h\r\n  inner join perkart as ck on ck.kod=h.kod and h.cartip='perkart'\r\n  inner join grup as gp on gp.id=ck.grp1\r\n  where h.varno in (select * from @EKSTRE_TEMP) and h.sil=0\r\n  group by h.cartip,h.kod,ck.ad+' '+ck.soyad,gp.ad\r\n  end\r\n*/\r\n\r\n\r\n\r\n  RETURN\r\n\r\nend"
  },
  {
    "schema": "dbo",
    "name": "UDF_VARDIYA_FINANS",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_VARDIYA_FINANS",
    "definition": "CREATE FUNCTION [dbo].UDF_VARDIYA_FINANS (\r\n@yertip varchar(20),\r\n@varno float,\r\n@SILIN VARCHAR(20))\r\nRETURNS\r\n@TB_VARDIYA_FINANS TABLE (\r\n    id          FLOAT,\r\n    firmano\t\tint,\r\n    Tarih       Datetime,\r\n    Saat        varchar(10) COLLATE Turkish_CI_AS,\r\n    VadeTar     Datetime,\r\n    Giren       FLOAT,\r\n    Cikan       FLOAT,\r\n    Ytlgiren    FLOAT,\r\n    Ytlcikan    FLOAT,\r\n    Kur         FLOAT,\r\n    Parabrm     varchar(10) COLLATE Turkish_CI_AS,\r\n    Grpad      VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    Grptip     VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    Hrkidad     VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    Hrkid       FLOAT,\r\n    Masterid    FLOAT,\r\n    Varno       FLOAT,\r\n    Varok       INT,\r\n    Sil         INT,\r\n    Yerad       VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    Yertip      VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    Perkod      VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    Perad       VARCHAR(100) COLLATE Turkish_CI_AS,\r\n    Adaid       int,\r\n    AdaAd       VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    tipkod      varchar(20) COLLATE Turkish_CI_AS,\r\n    tipad       varchar(50) COLLATE Turkish_CI_AS,\r\n    hrkkod      varchar(20) COLLATE Turkish_CI_AS,\r\n    hrkad      varchar(50) COLLATE Turkish_CI_AS,\r\n    BelNo       varchar(30) COLLATE Turkish_CI_AS,\r\n    Kod         varchar(30) COLLATE Turkish_CI_AS,\r\n    CarKod      varchar(30) COLLATE Turkish_CI_AS,\r\n    CarTip      varchar(20) COLLATE Turkish_CI_AS,\r\n    Cartur      varchar(30) COLLATE Turkish_CI_AS,\r\n    Unvan       varchar(150) COLLATE Turkish_CI_AS,\r\n    Kasakod     varchar(30) COLLATE Turkish_CI_AS,\r\n    KasaAd      varchar(50) COLLATE Turkish_CI_AS,\r\n    Bankakod     varchar(30) COLLATE Turkish_CI_AS,\r\n    BankaAd      varchar(100) COLLATE Turkish_CI_AS,\r\n    Ack          varchar(200) COLLATE Turkish_CI_AS,\r\n    Olustarsaat  Datetime,\r\n    Olususer     varchar(50) COLLATE Turkish_CI_AS\r\n    )\r\nAS\r\nBEGIN\r\n\r\n DECLARE @SIL_TEMP TABLE (\r\n sil      int)\r\n\r\ndeclare @separator char(1)\r\n set @separator = ','\r\n\r\n declare @separator_position int\r\n declare @array_value varchar(1000)\r\n\r\n IF (LEN(RTRIM(@SILIN)) > 0)\r\n BEGIN\r\n  set @SILIN = @SILIN + ','\r\n END\r\n\r\n while patindex('%,%' , @SILIN) <> 0\r\n begin\r\n\r\n   select @separator_position =  patindex('%,%' , @SILIN)\r\n   select @array_value = left(@SILIN, @separator_position - 1)\r\n\r\n  Insert @SIL_TEMP\r\n  Values (@array_value)\r\n\r\n   select @SILIN = stuff(@SILIN, 1, @separator_position, '')\r\n end\r\n\r\n\r\n\r\n/*- kasa hrk */\r\n  insert into @TB_VARDIYA_FINANS (id,firmano,Tarih,Saat,VadeTar,Giren,Cikan,Kur,Parabrm,\r\n  Grpad,Grptip,Hrkidad,Hrkid,Masterid,Varno,Varok,Sil,Yerad,Yertip,Perkod,\r\n  Perad,Adaid,AdaAd,tipkod,tipad,hrkkod,hrkad,BelNo,Ack,Kod,\r\n  CarKod,CarTip,Kasakod,KasaAd,Bankakod,\r\n  BankaAd,Olustarsaat,Olususer)\r\n\r\n  SELECT h.id,h.firmano,h.tarih,h.saat,null as vadetar,h.giren,h.cikan,\r\n  h.kur,h.parabrm,'KASA İŞLEMLERİ','kasahrk',\r\n  ('kashrkid') as hrkidad,h.kashrkid as hrkid,h.masterid,h.varno,h.varok,\r\n  h.sil,h.yerad,h.yertip,\r\n  h.perkod,'',h.adaid,'',h.islmtip,h.islmtipad,h.islmhrk,h.islmhrkad,\r\n  h.belno,h.ack,h.kaskod,h.carkod,h.cartip,\r\n  h.kaskod,'',\r\n  ('') as bankod,('') as bankad,\r\n  h.olustarsaat,h.olususer\r\n  from kasahrk as h\r\n  where h.masterid=0\r\n  and h.islmhrk<>'TES' and h.sil in (select * from @SIL_TEMP)\r\n  and h.yertip=@yertip and h.varno=@varno\r\n\r\n\r\n/* pos hrk */\r\n\r\n  insert into @TB_VARDIYA_FINANS (id,firmano,Tarih,Saat,VadeTar,Giren,Cikan,Kur,Parabrm,\r\n  Grpad,Grptip,Hrkidad,Hrkid,Masterid,Varno,Varok,Sil,Yerad,Yertip,Perkod,\r\n  Perad,Adaid,AdaAd,tipkod,tipad,hrkkod,hrkad,BelNo,Ack,Kod,\r\n  CarKod,CarTip,Kasakod,KasaAd,Bankakod,\r\n  Bankaad,Olustarsaat,Olususer)\r\n\r\n  SELECT h.id,h.firmano,h.tarih,h.saat,h.vadetar,h.giren,h.cikan,h.kur,h.parabrm,\r\n  'POS İŞLEMLERİ','poshrk',('poshrkid'),h.poshrkid,\r\n  h.masterid,h.varno,h.varok,h.sil,h.yerad,h.yertip,\r\n  h.perkod,'',h.adaid,'',\r\n  h.islmtip,h.islmtipad,h.islmhrk,h.islmhrkad,\r\n  h.belno,h.ack,\r\n  h.poskod,\r\n  h.carkod,h.cartip,\r\n  ('') as kaskod,('') as kasad,\r\n  h.bankod,'',\r\n  h.olustarsaat,h.olususer\r\n  from poshrk as h\r\n  where h.masterid=0\r\n  and h.islmhrk<>'POS' and h.sil in (select * from @SIL_TEMP)\r\n  and h.yertip=@yertip and h.varno=@varno\r\n\r\n\r\n /*--cekkart */\r\n  insert into @TB_VARDIYA_FINANS (id,firmano,Tarih,Saat,VadeTar,Giren,Cikan,Kur,Parabrm,\r\n  Grpad,Grptip,Hrkidad,Hrkid,Masterid,Varno,Varok,Sil,Yerad,Yertip,Perkod,\r\n  Perad,Adaid,AdaAd,tipkod,tipad,hrkkod,hrkad,BelNo,Ack,Kod,\r\n  CarKod,CarTip,Kasakod,KasaAd,Bankakod,\r\n  BankaAd,Olustarsaat,Olususer)\r\n\r\n  select h.id,h.firmano,h.tarih,h.saat,h.vadetar,h.giren,h.cikan,h.kur,h.parabrm,\r\n  'ÇEK-SENET','cekkart','cekid',h.cekid,h.masterid,h.varno,h.varok,h.sil,\r\n  h.yerad,h.yertip,h.perkod,'',h.adaid,'',\r\n  h.islmtip,h.islmtipad,h.islmhrk,h.islmhrkad,ceksenno,ack,\r\n  h.refno,\r\n  case when h.islmhrk='ALN' then h.carkod\r\n  when islmhrk='KSN' then   h.vercarkod end,\r\n  case when h.islmhrk='ALN' then h.cartip\r\n  when islmhrk='KSN' then   h.vercartip end,\r\n  ('') as kaskod,('') as kasad,\r\n  ('') as bankod,(banka),\r\n  h.olustarsaat,h.olususer\r\n\r\n  from cekkart as h\r\n  where\r\n  h.sil in (select * from @SIL_TEMP)\r\n  and h.yertip=@yertip and h.varno=@varno\r\n\r\n /*- banka hrk */\r\n  insert into @TB_VARDIYA_FINANS (id,firmano,Tarih,Saat,VadeTar,\r\n  Giren,Cikan,\r\n  Kur,Parabrm,\r\n  Grpad,Grptip,Hrkidad,Hrkid,Masterid,Varno,Varok,Sil,Yerad,Yertip,Perkod,\r\n  Perad,Adaid,AdaAd,tipkod,tipad,hrkkod,hrkad,BelNo,Ack,Kod,\r\n  CarKod,CarTip,Kasakod,KasaAd,Bankakod,\r\n  BankaAd,Olustarsaat,Olususer)\r\n  select h.id,firmano,h.tarih,h.saat,h.vadetar,\r\n  case \r\n  when h.islmhrk='CKN' then h.alacak\r\n  when h.islmhrk='YTN' then 0\r\n   else h.borc end,\r\n  case \r\n  when h.islmhrk='YTN' then h.borc \r\n  when h.islmhrk='CKN' then 0\r\n  else h.alacak end,\r\n  h.kur,h.parabrm,\r\n  'BANKA İŞLEMLERİ','bankahrk',('bankhrkid'),h.bankhrkid,h.masterid,\r\n  h.varno,h.varok,h.sil,h.yerad,h.yertip,\r\n  h.perkod,'',h.adaid,'',\r\n  h.islmtip,h.islmtipad,h.islmhrk,h.islmhrkad,\r\n  h.belno,h.ack,\r\n  h.bankod,h.carkod,h.cartip,h.kaskod,'',\r\n  h.bankod,'',\r\n  h.olustarsaat,h.olususer\r\n  from bankahrk as h\r\n  where h.masterid=0\r\n  and h.sil in (select * from @SIL_TEMP)\r\n  and h.yertip=@yertip and h.varno=@varno\r\n\r\n\r\n /*- cari hrk */\r\n  insert into @TB_VARDIYA_FINANS (id,firmano,Tarih,Saat,VadeTar,Giren,Cikan,Kur,Parabrm,\r\n  Grpad,Grptip,Hrkidad,Hrkid,Masterid,Varno,Varok,Sil,Yerad,Yertip,Perkod,\r\n  Perad,Adaid,AdaAd,tipkod,tipad,hrkkod,hrkad,BelNo,Ack,Kod,\r\n  CarKod,CarTip,Kasakod,KasaAd,Bankakod,\r\n  BankaAd,Olustarsaat,Olususer)\r\n  select h.id,firmano,h.tarih,h.saat,h.vadetar,h.borc,h.alacak,h.kur,h.parabrm,\r\n  'CARİ İŞLEMLER','carihrk',('carhrkid'),h.carhrkid,h.masterid,\r\n  h.varno,h.varok,h.sil,h.yerad,h.yertip,h.perkod,'',h.adaid,'',\r\n  h.islmtip,h.islmtipad,h.islmhrk,h.islmhrkad,\r\n  h.belno,h.ack,\r\n  h.carkod,h.carkod,h.cartip,'','',\r\n  '','',\r\n  h.olustarsaat,h.olususer\r\n  from carihrk as h\r\n  where h.masterid=0 and h.islmtip='MAH'\r\n  and h.sil in (select * from @SIL_TEMP)\r\n  and h.yertip=@yertip and h.varno=@varno\r\n\r\n\r\n/*isletme k.k hrk */\r\n  insert into @TB_VARDIYA_FINANS (id,firmano,Tarih,Saat,VadeTar,Giren,Cikan,Kur,Parabrm,\r\n  Grpad,Grptip,Hrkidad,Hrkid,Masterid,Varno,Varok,Sil,Yerad,Yertip,Perkod,\r\n  Perad,Adaid,AdaAd,tipkod,tipad,hrkkod,hrkad,BelNo,Ack,Kod,\r\n  CarKod,CarTip,Kasakod,KasaAd,Bankakod,\r\n  BankaAd,Olustarsaat,Olususer)\r\n\r\n  select h.id,h.firmano,h.tarih,h.saat,h.vadetar,h.borc,h.alacak,h.kur,h.parabrm,\r\n  'İŞLETME KART İŞLEMLERİ','istkhrk',('istkhrkid'),h.istkhrkid,h.masterid,\r\n  h.varno,h.varok,h.sil,h.yerad,h.yertip,h.perkod,'',h.adaid,'',\r\n  h.islmtip,h.islmtipad,h.islmhrk,h.islmhrkad,\r\n  h.belno,h.ack,h.istkkod,h.carkod,h.cartip,\r\n  (''),('') ,(''),(''),\r\n  h.olustarsaat,h.olususer\r\n  from istkhrk as h\r\n  where h.masterid=0\r\n  and h.sil in (select * from @SIL_TEMP)\r\n  and h.yertip=@yertip and h.varno=@varno\r\n\r\n /*cari unvan */\r\n  update @TB_VARDIYA_FINANS set Cartur=dt.tip ,Unvan=dt.ad from @TB_VARDIYA_FINANS as t\r\n  join (select kod,ad,cartp,tip from Genel_Kart ) dt\r\n  on dt.kod=t.CarKod and dt.cartp=t.cartip\r\n\r\n/* kasa ad */\r\n  update @TB_VARDIYA_FINANS set Kasaad=dt.ad from @TB_VARDIYA_FINANS as t\r\n  join (select kod,ad from Kasakart as k ) dt\r\n  on dt.kod=t.kasakod\r\n\r\n/* banka ad */\r\n  update @TB_VARDIYA_FINANS set Bankaad=dt.ad from @TB_VARDIYA_FINANS as t\r\n  join (select kod,ad from bankakart as k ) dt\r\n  on dt.kod=t.Bankakod\r\n\r\n\r\n /* personel unvan */\r\n  update @TB_VARDIYA_FINANS set perad=dt.ad from @TB_VARDIYA_FINANS as t\r\n  join (select kod,(k.ad+' '+k.soyad) ad from Perkart as k ) dt\r\n  on dt.kod=t.perkod\r\n\r\n\r\n /* ada ad */\r\n  update @TB_VARDIYA_FINANS set Adaad=dt.ad from @TB_VARDIYA_FINANS as t\r\n  join (select id,ad from grup as k where k.tabload='sayackart') dt\r\n  on dt.id=t.adaid\r\n\r\n\r\n  update @TB_VARDIYA_FINANS  set Ytlgiren=giren*kur,ytlcikan=cikan*kur\r\n\r\n\r\n\r\n  RETURN\r\n\r\n\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "UDF_VER_TARIHLI_PLAKA_SON_KM",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.UDF_VER_TARIHLI_PLAKA_SON_KM",
    "definition": "CREATE FUNCTION [dbo].UDF_VER_TARIHLI_PLAKA_SON_KM (\r\n@CARTIP\t\t  VARCHAR(30),\r\n@CARKOD\t\t  VARCHAR(50),\r\n@PLAKA\t\t  VARCHAR(50),\t\r\n@TARIH        DATETIME)\r\nRETURNS\r\n   @TB_VER_PLAKA_KM TABLE (\r\n    CARTIP               VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    CARKOD               VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    PLAKA                VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    KM \t\t\t\t     FLOAT)\r\nAS\r\nBEGIN\r\n\r\n   INSERT INTO @TB_VER_PLAKA_KM\r\n   (CARTIP,CARKOD,PLAKA,KM)\r\n   SELECT cartip,carkod,plaka,MAX(km) from \r\n   veresimas as m where sil=0 and \r\n   cartip=@CARTIP and carkod=@CARKOD\r\n   and plaka=@PLAKA \r\n   and tarih+cast(SAAT as datetime)<@TARIH\r\n   GROUP BY cartip,carkod,plaka\r\n\r\n\r\n  return\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "vadtarihver",
    "type": "SQL_SCALAR_FUNCTION",
    "full_name": "dbo.vadtarihver",
    "definition": "CREATE FUNCTION [dbo].vadtarihver\r\n(@tip varchar(10),\r\n@gun int,\r\n@dt datetime\r\n)\r\nRETURNS\r\ndatetime\r\nAS\r\nBEGIN\r\n\r\n if (@tip='fattar') or (@tip='fistar')  \r\n set @dt=dateadd(day,@gun,convert(datetime,@dt))\r\n\r\n if @tip='bsaygun'\r\n begin\r\n declare @date char(20)\r\n declare @dayin int\r\n set @date =cast(YEAR(@dt) as varchar)+'-'+cast(MONTH(@dt) as varchar)+ '-01'\r\n set @dayin=datepart(day,dateadd(day,-1,(dateadd(month, 2, @date))))\r\n \r\n if @dayin>@gun\r\n begin\r\n     select @dt=dateadd(month,1,@dt)\r\n     set @dt=cast(YEAR(@dt) as varchar)+'-'+\r\n     cast(MONTH(@dt) as varchar)+'-'+cast(@gun as varchar(2))\r\n   end\r\n  else\r\n   begin\r\n     select @dt=dateadd(month,1,@dt)\r\n     set @dt=cast(YEAR(@dt) as varchar)+'-'+cast(MONTH(@dt) as varchar)+ '-01'\r\n     set @dt=dateadd(day,@gun-1,convert(datetime,@dt))\r\n   end\r\n end\r\n \r\nreturn @dt\r\n\r\n\r\nEND"
  },
  {
    "schema": "dbo",
    "name": "VERESIYE_BASLIK",
    "type": "SQL_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.VERESIYE_BASLIK",
    "definition": "CREATE FUNCTION dbo.VERESIYE_BASLIK (@verid float)\r\nRETURNS\r\n @TB_VERESIYE_BASLIK TABLE (\r\n    FIS_TIP\t\t\t VARCHAR(10) COLLATE Turkish_CI_AS,\r\n    FIS_AD           VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    FIS_YKNO         VARCHAR(30) COLLATE Turkish_CI_AS,\r\n    FIS_TARIH        DATETIME,\r\n    FIS_VAD_TARIH    DATETIME,\r\n    FIS_SAAT         VARCHAR(10) COLLATE Turkish_CI_AS,\r\n    FIS_SERINO       VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    FIS_SERI         VARCHAR(10) COLLATE Turkish_CI_AS,\r\n    FIS_NO           VARCHAR(40) COLLATE Turkish_CI_AS,\r\n    FIS_PLAKA        VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    FIS_SURUCU\t\t VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    FIS_KM           VARCHAR(20) COLLATE Turkish_CI_AS,\r\n    FIS_ACIKLAMA     VARCHAR(100) COLLATE Turkish_CI_AS,\r\n    PER_AD           VARCHAR(100) COLLATE Turkish_CI_AS,\r\n    CARI_GRUP        VARCHAR(100) COLLATE Turkish_CI_AS, \r\n    CARI_KOD         VARCHAR(50) COLLATE Turkish_CI_AS, \r\n    CARI_UNVAN       VARCHAR(150) COLLATE Turkish_CI_AS,\r\n    CARI_FAT_UNVAN   VARCHAR(150) COLLATE Turkish_CI_AS,\r\n    CARI_ADRES       VARCHAR(100) COLLATE Turkish_CI_AS,\r\n    CARI_ADRES2      VARCHAR(100) COLLATE Turkish_CI_AS,\r\n    CARI_IL          VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    CARI_ILCE        VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    CARI_VERGIDAIRE  VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    CARI_VERGINO     VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    CARI_TCNO        VARCHAR(50) COLLATE Turkish_CI_AS,\r\n    CARI_FISBAKIYE   FLOAT,\r\n    CARI_CARBAKIYE   FLOAT,\r\n    CARI_TOPBAKIYE   FLOAT,\r\n    CARI_TOPLIMITTUT FLOAT,\r\n    CARI_KALLIMITTUT FLOAT,\r\n    ARA_TOPLAM       FLOAT,\r\n    ISKONTOTOPLAMI   FLOAT,\r\n    ISKONTOLUTOPLAM  FLOAT,\r\n    KDV_TOPLAM       FLOAT,\r\n    YUVARLAMATOP     FLOAT,\r\n    KDVSIZ_TOPLAM    FLOAT,\r\n    KDVLI_TOPLAM     FLOAT,\r\n    FIS_TOPLAM       FLOAT,\r\n    TOPLAM_YAZI      VARCHAR(150) COLLATE Turkish_CI_AS,\r\n    ISK1_YUZDE       FLOAT,\r\n    KDV0_TOPLAM      FLOAT,\r\n    KDV1_TOPLAM      FLOAT,\r\n    KDV8_TOPLAM      FLOAT,\r\n    KDV18_TOPLAM     FLOAT,\r\n    KDV26_TOPLAM     FLOAT,\r\n    KDV0_MATRAH      FLOAT,\r\n    KDV1_MATRAH      FLOAT,\r\n    KDV8_MATRAH      FLOAT,\r\n    KDV18_MATRAH     FLOAT,\r\n    KDV26_MATRAH     FLOAT)\r\n\r\nAS\r\nBEGIN\r\n\r\n insert into @TB_VERESIYE_BASLIK (FIS_TIP,FIS_AD,FIS_YKNO,FIS_TARIH,\r\n FIS_VAD_TARIH,FIS_SAAT,FIS_SERINO,\r\n FIS_SERI,FIS_NO,FIS_PLAKA,FIS_SURUCU,FIS_KM,FIS_ACIKLAMA,PER_AD,\r\n CARI_GRUP,CARI_KOD,CARI_UNVAN,CARI_FAT_UNVAN,CARI_ADRES,CARI_ADRES2,CARI_IL,\r\n CARI_ILCE,CARI_VERGIDAIRE,CARI_VERGINO,CARI_TCNO,\r\n CARI_FISBAKIYE,CARI_CARBAKIYE,CARI_TOPBAKIYE,CARI_TOPLIMITTUT,CARI_KALLIMITTUT,\r\n ARA_TOPLAM,ISKONTOTOPLAMI,\r\n ISKONTOLUTOPLAM,KDV_TOPLAM,YUVARLAMATOP,KDVSIZ_TOPLAM,KDVLI_TOPLAM,FIS_TOPLAM,TOPLAM_YAZI,\r\n KDV0_TOPLAM,KDV1_TOPLAM,KDV8_TOPLAM,KDV18_TOPLAM,KDV26_TOPLAM,\r\n KDV0_MATRAH,KDV1_MATRAH,KDV8_MATRAH,KDV18_MATRAH,KDV26_MATRAH,\r\n ISK1_YUZDE)\r\n SELECT ver.fistip,ver.fisad,ver.ykno,ver.tarih,\r\n ver.vadtar,ver.saat,(ver.seri+' '+ver.no),(ver.seri),(ver.no),\r\n (ver.plaka),(ver.surucu),(ver.km),ver.ack,pk.ad+' '+pk.soyad,\r\n ck.Grup_Ad,CK.KOD, ck.ad,ck.fatunvan,ck.adres,ck.adres2,\r\n ck.evil,ck.evilce,ck.vergidaire,ck.vergino,\r\n ck.tcno,ck.fisbak,ck.carbak,ck.topbak,ck.Toplimit,\r\n ck.toplimit-\r\n  case when ck.toplimit>0 then \r\n  round((ck.fisbak+ck.carbak),2)\r\n  else\r\n  0 end,\r\n (select isnull(\r\n sum(((h.mik*h.brmfiy)/(1+h.kdvyuz)) ),0)\r\n from veresihrk as h WITH (NOLOCK) \r\n where h.verid=ver.verid and h.sil=0), /* ARA_TOPLAM, */\r\n 0,/*ISKONTOTOPLAMI */\r\n 0,/*ISKONTOLUTOPLAM */\r\n  (select isnull(\r\n sum( (h.mik*h.brmfiy) - ((h.mik*h.brmfiy)/(1+h.kdvyuz)) ),0)\r\n from veresihrk as h WITH (NOLOCK) \r\n where h.verid=ver.verid and h.sil=0),/* KDV_TOPLAM, */\r\n 0,/*YUVARLAMATOP */\r\n 0,/*KDVSIZ_TOPLAM */\r\n 0,/*KDVLI_TOPLAM, */\r\n round(toptut,2) ,/*FIS_TOPLAM */\r\n DBO.ParaOku(round(toptut,2)),/* as TOPLAM_YAZI */\r\n KDV0_TOPLAM=isnull((select sum( (h.mik*h.brmfiy) - ((h.mik*h.brmfiy)/(1+h.kdvyuz)) ) from veresihrk as h WITH (NOLOCK)  where h.verid=ver.verid and h.sil=0 and h.kdvyuz=0),0),\r\n KDV1_TOPLAM=isnull((select sum( (h.mik*h.brmfiy) - ((h.mik*h.brmfiy)/(1+h.kdvyuz)) ) from veresihrk as h WITH (NOLOCK) where h.verid=ver.verid and h.sil=0 and h.kdvyuz=0.01),0),\r\n KDV8_TOPLAM=isnull((select sum( (h.mik*h.brmfiy) - ((h.mik*h.brmfiy)/(1+h.kdvyuz)) ) from veresihrk as h WITH (NOLOCK) where h.verid=ver.verid and h.sil=0 and h.kdvyuz=0.08),0),\r\n KDV18_TOPLAM=isnull((select sum( (h.mik*h.brmfiy) - ((h.mik*h.brmfiy)/(1+h.kdvyuz)) ) from veresihrk as h WITH (NOLOCK) where h.verid=ver.verid and h.sil=0 and h.kdvyuz=0.18),0),\r\n KDV26_TOPLAM=isnull((select sum( (h.mik*h.brmfiy) - ((h.mik*h.brmfiy)/(1+h.kdvyuz)) ) from veresihrk as h WITH (NOLOCK) where h.verid=ver.verid and h.sil=0 and h.kdvyuz=0.26),0),\r\n KDV0_MATRAH=isnull((select sum( ((h.mik*h.brmfiy)/(1+h.kdvyuz)) ) from veresihrk as h WITH (NOLOCK) where h.verid=ver.verid and h.sil=0 and h.kdvyuz=0),0),\r\n KDV1_MATRAH=isnull((select sum(  ((h.mik*h.brmfiy)/(1+h.kdvyuz)) ) from veresihrk as h WITH (NOLOCK) where h.verid=ver.verid and h.sil=0 and h.kdvyuz=0.01),0),\r\n KDV8_MATRAH=isnull((select sum(  ((h.mik*h.brmfiy)/(1+h.kdvyuz)) ) from veresihrk as h WITH (NOLOCK) where h.verid=ver.verid and h.sil=0 and h.kdvyuz=0.08),0),\r\n KDV18_MATRAH=isnull((select sum(  ((h.mik*h.brmfiy)/(1+h.kdvyuz)) ) from veresihrk as h WITH (NOLOCK) where h.verid=ver.verid and h.sil=0 and h.kdvyuz=0.18),0),\r\n KDV26_MATRAH=isnull((select sum( ((h.mik*h.brmfiy)/(1+h.kdvyuz)) ) from veresihrk as h WITH (NOLOCK) where h.verid=ver.verid and h.sil=0 and h.kdvyuz=0.26),0), \r\n 0/*ISK1_YUZDE */\r\nFROM  veresimas AS ver WITH (NOLOCK) \r\nINNER JOIN View_Cariler_Kart_Bakiye as ck\r\nON ck.kod=ver.carkod and ck.cartp=ver.cartip\r\nLEFT JOIN Perkart as pk on\r\npk.kod=ver.perkod \r\nwhere verid=@verid\r\n\r\n update @TB_VERESIYE_BASLIK set \r\n     KDVSIZ_TOPLAM=FIS_TOPLAM-KDV_TOPLAM,\r\n     KDVLI_TOPLAM=FIS_TOPLAM\r\n\r\n return\r\n\r\nend"
  },
  {
    "schema": "dbo",
    "name": "VERESIYE_HRK",
    "type": "SQL_INLINE_TABLE_VALUED_FUNCTION",
    "full_name": "dbo.VERESIYE_HRK",
    "definition": "CREATE FUNCTION dbo.VERESIYE_HRK \r\n(@verid float)\r\nRETURNS TABLE AS\r\nRETURN(select h.stkod AS STOK_KOD,gstk.ad as STOK_AD,\r\n(h.mik) MIKTAR,h.brim AS STOK_BIRIM,\r\n(h.brmfiy) BIRIM_FIYAT,\r\n(h.brmfiy/(1+h.kdvyuz)) BIRIM_KDVSIZ,\r\nround((h.brmfiy*h.mik),2) TUTAR,\r\nround( ((h.brmfiy*h.mik)/(1+h.kdvyuz)),2) TUTAR_KDVSIZ,\r\n(h.kdvyuz*100) KDV_ORAN\r\n\r\nfrom veresihrk AS h WITH (NOLOCK) inner join gelgidlistok as gstk on gstk.kod=h.stkod\r\nand h.stktip=gstk.tip where h.verid=@verid and h.sil=0 )"
  }
]